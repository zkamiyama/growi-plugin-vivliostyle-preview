import*as s from"react";import g from"react";import _ from"react-dom";var v={exports:{}},d={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b=g,k=Symbol.for("react.element"),h=Symbol.for("react.fragment"),j=Object.prototype.hasOwnProperty,x=b.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,E={key:!0,ref:!0,__self:!0,__source:!0};function m(t,e,l){var i,n={},r=null,o=null;l!==void 0&&(r=""+l),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)j.call(e,i)&&!E.hasOwnProperty(i)&&(n[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)n[i]===void 0&&(n[i]=e[i]);return{$$typeof:k,type:t,key:r,ref:o,props:n,_owner:x.current}}d.Fragment=h;d.jsx=m;d.jsxs=m;v.exports=d;var c=v.exports,w,p=_;w=p.createRoot,p.hydrateRoot;const R="/plugins/growi-plugin-vivliostyle-preview/viewer/index.html",O=()=>c.jsx("iframe",{id:"vivlio-iframe",title:"Vivliostyle Viewer",src:R,style:{width:"100%",height:"100%",border:0},sandbox:"allow-scripts allow-same-origin"});function I(t={}){const{debounceMs:e=250}=t,[l,i]=s.useState(""),n=s.useRef(null),r=s.useCallback(o=>{n.current&&window.clearTimeout(n.current),n.current=window.setTimeout(()=>i(o),e)},[e]);return s.useEffect(()=>{const o=document.querySelector("textarea.editor")||document.querySelector("#page-editor textarea"),u=()=>{const y=(o==null?void 0:o.value)??"";r(y)};return u(),o==null||o.addEventListener("input",u),()=>{o==null||o.removeEventListener("input",u),n.current&&window.clearTimeout(n.current)}},[r]),{markdown:l}}function S(){const[t,e]=s.useState(""),l=s.useCallback(i=>{var r;e(i);const n=document.querySelector("#vivlio-iframe");(r=n==null?void 0:n.contentWindow)==null||r.postMessage({type:"vivlio:update",html:i},"*")},[]);return{html:t,updateViewer:l}}function C(){const[t,e]=s.useState(()=>localStorage.getItem("vivlio:isOpen")==="1"),l=s.useCallback(()=>e(!0),[]),i=s.useCallback(()=>e(!1),[]),n=s.useCallback(()=>e(r=>!r),[]);return s.useEffect(()=>{localStorage.setItem("vivlio:isOpen",t?"1":"0")},[t]),{isOpen:t,open:l,close:i,toggle:n}}const N=require("markdown-it"),V=new N({html:!0,linkify:!0}),D=()=>{const{isOpen:t,toggle:e}=C(),{markdown:l}=I({debounceMs:250}),{updateViewer:i}=S();return s.useEffect(()=>{if(!t)return;const n=V.render(l);i(n)},[l,t,i]),c.jsxs("div",{className:`vivlio-preview ${t?"is-open":"is-closed"}`,children:[c.jsx("div",{className:"vivlio-toolbar",children:c.jsx("button",{onClick:e,"aria-expanded":t,children:t?"Close Vivliostyle":"Open Vivliostyle"})}),c.jsx("div",{className:"vivlio-body",role:"region","aria-label":"Vivliostyle preview",children:t&&c.jsx(O,{})})]})},L="growi-plugin-vivliostyle-preview",P="1.0.0",T="GROWI plugin template for script",M="MIT",q=["growi","growi-plugin"],$="module",A={dev:"vite",build:"tsc && vite build",test:"jest",preview:"vite preview"},B={"@types/unist":"^3.0.3","@vivliostyle/viewer":"^2.34.1",hastscript:"^9.0.1","markdown-it":"^14.1.0","react-innertext":"^1.1.5",unified:"^11.0.5","unist-util-visit":"^5.0.0"},U={react:">=18","react-dom":">=18"},W={"@testing-library/dom":"^10.4.1","@testing-library/jest-dom":"^6.8.0","@testing-library/react":"^16.3.0","@types/jest":"^30.0.0","@types/markdown-it":"^14.1.2","@types/react":"^18.3.3","@types/react-dom":"^18.3.0","@typescript-eslint/eslint-plugin":"^5.0.0","@typescript-eslint/parser":"^5.0.0","@vitejs/plugin-react":"^4.3.1",eslint:"^8.18.0","eslint-config-next":"^14.2.4","eslint-config-weseek":"^2.1.0","eslint-import-resolver-typescript":"^3.2.5","eslint-plugin-import":"^2.29.1","eslint-plugin-jest":"^27.1.0","eslint-plugin-react":"^7.30.1","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-regex":"^1.10.0","identity-obj-proxy":"^3.0.0",jest:"^29.7.0","jest-environment-jsdom":"^30.1.2",react:"^18.3.1","react-dom":"^18.3.1",typescript:"^5.5.2",vite:"^5.3.2"},F={schemaVersion:"4",types:["script"]},G={name:L,version:P,description:T,license:M,keywords:q,type:$,scripts:A,dependencies:B,peerDependencies:U,devDependencies:W,growiPlugin:F},H=G.name,a="vivlio-preview-container";function f(){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>f(),{once:!0});return}let t=document.getElementById(a);t||(t=document.createElement("div"),t.id=a,document.body.appendChild(t));const e=w(t);e.render(c.jsx(D,{})),window.__vivlio_root=e}function J(){const t=window.__vivlio_root;t&&(t.unmount(),delete window.__vivlio_root);const e=document.getElementById(a);e!=null&&e.parentNode&&e.parentNode.removeChild(e)}const Y=()=>{f()},z=()=>{J()};window.pluginActivators==null&&(window.pluginActivators={});window.pluginActivators[H]={activate:Y,deactivate:z};

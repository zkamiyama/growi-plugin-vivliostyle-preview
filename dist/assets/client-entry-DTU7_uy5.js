function Xx(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var mm={exports:{}},Ba={},vm={exports:{}},Ie={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zs=Symbol.for("react.element"),Yx=Symbol.for("react.portal"),qx=Symbol.for("react.fragment"),Kx=Symbol.for("react.strict_mode"),Qx=Symbol.for("react.profiler"),Zx=Symbol.for("react.provider"),Jx=Symbol.for("react.context"),e1=Symbol.for("react.forward_ref"),t1=Symbol.for("react.suspense"),n1=Symbol.for("react.memo"),i1=Symbol.for("react.lazy"),Np=Symbol.iterator;function r1(e){return e===null||typeof e!="object"?null:(e=Np&&e[Np]||e["@@iterator"],typeof e=="function"?e:null)}var wm={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ym=Object.assign,xm={};function oo(e,t,n){this.props=e,this.context=t,this.refs=xm,this.updater=n||wm}oo.prototype.isReactComponent={};oo.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};oo.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function bm(){}bm.prototype=oo.prototype;function jc(e,t,n){this.props=e,this.context=t,this.refs=xm,this.updater=n||wm}var Gc=jc.prototype=new bm;Gc.constructor=jc;ym(Gc,oo.prototype);Gc.isPureReactComponent=!0;var Tp=Array.isArray,Sm=Object.prototype.hasOwnProperty,Xc={current:null},Cm={key:!0,ref:!0,__self:!0,__source:!0};function km(e,t,n){var i,r={},o=null,s=null;if(t!=null)for(i in t.ref!==void 0&&(s=t.ref),t.key!==void 0&&(o=""+t.key),t)Sm.call(t,i)&&!Cm.hasOwnProperty(i)&&(r[i]=t[i]);var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){for(var a=Array(l),u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}if(e&&e.defaultProps)for(i in l=e.defaultProps,l)r[i]===void 0&&(r[i]=l[i]);return{$$typeof:zs,type:e,key:o,ref:s,props:r,_owner:Xc.current}}function o1(e,t){return{$$typeof:zs,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Yc(e){return typeof e=="object"&&e!==null&&e.$$typeof===zs}function s1(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Ip=/\/+/g;function hu(e,t){return typeof e=="object"&&e!==null&&e.key!=null?s1(""+e.key):t.toString(36)}function Il(e,t,n,i,r){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var s=!1;if(e===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case zs:case Yx:s=!0}}if(s)return s=e,r=r(s),e=i===""?"."+hu(s,0):i,Tp(r)?(n="",e!=null&&(n=e.replace(Ip,"$&/")+"/"),Il(r,t,n,"",function(u){return u})):r!=null&&(Yc(r)&&(r=o1(r,n+(!r.key||s&&s.key===r.key?"":(""+r.key).replace(Ip,"$&/")+"/")+e)),t.push(r)),1;if(s=0,i=i===""?".":i+":",Tp(e))for(var l=0;l<e.length;l++){o=e[l];var a=i+hu(o,l);s+=Il(o,t,n,a,r)}else if(a=r1(e),typeof a=="function")for(e=a.call(e),l=0;!(o=e.next()).done;)o=o.value,a=i+hu(o,l++),s+=Il(o,t,n,a,r);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function tl(e,t,n){if(e==null)return e;var i=[],r=0;return Il(e,i,"","",function(o){return t.call(n,o,r++)}),i}function l1(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Ht={current:null},Rl={transition:null},a1={ReactCurrentDispatcher:Ht,ReactCurrentBatchConfig:Rl,ReactCurrentOwner:Xc};function Em(){throw Error("act(...) is not supported in production builds of React.")}Ie.Children={map:tl,forEach:function(e,t,n){tl(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return tl(e,function(){t++}),t},toArray:function(e){return tl(e,function(t){return t})||[]},only:function(e){if(!Yc(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ie.Component=oo;Ie.Fragment=qx;Ie.Profiler=Qx;Ie.PureComponent=jc;Ie.StrictMode=Kx;Ie.Suspense=t1;Ie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=a1;Ie.act=Em;Ie.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=ym({},e.props),r=e.key,o=e.ref,s=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,s=Xc.current),t.key!==void 0&&(r=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(a in t)Sm.call(t,a)&&!Cm.hasOwnProperty(a)&&(i[a]=t[a]===void 0&&l!==void 0?l[a]:t[a])}var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){l=Array(a);for(var u=0;u<a;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:zs,type:e.type,key:r,ref:o,props:i,_owner:s}};Ie.createContext=function(e){return e={$$typeof:Jx,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Zx,_context:e},e.Consumer=e};Ie.createElement=km;Ie.createFactory=function(e){var t=km.bind(null,e);return t.type=e,t};Ie.createRef=function(){return{current:null}};Ie.forwardRef=function(e){return{$$typeof:e1,render:e}};Ie.isValidElement=Yc;Ie.lazy=function(e){return{$$typeof:i1,_payload:{_status:-1,_result:e},_init:l1}};Ie.memo=function(e,t){return{$$typeof:n1,type:e,compare:t===void 0?null:t}};Ie.startTransition=function(e){var t=Rl.transition;Rl.transition={};try{e()}finally{Rl.transition=t}};Ie.unstable_act=Em;Ie.useCallback=function(e,t){return Ht.current.useCallback(e,t)};Ie.useContext=function(e){return Ht.current.useContext(e)};Ie.useDebugValue=function(){};Ie.useDeferredValue=function(e){return Ht.current.useDeferredValue(e)};Ie.useEffect=function(e,t){return Ht.current.useEffect(e,t)};Ie.useId=function(){return Ht.current.useId()};Ie.useImperativeHandle=function(e,t,n){return Ht.current.useImperativeHandle(e,t,n)};Ie.useInsertionEffect=function(e,t){return Ht.current.useInsertionEffect(e,t)};Ie.useLayoutEffect=function(e,t){return Ht.current.useLayoutEffect(e,t)};Ie.useMemo=function(e,t){return Ht.current.useMemo(e,t)};Ie.useReducer=function(e,t,n){return Ht.current.useReducer(e,t,n)};Ie.useRef=function(e){return Ht.current.useRef(e)};Ie.useState=function(e){return Ht.current.useState(e)};Ie.useSyncExternalStore=function(e,t,n){return Ht.current.useSyncExternalStore(e,t,n)};Ie.useTransition=function(){return Ht.current.useTransition()};Ie.version="18.3.1";vm.exports=Ie;var se=vm.exports;const Ye=Xx(se);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u1=se,h1=Symbol.for("react.element"),c1=Symbol.for("react.fragment"),d1=Object.prototype.hasOwnProperty,p1=u1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,f1={key:!0,ref:!0,__self:!0,__source:!0};function Pm(e,t,n){var i,r={},o=null,s=null;n!==void 0&&(o=""+n),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(s=t.ref);for(i in t)d1.call(t,i)&&!f1.hasOwnProperty(i)&&(r[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps,t)r[i]===void 0&&(r[i]=t[i]);return{$$typeof:h1,type:e,key:o,ref:s,props:r,_owner:p1.current}}Ba.Fragment=c1;Ba.jsx=Pm;Ba.jsxs=Pm;mm.exports=Ba;var he=mm.exports,Nm={exports:{}},an={},Tm={exports:{}},Im={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(E,_){var W=E.length;E.push(_);e:for(;0<W;){var J=W-1>>>1,L=E[J];if(0<r(L,_))E[J]=_,E[W]=L,W=J;else break e}}function n(E){return E.length===0?null:E[0]}function i(E){if(E.length===0)return null;var _=E[0],W=E.pop();if(W!==_){E[0]=W;e:for(var J=0,L=E.length,F=L>>>1;J<F;){var D=2*(J+1)-1,te=E[D],N=D+1,ee=E[N];if(0>r(te,W))N<L&&0>r(ee,te)?(E[J]=ee,E[N]=W,J=N):(E[J]=te,E[D]=W,J=D);else if(N<L&&0>r(ee,W))E[J]=ee,E[N]=W,J=N;else break e}}return _}function r(E,_){var W=E.sortIndex-_.sortIndex;return W!==0?W:E.id-_.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();e.unstable_now=function(){return s.now()-l}}var a=[],u=[],h=1,p=null,c=3,f=!1,v=!1,w=!1,x=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(E){for(var _=n(u);_!==null;){if(_.callback===null)i(u);else if(_.startTime<=E)i(u),_.sortIndex=_.expirationTime,t(a,_);else break;_=n(u)}}function C(E){if(w=!1,y(E),!v)if(n(a)!==null)v=!0,B(P);else{var _=n(u);_!==null&&V(C,_.startTime-E)}}function P(E,_){v=!1,w&&(w=!1,g(M),M=-1),f=!0;var W=c;try{for(y(_),p=n(a);p!==null&&(!(p.expirationTime>_)||E&&!$());){var J=p.callback;if(typeof J=="function"){p.callback=null,c=p.priorityLevel;var L=J(p.expirationTime<=_);_=e.unstable_now(),typeof L=="function"?p.callback=L:p===n(a)&&i(a),y(_)}else i(a);p=n(a)}if(p!==null)var F=!0;else{var D=n(u);D!==null&&V(C,D.startTime-_),F=!1}return F}finally{p=null,c=W,f=!1}}var A=!1,I=null,M=-1,G=5,j=-1;function $(){return!(e.unstable_now()-j<G)}function Z(){if(I!==null){var E=e.unstable_now();j=E;var _=!0;try{_=I(!0,E)}finally{_?b():(A=!1,I=null)}}else A=!1}var b;if(typeof m=="function")b=function(){m(Z)};else if(typeof MessageChannel<"u"){var T=new MessageChannel,k=T.port2;T.port1.onmessage=Z,b=function(){k.postMessage(null)}}else b=function(){x(Z,0)};function B(E){I=E,A||(A=!0,b())}function V(E,_){M=x(function(){E(e.unstable_now())},_)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(E){E.callback=null},e.unstable_continueExecution=function(){v||f||(v=!0,B(P))},e.unstable_forceFrameRate=function(E){0>E||125<E?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<E?Math.floor(1e3/E):5},e.unstable_getCurrentPriorityLevel=function(){return c},e.unstable_getFirstCallbackNode=function(){return n(a)},e.unstable_next=function(E){switch(c){case 1:case 2:case 3:var _=3;break;default:_=c}var W=c;c=_;try{return E()}finally{c=W}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(E,_){switch(E){case 1:case 2:case 3:case 4:case 5:break;default:E=3}var W=c;c=E;try{return _()}finally{c=W}},e.unstable_scheduleCallback=function(E,_,W){var J=e.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?J+W:J):W=J,E){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=W+L,E={id:h++,callback:_,priorityLevel:E,startTime:W,expirationTime:L,sortIndex:-1},W>J?(E.sortIndex=W,t(u,E),n(a)===null&&E===n(u)&&(w?(g(M),M=-1):w=!0,V(C,W-J))):(E.sortIndex=L,t(a,E),v||f||(v=!0,B(P))),E},e.unstable_shouldYield=$,e.unstable_wrapCallback=function(E){var _=c;return function(){var W=c;c=_;try{return E.apply(this,arguments)}finally{c=W}}}})(Im);Tm.exports=Im;var g1=Tm.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var m1=se,ln=g1;function Q(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Rm=new Set,us={};function ur(e,t){Xr(e,t),Xr(e+"Capture",t)}function Xr(e,t){for(us[e]=t,e=0;e<t.length;e++)Rm.add(t[e])}var Qn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ju=Object.prototype.hasOwnProperty,v1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Rp={},Ap={};function w1(e){return Ju.call(Ap,e)?!0:Ju.call(Rp,e)?!1:v1.test(e)?Ap[e]=!0:(Rp[e]=!0,!1)}function y1(e,t,n,i){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function x1(e,t,n,i){if(t===null||typeof t>"u"||y1(e,t,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Wt(e,t,n,i,r,o,s){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var Tt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Tt[e]=new Wt(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Tt[t]=new Wt(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Tt[e]=new Wt(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Tt[e]=new Wt(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Tt[e]=new Wt(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Tt[e]=new Wt(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Tt[e]=new Wt(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Tt[e]=new Wt(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Tt[e]=new Wt(e,5,!1,e.toLowerCase(),null,!1,!1)});var qc=/[\-:]([a-z])/g;function Kc(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(qc,Kc);Tt[t]=new Wt(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(qc,Kc);Tt[t]=new Wt(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(qc,Kc);Tt[t]=new Wt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Tt[e]=new Wt(e,1,!1,e.toLowerCase(),null,!1,!1)});Tt.xlinkHref=new Wt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Tt[e]=new Wt(e,1,!1,e.toLowerCase(),null,!0,!0)});function Qc(e,t,n,i){var r=Tt.hasOwnProperty(t)?Tt[t]:null;(r!==null?r.type!==0:i||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(x1(t,n,r,i)&&(n=null),i||r===null?w1(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=n===null?r.type===3?!1:"":n:(t=r.attributeName,i=r.attributeNamespace,n===null?e.removeAttribute(t):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}var si=m1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,nl=Symbol.for("react.element"),yr=Symbol.for("react.portal"),xr=Symbol.for("react.fragment"),Zc=Symbol.for("react.strict_mode"),eh=Symbol.for("react.profiler"),Am=Symbol.for("react.provider"),Lm=Symbol.for("react.context"),Jc=Symbol.for("react.forward_ref"),th=Symbol.for("react.suspense"),nh=Symbol.for("react.suspense_list"),ed=Symbol.for("react.memo"),hi=Symbol.for("react.lazy"),Fm=Symbol.for("react.offscreen"),Lp=Symbol.iterator;function vo(e){return e===null||typeof e!="object"?null:(e=Lp&&e[Lp]||e["@@iterator"],typeof e=="function"?e:null)}var nt=Object.assign,cu;function Ro(e){if(cu===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);cu=t&&t[1]||""}return`
`+cu+e}var du=!1;function pu(e,t){if(!e||du)return"";du=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var i=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){i=u}e.call(t.prototype)}else{try{throw Error()}catch(u){i=u}e()}}catch(u){if(u&&i&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),o=i.stack.split(`
`),s=r.length-1,l=o.length-1;1<=s&&0<=l&&r[s]!==o[l];)l--;for(;1<=s&&0<=l;s--,l--)if(r[s]!==o[l]){if(s!==1||l!==1)do if(s--,l--,0>l||r[s]!==o[l]){var a=`
`+r[s].replace(" at new "," at ");return e.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",e.displayName)),a}while(1<=s&&0<=l);break}}}finally{du=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Ro(e):""}function b1(e){switch(e.tag){case 5:return Ro(e.type);case 16:return Ro("Lazy");case 13:return Ro("Suspense");case 19:return Ro("SuspenseList");case 0:case 2:case 15:return e=pu(e.type,!1),e;case 11:return e=pu(e.type.render,!1),e;case 1:return e=pu(e.type,!0),e;default:return""}}function ih(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case xr:return"Fragment";case yr:return"Portal";case eh:return"Profiler";case Zc:return"StrictMode";case th:return"Suspense";case nh:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Lm:return(e.displayName||"Context")+".Consumer";case Am:return(e._context.displayName||"Context")+".Provider";case Jc:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case ed:return t=e.displayName||null,t!==null?t:ih(e.type)||"Memo";case hi:t=e._payload,e=e._init;try{return ih(e(t))}catch{}}return null}function S1(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ih(t);case 8:return t===Zc?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Ii(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Om(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function C1(e){var t=Om(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(s){i=""+s,o.call(this,s)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(s){i=""+s},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function il(e){e._valueTracker||(e._valueTracker=C1(e))}function Bm(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=Om(e)?e.checked?"true":"false":e.value),e=i,e!==n?(t.setValue(e),!0):!1}function Kl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function rh(e,t){var n=t.checked;return nt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Fp(e,t){var n=t.defaultValue==null?"":t.defaultValue,i=t.checked!=null?t.checked:t.defaultChecked;n=Ii(t.value!=null?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function _m(e,t){t=t.checked,t!=null&&Qc(e,"checked",t,!1)}function oh(e,t){_m(e,t);var n=Ii(t.value),i=t.type;if(n!=null)i==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(i==="submit"||i==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?sh(e,t.type,n):t.hasOwnProperty("defaultValue")&&sh(e,t.type,Ii(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Op(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!(i!=="submit"&&i!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function sh(e,t,n){(t!=="number"||Kl(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Ao=Array.isArray;function Mr(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+Ii(n),t=null,r=0;r<e.length;r++){if(e[r].value===n){e[r].selected=!0,i&&(e[r].defaultSelected=!0);return}t!==null||e[r].disabled||(t=e[r])}t!==null&&(t.selected=!0)}}function lh(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Q(91));return nt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Bp(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(Q(92));if(Ao(n)){if(1<n.length)throw Error(Q(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:Ii(n)}}function Mm(e,t){var n=Ii(t.value),i=Ii(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),i!=null&&(e.defaultValue=""+i)}function _p(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function zm(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ah(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?zm(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var rl,$m=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,i,r){MSApp.execUnsafeLocalFunction(function(){return e(t,n,i,r)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(rl=rl||document.createElement("div"),rl.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=rl.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function hs(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Uo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},k1=["Webkit","ms","Moz","O"];Object.keys(Uo).forEach(function(e){k1.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Uo[t]=Uo[e]})});function Dm(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Uo.hasOwnProperty(e)&&Uo[e]?(""+t).trim():t+"px"}function Vm(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=Dm(n,t[n],i);n==="float"&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}var E1=nt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function uh(e,t){if(t){if(E1[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Q(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Q(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Q(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Q(62))}}function hh(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ch=null;function td(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var dh=null,zr=null,$r=null;function Mp(e){if(e=Vs(e)){if(typeof dh!="function")throw Error(Q(280));var t=e.stateNode;t&&(t=Da(t),dh(e.stateNode,e.type,t))}}function Um(e){zr?$r?$r.push(e):$r=[e]:zr=e}function Hm(){if(zr){var e=zr,t=$r;if($r=zr=null,Mp(e),t)for(e=0;e<t.length;e++)Mp(t[e])}}function Wm(e,t){return e(t)}function jm(){}var fu=!1;function Gm(e,t,n){if(fu)return e(t,n);fu=!0;try{return Wm(e,t,n)}finally{fu=!1,(zr!==null||$r!==null)&&(jm(),Hm())}}function cs(e,t){var n=e.stateNode;if(n===null)return null;var i=Da(n);if(i===null)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(e=e.type,i=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!i;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(Q(231,t,typeof n));return n}var ph=!1;if(Qn)try{var wo={};Object.defineProperty(wo,"passive",{get:function(){ph=!0}}),window.addEventListener("test",wo,wo),window.removeEventListener("test",wo,wo)}catch{ph=!1}function P1(e,t,n,i,r,o,s,l,a){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(h){this.onError(h)}}var Ho=!1,Ql=null,Zl=!1,fh=null,N1={onError:function(e){Ho=!0,Ql=e}};function T1(e,t,n,i,r,o,s,l,a){Ho=!1,Ql=null,P1.apply(N1,arguments)}function I1(e,t,n,i,r,o,s,l,a){if(T1.apply(this,arguments),Ho){if(Ho){var u=Ql;Ho=!1,Ql=null}else throw Error(Q(198));Zl||(Zl=!0,fh=u)}}function hr(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Xm(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function zp(e){if(hr(e)!==e)throw Error(Q(188))}function R1(e){var t=e.alternate;if(!t){if(t=hr(e),t===null)throw Error(Q(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(r===null)break;var o=r.alternate;if(o===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return zp(r),e;if(o===i)return zp(r),t;o=o.sibling}throw Error(Q(188))}if(n.return!==i.return)n=r,i=o;else{for(var s=!1,l=r.child;l;){if(l===n){s=!0,n=r,i=o;break}if(l===i){s=!0,i=r,n=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===n){s=!0,n=o,i=r;break}if(l===i){s=!0,i=o,n=r;break}l=l.sibling}if(!s)throw Error(Q(189))}}if(n.alternate!==i)throw Error(Q(190))}if(n.tag!==3)throw Error(Q(188));return n.stateNode.current===n?e:t}function Ym(e){return e=R1(e),e!==null?qm(e):null}function qm(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=qm(e);if(t!==null)return t;e=e.sibling}return null}var Km=ln.unstable_scheduleCallback,$p=ln.unstable_cancelCallback,A1=ln.unstable_shouldYield,L1=ln.unstable_requestPaint,ct=ln.unstable_now,F1=ln.unstable_getCurrentPriorityLevel,nd=ln.unstable_ImmediatePriority,Qm=ln.unstable_UserBlockingPriority,Jl=ln.unstable_NormalPriority,O1=ln.unstable_LowPriority,Zm=ln.unstable_IdlePriority,_a=null,Dn=null;function B1(e){if(Dn&&typeof Dn.onCommitFiberRoot=="function")try{Dn.onCommitFiberRoot(_a,e,void 0,(e.current.flags&128)===128)}catch{}}var In=Math.clz32?Math.clz32:z1,_1=Math.log,M1=Math.LN2;function z1(e){return e>>>=0,e===0?32:31-(_1(e)/M1|0)|0}var ol=64,sl=4194304;function Lo(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ea(e,t){var n=e.pendingLanes;if(n===0)return 0;var i=0,r=e.suspendedLanes,o=e.pingedLanes,s=n&268435455;if(s!==0){var l=s&~r;l!==0?i=Lo(l):(o&=s,o!==0&&(i=Lo(o)))}else s=n&~r,s!==0?i=Lo(s):o!==0&&(i=Lo(o));if(i===0)return 0;if(t!==0&&t!==i&&!(t&r)&&(r=i&-i,o=t&-t,r>=o||r===16&&(o&4194240)!==0))return t;if(i&4&&(i|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=i;0<t;)n=31-In(t),r=1<<n,i|=e[n],t&=~r;return i}function $1(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function D1(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-In(o),l=1<<s,a=r[s];a===-1?(!(l&n)||l&i)&&(r[s]=$1(l,t)):a<=t&&(e.expiredLanes|=l),o&=~l}}function gh(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Jm(){var e=ol;return ol<<=1,!(ol&4194240)&&(ol=64),e}function gu(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function $s(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-In(t),e[t]=n}function V1(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-In(n),o=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~o}}function id(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-In(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var _e=0;function ev(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var tv,rd,nv,iv,rv,mh=!1,ll=[],yi=null,xi=null,bi=null,ds=new Map,ps=new Map,di=[],U1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Dp(e,t){switch(e){case"focusin":case"focusout":yi=null;break;case"dragenter":case"dragleave":xi=null;break;case"mouseover":case"mouseout":bi=null;break;case"pointerover":case"pointerout":ds.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ps.delete(t.pointerId)}}function yo(e,t,n,i,r,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},t!==null&&(t=Vs(t),t!==null&&rd(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,r!==null&&t.indexOf(r)===-1&&t.push(r),e)}function H1(e,t,n,i,r){switch(t){case"focusin":return yi=yo(yi,e,t,n,i,r),!0;case"dragenter":return xi=yo(xi,e,t,n,i,r),!0;case"mouseover":return bi=yo(bi,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return ds.set(o,yo(ds.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,ps.set(o,yo(ps.get(o)||null,e,t,n,i,r)),!0}return!1}function ov(e){var t=Gi(e.target);if(t!==null){var n=hr(t);if(n!==null){if(t=n.tag,t===13){if(t=Xm(n),t!==null){e.blockedOn=t,rv(e.priority,function(){nv(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Al(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=vh(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var i=new n.constructor(n.type,n);ch=i,n.target.dispatchEvent(i),ch=null}else return t=Vs(n),t!==null&&rd(t),e.blockedOn=n,!1;t.shift()}return!0}function Vp(e,t,n){Al(e)&&n.delete(t)}function W1(){mh=!1,yi!==null&&Al(yi)&&(yi=null),xi!==null&&Al(xi)&&(xi=null),bi!==null&&Al(bi)&&(bi=null),ds.forEach(Vp),ps.forEach(Vp)}function xo(e,t){e.blockedOn===t&&(e.blockedOn=null,mh||(mh=!0,ln.unstable_scheduleCallback(ln.unstable_NormalPriority,W1)))}function fs(e){function t(r){return xo(r,e)}if(0<ll.length){xo(ll[0],e);for(var n=1;n<ll.length;n++){var i=ll[n];i.blockedOn===e&&(i.blockedOn=null)}}for(yi!==null&&xo(yi,e),xi!==null&&xo(xi,e),bi!==null&&xo(bi,e),ds.forEach(t),ps.forEach(t),n=0;n<di.length;n++)i=di[n],i.blockedOn===e&&(i.blockedOn=null);for(;0<di.length&&(n=di[0],n.blockedOn===null);)ov(n),n.blockedOn===null&&di.shift()}var Dr=si.ReactCurrentBatchConfig,ta=!0;function j1(e,t,n,i){var r=_e,o=Dr.transition;Dr.transition=null;try{_e=1,od(e,t,n,i)}finally{_e=r,Dr.transition=o}}function G1(e,t,n,i){var r=_e,o=Dr.transition;Dr.transition=null;try{_e=4,od(e,t,n,i)}finally{_e=r,Dr.transition=o}}function od(e,t,n,i){if(ta){var r=vh(e,t,n,i);if(r===null)Eu(e,t,i,na,n),Dp(e,i);else if(H1(r,e,t,n,i))i.stopPropagation();else if(Dp(e,i),t&4&&-1<U1.indexOf(e)){for(;r!==null;){var o=Vs(r);if(o!==null&&tv(o),o=vh(e,t,n,i),o===null&&Eu(e,t,i,na,n),o===r)break;r=o}r!==null&&i.stopPropagation()}else Eu(e,t,i,null,n)}}var na=null;function vh(e,t,n,i){if(na=null,e=td(i),e=Gi(e),e!==null)if(t=hr(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Xm(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return na=e,null}function sv(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(F1()){case nd:return 1;case Qm:return 4;case Jl:case O1:return 16;case Zm:return 536870912;default:return 16}default:return 16}}var fi=null,sd=null,Ll=null;function lv(){if(Ll)return Ll;var e,t=sd,n=t.length,i,r="value"in fi?fi.value:fi.textContent,o=r.length;for(e=0;e<n&&t[e]===r[e];e++);var s=n-e;for(i=1;i<=s&&t[n-i]===r[o-i];i++);return Ll=r.slice(e,1<i?1-i:void 0)}function Fl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function al(){return!0}function Up(){return!1}function un(e){function t(n,i,r,o,s){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(n=e[l],this[l]=n?n(o):o[l]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?al:Up,this.isPropagationStopped=Up,this}return nt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=al)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=al)},persist:function(){},isPersistent:al}),t}var so={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ld=un(so),Ds=nt({},so,{view:0,detail:0}),X1=un(Ds),mu,vu,bo,Ma=nt({},Ds,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ad,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==bo&&(bo&&e.type==="mousemove"?(mu=e.screenX-bo.screenX,vu=e.screenY-bo.screenY):vu=mu=0,bo=e),mu)},movementY:function(e){return"movementY"in e?e.movementY:vu}}),Hp=un(Ma),Y1=nt({},Ma,{dataTransfer:0}),q1=un(Y1),K1=nt({},Ds,{relatedTarget:0}),wu=un(K1),Q1=nt({},so,{animationName:0,elapsedTime:0,pseudoElement:0}),Z1=un(Q1),J1=nt({},so,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),eb=un(J1),tb=nt({},so,{data:0}),Wp=un(tb),nb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ib={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ob(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=rb[e])?!!t[e]:!1}function ad(){return ob}var sb=nt({},Ds,{key:function(e){if(e.key){var t=nb[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Fl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?ib[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ad,charCode:function(e){return e.type==="keypress"?Fl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Fl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),lb=un(sb),ab=nt({},Ma,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),jp=un(ab),ub=nt({},Ds,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ad}),hb=un(ub),cb=nt({},so,{propertyName:0,elapsedTime:0,pseudoElement:0}),db=un(cb),pb=nt({},Ma,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),fb=un(pb),gb=[9,13,27,32],ud=Qn&&"CompositionEvent"in window,Wo=null;Qn&&"documentMode"in document&&(Wo=document.documentMode);var mb=Qn&&"TextEvent"in window&&!Wo,av=Qn&&(!ud||Wo&&8<Wo&&11>=Wo),Gp=" ",Xp=!1;function uv(e,t){switch(e){case"keyup":return gb.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hv(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var br=!1;function vb(e,t){switch(e){case"compositionend":return hv(t);case"keypress":return t.which!==32?null:(Xp=!0,Gp);case"textInput":return e=t.data,e===Gp&&Xp?null:e;default:return null}}function wb(e,t){if(br)return e==="compositionend"||!ud&&uv(e,t)?(e=lv(),Ll=sd=fi=null,br=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return av&&t.locale!=="ko"?null:t.data;default:return null}}var yb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Yp(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!yb[e.type]:t==="textarea"}function cv(e,t,n,i){Um(i),t=ia(t,"onChange"),0<t.length&&(n=new ld("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var jo=null,gs=null;function xb(e){Sv(e,0)}function za(e){var t=kr(e);if(Bm(t))return e}function bb(e,t){if(e==="change")return t}var dv=!1;if(Qn){var yu;if(Qn){var xu="oninput"in document;if(!xu){var qp=document.createElement("div");qp.setAttribute("oninput","return;"),xu=typeof qp.oninput=="function"}yu=xu}else yu=!1;dv=yu&&(!document.documentMode||9<document.documentMode)}function Kp(){jo&&(jo.detachEvent("onpropertychange",pv),gs=jo=null)}function pv(e){if(e.propertyName==="value"&&za(gs)){var t=[];cv(t,gs,e,td(e)),Gm(xb,t)}}function Sb(e,t,n){e==="focusin"?(Kp(),jo=t,gs=n,jo.attachEvent("onpropertychange",pv)):e==="focusout"&&Kp()}function Cb(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return za(gs)}function kb(e,t){if(e==="click")return za(t)}function Eb(e,t){if(e==="input"||e==="change")return za(t)}function Pb(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Ln=typeof Object.is=="function"?Object.is:Pb;function ms(e,t){if(Ln(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!Ju.call(t,r)||!Ln(e[r],t[r]))return!1}return!0}function Qp(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Zp(e,t){var n=Qp(e);e=0;for(var i;n;){if(n.nodeType===3){if(i=e+n.textContent.length,e<=t&&i>=t)return{node:n,offset:t-e};e=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Qp(n)}}function fv(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?fv(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function gv(){for(var e=window,t=Kl();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Kl(e.document)}return t}function hd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Nb(e){var t=gv(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&fv(n.ownerDocument.documentElement,n)){if(i!==null&&hd(n)){if(t=i.start,e=i.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(i.start,r);i=i.end===void 0?o:Math.min(i.end,r),!e.extend&&o>i&&(r=i,i=o,o=r),r=Zp(n,o);var s=Zp(n,i);r&&s&&(e.rangeCount!==1||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&(t=t.createRange(),t.setStart(r.node,r.offset),e.removeAllRanges(),o>i?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Tb=Qn&&"documentMode"in document&&11>=document.documentMode,Sr=null,wh=null,Go=null,yh=!1;function Jp(e,t,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;yh||Sr==null||Sr!==Kl(i)||(i=Sr,"selectionStart"in i&&hd(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Go&&ms(Go,i)||(Go=i,i=ia(wh,"onSelect"),0<i.length&&(t=new ld("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=Sr)))}function ul(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Cr={animationend:ul("Animation","AnimationEnd"),animationiteration:ul("Animation","AnimationIteration"),animationstart:ul("Animation","AnimationStart"),transitionend:ul("Transition","TransitionEnd")},bu={},mv={};Qn&&(mv=document.createElement("div").style,"AnimationEvent"in window||(delete Cr.animationend.animation,delete Cr.animationiteration.animation,delete Cr.animationstart.animation),"TransitionEvent"in window||delete Cr.transitionend.transition);function $a(e){if(bu[e])return bu[e];if(!Cr[e])return e;var t=Cr[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in mv)return bu[e]=t[n];return e}var vv=$a("animationend"),wv=$a("animationiteration"),yv=$a("animationstart"),xv=$a("transitionend"),bv=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _i(e,t){bv.set(e,t),ur(t,[e])}for(var Su=0;Su<ef.length;Su++){var Cu=ef[Su],Ib=Cu.toLowerCase(),Rb=Cu[0].toUpperCase()+Cu.slice(1);_i(Ib,"on"+Rb)}_i(vv,"onAnimationEnd");_i(wv,"onAnimationIteration");_i(yv,"onAnimationStart");_i("dblclick","onDoubleClick");_i("focusin","onFocus");_i("focusout","onBlur");_i(xv,"onTransitionEnd");Xr("onMouseEnter",["mouseout","mouseover"]);Xr("onMouseLeave",["mouseout","mouseover"]);Xr("onPointerEnter",["pointerout","pointerover"]);Xr("onPointerLeave",["pointerout","pointerover"]);ur("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ur("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ur("onBeforeInput",["compositionend","keypress","textInput","paste"]);ur("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ur("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ur("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ab=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fo));function tf(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,I1(i,t,void 0,e),e.currentTarget=null}function Sv(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var s=i.length-1;0<=s;s--){var l=i[s],a=l.instance,u=l.currentTarget;if(l=l.listener,a!==o&&r.isPropagationStopped())break e;tf(r,l,u),o=a}else for(s=0;s<i.length;s++){if(l=i[s],a=l.instance,u=l.currentTarget,l=l.listener,a!==o&&r.isPropagationStopped())break e;tf(r,l,u),o=a}}}if(Zl)throw e=fh,Zl=!1,fh=null,e}function He(e,t){var n=t[kh];n===void 0&&(n=t[kh]=new Set);var i=e+"__bubble";n.has(i)||(Cv(t,e,2,!1),n.add(i))}function ku(e,t,n){var i=0;t&&(i|=4),Cv(n,e,i,t)}var hl="_reactListening"+Math.random().toString(36).slice(2);function vs(e){if(!e[hl]){e[hl]=!0,Rm.forEach(function(n){n!=="selectionchange"&&(Ab.has(n)||ku(n,!1,e),ku(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[hl]||(t[hl]=!0,ku("selectionchange",!1,t))}}function Cv(e,t,n,i){switch(sv(t)){case 1:var r=j1;break;case 4:r=G1;break;default:r=od}n=r.bind(null,t,n,e),r=void 0,!ph||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(r=!0),i?r!==void 0?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):r!==void 0?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Eu(e,t,n,i,r){var o=i;if(!(t&1)&&!(t&2)&&i!==null)e:for(;;){if(i===null)return;var s=i.tag;if(s===3||s===4){var l=i.stateNode.containerInfo;if(l===r||l.nodeType===8&&l.parentNode===r)break;if(s===4)for(s=i.return;s!==null;){var a=s.tag;if((a===3||a===4)&&(a=s.stateNode.containerInfo,a===r||a.nodeType===8&&a.parentNode===r))return;s=s.return}for(;l!==null;){if(s=Gi(l),s===null)return;if(a=s.tag,a===5||a===6){i=o=s;continue e}l=l.parentNode}}i=i.return}Gm(function(){var u=o,h=td(n),p=[];e:{var c=bv.get(e);if(c!==void 0){var f=ld,v=e;switch(e){case"keypress":if(Fl(n)===0)break e;case"keydown":case"keyup":f=lb;break;case"focusin":v="focus",f=wu;break;case"focusout":v="blur",f=wu;break;case"beforeblur":case"afterblur":f=wu;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=Hp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=q1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=hb;break;case vv:case wv:case yv:f=Z1;break;case xv:f=db;break;case"scroll":f=X1;break;case"wheel":f=fb;break;case"copy":case"cut":case"paste":f=eb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=jp}var w=(t&4)!==0,x=!w&&e==="scroll",g=w?c!==null?c+"Capture":null:c;w=[];for(var m=u,y;m!==null;){y=m;var C=y.stateNode;if(y.tag===5&&C!==null&&(y=C,g!==null&&(C=cs(m,g),C!=null&&w.push(ws(m,C,y)))),x)break;m=m.return}0<w.length&&(c=new f(c,v,null,n,h),p.push({event:c,listeners:w}))}}if(!(t&7)){e:{if(c=e==="mouseover"||e==="pointerover",f=e==="mouseout"||e==="pointerout",c&&n!==ch&&(v=n.relatedTarget||n.fromElement)&&(Gi(v)||v[Zn]))break e;if((f||c)&&(c=h.window===h?h:(c=h.ownerDocument)?c.defaultView||c.parentWindow:window,f?(v=n.relatedTarget||n.toElement,f=u,v=v?Gi(v):null,v!==null&&(x=hr(v),v!==x||v.tag!==5&&v.tag!==6)&&(v=null)):(f=null,v=u),f!==v)){if(w=Hp,C="onMouseLeave",g="onMouseEnter",m="mouse",(e==="pointerout"||e==="pointerover")&&(w=jp,C="onPointerLeave",g="onPointerEnter",m="pointer"),x=f==null?c:kr(f),y=v==null?c:kr(v),c=new w(C,m+"leave",f,n,h),c.target=x,c.relatedTarget=y,C=null,Gi(h)===u&&(w=new w(g,m+"enter",v,n,h),w.target=y,w.relatedTarget=x,C=w),x=C,f&&v)t:{for(w=f,g=v,m=0,y=w;y;y=cr(y))m++;for(y=0,C=g;C;C=cr(C))y++;for(;0<m-y;)w=cr(w),m--;for(;0<y-m;)g=cr(g),y--;for(;m--;){if(w===g||g!==null&&w===g.alternate)break t;w=cr(w),g=cr(g)}w=null}else w=null;f!==null&&nf(p,c,f,w,!1),v!==null&&x!==null&&nf(p,x,v,w,!0)}}e:{if(c=u?kr(u):window,f=c.nodeName&&c.nodeName.toLowerCase(),f==="select"||f==="input"&&c.type==="file")var P=bb;else if(Yp(c))if(dv)P=Eb;else{P=Cb;var A=Sb}else(f=c.nodeName)&&f.toLowerCase()==="input"&&(c.type==="checkbox"||c.type==="radio")&&(P=kb);if(P&&(P=P(e,u))){cv(p,P,n,h);break e}A&&A(e,c,u),e==="focusout"&&(A=c._wrapperState)&&A.controlled&&c.type==="number"&&sh(c,"number",c.value)}switch(A=u?kr(u):window,e){case"focusin":(Yp(A)||A.contentEditable==="true")&&(Sr=A,wh=u,Go=null);break;case"focusout":Go=wh=Sr=null;break;case"mousedown":yh=!0;break;case"contextmenu":case"mouseup":case"dragend":yh=!1,Jp(p,n,h);break;case"selectionchange":if(Tb)break;case"keydown":case"keyup":Jp(p,n,h)}var I;if(ud)e:{switch(e){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else br?uv(e,n)&&(M="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(M="onCompositionStart");M&&(av&&n.locale!=="ko"&&(br||M!=="onCompositionStart"?M==="onCompositionEnd"&&br&&(I=lv()):(fi=h,sd="value"in fi?fi.value:fi.textContent,br=!0)),A=ia(u,M),0<A.length&&(M=new Wp(M,e,null,n,h),p.push({event:M,listeners:A}),I?M.data=I:(I=hv(n),I!==null&&(M.data=I)))),(I=mb?vb(e,n):wb(e,n))&&(u=ia(u,"onBeforeInput"),0<u.length&&(h=new Wp("onBeforeInput","beforeinput",null,n,h),p.push({event:h,listeners:u}),h.data=I))}Sv(p,t)})}function ws(e,t,n){return{instance:e,listener:t,currentTarget:n}}function ia(e,t){for(var n=t+"Capture",i=[];e!==null;){var r=e,o=r.stateNode;r.tag===5&&o!==null&&(r=o,o=cs(e,n),o!=null&&i.unshift(ws(e,o,r)),o=cs(e,t),o!=null&&i.push(ws(e,o,r))),e=e.return}return i}function cr(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function nf(e,t,n,i,r){for(var o=t._reactName,s=[];n!==null&&n!==i;){var l=n,a=l.alternate,u=l.stateNode;if(a!==null&&a===i)break;l.tag===5&&u!==null&&(l=u,r?(a=cs(n,o),a!=null&&s.unshift(ws(n,a,l))):r||(a=cs(n,o),a!=null&&s.push(ws(n,a,l)))),n=n.return}s.length!==0&&e.push({event:t,listeners:s})}var Lb=/\r\n?/g,Fb=/\u0000|\uFFFD/g;function rf(e){return(typeof e=="string"?e:""+e).replace(Lb,`
`).replace(Fb,"")}function cl(e,t,n){if(t=rf(t),rf(e)!==t&&n)throw Error(Q(425))}function ra(){}var xh=null,bh=null;function Sh(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Ch=typeof setTimeout=="function"?setTimeout:void 0,Ob=typeof clearTimeout=="function"?clearTimeout:void 0,of=typeof Promise=="function"?Promise:void 0,Bb=typeof queueMicrotask=="function"?queueMicrotask:typeof of<"u"?function(e){return of.resolve(null).then(e).catch(_b)}:Ch;function _b(e){setTimeout(function(){throw e})}function Pu(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){e.removeChild(r),fs(t);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);fs(t)}function Si(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function sf(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var lo=Math.random().toString(36).slice(2),zn="__reactFiber$"+lo,ys="__reactProps$"+lo,Zn="__reactContainer$"+lo,kh="__reactEvents$"+lo,Mb="__reactListeners$"+lo,zb="__reactHandles$"+lo;function Gi(e){var t=e[zn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Zn]||n[zn]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=sf(e);e!==null;){if(n=e[zn])return n;e=sf(e)}return t}e=n,n=e.parentNode}return null}function Vs(e){return e=e[zn]||e[Zn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function kr(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Q(33))}function Da(e){return e[ys]||null}var Eh=[],Er=-1;function Mi(e){return{current:e}}function We(e){0>Er||(e.current=Eh[Er],Eh[Er]=null,Er--)}function Ue(e,t){Er++,Eh[Er]=e.current,e.current=t}var Ri={},zt=Mi(Ri),Kt=Mi(!1),nr=Ri;function Yr(e,t){var n=e.type.contextTypes;if(!n)return Ri;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r={},o;for(o in n)r[o]=t[o];return i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function Qt(e){return e=e.childContextTypes,e!=null}function oa(){We(Kt),We(zt)}function lf(e,t,n){if(zt.current!==Ri)throw Error(Q(168));Ue(zt,t),Ue(Kt,n)}function kv(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in t))throw Error(Q(108,S1(e)||"Unknown",r));return nt({},n,i)}function sa(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ri,nr=zt.current,Ue(zt,e),Ue(Kt,Kt.current),!0}function af(e,t,n){var i=e.stateNode;if(!i)throw Error(Q(169));n?(e=kv(e,t,nr),i.__reactInternalMemoizedMergedChildContext=e,We(Kt),We(zt),Ue(zt,e)):We(Kt),Ue(Kt,n)}var Wn=null,Va=!1,Nu=!1;function Ev(e){Wn===null?Wn=[e]:Wn.push(e)}function $b(e){Va=!0,Ev(e)}function zi(){if(!Nu&&Wn!==null){Nu=!0;var e=0,t=_e;try{var n=Wn;for(_e=1;e<n.length;e++){var i=n[e];do i=i(!0);while(i!==null)}Wn=null,Va=!1}catch(r){throw Wn!==null&&(Wn=Wn.slice(e+1)),Km(nd,zi),r}finally{_e=t,Nu=!1}}return null}var Pr=[],Nr=0,la=null,aa=0,pn=[],fn=0,ir=null,Gn=1,Xn="";function Hi(e,t){Pr[Nr++]=aa,Pr[Nr++]=la,la=e,aa=t}function Pv(e,t,n){pn[fn++]=Gn,pn[fn++]=Xn,pn[fn++]=ir,ir=e;var i=Gn;e=Xn;var r=32-In(i)-1;i&=~(1<<r),n+=1;var o=32-In(t)+r;if(30<o){var s=r-r%5;o=(i&(1<<s)-1).toString(32),i>>=s,r-=s,Gn=1<<32-In(t)+r|n<<r|i,Xn=o+e}else Gn=1<<o|n<<r|i,Xn=e}function cd(e){e.return!==null&&(Hi(e,1),Pv(e,1,0))}function dd(e){for(;e===la;)la=Pr[--Nr],Pr[Nr]=null,aa=Pr[--Nr],Pr[Nr]=null;for(;e===ir;)ir=pn[--fn],pn[fn]=null,Xn=pn[--fn],pn[fn]=null,Gn=pn[--fn],pn[fn]=null}var sn=null,rn=null,je=!1,Pn=null;function Nv(e,t){var n=gn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function uf(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,sn=e,rn=Si(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,sn=e,rn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=ir!==null?{id:Gn,overflow:Xn}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=gn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,sn=e,rn=null,!0):!1;default:return!1}}function Ph(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Nh(e){if(je){var t=rn;if(t){var n=t;if(!uf(e,t)){if(Ph(e))throw Error(Q(418));t=Si(n.nextSibling);var i=sn;t&&uf(e,t)?Nv(i,n):(e.flags=e.flags&-4097|2,je=!1,sn=e)}}else{if(Ph(e))throw Error(Q(418));e.flags=e.flags&-4097|2,je=!1,sn=e}}}function hf(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;sn=e}function dl(e){if(e!==sn)return!1;if(!je)return hf(e),je=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Sh(e.type,e.memoizedProps)),t&&(t=rn)){if(Ph(e))throw Tv(),Error(Q(418));for(;t;)Nv(e,t),t=Si(t.nextSibling)}if(hf(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Q(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){rn=Si(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}rn=null}}else rn=sn?Si(e.stateNode.nextSibling):null;return!0}function Tv(){for(var e=rn;e;)e=Si(e.nextSibling)}function qr(){rn=sn=null,je=!1}function pd(e){Pn===null?Pn=[e]:Pn.push(e)}var Db=si.ReactCurrentBatchConfig;function So(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Q(309));var i=n.stateNode}if(!i)throw Error(Q(147,e));var r=i,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(s){var l=r.refs;s===null?delete l[o]:l[o]=s},t._stringRef=o,t)}if(typeof e!="string")throw Error(Q(284));if(!n._owner)throw Error(Q(290,e))}return e}function pl(e,t){throw e=Object.prototype.toString.call(t),Error(Q(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function cf(e){var t=e._init;return t(e._payload)}function Iv(e){function t(g,m){if(e){var y=g.deletions;y===null?(g.deletions=[m],g.flags|=16):y.push(m)}}function n(g,m){if(!e)return null;for(;m!==null;)t(g,m),m=m.sibling;return null}function i(g,m){for(g=new Map;m!==null;)m.key!==null?g.set(m.key,m):g.set(m.index,m),m=m.sibling;return g}function r(g,m){return g=Pi(g,m),g.index=0,g.sibling=null,g}function o(g,m,y){return g.index=y,e?(y=g.alternate,y!==null?(y=y.index,y<m?(g.flags|=2,m):y):(g.flags|=2,m)):(g.flags|=1048576,m)}function s(g){return e&&g.alternate===null&&(g.flags|=2),g}function l(g,m,y,C){return m===null||m.tag!==6?(m=Ou(y,g.mode,C),m.return=g,m):(m=r(m,y),m.return=g,m)}function a(g,m,y,C){var P=y.type;return P===xr?h(g,m,y.props.children,C,y.key):m!==null&&(m.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===hi&&cf(P)===m.type)?(C=r(m,y.props),C.ref=So(g,m,y),C.return=g,C):(C=Dl(y.type,y.key,y.props,null,g.mode,C),C.ref=So(g,m,y),C.return=g,C)}function u(g,m,y,C){return m===null||m.tag!==4||m.stateNode.containerInfo!==y.containerInfo||m.stateNode.implementation!==y.implementation?(m=Bu(y,g.mode,C),m.return=g,m):(m=r(m,y.children||[]),m.return=g,m)}function h(g,m,y,C,P){return m===null||m.tag!==7?(m=Zi(y,g.mode,C,P),m.return=g,m):(m=r(m,y),m.return=g,m)}function p(g,m,y){if(typeof m=="string"&&m!==""||typeof m=="number")return m=Ou(""+m,g.mode,y),m.return=g,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case nl:return y=Dl(m.type,m.key,m.props,null,g.mode,y),y.ref=So(g,null,m),y.return=g,y;case yr:return m=Bu(m,g.mode,y),m.return=g,m;case hi:var C=m._init;return p(g,C(m._payload),y)}if(Ao(m)||vo(m))return m=Zi(m,g.mode,y,null),m.return=g,m;pl(g,m)}return null}function c(g,m,y,C){var P=m!==null?m.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return P!==null?null:l(g,m,""+y,C);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case nl:return y.key===P?a(g,m,y,C):null;case yr:return y.key===P?u(g,m,y,C):null;case hi:return P=y._init,c(g,m,P(y._payload),C)}if(Ao(y)||vo(y))return P!==null?null:h(g,m,y,C,null);pl(g,y)}return null}function f(g,m,y,C,P){if(typeof C=="string"&&C!==""||typeof C=="number")return g=g.get(y)||null,l(m,g,""+C,P);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case nl:return g=g.get(C.key===null?y:C.key)||null,a(m,g,C,P);case yr:return g=g.get(C.key===null?y:C.key)||null,u(m,g,C,P);case hi:var A=C._init;return f(g,m,y,A(C._payload),P)}if(Ao(C)||vo(C))return g=g.get(y)||null,h(m,g,C,P,null);pl(m,C)}return null}function v(g,m,y,C){for(var P=null,A=null,I=m,M=m=0,G=null;I!==null&&M<y.length;M++){I.index>M?(G=I,I=null):G=I.sibling;var j=c(g,I,y[M],C);if(j===null){I===null&&(I=G);break}e&&I&&j.alternate===null&&t(g,I),m=o(j,m,M),A===null?P=j:A.sibling=j,A=j,I=G}if(M===y.length)return n(g,I),je&&Hi(g,M),P;if(I===null){for(;M<y.length;M++)I=p(g,y[M],C),I!==null&&(m=o(I,m,M),A===null?P=I:A.sibling=I,A=I);return je&&Hi(g,M),P}for(I=i(g,I);M<y.length;M++)G=f(I,g,M,y[M],C),G!==null&&(e&&G.alternate!==null&&I.delete(G.key===null?M:G.key),m=o(G,m,M),A===null?P=G:A.sibling=G,A=G);return e&&I.forEach(function($){return t(g,$)}),je&&Hi(g,M),P}function w(g,m,y,C){var P=vo(y);if(typeof P!="function")throw Error(Q(150));if(y=P.call(y),y==null)throw Error(Q(151));for(var A=P=null,I=m,M=m=0,G=null,j=y.next();I!==null&&!j.done;M++,j=y.next()){I.index>M?(G=I,I=null):G=I.sibling;var $=c(g,I,j.value,C);if($===null){I===null&&(I=G);break}e&&I&&$.alternate===null&&t(g,I),m=o($,m,M),A===null?P=$:A.sibling=$,A=$,I=G}if(j.done)return n(g,I),je&&Hi(g,M),P;if(I===null){for(;!j.done;M++,j=y.next())j=p(g,j.value,C),j!==null&&(m=o(j,m,M),A===null?P=j:A.sibling=j,A=j);return je&&Hi(g,M),P}for(I=i(g,I);!j.done;M++,j=y.next())j=f(I,g,M,j.value,C),j!==null&&(e&&j.alternate!==null&&I.delete(j.key===null?M:j.key),m=o(j,m,M),A===null?P=j:A.sibling=j,A=j);return e&&I.forEach(function(Z){return t(g,Z)}),je&&Hi(g,M),P}function x(g,m,y,C){if(typeof y=="object"&&y!==null&&y.type===xr&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case nl:e:{for(var P=y.key,A=m;A!==null;){if(A.key===P){if(P=y.type,P===xr){if(A.tag===7){n(g,A.sibling),m=r(A,y.props.children),m.return=g,g=m;break e}}else if(A.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===hi&&cf(P)===A.type){n(g,A.sibling),m=r(A,y.props),m.ref=So(g,A,y),m.return=g,g=m;break e}n(g,A);break}else t(g,A);A=A.sibling}y.type===xr?(m=Zi(y.props.children,g.mode,C,y.key),m.return=g,g=m):(C=Dl(y.type,y.key,y.props,null,g.mode,C),C.ref=So(g,m,y),C.return=g,g=C)}return s(g);case yr:e:{for(A=y.key;m!==null;){if(m.key===A)if(m.tag===4&&m.stateNode.containerInfo===y.containerInfo&&m.stateNode.implementation===y.implementation){n(g,m.sibling),m=r(m,y.children||[]),m.return=g,g=m;break e}else{n(g,m);break}else t(g,m);m=m.sibling}m=Bu(y,g.mode,C),m.return=g,g=m}return s(g);case hi:return A=y._init,x(g,m,A(y._payload),C)}if(Ao(y))return v(g,m,y,C);if(vo(y))return w(g,m,y,C);pl(g,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,m!==null&&m.tag===6?(n(g,m.sibling),m=r(m,y),m.return=g,g=m):(n(g,m),m=Ou(y,g.mode,C),m.return=g,g=m),s(g)):n(g,m)}return x}var Kr=Iv(!0),Rv=Iv(!1),ua=Mi(null),ha=null,Tr=null,fd=null;function gd(){fd=Tr=ha=null}function md(e){var t=ua.current;We(ua),e._currentValue=t}function Th(e,t,n){for(;e!==null;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,i!==null&&(i.childLanes|=t)):i!==null&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Vr(e,t){ha=e,fd=Tr=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(qt=!0),e.firstContext=null)}function yn(e){var t=e._currentValue;if(fd!==e)if(e={context:e,memoizedValue:t,next:null},Tr===null){if(ha===null)throw Error(Q(308));Tr=e,ha.dependencies={lanes:0,firstContext:e}}else Tr=Tr.next=e;return t}var Xi=null;function vd(e){Xi===null?Xi=[e]:Xi.push(e)}function Av(e,t,n,i){var r=t.interleaved;return r===null?(n.next=n,vd(t)):(n.next=r.next,r.next=n),t.interleaved=n,Jn(e,i)}function Jn(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var ci=!1;function wd(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Lv(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Kn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ci(e,t,n){var i=e.updateQueue;if(i===null)return null;if(i=i.shared,Le&2){var r=i.pending;return r===null?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Jn(e,n)}return r=i.interleaved,r===null?(t.next=t,vd(i)):(t.next=r.next,r.next=t),i.interleaved=t,Jn(e,n)}function Ol(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var i=t.lanes;i&=e.pendingLanes,n|=i,t.lanes=n,id(e,n)}}function df(e,t){var n=e.updateQueue,i=e.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?r=o=s:o=o.next=s,n=n.next}while(n!==null);o===null?r=o=t:o=o.next=t}else r=o=t;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function ca(e,t,n,i){var r=e.updateQueue;ci=!1;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,l=r.shared.pending;if(l!==null){r.shared.pending=null;var a=l,u=a.next;a.next=null,s===null?o=u:s.next=u,s=a;var h=e.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==s&&(l===null?h.firstBaseUpdate=u:l.next=u,h.lastBaseUpdate=a))}if(o!==null){var p=r.baseState;s=0,h=u=a=null,l=o;do{var c=l.lane,f=l.eventTime;if((i&c)===c){h!==null&&(h=h.next={eventTime:f,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var v=e,w=l;switch(c=t,f=n,w.tag){case 1:if(v=w.payload,typeof v=="function"){p=v.call(f,p,c);break e}p=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=w.payload,c=typeof v=="function"?v.call(f,p,c):v,c==null)break e;p=nt({},p,c);break e;case 2:ci=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,c=r.effects,c===null?r.effects=[l]:c.push(l))}else f={eventTime:f,lane:c,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(u=h=f,a=p):h=h.next=f,s|=c;if(l=l.next,l===null){if(l=r.shared.pending,l===null)break;c=l,l=c.next,c.next=null,r.lastBaseUpdate=c,r.shared.pending=null}}while(!0);if(h===null&&(a=p),r.baseState=a,r.firstBaseUpdate=u,r.lastBaseUpdate=h,t=r.shared.interleaved,t!==null){r=t;do s|=r.lane,r=r.next;while(r!==t)}else o===null&&(r.shared.lanes=0);or|=s,e.lanes=s,e.memoizedState=p}}function pf(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(Q(191,r));r.call(i)}}}var Us={},Vn=Mi(Us),xs=Mi(Us),bs=Mi(Us);function Yi(e){if(e===Us)throw Error(Q(174));return e}function yd(e,t){switch(Ue(bs,t),Ue(xs,e),Ue(Vn,Us),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ah(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=ah(t,e)}We(Vn),Ue(Vn,t)}function Qr(){We(Vn),We(xs),We(bs)}function Fv(e){Yi(bs.current);var t=Yi(Vn.current),n=ah(t,e.type);t!==n&&(Ue(xs,e),Ue(Vn,n))}function xd(e){xs.current===e&&(We(Vn),We(xs))}var Je=Mi(0);function da(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Tu=[];function bd(){for(var e=0;e<Tu.length;e++)Tu[e]._workInProgressVersionPrimary=null;Tu.length=0}var Bl=si.ReactCurrentDispatcher,Iu=si.ReactCurrentBatchConfig,rr=0,tt=null,yt=null,Ct=null,pa=!1,Xo=!1,Ss=0,Vb=0;function Rt(){throw Error(Q(321))}function Sd(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Ln(e[n],t[n]))return!1;return!0}function Cd(e,t,n,i,r,o){if(rr=o,tt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Bl.current=e===null||e.memoizedState===null?jb:Gb,e=n(i,r),Xo){o=0;do{if(Xo=!1,Ss=0,25<=o)throw Error(Q(301));o+=1,Ct=yt=null,t.updateQueue=null,Bl.current=Xb,e=n(i,r)}while(Xo)}if(Bl.current=fa,t=yt!==null&&yt.next!==null,rr=0,Ct=yt=tt=null,pa=!1,t)throw Error(Q(300));return e}function kd(){var e=Ss!==0;return Ss=0,e}function Bn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ct===null?tt.memoizedState=Ct=e:Ct=Ct.next=e,Ct}function xn(){if(yt===null){var e=tt.alternate;e=e!==null?e.memoizedState:null}else e=yt.next;var t=Ct===null?tt.memoizedState:Ct.next;if(t!==null)Ct=t,yt=e;else{if(e===null)throw Error(Q(310));yt=e,e={memoizedState:yt.memoizedState,baseState:yt.baseState,baseQueue:yt.baseQueue,queue:yt.queue,next:null},Ct===null?tt.memoizedState=Ct=e:Ct=Ct.next=e}return Ct}function Cs(e,t){return typeof t=="function"?t(e):t}function Ru(e){var t=xn(),n=t.queue;if(n===null)throw Error(Q(311));n.lastRenderedReducer=e;var i=yt,r=i.baseQueue,o=n.pending;if(o!==null){if(r!==null){var s=r.next;r.next=o.next,o.next=s}i.baseQueue=r=o,n.pending=null}if(r!==null){o=r.next,i=i.baseState;var l=s=null,a=null,u=o;do{var h=u.lane;if((rr&h)===h)a!==null&&(a=a.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var p={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};a===null?(l=a=p,s=i):a=a.next=p,tt.lanes|=h,or|=h}u=u.next}while(u!==null&&u!==o);a===null?s=i:a.next=l,Ln(i,t.memoizedState)||(qt=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=a,n.lastRenderedState=i}if(e=n.interleaved,e!==null){r=e;do o=r.lane,tt.lanes|=o,or|=o,r=r.next;while(r!==e)}else r===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Au(e){var t=xn(),n=t.queue;if(n===null)throw Error(Q(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,o=t.memoizedState;if(r!==null){n.pending=null;var s=r=r.next;do o=e(o,s.action),s=s.next;while(s!==r);Ln(o,t.memoizedState)||(qt=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function Ov(){}function Bv(e,t){var n=tt,i=xn(),r=t(),o=!Ln(i.memoizedState,r);if(o&&(i.memoizedState=r,qt=!0),i=i.queue,Ed(zv.bind(null,n,i,e),[e]),i.getSnapshot!==t||o||Ct!==null&&Ct.memoizedState.tag&1){if(n.flags|=2048,ks(9,Mv.bind(null,n,i,r,t),void 0,null),kt===null)throw Error(Q(349));rr&30||_v(n,t,r)}return r}function _v(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=tt.updateQueue,t===null?(t={lastEffect:null,stores:null},tt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Mv(e,t,n,i){t.value=n,t.getSnapshot=i,$v(t)&&Dv(e)}function zv(e,t,n){return n(function(){$v(t)&&Dv(e)})}function $v(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Ln(e,n)}catch{return!0}}function Dv(e){var t=Jn(e,1);t!==null&&Rn(t,e,1,-1)}function ff(e){var t=Bn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Cs,lastRenderedState:e},t.queue=e,e=e.dispatch=Wb.bind(null,tt,e),[t.memoizedState,e]}function ks(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},t=tt.updateQueue,t===null?(t={lastEffect:null,stores:null},tt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e)),e}function Vv(){return xn().memoizedState}function _l(e,t,n,i){var r=Bn();tt.flags|=e,r.memoizedState=ks(1|t,n,void 0,i===void 0?null:i)}function Ua(e,t,n,i){var r=xn();i=i===void 0?null:i;var o=void 0;if(yt!==null){var s=yt.memoizedState;if(o=s.destroy,i!==null&&Sd(i,s.deps)){r.memoizedState=ks(t,n,o,i);return}}tt.flags|=e,r.memoizedState=ks(1|t,n,o,i)}function gf(e,t){return _l(8390656,8,e,t)}function Ed(e,t){return Ua(2048,8,e,t)}function Uv(e,t){return Ua(4,2,e,t)}function Hv(e,t){return Ua(4,4,e,t)}function Wv(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function jv(e,t,n){return n=n!=null?n.concat([e]):null,Ua(4,4,Wv.bind(null,t,e),n)}function Pd(){}function Gv(e,t){var n=xn();t=t===void 0?null:t;var i=n.memoizedState;return i!==null&&t!==null&&Sd(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Xv(e,t){var n=xn();t=t===void 0?null:t;var i=n.memoizedState;return i!==null&&t!==null&&Sd(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Yv(e,t,n){return rr&21?(Ln(n,t)||(n=Jm(),tt.lanes|=n,or|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,qt=!0),e.memoizedState=n)}function Ub(e,t){var n=_e;_e=n!==0&&4>n?n:4,e(!0);var i=Iu.transition;Iu.transition={};try{e(!1),t()}finally{_e=n,Iu.transition=i}}function qv(){return xn().memoizedState}function Hb(e,t,n){var i=Ei(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Kv(e))Qv(t,n);else if(n=Av(e,t,n,i),n!==null){var r=Ut();Rn(n,e,i,r),Zv(n,t,i)}}function Wb(e,t,n){var i=Ei(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Kv(e))Qv(t,r);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var s=t.lastRenderedState,l=o(s,n);if(r.hasEagerState=!0,r.eagerState=l,Ln(l,s)){var a=t.interleaved;a===null?(r.next=r,vd(t)):(r.next=a.next,a.next=r),t.interleaved=r;return}}catch{}finally{}n=Av(e,t,r,i),n!==null&&(r=Ut(),Rn(n,e,i,r),Zv(n,t,i))}}function Kv(e){var t=e.alternate;return e===tt||t!==null&&t===tt}function Qv(e,t){Xo=pa=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Zv(e,t,n){if(n&4194240){var i=t.lanes;i&=e.pendingLanes,n|=i,t.lanes=n,id(e,n)}}var fa={readContext:yn,useCallback:Rt,useContext:Rt,useEffect:Rt,useImperativeHandle:Rt,useInsertionEffect:Rt,useLayoutEffect:Rt,useMemo:Rt,useReducer:Rt,useRef:Rt,useState:Rt,useDebugValue:Rt,useDeferredValue:Rt,useTransition:Rt,useMutableSource:Rt,useSyncExternalStore:Rt,useId:Rt,unstable_isNewReconciler:!1},jb={readContext:yn,useCallback:function(e,t){return Bn().memoizedState=[e,t===void 0?null:t],e},useContext:yn,useEffect:gf,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,_l(4194308,4,Wv.bind(null,t,e),n)},useLayoutEffect:function(e,t){return _l(4194308,4,e,t)},useInsertionEffect:function(e,t){return _l(4,2,e,t)},useMemo:function(e,t){var n=Bn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=Bn();return t=n!==void 0?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Hb.bind(null,tt,e),[i.memoizedState,e]},useRef:function(e){var t=Bn();return e={current:e},t.memoizedState=e},useState:ff,useDebugValue:Pd,useDeferredValue:function(e){return Bn().memoizedState=e},useTransition:function(){var e=ff(!1),t=e[0];return e=Ub.bind(null,e[1]),Bn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=tt,r=Bn();if(je){if(n===void 0)throw Error(Q(407));n=n()}else{if(n=t(),kt===null)throw Error(Q(349));rr&30||_v(i,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,gf(zv.bind(null,i,o,e),[e]),i.flags|=2048,ks(9,Mv.bind(null,i,o,n,t),void 0,null),n},useId:function(){var e=Bn(),t=kt.identifierPrefix;if(je){var n=Xn,i=Gn;n=(i&~(1<<32-In(i)-1)).toString(32)+n,t=":"+t+"R"+n,n=Ss++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=Vb++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Gb={readContext:yn,useCallback:Gv,useContext:yn,useEffect:Ed,useImperativeHandle:jv,useInsertionEffect:Uv,useLayoutEffect:Hv,useMemo:Xv,useReducer:Ru,useRef:Vv,useState:function(){return Ru(Cs)},useDebugValue:Pd,useDeferredValue:function(e){var t=xn();return Yv(t,yt.memoizedState,e)},useTransition:function(){var e=Ru(Cs)[0],t=xn().memoizedState;return[e,t]},useMutableSource:Ov,useSyncExternalStore:Bv,useId:qv,unstable_isNewReconciler:!1},Xb={readContext:yn,useCallback:Gv,useContext:yn,useEffect:Ed,useImperativeHandle:jv,useInsertionEffect:Uv,useLayoutEffect:Hv,useMemo:Xv,useReducer:Au,useRef:Vv,useState:function(){return Au(Cs)},useDebugValue:Pd,useDeferredValue:function(e){var t=xn();return yt===null?t.memoizedState=e:Yv(t,yt.memoizedState,e)},useTransition:function(){var e=Au(Cs)[0],t=xn().memoizedState;return[e,t]},useMutableSource:Ov,useSyncExternalStore:Bv,useId:qv,unstable_isNewReconciler:!1};function kn(e,t){if(e&&e.defaultProps){t=nt({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Ih(e,t,n,i){t=e.memoizedState,n=n(i,t),n=n==null?t:nt({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Ha={isMounted:function(e){return(e=e._reactInternals)?hr(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=Ut(),r=Ei(e),o=Kn(i,r);o.payload=t,n!=null&&(o.callback=n),t=Ci(e,o,r),t!==null&&(Rn(t,e,r,i),Ol(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=Ut(),r=Ei(e),o=Kn(i,r);o.tag=1,o.payload=t,n!=null&&(o.callback=n),t=Ci(e,o,r),t!==null&&(Rn(t,e,r,i),Ol(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Ut(),i=Ei(e),r=Kn(n,i);r.tag=2,t!=null&&(r.callback=t),t=Ci(e,r,i),t!==null&&(Rn(t,e,i,n),Ol(t,e,i))}};function mf(e,t,n,i,r,o,s){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(i,o,s):t.prototype&&t.prototype.isPureReactComponent?!ms(n,i)||!ms(r,o):!0}function Jv(e,t,n){var i=!1,r=Ri,o=t.contextType;return typeof o=="object"&&o!==null?o=yn(o):(r=Qt(t)?nr:zt.current,i=t.contextTypes,o=(i=i!=null)?Yr(e,r):Ri),t=new t(n,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Ha,e.stateNode=t,t._reactInternals=e,i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function vf(e,t,n,i){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,i),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Ha.enqueueReplaceState(t,t.state,null)}function Rh(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},wd(e);var o=t.contextType;typeof o=="object"&&o!==null?r.context=yn(o):(o=Qt(t)?nr:zt.current,r.context=Yr(e,o)),r.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(Ih(e,t,o,n),r.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(t=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),t!==r.state&&Ha.enqueueReplaceState(r,r.state,null),ca(e,n,r,i),r.state=e.memoizedState),typeof r.componentDidMount=="function"&&(e.flags|=4194308)}function Zr(e,t){try{var n="",i=t;do n+=b1(i),i=i.return;while(i);var r=n}catch(o){r=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:r,digest:null}}function Lu(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Ah(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var Yb=typeof WeakMap=="function"?WeakMap:Map;function ew(e,t,n){n=Kn(-1,n),n.tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){ma||(ma=!0,Vh=i),Ah(e,t)},n}function tw(e,t,n){n=Kn(-1,n),n.tag=3;var i=e.type.getDerivedStateFromError;if(typeof i=="function"){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){Ah(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){Ah(e,t),typeof i!="function"&&(ki===null?ki=new Set([this]):ki.add(this));var s=t.stack;this.componentDidCatch(t.value,{componentStack:s!==null?s:""})}),n}function wf(e,t,n){var i=e.pingCache;if(i===null){i=e.pingCache=new Yb;var r=new Set;i.set(t,r)}else r=i.get(t),r===void 0&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=aS.bind(null,e,t,n),t.then(e,e))}function yf(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function xf(e,t,n,i,r){return e.mode&1?(e.flags|=65536,e.lanes=r,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Kn(-1,1),t.tag=2,Ci(n,t,1))),n.lanes|=1),e)}var qb=si.ReactCurrentOwner,qt=!1;function $t(e,t,n,i){t.child=e===null?Rv(t,null,n,i):Kr(t,e.child,n,i)}function bf(e,t,n,i,r){n=n.render;var o=t.ref;return Vr(t,r),i=Cd(e,t,n,i,o,r),n=kd(),e!==null&&!qt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,ei(e,t,r)):(je&&n&&cd(t),t.flags|=1,$t(e,t,i,r),t.child)}function Sf(e,t,n,i,r){if(e===null){var o=n.type;return typeof o=="function"&&!Od(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=o,nw(e,t,o,i,r)):(e=Dl(n.type,null,i,t,t.mode,r),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&r)){var s=o.memoizedProps;if(n=n.compare,n=n!==null?n:ms,n(s,i)&&e.ref===t.ref)return ei(e,t,r)}return t.flags|=1,e=Pi(o,i),e.ref=t.ref,e.return=t,t.child=e}function nw(e,t,n,i,r){if(e!==null){var o=e.memoizedProps;if(ms(o,i)&&e.ref===t.ref)if(qt=!1,t.pendingProps=i=o,(e.lanes&r)!==0)e.flags&131072&&(qt=!0);else return t.lanes=e.lanes,ei(e,t,r)}return Lh(e,t,n,i,r)}function iw(e,t,n){var i=t.pendingProps,r=i.children,o=e!==null?e.memoizedState:null;if(i.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ue(Rr,nn),nn|=n;else{if(!(n&1073741824))return e=o!==null?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ue(Rr,nn),nn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=o!==null?o.baseLanes:n,Ue(Rr,nn),nn|=i}else o!==null?(i=o.baseLanes|n,t.memoizedState=null):i=n,Ue(Rr,nn),nn|=i;return $t(e,t,r,n),t.child}function rw(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Lh(e,t,n,i,r){var o=Qt(n)?nr:zt.current;return o=Yr(t,o),Vr(t,r),n=Cd(e,t,n,i,o,r),i=kd(),e!==null&&!qt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,ei(e,t,r)):(je&&i&&cd(t),t.flags|=1,$t(e,t,n,r),t.child)}function Cf(e,t,n,i,r){if(Qt(n)){var o=!0;sa(t)}else o=!1;if(Vr(t,r),t.stateNode===null)Ml(e,t),Jv(t,n,i),Rh(t,n,i,r),i=!0;else if(e===null){var s=t.stateNode,l=t.memoizedProps;s.props=l;var a=s.context,u=n.contextType;typeof u=="object"&&u!==null?u=yn(u):(u=Qt(n)?nr:zt.current,u=Yr(t,u));var h=n.getDerivedStateFromProps,p=typeof h=="function"||typeof s.getSnapshotBeforeUpdate=="function";p||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==i||a!==u)&&vf(t,s,i,u),ci=!1;var c=t.memoizedState;s.state=c,ca(t,i,s,r),a=t.memoizedState,l!==i||c!==a||Kt.current||ci?(typeof h=="function"&&(Ih(t,n,h,i),a=t.memoizedState),(l=ci||mf(t,n,l,i,c,a,u))?(p||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(t.flags|=4194308)):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=a),s.props=i,s.state=a,s.context=u,i=l):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),i=!1)}else{s=t.stateNode,Lv(e,t),l=t.memoizedProps,u=t.type===t.elementType?l:kn(t.type,l),s.props=u,p=t.pendingProps,c=s.context,a=n.contextType,typeof a=="object"&&a!==null?a=yn(a):(a=Qt(n)?nr:zt.current,a=Yr(t,a));var f=n.getDerivedStateFromProps;(h=typeof f=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==p||c!==a)&&vf(t,s,i,a),ci=!1,c=t.memoizedState,s.state=c,ca(t,i,s,r);var v=t.memoizedState;l!==p||c!==v||Kt.current||ci?(typeof f=="function"&&(Ih(t,n,f,i),v=t.memoizedState),(u=ci||mf(t,n,u,i,c,v,a)||!1)?(h||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(i,v,a),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(i,v,a)),typeof s.componentDidUpdate=="function"&&(t.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof s.componentDidUpdate!="function"||l===e.memoizedProps&&c===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&c===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=v),s.props=i,s.state=v,s.context=a,i=u):(typeof s.componentDidUpdate!="function"||l===e.memoizedProps&&c===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&c===e.memoizedState||(t.flags|=1024),i=!1)}return Fh(e,t,n,i,o,r)}function Fh(e,t,n,i,r,o){rw(e,t);var s=(t.flags&128)!==0;if(!i&&!s)return r&&af(t,n,!1),ei(e,t,o);i=t.stateNode,qb.current=t;var l=s&&typeof n.getDerivedStateFromError!="function"?null:i.render();return t.flags|=1,e!==null&&s?(t.child=Kr(t,e.child,null,o),t.child=Kr(t,null,l,o)):$t(e,t,l,o),t.memoizedState=i.state,r&&af(t,n,!0),t.child}function ow(e){var t=e.stateNode;t.pendingContext?lf(e,t.pendingContext,t.pendingContext!==t.context):t.context&&lf(e,t.context,!1),yd(e,t.containerInfo)}function kf(e,t,n,i,r){return qr(),pd(r),t.flags|=256,$t(e,t,n,i),t.child}var Oh={dehydrated:null,treeContext:null,retryLane:0};function Bh(e){return{baseLanes:e,cachePool:null,transitions:null}}function sw(e,t,n){var i=t.pendingProps,r=Je.current,o=!1,s=(t.flags&128)!==0,l;if((l=s)||(l=e!==null&&e.memoizedState===null?!1:(r&2)!==0),l?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(r|=1),Ue(Je,r&1),e===null)return Nh(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=i.children,e=i.fallback,o?(i=t.mode,o=t.child,s={mode:"hidden",children:s},!(i&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=Ga(s,i,0,null),e=Zi(e,i,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Bh(n),t.memoizedState=Oh,e):Nd(t,s));if(r=e.memoizedState,r!==null&&(l=r.dehydrated,l!==null))return Kb(e,t,s,i,l,r,n);if(o){o=i.fallback,s=t.mode,r=e.child,l=r.sibling;var a={mode:"hidden",children:i.children};return!(s&1)&&t.child!==r?(i=t.child,i.childLanes=0,i.pendingProps=a,t.deletions=null):(i=Pi(r,a),i.subtreeFlags=r.subtreeFlags&14680064),l!==null?o=Pi(l,o):(o=Zi(o,s,n,null),o.flags|=2),o.return=t,i.return=t,i.sibling=o,t.child=i,i=o,o=t.child,s=e.child.memoizedState,s=s===null?Bh(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=e.childLanes&~n,t.memoizedState=Oh,i}return o=e.child,e=o.sibling,i=Pi(o,{mode:"visible",children:i.children}),!(t.mode&1)&&(i.lanes=n),i.return=t,i.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Nd(e,t){return t=Ga({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function fl(e,t,n,i){return i!==null&&pd(i),Kr(t,e.child,null,n),e=Nd(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Kb(e,t,n,i,r,o,s){if(n)return t.flags&256?(t.flags&=-257,i=Lu(Error(Q(422))),fl(e,t,s,i)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=i.fallback,r=t.mode,i=Ga({mode:"visible",children:i.children},r,0,null),o=Zi(o,r,s,null),o.flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,t.mode&1&&Kr(t,e.child,null,s),t.child.memoizedState=Bh(s),t.memoizedState=Oh,o);if(!(t.mode&1))return fl(e,t,s,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var l=i.dgst;return i=l,o=Error(Q(419)),i=Lu(o,i,void 0),fl(e,t,s,i)}if(l=(s&e.childLanes)!==0,qt||l){if(i=kt,i!==null){switch(s&-s){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|s)?0:r,r!==0&&r!==o.retryLane&&(o.retryLane=r,Jn(e,r),Rn(i,e,r,-1))}return Fd(),i=Lu(Error(Q(421))),fl(e,t,s,i)}return r.data==="$?"?(t.flags|=128,t.child=e.child,t=uS.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,rn=Si(r.nextSibling),sn=t,je=!0,Pn=null,e!==null&&(pn[fn++]=Gn,pn[fn++]=Xn,pn[fn++]=ir,Gn=e.id,Xn=e.overflow,ir=t),t=Nd(t,i.children),t.flags|=4096,t)}function Ef(e,t,n){e.lanes|=t;var i=e.alternate;i!==null&&(i.lanes|=t),Th(e.return,t,n)}function Fu(e,t,n,i,r){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function lw(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if($t(e,t,i.children,n),i=Je.current,i&2)i=i&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Ef(e,n,t);else if(e.tag===19)Ef(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Ue(Je,i),!(t.mode&1))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;n!==null;)e=n.alternate,e!==null&&da(e)===null&&(r=n),n=n.sibling;n=r,n===null?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Fu(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;r!==null;){if(e=r.alternate,e!==null&&da(e)===null){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Fu(t,!0,n,null,o);break;case"together":Fu(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ml(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function ei(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),or|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Q(153));if(t.child!==null){for(e=t.child,n=Pi(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=Pi(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function Qb(e,t,n){switch(t.tag){case 3:ow(t),qr();break;case 5:Fv(t);break;case 1:Qt(t.type)&&sa(t);break;case 4:yd(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Ue(ua,i._currentValue),i._currentValue=r;break;case 13:if(i=t.memoizedState,i!==null)return i.dehydrated!==null?(Ue(Je,Je.current&1),t.flags|=128,null):n&t.child.childLanes?sw(e,t,n):(Ue(Je,Je.current&1),e=ei(e,t,n),e!==null?e.sibling:null);Ue(Je,Je.current&1);break;case 19:if(i=(n&t.childLanes)!==0,e.flags&128){if(i)return lw(e,t,n);t.flags|=128}if(r=t.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Ue(Je,Je.current),i)break;return null;case 22:case 23:return t.lanes=0,iw(e,t,n)}return ei(e,t,n)}var aw,_h,uw,hw;aw=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};_h=function(){};uw=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,Yi(Vn.current);var o=null;switch(n){case"input":r=rh(e,r),i=rh(e,i),o=[];break;case"select":r=nt({},r,{value:void 0}),i=nt({},i,{value:void 0}),o=[];break;case"textarea":r=lh(e,r),i=lh(e,i),o=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(e.onclick=ra)}uh(n,i);var s;n=null;for(u in r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var l=r[u];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(us.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in i){var a=i[u];if(l=r!=null?r[u]:void 0,i.hasOwnProperty(u)&&a!==l&&(a!=null||l!=null))if(u==="style")if(l){for(s in l)!l.hasOwnProperty(s)||a&&a.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in a)a.hasOwnProperty(s)&&l[s]!==a[s]&&(n||(n={}),n[s]=a[s])}else n||(o||(o=[]),o.push(u,n)),n=a;else u==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,l=l?l.__html:void 0,a!=null&&l!==a&&(o=o||[]).push(u,a)):u==="children"?typeof a!="string"&&typeof a!="number"||(o=o||[]).push(u,""+a):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(us.hasOwnProperty(u)?(a!=null&&u==="onScroll"&&He("scroll",e),o||l===a||(o=[])):(o=o||[]).push(u,a))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}};hw=function(e,t,n,i){n!==i&&(t.flags|=4)};function Co(e,t){if(!je)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:i.sibling=null}}function At(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=e,r=r.sibling;else for(r=e.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Zb(e,t,n){var i=t.pendingProps;switch(dd(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return At(t),null;case 1:return Qt(t.type)&&oa(),At(t),null;case 3:return i=t.stateNode,Qr(),We(Kt),We(zt),bd(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(dl(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Pn!==null&&(Wh(Pn),Pn=null))),_h(e,t),At(t),null;case 5:xd(t);var r=Yi(bs.current);if(n=t.type,e!==null&&t.stateNode!=null)uw(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(t.stateNode===null)throw Error(Q(166));return At(t),null}if(e=Yi(Vn.current),dl(t)){i=t.stateNode,n=t.type;var o=t.memoizedProps;switch(i[zn]=t,i[ys]=o,e=(t.mode&1)!==0,n){case"dialog":He("cancel",i),He("close",i);break;case"iframe":case"object":case"embed":He("load",i);break;case"video":case"audio":for(r=0;r<Fo.length;r++)He(Fo[r],i);break;case"source":He("error",i);break;case"img":case"image":case"link":He("error",i),He("load",i);break;case"details":He("toggle",i);break;case"input":Fp(i,o),He("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},He("invalid",i);break;case"textarea":Bp(i,o),He("invalid",i)}uh(n,o),r=null;for(var s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="children"?typeof l=="string"?i.textContent!==l&&(o.suppressHydrationWarning!==!0&&cl(i.textContent,l,e),r=["children",l]):typeof l=="number"&&i.textContent!==""+l&&(o.suppressHydrationWarning!==!0&&cl(i.textContent,l,e),r=["children",""+l]):us.hasOwnProperty(s)&&l!=null&&s==="onScroll"&&He("scroll",i)}switch(n){case"input":il(i),Op(i,o,!0);break;case"textarea":il(i),_p(i);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(i.onclick=ra)}i=r,t.updateQueue=i,i!==null&&(t.flags|=4)}else{s=r.nodeType===9?r:r.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=zm(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=s.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof i.is=="string"?e=s.createElement(n,{is:i.is}):(e=s.createElement(n),n==="select"&&(s=e,i.multiple?s.multiple=!0:i.size&&(s.size=i.size))):e=s.createElementNS(e,n),e[zn]=t,e[ys]=i,aw(e,t,!1,!1),t.stateNode=e;e:{switch(s=hh(n,i),n){case"dialog":He("cancel",e),He("close",e),r=i;break;case"iframe":case"object":case"embed":He("load",e),r=i;break;case"video":case"audio":for(r=0;r<Fo.length;r++)He(Fo[r],e);r=i;break;case"source":He("error",e),r=i;break;case"img":case"image":case"link":He("error",e),He("load",e),r=i;break;case"details":He("toggle",e),r=i;break;case"input":Fp(e,i),r=rh(e,i),He("invalid",e);break;case"option":r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=nt({},i,{value:void 0}),He("invalid",e);break;case"textarea":Bp(e,i),r=lh(e,i),He("invalid",e);break;default:r=i}uh(n,r),l=r;for(o in l)if(l.hasOwnProperty(o)){var a=l[o];o==="style"?Vm(e,a):o==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&$m(e,a)):o==="children"?typeof a=="string"?(n!=="textarea"||a!=="")&&hs(e,a):typeof a=="number"&&hs(e,""+a):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(us.hasOwnProperty(o)?a!=null&&o==="onScroll"&&He("scroll",e):a!=null&&Qc(e,o,a,s))}switch(n){case"input":il(e),Op(e,i,!1);break;case"textarea":il(e),_p(e);break;case"option":i.value!=null&&e.setAttribute("value",""+Ii(i.value));break;case"select":e.multiple=!!i.multiple,o=i.value,o!=null?Mr(e,!!i.multiple,o,!1):i.defaultValue!=null&&Mr(e,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(e.onclick=ra)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return At(t),null;case 6:if(e&&t.stateNode!=null)hw(e,t,e.memoizedProps,i);else{if(typeof i!="string"&&t.stateNode===null)throw Error(Q(166));if(n=Yi(bs.current),Yi(Vn.current),dl(t)){if(i=t.stateNode,n=t.memoizedProps,i[zn]=t,(o=i.nodeValue!==n)&&(e=sn,e!==null))switch(e.tag){case 3:cl(i.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&cl(i.nodeValue,n,(e.mode&1)!==0)}o&&(t.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[zn]=t,t.stateNode=i}return At(t),null;case 13:if(We(Je),i=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(je&&rn!==null&&t.mode&1&&!(t.flags&128))Tv(),qr(),t.flags|=98560,o=!1;else if(o=dl(t),i!==null&&i.dehydrated!==null){if(e===null){if(!o)throw Error(Q(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Q(317));o[zn]=t}else qr(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;At(t),o=!1}else Pn!==null&&(Wh(Pn),Pn=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(i=i!==null,i!==(e!==null&&e.memoizedState!==null)&&i&&(t.child.flags|=8192,t.mode&1&&(e===null||Je.current&1?bt===0&&(bt=3):Fd())),t.updateQueue!==null&&(t.flags|=4),At(t),null);case 4:return Qr(),_h(e,t),e===null&&vs(t.stateNode.containerInfo),At(t),null;case 10:return md(t.type._context),At(t),null;case 17:return Qt(t.type)&&oa(),At(t),null;case 19:if(We(Je),o=t.memoizedState,o===null)return At(t),null;if(i=(t.flags&128)!==0,s=o.rendering,s===null)if(i)Co(o,!1);else{if(bt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(s=da(e),s!==null){for(t.flags|=128,Co(o,!1),i=s.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;n!==null;)o=n,e=i,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,e=s.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ue(Je,Je.current&1|2),t.child}e=e.sibling}o.tail!==null&&ct()>Jr&&(t.flags|=128,i=!0,Co(o,!1),t.lanes=4194304)}else{if(!i)if(e=da(s),e!==null){if(t.flags|=128,i=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Co(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!je)return At(t),null}else 2*ct()-o.renderingStartTime>Jr&&n!==1073741824&&(t.flags|=128,i=!0,Co(o,!1),t.lanes=4194304);o.isBackwards?(s.sibling=t.child,t.child=s):(n=o.last,n!==null?n.sibling=s:t.child=s,o.last=s)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=ct(),t.sibling=null,n=Je.current,Ue(Je,i?n&1|2:n&1),t):(At(t),null);case 22:case 23:return Ld(),i=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==i&&(t.flags|=8192),i&&t.mode&1?nn&1073741824&&(At(t),t.subtreeFlags&6&&(t.flags|=8192)):At(t),null;case 24:return null;case 25:return null}throw Error(Q(156,t.tag))}function Jb(e,t){switch(dd(t),t.tag){case 1:return Qt(t.type)&&oa(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Qr(),We(Kt),We(zt),bd(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return xd(t),null;case 13:if(We(Je),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Q(340));qr()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return We(Je),null;case 4:return Qr(),null;case 10:return md(t.type._context),null;case 22:case 23:return Ld(),null;case 24:return null;default:return null}}var gl=!1,_t=!1,eS=typeof WeakSet=="function"?WeakSet:Set,oe=null;function Ir(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){ot(e,t,i)}else n.current=null}function Mh(e,t,n){try{n()}catch(i){ot(e,t,i)}}var Pf=!1;function tS(e,t){if(xh=ta,e=gv(),hd(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var s=0,l=-1,a=-1,u=0,h=0,p=e,c=null;t:for(;;){for(var f;p!==n||r!==0&&p.nodeType!==3||(l=s+r),p!==o||i!==0&&p.nodeType!==3||(a=s+i),p.nodeType===3&&(s+=p.nodeValue.length),(f=p.firstChild)!==null;)c=p,p=f;for(;;){if(p===e)break t;if(c===n&&++u===r&&(l=s),c===o&&++h===i&&(a=s),(f=p.nextSibling)!==null)break;p=c,c=p.parentNode}p=f}n=l===-1||a===-1?null:{start:l,end:a}}else n=null}n=n||{start:0,end:0}}else n=null;for(bh={focusedElem:e,selectionRange:n},ta=!1,oe=t;oe!==null;)if(t=oe,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,oe=e;else for(;oe!==null;){t=oe;try{var v=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var w=v.memoizedProps,x=v.memoizedState,g=t.stateNode,m=g.getSnapshotBeforeUpdate(t.elementType===t.type?w:kn(t.type,w),x);g.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var y=t.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Q(163))}}catch(C){ot(t,t.return,C)}if(e=t.sibling,e!==null){e.return=t.return,oe=e;break}oe=t.return}return v=Pf,Pf=!1,v}function Yo(e,t,n){var i=t.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,o!==void 0&&Mh(t,n,o)}r=r.next}while(r!==i)}}function Wa(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function zh(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function cw(e){var t=e.alternate;t!==null&&(e.alternate=null,cw(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[zn],delete t[ys],delete t[kh],delete t[Mb],delete t[zb])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function dw(e){return e.tag===5||e.tag===3||e.tag===4}function Nf(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||dw(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function $h(e,t,n){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=ra));else if(i!==4&&(e=e.child,e!==null))for($h(e,t,n),e=e.sibling;e!==null;)$h(e,t,n),e=e.sibling}function Dh(e,t,n){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(i!==4&&(e=e.child,e!==null))for(Dh(e,t,n),e=e.sibling;e!==null;)Dh(e,t,n),e=e.sibling}var Pt=null,En=!1;function ai(e,t,n){for(n=n.child;n!==null;)pw(e,t,n),n=n.sibling}function pw(e,t,n){if(Dn&&typeof Dn.onCommitFiberUnmount=="function")try{Dn.onCommitFiberUnmount(_a,n)}catch{}switch(n.tag){case 5:_t||Ir(n,t);case 6:var i=Pt,r=En;Pt=null,ai(e,t,n),Pt=i,En=r,Pt!==null&&(En?(e=Pt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Pt.removeChild(n.stateNode));break;case 18:Pt!==null&&(En?(e=Pt,n=n.stateNode,e.nodeType===8?Pu(e.parentNode,n):e.nodeType===1&&Pu(e,n),fs(e)):Pu(Pt,n.stateNode));break;case 4:i=Pt,r=En,Pt=n.stateNode.containerInfo,En=!0,ai(e,t,n),Pt=i,En=r;break;case 0:case 11:case 14:case 15:if(!_t&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var o=r,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&Mh(n,t,s),r=r.next}while(r!==i)}ai(e,t,n);break;case 1:if(!_t&&(Ir(n,t),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(l){ot(n,t,l)}ai(e,t,n);break;case 21:ai(e,t,n);break;case 22:n.mode&1?(_t=(i=_t)||n.memoizedState!==null,ai(e,t,n),_t=i):ai(e,t,n);break;default:ai(e,t,n)}}function Tf(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new eS),t.forEach(function(i){var r=hS.bind(null,e,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Cn(e,t){var n=t.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var o=e,s=t,l=s;e:for(;l!==null;){switch(l.tag){case 5:Pt=l.stateNode,En=!1;break e;case 3:Pt=l.stateNode.containerInfo,En=!0;break e;case 4:Pt=l.stateNode.containerInfo,En=!0;break e}l=l.return}if(Pt===null)throw Error(Q(160));pw(o,s,r),Pt=null,En=!1;var a=r.alternate;a!==null&&(a.return=null),r.return=null}catch(u){ot(r,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)fw(t,e),t=t.sibling}function fw(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Cn(t,e),On(e),i&4){try{Yo(3,e,e.return),Wa(3,e)}catch(w){ot(e,e.return,w)}try{Yo(5,e,e.return)}catch(w){ot(e,e.return,w)}}break;case 1:Cn(t,e),On(e),i&512&&n!==null&&Ir(n,n.return);break;case 5:if(Cn(t,e),On(e),i&512&&n!==null&&Ir(n,n.return),e.flags&32){var r=e.stateNode;try{hs(r,"")}catch(w){ot(e,e.return,w)}}if(i&4&&(r=e.stateNode,r!=null)){var o=e.memoizedProps,s=n!==null?n.memoizedProps:o,l=e.type,a=e.updateQueue;if(e.updateQueue=null,a!==null)try{l==="input"&&o.type==="radio"&&o.name!=null&&_m(r,o),hh(l,s);var u=hh(l,o);for(s=0;s<a.length;s+=2){var h=a[s],p=a[s+1];h==="style"?Vm(r,p):h==="dangerouslySetInnerHTML"?$m(r,p):h==="children"?hs(r,p):Qc(r,h,p,u)}switch(l){case"input":oh(r,o);break;case"textarea":Mm(r,o);break;case"select":var c=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var f=o.value;f!=null?Mr(r,!!o.multiple,f,!1):c!==!!o.multiple&&(o.defaultValue!=null?Mr(r,!!o.multiple,o.defaultValue,!0):Mr(r,!!o.multiple,o.multiple?[]:"",!1))}r[ys]=o}catch(w){ot(e,e.return,w)}}break;case 6:if(Cn(t,e),On(e),i&4){if(e.stateNode===null)throw Error(Q(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(w){ot(e,e.return,w)}}break;case 3:if(Cn(t,e),On(e),i&4&&n!==null&&n.memoizedState.isDehydrated)try{fs(t.containerInfo)}catch(w){ot(e,e.return,w)}break;case 4:Cn(t,e),On(e);break;case 13:Cn(t,e),On(e),r=e.child,r.flags&8192&&(o=r.memoizedState!==null,r.stateNode.isHidden=o,!o||r.alternate!==null&&r.alternate.memoizedState!==null||(Rd=ct())),i&4&&Tf(e);break;case 22:if(h=n!==null&&n.memoizedState!==null,e.mode&1?(_t=(u=_t)||h,Cn(t,e),_t=u):Cn(t,e),On(e),i&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!h&&e.mode&1)for(oe=e,h=e.child;h!==null;){for(p=oe=h;oe!==null;){switch(c=oe,f=c.child,c.tag){case 0:case 11:case 14:case 15:Yo(4,c,c.return);break;case 1:Ir(c,c.return);var v=c.stateNode;if(typeof v.componentWillUnmount=="function"){i=c,n=c.return;try{t=i,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(w){ot(i,n,w)}}break;case 5:Ir(c,c.return);break;case 22:if(c.memoizedState!==null){Rf(p);continue}}f!==null?(f.return=c,oe=f):Rf(p)}h=h.sibling}e:for(h=null,p=e;;){if(p.tag===5){if(h===null){h=p;try{r=p.stateNode,u?(o=r.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(l=p.stateNode,a=p.memoizedProps.style,s=a!=null&&a.hasOwnProperty("display")?a.display:null,l.style.display=Dm("display",s))}catch(w){ot(e,e.return,w)}}}else if(p.tag===6){if(h===null)try{p.stateNode.nodeValue=u?"":p.memoizedProps}catch(w){ot(e,e.return,w)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===e)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===e)break e;for(;p.sibling===null;){if(p.return===null||p.return===e)break e;h===p&&(h=null),p=p.return}h===p&&(h=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:Cn(t,e),On(e),i&4&&Tf(e);break;case 21:break;default:Cn(t,e),On(e)}}function On(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(dw(n)){var i=n;break e}n=n.return}throw Error(Q(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(hs(r,""),i.flags&=-33);var o=Nf(e);Dh(e,o,r);break;case 3:case 4:var s=i.stateNode.containerInfo,l=Nf(e);$h(e,l,s);break;default:throw Error(Q(161))}}catch(a){ot(e,e.return,a)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function nS(e,t,n){oe=e,gw(e)}function gw(e,t,n){for(var i=(e.mode&1)!==0;oe!==null;){var r=oe,o=r.child;if(r.tag===22&&i){var s=r.memoizedState!==null||gl;if(!s){var l=r.alternate,a=l!==null&&l.memoizedState!==null||_t;l=gl;var u=_t;if(gl=s,(_t=a)&&!u)for(oe=r;oe!==null;)s=oe,a=s.child,s.tag===22&&s.memoizedState!==null?Af(r):a!==null?(a.return=s,oe=a):Af(r);for(;o!==null;)oe=o,gw(o),o=o.sibling;oe=r,gl=l,_t=u}If(e)}else r.subtreeFlags&8772&&o!==null?(o.return=r,oe=o):If(e)}}function If(e){for(;oe!==null;){var t=oe;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:_t||Wa(5,t);break;case 1:var i=t.stateNode;if(t.flags&4&&!_t)if(n===null)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:kn(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&pf(t,o,i);break;case 3:var s=t.updateQueue;if(s!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}pf(t,s,n)}break;case 5:var l=t.stateNode;if(n===null&&t.flags&4){n=l;var a=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&n.focus();break;case"img":a.src&&(n.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var p=h.dehydrated;p!==null&&fs(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Q(163))}_t||t.flags&512&&zh(t)}catch(c){ot(t,t.return,c)}}if(t===e){oe=null;break}if(n=t.sibling,n!==null){n.return=t.return,oe=n;break}oe=t.return}}function Rf(e){for(;oe!==null;){var t=oe;if(t===e){oe=null;break}var n=t.sibling;if(n!==null){n.return=t.return,oe=n;break}oe=t.return}}function Af(e){for(;oe!==null;){var t=oe;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Wa(4,t)}catch(a){ot(t,n,a)}break;case 1:var i=t.stateNode;if(typeof i.componentDidMount=="function"){var r=t.return;try{i.componentDidMount()}catch(a){ot(t,r,a)}}var o=t.return;try{zh(t)}catch(a){ot(t,o,a)}break;case 5:var s=t.return;try{zh(t)}catch(a){ot(t,s,a)}}}catch(a){ot(t,t.return,a)}if(t===e){oe=null;break}var l=t.sibling;if(l!==null){l.return=t.return,oe=l;break}oe=t.return}}var iS=Math.ceil,ga=si.ReactCurrentDispatcher,Td=si.ReactCurrentOwner,vn=si.ReactCurrentBatchConfig,Le=0,kt=null,wt=null,Nt=0,nn=0,Rr=Mi(0),bt=0,Es=null,or=0,ja=0,Id=0,qo=null,Gt=null,Rd=0,Jr=1/0,Hn=null,ma=!1,Vh=null,ki=null,ml=!1,gi=null,va=0,Ko=0,Uh=null,zl=-1,$l=0;function Ut(){return Le&6?ct():zl!==-1?zl:zl=ct()}function Ei(e){return e.mode&1?Le&2&&Nt!==0?Nt&-Nt:Db.transition!==null?($l===0&&($l=Jm()),$l):(e=_e,e!==0||(e=window.event,e=e===void 0?16:sv(e.type)),e):1}function Rn(e,t,n,i){if(50<Ko)throw Ko=0,Uh=null,Error(Q(185));$s(e,n,i),(!(Le&2)||e!==kt)&&(e===kt&&(!(Le&2)&&(ja|=n),bt===4&&pi(e,Nt)),Zt(e,i),n===1&&Le===0&&!(t.mode&1)&&(Jr=ct()+500,Va&&zi()))}function Zt(e,t){var n=e.callbackNode;D1(e,t);var i=ea(e,e===kt?Nt:0);if(i===0)n!==null&&$p(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(n!=null&&$p(n),t===1)e.tag===0?$b(Lf.bind(null,e)):Ev(Lf.bind(null,e)),Bb(function(){!(Le&6)&&zi()}),n=null;else{switch(ev(i)){case 1:n=nd;break;case 4:n=Qm;break;case 16:n=Jl;break;case 536870912:n=Zm;break;default:n=Jl}n=Cw(n,mw.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function mw(e,t){if(zl=-1,$l=0,Le&6)throw Error(Q(327));var n=e.callbackNode;if(Ur()&&e.callbackNode!==n)return null;var i=ea(e,e===kt?Nt:0);if(i===0)return null;if(i&30||i&e.expiredLanes||t)t=wa(e,i);else{t=i;var r=Le;Le|=2;var o=ww();(kt!==e||Nt!==t)&&(Hn=null,Jr=ct()+500,Qi(e,t));do try{sS();break}catch(l){vw(e,l)}while(!0);gd(),ga.current=o,Le=r,wt!==null?t=0:(kt=null,Nt=0,t=bt)}if(t!==0){if(t===2&&(r=gh(e),r!==0&&(i=r,t=Hh(e,r))),t===1)throw n=Es,Qi(e,0),pi(e,i),Zt(e,ct()),n;if(t===6)pi(e,i);else{if(r=e.current.alternate,!(i&30)&&!rS(r)&&(t=wa(e,i),t===2&&(o=gh(e),o!==0&&(i=o,t=Hh(e,o))),t===1))throw n=Es,Qi(e,0),pi(e,i),Zt(e,ct()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(Q(345));case 2:Wi(e,Gt,Hn);break;case 3:if(pi(e,i),(i&130023424)===i&&(t=Rd+500-ct(),10<t)){if(ea(e,0)!==0)break;if(r=e.suspendedLanes,(r&i)!==i){Ut(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=Ch(Wi.bind(null,e,Gt,Hn),t);break}Wi(e,Gt,Hn);break;case 4:if(pi(e,i),(i&4194240)===i)break;for(t=e.eventTimes,r=-1;0<i;){var s=31-In(i);o=1<<s,s=t[s],s>r&&(r=s),i&=~o}if(i=r,i=ct()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*iS(i/1960))-i,10<i){e.timeoutHandle=Ch(Wi.bind(null,e,Gt,Hn),i);break}Wi(e,Gt,Hn);break;case 5:Wi(e,Gt,Hn);break;default:throw Error(Q(329))}}}return Zt(e,ct()),e.callbackNode===n?mw.bind(null,e):null}function Hh(e,t){var n=qo;return e.current.memoizedState.isDehydrated&&(Qi(e,t).flags|=256),e=wa(e,t),e!==2&&(t=Gt,Gt=n,t!==null&&Wh(t)),e}function Wh(e){Gt===null?Gt=e:Gt.push.apply(Gt,e)}function rS(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!Ln(o(),r))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function pi(e,t){for(t&=~Id,t&=~ja,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-In(t),i=1<<n;e[n]=-1,t&=~i}}function Lf(e){if(Le&6)throw Error(Q(327));Ur();var t=ea(e,0);if(!(t&1))return Zt(e,ct()),null;var n=wa(e,t);if(e.tag!==0&&n===2){var i=gh(e);i!==0&&(t=i,n=Hh(e,i))}if(n===1)throw n=Es,Qi(e,0),pi(e,t),Zt(e,ct()),n;if(n===6)throw Error(Q(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Wi(e,Gt,Hn),Zt(e,ct()),null}function Ad(e,t){var n=Le;Le|=1;try{return e(t)}finally{Le=n,Le===0&&(Jr=ct()+500,Va&&zi())}}function sr(e){gi!==null&&gi.tag===0&&!(Le&6)&&Ur();var t=Le;Le|=1;var n=vn.transition,i=_e;try{if(vn.transition=null,_e=1,e)return e()}finally{_e=i,vn.transition=n,Le=t,!(Le&6)&&zi()}}function Ld(){nn=Rr.current,We(Rr)}function Qi(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Ob(n)),wt!==null)for(n=wt.return;n!==null;){var i=n;switch(dd(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&oa();break;case 3:Qr(),We(Kt),We(zt),bd();break;case 5:xd(i);break;case 4:Qr();break;case 13:We(Je);break;case 19:We(Je);break;case 10:md(i.type._context);break;case 22:case 23:Ld()}n=n.return}if(kt=e,wt=e=Pi(e.current,null),Nt=nn=t,bt=0,Es=null,Id=ja=or=0,Gt=qo=null,Xi!==null){for(t=0;t<Xi.length;t++)if(n=Xi[t],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,o=n.pending;if(o!==null){var s=o.next;o.next=r,i.next=s}n.pending=i}Xi=null}return e}function vw(e,t){do{var n=wt;try{if(gd(),Bl.current=fa,pa){for(var i=tt.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}pa=!1}if(rr=0,Ct=yt=tt=null,Xo=!1,Ss=0,Td.current=null,n===null||n.return===null){bt=1,Es=t,wt=null;break}e:{var o=e,s=n.return,l=n,a=t;if(t=Nt,l.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var u=a,h=l,p=h.tag;if(!(h.mode&1)&&(p===0||p===11||p===15)){var c=h.alternate;c?(h.updateQueue=c.updateQueue,h.memoizedState=c.memoizedState,h.lanes=c.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=yf(s);if(f!==null){f.flags&=-257,xf(f,s,l,o,t),f.mode&1&&wf(o,u,t),t=f,a=u;var v=t.updateQueue;if(v===null){var w=new Set;w.add(a),t.updateQueue=w}else v.add(a);break e}else{if(!(t&1)){wf(o,u,t),Fd();break e}a=Error(Q(426))}}else if(je&&l.mode&1){var x=yf(s);if(x!==null){!(x.flags&65536)&&(x.flags|=256),xf(x,s,l,o,t),pd(Zr(a,l));break e}}o=a=Zr(a,l),bt!==4&&(bt=2),qo===null?qo=[o]:qo.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var g=ew(o,a,t);df(o,g);break e;case 1:l=a;var m=o.type,y=o.stateNode;if(!(o.flags&128)&&(typeof m.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(ki===null||!ki.has(y)))){o.flags|=65536,t&=-t,o.lanes|=t;var C=tw(o,l,t);df(o,C);break e}}o=o.return}while(o!==null)}xw(n)}catch(P){t=P,wt===n&&n!==null&&(wt=n=n.return);continue}break}while(!0)}function ww(){var e=ga.current;return ga.current=fa,e===null?fa:e}function Fd(){(bt===0||bt===3||bt===2)&&(bt=4),kt===null||!(or&268435455)&&!(ja&268435455)||pi(kt,Nt)}function wa(e,t){var n=Le;Le|=2;var i=ww();(kt!==e||Nt!==t)&&(Hn=null,Qi(e,t));do try{oS();break}catch(r){vw(e,r)}while(!0);if(gd(),Le=n,ga.current=i,wt!==null)throw Error(Q(261));return kt=null,Nt=0,bt}function oS(){for(;wt!==null;)yw(wt)}function sS(){for(;wt!==null&&!A1();)yw(wt)}function yw(e){var t=Sw(e.alternate,e,nn);e.memoizedProps=e.pendingProps,t===null?xw(e):wt=t,Td.current=null}function xw(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=Jb(n,t),n!==null){n.flags&=32767,wt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{bt=6,wt=null;return}}else if(n=Zb(n,t,nn),n!==null){wt=n;return}if(t=t.sibling,t!==null){wt=t;return}wt=t=e}while(t!==null);bt===0&&(bt=5)}function Wi(e,t,n){var i=_e,r=vn.transition;try{vn.transition=null,_e=1,lS(e,t,n,i)}finally{vn.transition=r,_e=i}return null}function lS(e,t,n,i){do Ur();while(gi!==null);if(Le&6)throw Error(Q(327));n=e.finishedWork;var r=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(Q(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(V1(e,o),e===kt&&(wt=kt=null,Nt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||ml||(ml=!0,Cw(Jl,function(){return Ur(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=vn.transition,vn.transition=null;var s=_e;_e=1;var l=Le;Le|=4,Td.current=null,tS(e,n),fw(n,e),Nb(bh),ta=!!xh,bh=xh=null,e.current=n,nS(n),L1(),Le=l,_e=s,vn.transition=o}else e.current=n;if(ml&&(ml=!1,gi=e,va=r),o=e.pendingLanes,o===0&&(ki=null),B1(n.stateNode),Zt(e,ct()),t!==null)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(ma)throw ma=!1,e=Vh,Vh=null,e;return va&1&&e.tag!==0&&Ur(),o=e.pendingLanes,o&1?e===Uh?Ko++:(Ko=0,Uh=e):Ko=0,zi(),null}function Ur(){if(gi!==null){var e=ev(va),t=vn.transition,n=_e;try{if(vn.transition=null,_e=16>e?16:e,gi===null)var i=!1;else{if(e=gi,gi=null,va=0,Le&6)throw Error(Q(331));var r=Le;for(Le|=4,oe=e.current;oe!==null;){var o=oe,s=o.child;if(oe.flags&16){var l=o.deletions;if(l!==null){for(var a=0;a<l.length;a++){var u=l[a];for(oe=u;oe!==null;){var h=oe;switch(h.tag){case 0:case 11:case 15:Yo(8,h,o)}var p=h.child;if(p!==null)p.return=h,oe=p;else for(;oe!==null;){h=oe;var c=h.sibling,f=h.return;if(cw(h),h===u){oe=null;break}if(c!==null){c.return=f,oe=c;break}oe=f}}}var v=o.alternate;if(v!==null){var w=v.child;if(w!==null){v.child=null;do{var x=w.sibling;w.sibling=null,w=x}while(w!==null)}}oe=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,oe=s;else e:for(;oe!==null;){if(o=oe,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Yo(9,o,o.return)}var g=o.sibling;if(g!==null){g.return=o.return,oe=g;break e}oe=o.return}}var m=e.current;for(oe=m;oe!==null;){s=oe;var y=s.child;if(s.subtreeFlags&2064&&y!==null)y.return=s,oe=y;else e:for(s=m;oe!==null;){if(l=oe,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Wa(9,l)}}catch(P){ot(l,l.return,P)}if(l===s){oe=null;break e}var C=l.sibling;if(C!==null){C.return=l.return,oe=C;break e}oe=l.return}}if(Le=r,zi(),Dn&&typeof Dn.onPostCommitFiberRoot=="function")try{Dn.onPostCommitFiberRoot(_a,e)}catch{}i=!0}return i}finally{_e=n,vn.transition=t}}return!1}function Ff(e,t,n){t=Zr(n,t),t=ew(e,t,1),e=Ci(e,t,1),t=Ut(),e!==null&&($s(e,1,t),Zt(e,t))}function ot(e,t,n){if(e.tag===3)Ff(e,e,n);else for(;t!==null;){if(t.tag===3){Ff(t,e,n);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(ki===null||!ki.has(i))){e=Zr(n,e),e=tw(t,e,1),t=Ci(t,e,1),e=Ut(),t!==null&&($s(t,1,e),Zt(t,e));break}}t=t.return}}function aS(e,t,n){var i=e.pingCache;i!==null&&i.delete(t),t=Ut(),e.pingedLanes|=e.suspendedLanes&n,kt===e&&(Nt&n)===n&&(bt===4||bt===3&&(Nt&130023424)===Nt&&500>ct()-Rd?Qi(e,0):Id|=n),Zt(e,t)}function bw(e,t){t===0&&(e.mode&1?(t=sl,sl<<=1,!(sl&130023424)&&(sl=4194304)):t=1);var n=Ut();e=Jn(e,t),e!==null&&($s(e,t,n),Zt(e,n))}function uS(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),bw(e,n)}function hS(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(Q(314))}i!==null&&i.delete(t),bw(e,n)}var Sw;Sw=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Kt.current)qt=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return qt=!1,Qb(e,t,n);qt=!!(e.flags&131072)}else qt=!1,je&&t.flags&1048576&&Pv(t,aa,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Ml(e,t),e=t.pendingProps;var r=Yr(t,zt.current);Vr(t,n),r=Cd(null,t,i,e,r,n);var o=kd();return t.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Qt(i)?(o=!0,sa(t)):o=!1,t.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,wd(t),r.updater=Ha,t.stateNode=r,r._reactInternals=t,Rh(t,i,e,n),t=Fh(null,t,i,!0,o,n)):(t.tag=0,je&&o&&cd(t),$t(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Ml(e,t),e=t.pendingProps,r=i._init,i=r(i._payload),t.type=i,r=t.tag=dS(i),e=kn(i,e),r){case 0:t=Lh(null,t,i,e,n);break e;case 1:t=Cf(null,t,i,e,n);break e;case 11:t=bf(null,t,i,e,n);break e;case 14:t=Sf(null,t,i,kn(i.type,e),n);break e}throw Error(Q(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:kn(i,r),Lh(e,t,i,r,n);case 1:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:kn(i,r),Cf(e,t,i,r,n);case 3:e:{if(ow(t),e===null)throw Error(Q(387));i=t.pendingProps,o=t.memoizedState,r=o.element,Lv(e,t),ca(t,i,null,n);var s=t.memoizedState;if(i=s.element,o.isDehydrated)if(o={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){r=Zr(Error(Q(423)),t),t=kf(e,t,i,n,r);break e}else if(i!==r){r=Zr(Error(Q(424)),t),t=kf(e,t,i,n,r);break e}else for(rn=Si(t.stateNode.containerInfo.firstChild),sn=t,je=!0,Pn=null,n=Rv(t,null,i,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(qr(),i===r){t=ei(e,t,n);break e}$t(e,t,i,n)}t=t.child}return t;case 5:return Fv(t),e===null&&Nh(t),i=t.type,r=t.pendingProps,o=e!==null?e.memoizedProps:null,s=r.children,Sh(i,r)?s=null:o!==null&&Sh(i,o)&&(t.flags|=32),rw(e,t),$t(e,t,s,n),t.child;case 6:return e===null&&Nh(t),null;case 13:return sw(e,t,n);case 4:return yd(t,t.stateNode.containerInfo),i=t.pendingProps,e===null?t.child=Kr(t,null,i,n):$t(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:kn(i,r),bf(e,t,i,r,n);case 7:return $t(e,t,t.pendingProps,n),t.child;case 8:return $t(e,t,t.pendingProps.children,n),t.child;case 12:return $t(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,o=t.memoizedProps,s=r.value,Ue(ua,i._currentValue),i._currentValue=s,o!==null)if(Ln(o.value,s)){if(o.children===r.children&&!Kt.current){t=ei(e,t,n);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var l=o.dependencies;if(l!==null){s=o.child;for(var a=l.firstContext;a!==null;){if(a.context===i){if(o.tag===1){a=Kn(-1,n&-n),a.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?a.next=a:(a.next=h.next,h.next=a),u.pending=a}}o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Th(o.return,n,t),l.lanes|=n;break}a=a.next}}else if(o.tag===10)s=o.type===t.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(Q(341));s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),Th(s,n,t),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===t){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}$t(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,Vr(t,n),r=yn(r),i=i(r),t.flags|=1,$t(e,t,i,n),t.child;case 14:return i=t.type,r=kn(i,t.pendingProps),r=kn(i.type,r),Sf(e,t,i,r,n);case 15:return nw(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:kn(i,r),Ml(e,t),t.tag=1,Qt(i)?(e=!0,sa(t)):e=!1,Vr(t,n),Jv(t,i,r),Rh(t,i,r,n),Fh(null,t,i,!0,e,n);case 19:return lw(e,t,n);case 22:return iw(e,t,n)}throw Error(Q(156,t.tag))};function Cw(e,t){return Km(e,t)}function cS(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gn(e,t,n,i){return new cS(e,t,n,i)}function Od(e){return e=e.prototype,!(!e||!e.isReactComponent)}function dS(e){if(typeof e=="function")return Od(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Jc)return 11;if(e===ed)return 14}return 2}function Pi(e,t){var n=e.alternate;return n===null?(n=gn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Dl(e,t,n,i,r,o){var s=2;if(i=e,typeof e=="function")Od(e)&&(s=1);else if(typeof e=="string")s=5;else e:switch(e){case xr:return Zi(n.children,r,o,t);case Zc:s=8,r|=8;break;case eh:return e=gn(12,n,t,r|2),e.elementType=eh,e.lanes=o,e;case th:return e=gn(13,n,t,r),e.elementType=th,e.lanes=o,e;case nh:return e=gn(19,n,t,r),e.elementType=nh,e.lanes=o,e;case Fm:return Ga(n,r,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Am:s=10;break e;case Lm:s=9;break e;case Jc:s=11;break e;case ed:s=14;break e;case hi:s=16,i=null;break e}throw Error(Q(130,e==null?e:typeof e,""))}return t=gn(s,n,t,r),t.elementType=e,t.type=i,t.lanes=o,t}function Zi(e,t,n,i){return e=gn(7,e,i,t),e.lanes=n,e}function Ga(e,t,n,i){return e=gn(22,e,i,t),e.elementType=Fm,e.lanes=n,e.stateNode={isHidden:!1},e}function Ou(e,t,n){return e=gn(6,e,null,t),e.lanes=n,e}function Bu(e,t,n){return t=gn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function pS(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gu(0),this.expirationTimes=gu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gu(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Bd(e,t,n,i,r,o,s,l,a){return e=new pS(e,t,n,l,a),t===1?(t=1,o===!0&&(t|=8)):t=0,o=gn(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},wd(o),e}function fS(e,t,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:yr,key:i==null?null:""+i,children:e,containerInfo:t,implementation:n}}function kw(e){if(!e)return Ri;e=e._reactInternals;e:{if(hr(e)!==e||e.tag!==1)throw Error(Q(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Qt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Q(171))}if(e.tag===1){var n=e.type;if(Qt(n))return kv(e,n,t)}return t}function Ew(e,t,n,i,r,o,s,l,a){return e=Bd(n,i,!0,e,r,o,s,l,a),e.context=kw(null),n=e.current,i=Ut(),r=Ei(n),o=Kn(i,r),o.callback=t??null,Ci(n,o,r),e.current.lanes=r,$s(e,r,i),Zt(e,i),e}function Xa(e,t,n,i){var r=t.current,o=Ut(),s=Ei(r);return n=kw(n),t.context===null?t.context=n:t.pendingContext=n,t=Kn(o,s),t.payload={element:e},i=i===void 0?null:i,i!==null&&(t.callback=i),e=Ci(r,t,s),e!==null&&(Rn(e,r,s,o),Ol(e,r,s)),s}function ya(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Of(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function _d(e,t){Of(e,t),(e=e.alternate)&&Of(e,t)}function gS(){return null}var Pw=typeof reportError=="function"?reportError:function(e){console.error(e)};function Md(e){this._internalRoot=e}Ya.prototype.render=Md.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Q(409));Xa(e,t,null,null)};Ya.prototype.unmount=Md.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;sr(function(){Xa(null,e,null,null)}),t[Zn]=null}};function Ya(e){this._internalRoot=e}Ya.prototype.unstable_scheduleHydration=function(e){if(e){var t=iv();e={blockedOn:null,target:e,priority:t};for(var n=0;n<di.length&&t!==0&&t<di[n].priority;n++);di.splice(n,0,e),n===0&&ov(e)}};function zd(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function qa(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Bf(){}function mS(e,t,n,i,r){if(r){if(typeof i=="function"){var o=i;i=function(){var u=ya(s);o.call(u)}}var s=Ew(t,i,e,0,null,!1,!1,"",Bf);return e._reactRootContainer=s,e[Zn]=s.current,vs(e.nodeType===8?e.parentNode:e),sr(),s}for(;r=e.lastChild;)e.removeChild(r);if(typeof i=="function"){var l=i;i=function(){var u=ya(a);l.call(u)}}var a=Bd(e,0,!1,null,null,!1,!1,"",Bf);return e._reactRootContainer=a,e[Zn]=a.current,vs(e.nodeType===8?e.parentNode:e),sr(function(){Xa(t,a,n,i)}),a}function Ka(e,t,n,i,r){var o=n._reactRootContainer;if(o){var s=o;if(typeof r=="function"){var l=r;r=function(){var a=ya(s);l.call(a)}}Xa(t,s,e,r)}else s=mS(n,t,e,r,i);return ya(s)}tv=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Lo(t.pendingLanes);n!==0&&(id(t,n|1),Zt(t,ct()),!(Le&6)&&(Jr=ct()+500,zi()))}break;case 13:sr(function(){var i=Jn(e,1);if(i!==null){var r=Ut();Rn(i,e,1,r)}}),_d(e,1)}};rd=function(e){if(e.tag===13){var t=Jn(e,134217728);if(t!==null){var n=Ut();Rn(t,e,134217728,n)}_d(e,134217728)}};nv=function(e){if(e.tag===13){var t=Ei(e),n=Jn(e,t);if(n!==null){var i=Ut();Rn(n,e,t,i)}_d(e,t)}};iv=function(){return _e};rv=function(e,t){var n=_e;try{return _e=e,t()}finally{_e=n}};dh=function(e,t,n){switch(t){case"input":if(oh(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=Da(i);if(!r)throw Error(Q(90));Bm(i),oh(i,r)}}}break;case"textarea":Mm(e,n);break;case"select":t=n.value,t!=null&&Mr(e,!!n.multiple,t,!1)}};Wm=Ad;jm=sr;var vS={usingClientEntryPoint:!1,Events:[Vs,kr,Da,Um,Hm,Ad]},ko={findFiberByHostInstance:Gi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},wS={bundleType:ko.bundleType,version:ko.version,rendererPackageName:ko.rendererPackageName,rendererConfig:ko.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:si.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Ym(e),e===null?null:e.stateNode},findFiberByHostInstance:ko.findFiberByHostInstance||gS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{_a=vl.inject(wS),Dn=vl}catch{}}an.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vS;an.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!zd(t))throw Error(Q(200));return fS(e,t,null,n)};an.createRoot=function(e,t){if(!zd(e))throw Error(Q(299));var n=!1,i="",r=Pw;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(r=t.onRecoverableError)),t=Bd(e,1,!1,null,null,n,!1,i,r),e[Zn]=t.current,vs(e.nodeType===8?e.parentNode:e),new Md(t)};an.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Q(188)):(e=Object.keys(e).join(","),Error(Q(268,e)));return e=Ym(t),e=e===null?null:e.stateNode,e};an.flushSync=function(e){return sr(e)};an.hydrate=function(e,t,n){if(!qa(t))throw Error(Q(200));return Ka(null,e,t,!0,n)};an.hydrateRoot=function(e,t,n){if(!zd(e))throw Error(Q(405));var i=n!=null&&n.hydratedSources||null,r=!1,o="",s=Pw;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),t=Ew(t,null,e,1,n??null,r,!1,o,s),e[Zn]=t.current,vs(e),i)for(e=0;e<i.length;e++)n=i[e],r=n._getVersion,r=r(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Ya(t)};an.render=function(e,t,n){if(!qa(t))throw Error(Q(200));return Ka(null,e,t,!1,n)};an.unmountComponentAtNode=function(e){if(!qa(e))throw Error(Q(40));return e._reactRootContainer?(sr(function(){Ka(null,null,e,!1,function(){e._reactRootContainer=null,e[Zn]=null})}),!0):!1};an.unstable_batchedUpdates=Ad;an.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!qa(n))throw Error(Q(200));if(e==null||e._reactInternals===void 0)throw Error(Q(38));return Ka(e,t,n,!1,i)};an.version="18.3.1-next-f1338f8080-20240426";function Nw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Nw)}catch(e){console.error(e)}}Nw(),Nm.exports=an;var Tw=Nm.exports,Iw,_f=Tw;Iw=_f.createRoot,_f.hydrateRoot;function Ps(e){"@babel/helpers - typeof";return Ps=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ps(e)}function yS(e,t){if(Ps(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t||"default");if(Ps(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function xS(e){var t=yS(e,"string");return Ps(t)=="symbol"?t:t+""}function bS(e,t,n){return(t=xS(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Rw(e){var t={};return function(n){return t[n]===void 0&&(t[n]=e(n)),t[n]}}var SS=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|inert|itemProp|itemScope|itemType|itemID|itemRef|on|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,CS=Rw(function(e){return SS.test(e)||e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)<91});function kS(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}function ES(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),e.nonce!==void 0&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t}var PS=function(){function e(n){this.isSpeedy=n.speedy===void 0?!0:n.speedy,this.tags=[],this.ctr=0,this.nonce=n.nonce,this.key=n.key,this.container=n.container,this.before=null}var t=e.prototype;return t.insert=function(i){if(this.ctr%(this.isSpeedy?65e3:1)===0){var r=ES(this),o;this.tags.length===0?o=this.before:o=this.tags[this.tags.length-1].nextSibling,this.container.insertBefore(r,o),this.tags.push(r)}var s=this.tags[this.tags.length-1];if(this.isSpeedy){var l=kS(s);try{var a=i.charCodeAt(1)===105&&i.charCodeAt(0)===64;l.insertRule(i,a?0:l.cssRules.length)}catch{}}else s.appendChild(document.createTextNode(i));this.ctr++},t.flush=function(){this.tags.forEach(function(i){return i.parentNode.removeChild(i)}),this.tags=[],this.ctr=0},e}();function NS(e){function t(L,F,D,te,N){for(var ee=0,H=0,ce=0,K=0,ge,U,pe=0,we=0,ne,Re=ne=ge=0,xe=0,Xe=0,ae=0,ie=0,be=D.length,Pe=be-1,ve,Y="",Se="",ye="",Ee="",de;xe<be;){if(U=D.charCodeAt(xe),xe===Pe&&H+K+ce+ee!==0&&(H!==0&&(U=H===47?10:47),K=ce=ee=0,be++,Pe++),H+K+ce+ee===0){if(xe===Pe&&(0<Xe&&(Y=Y.replace(c,"")),0<Y.trim().length)){switch(U){case 32:case 9:case 59:case 13:case 10:break;default:Y+=D.charAt(xe)}U=59}switch(U){case 123:for(Y=Y.trim(),ge=Y.charCodeAt(0),ne=1,ie=++xe;xe<be;){switch(U=D.charCodeAt(xe)){case 123:ne++;break;case 125:ne--;break;case 47:switch(U=D.charCodeAt(xe+1)){case 42:case 47:e:{for(Re=xe+1;Re<Pe;++Re)switch(D.charCodeAt(Re)){case 47:if(U===42&&D.charCodeAt(Re-1)===42&&xe+2!==Re){xe=Re+1;break e}break;case 10:if(U===47){xe=Re+1;break e}}xe=Re}}break;case 91:U++;case 40:U++;case 34:case 39:for(;xe++<Pe&&D.charCodeAt(xe)!==U;);}if(ne===0)break;xe++}switch(ne=D.substring(ie,xe),ge===0&&(ge=(Y=Y.replace(p,"").trim()).charCodeAt(0)),ge){case 64:switch(0<Xe&&(Y=Y.replace(c,"")),U=Y.charCodeAt(1),U){case 100:case 109:case 115:case 45:Xe=F;break;default:Xe=B}if(ne=t(F,Xe,ne,U,N+1),ie=ne.length,0<E&&(Xe=n(B,Y,ae),de=l(3,ne,Xe,F,b,Z,ie,U,N,te),Y=Xe.join(""),de!==void 0&&(ie=(ne=de.trim()).length)===0&&(U=0,ne="")),0<ie)switch(U){case 115:Y=Y.replace(A,s);case 100:case 109:case 45:ne=Y+"{"+ne+"}";break;case 107:Y=Y.replace(m,"$1 $2"),ne=Y+"{"+ne+"}",ne=k===1||k===2&&o("@"+ne,3)?"@-webkit-"+ne+"@"+ne:"@"+ne;break;default:ne=Y+ne,te===112&&(ne=(Se+=ne,""))}else ne="";break;default:ne=t(F,n(F,Y,ae),ne,te,N+1)}ye+=ne,ne=ae=Xe=Re=ge=0,Y="",U=D.charCodeAt(++xe);break;case 125:case 59:if(Y=(0<Xe?Y.replace(c,""):Y).trim(),1<(ie=Y.length))switch(Re===0&&(ge=Y.charCodeAt(0),ge===45||96<ge&&123>ge)&&(ie=(Y=Y.replace(" ",":")).length),0<E&&(de=l(1,Y,F,L,b,Z,Se.length,te,N,te))!==void 0&&(ie=(Y=de.trim()).length)===0&&(Y="\0\0"),ge=Y.charCodeAt(0),U=Y.charCodeAt(1),ge){case 0:break;case 64:if(U===105||U===99){Ee+=Y+D.charAt(xe);break}default:Y.charCodeAt(ie-1)!==58&&(Se+=r(Y,ge,U,Y.charCodeAt(2)))}ae=Xe=Re=ge=0,Y="",U=D.charCodeAt(++xe)}}switch(U){case 13:case 10:H===47?H=0:1+ge===0&&te!==107&&0<Y.length&&(Xe=1,Y+="\0"),0<E*W&&l(0,Y,F,L,b,Z,Se.length,te,N,te),Z=1,b++;break;case 59:case 125:if(H+K+ce+ee===0){Z++;break}default:switch(Z++,ve=D.charAt(xe),U){case 9:case 32:if(K+ee+H===0)switch(pe){case 44:case 58:case 9:case 32:ve="";break;default:U!==32&&(ve=" ")}break;case 0:ve="\\0";break;case 12:ve="\\f";break;case 11:ve="\\v";break;case 38:K+H+ee===0&&(Xe=ae=1,ve="\f"+ve);break;case 108:if(K+H+ee+T===0&&0<Re)switch(xe-Re){case 2:pe===112&&D.charCodeAt(xe-3)===58&&(T=pe);case 8:we===111&&(T=we)}break;case 58:K+H+ee===0&&(Re=xe);break;case 44:H+ce+K+ee===0&&(Xe=1,ve+="\r");break;case 34:case 39:H===0&&(K=K===U?0:K===0?U:K);break;case 91:K+H+ce===0&&ee++;break;case 93:K+H+ce===0&&ee--;break;case 41:K+H+ee===0&&ce--;break;case 40:if(K+H+ee===0){if(ge===0)switch(2*pe+3*we){case 533:break;default:ge=1}ce++}break;case 64:H+ce+K+ee+Re+ne===0&&(ne=1);break;case 42:case 47:if(!(0<K+ee+ce))switch(H){case 0:switch(2*U+3*D.charCodeAt(xe+1)){case 235:H=47;break;case 220:ie=xe,H=42}break;case 42:U===47&&pe===42&&ie+2!==xe&&(D.charCodeAt(ie+2)===33&&(Se+=D.substring(ie,xe+1)),ve="",H=0)}}H===0&&(Y+=ve)}we=pe,pe=U,xe++}if(ie=Se.length,0<ie){if(Xe=F,0<E&&(de=l(2,Se,Xe,L,b,Z,ie,te,N,te),de!==void 0&&(Se=de).length===0))return Ee+Se+ye;if(Se=Xe.join(",")+"{"+Se+"}",k*T!==0){switch(k!==2||o(Se,2)||(T=0),T){case 111:Se=Se.replace(C,":-moz-$1")+Se;break;case 112:Se=Se.replace(y,"::-webkit-input-$1")+Se.replace(y,"::-moz-$1")+Se.replace(y,":-ms-input-$1")+Se}T=0}}return Ee+Se+ye}function n(L,F,D){var te=F.trim().split(x);F=te;var N=te.length,ee=L.length;switch(ee){case 0:case 1:var H=0;for(L=ee===0?"":L[0]+" ";H<N;++H)F[H]=i(L,F[H],D).trim();break;default:var ce=H=0;for(F=[];H<N;++H)for(var K=0;K<ee;++K)F[ce++]=i(L[K]+" ",te[H],D).trim()}return F}function i(L,F,D){var te=F.charCodeAt(0);switch(33>te&&(te=(F=F.trim()).charCodeAt(0)),te){case 38:return F.replace(g,"$1"+L.trim());case 58:return L.trim()+F.replace(g,"$1"+L.trim());default:if(0<1*D&&0<F.indexOf("\f"))return F.replace(g,(L.charCodeAt(0)===58?"":"$1")+L.trim())}return L+F}function r(L,F,D,te){var N=L+";",ee=2*F+3*D+4*te;if(ee===944){L=N.indexOf(":",9)+1;var H=N.substring(L,N.length-1).trim();return H=N.substring(0,L).trim()+H+";",k===1||k===2&&o(H,1)?"-webkit-"+H+H:H}if(k===0||k===2&&!o(N,1))return N;switch(ee){case 1015:return N.charCodeAt(10)===97?"-webkit-"+N+N:N;case 951:return N.charCodeAt(3)===116?"-webkit-"+N+N:N;case 963:return N.charCodeAt(5)===110?"-webkit-"+N+N:N;case 1009:if(N.charCodeAt(4)!==100)break;case 969:case 942:return"-webkit-"+N+N;case 978:return"-webkit-"+N+"-moz-"+N+N;case 1019:case 983:return"-webkit-"+N+"-moz-"+N+"-ms-"+N+N;case 883:if(N.charCodeAt(8)===45)return"-webkit-"+N+N;if(0<N.indexOf("image-set(",11))return N.replace($,"$1-webkit-$2")+N;break;case 932:if(N.charCodeAt(4)===45)switch(N.charCodeAt(5)){case 103:return"-webkit-box-"+N.replace("-grow","")+"-webkit-"+N+"-ms-"+N.replace("grow","positive")+N;case 115:return"-webkit-"+N+"-ms-"+N.replace("shrink","negative")+N;case 98:return"-webkit-"+N+"-ms-"+N.replace("basis","preferred-size")+N}return"-webkit-"+N+"-ms-"+N+N;case 964:return"-webkit-"+N+"-ms-flex-"+N+N;case 1023:if(N.charCodeAt(8)!==99)break;return H=N.substring(N.indexOf(":",15)).replace("flex-","").replace("space-between","justify"),"-webkit-box-pack"+H+"-webkit-"+N+"-ms-flex-pack"+H+N;case 1005:return v.test(N)?N.replace(f,":-webkit-")+N.replace(f,":-moz-")+N:N;case 1e3:switch(H=N.substring(13).trim(),F=H.indexOf("-")+1,H.charCodeAt(0)+H.charCodeAt(F)){case 226:H=N.replace(P,"tb");break;case 232:H=N.replace(P,"tb-rl");break;case 220:H=N.replace(P,"lr");break;default:return N}return"-webkit-"+N+"-ms-"+H+N;case 1017:if(N.indexOf("sticky",9)===-1)break;case 975:switch(F=(N=L).length-10,H=(N.charCodeAt(F)===33?N.substring(0,F):N).substring(L.indexOf(":",7)+1).trim(),ee=H.charCodeAt(0)+(H.charCodeAt(7)|0)){case 203:if(111>H.charCodeAt(8))break;case 115:N=N.replace(H,"-webkit-"+H)+";"+N;break;case 207:case 102:N=N.replace(H,"-webkit-"+(102<ee?"inline-":"")+"box")+";"+N.replace(H,"-webkit-"+H)+";"+N.replace(H,"-ms-"+H+"box")+";"+N}return N+";";case 938:if(N.charCodeAt(5)===45)switch(N.charCodeAt(6)){case 105:return H=N.replace("-items",""),"-webkit-"+N+"-webkit-box-"+H+"-ms-flex-"+H+N;case 115:return"-webkit-"+N+"-ms-flex-item-"+N.replace(M,"")+N;default:return"-webkit-"+N+"-ms-flex-line-pack"+N.replace("align-content","").replace(M,"")+N}break;case 973:case 989:if(N.charCodeAt(3)!==45||N.charCodeAt(4)===122)break;case 931:case 953:if(j.test(L)===!0)return(H=L.substring(L.indexOf(":")+1)).charCodeAt(0)===115?r(L.replace("stretch","fill-available"),F,D,te).replace(":fill-available",":stretch"):N.replace(H,"-webkit-"+H)+N.replace(H,"-moz-"+H.replace("fill-",""))+N;break;case 962:if(N="-webkit-"+N+(N.charCodeAt(5)===102?"-ms-"+N:"")+N,D+te===211&&N.charCodeAt(13)===105&&0<N.indexOf("transform",10))return N.substring(0,N.indexOf(";",27)+1).replace(w,"$1-webkit-$2")+N}return N}function o(L,F){var D=L.indexOf(F===1?":":"{"),te=L.substring(0,F!==3?D:10);return D=L.substring(D+1,L.length-1),_(F!==2?te:te.replace(G,"$1"),D,F)}function s(L,F){var D=r(F,F.charCodeAt(0),F.charCodeAt(1),F.charCodeAt(2));return D!==F+";"?D.replace(I," or ($1)").substring(4):"("+F+")"}function l(L,F,D,te,N,ee,H,ce,K,ge){for(var U=0,pe=F,we;U<E;++U)switch(we=V[U].call(h,L,pe,D,te,N,ee,H,ce,K,ge)){case void 0:case!1:case!0:case null:break;default:pe=we}if(pe!==F)return pe}function a(L){switch(L){case void 0:case null:E=V.length=0;break;default:if(typeof L=="function")V[E++]=L;else if(typeof L=="object")for(var F=0,D=L.length;F<D;++F)a(L[F]);else W=!!L|0}return a}function u(L){return L=L.prefix,L!==void 0&&(_=null,L?typeof L!="function"?k=1:(k=2,_=L):k=0),u}function h(L,F){var D=L;if(33>D.charCodeAt(0)&&(D=D.trim()),J=D,D=[J],0<E){var te=l(-1,F,D,D,b,Z,0,0,0,0);te!==void 0&&typeof te=="string"&&(F=te)}var N=t(B,D,F,0,0);return 0<E&&(te=l(-2,N,D,D,b,Z,N.length,0,0,0),te!==void 0&&(N=te)),J="",T=0,Z=b=1,N}var p=/^\0+/g,c=/[\0\r\f]/g,f=/: */g,v=/zoo|gra/,w=/([,: ])(transform)/g,x=/,\r+?/g,g=/([\t\r\n ])*\f?&/g,m=/@(k\w+)\s*(\S*)\s*/,y=/::(place)/g,C=/:(read-only)/g,P=/[svh]\w+-[tblr]{2}/,A=/\(\s*(.*)\s*\)/g,I=/([\s\S]*?);/g,M=/-self|flex-/g,G=/[^]*?(:[rp][el]a[\w-]+)[^]*/,j=/stretch|:\s*\w+\-(?:conte|avail)/,$=/([^-])(image-set\()/,Z=1,b=1,T=0,k=1,B=[],V=[],E=0,_=null,W=0,J="";return h.use=a,h.set=u,e!==void 0&&u(e),h}var jh="/*|*/",TS=jh+"}";function IS(e){e&&xa.current.insert(e+"}")}var xa={current:null},RS=function(t,n,i,r,o,s,l,a,u,h){switch(t){case 1:{switch(n.charCodeAt(0)){case 64:return xa.current.insert(n+";"),"";case 108:if(n.charCodeAt(2)===98)return""}break}case 2:{if(a===0)return n+jh;break}case 3:switch(a){case 102:case 112:return xa.current.insert(i[0]+n),"";default:return n+(h===0?jh:"")}case-2:n.split(TS).forEach(IS)}},AS=function(t){t===void 0&&(t={});var n=t.key||"css",i;t.prefix!==void 0&&(i={prefix:t.prefix});var r=new NS(i),o={},s;{s=t.container||document.head;var l=document.querySelectorAll("style[data-emotion-"+n+"]");Array.prototype.forEach.call(l,function(h){var p=h.getAttribute("data-emotion-"+n);p.split(" ").forEach(function(c){o[c]=!0}),h.parentNode!==s&&s.appendChild(h)})}var a;r.use(t.stylisPlugins)(RS),a=function(p,c,f,v){var w=c.name;xa.current=f,r(p,c.styles),v&&(u.inserted[w]=!0)};var u={key:n,sheet:new PS({key:n,container:s,nonce:t.nonce,speedy:t.speedy}),nonce:t.nonce,inserted:o,registered:{},insert:a};return u},LS=!0;function FS(e,t,n){var i="";return n.split(" ").forEach(function(r){e[r]!==void 0?t.push(e[r]):i+=r+" "}),i}var OS=function(t,n,i){var r=t.key+"-"+n.name;if((i===!1||LS===!1)&&t.registered[r]===void 0&&(t.registered[r]=n.styles),t.inserted[n.name]===void 0){var o=n;do t.insert("."+r,o,t.sheet,!0),o=o.next;while(o!==void 0)}};function BS(e){for(var t=0,n,i=0,r=e.length;r>=4;++i,r-=4)n=e.charCodeAt(i)&255|(e.charCodeAt(++i)&255)<<8|(e.charCodeAt(++i)&255)<<16|(e.charCodeAt(++i)&255)<<24,n=(n&65535)*1540483477+((n>>>16)*59797<<16),n^=n>>>24,t=(n&65535)*1540483477+((n>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(r){case 3:t^=(e.charCodeAt(i+2)&255)<<16;case 2:t^=(e.charCodeAt(i+1)&255)<<8;case 1:t^=e.charCodeAt(i)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var _S={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},MS=/[A-Z]|^ms/g,zS=/_EMO_([^_]+?)_([^]*?)_EMO_/g,Aw=function(t){return t.charCodeAt(1)===45},Mf=function(t){return t!=null&&typeof t!="boolean"},_u=Rw(function(e){return Aw(e)?e:e.replace(MS,"-$&").toLowerCase()}),zf=function(t,n){switch(t){case"animation":case"animationName":if(typeof n=="string")return n.replace(zS,function(i,r,o){return Mn={name:r,styles:o,next:Mn},r})}return _S[t]!==1&&!Aw(t)&&typeof n=="number"&&n!==0?n+"px":n};function Ns(e,t,n,i){if(n==null)return"";if(n.__emotion_styles!==void 0)return n;switch(typeof n){case"boolean":return"";case"object":{if(n.anim===1)return Mn={name:n.name,styles:n.styles,next:Mn},n.name;if(n.styles!==void 0){var r=n.next;if(r!==void 0)for(;r!==void 0;)Mn={name:r.name,styles:r.styles,next:Mn},r=r.next;var o=n.styles+";";return o}return $S(e,t,n)}case"function":{if(e!==void 0){var s=Mn,l=n(e);return Mn=s,Ns(e,t,l,i)}break}}if(t==null)return n;var a=t[n];return a!==void 0&&!i?a:n}function $S(e,t,n){var i="";if(Array.isArray(n))for(var r=0;r<n.length;r++)i+=Ns(e,t,n[r],!1);else for(var o in n){var s=n[o];if(typeof s!="object")t!=null&&t[s]!==void 0?i+=o+"{"+t[s]+"}":Mf(s)&&(i+=_u(o)+":"+zf(o,s)+";");else if(Array.isArray(s)&&typeof s[0]=="string"&&(t==null||t[s[0]]===void 0))for(var l=0;l<s.length;l++)Mf(s[l])&&(i+=_u(o)+":"+zf(o,s[l])+";");else{var a=Ns(e,t,s,!1);switch(o){case"animation":case"animationName":{i+=_u(o)+":"+a+";";break}default:i+=o+"{"+a+"}"}}}return i}var $f=/label:\s*([^\s;\n{]+)\s*;/g,Mn,DS=function(t,n,i){if(t.length===1&&typeof t[0]=="object"&&t[0]!==null&&t[0].styles!==void 0)return t[0];var r=!0,o="";Mn=void 0;var s=t[0];s==null||s.raw===void 0?(r=!1,o+=Ns(i,n,s,!1)):o+=s[0];for(var l=1;l<t.length;l++)o+=Ns(i,n,t[l],o.charCodeAt(o.length-1)===46),r&&(o+=s[l]);$f.lastIndex=0;for(var a="",u;(u=$f.exec(o))!==null;)a+="-"+u[1];var h=BS(o)+a;return{name:h,styles:o,next:Mn}},Lw=se.createContext(typeof HTMLElement<"u"?AS():null),VS=se.createContext({});Lw.Provider;var US=function(t){var n=function(r,o){return se.createElement(Lw.Consumer,null,function(s){return t(r,s,o)})};return se.forwardRef(n)},HS=CS,WS=function(t){return t!=="theme"&&t!=="innerRef"},Df=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?HS:WS};function Vf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function jS(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Vf(Object(n),!0).forEach(function(i){bS(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vf(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var GS=function(){return null},XS=function e(t,n){var i,r,o;n!==void 0&&(i=n.label,o=n.target,r=t.__emotion_forwardProp&&n.shouldForwardProp?function(h){return t.__emotion_forwardProp(h)&&n.shouldForwardProp(h)}:n.shouldForwardProp);var s=t.__emotion_real===t,l=s&&t.__emotion_base||t;typeof r!="function"&&s&&(r=t.__emotion_forwardProp);var a=r||Df(l),u=!a("as");return function(){var h=arguments,p=s&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(i!==void 0&&p.push("label:"+i+";"),h[0]==null||h[0].raw===void 0)p.push.apply(p,h);else{p.push(h[0][0]);for(var c=h.length,f=1;f<c;f++)p.push(h[f],h[0][f])}var v=US(function(w,x,g){return se.createElement(VS.Consumer,null,function(m){var y=u&&w.as||l,C="",P=[],A=w;if(w.theme==null){A={};for(var I in w)A[I]=w[I];A.theme=m}typeof w.className=="string"?C=FS(x.registered,P,w.className):w.className!=null&&(C=w.className+" ");var M=DS(p.concat(P),x.registered,A);OS(x,M,typeof y=="string"),C+=x.key+"-"+M.name,o!==void 0&&(C+=" "+o);var G=u&&r===void 0?Df(y):a,j={};for(var $ in w)u&&$==="as"||G($)&&(j[$]=w[$]);j.className=C,j.ref=g||w.innerRef;var Z=se.createElement(y,j),b=se.createElement(GS,null);return se.createElement(se.Fragment,null,b,Z)})});return v.displayName=i!==void 0?i:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",v.defaultProps=t.defaultProps,v.__emotion_real=v,v.__emotion_base=l,v.__emotion_styles=p,v.__emotion_forwardProp=r,Object.defineProperty(v,"toString",{value:function(){return"."+o}}),v.withComponent=function(w,x){return e(w,x!==void 0?jS({},n||{},{},x):n).apply(void 0,p)},v}},YS=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],Gh=XS.bind();YS.forEach(function(e){Gh[e]=Gh(e)});var qS=Object.create,Hs=Object.defineProperty,KS=Object.getOwnPropertyDescriptor,QS=Object.getOwnPropertyNames,ZS=Object.getPrototypeOf,JS=Object.prototype.hasOwnProperty,eC=(e,t,n)=>t in e?Hs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tC=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),nC=(e,t)=>{for(var n in t)Hs(e,n,{get:t[n],enumerable:!0})},Fw=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of QS(t))!JS.call(e,r)&&r!==n&&Hs(e,r,{get:()=>t[r],enumerable:!(i=KS(t,r))||i.enumerable});return e},iC=(e,t,n)=>(n=e!=null?qS(ZS(e)):{},Fw(!e||!e.__esModule?Hs(n,"default",{value:e,enumerable:!0}):n,e)),rC=e=>Fw(Hs({},"__esModule",{value:!0}),e),d=(e,t,n)=>eC(e,typeof t!="symbol"?t+"":t,n),oC=tC((e,t)=>{var n=-1,i=1,r=0;function o(b,T,k,B,V){if(b===T)return b?[[r,b]]:[];if(k!=null){var E=$(b,T,k);if(E)return E}var _=u(b,T),W=b.substring(0,_);b=b.substring(_),T=T.substring(_),_=p(b,T);var J=b.substring(b.length-_);b=b.substring(0,b.length-_),T=T.substring(0,T.length-_);var L=s(b,T);return W&&L.unshift([r,W]),J&&L.push([r,J]),C(L,V),B&&f(L),L}function s(b,T){var k;if(!b)return[[i,T]];if(!T)return[[n,b]];var B=b.length>T.length?b:T,V=b.length>T.length?T:b,E=B.indexOf(V);if(E!==-1)return k=[[i,B.substring(0,E)],[r,V],[i,B.substring(E+V.length)]],b.length>T.length&&(k[0][0]=k[2][0]=n),k;if(V.length===1)return[[n,b],[i,T]];var _=c(b,T);if(_){var W=_[0],J=_[1],L=_[2],F=_[3],D=_[4],te=o(W,L),N=o(J,F);return te.concat([[r,D]],N)}return l(b,T)}function l(b,T){for(var k=b.length,B=T.length,V=Math.ceil((k+B)/2),E=V,_=2*V,W=new Array(_),J=new Array(_),L=0;L<_;L++)W[L]=-1,J[L]=-1;W[E+1]=0,J[E+1]=0;for(var F=k-B,D=F%2!==0,te=0,N=0,ee=0,H=0,ce=0;ce<V;ce++){for(var K=-ce+te;K<=ce-N;K+=2){var ge=E+K,U;K===-ce||K!==ce&&W[ge-1]<W[ge+1]?U=W[ge+1]:U=W[ge-1]+1;for(var pe=U-K;U<k&&pe<B&&b.charAt(U)===T.charAt(pe);)U++,pe++;if(W[ge]=U,U>k)N+=2;else if(pe>B)te+=2;else if(D){var we=E+F-K;if(we>=0&&we<_&&J[we]!==-1){var ne=k-J[we];if(U>=ne)return a(b,T,U,pe)}}}for(var Re=-ce+ee;Re<=ce-H;Re+=2){var we=E+Re,ne;Re===-ce||Re!==ce&&J[we-1]<J[we+1]?ne=J[we+1]:ne=J[we-1]+1;for(var xe=ne-Re;ne<k&&xe<B&&b.charAt(k-ne-1)===T.charAt(B-xe-1);)ne++,xe++;if(J[we]=ne,ne>k)H+=2;else if(xe>B)ee+=2;else if(!D){var ge=E+F-Re;if(ge>=0&&ge<_&&W[ge]!==-1){var U=W[ge],pe=E+U-ge;if(ne=k-ne,U>=ne)return a(b,T,U,pe)}}}}return[[n,b],[i,T]]}function a(b,T,k,B){var V=b.substring(0,k),E=T.substring(0,B),_=b.substring(k),W=T.substring(B),J=o(V,E),L=o(_,W);return J.concat(L)}function u(b,T){if(!b||!T||b.charAt(0)!==T.charAt(0))return 0;for(var k=0,B=Math.min(b.length,T.length),V=B,E=0;k<V;)b.substring(E,V)==T.substring(E,V)?(k=V,E=k):B=V,V=Math.floor((B-k)/2+k);return P(b.charCodeAt(V-1))&&V--,V}function h(b,T){var k=b.length,B=T.length;if(k==0||B==0)return 0;k>B?b=b.substring(k-B):k<B&&(T=T.substring(0,k));var V=Math.min(k,B);if(b==T)return V;for(var E=0,_=1;;){var W=b.substring(V-_),J=T.indexOf(W);if(J==-1)return E;_+=J,(J==0||b.substring(V-_)==T.substring(0,_))&&(E=_,_++)}}function p(b,T){if(!b||!T||b.slice(-1)!==T.slice(-1))return 0;for(var k=0,B=Math.min(b.length,T.length),V=B,E=0;k<V;)b.substring(b.length-V,b.length-E)==T.substring(T.length-V,T.length-E)?(k=V,E=k):B=V,V=Math.floor((B-k)/2+k);return A(b.charCodeAt(b.length-V))&&V--,V}function c(b,T){var k=b.length>T.length?b:T,B=b.length>T.length?T:b;if(k.length<4||B.length*2<k.length)return null;function V(N,ee,H){for(var ce=N.substring(H,H+Math.floor(N.length/4)),K=-1,ge="",U,pe,we,ne;(K=ee.indexOf(ce,K+1))!==-1;){var Re=u(N.substring(H),ee.substring(K)),xe=p(N.substring(0,H),ee.substring(0,K));ge.length<xe+Re&&(ge=ee.substring(K-xe,K)+ee.substring(K,K+Re),U=N.substring(0,H-xe),pe=N.substring(H+Re),we=ee.substring(0,K-xe),ne=ee.substring(K+Re))}return ge.length*2>=N.length?[U,pe,we,ne,ge]:null}var E=V(k,B,Math.ceil(k.length/4)),_=V(k,B,Math.ceil(k.length/2)),W;if(!E&&!_)return null;_?E?W=E[4].length>_[4].length?E:_:W=_:W=E;var J,L,F,D;b.length>T.length?(J=W[0],L=W[1],F=W[2],D=W[3]):(F=W[0],D=W[1],J=W[2],L=W[3]);var te=W[4];return[J,L,F,D,te]}function f(b){for(var T=!1,k=[],B=0,V=null,E=0,_=0,W=0,J=0,L=0;E<b.length;)b[E][0]==r?(k[B++]=E,_=J,W=L,J=0,L=0,V=b[E][1]):(b[E][0]==i?J+=b[E][1].length:L+=b[E][1].length,V&&V.length<=Math.max(_,W)&&V.length<=Math.max(J,L)&&(b.splice(k[B-1],0,[n,V]),b[k[B-1]+1][0]=i,B--,B--,E=B>0?k[B-1]:-1,_=0,W=0,J=0,L=0,V=null,T=!0)),E++;for(T&&C(b),y(b),E=1;E<b.length;){if(b[E-1][0]==n&&b[E][0]==i){var F=b[E-1][1],D=b[E][1],te=h(F,D),N=h(D,F);te>=N?(te>=F.length/2||te>=D.length/2)&&(b.splice(E,0,[r,D.substring(0,te)]),b[E-1][1]=F.substring(0,F.length-te),b[E+1][1]=D.substring(te),E++):(N>=F.length/2||N>=D.length/2)&&(b.splice(E,0,[r,F.substring(0,N)]),b[E-1][0]=i,b[E-1][1]=D.substring(0,D.length-N),b[E+1][0]=n,b[E+1][1]=F.substring(N),E++),E++}E++}}var v=/[^a-zA-Z0-9]/,w=/\s/,x=/[\r\n]/,g=/\n\r?\n$/,m=/^\r?\n\r?\n/;function y(b){function T(N,ee){if(!N||!ee)return 6;var H=N.charAt(N.length-1),ce=ee.charAt(0),K=H.match(v),ge=ce.match(v),U=K&&H.match(w),pe=ge&&ce.match(w),we=U&&H.match(x),ne=pe&&ce.match(x),Re=we&&N.match(g),xe=ne&&ee.match(m);return Re||xe?5:we||ne?4:K&&!U&&pe?3:U||pe?2:K||ge?1:0}for(var k=1;k<b.length-1;){if(b[k-1][0]==r&&b[k+1][0]==r){var B=b[k-1][1],V=b[k][1],E=b[k+1][1],_=p(B,V);if(_){var W=V.substring(V.length-_);B=B.substring(0,B.length-_),V=W+V.substring(0,V.length-_),E=W+E}for(var J=B,L=V,F=E,D=T(B,V)+T(V,E);V.charAt(0)===E.charAt(0);){B+=V.charAt(0),V=V.substring(1)+E.charAt(0),E=E.substring(1);var te=T(B,V)+T(V,E);te>=D&&(D=te,J=B,L=V,F=E)}b[k-1][1]!=J&&(J?b[k-1][1]=J:(b.splice(k-1,1),k--),b[k][1]=L,F?b[k+1][1]=F:(b.splice(k+1,1),k--))}k++}}function C(b,T){b.push([r,""]);for(var k=0,B=0,V=0,E="",_="",W;k<b.length;){if(k<b.length-1&&!b[k][1]){b.splice(k,1);continue}switch(b[k][0]){case i:V++,_+=b[k][1],k++;break;case n:B++,E+=b[k][1],k++;break;case r:var J=k-V-B-1;if(T){if(J>=0&&M(b[J][1])){var L=b[J][1].slice(-1);if(b[J][1]=b[J][1].slice(0,-1),E=L+E,_=L+_,!b[J][1]){b.splice(J,1),k--;var F=J-1;b[F]&&b[F][0]===i&&(V++,_=b[F][1]+_,F--),b[F]&&b[F][0]===n&&(B++,E=b[F][1]+E,F--),J=F}}if(I(b[k][1])){var L=b[k][1].charAt(0);b[k][1]=b[k][1].slice(1),E+=L,_+=L}}if(k<b.length-1&&!b[k][1]){b.splice(k,1);break}if(E.length>0||_.length>0){E.length>0&&_.length>0&&(W=u(_,E),W!==0&&(J>=0?b[J][1]+=_.substring(0,W):(b.splice(0,0,[r,_.substring(0,W)]),k++),_=_.substring(W),E=E.substring(W)),W=p(_,E),W!==0&&(b[k][1]=_.substring(_.length-W)+b[k][1],_=_.substring(0,_.length-W),E=E.substring(0,E.length-W)));var D=V+B;E.length===0&&_.length===0?(b.splice(k-D,D),k=k-D):E.length===0?(b.splice(k-D,D,[i,_]),k=k-D+1):_.length===0?(b.splice(k-D,D,[n,E]),k=k-D+1):(b.splice(k-D,D,[n,E],[i,_]),k=k-D+2)}k!==0&&b[k-1][0]===r?(b[k-1][1]+=b[k][1],b.splice(k,1)):k++,V=0,B=0,E="",_="";break}}b[b.length-1][1]===""&&b.pop();var te=!1;for(k=1;k<b.length-1;)b[k-1][0]===r&&b[k+1][0]===r&&(b[k][1].substring(b[k][1].length-b[k-1][1].length)===b[k-1][1]?(b[k][1]=b[k-1][1]+b[k][1].substring(0,b[k][1].length-b[k-1][1].length),b[k+1][1]=b[k-1][1]+b[k+1][1],b.splice(k-1,1),te=!0):b[k][1].substring(0,b[k+1][1].length)==b[k+1][1]&&(b[k-1][1]+=b[k+1][1],b[k][1]=b[k][1].substring(b[k+1][1].length)+b[k+1][1],b.splice(k+1,1),te=!0)),k++;te&&C(b,T)}function P(b){return b>=55296&&b<=56319}function A(b){return b>=56320&&b<=57343}function I(b){return A(b.charCodeAt(0))}function M(b){return P(b.charCodeAt(b.length-1))}function G(b){for(var T=[],k=0;k<b.length;k++)b[k][1].length>0&&T.push(b[k]);return T}function j(b,T,k,B){return M(b)||I(B)?null:G([[r,b],[n,T],[i,k],[r,B]])}function $(b,T,k){var B=typeof k=="number"?{index:k,length:0}:k.oldRange,V=typeof k=="number"?null:k.newRange,E=b.length,_=T.length;if(B.length===0&&(V===null||V.length===0)){var W=B.index,J=b.slice(0,W),L=b.slice(W),F=V?V.index:null;e:{var D=W+_-E;if(F!==null&&F!==D||D<0||D>_)break e;var te=T.slice(0,D),N=T.slice(D);if(N!==L)break e;var ee=Math.min(W,D),H=J.slice(0,ee),ce=te.slice(0,ee);if(H!==ce)break e;var K=J.slice(ee),ge=te.slice(ee);return j(H,K,ge,L)}e:{if(F!==null&&F!==W)break e;var U=W,te=T.slice(0,U),N=T.slice(U);if(te!==J)break e;var pe=Math.min(E-U,_-U),we=L.slice(L.length-pe),ne=N.slice(N.length-pe);if(we!==ne)break e;var K=L.slice(0,L.length-pe),ge=N.slice(0,N.length-pe);return j(J,K,ge,we)}}if(B.length>0&&V&&V.length===0)e:{var H=b.slice(0,B.index),we=b.slice(B.index+B.length),ee=H.length,pe=we.length;if(_<ee+pe)break e;var ce=T.slice(0,ee),ne=T.slice(_-pe);if(H!==ce||we!==ne)break e;var K=b.slice(ee,E-pe),ge=T.slice(ee,_-pe);return j(H,K,ge,we)}return null}function Z(b,T,k,B){return o(b,T,k,B,!0)}Z.INSERT=i,Z.DELETE=n,Z.EQUAL=r,t.exports=Z}),Ow={};nC(Ow,{CoreViewer:()=>_x,HOOKS:()=>Qa,Navigation:()=>Mx,PageProgression:()=>$d,PageSide:()=>Mw,PageViewMode:()=>EI,Profiler:()=>Vw,ReadyState:()=>zw,UserAgentBaseCss:()=>Ly,UserAgentPageCss:()=>Ay,UserAgentTocCss:()=>Fy,UserAgentXml:()=>Ry,ValidationTxt:()=>Iy,VivliostylePolyfillCss:()=>Oy,VivliostyleViewportCss:()=>Ty,VivliostyleViewportScreenCss:()=>Ny,ZoomType:()=>kI,getHooksForName:()=>An,isDebug:()=>Ts,pageProgressionOf:()=>_w,plugin:()=>lC,printHTML:()=>NI,profile:()=>cC,profiler:()=>Xt,registerHook:()=>wn,removeHook:()=>Dw,setDebug:()=>Bw});var wl=rC(Ow),Ts=!1;function Bw(e){Ts=e}var $d=(e=>(e.LTR="ltr",e.RTL="rtl",e))($d||{});function _w(e){switch(e){case"ltr":return"ltr";case"rtl":return"rtl";default:throw new Error(`unknown PageProgression: ${e}`)}}var Mw=(e=>(e.LEFT="left",e.RIGHT="right",e))(Mw||{}),zw=(e=>(e.LOADING="loading",e.INTERACTIVE="interactive",e.COMPLETE="complete",e))(zw||{}),$w=(e=>(e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e))($w||{}),sC=class{constructor(e){this.opt_console=e,d(this,"listeners",{})}consoleDebug(e){this.opt_console?this.opt_console.debug?this.opt_console.debug(...e):this.opt_console.log(...e):console.debug(...e)}consoleInfo(e){this.opt_console?this.opt_console.info?this.opt_console.info(...e):this.opt_console.log(...e):console.info(...e)}consoleWarn(e){this.opt_console?this.opt_console.warn?this.opt_console.warn(...e):this.opt_console.log(...e):console.warn(...e)}consoleError(e){this.opt_console?this.opt_console.error?this.opt_console.error(...e):this.opt_console.log(...e):console.error(...e)}triggerListeners(e,t){let n=this.listeners[e];n&&n(t)}addListener(e,t){this.listeners[e]=t}debug(...e){let t=yl(arguments);this.consoleDebug(xl(t)),this.triggerListeners(1,t)}info(...e){let t=yl(arguments);this.consoleInfo(xl(t)),this.triggerListeners(2,t)}warn(...e){let t=yl(arguments);this.consoleWarn(xl(t)),this.triggerListeners(3,t)}error(...e){let t=yl(arguments);this.consoleError(xl(t)),this.triggerListeners(4,t)}};function yl(e){let t=Array.from(e),n=null;return t[0]instanceof Error&&(n=t.shift()),{error:n,messages:t}}function xl(e){let t=e.error,n=t&&(t.frameTrace||t.stack),i=[].concat(e.messages);return t&&(i.length>0&&(i=i.concat([`
`])),i=i.concat([t.toString()]),n&&(i=i.concat([`
`]).concat(n))),i}var le=new sC,Qa=(e=>(e.SIMPLE_PROPERTY="SIMPLE_PROPERTY",e.PREPROCESS_SINGLE_DOCUMENT="PREPROCESS_SINGLE_DOCUMENT",e.PREPROCESS_TEXT_CONTENT="PREPROCESS_TEXT_CONTENT",e.PREPROCESS_ELEMENT_STYLE="PREPROCESS_ELEMENT_STYLE",e.POLYFILLED_INHERITED_PROPS="POLYFILLED_INHERITED_PROPS",e.CONFIGURATION="CONFIGURATION",e.RESOLVE_TEXT_NODE_BREAKER="RESOLVE_TEXT_NODE_BREAKER",e.RESOLVE_FORMATTING_CONTEXT="RESOLVE_FORMATTING_CONTEXT",e.RESOLVE_LAYOUT_PROCESSOR="RESOLVE_LAYOUT_PROCESSOR",e.POST_LAYOUT_BLOCK="POST_LAYOUT_BLOCK",e))(Qa||{}),ba={};function wn(e,t,n){if(!Qa[e])le.warn(new Error(`Skipping unknown plugin hook '${e}'.`));else{let i=ba[e];i||(i=ba[e]=[]),n?i.unshift(t):i.push(t)}}function Dw(e,t){if(!Qa[e])le.warn(new Error(`Ignoring unknown plugin hook '${e}'.`));else{let n=ba[e];if(n){let i=n.indexOf(t);i>=0&&n.splice(i,1)}}}function An(e){return ba[e]||[]}var lC={registerHook:wn,removeHook:Dw},Vw=class{constructor(e){this.performanceInstance=e,d(this,"timestamps",{}),d(this,"registerTiming"),d(this,"registerStartTiming"),d(this,"registerEndTiming"),this.registerTiming=dr,this.registerStartTiming=this.registerStartTiming=dr,this.registerEndTiming=this.registerEndTiming=dr}forceRegisterStartTiming(e,t){Mu.call(this,e,"start",t)}forceRegisterEndTiming(e,t){Mu.call(this,e,"end",t)}printTimings(){let e=this.timestamps,t="";Object.keys(e).forEach(n=>{let i=e[n],r=i.length;for(let o=0;o<r;o++){let s=i[o];t+=n,r>1&&(t+=`(${o})`),t+=` => start: ${s.start}, end: ${s.end}, duration: ${s.end-s.start}
`}}),le.info(t)}disable(){this.registerTiming=dr,this.registerStartTiming=this.registerStartTiming=dr,this.registerEndTiming=this.registerEndTiming=dr}enable(){this.registerTiming=Mu,this.registerStartTiming=this.registerStartTiming=Uf,this.registerEndTiming=this.registerEndTiming=aC}isEnabled(){return this.registerStartTiming===Uf}};function dr(){}function Mu(e,t,n){n||(n=this.performanceInstance.now());let i=this.timestamps[e];i||(i=this.timestamps[e]=[]);let r,o=i.length;for(let s=o-1;s>=0&&(r=i[s],!(r&&!r[t]));s--)r=null;r||(r={},i.push(r)),r[t]=n}function Uf(e,t){this.registerTiming(e,"start",t)}function aC(e,t){this.registerTiming(e,"end",t)}var uC={now:Date.now},hC=window&&window.performance,Xt=new Vw(hC||uC);Xt.forceRegisterStartTiming("load_vivliostyle");var cC={profiler:{registerStartTiming:Xt.registerStartTiming,registerEndTiming:Xt.registerEndTiming,printTimings:Xt.printTimings,disable:Xt.disable,enable:Xt.enable}},Xh=new RegExp("^[\\s\\p{Zs}\\p{P}\\p{Mn}]*[\\p{L}\\p{N}]\\p{Mn}*(?:[\\s\\p{Zs}]*\\p{P}\\p{Mn}*)*","u"),jn="data-adapt-eloff",dC={};function Dd(e){return JSON.parse(e)}function Yn(e){let t=e.match(/^([^#]*)/);return t?t[1]:e}function pC(e){let t=e.match(/^([^#?]*)/);return t?t[1]:e}var eo=window.location.href;function Hf(e){eo=e}var lr=window.location.href;function Wf(e){lr=e}function et(e,t){if(/^data:/i.test(t))return e||t;if(!t||e.match(/^\w{2,}:/))return e.toLowerCase().match("^javascript:")?"#":(e.match(/^\w{2,}:\/\/[^\/]+$/)&&(e=`${e}/`),e);t.match(/^\w{2,}:\/\/[^\/]+$/)&&(t=`${t}/`);let n;if(e.match(/^\/\//))return n=t.match(/^(\w{2,}:)\/\//),n?n[1]+e:e;if(e.match(/^\//))return n=t.match(/^(\w{2,}:\/\/[^\/]+)\//),n?n[1]+e:e;if(e.match(/^\.(\/|$)/)&&(e=e.substr(2)),t=pC(t),e.match(/^#/))return t+e;let i=t.lastIndexOf("/");if(i<0)return e;let r=t.substr(0,i+1)+e,o="";for(n=r.match(/^([^?#]*)([?#].*)$/),n&&(r=n[1],o=n[2]);i=r.indexOf("/../"),!(i<=0);){let s=r.lastIndexOf("/",i-1);if(s<=0)break;r=r.substr(0,s)+r.substr(i+3)}return r.replace(/\/(\.\/)+/g,"/")+o}function Is(e){let t;return(t=/^(https?:)\/\/github\.com\/([^/]+\/[^/]+)\/(blob\/|tree\/|raw\/)?(.*)$/.exec(e))?e=`${t[1]}//raw.githubusercontent.com/${t[2]}/${t[3]?"":"master/"}${t[4]}`:(t=/^(https?:)\/\/www\.aozora\.gr\.jp\/(cards\/[^/]+\/files\/[^/.]+\.html)$/.exec(e))?e=`${t[1]}//raw.githubusercontent.com/aozorabunko/aozorabunko/master/${t[2]}`:(t=/^(https?:)\/\/gist\.github\.com\/([^/]+\/\w+)(\/|$)(raw(\/|$))?(.*)$/.exec(e))?e=`${t[1]}//gist.githubusercontent.com/${t[2]}/raw/${t[6]}`:(t=/^(https?:)\/\/gist\.github\.com\/([^/]+\/\w+)#file-(.*)-(\w+)$/.exec(e))?e=`${t[1]}//gist.githubusercontent.com/${t[2]}/raw/${t[3]}.${t[4]}`:(t=/^(https?:)\/\/(?:[^/.]+\.)?jsbin\.com\/(?!(?:blog|help)\b)(\w+)((\/\d+)?).*$/.exec(e))&&(e=`${t[1]}//output.jsbin.com/${t[2]}${t[3]}/`),e}function jf(e){return e==null?e:e.toString()}var fC=class{constructor(){d(this,"queue",[null])}length(){return this.queue.length-1}add(e){let t=this.queue.length;for(;t>1;){let n=Math.floor(t/2),i=this.queue[n];if(i.compare(e)>0){this.queue[t]=e;return}this.queue[t]=i,t=n}this.queue[1]=e}peek(){return this.queue[1]}remove(){let e=this.queue[1],t=this.queue.pop(),n=this.queue.length;if(n>1){let i=1;for(;;){let r=i*2;if(r>=n)break;if(this.queue[r].compare(t)>0)r+1<n&&this.queue[r+1].compare(this.queue[r])>0&&r++;else if(r+1<n&&this.queue[r+1].compare(t)>0)r++;else break;this.queue[i]=this.queue[r],i=r}this.queue[i]=t}return e}},Uw=["","-webkit-","-moz-"],fr={};function zu(e,t){return CSS.supports(e+t,"unset")}function gC(e){let t=fr[e];if(t||t===null)return t;switch(e){case"behavior":case"template":case"ua-list-item-count":case"x-first-pseudo":return fr[e]=null,null;case"text-combine-upright":if(zu("-webkit-","text-combine")&&!zu("","text-combine-upright"))return fr[e]=["-webkit-text-combine"],["-webkit-text-combine"];break}for(let n of Uw)if(zu(n,e))return t=[n+e],fr[e]=t,t;return le.warn("Property not supported by the browser: ",e),fr[e]=null,null}function O(e,t,n){let i=e==null?void 0:e.style;if(!i)return;if(t.startsWith("--")){i.setProperty(t,n||" ");return}let r=gC(t);if(r)for(let o of r){switch(o){case"-webkit-text-combine":switch(n){case"all":n="horizontal";break}break;case"text-combine-upright":switch(n){case"all":i.setProperty("text-indent","0");break}break}i.setProperty(o,n)}}function mi(e,t,n){try{let i=fr[t];return e.style.getPropertyValue(i?i[0]:t)}catch{}return n||""}function Yh(e){let t=e.getAttributeNS("http://www.w3.org/XML/1998/namespace","lang");return!t&&e.namespaceURI=="http://www.w3.org/1999/xhtml"&&(t=e.getAttribute("lang")),t}var ti=class{constructor(){d(this,"list",[])}append(e){return this.list.push(e),this}clear(){this.list=[]}toString(){let e=this.list.join("");return this.list=[e],e}};function Hw(e){return`\\${e.charCodeAt(0).toString(16)} `}function Ni(e){return e.replace(/[^-_a-zA-Z0-9\u0080-\uFFFF]/g,Hw)}function Ws(e){return e.replace(/[\u0000-\u001F"\\]/g,Hw)}function Gf(e){return e.replace(/[\s+&?=#\u007F-\uFFFF]+/g,encodeURIComponent)}function Xf(e){return!!e.match(/^[a-zA-Z\u009E\u009F\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u024F\u037B-\u037D\u0386\u0388-\u0482\u048A-\u0527]$/)}function mC(e,t){return t=typeof t=="string"?t:"\\u",t+(65536|e.charCodeAt(0)).toString(16).substr(1)}function Ww(e,t){function n(i){return mC(i,t)}return e.replace(/[^-a-zA-Z0-9_]/g,n)}function ui(e){return Ww(e)}function vC(e,t){return t=typeof t=="string"?t:"\\u",e.indexOf(t)===0?String.fromCharCode(parseInt(e.substring(t.length),16)):e}function wC(e,t){t=typeof t=="string"?t:"\\u";function n(r){return vC(r,t)}let i=new RegExp(`${ui(t)}[0-9a-fA-F]{4}`,"g");return e.replace(i,n)}function Ai(e,t){let n=0,i=e;for(;;){if(n==0||t(n-1),i==e||t(i),n==i)return n;let r=n+i>>1;t(r)?i=r:n=r+1}}function jw(e,t){return e-t}function Yf(e,t){let n={};for(let i of e){let r=t(i);r&&!n[r]&&(n[r]=i)}return n}function yC(e){let t={};for(let n=0;n<e.length;n++)t[e[n]]=!0;return t}function $u(e,t){let n={};for(let i of e){let r=t(i);r&&(n[r]?n[r].push(i):n[r]=[i])}return n}function xC(e,t){let n={};for(let i in e)n[i]=t(e[i],i);return n}var Vd=class{constructor(){d(this,"listeners",{})}dispatchEvent(e){let t=this.listeners[e.type];if(t){e.target=this,e.currentTarget=this;for(let n=0;n<t.length;n++)t[n](e)}}addEventListener(e,t,n){if(n)return;let i=this.listeners[e];i?i.includes(t)||i.push(t):this.listeners[e]=[t]}removeEventListener(e,t,n){if(n)return;let i=this.listeners[e];if(i){let r=i.indexOf(t);r>=0&&i.splice(r,1)}}},qi={audio:!0,canvas:!0,embed:!0,iframe:!0,img:!0,math:!0,object:!0,picture:!0,svg:!0,video:!0};function Gw(e){if(e.nodeType==1){let t=e.getAttribute("id");if(t)return t}return null}function bC(e){return`^${e}`}function qf(e){return e.replace(/[\[\]\(\),=;^]/g,bC)}function SC(e){return e.substr(1)}function qh(e){return e&&e.replace(/\^[\[\]\(\),=;^]/g,SC)}function CC(e){let t=[];do{let n=e.match(/^(\^,|[^,])*/),i=qh(n[0]);if(e=e.substr(n[0].length+1),!e&&!t.length)return i;t.push(i)}while(e);return t}function Kf(e){let t={};for(;e;){let n=e.match(/^;([^;=]+)=(([^;]|\^;)*)/);if(!n)return t;t[n[1]]=CC(n[2]),e=e.substr(n[0].length)}return t}var Qf=class{appendTo(e){e.append("!")}applyTo(e){return!1}},Zf=class{constructor(e,t,n){this.index=e,this.id=t,this.sideBias=n}appendTo(e){e.append("/"),e.append(this.index.toString()),(this.id||this.sideBias)&&(e.append("["),this.id&&e.append(this.id),this.sideBias&&(e.append(";s="),e.append(this.sideBias)),e.append("]"))}applyTo(e){if(e.node.nodeType!=1)throw new Error("E_CFI_NOT_ELEMENT");let t=e.node,n=t.children,i=n.length,r,o=Math.floor(this.index/2)-1;if(o<0||i==0)r=t.firstChild,e.node=r||t;else{if(r=n[Math.min(o,i-1)],this.index&1){let s=r.nextSibling;!s||s.nodeType==1?e.after=!0:r=s}e.node=r}if(this.id&&(e.after||this.id!=Gw(e.node))){let s=t.ownerDocument.getElementById(this.id);s?e.node=s:le.warn("E_CFI_ID_MISMATCH:",this.id)}return e.sideBias=this.sideBias,!0}},Jf=class{constructor(e,t,n,i){this.offset=e,this.textBefore=t,this.textAfter=n,this.sideBias=i}applyTo(e){if(this.offset>0&&!e.after){let t=this.offset,n=e.node;for(;;){let i=n.nodeType;if(i==1)break;let r=n.nextSibling;if(3<=i&&i<=5){let o=n.textContent.length;if(t<=o)break;if(!r){t=o;break}t-=o}if(!r){t=0;break}n=r}e.node=n,e.offset=t}return e.sideBias=this.sideBias,!0}appendTo(e){e.append(":"),e.append(this.offset.toString()),(this.textBefore||this.textAfter||this.sideBias)&&(e.append("["),(this.textBefore||this.textAfter)&&(this.textBefore&&e.append(qf(this.textBefore)),e.append(","),this.textAfter&&e.append(qf(this.textAfter))),this.sideBias&&(e.append(";s="),e.append(this.sideBias)),e.append("]"))}},eg=class Xw{constructor(){d(this,"steps",null)}fromString(t){let n=t.match(/^#?epubcfi\((.*)\)$/);if(!n)throw new Error("E_CFI_NOT_CFI");let i=decodeURIComponent(n[1]),r=0,o=[];for(;;){let s;switch(i.charAt(r)){case"/":{if(r++,n=i.substr(r).match(/^(0|[1-9][0-9]*)(\[(.*?)(;([^\]]|\^\])*)?\])?/),!n)throw new Error("E_CFI_NUMBER_EXPECTED");r+=n[0].length;let l=parseInt(n[1],10),a=n[3];s=Kf(n[4]),o.push(new Zf(l,a,jf(s.s)));break}case":":{if(r++,n=i.substr(r).match(/^(0|[1-9][0-9]*)(\[((([^\];,]|\^[\];,])*)(,(([^\];,]|\^[\];,])*))?)(;([^]]|\^\])*)?\])?/),!n)throw new Error("E_CFI_NUMBER_EXPECTED");r+=n[0].length;let l=parseInt(n[1],10),a=n[4];a&&(a=qh(a));let u=n[7];u&&(u=qh(u)),s=Kf(n[10]),o.push(new Jf(l,a,u,jf(s.s)));break}case"!":r++,o.push(new Qf);break;case"~":case"@":case"":this.steps=o;return;default:throw new Error("E_CFI_PARSE_ERROR")}}}navigate(t){let n={node:t.documentElement,offset:0,after:!1,sideBias:null,ref:null};for(let i=0;i<this.steps.length;i++)if(!this.steps[i].applyTo(n)){n.ref=new Xw,n.ref.steps=this.steps.slice(i+1);break}return n}trim(t,n){return t.replace(/\s+/g," ").match(n?/^[ -\uD7FF\uE000-\uFFFF]{0,8}/:/[ -\uD7FF\uE000-\uFFFF]{0,8}$/)[0].replace(/^\s/,"").replace(/\s$/,"")}prependPathFromNode(t,n,i,r){let o=[],s=t.parentNode,l="",a="";for(;t;){switch(t.nodeType){case 3:case 4:case 5:{let u=t.textContent,h=u.length;i?(n+=h,l||(l=u)):(n>h&&(n=h),i=!0,l=u.substr(0,n),a=u.substr(n)),t=t.previousSibling;continue}case 8:t=t.previousSibling;continue}break}for((n>0||l||a)&&(l=this.trim(l,!1),a=this.trim(a,!0),o.push(new Jf(n,l,a,r)),r=null);s&&!(!s||s.nodeType==9);){let u=i?null:Gw(t),h=i?1:0;for(;t;)t.nodeType==1&&(h+=2),t=t.previousSibling;o.push(new Zf(h,u,r)),r=null,t=s,s=s.parentNode,i=!1}o.reverse(),this.steps?(o.push(new Qf),this.steps=o.concat(this.steps)):this.steps=o}toString(){if(!this.steps)return"";let t=new ti;t.append("epubcfi(");for(let n=0;n<this.steps.length;n++)this.steps[n].appendTo(t);return t.append(")"),t.toString().replace(/%/g,"%25")}};function Yw(){return{fontFamily:"serif",lineHeight:1.25,margin:8,hyphenate:!1,columnWidth:25,horizontal:!1,nightMode:!1,spreadView:!1,pageBorder:1,enabledMediaTypes:{vivliostyle:!0,print:!0},defaultPaperSize:void 0}}function qw(e){return{fontFamily:e.fontFamily,lineHeight:e.lineHeight,margin:e.margin,hyphenate:e.hyphenate,columnWidth:e.columnWidth,horizontal:e.horizontal,nightMode:e.nightMode,spreadView:e.spreadView,pageBorder:e.pageBorder,enabledMediaTypes:Object.assign({},e.enabledMediaTypes),defaultPaperSize:e.defaultPaperSize?Object.assign({},e.defaultPaperSize):void 0}}var kC=Yw(),tg={PENDING:{}};function Kw(e,t,n,i){let r=Math.min((e-0)/n,(t-0)/i);return`matrix(${r},0,0,${r},0,0)`}function Du(e){return`"${Ws(`${e}`)}"`}function EC(e){return Ni(`${e}`)}function Kh(e,t){return e?`${Ni(e)}.${Ni(t)}`:Ni(t)}var Qw=0,Qh=class{constructor(e,t){if(this.parent=e,this.resolver=t,d(this,"scopeKey"),d(this,"children",[]),d(this,"zero"),d(this,"one"),d(this,"_true"),d(this,"_false"),d(this,"values",{}),d(this,"funcs",{}),d(this,"builtIns",{}),this.scopeKey=`S${Qw++}`,this.zero=new dt(this,0),this.one=new dt(this,1),this._true=new dt(this,!0),this._false=new dt(this,!1),e&&e.children.push(this),!e){let n=this.builtIns;n.floor=Math.floor,n.ceil=Math.ceil,n.round=Math.round,n.sqrt=Math.sqrt,n.min=Math.min,n.max=Math.max,n.letterbox=Kw,n["css-string"]=Du,n["css-name"]=EC,n.typeof=i=>typeof i,this.defineBuiltInName("page-width",function(){return this.pageWidth()}),this.defineBuiltInName("page-height",function(){return this.pageHeight()}),this.defineBuiltInName("pref-font-family",function(){return this.pref.fontFamily}),this.defineBuiltInName("pref-night-mode",function(){return this.pref.nightMode}),this.defineBuiltInName("pref-hyphenate",function(){return this.pref.hyphenate}),this.defineBuiltInName("pref-margin",function(){return this.pref.margin}),this.defineBuiltInName("pref-line-height",function(){return this.pref.lineHeight}),this.defineBuiltInName("pref-column-width",function(){return this.pref.columnWidth*this.fontSize}),this.defineBuiltInName("pref-horizontal",function(){return this.pref.horizontal}),this.defineBuiltInName("pref-spread-view",function(){return this.pref.spreadView}),this.defineBuiltInName("pub-title",function(){return Du(this.pubTitle?this.pubTitle:"")}),this.defineBuiltInName("doc-title",function(){return Du(this.docTitle?this.docTitle:"")})}}defineBuiltInName(e,t){this.values[e]=new mt(this,t,e)}defineName(e,t){this.values[e]=t}defineFunc(e,t){this.funcs[e]=t}defineBuiltIn(e,t){this.builtIns[e]=t}};function PC(e){switch(e==null?void 0:e.toLowerCase()){case"px":case"in":case"pt":case"pc":case"cm":case"mm":case"q":return!0;default:return!1}}function Zw(e){switch(e==null?void 0:e.toLowerCase()){case"vw":case"vh":case"vi":case"vb":case"vmin":case"vmax":case"pvw":case"pvh":case"pvi":case"pvb":case"pvmin":case"pvmax":return!0;default:return!1}}function NC(e){switch(e==null?void 0:e.toLowerCase()){case"em":case"ex":case"rem":case"lh":case"rlh":return!0;default:return!1}}function TC(e){switch(e==null?void 0:e.toLowerCase()){case"rem":case"rlh":return!0;default:return!1}}var $e={px:1,in:96,pt:4/3,pc:96/6,cm:96/2.54,mm:96/25.4,q:96/2.54/40,em:16,rem:16,ex:8,lh:20,rlh:20,dppx:1,dpi:1/96,dpcm:2.54/96};function Jw(e){switch(e){case"q":return!CSS.supports("font-size","1q");case"lh":return!CSS.supports("line-height","1lh");case"rem":case"rlh":return!0;default:return!1}}var Zh=class{constructor(e,t,n,i){this.rootScope=e,this.viewportWidth=t,this.viewportHeight=n,d(this,"actualPageWidth",null),d(this,"pageWidth"),d(this,"actualPageHeight",null),d(this,"pageHeight"),d(this,"initialFontSize"),d(this,"rootFontSize",null),d(this,"isRelativeRootFontSize",null),d(this,"fontSize"),d(this,"rootLineHeight",null),d(this,"pref"),d(this,"scopes",{}),d(this,"pageAreaWidth",null),d(this,"pageAreaHeight",null),d(this,"pageVertical",null),d(this,"pubTitle",null),d(this,"docTitle",null),this.pageWidth=function(){return this.actualPageWidth?this.actualPageWidth:this.pref.spreadView?Math.floor(t/2)-this.pref.pageBorder:t},this.pageHeight=function(){return this.actualPageHeight?this.actualPageHeight:n},this.initialFontSize=i,this.fontSize=function(){return this.rootFontSize?this.rootFontSize:i},this.pref=kC}getScopeContext(e){let t=this.scopes[e.scopeKey];return t||(t={},this.scopes[e.scopeKey]=t),t}clearScope(e){this.scopes[e.scopeKey]={};for(let t=0;t<e.children.length;t++)this.clearScope(e.children[t])}queryUnitSize(e,t,n){if(Zw(e)){let i=this.pageWidth()/100,r=this.pageHeight()/100,o=this.pageAreaWidth!=null?this.pageAreaWidth/100:i,s=this.pageAreaHeight!=null?this.pageAreaHeight/100:r,l=n??this.pageVertical;switch(e){case"vw":return o;case"vh":return s;case"vi":return l?s:o;case"vb":return l?o:s;case"vmin":return o<s?o:s;case"vmax":return o>s?o:s;case"pvw":return i;case"pvh":return r;case"pvi":return l?r:i;case"pvb":return l?i:r;case"pvmin":return i<r?i:r;case"pvmax":return i>r?i:r}}return e=="em"||e=="rem"?t?this.initialFontSize:this.fontSize():e=="ex"?$e.ex*(t?this.initialFontSize:this.fontSize())/$e.em:e=="lh"||e=="rlh"?this.rootLineHeight:$e[e]}evalName(e,t){do{let n=e.values[t];if(n||e.resolver&&(n=e.resolver.call(this,t,!1),n))return n;e=e.parent}while(e);throw new Error(`Name '${t}' is undefined`)}evalCall(e,t,n,i){do{let r=e.funcs[t];if(r||e.resolver&&(r=e.resolver.call(this,t,!0),r))return r;let o=e.builtIns[t];if(o){if(i)return e.zero;let s=Array(n.length);for(let l=0;l<n.length;l++)s[l]=n[l].evaluate(this);return new dt(e,o.apply(this,s))}e=e.parent}while(e);throw new Error(`Function '${t}' is undefined`)}evalMediaName(e,t){let n=e==="all"||!!this.pref.enabledMediaTypes[e];return t?!n:n}evalMediaTest(e,t){let n="",i=e.match(/^(min|max)-(.*)$/);i&&(n=i[1],e=i[2]);let r=null,o=null;switch(e){case"width":case"height":case"device-width":case"device-height":case"color":t&&(r=t.evaluate(this));break}switch(e){case"width":o=this.pageWidth();break;case"height":o=this.pageHeight();break;case"device-width":o=window.screen.availWidth;break;case"device-height":o=window.screen.availHeight;break;case"color":o=window.screen.pixelDepth;break}if(o!=null&&r!=null)switch(n){case"min":return o>=Number(r);case"max":return o<=Number(r);default:return o==r}else if(o!=null&&t==null)return o!==0;return!1}evalSupportsTest(e,t,n){return!1}queryVal(e,t){let n=e&&this.scopes[e.scopeKey];return n?n[t]:void 0}storeVal(e,t,n){this.getScopeContext(e)[t]=n}},bn=class{constructor(e){this.scope=e,d(this,"key"),this.scope=e,this.key=`_${Qw++}`}toString(){let e=new ti;return this.appendTo(e,0),e.toString()}appendTo(e,t){throw new Error("F_ABSTRACT")}evaluateCore(e){throw new Error("F_ABSTRACT")}expand(e,t){return this}dependCore(e,t,n){return e===this}dependOuter(e,t,n){let i=n[this.key];if(i!=null)return i===tg.PENDING?!1:i;{n[this.key]=tg.PENDING;let r=this.dependCore(e,t,n);return n[this.key]=r,r}}depend(e,t){return this.dependOuter(e,t,{})}evaluate(e){let t=e.queryVal(this.scope,this.key);return typeof t<"u"||(t=this.evaluateCore(e),this.scope&&e.storeVal(this.scope,this.key,t)),t}isMediaName(){return!1}},ey=class extends bn{constructor(e,t){super(e),this.val=t}getOp(){throw new Error("F_ABSTRACT")}evalPrefix(e){throw new Error("F_ABSTRACT")}evaluateCore(e){let t=this.val.evaluate(e);return this.evalPrefix(t)}dependCore(e,t,n){return e===this||this.val.dependOuter(e,t,n)}appendTo(e,t){10<t&&e.append("("),e.append(this.getOp()),this.val.appendTo(e,10),10<t&&e.append(")")}expand(e,t){let n=this.val.expand(e,t);return n===this.val?this:new this.constructor(this.scope,n)}},Za=class extends bn{constructor(e,t,n){super(e),this.lhs=t,this.rhs=n}getPriority(){throw new Error("F_ABSTRACT")}getOp(){throw new Error("F_ABSTRACT")}evalInfix(e,t){throw new Error("F_ABSTRACT")}evaluateCore(e){let t=this.lhs.evaluate(e),n=this.rhs.evaluate(e);return this.evalInfix(t,n)}dependCore(e,t,n){return e===this||this.lhs.dependOuter(e,t,n)||this.rhs.dependOuter(e,t,n)}appendTo(e,t){let n=this.getPriority();n<=t&&e.append("("),this.lhs.appendTo(e,n),e.append(this.getOp()),this.rhs.appendTo(e,n),n<=t&&e.append(")")}expand(e,t){let n=this.lhs.expand(e,t),i=this.rhs.expand(e,t);return n===this.lhs&&i===this.rhs?this:new this.constructor(this.scope,n,i)}},ty=class extends Za{constructor(e,t,n){super(e,t,n)}getPriority(){return 1}},ao=class extends Za{constructor(e,t,n){super(e,t,n)}getPriority(){return 2}},ny=class extends Za{constructor(e,t,n){super(e,t,n)}getPriority(){return 3}},Ud=class extends Za{constructor(e,t,n){super(e,t,n)}getPriority(){return 4}},Ti=class extends ey{constructor(e,t){super(e,t)}getOp(){return"!"}evalPrefix(e){return!e}},IC=class extends Ti{constructor(e,t){super(e,t)}getOp(){return"not "}},Ar=class extends ey{constructor(e,t){super(e,t)}getOp(){return"-"}evalPrefix(e){return-e}},Hd=class extends ty{constructor(e,t,n){super(e,t,n)}getOp(){return"&&"}evaluateCore(e){return this.lhs.evaluate(e)&&this.rhs.evaluate(e)}},RC=class extends Hd{constructor(e,t,n){super(e,t,n)}getOp(){return" and "}},Wd=class extends ty{constructor(e,t,n){super(e,t,n)}getOp(){return"||"}evaluateCore(e){return this.lhs.evaluate(e)||this.rhs.evaluate(e)}},AC=class extends Wd{constructor(e,t,n){super(e,t,n)}getOp(){return", "}},LC=class extends Wd{constructor(e,t,n){super(e,t,n)}getOp(){return" or "}},FC=class extends ao{constructor(e,t,n){super(e,t,n)}getOp(){return"<"}evalInfix(e,t){return e<t}},OC=class extends ao{constructor(e,t,n){super(e,t,n)}getOp(){return"<="}evalInfix(e,t){return e<=t}},BC=class extends ao{constructor(e,t,n){super(e,t,n)}getOp(){return">"}evalInfix(e,t){return e>t}},Jh=class extends ao{constructor(e,t,n){super(e,t,n)}getOp(){return">="}evalInfix(e,t){return e>=t}},jd=class extends ao{constructor(e,t,n){super(e,t,n)}getOp(){return"=="}evalInfix(e,t){return e==t}},_C=class extends ao{constructor(e,t,n){super(e,t,n)}getOp(){return"!="}evalInfix(e,t){return e!=t}},iy=class extends ny{constructor(e,t,n){super(e,t,n)}getOp(){return"+"}evalInfix(e,t){return e+t}},ry=class extends ny{constructor(e,t,n){super(e,t,n)}getOp(){return" - "}evalInfix(e,t){return e-t}},Gd=class extends Ud{constructor(e,t,n){super(e,t,n)}getOp(){return"*"}evalInfix(e,t){return e*t}},oy=class extends Ud{constructor(e,t,n){super(e,t,n)}getOp(){return"/"}evalInfix(e,t){return e/t}},sy=class extends Ud{constructor(e,t,n){super(e,t,n)}getOp(){return"%"}evalInfix(e,t){return e%t}},js=class extends bn{constructor(e,t,n){var i;super(e),this.num=t,d(this,"unit"),this.unit=(i=n==null?void 0:n.toLowerCase())!=null?i:""}appendTo(e,t){e.append(this.num.toString()),e.append(Ni(this.unit))}evaluateCore(e){return this.num*e.queryUnitSize(this.unit,!1)}},lt=class extends bn{constructor(e,t){super(e),this.qualifiedName=t}appendTo(e,t){e.append(this.qualifiedName)}evaluateCore(e){return e.evalName(this.scope,this.qualifiedName).evaluate(e)}dependCore(e,t,n){return e===this||t.evalName(this.scope,this.qualifiedName).dependOuter(e,t,n)}},ng=class extends bn{constructor(e,t,n){super(e),this.not=t,this.name=n}appendTo(e,t){this.not&&e.append("not "),e.append(Ni(this.name))}evaluateCore(e){return e.evalMediaName(this.name,this.not)}isMediaName(){return!0}},mt=class extends bn{constructor(e,t,n){super(e),this.fn=t,this.str=n}appendTo(e,t){e.append(this.str)}evaluateCore(e){return this.fn.call(e)}};function MC(e,t){e.append("(");for(let n=0;n<t.length;n++)n&&e.append(","),t[n].appendTo(e,0);e.append(")")}function zC(e,t,n){let i=t;for(let r=0;r<t.length;r++){let o=t[r].expand(e,n);if(t!==i)i[r]=o;else if(o!==t[r]){i=Array(t.length);for(let s=0;s<r;s++)i[s]=t[s];i[r]=o}}return i}var Qo=class ly extends bn{constructor(t,n,i){super(t),this.qualifiedName=n,this.params=i}appendTo(t,n){t.append(this.qualifiedName),MC(t,this.params)}evaluateCore(t){return t.evalCall(this.scope,this.qualifiedName,this.params,!1).expand(t,this.params).evaluate(t)}dependCore(t,n,i){if(t===this)return!0;for(let r=0;r<this.params.length;r++)if(this.params[r].dependOuter(t,n,i))return!0;return n.evalCall(this.scope,this.qualifiedName,this.params,!0).dependOuter(t,n,i)}expand(t,n){let i=zC(t,this.params,n);return i===this.params?this:new ly(this.scope,this.qualifiedName,i)}},$C=class ay extends bn{constructor(t,n,i,r){super(t),this.cond=n,this.ifTrue=i,this.ifFalse=r}appendTo(t,n){n>0&&t.append("("),this.cond.appendTo(t,0),t.append("?"),this.ifTrue.appendTo(t,0),t.append(":"),this.ifFalse.appendTo(t,0),n>0&&t.append(")")}evaluateCore(t){return this.cond.evaluate(t)?this.ifTrue.evaluate(t):this.ifFalse.evaluate(t)}dependCore(t,n,i){return t===this||this.cond.dependOuter(t,n,i)||this.ifTrue.dependOuter(t,n,i)||this.ifFalse.dependOuter(t,n,i)}expand(t,n){let i=this.cond.expand(t,n),r=this.ifTrue.expand(t,n),o=this.ifFalse.expand(t,n);return i===this.cond&&r===this.ifTrue&&o===this.ifFalse?this:new ay(this.scope,i,r,o)}},dt=class extends bn{constructor(e,t){super(e),this.val=t}appendTo(e,t){switch(typeof this.val){case"number":case"boolean":e.append(this.val.toString());break;case"string":e.append('"'),e.append(Ws(this.val)),e.append('"');break;default:throw new Error("F_UNEXPECTED_STATE")}}evaluateCore(e){return this.val}},ig=class uy extends bn{constructor(t,n,i){super(t),this.name=n,this.value=i}appendTo(t,n){t.append("("),t.append(Ws(this.name.name)),t.append(":"),this.value.appendTo(t,0),t.append(")")}evaluateCore(t){return t.evalMediaTest(this.name.name,this.value)}dependCore(t,n,i){return t===this||this.value.dependOuter(t,n,i)}expand(t,n){let i=this.value.expand(t,n);return i===this.value?this:new uy(this.scope,this.name,i)}},DC=class extends bn{constructor(e,t,n,i){super(e),this.name=t,this.value=n,this.isFunc=i}appendTo(e,t){this.isFunc&&e.append(this.name),e.append("("),!this.isFunc&&this.name&&(e.append(this.name),e.append(":")),e.append(this.value),e.append(")")}evaluateCore(e){return e.evalSupportsTest(this.name,this.value,this.isFunc)}},hy=class extends bn{constructor(e,t){super(e),this.index=t}appendTo(e,t){e.append("$"),e.append(this.index.toString())}expand(e,t){let n=t[this.index];if(!n)throw new Error(`Parameter missing: ${this.index}`);return n}};function mn(e,t,n){return t===e._false||t===e.zero||n==e._false||n==e.zero?e._false:t===e._true||t===e.one?n:n===e._true||n===e.one?t:new Hd(e,t,n)}function Ce(e,t,n){return t===e.zero?n:n===e.zero?t:new iy(e,t,n)}function Fe(e,t,n){return t===e.zero?new Ar(e,n):n===e.zero?t:new ry(e,t,n)}function Vl(e,t,n){return t===e.zero||n===e.zero?e.zero:t===e.one?n:n===e.one?t:new Gd(e,t,n)}function ec(e,t,n){return t===e.zero?e.zero:n===e.one?t:new oy(e,t,n)}var li=class{visitValues(e){for(let t=0;t<e.length;t++)e[t].visit(this);return null}visitEmpty(e){return null}visitSlash(e){return null}visitStr(e){return null}visitIdent(e){return null}visitNumeric(e){return null}visitNum(e){return null}visitInt(e){return this.visitNum(e)}visitHexColor(e){return null}visitURL(e){return null}visitURange(e){return null}visitSpaceList(e){return this.visitValues(e.values),null}visitCommaList(e){return this.visitValues(e.values),null}visitFunc(e){return this.visitValues(e.values),null}visitExpr(e){return null}},uo=class extends li{constructor(){super(),d(this,"error",!1)}visitValues(e){let t=null;for(let n=0;n<e.length;n++){let i=e[n],r=i.visit(this);if(this.error)return[];if(t)t[n]=r;else if(i!==r){t=new Array(e.length);for(let o=0;o<n;o++)t[o]=e[o];t[n]=r}}return t||e}visitEmpty(e){return e}visitStr(e){return e}visitIdent(e){return e}visitSlash(e){return e}visitNumeric(e){return e}visitNum(e){return e}visitInt(e){return e}visitHexColor(e){return e}visitURL(e){return e}visitURange(e){return e}visitSpaceList(e){let t=this.visitValues(e.values);return this.error?fe:t===e.values?e:new Ge(t)}visitCommaList(e){let t=this.visitValues(e.values);return this.error?fe:t===e.values?e:new Mt(t)}visitFunc(e){let t=this.visitValues(e.values);return this.error?fe:t===e.values?e:new ho(e.name,t)}visitExpr(e){return e}},Et=class{toString(){let e=new ti;return this.appendTo(e,!0),e.toString()}stringValue(){let e=new ti;return this.appendTo(e,!1),e.toString()}toExpr(e,t){return null}appendTo(e,t){e.append("[error]")}isExpr(){return!1}isNumeric(){return!1}isNum(){return!1}isIdent(){return!1}isSpaceList(){return!1}visit(e){return this}},cy=class dy extends Et{static get instance(){return this.empty||(this.empty=new dy),this.empty}constructor(){super()}toExpr(t,n){return new dt(t,"")}appendTo(t,n){}visit(t){return t.visitEmpty(this)}};d(cy,"empty");var VC=cy,fe=VC.instance,py=class fy extends Et{static get instance(){return this.slash||(this.slash=new fy),this.slash}constructor(){super()}toExpr(t,n){return new dt(t,"/")}appendTo(t,n){t.append("/")}visit(t){return t.visitSlash(this)}};d(py,"slash");var UC=py,Ja=UC.instance,ut=class extends Et{constructor(e){super(),this.str=e}toExpr(e,t){return new dt(e,this.str)}appendTo(e,t){t?(e.append('"'),e.append(Ws(this.str)),e.append('"')):e.append(this.str)}visit(e){return e.visitStr(this)}},tc={},Jt=class extends Et{constructor(e){if(super(),this.name=e,tc[e])throw new Error("E_INVALID_CALL");tc[e]=this}toExpr(e,t){return new dt(e,this.name)}appendTo(e,t){t?e.append(Ni(this.name)):e.append(this.name)}visit(e){return e.visitIdent(this)}isIdent(){return!0}};function q(e){let t=tc[e];return t||(t=new Jt(e)),t}var z=class extends Et{constructor(e,t){var n;super(),this.num=e,d(this,"unit"),this.unit=(n=t==null?void 0:t.toLowerCase())!=null?n:""}toExpr(e,t){return this.num==0?e.zero:t&&this.unit=="%"?this.num==100?t:new Gd(e,t,new dt(e,this.num/100)):new js(e,this.num,this.unit)}appendTo(e,t){e.append(this.num.toString()),e.append(this.unit)}visit(e){return e.visitNumeric(this)}isNumeric(){return!0}},$i=class extends Et{constructor(e){super(),this.num=e}toExpr(e,t){return this.num==0?e.zero:this.num==1?e.one:new dt(e,this.num)}appendTo(e,t){e.append(this.num.toString())}visit(e){return e.visitNum(this)}isNum(){return!0}},ar=class extends $i{constructor(e){super(e)}visit(e){return e.visitInt(this)}},gy=class extends Et{constructor(e){super(),this.hex=e}appendTo(e,t){e.append("#"),e.append(this.hex)}visit(e){return e.visitHexColor(this)}},Nn=class extends Et{constructor(e){super(),this.url=e}appendTo(e,t){e.append('url("'),e.append(Ws(this.url)),e.append('")')}visit(e){return e.visitURL(this)}},my=class extends Et{constructor(e){super(),this.urangeText=e}appendTo(e,t){e.append(this.urangeText)}visit(e){return e.visitURange(this)}};function Xd(e,t,n,i){var r,o;let s=t.length;if(s>0){(r=t[0])==null||r.appendTo(e,i);for(let l=1;l<s;l++)e.append(n),(o=t[l])==null||o.appendTo(e,i)}}var Ge=class extends Et{constructor(e){super(),this.values=e}appendTo(e,t){Xd(e,this.values," ",t)}visit(e){return e.visitSpaceList(this)}isSpaceList(){return!0}},Mt=class extends Et{constructor(e){super(),this.values=e}appendTo(e,t){Xd(e,this.values,",",t)}visit(e){return e.visitCommaList(this)}},ho=class extends Et{constructor(e,t){super(),this.name=e,this.values=t}appendTo(e,t){e.append(Ni(this.name)),e.append("("),Xd(e,this.values,",",t),e.append(")")}visit(e){return e.visitFunc(this)}},re=class extends Et{constructor(e){super(),this.expr=e}toExpr(){return this.expr}appendTo(e,t){this.expr instanceof dt||this.expr instanceof js?this.expr.appendTo(e,0):(e.append("-epubx-expr("),this.expr.appendTo(e,0),e.append(")"))}visit(e){return e.visitExpr(this)}isExpr(){return!0}},Eo=class extends Et{constructor(e){super(),this.text=e}appendTo(e,t){e.append(this.text||" ")}};function Ft(e,t){if(e){if(e.isNumeric()){let n=e;return t.queryUnitSize(n.unit,!1)*n.num}if(e.isNum())return e.num}return 0}function vy(e,t){return new z(Ft(e,t),"px")}var S={absolute:q("absolute"),all:q("all"),always:q("always"),anywhere:q("anywhere"),auto:q("auto"),avoid:q("avoid"),balance:q("balance"),balance_all:q("balance-all"),block:q("block"),block_end:q("block-end"),block_start:q("block-start"),both:q("both"),bottom:q("bottom"),border_box:q("border-box"),break_all:q("break-all"),break_word:q("break-word"),clip:q("clip"),crop:q("crop"),cross:q("cross"),column:q("column"),discard:q("discard"),exclusive:q("exclusive"),_false:q("false"),fixed:q("fixed"),flex:q("flex"),flow_root:q("flow-root"),footnote:q("footnote"),footer:q("footer"),grid:q("grid"),header:q("header"),hidden:q("hidden"),horizontal_tb:q("horizontal-tb"),inherit:q("inherit"),initial:q("initial"),inline:q("inline"),inline_block:q("inline-block"),inline_end:q("inline-end"),inline_start:q("inline-start"),inside:q("inside"),keep:q("keep"),landscape:q("landscape"),left:q("left"),line:q("line"),list_item:q("list-item"),ltr:q("ltr"),manual:q("manual"),max_content:q("max-content"),min_content:q("min-content"),none:q("none"),normal:q("normal"),oeb_page_foot:q("oeb-page-foot"),oeb_page_head:q("oeb-page-head"),outside:q("outside"),padding_box:q("padding-box"),page:q("page"),relative:q("relative"),revert:q("revert"),right:q("right"),same:q("same"),scale:q("scale"),snap_block:q("snap-block"),snap_inline:q("snap-inline"),solid:q("solid"),spread:q("spread"),_static:q("static"),rtl:q("rtl"),table:q("table"),table_caption:q("table-caption"),table_cell:q("table-cell"),table_footer_group:q("table-footer-group"),table_header_group:q("table-header-group"),table_row:q("table-row"),top:q("top"),transparent:q("transparent"),unset:q("unset"),vertical_lr:q("vertical-lr"),vertical_rl:q("vertical-rl"),visible:q("visible"),_true:q("true")},rg=new z(100,"%"),Gs=new z(100,"pvw"),Xs=new z(100,"pvh"),Ve=new z(0,"px");new my("U+0-10FFFF");var og={"font-size":1,"line-height":2,color:3};function Te(e){return e===S.inherit||e===S.initial||e===S.revert||e===S.unset}function sg(e,t){let n=og[e]||Number.MAX_VALUE,i=og[t]||Number.MAX_VALUE;return n-i}function ni(e){return(e==null?void 0:e.length)>2&&e.startsWith("--")}var on=class{constructor(e,t,n,i){this.x1=e,this.y1=t,this.x2=n,this.y2=i}},vi=class{constructor(e,t){this.x=e,this.y=t}},Vu=class{constructor(e,t,n,i){this.left=e,this.top=t,this.right=n,this.bottom=i}},lg=class{constructor(e,t,n,i){this.low=e,this.high=t,this.winding=n,this.shapeId=i}},qn=class{constructor(e,t,n,i){this.y1=e,this.y2=t,this.x1=n,this.x2=i,d(this,"left",null),d(this,"right",null)}};function HC(e,t){return e.low.y-t.low.y||e.low.x-t.low.x}var eu=class wy{constructor(t){this.points=t}addSegments(t,n){let i=this.points,r=i.length,o=i[r-1];for(let s=0;s<r;s++){let l=i[s],a;o.y<l.y?a=new lg(o,l,1,n):a=new lg(l,o,-1,n),t.push(a),o=l}}withOffset(t,n){let i=[];for(let r of this.points)i.push(new vi(r.x+t,r.y+n));return new wy(i)}};function ag(e,t,n,i){let r=[];for(let o=0;o<20;o++){let s=o*2*Math.PI/20;r.push(new vi(e+n*Math.sin(s),t+i*Math.cos(s)))}return new eu(r)}function Yd(e,t,n,i){return new eu([new vi(e,t),new vi(n,t),new vi(n,i),new vi(e,i)])}var bl=class{constructor(e,t,n,i){this.x=e,this.winding=t,this.shapeId=n,this.lowOrHigh=i}};function ug(e,t){let n=e.low.x+(e.high.x-e.low.x)*(t-e.low.y)/(e.high.y-e.low.y);if(isNaN(n))throw new Error("Bad intersection");return n}function WC(e,t,n,i){let r,o,s,l;t.high.y<n&&le.warn("Error: inconsistent segment (1)"),t.low.y<=n?(r=ug(t,n),o=t.winding):(r=t.low.x,o=0),t.high.y>=i?(s=ug(t,i),l=t.winding):(s=t.high.x,l=0),r<s?(e.push(new bl(r,o,t.shapeId,-1)),e.push(new bl(s,l,t.shapeId,1))):(e.push(new bl(s,l,t.shapeId,-1)),e.push(new bl(r,o,t.shapeId,1)))}function jC(e,t,n){let i=t+n,r=Array(i),o=Array(i),s;for(s=0;s<=i;s++)r[s]=0,o[s]=0;let l=[],a=!1,u=e.length;for(let h=0;h<u;h++){let p=e[h];r[p.shapeId]+=p.winding,o[p.shapeId]+=p.lowOrHigh;let c=!1;for(s=0;s<t;s++)if(r[s]&&!o[s]){c=!0;break}if(c){for(s=t;s<=i;s++)if(r[s]||o[s]){c=!1;break}}a!=c&&(l.push(p.x),a=c)}return l}function GC(e,t){return t?Math.ceil(e/t)*t:e}function hg(e,t){return t?Math.floor(e/t)*t:e}function XC(e){return new vi(e.y,-e.x)}function Sa(e){return new on(e.y1,-e.x2,e.y2,-e.x1)}function yy(e){return new on(-e.y2,e.x1,-e.y1,e.x2)}function cg(e){return new eu(e.points.map(t=>XC(t)))}function YC(e,t,n,i,r,o){o&&(e=Sa(e),t=t.map(m=>cg(m)),n=n.map(m=>cg(m)));let s=t.length,l=n?n.length:0,a=[],u=[],h,p,c;for(h=0;h<s;h++)t[h].addSegments(u,h);for(h=0;h<l;h++)n[h].addSegments(u,h+s);let f=u.length;u.sort(HC);let v=0;for(;u[v].shapeId>=s;)v++;let w=u[v].low.y;w>e.y1&&a.push(new qn(e.y1,w,e.x2,e.x2));let x=0,g=[];for(;x<f&&(c=u[x]).low.y<w;)c.high.y>w&&g.push(c),x++;for(;x<f||g.length>0;){let m=e.y2,y=Math.min(GC(Math.ceil(w+i),r),e.y2);for(p=0;p<g.length&&m>y;p++)c=g[p],c.low.x==c.high.x?c.high.y<m&&(m=Math.max(hg(c.high.y,r),y)):c.low.x!=c.high.x&&(m=y);for(m>e.y2&&(m=e.y2);x<f&&(c=u[x]).low.y<m;){if(c.high.y<w){x++;continue}if(c.low.y<y)c.low.y==c.high.y&&c.low.y==w||(g.push(c),m=y),x++;else{let A=hg(c.low.y,r);A<m&&(m=A);break}}let C=[];for(p=0;p<g.length;p++)WC(C,g[p],w,m);C.sort((A,I)=>A.x-I.x||A.lowOrHigh-I.lowOrHigh);let P=jC(C,s,l);if(P.length==0)a.push(new qn(w,m,e.x2,e.x2));else{let A=0,I=e.x1;for(p=0;p<P.length;p+=2){let M=Math.max(e.x1,P[p]),G=Math.min(e.x2,P[p+1])-M;G>A&&(A=G,I=M)}A==0?a.push(new qn(w,m,e.x2,e.x2)):a.push(new qn(w,m,Math.max(I,e.x1),Math.min(I+A,e.x2)))}if(m==e.y2)break;for(w=m,p=g.length-1;p>=0;p--)g[p].high.y<=m&&g.splice(p,1)}return xy(e,a),a}function xy(e,t){let n=t.length-1,i=new qn(e.y2,e.y2,e.x1,e.x2);for(;n>=0;){let r=i;i=t[n],(i.y2-i.y1<1||i.x1==r.x1&&i.x2==r.x2)&&(r.y1=i.y1,t.splice(n,1),i=r),n--}}function by(e,t){let n=0,i=e.length;for(;n<i;){let r=Math.floor((n+i)/2);t>=e[r].y2?n=r+1:i=r}return n}function qC(e,t){if(!e.length)return t;let n=t.y1,i,r;for(r=0;r<e.length&&(i=e[r],!(i.y2>t.y1&&i.x1-.1<=t.x1&&i.x2+.1>=t.x2));r++)n=Math.max(n,i.y2);let o=n;for(;r<e.length&&(i=e[r],!(i.y1>=t.y2||i.x1-.1>t.x1||i.x2+.1<t.x2));r++)o=i.y2;return r===e.length?o=t.y2:o=Math.min(o,t.y2),o<=n?null:new on(t.x1,n,t.x2,o)}function KC(e,t){if(!e.length)return t;let n=t.y2,i,r;for(r=e.length-1;r>=0&&(i=e[r],!(r===e.length-1&&i.y2<t.y2))&&!(i.y1<t.y2&&i.x1-.1<=t.x1&&i.x2+.1>=t.x2);r--)n=Math.min(n,i.y1);let o=Math.min(n,i.y2);for(;r>=0&&(i=e[r],!(i.y2<=t.y1||i.x1-.1>t.x1||i.x2+.1<t.x2));r--)o=i.y1;return o=Math.max(o,t.y1),n<=o?null:new on(t.x1,o,t.x2,n)}function QC(e,t,n,i){let r=n.y1,o=n.x2-n.x1,s=n.y2-n.y1,l=by(t,r);for(;;){let a=r+s;if(a>e.y2)return!1;let u=e.x1,h=e.x2;for(let p=l;p<t.length&&t[p].y1<a;p++){let c=t[p];c.x1>u&&(u=c.x1),c.x2<h&&(h=c.x2)}if(u+o<=h||l>=t.length)return i=="left"?(n.x1=u,n.x2=u+o):(n.x1=h-o,n.x2=h),n.y2+=r-n.y1,n.y1=r,!0;r=t[l].y2,l++}}function ZC(e,t,n,i,r){for(i||(i=[new qn(n.y1,n.y2,n.x1,n.x2)]);i.length>0&&i[0].y2<=e.y1;)i.shift();if(i.length==0)return;i[0].y1<e.y1&&(i[0].y1=e.y1);let o,s=t.length==0?e.y1:t[t.length-1].y2;s<e.y2&&t.push(new qn(s,e.y2,e.x1,e.x2));let l=by(t,i[0].y1);for(let a of i){if(l==t.length)break;for(t[l].y1<a.y1&&(o=t[l],l++,t.splice(l,0,new qn(a.y1,o.y2,o.x1,o.x2)),o.y2=a.y1);l<t.length&&(o=t[l++],o.y2>a.y2&&(t.splice(l,0,new qn(a.y2,o.y2,o.x1,o.x2)),o.y2=a.y2),a.x1!=a.x2&&(r=="left"?o.x1=Math.min(a.x2,e.x2):o.x2=Math.max(a.x1,e.x1)),o.y2!=a.y2););}xy(e,t)}var JC=class extends li{constructor(){super(),d(this,"propSet",{})}visitIdent(e){return this.propSet[e.name]=!0,e}visitSpaceList(e){return this.visitValues(e.values),e}};function ek(e){if(e){let t=new JC;try{return e.visit(t),t.propSet}catch(n){le.warn(n,"toSet:")}}return{}}var tk=class extends li{constructor(e){super(),this.value=e}visitInt(e){return this.value=e.num,e}};function dg(e,t){if(e){let n=new tk(t);try{return e.visit(n),n.value}catch(i){le.warn(i,"toInt: ")}}return t}var nk=class extends li{constructor(){super(),d(this,"collect",!1),d(this,"coords",[]),d(this,"name",null)}visitNumeric(e){return this.collect&&this.coords.push(e),null}visitNum(e){return this.collect&&e.num==0&&this.coords.push(new z(0,"px")),null}visitSpaceList(e){return this.visitValues(e.values),null}visitFunc(e){return this.collect||(this.collect=!0,this.visitValues(e.values),this.collect=!1,this.name=e.name.toLowerCase()),null}getShape(e,t,n,i,r){if(this.coords.length>0){let o=[];switch(this.coords.forEach((s,l)=>{if(s.unit=="%"){let a=l%2==0?n:i;l==3&&this.name=="circle"&&(a=Math.sqrt((n*n+i*i)/2)),o.push(s.num*a/100)}else o.push(s.num*r.queryUnitSize(s.unit,!1))}),this.name){case"polygon":if(o.length%2==0){let s=[];for(let l=0;l<o.length;l+=2)s.push(new vi(e+o[l],t+o[l+1]));return new eu(s)}break;case"rectangle":if(o.length==4)return Yd(e+o[0],t+o[1],e+o[0]+o[2],t+o[1]+o[3]);break;case"ellipse":if(o.length==4)return ag(e+o[0],t+o[1],o[2],o[3]);break;case"circle":if(o.length==3)return ag(e+o[0],t+o[1],o[2],o[2]);break}}return null}};function Sy(e,t,n,i,r,o){if(e){let s=new nk;try{return e.visit(s),s.getShape(t,n,i,r,o)}catch(l){le.warn(l,"toShape:")}}return Yd(t,n,t+i,n+r)}var ik=class extends li{constructor(e){super(),this.reset=e,d(this,"counters",{}),d(this,"name",null)}visitIdent(e){return this.name=e.toString(),this.reset?this.counters[this.name]=0:this.counters[this.name]=(this.counters[this.name]||0)+1,e}visitInt(e){return this.name&&(this.counters[this.name]+=e.num-(this.reset?0:1)),e}visitSpaceList(e){return this.visitValues(e.values),e}};function Zo(e,t){let n=new ik(t);try{e.visit(n)}catch(i){le.warn(i,"toCounters:")}return n.counters}var rk=class extends uo{constructor(e,t){super(),this.baseUrl=e,this.transformer=t}visitURL(e){return new Nn(this.transformer.transformURL(e.url,this.baseUrl))}};function Uu(e){let t={};return Object.keys(e).forEach(n=>{t[n]=Array.from(e[n])}),t}var ok=class{constructor(e,t){this.targetId=e,this.resolved=t,d(this,"pageCounters",null),d(this,"spineIndex",-1),d(this,"pageIndex",-1)}equals(e){return this===e?!0:e?this.targetId===e.targetId&&this.resolved===e.resolved&&this.spineIndex===e.spineIndex&&this.pageIndex===e.pageIndex:!1}isResolved(){return this.resolved}resolve(){this.resolved=!0}unresolve(){this.resolved=!1}},sk=class{constructor(e,t){this.counterStore=e,this.baseURL=t}countersOfId(e,t){e=this.counterStore.documentURLTransformer.transformFragment(e,this.baseURL),this.counterStore.countersById[e]=t}getExprContentListener(){return this.counterStore.getExprContentListener()}},lk=class{constructor(e,t,n,i){this.counterStore=e,this.baseURL=t,this.rootScope=n,this.pageScope=i,d(this,"styler",null),d(this,"namedStringValues",{}),d(this,"runningElements",{})}setStyler(e){this.styler=e}getFragment(e){let t=e.match(/^[^#]*#(.*)$/);return t?t[1]:null}getTransformedId(e){let t=this.counterStore.documentURLTransformer.transformURL(et(e,this.baseURL),this.baseURL);return t.charAt(0)==="#"&&(t=t.substring(1)),t}getPageCounterVal(e,t){let n=()=>{let o=this.counterStore.currentPageCounters[e];return o&&o.length?o[o.length-1]:null},i=new mt(this.pageScope,()=>t(n()),`page-counter-${e}`),r=o=>t(o[o.length-1]);return this.counterStore.registerPageCounterExpr(e,r,i),i}getPageCountersVal(e,t){let n=()=>this.counterStore.currentPageCounters[e]||[],i=new mt(this.pageScope,()=>t(n()),`page-counters-${e}`);return this.counterStore.registerPageCounterExpr(e,t,i),i}getTargetCounters(e,t,n){let i=this.counterStore.countersById[t];return!i&&n&&e&&(this.styler.styleUntilIdIsReached(e),i=this.counterStore.countersById[t]),i||null}getTargetPageCounters(e){return this.counterStore.currentPage.elementsById[e]?this.counterStore.currentPageCounters:this.counterStore.pageCountersById[e]||null}getTargetCounterVal(e,t,n){let i=this.getFragment(e),r=this.getTransformedId(e),o=this.getTargetCounters(i,r,!1);if(o&&o[t]){let l=o[t];return new dt(this.rootScope,n(l[l.length-1]||null))}let s=new mt(this.pageScope,()=>{if(o=this.getTargetCounters(i,r,!0),o)if(o[t]){let l=o[t];return n(l[l.length-1]||null)}else{let l=this.getTargetPageCounters(r);if(l)if(this.counterStore.resolveReference(r),l[t]){let a=l[t];return n(a[a.length-1]||null)}else return n(0);else return this.counterStore.saveReferenceOfCurrentPage(r,!1),"??"}else return this.counterStore.saveReferenceOfCurrentPage(r,!1),"??"},`target-counter-${t}-of-${e}`);return this.counterStore.registerTargetCounterExpr(t,n,s,r),s}getTargetCountersVal(e,t,n){let i=this.getFragment(e),r=this.getTransformedId(e);return new mt(this.pageScope,()=>{let o=this.getTargetPageCounters(r);if(o){this.counterStore.resolveReference(r);let s=o[t]||[],l=this.getTargetCounters(i,r,!0)[t]||[];return n(s.concat(l))}else return this.counterStore.saveReferenceOfCurrentPage(r,!1),"??"},`target-counters-${t}-of-${e}`)}getNamedStringVal(e,t){return new mt(this.pageScope,()=>this.getRunningValue(this.namedStringValues,e,t),`named-string-${t}-${e}`)}getRunningElementVal(e,t){return new mt(this.pageScope,()=>this.getRunningValue(this.runningElements,e,t),`running-element-${t}-${e}`)}getRunningValue(e,t,n){let i=e[t];if(!i)return"";let r=Object.keys(i).map(c=>parseInt(c,10)).sort(jw),o=this.counterStore.currentPage,s=o.isBlankPage?o.offset-1:o.offset,l=o.isBlankPage?s:Math.max(s,...Array.from(o.container.querySelectorAll(`[${jn}]`)).map(c=>parseInt(c.getAttribute(jn),10))),a=-1,u=-1,h=-1,p=-1;for(let c=0;c<r.length;c++){let f=r[c],v=c>0?r[c-1]:-1,w=c<r.length-1?r[c+1]:-1;if(f>l)break;if(f>=s){if(a<0&&(a=f,p=-1),u<0)if(f===s)u=f;else{v<a&&(u=v);let x=o.container.querySelector(`[${jn}="${f}"]`);if(!x)u<0&&(u=f);else{let g=o.container.querySelector(`[${jn}="${s}"]`);if(g||(g=o.container.querySelector(`[${jn}="0"]`)),g){for(let m=g;m;m=m.firstElementChild)if(m===x){u=f;break}}}}h=f}else(w>l||w<0)&&(a=u=h=p=f)}return i[{first:a,start:u,last:h,"first-except":p}[n]]||""}setNamedString(e,t,n){let i=this.namedStringValues[e]||(this.namedStringValues[e]={});i[n]=t}setRunningElement(e,t){let n=this.runningElements[e]||(this.runningElements[e]={});n[t]=String(t)}},ak=class{constructor(e){this.documentURLTransformer=e,d(this,"countersById",{}),d(this,"pageCountersById",{}),d(this,"currentPageCounters",{}),d(this,"previousPageCounters",{}),d(this,"currentPageCountersStack",[]),d(this,"pageIndicesById",{}),d(this,"currentPage",null),d(this,"newReferencesOfCurrentPage",[]),d(this,"referencesToSolve",[]),d(this,"referencesToSolveStack",[]),d(this,"unresolvedReferences",{}),d(this,"resolvedReferences",{}),d(this,"pagesCounterExprs",[]),d(this,"pageCounterExprs",[]),d(this,"targetCounterExprs",[]),this.currentPageCounters.page=[0]}createCounterListener(e){return new sk(this,e)}createCounterResolver(e,t,n){return new lk(this,e,t,n)}setCurrentPage(e){this.currentPage=e}definePageCounter(e,t){this.currentPageCounters[e]?this.currentPageCounters[e].push(t):this.currentPageCounters[e]=[t]}forceSetPageCounter(e){let t=this.currentPageCounters.page;!t||!t.length?this.currentPageCounters.page=[e]:t[t.length-1]=e}updatePageCounters(e,t){this.previousPageCounters=Uu(this.currentPageCounters);let n,i=e["counter-reset"];if(i){let s=i.evaluate(t);s&&(n=Zo(s,!0))}if(n)for(let s in n)this.definePageCounter(s,n[s]);let r,o=e["counter-increment"];if(o){let s=o.evaluate(t);s&&(r=Zo(s,!1))}r?"page"in r||(r.page=1):(r={},r.page=1);for(let s in r){this.currentPageCounters[s]||this.definePageCounter(s,0);let l=this.currentPageCounters[s];l[l.length-1]+=r[s]}}pushPageCounters(e){this.currentPageCountersStack.push(this.currentPageCounters),this.currentPageCounters=Uu(e)}popPageCounters(){this.currentPageCounters=this.currentPageCountersStack.pop()}resolveReference(e){let t=this.unresolvedReferences[e],n=this.resolvedReferences[e];n||(n=this.resolvedReferences[e]=[]);let i=!1;for(let r=0;r<this.referencesToSolve.length;){let o=this.referencesToSolve[r];if(o.targetId===e){if(o.resolve(),this.referencesToSolve.splice(r,1),t){let s=t.indexOf(o);s>=0&&t.splice(s,1)}n.push(o),i=!0}else r++}i||this.saveReferenceOfCurrentPage(e,!0)}saveReferenceOfCurrentPage(e,t){if(!this.newReferencesOfCurrentPage.some(n=>n.targetId===e)){let n=new ok(e,t);this.newReferencesOfCurrentPage.push(n)}}finishPage(e,t){let n=Object.keys(this.currentPage.elementsById);if(n.length>0){let o=Uu(this.currentPageCounters);n.forEach(s=>{this.pageCountersById[s]=o;let l=this.pageIndicesById[s];if(l&&l.pageIndex<t){let a=this.resolvedReferences[s];if(a){let u=this.unresolvedReferences[s];u||(u=this.unresolvedReferences[s]=[]);let h;for(;h=a.shift();)h.unresolve(),u.push(h)}}this.pageIndicesById[s]={spineIndex:e,pageIndex:t}})}let i=this.previousPageCounters,r;for(;r=this.newReferencesOfCurrentPage.shift();){r.pageCounters=i,r.spineIndex=e,r.pageIndex=t;let o;r.isResolved()?(o=this.resolvedReferences[r.targetId],o||(o=this.resolvedReferences[r.targetId]=[])):(o=this.unresolvedReferences[r.targetId],o||(o=this.unresolvedReferences[r.targetId]=[])),o.every(s=>!r.equals(s))&&o.push(r)}this.currentPage=null}getUnresolvedRefsToPage(e){let t=[];Object.keys(e.elementsById).forEach(r=>{let o=this.unresolvedReferences[r];o&&(t=t.concat(o))}),t.sort((r,o)=>r.spineIndex-o.spineIndex||r.pageIndex-o.pageIndex);let n=[],i=null;return t.forEach(r=>{!i||i.spineIndex!==r.spineIndex||i.pageIndex!==r.pageIndex?(i={spineIndex:r.spineIndex,pageIndex:r.pageIndex,pageCounters:r.pageCounters,refs:[r]},n.push(i)):i.refs.push(r)}),n}pushReferencesToSolve(e){this.referencesToSolveStack.push(this.referencesToSolve),this.referencesToSolve=e}popReferencesToSolve(){this.referencesToSolve=this.referencesToSolveStack.pop()}registerPageCounterExpr(e,t,n){e==="pages"?this.pagesCounterExprs.push({expr:n,format:t}):this.pageCounterExprs.push({expr:n,format:t})}registerTargetCounterExpr(e,t,n,i){this.targetCounterExprs.push({name:e,expr:n,format:t,transformedId:i})}getExprContentListener(){return this.exprContentListener.bind(this)}exprContentListener(e,t,n){if(e instanceof mt){if(e.str=="viv-leader"){let o=n.createElementNS("http://www.w3.org/1999/xhtml","span");return o.textContent=t,o.setAttribute("data-viv-leader",e.key),o.setAttribute("data-viv-leader-value",t),o}else if(e.str.startsWith("running-element-")){let o=t&&n.querySelectorAll(`[${jn}="${t}"]`);if(!o||o.length===0)return null;let s=o[o.length-1].cloneNode(!0);return this.fixPageCounterInRunningElement(s),s.style.position="",s.style.visibility="",s}else if(e.str.startsWith("target-counter-")){let o=n.createElementNS("http://www.w3.org/1999/xhtml","span");return o.textContent=t,o.setAttribute(ju,e.key),o}}let i=this.pagesCounterExprs.findIndex(o=>o.expr===e)>=0,r=!i&&this.pageCounterExprs.findIndex(o=>o.expr===e)>=0;if(i||r){let o=n.createElementNS("http://www.w3.org/1999/xhtml","span");return o.textContent=t,o.setAttribute(i?Hu:Wu,e.key),o}else return null}fixPageCounterInRunningElement(e){let t=e.querySelectorAll(`[${Wu}]`);for(let i of t){let r=i.getAttribute(Wu),o=this.pageCounterExprs.find(u=>u.expr.key===r),s=(o==null?void 0:o.expr).str,l=s==null?void 0:s.replace(/^page-counters?-/,""),a=this.currentPageCounters[l];a&&(i.textContent=o.format(a))}let n=e.querySelectorAll(`[${ju}]`);for(let i of n)i.setAttribute(pg,!0)}finishLastPage(e){let t=e.root.querySelectorAll(`[${Hu}]`),n=e.contentContainer.childElementCount;for(let r of t){let o=r.getAttribute(Hu),s=this.pagesCounterExprs.findIndex(l=>l.expr.key===o);r.textContent=this.pagesCounterExprs[s].format([n])}let i=e.root.querySelectorAll(`[${pg}]`);for(let r of i){let o=r.getAttribute(ju),s=this.targetCounterExprs.find(l=>l.expr.key===o);if(s&&s.transformedId){let l=this.pageCountersById[s.transformedId];if(l){let a=l[s.name];a&&(r.textContent=s.format(a[a.length-1]))}}}}createLayoutConstraint(e){return new uk(this,e)}},Hu="data-vivliostyle-pages-counter",Wu="data-vivliostyle-page-counter",ju="data-vivliostyle-target-counter",pg="data-vivliostyle-target-counter-in-running",uk=class{constructor(e,t){this.counterStore=e,this.pageIndex=t}allowLayout(e){if(!e||e.after)return!0;let t=e.viewNode;if(!t||t.nodeType!==1)return!0;let n=t.getAttribute("data-vivliostyle-id")||t.getAttribute("id")||t.getAttribute("name");if(!n||!this.counterStore.resolvedReferences[n]&&!this.counterStore.unresolvedReferences[n])return!0;let i=this.counterStore.pageIndicesById[n];return i?this.pageIndex>=i.pageIndex:!0}};function hk(e){if(e=e.substr(1),e.match(/^[^0-9a-fA-F\n\r]$/))return e;let t=parseInt(e,16);return isNaN(t)?"":t===0||t>=55296&&t<=57343||t>1114111?"�":String.fromCodePoint(t)}function Di(e){return e.replace(/\\([0-9a-fA-F]{1,6}(\r\n|[ \n\r\t\f])?|[^0-9a-fA-F\n\r])/g,hk)}var ck=class{constructor(){d(this,"type"),d(this,"precededBySpace",!1),d(this,"num",0),d(this,"text",""),d(this,"position",0),this.type=0}toString(){switch(this.type){case 10:return"(";case 11:return")";case 12:return"{";case 13:return"}";case 14:return"[";case 15:return"]";case 16:return",";case 17:return";";case 18:return":";case 19:return"/";case 21:return"%";case 22:return"?";case 23:return"+";case 24:return"-";case 25:return"||";case 26:return"&&";case 31:return"!";case 32:return"$";case 33:return"^";case 34:return"|";case 35:return"~";case 36:return"*";case 37:return">";case 38:return"<";case 39:return"=";case 41:return"!=";case 42:return"$=";case 43:return"^=";case 44:return"|=";case 45:return"~=";case 46:return"*=";case 47:return">=";case 48:return"<=";case 49:return"==";case 50:return"::";case 51:return"<!--";case 52:return"-->";case 3:return this.num.toString()+this.text;case 4:case 5:return this.num.toString();case 20:return"@"+this.text;case 7:return"#"+this.text;case 6:return this.text+"(";case 9:return"."+this.text;case 0:return"/*EOF*/";default:return this.text}}};function pt(e,t){let n=Array(128),i;for(i=0;i<128;i++)n[i]=e;for(n[NaN]=e==35?35:72,i=0;i<t.length;i+=2)n[t[i]]=t[i+1];return n}var Un=[72,72,72,72,72,72,72,72,72,1,1,72,1,1,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,1,4,34,6,7,8,9,33,10,11,12,13,14,15,16,17,2,2,2,2,2,2,2,2,2,2,18,19,20,21,22,23,24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25,29,26,30,3,72,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,27,31,28,32,72];Un[NaN]=80;var _n=[43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,52,43,43,43,43,39,43,43,39,39,39,39,39,39,39,39,39,39,43,43,43,43,43,43,43,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,43,44,43,43,39,43,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,43,43,43,43,43];_n[NaN]=43;var dk=[72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,78,59,72,59,59,59,59,59,59,59,59,59,59,72,72,72,72,72,72,72,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,72,61,72,72,78,72,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,72,72,72,72,72];_n[NaN]=43;var Cy=[35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,57,59,35,58,58,58,58,58,58,58,58,58,58,35,35,35,35,35,35,35,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,35,61,35,35,60,35,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,35,35,35,35,35];Cy[NaN]=35;var ky=[45,45,45,45,45,45,45,45,45,73,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,73,45,45,45,45,45,45,45,53,45,45,45,45,45,45,45,39,39,39,39,39,39,39,39,39,39,45,45,45,45,45,45,45,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,45,44,45,45,39,45,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,45,45,45,45,45];ky[NaN]=45;var nc=[37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,41,37,37,37,37,37,37,37,37,42,37,39,39,39,39,39,39,39,39,39,39,37,37,37,37,37,37,37,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,37,37,37,37,40,37,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,37,37,37,37,37];nc[NaN]=37;var ic=[38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,41,38,38,38,38,38,38,38,38,38,38,39,39,39,39,39,39,39,39,39,39,38,38,38,38,38,38,38,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,38,38,38,38,40,38,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,38,38,38,38,38];ic[NaN]=38;var Vi=pt(35,[61,36]),pk=pt(35,[58,77]),fk=pt(35,[61,36,124,50]),gk=pt(35,[38,51]),mk=pt(35,[42,54]),vk=pt(39,[42,55]),wk=pt(54,[42,55,47,56]),yk=pt(62,[62,82]),xk=pt(35,[61,36,33,70]),bk=pt(62,[45,71]),Sk=pt(63,[45,81]),Gu=pt(76,[10,72,13,72]),Ck=pt(39,[39,46,10,72,13,72,92,48]),kk=pt(39,[34,46,10,72,13,72,92,49]),Ek=pt(39,[39,47,10,74,13,74,92,48]),Pk=pt(39,[34,47,10,74,13,74,92,49]),fg=pt(64,[9,39,32,39,34,66,39,65,41,72,10,39,13,39]),Nk=pt(39,[41,67,9,79,10,79,13,79,32,79,92,75,40,72,91,72,93,72,123,72,125,72,NaN,67]),Tk=pt(39,[39,68,10,74,13,74,92,75,NaN,67]),Ik=pt(39,[34,68,10,74,13,74,92,75,NaN,67]),Rk=pt(72,[9,39,10,39,13,39,32,39,41,69]),Ak=15,Fn=class{constructor(e,t){this.input=e,this.handler=t,d(this,"indexMask"),d(this,"buffer"),d(this,"tail",0),d(this,"curr",0),d(this,"position",0),this.indexMask=Ak,this.buffer=Array(this.indexMask+1);for(let n=0;n<=this.indexMask;n++)this.buffer[n]=new ck}token(){return this.tail==this.curr&&this.fillBuffer(),this.buffer[this.curr]}nthToken(e){return(this.tail-this.curr&this.indexMask)<=e&&this.fillBuffer(),this.buffer[this.curr+e&this.indexMask]}consume(){this.curr=this.curr+1&this.indexMask}fillBuffer(){let e=this.tail,t=this.curr,n=this.indexMask;if(e>=t?t+=n:t--,t==e)throw new Error("F_CSSTOK_INTERNAL");let i=Un,r=this.input,o=this.position,s=this.buffer,l=0,a=0,u="",h=0,p=!1,c=s[e],f=-9;for(;;){let v=r.charCodeAt(o);switch(i[v]||i[65]){case 72:u=r.substring(a,o),isNaN(v)?l=0:l=54,i=Un;break;case 1:o++,p=!0;continue;case 2:a=o++,i=nc;continue;case 3:l=1,a=o++,i=_n;continue;case 4:a=o++,l=31,i=Vi;continue;case 33:l=2,a=++o,i=Ck;continue;case 34:l=2,a=++o,i=kk;continue;case 6:a=++o,l=7,i=_n;continue;case 7:a=o++,l=32,i=Vi;continue;case 8:a=o++,l=21;break;case 9:a=o++,l=32,i=gk;continue;case 10:a=o++,l=10;break;case 11:a=o++,l=11;break;case 12:a=o++,l=36,i=Vi;continue;case 13:a=o++,l=23;break;case 14:a=o++,l=16;break;case 15:l=24,a=o++,i=Cy;continue;case 16:a=o++,i=dk;continue;case 78:a=o++,l=9,i=_n;continue;case 17:a=o++,l=19,i=mk;continue;case 18:a=o++,l=18,i=pk;continue;case 77:o++,l=50;break;case 19:a=o++,l=17;break;case 20:a=o++,l=38,i=xk;continue;case 21:a=o++,l=39,i=Vi;continue;case 22:a=o++,l=37,i=Vi;continue;case 23:a=o++,l=22;break;case 24:a=++o,l=20,i=_n;continue;case 25:a=o++,l=14;break;case 26:a=o++,l=15;break;case 27:a=o++,l=12;break;case 28:a=o++,l=13;break;case 29:a=o++,f=a,l=1,i=Gu;continue;case 30:a=o++,l=33,i=Vi;continue;case 31:a=o++,l=34,i=fk;continue;case 32:a=o++,l=35,i=Vi;continue;case 35:break;case 36:o++,l=l+41-31;break;case 37:l=5,h=parseInt(r.substring(a,o),10);break;case 38:l=4,h=parseFloat(r.substring(a,o));break;case 39:o++;continue;case 40:l=3,h=parseFloat(r.substring(a,o)),a=o++,i=_n;continue;case 41:l=3,h=parseFloat(r.substring(a,o)),u="%",a=o++;break;case 42:o++,i=ic;continue;case 43:if(u=Di(r.substring(a,o)),l===27&&v===63||l===1&&u.toLowerCase()==="u"&&/^(\bu\+[?0-9a-f]+(-[?0-9a-f]+)?|,|\s+|\/\*([^*]|\*[^/])*\*\/)+[;}]/i.test(r.substring(o-1))){l=27,o++;continue}break;case 44:f=o++,i=Gu;continue;case 45:u=Di(r.substring(a,o));break;case 46:u=r.substring(a,o),o++;break;case 47:u=Di(r.substring(a,o)),o++;break;case 48:f=o,o+=2,i=Ek;continue;case 49:f=o,o+=2,i=Pk;continue;case 50:o++,l=25;break;case 51:o++,l=26;break;case 52:if(u=r.substring(a,o),l==1){if(o++,u.toLowerCase()=="url"){i=fg;continue}l=6}break;case 53:if(u=Di(r.substring(a,o)),l==1){if(o++,u.toLowerCase()=="url"){i=fg;continue}l=6}break;case 54:i=vk,o++;continue;case 55:i=wk,o++;continue;case 56:i=Un,o++;continue;case 57:i=yk,o++,r[o]!==">"&&(l=1,i=_n);continue;case 81:l=51,u=r.substring(a,++o),i=Un;break;case 82:l=52,u=r.substring(a,++o),i=Un;break;case 58:l=5,i=nc,o++;continue;case 59:l=4,i=ic,o++;continue;case 60:l=1,i=_n,o++;continue;case 61:l=1,i=Gu,f=o++;continue;case 62:o--;break;case 63:o-=2;break;case 64:a=o++,i=Nk;continue;case 65:a=++o,i=Tk;continue;case 66:a=++o,i=Ik;continue;case 67:l=8,u=Di(r.substring(a,o)),o++;break;case 69:o++;break;case 70:i=bk,o++;continue;case 71:i=Sk,o++;continue;case 79:if(o-f<8&&r.substring(f+1,o+1).match(/^[0-9a-fA-F]{0,6}(\r\n|[\n\r])|[ \t]$/)){o++;continue}case 68:l=8,u=Di(r.substring(a,o)),o++,i=Rk;continue;case 74:if(o++,o-f<9&&r.substring(f+1,o).match(/^[0-9a-fA-F]{0,6}(\r\n|[\n\r])$/))continue;l=54,u="E_CSS_UNEXPECTED_NEWLINE",i=Un;break;case 73:if(o-f<9&&r.substring(f+1,o+1).match(/^[0-9a-fA-F]{0,6}[ \t]$/)){o++,i=_n;continue}u=Di(r.substring(a,o));break;case 75:f=o++;continue;case 76:o++,i=ky;continue;default:if(i!==Un){l=54,u="E_CSS_UNEXPECTED_STATE";break}a=o,l=0}if(c.type=l,c.precededBySpace=p,c.num=h,c.text=u,c.position=a,e++,e>=t)break;i=Un,p=!1,c=s[e&n]}this.position=o,this.tail=e&n}},st=null,rc=null;function oc(){return st}function X(e){if(!st)throw new Error("E_TASK_NO_CONTEXT");st.name||(st.name=e);let t=st,n=new tu(t,t.top,e);return t.top=n,n.state=1,n}function Lk(e){return new Bk(new Ok)}function R(e){return new sc(e)}function to(e,t,n){let i=X(e);i.handler=n;try{t(i)}catch(r){i.task.raise(r,i)}return i.result()}function Fk(e,t){return(st?st.getScheduler():rc||Lk()).run(e,t)}var Ok=class{currentTime(){return new Date().valueOf()}setTimeout(e,t){return setTimeout(e,t)}clearTimeout(e){clearTimeout(e)}},Bk=class{constructor(e){this.timer=e,d(this,"timeout",1),d(this,"slice",25),d(this,"sliceOverTime",0),d(this,"queue"),d(this,"wakeupTime",null),d(this,"timeoutToken",null),d(this,"inTimeSlice",!1),d(this,"order",0),this.queue=new fC,rc||(rc=this)}setSlice(e){this.slice=e}setTimeout(e){this.timeout=e}isTimeSliceOver(){return this.timer.currentTime()>=this.sliceOverTime}arm(){if(this.inTimeSlice)return;let e=this.queue.peek().scheduledTime,t=this.timer.currentTime();if(this.timeoutToken!=null){if(t+this.timeout>this.wakeupTime)return;this.timer.clearTimeout(this.timeoutToken)}let n=e-t;n<=this.timeout&&(n=this.timeout),this.wakeupTime=t+n,this.timeoutToken=this.timer.setTimeout(()=>{this.timeoutToken=null,this.doTimeSlice()},n)}schedule(e,t){let n=e,i=this.timer.currentTime();n.order=this.order++,n.scheduledTime=i+(t||0),this.queue.add(n),this.arm()}doTimeSlice(){this.timeoutToken!=null&&(this.timer.clearTimeout(this.timeoutToken),this.timeoutToken=null),this.inTimeSlice=!0;try{let e=this.timer.currentTime();for(this.sliceOverTime=e+this.slice;this.queue.length();){let t=this.queue.peek();if(t.scheduledTime>e||(this.queue.remove(),t.canceled||t.resumeInternal(),e=this.timer.currentTime(),e>=this.sliceOverTime))break}}catch(e){le.error(e)}this.inTimeSlice=!1,this.queue.length()&&this.arm()}run(e,t){let n=new _k(this,t||"");n.top=new tu(n,null,"bootstrap"),n.top.state=1,n.top.then(()=>{let r=()=>{n.running=!1;for(let o of n.callbacks)try{o()}catch(s){le.error(s)}};try{e().then(o=>{n.result=o,r()})}catch(o){n.raise(o),r()}});let i=st;return st=n,this.schedule(n.top.suspend("bootstrap")),st=i,n}},Ey=class{constructor(e){this.task=e,d(this,"scheduledTime",0),d(this,"order",0),d(this,"result",null),d(this,"canceled",!1)}compare(e){let t=e;return t.scheduledTime-this.scheduledTime||t.order-this.order}getTask(){return this.task}schedule(e,t){this.result=e,this.task.scheduler.schedule(this,t)}resumeInternal(){let e=this.task;if(this.task=null,e&&e.continuation==this){e.continuation=null;let t=st;return st=e,e.top.finish(this.result),st=t,!0}return!1}cancel(){this.canceled=!0}},_k=class{constructor(e,t){this.scheduler=e,this.name=t,d(this,"callbacks",[]),d(this,"exception",null),d(this,"running",!0),d(this,"result",null),d(this,"waitTarget",null),d(this,"top",null),d(this,"continuation",null)}getName(){return this.name}interrupt(e){if(this.raise(e||new Error("E_TASK_INTERRUPT")),this!==st&&this.continuation){this.continuation.cancel();let t=new Ey(this);this.waitTarget="interrupt",this.continuation=t,this.scheduler.schedule(t)}}getScheduler(){return this.scheduler}isRunning(){return this.running}whenDone(e){this.callbacks.push(e)}join(){let e=X("Task.join");if(!this.running)e.finish(this.result);else{let t=e.suspend(this);this.whenDone(()=>{t.schedule(this.result)})}return e.result()}unwind(){for(;this.top&&!this.top.handler;)this.top=this.top.parent;if(this.top&&this.top.handler&&this.exception){let e=this.exception;this.exception=null,this.top.handler(this.top,e)}else this.exception&&le.error(this.exception,"Unhandled exception in task",this.name)}raise(e,t){if(this.fillStack(e),t){let n=this.top;for(;n&&n!=t;)n=n.parent;n==t&&(this.top=n)}this.exception=e,this.unwind()}fillStack(e){let t=e.frameTrace;if(!t){t=e.stack?`${e.stack}
	---- async ---
`:"";for(let n=this.top;n;n=n.parent)t+="	",t+=n.getName(),t+=`
`;e.frameTrace=t}}},sc=class Py{constructor(t){this.value=t}then(t){t(this.value)}thenAsync(t){return t(this.value)}thenReturn(t){return new Py(t)}thenFinish(t){t.finish(this.value)}isPending(){return!1}get(){return this.value}},Mk=class{constructor(e){this.frame=e}then(e){this.frame.then(e)}thenAsync(e){if(this.isPending()){let t=new tu(this.frame.task,this.frame.parent,"AsyncResult.thenAsync");return t.state=1,this.frame.parent=t,this.frame.then(n=>{e(n).then(i=>{t.finish(i)})}),t.result()}else return e(this.frame.res)}thenReturn(e){return this.isPending()?this.thenAsync(()=>new sc(e)):new sc(e)}thenFinish(e){this.isPending()?this.then(t=>{e.finish(t)}):e.finish(this.frame.res)}isPending(){return this.frame.state==1}get(){if(this.isPending())throw new Error("Result is pending");return this.frame.res}},tu=class{constructor(e,t,n){this.task=e,this.parent=t,this.name=n,d(this,"res",null),d(this,"state"),d(this,"callback",null),d(this,"handler",null),this.state=0}checkEnvironment(){if(!st)throw new Error("F_TASK_NO_CONTEXT");if(this!==st.top)throw new Error("F_TASK_NOT_TOP_FRAME")}result(){return new Mk(this)}finish(e){this.checkEnvironment(),st&&!st.exception&&(this.res=e),this.state=2;let t=this.parent;if(st&&(st.top=t),this.callback){try{this.callback(e)}catch(n){this.task.raise(n,t)}this.state=3}}getTask(){return this.task}getName(){return this.name}getScheduler(){return this.task.scheduler}then(e){switch(this.state){case 1:if(this.callback)throw new Error("F_TASK_FRAME_ALREADY_HAS_CALLBACK");this.callback=e;break;case 2:{let t=this.task,n=this.parent;try{e(this.res),this.state=3}catch(i){this.state=3,t.raise(i,n)}break}case 3:throw new Error("F_TASK_DEAD_FRAME");default:throw new Error(`F_TASK_UNEXPECTED_FRAME_STATE ${this.state}`)}}timeSlice(){let e=X("Frame.timeSlice");return e.getScheduler().isTimeSliceOver()?(le.debug("-- time slice --"),e.suspend().schedule(!0)):e.finish(!0),e.result()}sleep(e){let t=X("Frame.sleep");return t.suspend().schedule(!0,e),t.result()}loop(e){let t=X("Frame.loop"),n=i=>{try{for(;i;){let r=e();if(r.isPending()){r.then(n);return}else r.then(o=>{i=o})}t.finish(!0)}catch(r){t.task.raise(r,t)}};return n(!0),t.result()}loopWithFrame(e){let t=st;if(!t)throw new Error("E_TASK_NO_CONTEXT");return this.loop(()=>{let n;do{let i=new zk(t,t.top);t.top=i,i.state=1,e(i),n=i.result()}while(!n.isPending()&&n.get());return n})}suspend(e){if(this.checkEnvironment(),this.task.continuation)throw new Error("E_TASK_ALREADY_SUSPENDED");let t=new Ey(this.task);return this.task.continuation=t,st=null,this.task.waitTarget=e||null,t}},zk=class extends tu{constructor(e,t){super(e,t,"loop")}continueLoop(){this.finish(!0)}breakLoop(){this.finish(!1)}},Ys=class{constructor(e,t){this.fetch=e,d(this,"name"),d(this,"arrived",!1),d(this,"resource",null),d(this,"task",null),d(this,"piggybacks",[]),this.name=t}start(){this.task||(this.task=oc().getScheduler().run(()=>{let e=X("Fetcher.run");return this.fetch().then(t=>{let n=this.piggybacks;if(this.arrived=!0,this.resource=t,this.task=null,this.piggybacks=[],n)for(let i=0;i<n.length;i++)try{n[i](t)}catch(r){le.error(r,"Error:")}e.finish(t)}),e.result()},this.name))}piggyback(e){this.arrived?e(this.resource):this.piggybacks.push(e)}get(){return this.arrived?R(this.resource):(this.start(),this.task.join())}hasArrived(){return this.arrived}},nu=e=>{if(e.length==0)return R(!0);if(e.length==1)return e[0].get().thenReturn(!0);let t=X("waitForFetches"),n=0;return t.loop(()=>{for(;n<e.length;){let i=e[n++];if(!i.hasArrived())return i.get().thenReturn(!0)}return R(!1)}).then(()=>{t.finish(!0)}),t.result()},Ny=`
@media screen {
  [data-vivliostyle-viewer-viewport] {
    background: #aaaaaa;
  }

  [data-vivliostyle-page-container] {
    background: white;
    z-index: 0;
  }

  [data-vivliostyle-viewer-viewport] {
    box-sizing: border-box;
    display: flex;
    overflow: auto;
    position: relative;
  }

  [data-vivliostyle-outer-zoom-box] {
    margin: auto;
    overflow: hidden;
    flex: none;
  }

  [data-vivliostyle-viewer-viewport] [data-vivliostyle-spread-container] {
    display: flex;
    flex: none;
    justify-content: center;
    transform-origin: left top;
  }

  [data-vivliostyle-viewer-viewport][data-vivliostyle-page-progression="ltr"]
    [data-vivliostyle-spread-container] {
    flex-direction: row;
  }

  [data-vivliostyle-viewer-viewport][data-vivliostyle-page-progression="rtl"]
    [data-vivliostyle-spread-container] {
    flex-direction: row-reverse;
  }

  [data-vivliostyle-viewer-viewport] [data-vivliostyle-page-container] {
    margin: 0 auto;
    flex: none;
    transform-origin: center top;
  }

  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view="true"]
    [data-vivliostyle-page-container][data-vivliostyle-page-side="left"] {
    margin-right: 1px;
    transform-origin: right top;
  }

  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view="true"]
    [data-vivliostyle-page-container][data-vivliostyle-page-side="right"] {
    margin-left: 1px;
    transform-origin: left top;
  }

  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view="true"]
    [data-vivliostyle-page-container][data-vivliostyle-unpaired-page="true"] {
    margin-left: auto;
    margin-right: auto;
    transform-origin: center top;
  }
}
`,Ty=`
[data-vivliostyle-layout-box] {
  position: absolute;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  z-index: -1;
  transform-origin: left top;
}

[data-vivliostyle-debug] [data-vivliostyle-layout-box] {
  right: auto;
  bottom: auto;
  overflow: visible;
  z-index: auto;
}

[data-vivliostyle-spread-container] {
  transform: scale(var(--viv-outputScale,1));
  transform-origin: left top;
}

/* Emulate high pixel ratio using zoom & transform:scale() */
@supports (zoom: 8) {
  [data-vivliostyle-layout-box] {
    zoom: calc(var(--viv-outputPixelRatio,1) / var(--viv-devicePixelRatio,1));
    transform: scale(calc(var(--viv-devicePixelRatio,1) / var(--viv-outputPixelRatio,1)));
  }
  [data-vivliostyle-spread-container] {
    zoom: calc(var(--viv-outputPixelRatio,1) / var(--viv-devicePixelRatio,1));
    transform: scale(calc(var(--viv-outputScale,1) * var(--viv-devicePixelRatio,1) / var(--viv-outputPixelRatio,1)));
  }
  /* Workaround for Chromium's default border etc. widths not zoomed but scaled down */
  [data-vivliostyle-spread-container] :where([style*=border],[style*=outline],[style*=rule]) {
    border-width: medium;
    outline-width: medium;
    column-rule-width: medium;
  }
  [data-vivliostyle-spread-container] ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  [data-vivliostyle-spread-container] ::-webkit-scrollbar-track {
    background-color: #f4f4f4;
  }
  [data-vivliostyle-spread-container] ::-webkit-scrollbar-thumb {
    border-radius: 4px;
    background: #c7c7c7;
  }
  [data-vivliostyle-spread-container] ::-webkit-scrollbar-thumb:hover {
    background: #7d7d7d;
  }
}

[data-vivliostyle-page-container] {
  position: relative;
}

[data-vivliostyle-bleed-box] {
  position: relative;
  overflow: hidden;
  background-origin: content-box !important;
}

[data-vivliostyle-page-box] ~ [data-vivliostyle-page-box] {
  display: none;
}

[data-vivliostyle-toc-box] {
  position: absolute;
  left: 3px;
  top: 3px;
  overflow: scroll;
  overflow-x: hidden;
  background: rgba(248, 248, 248, 0.9);
  border-radius: 2px;
  box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4);
}

@media print {
  [data-vivliostyle-toc-box] {
    display: none;
  }

  [data-vivliostyle-outer-zoom-box],
  [data-vivliostyle-spread-container] {
    width: 100% !important;
    height: 100% !important;
  }

  [data-vivliostyle-spread-container] {
    --viv-outputScale: 1 !important;
    --viv-devicePixelRatio: 1 !important;
    zoom: normal !important;
    transform: none !important;
    print-color-adjust: exact;
  }

  @supports (zoom: 8) {
    [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {
      zoom: var(--viv-outputPixelRatio,1);
      transform: scale(calc(1 / var(--viv-outputPixelRatio,1)));
      transform-origin: left top;
    }
  }

  [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {
    display: block !important;
    max-height: 100vh;
  }

  [data-vivliostyle-spread-container] [data-vivliostyle-page-container]:not(:last-child) {
    break-after: page;
  }

  /* Gecko-only hack, see https://bugzilla.mozilla.org/show_bug.cgi?id=267029#c17 */
  @-moz-document url-prefix()  {
    [data-vivliostyle-spread-container] [data-vivliostyle-page-container]:nth-last-child(n + 2) {
      top: -1px;
      margin-top: 1px;
      margin-bottom: -1px;
    }
    /* Workaround Gecko problem on page break */
    [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {
      break-after: auto !important;
      height: 100% !important;
    }
  }
}
`,Iy=`
/*
 * Copyright 2013 Google, Inc.
 * Copyright 2015 Daishinsha Inc.
 * Copyright 2019 Vivliostyle Foundation
 *
 * CSS property validation.
 */
NUM = POS_NUM | ZERO | NEGATIVE;
NNEG_NUM = POS_NUM | ZERO;
INT = POS_INT | ZERO | NEGATIVE;
NNEG_INT = POS_INT | ZERO;
PERCENTAGE = POS_PERCENTAGE | ZERO | NEGATIVE;
STRICT_PERCENTAGE = POS_PERCENTAGE | ZERO_PERCENTAGE | NEGATIVE;
NNEG_PERCENTAGE = POS_PERCENTAGE | ZERO;
LENGTH = POS_LENGTH | ZERO | NEGATIVE;
NNEG_LENGTH = POS_LENGTH | ZERO;
PLENGTH = LENGTH | PERCENTAGE;
PPLENGTH = POS_LENGTH | ZERO | POS_PERCENTAGE;
ALENGTH = LENGTH | auto;
APLENGTH = PLENGTH | auto;
PAPLENGTH = PPLENGTH | auto;
ANGLE = POS_ANGLE | ZERO | NEGATIVE;
LENGTH_OR_NUM = LENGTH | NUM;
ANGLE_OR_NUM = ANGLE | NUM;
MIN_MAX_FIT_CONTENT = min-content | max-content | fit-content;
BG_POSITION_TERM = PLENGTH | left | center | right | top | bottom;
URI_OR_NONE = URI | none;
IMAGE = URI | IMAGE_FUNCTION | none;
background-attachment = COMMA( [scroll | fixed | local]+ );
background-color = COLOR;
background-image = COMMA( IMAGE+ );
background-position = COMMA( SPACE(BG_POSITION_TERM{1,4})+ ); /* relaxed */
background-repeat = COMMA( [repeat | repeat-x | repeat-y | no-repeat]+ );
border-collapse = collapse | separate;
BORDER_SIDE_COLOR = COLOR;
BORDER_SIDE_STYLE = none | hidden | dotted | dashed | solid | double | groove | ridge | inset | outset;
BORDER_SIDE_WIDTH = thin: 1px | medium: 3px | thick: 5px | NNEG_LENGTH;
border-spacing = LENGTH LENGTH?;
border-top-color = BORDER_SIDE_COLOR;
border-right-color = BORDER_SIDE_COLOR;
border-bottom-color = BORDER_SIDE_COLOR;
border-left-color = BORDER_SIDE_COLOR;
border-top-style = BORDER_SIDE_STYLE;
border-right-style = BORDER_SIDE_STYLE;
border-bottom-style = BORDER_SIDE_STYLE;
border-left-style = BORDER_SIDE_STYLE;
border-top-width = BORDER_SIDE_WIDTH;
border-right-width = BORDER_SIDE_WIDTH;
border-bottom-width = BORDER_SIDE_WIDTH;
border-left-width = BORDER_SIDE_WIDTH;
BORDER_RADIUS = PLENGTH{1,2};
border-top-left-radius = BORDER_RADIUS;
border-top-right-radius = BORDER_RADIUS;
border-bottom-right-radius = BORDER_RADIUS;
border-bottom-left-radius = BORDER_RADIUS;
border-image-source = IMAGE;
border-image-slice = [NUM | PERCENTAGE]{1,4} || fill; /* relaxed */
border-image-width = [NUM | PLENGTH | auto]{1,4};
border-image-outset = [NUM | LENGTH]{1,4};
border-image-repeat = [ stretch | repeat | round | space ]{1,2};
bottom = APLENGTH;
caption-side = top | bottom;
clear = none | left | right | top | bottom | inline-start | inline-end | block-start | block-end | inside | outside | both | all | same;
clip = rect(ALENGTH{4}) | rect(SPACE(ALENGTH{4})) | auto;
color = COLOR;
LIST_STYLE_TYPE = IDENT;
TYPE_OR_UNIT_IN_ATTR = string | color | url | integer | number | length | angle | time | frequency;
ATTR = attr(SPACE(IDENT TYPE_OR_UNIT_IN_ATTR?) [ STRING | IDENT | COLOR | INT | NUM | PLENGTH | ANGLE | POS_TIME | FREQUENCY]?);
CONTENT_LIST = [ STRING | URI | counter(IDENT LIST_STYLE_TYPE?) |
    counters(IDENT STRING LIST_STYLE_TYPE?) | ATTR |
    target-counter([ STRING | URI ] IDENT LIST_STYLE_TYPE?) |
    target-counter(ATTR IDENT LIST_STYLE_TYPE?) |
    target-counters([ STRING | URI ] IDENT STRING LIST_STYLE_TYPE?) |
    target-counters(ATTR IDENT STRING LIST_STYLE_TYPE?) |
    leader([ dotted | solid | space ] | STRING ) |
    open-quote | close-quote | no-open-quote | no-close-quote |
    content([ text | before | after | first-letter ]?) |
    string(IDENT [first | start | last | first-except]?) |
    element(IDENT [first | start | last | first-except]?) ]+;
CONTENT = normal | none | CONTENT_LIST;
content = CONTENT;
COUNTER = [ IDENT INT? ]+ | none;
counter-increment = COUNTER;
counter-reset = COUNTER;
counter-set = COUNTER;
cursor = COMMA(URI* [ auto | crosshair | default | pointer | move | e-resize | ne-resize | nw-resize |
    n-resize | se-resize | sw-resize | s-resize | w-resize | text | wait | help | progress ]);
direction = ltr | rtl;
display = inline | block | list-item | inline-block | table | inline-table | table-row-group |
    table-header-group | table-footer-group | table-row | table-column-group | table-column |
    table-cell | table-caption | none | oeb-page-head | oeb-page-foot | flex | inline-flex |
    ruby | ruby-base | ruby-text | ruby-base-container | ruby-text-container | run-in | compact | marker |
    flow-root | grid | inline-grid | contents;
empty-cells = show | hide;
FAMILY = SPACE(IDENT+) | STRING;
FAMILY_LIST = COMMA( FAMILY+ );
font-family = FAMILY_LIST;
font-size = xx-small | x-small | small | medium | large | x-large | xx-large | larger | smaller | PPLENGTH;
font-style = normal | italic | oblique;
font-weight = normal | bold | bolder | lighter | POS_NUM;
height = PAPLENGTH | MIN_MAX_FIT_CONTENT;
left = APLENGTH;
letter-spacing = normal | LENGTH_OR_NUM;
line-height = normal | POS_NUM | PPLENGTH;
list-style-image = IMAGE;
list-style-position = inside | outside;
list-style-type = LIST_STYLE_TYPE;
margin-right = APLENGTH;
margin-left = APLENGTH;
margin-top = APLENGTH;
margin-bottom = APLENGTH;
NPLENGTH = none | PLENGTH;
max-height = NPLENGTH | MIN_MAX_FIT_CONTENT;
max-width = NPLENGTH | MIN_MAX_FIT_CONTENT;
min-height = APLENGTH | MIN_MAX_FIT_CONTENT;
min-width = APLENGTH | MIN_MAX_FIT_CONTENT;
orphans = POS_INT;
outline-offset = LENGTH;
outline-color = COLOR | invert;
outline-style = BORDER_SIDE_STYLE;
outline-width = BORDER_SIDE_WIDTH;
overflow = visible | hidden | scroll | auto | clip;
padding-right = PPLENGTH;
padding-left = PPLENGTH;
padding-top = PPLENGTH;
padding-bottom = PPLENGTH;
PAGE_BREAK = auto | always | avoid | left | right | recto | verso;
page-break-after = PAGE_BREAK;
page-break-before = PAGE_BREAK;
page-break-inside = avoid | auto;
position = static | relative | absolute | fixed | running(IDENT);
quotes = [STRING STRING]+ | none | auto;
right = APLENGTH;
table-layout = auto | fixed;
text-align = left | right | center | justify | start | end | match-parent | inside | outside;
text-indent = PLENGTH;
text-transform = capitalize | uppercase | lowercase | none;
top = APLENGTH;
vertical-align = baseline | sub | super | top | text-top | middle | bottom | text-bottom | PLENGTH;
visibility = visible | hidden | collapse;
white-space = normal | pre | nowrap | pre-wrap | pre-line | break-spaces;
widows = POS_INT;
width = PAPLENGTH | MIN_MAX_FIT_CONTENT;
word-spacing = normal | LENGTH_OR_NUM;
z-index = auto | INT;

[epub,moz,webkit]hyphens = auto | manual | none;
[webkit]hyphenate-character = auto | STRING;

/* css-logical */
margin-block-start = APLENGTH;
margin-block-end = APLENGTH;
margin-inline-start = APLENGTH;
margin-inline-end = APLENGTH;
padding-block-start = APLENGTH;
padding-block-end = APLENGTH;
padding-inline-start = APLENGTH;
padding-inline-end = APLENGTH;
border-block-start-color = BORDER_SIDE_COLOR;
border-block-end-color = BORDER_SIDE_COLOR;
border-inline-start-color = BORDER_SIDE_COLOR;
border-inline-end-color = BORDER_SIDE_COLOR;
border-block-start-style = BORDER_SIDE_STYLE;
border-block-end-style = BORDER_SIDE_STYLE;
border-inline-start-style = BORDER_SIDE_STYLE;
border-inline-end-style = BORDER_SIDE_STYLE;
border-block-start-width = BORDER_SIDE_WIDTH;
border-block-end-width = BORDER_SIDE_WIDTH;
border-inline-start-width = BORDER_SIDE_WIDTH;
border-inline-end-width = BORDER_SIDE_WIDTH;
block-start = APLENGTH;
block-end = APLENGTH;
inline-start = APLENGTH;
inline-end = APLENGTH;
block-size = PAPLENGTH | MIN_MAX_FIT_CONTENT;
inline-size = PAPLENGTH | MIN_MAX_FIT_CONTENT;
max-block-size = NPLENGTH | MIN_MAX_FIT_CONTENT;
max-inline-size = NPLENGTH | MIN_MAX_FIT_CONTENT;
min-block-size = APLENGTH | MIN_MAX_FIT_CONTENT;
min-inline-size = APLENGTH | MIN_MAX_FIT_CONTENT;

margin-inside = auto | APLENGTH;
margin-outside = auto | APLENGTH;
padding-inside = PPLENGTH;
padding-outside = PPLENGTH;
border-inside-color = BORDER_SIDE_COLOR;
border-outside-color = BORDER_SIDE_COLOR;
border-inside-style = BORDER_SIDE_STYLE;
border-outside-style = BORDER_SIDE_STYLE;
border-inside-width = BORDER_SIDE_WIDTH;
border-outside-width = BORDER_SIDE_WIDTH;
inside = APLENGTH;
outside = APLENGTH;

SHAPE = auto | rectangle( PLENGTH{4} ) |  ellipse( PLENGTH{4} ) |  circle( PLENGTH{3} ) |
    polygon( SPACE(PLENGTH+)+ );
[epubx]shape-inside = SHAPE;
[epubx,webkit]shape-outside = SHAPE;
[epubx]wrap-flow = auto | both | start | end | maximum | clear | around /* epub al */;

TRANSFORM_FUNCTION = matrix(NUM{6}) | translate(PLENGTH{1,2}) | translateX(PLENGTH) | translateY(PLENGTH) |
 scale(NUM{1,2}) | scaleX(NUM) | scaleY(NUM) | rotate(ANGLE) | skewX(ANGLE) | skewY(ANGLE);
[epub]transform = none | TRANSFORM_FUNCTION+;
[epub]transform-origin = [[[ top | bottom | left | right] PLENGTH?] | center | PLENGTH]{1,2}; /* relaxed */

BOX = border-box | padding-box | content-box;
SHADOW = SPACE(inset || LENGTH{2,4} || COLOR); /* relaxed */
[webkit]background-size = COMMA( SPACE( [PLENGTH | auto ]{1,2} | cover | contain)+ );
[webkit]background-origin = COMMA( BOX+ );
[webkit]background-clip = COMMA( BOX+ );
[webkit]box-shadow = none | COMMA( SHADOW+ );
text-shadow = none |  COMMA( SHADOW+ );
[webkit]box-decoration-break = slice | clone;
FILTER_FUNCTION = blur(LENGTH) | brightness(NUM | PERCENTAGE) | contrast(NUM | PERCENTAGE) | drop-shadow(SPACE(LENGTH{2,3} COLOR?))
                | grayscale(NUM | PERCENTAGE) | hue-rotate(ANGLE) | invert(NUM | PERCENTAGE) | opacity(NUM | PERCENTAGE)
                | saturate(NUM | PERCENTAGE) | sepia(NUM | PERCENTAGE);
FILTER_FUNCTION_LIST = FILTER_FUNCTION+;
[webkit]filter = none | FILTER_FUNCTION_LIST;

opacity = NUM;

[moz,webkit]column-width = LENGTH | auto;
[moz,webkit]column-count = INT | auto;
[moz,webkit]column-gap = LENGTH | normal;
[moz,webkit]column-rule-color = COLOR;
[moz,webkit]column-rule-style = BORDER_SIDE_STYLE;
[moz,webkit]column-rule-width = BORDER_SIDE_WIDTH;
BREAK = auto | avoid | avoid-page | page | left | right | recto | verso | avoid-column | column | avoid-region | region;
break-before = BREAK;
break-after = BREAK;
break-inside = auto | avoid | avoid-page | avoid-column | avoid-region;
[webkit]column-span = none | auto | all;
[moz]column-fill = auto | balance | balance-all;
margin-break = auto | keep | discard;

src = COMMA([SPACE(URI format(STRING+)?) | local(FAMILY)]+); /* for font-face */

[epubx,webkit]flow-from = IDENT;
[epubx,webkit]flow-into = IDENT;
[epubx]flow-linger = INT | none;
[epubx]flow-priority = INT;
[epubx]flow-options = none | [ exclusive || last || static ];
[epubx]page = INT | auto | IDENT; /* page: IDENT is for CSS Paged Media */
[epubx]min-page-width = LENGTH;
[epubx]min-page-height = LENGTH;
[epubx]required = true | false;
[epubx]enabled = true | false;
[epubx]conflicting-partitions = COMMA(IDENT+);
[epubx]required-partitions = COMMA(IDENT+);
[epubx]snap-height = LENGTH | none;
[epubx]snap-width = LENGTH | none;
[epubx]flow-consume = all | some;
[epubx]utilization = NUM;
[epubx]text-zoom = font-size | scale;

[adapt]template = URI_OR_NONE | footnote;
[adapt]behavior = IDENT;

/* CSS Fonts */
COMMON_LIG_VALUES        = [ common-ligatures | no-common-ligatures ];
DISCRETIONARY_LIG_VALUES = [ discretionary-ligatures | no-discretionary-ligatures ];
HISTORICAL_LIG_VALUES    = [ historical-ligatures | no-historical-ligatures ];
CONTEXTUAL_ALT_VALUES    = [ contextual | no-contextual ];
font-variant-ligatures = normal | none | [ COMMON_LIG_VALUES || DISCRETIONARY_LIG_VALUES || HISTORICAL_LIG_VALUES || CONTEXTUAL_ALT_VALUES ];
font-variant-caps = normal | small-caps | all-small-caps | petite-caps | all-petite-caps | unicase | titling-caps;
NUMERIC_FIGURE_VALUES   = [ lining-nums | oldstyle-nums ];
NUMERIC_SPACING_VALUES  = [ proportional-nums | tabular-nums ];
NUMERIC_FRACTION_VALUES = [ diagonal-fractions | stacked-fractions ];
font-variant-numeric = normal | [ NUMERIC_FIGURE_VALUES || NUMERIC_SPACING_VALUES || NUMERIC_FRACTION_VALUES || ordinal || slashed-zero ];
EAST_ASIAN_VARIANT_VALUES = [ jis78 | jis83 | jis90 | jis04 | simplified | traditional ];
EAST_ASIAN_WIDTH_VALUES   = [ full-width | proportional-width ];
font-variant-east-asian = normal | [ EAST_ASIAN_VARIANT_VALUES || EAST_ASIAN_WIDTH_VALUES || ruby ];
font-variant_css2 = normal | small-caps; /* for font shorthand */
font-size-adjust = none | NNEG_NUM;
[webkit]font-kerning = auto | normal | none;
font-feature-settings = COMMA( normal | SPACE( STRING [ on | off | INT ]? )+ );
FONT_STRETCH_CSS3_VALUES = normal | wider | narrower | ultra-condensed | extra-condensed | condensed | semi-condensed | semi-expanded | expanded | extra-expanded | ultra-expanded;
font-stretch = FONT_STRETCH_CSS3_VALUES | PERCENTAGE;
font-stretch_css3 = FONT_STRETCH_CSS3_VALUES; /* for font shorthand */
font-display = [ auto | block | swap | fallback | optional ];
unicode-range = COMMA( URANGE+ );

/* CSS Images */
image-resolution = RESOLUTION;
object-fit = fill | contain | cover | none | scale-down;
object-position = COMMA( SPACE(BG_POSITION_TERM{1,4})+ ); /* relaxed */

/* CSS Paged Media */
PAGE_SIZE = a10 | a9 | a8 | a7 | a6 | a5 | a4 | a3 | a2 | a1 | a0
          | b10 | b9 | b8 | b7 | b6 | b5 | b4 | b3 | b2 | b1 | b0
          | c10 | c9 | c8 | c7 | c6 | c5 | c4 | c3 | c2 | c1 | c0
          | jis-b10 | jis-b9 | jis-b8 | jis-b7 | jis-b6 | jis-b5 | jis-b4 | jis-b3 | jis-b2 | jis-b1 | jis-b0
          | letter | legal | ledger;
bleed = auto | LENGTH;
marks = none | [ crop || cross ];
size = POS_LENGTH{1,2} | auto | [ PAGE_SIZE || [ portrait | landscape ] ];
crop-offset = auto | LENGTH;
crop-marks-line-color = auto | COLOR;

/* CSS Page Floats */
float-reference = inline | column | region | page;
float = none | footnote | [ block-start || block-end || inline-start || inline-end || snap-block || snap-inline || left || right || top || bottom || inside || outside ];
float-min-wrap-block = PPLENGTH;

/* CSS Ruby */
ruby-align = start | center | space-between | space-around;
ruby-position = over | under | inter-character;

/* CSS Size Adjust */
[moz,webkit]text-size-adjust = auto | none | POS_PERCENTAGE;

/* CSS Text */
[webkit]line-break = auto | loose | normal | strict | anywhere;
overflow-wrap = normal | break-word | anywhere;
[moz]tab-size = NNEG_INT | NNEG_LENGTH;
[moz]text-align-last = auto | start | end | left | right | center | justify | inside | outside;
text-justify = auto | none | inter-word | inter-character;
word-break = normal | keep-all | break-all | break-word;
text-spacing-trim = auto | normal | space-all | trim-both | trim-auto |
    [[ trim-start | space-start | space-first ] ||
     [ trim-end | space-end | allow-end ] ||
     [ trim-adjacent | space-adjacent ]];
text-autospace = normal | auto | no-autospace |
    [[ ideograph-alpha || ideograph-numeric || punctuation ] || [ insert | replace ]];
hanging-punctuation = none | [ first || [ force-end | allow-end ] || last ];

/* CSS Text Decoration */
[webkit]text-decoration-color = COLOR;
[webkit]text-decoration-line = none | [ underline || overline || line-through || blink ];
[webkit]text-decoration-skip = none | [ objects || spaces || ink || edges || box-decoration ];
[webkit]text-decoration-style = solid | double | dotted | dashed | wavy;
[webkit]text-decoration-thickness = from-font | APLENGTH;
[epub,webkit]text-emphasis-color = COLOR;
[webkit]text-emphasis-position = [ over | under ] [ right | left ];
[epub,webkit]text-emphasis-style = none | [[ filled | open ] || [ dot | circle | double-circle | triangle | sesame ]] | STRING;
[webkit]text-underline-position = auto | [ under || [ left | right ]];

/* CSS Transforms */
[webkit]backface-visibility = visible | hidden;

/* CSS UI */
[moz,webkit]box-sizing = content-box | padding-box | border-box;
text-overflow = [clip | ellipsis | STRING]{1,2};

/* CSS Writing Modes */
[epub,webkit]text-combine = none | horizontal;
text-combine-upright = none | all; /* relaxed */
[epub,webkit]text-orientation = mixed | upright | sideways-right | sideways-left | sideways | use-glyph-orientation /* the following values are kept for backward-compatibility */ | vertical-right | rotate-right | rotate-left | rotate-normal | auto;
unicode-bidi = normal | embed | isolate | bidi-override | isolate-override | plaintext;
[epub,webkit]writing-mode = horizontal-tb | vertical-rl | lr-tb | rl-tb | tb-rl | lr | rl | tb;

/* CSS Flex box */
FLEX_BASIS = content | PAPLENGTH;
flex-direction = row | row-reverse | column | column-reverse;
flex-wrap = nowrap | wrap | wrap-reverse;
order = INT;
flex-grow = NNEG_NUM;
flex-shrink = NNEG_NUM;
flex-basis = FLEX_BASIS;
flex = none | [ [ NNEG_NUM NNEG_NUM? ] || FLEX_BASIS ];
justify-content = flex-start | flex-end | center | space-between | space-around;
align-items = flex-start | flex-end | center | baseline | stretch;
align-self = auto | flex-start | flex-end | center | baseline | stretch;
align-content = flex-start | flex-end | center | space-between | space-around | stretch;

/* Pointer Events */
touch-action = auto | none | [ pan-x || pan-y ] | manipulation;

/* SVG 2 */
OPACITY_VALUE = NUM | PERCENTAGE;
DASH_ARRAY = COMMA( SPACE( [ LENGTH | PERCENTAGE | NUM ]+ )+ );
PAINT = none | child | child(INT) | COLOR | SPACE( URI [none | COLOR]? ) | context-fill | context-stroke;
color-interpolation = auto | sRGB | linearRGB;
color-rendering = auto | optimizeSpeed | optimizeQuality;
fill = PAINT;
fill-opacity = OPACITY_VALUE;
fill-rule = nonzero | evenodd;
glyph-orientation-vertical = auto | NUM | ANGLE;
image-rendering = auto | optimizeSpeed | optimizeQuality | crisp-edges | pixelated;
marker-start = none | URI;
marker-mid = none | URI;
marker-end = none | URI;
pointer-events = bounding-box | visiblePainted | visibleFill | visibleStroke | visible | painted | fill | stroke | all | none;
paint-order = normal | [ fill || stroke || markers ];
shape-rendering = auto | optimizeSpeed | crispEdges | geometricPrecision;
stop-color = COLOR;
stop-opacity = OPACITY_VALUE;
stroke = PAINT;
stroke-dasharray = none | DASH_ARRAY;
stroke-dashoffset = PERCENTAGE | LENGTH_OR_NUM;
stroke-linecap = butt | round | square;
stroke-linejoin = miter | round | bevel;
stroke-miterlimit = NUM;
stroke-opacity = OPACITY_VALUE;
stroke-width = PERCENTAGE | LENGTH_OR_NUM;
text-anchor = start | middle | end;
text-rendering = auto | optimizeSpeed | optimizeLegibility | geometricPrecision;
vector-effect = none | SPACE( [ non-scaling-stroke | non-scaling-size | non-rotation | fixed-position ]+ [ viewport | screen ]? );

/* SVG 1.1 */
alignment-baseline = auto | baseline | before-edge | text-before-edge | middle | central | after-edge | text-after-edge | ideographic | alphabetic | hanging | mathematical;
baseline-shift = baseline | sub | super | PERCENTAGE | LENGTH_OR_NUM;
dominant-baseline = auto | use-script | no-change | reset-size | ideographic | alphabetic | hanging | mathematical | central | middle | text-after-edge | text-before-edge;
mask = none | URI;

/* css-masking-1 */
SHAPE_RADIUS = PLENGTH | closest-side | farthest-side;
FILL_RULE = nonzero | evenodd;
SHAPE_BOX = BOX | margin-box;
GEOMETRY_BOX = SHAPE_BOX | fill-box | stroke-box | view-box;
BASIC_SHAPE =
    inset( SPACE( PLENGTH{1,4} [ round PLENGTH{1,4} [ SLASH PLENGTH{1,4} ]? ]? ) )
  | circle(  SPACE( [SHAPE_RADIUS]?    [at BG_POSITION_TERM{1,4}]? ) )
  | ellipse( SPACE( SHAPE_RADIUS{2}? [at BG_POSITION_TERM{1,4}]? ) )
  | polygon( FILL_RULE? COMMA( SPACE( PLENGTH{2} )+ )+ );
[webkit]clip-path = none | URI | [ BASIC_SHAPE || GEOMETRY_BOX ];
clip-rule = nonzero | evenodd;

/* filters */
flood-color = COLOR;
flood-opacity = OPACITY_VALUE;
lighting-color = COLOR;

/* compositing-1 */
BLEND_MODE = normal | multiply | screen | overlay | darken | lighten | color-dodge | color-burn | hard-light | soft-light | difference | exclusion | hue | saturation | color | luminosity;
mix-blend-mode = BLEND_MODE;
isolation = auto | isolate;
background-blend-mode = COMMA( BLEND_MODE+ );

/* CSS GCPM */
string-set = COMMA( SPACE( IDENT CONTENT_LIST )+ | none );
footnote-policy = auto | line;

/* CSS Repeated Headers and Footers */
[viv]repeat-on-break = auto | none | header | footer;

/* Compatibility */
[webkit]text-fill-color = COLOR;
[webkit]text-stroke-color = COLOR;
[webkit]text-stroke-width = BORDER_SIDE_WIDTH;

DEFAULTS

background-attachment: scroll;
background-color: transparent;
background-image: none;
background-repeat: repeat;
background-position: 0% 0%;
background-clip: border-box;
background-origin: padding-box;
background-size: auto;
border-top-color: currentColor;
border-right-color: currentColor;
border-bottom-color: currentColor;
border-left-color: currentColor;
border-top-style: none;
border-right-style: none;
border-bottom-style: none;
border-left-style: none;
border-top-width: 3px;
border-right-width: 3px;
border-bottom-width: 3px;
border-left-width: 3px;
border-top-left-radius: 0;
border-top-right-radius: 0;
border-bottom-right-radius: 0;
border-bottom-left-radius: 0;
border-image-source: none;
border-image-slice: 100%;
border-image-width: 1;
border-image-outset: 0;
border-image-repeat: stretch;
column-count: auto;
column-gap: normal;
column-width: auto;
column-rule-color: currentColor;
column-rule-style: none;
column-rule-width: 3px;
column-fill: balance;
outline-color: currentColor;
outline-style: none;
outline-width: 3px;
flex-direction: row;
flex-wrap: nowrap;
font-family: serif;
font-style: normal;
font-size: medium;
font-size-adjust: none;
font-kerning: auto;
font-feature-settings: normal;
font-variant-ligatures: normal;
font-variant-caps: normal;
font-variant-numeric: normal;
font-variant-east-asian: normal;
font-weight: normal;
font-stretch: normal;
line-height: normal;
list-style-image: none;
list-style-position: outside;
list-style-type: disc;
margin-bottom: auto;
margin-left: auto;
margin-right: auto;
margin-top: auto;
padding-bottom: auto;
padding-left: auto;
padding-right: auto;
padding-top: auto;
text-autospace: normal;
text-emphasis-color: currentColor;
text-emphasis-style: none;
text-spacing-trim: normal;
text-stroke-color: currentColor;
text-stroke-width: 0;
marker-start: none;
marker-mid: none;
marker-end: none;

/* css-logical */
border-block-start-color: currentColor;
border-block-end-color: currentColor;
border-inline-start-color: currentColor;
border-inline-end-color: currentColor;
border-inside-color: currentColor;
border-outside-color: currentColor;
border-block-start-style: none;
border-block-end-style: none;
border-inline-start-style: none;
border-inline-end-style: none;
border-inside-style: none;
border-outside-style: none;
border-block-start-width: 3px;
border-block-end-width: 3px;
border-inline-start-width: 3px;
border-inline-end-width: 3px;
border-inside-width: 3px;
border-outside-width: 3px;

SHORTHANDS

all = ALL;
background = COMMA background-image [background-position [ / background-size ]] background-repeat
     background-attachment [background-origin background-clip] background-color; /* background-color is a special case, see the code */
border-top = border-top-width border-top-style border-top-color;
border-right = border-right-width border-right-style border-right-color;
border-bottom = border-bottom-width border-bottom-style border-bottom-color;
border-left = border-left-width border-left-style border-left-color;
border-inside = border-inside-width border-inside-style border-inside-color;
border-outside = border-outside-width border-outside-style border-outside-color;
border-width = INSETS border-top-width border-right-width border-bottom-width border-left-width;
border-style = INSETS border-top-style border-right-style border-bottom-style border-left-style;
border-color = INSETS border-top-color border-right-color border-bottom-color border-left-color;
border = border-width border-style border-color;
border-image = border-image-source border-image-slice [ / border-image-width [ / border-image-outset ] ]
     border-image-repeat;
border-radius = INSETS_SLASH border-top-left-radius border-top-right-radius
     border-bottom-right-radius border-bottom-left-radius;
[moz,webkit]columns = column-width column-count;
[moz,webkit]column-rule = column-rule-width column-rule-style column-rule-color;
flex-flow = flex-direction flex-wrap;
oeb-column-number = column-count;
outline = outline-width outline-style outline-color;
list-style = list-style-position list-style-type list-style-image;
margin = INSETS margin-top margin-right margin-bottom margin-left;
padding = INSETS padding-top padding-right padding-bottom padding-left;
font = FONT font-style font-variant_css2 font-weight font-stretch_css3 /* font-size line-height font-family are special-cased */;
font-variant = font-variant-ligatures font-variant-caps font-variant-numeric font-variant-east-asian;
[epub,webkit]text-emphasis = text-emphasis-style text-emphasis-color;
marker = INSETS marker-start marker-mid marker-end;
[webkit]text-stroke = text-stroke-width text-stroke-color;
text-decoration = text-decoration-line text-decoration-color text-decoration-style text-decoration-thickness;
text-spacing = TEXT_SPACING text-autospace text-spacing-trim;

/* css-logical */
margin-block = INSETS margin-block-start margin-block-end;
margin-inline = INSETS margin-inline-start margin-inline-end;
padding-block = INSETS padding-block-start padding-block-end;
padding-inline = INSETS padding-inline-start padding-inline-end;
border-block-width = INSETS border-block-start-width border-block-end-width;
border-block-style = INSETS border-block-start-style border-block-end-style;
border-block-color = INSETS border-block-start-color border-block-end-color;
border-inline-width = INSETS border-inline-start-width border-inline-end-width;
border-inline-style = INSETS border-inline-start-style border-inline-end-style;
border-inline-color = INSETS border-inline-start-color border-inline-end-color;
border-block = border-block-width border-block-style border-block-color;
border-inline = border-inline-width border-inline-style border-inline-color;
border-block-start = border-block-start-width border-block-start-style border-block-start-color;
border-block-end = border-block-end-width border-block-end-style border-block-end-color;
border-inline-start = border-inline-start-width border-inline-start-style border-inline-start-color;
border-inline-end = border-inline-end-width border-inline-end-style border-inline-end-color;
inset-block-start = block-start;
inset-block-end = block-end;
inset-inline-start = inline-start;
inset-inline-end = inline-end;
inset-inside = inside;
inset-outside = outside;
inset-block = INSETS block-start block-end;
inset-inline = INSETS inline-start inline-end;
inset = INSETS top right bottom left;

/* old names  */
word-wrap = overflow-wrap;
[adapt,webkit]margin-before = margin-block-start;
[adapt,webkit]margin-after = margin-block-end;
[adapt,webkit]margin-start = margin-inline-start;
[adapt,webkit]margin-end = margin-inline-end;
[adapt,webkit]padding-before = padding-block-start;
[adapt,webkit]padding-after = padding-block-end;
[adapt,webkit]padding-start = padding-inline-start;
[adapt,webkit]padding-end = padding-inline-end;
[adapt,webkit]border-before-color = border-block-start-color;
[adapt,webkit]border-after-color = border-block-end-color;
[adapt,webkit]border-start-color = border-inline-start-color;
[adapt,webkit]border-end-color = border-inline-end-color;
[adapt,webkit]border-before-style = border-block-start-style;
[adapt,webkit]border-after-style = border-block-end-style;
[adapt,webkit]border-start-style = border-inline-start-style;
[adapt,webkit]border-end-style = border-inline-end-style;
[adapt,webkit]border-before-width = border-block-start-width;
[adapt,webkit]border-after-width = border-block-end-width;
[adapt,webkit]border-start-width = border-inline-start-width;
[adapt,webkit]border-end-width = border-inline-end-width;
[adapt,webkit]before = block-start;
[adapt,webkit]after = block-end;
[adapt,webkit]start = inline-start;
[adapt,webkit]end = inline-end;

`,Ry=`
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:s="http://www.pyroxy.com/ns/shadow">
<head>
<style><![CDATA[

.-vivliostyle-footnote-content {
  float: footnote;
}

.-vivliostyle-table-cell-container {
  display: block;
}

]]></style>
</head>
<body>

<s:template id="footnote"><s:content/><s:include class="-vivliostyle-footnote-content"/></s:template>

<s:template id="table-cell"><div data-vivliostyle-flow-root="true" class="-vivliostyle-table-cell-container"><s:content/></div></s:template>

</body>
</html>`,Ay=`
@namespace "http://www.w3.org/1999/xhtml";

:root {
  hyphens: -epubx-expr(pref-hyphenate? "auto": "manual");
}
:root[data-vivliostyle-epub-spine-properties~="page-spread-left"] {
  break-before: left;
}
:root[data-vivliostyle-epub-spine-properties~="page-spread-right"] {
  break-before: right;
}

@-adapt-footnote-area {
  display: block;
  margin-block-start: 0.5em;
  margin-block-end: 0.5em;
}

@-adapt-footnote-area ::before {
  display: block;
  border-block-start-width: 1px;
  border-block-start-style: solid;
  border-block-start-color: black;
  margin-block-end: 0.4em;
  margin-inline-start: 0;
  margin-inline-end: 60%;
}

/* default page master */
@-epubx-page-master :background-host {
  @-epubx-partition :layout-host {
    -epubx-flow-from: body;
    top: -epubx-expr(header.margin-bottom-edge);
    bottom: -epubx-expr(page-height - footer.margin-top-edge);
    left: 0px;
    right: 0px;
    column-width: 25em;
  }
  @-epubx-partition footer :oeb-page-foot {
    writing-mode: horizontal-tb;
    -epubx-flow-from: oeb-page-foot;
    bottom: 0px;
    left: 0px;
    right: 0px;
  }
  @-epubx-partition header :oeb-page-head {
    writing-mode: horizontal-tb;
    -epubx-flow-from: oeb-page-head;
    top: 0px;
    left: 0px;
    right: 0px;
  }
}

@page {
  @top-left-corner {
    text-align: right;
    vertical-align: middle;
  }
  @top-left {
    text-align: left;
    vertical-align: middle;
  }
  @top-center {
    text-align: center;
    vertical-align: middle;
  }
  @top-right {
    text-align: right;
    vertical-align: middle;
  }
  @top-right-corner {
    text-align: left;
    vertical-align: middle;
  }
  @left-top {
    text-align: center;
    vertical-align: top;
  }
  @left-middle {
    text-align: center;
    vertical-align: middle;
  }
  @left-bottom {
    text-align: center;
    vertical-align: bottom;
  }
  @right-top {
    text-align: center;
    vertical-align: top;
  }
  @right-middle {
    text-align: center;
    vertical-align: middle;
  }
  @right-bottom {
    text-align: center;
    vertical-align: bottom;
  }
  @bottom-left-corner {
    text-align: right;
    vertical-align: middle;
  }
  @bottom-left {
    text-align: left;
    vertical-align: middle;
  }
  @bottom-center {
    text-align: center;
    vertical-align: middle;
  }
  @bottom-right {
    text-align: right;
    vertical-align: middle;
  }
  @bottom-right-corner {
    text-align: left;
    vertical-align: middle;
  }
}

@media print {
  @page {
    margin: 10%;
  }
}
`,Ly=`
@namespace "http://www.w3.org/1999/xhtml";
@namespace m "http://www.w3.org/1998/Math/MathML";
@namespace epub "http://www.idpf.org/2007/ops";

html,
address,
blockquote,
body,
dd,
div,
dl,
dt,
fieldset,
form,
frame,
frameset,
h1,
h2,
h3,
h4,
h5,
h6,
noframes,
ol,
p,
ul,
center,
dir,
hr,
menu,
pre,
details,
dialog,
legend,
listing,
optgroup,
option,
plaintext,
search,
xmp,
article,
section,
nav,
aside,
hgroup,
footer,
header,
figure,
figcaption,
main {
  display: block;
}
li {
  display: list-item;
}
head {
  display: none !important;
}
table {
  display: table;
}
tr {
  display: table-row;
}
thead {
  display: table-header-group;
  break-after: avoid;
}
tbody {
  display: table-row-group;
}
tfoot {
  display: table-footer-group;
  break-before: avoid;
}
col {
  display: table-column;
}
colgroup {
  display: table-column-group;
}
td,
th {
  display: table-cell;
}
caption {
  display: table-caption;
  text-align: center;
}
th {
  font-weight: bolder;
  text-align: center;
}
*[hidden],
link,
style,
script {
  display: none;
}
h1 {
  font-size: 2em;
  margin-block: 0.67em;
}
h2 {
  font-size: 1.5em;
  margin-block: 0.83em;
}
h3 {
  font-size: 1.17em;
  margin-block: 1em;
}
h4 {
  font-size: 1em;
  margin-block: 1.33em;
}
h5 {
  font-size: 0.83em;
  margin-block: 1.67em;
}
h6 {
  font-size: 0.67em;
  margin-block: 2.33em;
}
h1,
h2,
h3,
h4,
h5,
h6 {
  font-weight: bold;
  break-after: avoid;
}
p,
blockquote,
figure,
ul,
ol,
dl,
dir,
menu {
  margin-block: 1em;
}
b,
strong {
  font-weight: bolder;
}
blockquote,
figure {
  margin-inline: 40px;
}
i,
cite,
dfn,
em,
var,
address {
  font-style: italic;
}
pre,
tt,
code,
kbd,
samp {
  font-family: monospace;
  text-spacing: none;
  hanging-punctuation: none;
}
listing,
plaintext,
xmp,
pre {
  white-space: pre;
}
pre[wrap] {
  white-space: pre-wrap;
}
button,
textarea,
input,
select {
  display: inline-block;
}
big {
  font-size: 1.17em;
}
small,
sub,
sup {
  font-size: 0.83em;
}
sub {
  vertical-align: sub;
}
sup {
  vertical-align: super;
}
table {
  box-sizing: border-box;
  border-spacing: 2px;
  border-collapse: separate;
  text-indent: initial;
}
thead,
tbody,
tfoot,
table > tr {
  vertical-align: middle;
}
tr,
td,
th {
  vertical-align: inherit;
}
s,
strike,
del {
  text-decoration: line-through;
}
hr {
  border-style: inset;
  border-width: 1px;
  margin-block: 0.5em;
}
hr[color],
hr[noshade] {
  border-style: solid;
}
ol,
ul,
dir,
menu {
  padding-inline-start: 40px;
}
dd {
  margin-inline-start: 40px;
}
ol ul,
ul ol,
ul ul,
ol ol {
  margin-block: 0;
}
u,
ins {
  text-decoration: underline;
}
center {
  text-align: center;
}
q::before {
  content: open-quote;
}
q::after {
  content: close-quote;
}

ruby {
  display: ruby;
}
rp {
  display: none;
}
rbc {
  display: ruby-base-container;
}
rtc {
  display: ruby-text-container;
}
rb {
  display: ruby-base;
  white-space: nowrap;
}
rt {
  display: ruby-text;
}
rtc,
rt {
  text-emphasis: none;
  white-space: nowrap;
  line-height: 1;
}
rtc,
rt {
  font-size: 50%;
}
rtc:lang(zh-TW),
rt:lang(zh-TW) {
  font-size: 30%;
}
rtc > rt,
rtc > rt:lang(zh-TW) {
  font-size: 100%;
}

/* Bidi settings */
bdo[dir="ltr"] {
  direction: ltr;
  unicode-bidi: bidi-override;
}
bdo[dir="rtl"] {
  direction: rtl;
  unicode-bidi: bidi-override;
}
*[dir="ltr"] {
  direction: ltr;
  unicode-bidi: isolate;
}
*[dir="rtl"] {
  direction: rtl;
  unicode-bidi: isolate;
}

/* MathML */
m|math[display="block"] {
  display: block;
  display: block math;
}

/*------------------ epub-specific ---------------------*/

a[epub|type="noteref"],
a[epub\\:type="noteref"] {
  font-size: 0.75em;
  vertical-align: super;
  line-height: 0.01;
}

a[epub|type="noteref"]:href-epub-type(footnote, aside),
a[epub\\:type="noteref"]:href-epub-type(footnote, aside) {
  -adapt-template: footnote;
  text-decoration: none;
}

aside[epub|type="footnote"],
aside[epub\\:type="footnote"] {
  display: none;
}

aside[epub|type="footnote"]:footnote-content,
aside[epub\\:type="footnote"]:footnote-content {
  display: block;
  margin: 0.25em;
  font-size: 1.2em;
  line-height: 1.2;
}

epub|trigger {
  display: none;
}

epub|switch {
  display: inline;
}

epub|default {
  display: inline;
}

epub|case {
  display: none;
}

epub|case[required-namespace::supported] {
  display: inline;
}

epub|case[required-namespace::supported] ~ epub|case {
  display: none;
}

epub|case[required-namespace::supported] ~ epub|default {
  display: none;
}
`,Fy=`
@namespace "http://www.w3.org/1999/xhtml";

*:not([data-vivliostyle-role=doc-toc],
  [data-vivliostyle-role=doc-toc] *,
  :has([data-vivliostyle-role=doc-toc]),
  :is(h1,h2,h3,h4,h5,h6):has(+:not(nav)[data-vivliostyle-role=doc-toc])) {
  display: none;
}

[hidden] {
  display: revert;
}

[data-vivliostyle-role=doc-toc] li a {
  -adapt-behavior: toc-node-anchor;
}

[data-vivliostyle-role=doc-toc] li {
  -adapt-behavior: toc-node;
}

[data-vivliostyle-role=doc-toc] li > :not(ul,ol):first-child {
  -adapt-behavior: toc-node-first-child;
}

[data-vivliostyle-role=doc-toc] :is(ol,ul),
[data-vivliostyle-role=doc-toc]:is(ol,ul) {
  -adapt-behavior: toc-container;
}
`,Oy=`
[data-viv-margin-discard~="block-start"] {
  margin-block-start: 0 !important;
}
[data-viv-margin-discard~="block-end"] {
  margin-block-end: 0 !important;
}
[data-viv-margin-discard~="inline-start"] {
  margin-inline-start: 0 !important;
}
[data-viv-margin-discard~="inline-end"] {
  margin-inline-end: 0 !important;
}

[data-viv-box-break~="inline-start"]:not([data-viv-box-break~="clone"]) {
  margin-inline-start: 0 !important;
  padding-inline-start: 0 !important;
  border-inline-start-width: 0 !important;
  border-start-start-radius: 0 !important;
  border-end-start-radius: 0 !important;
}
[data-viv-box-break~="inline-end"]:not([data-viv-box-break~="clone"]) {
  margin-inline-end: 0 !important;
  padding-inline-end: 0 !important;
  border-inline-end-width: 0 !important;
  border-start-end-radius: 0 !important;
  border-end-end-radius: 0 !important;
}
[data-viv-box-break~="block-start"]:not([data-viv-box-break~="clone"]):not(table[style*="border-collapse: collapse"]:has(>thead)) {
  margin-block-start: 0 !important;
  padding-block-start: 0 !important;
  border-block-start-width: 0 !important;
  border-start-start-radius: 0 !important;
  border-start-end-radius: 0 !important;
}
[data-viv-box-break~="block-end"]:not([data-viv-box-break~="clone"]):not(table[style*="border-collapse: collapse"]:has(>tfoot)) {
  margin-block-end: 0 !important;
  padding-block-end: 0 !important;
  border-block-end-width: 0 !important;
  border-end-start-radius: 0 !important;
  border-end-end-radius: 0 !important;
}
[data-viv-box-break~="block-start"][data-viv-box-break~="text-start"] {
  text-indent: 0 !important;
}
[data-viv-box-break~="block-end"][data-viv-box-break~="text-end"][data-viv-box-break~="justify"] {
  text-align-last: justify !important;
}
[data-viv-box-break~="block-end"][data-viv-box-break~="text-end"][data-viv-box-break~="justify"] > * {
  text-align-last: auto;
}
[data-viv-box-break~="block-end"][data-viv-box-break~="text-end"]:not([data-viv-box-break~="justify"]) {
  text-align-last: auto !important;
}

span.viv-anonymous-block {
  display: block;
}

[data-vivliostyle-page-container] {
  text-spacing-trim: space-all;
  text-autospace: no-autospace;
}
viv-ts-open.viv-ts-auto > viv-ts-inner,
viv-ts-open.viv-ts-trim > viv-ts-inner {
  margin-inline-start: -0.5em;
}
viv-ts-close.viv-ts-auto > viv-ts-inner,
viv-ts-close.viv-ts-trim > viv-ts-inner {
  letter-spacing: -0.5em;
}
viv-ts-close.viv-hang-end > viv-ts-inner,
viv-ts-close.viv-hang-last > viv-ts-inner {
  letter-spacing: -1em;
}
viv-ts-open.viv-ts-auto::before,
viv-ts-close.viv-ts-auto::after,
viv-ts-close.viv-hang-end::after {
  content: " ";
  font-family: Courier, monospace;
  word-spacing: normal;
  letter-spacing: -0.11em;
  line-height: 0;
  text-orientation: mixed;
  visibility: hidden;
}
viv-ts-close.viv-hang-end:not(.viv-hang-hw)::after {
  letter-spacing: 0.4em;
}
viv-ts-close.viv-hang-hw > viv-ts-inner {
  letter-spacing: -0.5em;
}
viv-ts-open.viv-hang-first > viv-ts-inner {
  display: inline-block;
  line-height: 1;
  inline-size: 1em;
  text-indent: 0;
  text-align: end;
  text-align-last: end;
  margin-inline-start: -1em;
}
viv-ts-thin-sp::after {
  content: " ";
  font-family: Times, serif;
  word-spacing: normal;
  letter-spacing: -0.125em;
  line-height: 0;
  text-orientation: mixed;
  visibility: hidden;
}
[style*=text-decoration] :is(viv-ts-thin-sp, viv-ts-close.viv-ts-auto)::after {
  visibility: visible;
}

span[data-viv-leader] {
  text-combine-upright: none;
  text-orientation: mixed;
  white-space: pre;
}
`;function iu(e,t,n){let i=X("fetchFromURL"),r={method:n||"GET",mode:"cors"},o=i.suspend(),s={status:0,statusText:"",url:e,contentType:null,responseText:null,responseXML:null,responseBlob:null};return fetch(e,r).then(l=>{var a;return s.status=l.status,s.url=l.url,s.statusText=l.statusText,s.contentType=(a=l.headers.get("Content-Type"))==null?void 0:a.replace(/;.*$/,"").toLowerCase(),l.ok?t==="blob"?l.blob():t==="arraybuffer"?l.arrayBuffer():t==="json"?l.json():/\/aozorabunko\/[^/]+\/cards\/[^/]+\/files\/[^/.]+\.html$/.test(e)?(s.contentType="text/html",l.arrayBuffer().then(u=>new TextDecoder("Shift_JIS").decode(u))):(/^data:,(<|%3c)/i.test(e)&&(s.contentType="text/html"),l.text()):l.text()}).then(l=>{t==="blob"&&l instanceof Blob?s.responseBlob=l:t==="arraybuffer"&&l instanceof ArrayBuffer?s.responseBlob=By([l]):t==="json"?s.responseText=JSON.stringify(l):typeof l=="string"&&(s.responseText=l),o.schedule(s)}).catch(l=>{le.warn(l,`Error fetching ${e}`),o.schedule(s)}),i.result()}function By(e,t){let n="application/octet-stream";return new Blob(e,{type:n})}function $k(e){let t=X("readBlob"),n=new FileReader,i=t.suspend(n);return n.addEventListener("load",()=>{i.schedule(n.result)},!1),n.readAsArrayBuffer(e),t.result()}function Dk(e){return URL.createObjectURL(e)}var qd=class{constructor(e,t){this.parser=e,this.type=t,d(this,"resources",{}),d(this,"fetchers",{})}load(e,t,n){e=Yn(e);let i=this.resources[e];return typeof i<"u"?R(i):this.fetch(e,t,n).get()}fetchInner(e,t,n){let i=X("fetch"),r=e.endsWith("?viv-toc-box");r&&(e=e.replace("?viv-toc-box",""));let o=et("user-agent.xml",lr),s=!r&&e===o;return s&&(e=`data:application/xml,${encodeURIComponent(Ry)}`),iu(e,this.type).then(l=>{if(l.status>=400&&t)throw new Error((n||`Failed to fetch required resource: ${e}`)+` (${l.status}${l.statusText?" "+l.statusText:""})`);r?(e+="?viv-toc-box",l.url+="?viv-toc-box"):s&&(l.url=e=o),this.parser(l,this).then(a=>{delete this.fetchers[e],this.resources[e]=a,i.finish(a)})}),i.result()}fetch(e,t,n){if(e=Yn(e),this.resources[e])return null;let i=this.fetchers[e];return i||(i=new Ys(()=>this.fetchInner(e,t,n),`Fetch ${e}`),this.fetchers[e]=i,i.start()),i}get(e){return this.resources[Yn(e)]}delete(e){delete this.resources[Yn(e)]}};function Vk(e,t){let n=e.responseText;return R(n?Dd(n):null)}function Uk(){return new qd(Vk,"text")}function gr(e,t,n){let i=new Ys(()=>{let r=X("loadElement"),o=r.suspend(e),s=!1,l=a=>{s||(s=!0,o.schedule(a?a.type:"timeout"))};return e.addEventListener("load",l,!1),e.addEventListener("error",l,!1),e.addEventListener("abort",l,!1),e.namespaceURI=="http://www.w3.org/2000/svg"?(t&&e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t),setTimeout(l,300)):e.localName==="script"?setTimeout(l,3e3):t&&(e.src=t,n&&(e.alt=n)),r.result()},`loadElement ${t||e.localName}`);return i.start(),i}var gg=0,Hk=16777216,_y=33554432,My=50331648,zy=67108864,Wk=83886080,jk=100663296,Kd=class{constructor(e){this.scope=e,d(this,"flavor"),this.flavor="Author"}getCurrentToken(){return null}getScope(){return this.scope}error(e,t){}startStylesheet(e){this.flavor=e}tagSelector(e,t){}classSelector(e){}pseudoclassSelector(e,t){}pseudoelementSelector(e,t){}idSelector(e){}attributeSelector(e,t,n,i){}descendantSelector(){}childSelector(){}adjacentSiblingSelector(){}followingSiblingSelector(){}nextSelector(){}startSelectorRule(){}startFontFaceRule(){}startFootnoteRule(e){}startViewportRule(){}startDefineRule(){}startRegionRule(){}startPageRule(){}startPageMarginBoxRule(e){}startWhenRule(e){}startMediaRule(e){this.startWhenRule(e)}startFlowRule(e){}startPageTemplateRule(){}startPageMasterRule(e,t,n){}startPartitionRule(e,t,n){}startPartitionGroupRule(e,t,n){}startRuleBody(){}property(e,t,n){}endRule(){}startFuncWithSelector(e){}endFuncWithSelector(){}pushSelectorText(e){}getImportantSpecificity(){switch(this.flavor){case"UA":return gg;case"User":return jk;default:return Wk}}getBaseSpecificity(){switch(this.flavor){case"UA":return gg;case"User":return Hk;default:return _y}}},Gk=class extends Kd{constructor(){super(null),d(this,"stack",[]),d(this,"tokenizer",null),d(this,"slave",null)}pushHandler(e){this.stack.push(this.slave),this.slave=e}popHandler(){this.slave=this.stack.pop()}getCurrentToken(){return this.tokenizer?this.tokenizer.token():null}getScope(){return this.slave.getScope()}error(e,t){this.slave.error(e,t)}errorMsg(e,t){var n;le.warn(e,(n=t==null?void 0:t.toString())!=null?n:"")}startStylesheet(e){super.startStylesheet(e),this.stack.length>0&&(this.slave=this.stack[0],this.stack=[]),this.slave.startStylesheet(e)}tagSelector(e,t){this.slave.tagSelector(e,t)}classSelector(e){this.slave.classSelector(e)}pseudoclassSelector(e,t){this.slave.pseudoclassSelector(e,t)}pseudoelementSelector(e,t){this.slave.pseudoelementSelector(e,t)}idSelector(e){this.slave.idSelector(e)}attributeSelector(e,t,n,i){this.slave.attributeSelector(e,t,n,i)}descendantSelector(){this.slave.descendantSelector()}childSelector(){this.slave.childSelector()}adjacentSiblingSelector(){this.slave.adjacentSiblingSelector()}followingSiblingSelector(){this.slave.followingSiblingSelector()}nextSelector(){this.slave.nextSelector()}startSelectorRule(){this.slave.startSelectorRule()}startFontFaceRule(){this.slave.startFontFaceRule()}startFootnoteRule(e){this.slave.startFootnoteRule(e)}startViewportRule(){this.slave.startViewportRule()}startDefineRule(){this.slave.startDefineRule()}startRegionRule(){this.slave.startRegionRule()}startPageRule(){this.slave.startPageRule()}startPageMarginBoxRule(e){this.slave.startPageMarginBoxRule(e)}startWhenRule(e){this.slave.startWhenRule(e)}startFlowRule(e){this.slave.startFlowRule(e)}startPageTemplateRule(){this.slave.startPageTemplateRule()}startPageMasterRule(e,t,n){this.slave.startPageMasterRule(e,t,n)}startPartitionRule(e,t,n){this.slave.startPartitionRule(e,t,n)}startPartitionGroupRule(e,t,n){this.slave.startPartitionGroupRule(e,t,n)}startRuleBody(){this.slave.startRuleBody()}property(e,t,n){this.slave.property(e,t,n)}endRule(){this.slave.endRule()}startFuncWithSelector(e){this.slave.startFuncWithSelector(e)}endFuncWithSelector(){this.slave.endFuncWithSelector()}pushSelectorText(e){this.slave.pushSelectorText(e)}},mg=class extends Kd{constructor(e,t,n){super(e),this.owner=t,this.topLevel=n,d(this,"depth",0),t&&(this.flavor=t.flavor)}getCurrentToken(){var e;return(e=this.owner)==null?void 0:e.getCurrentToken()}error(e,t){var n;(n=this.owner)==null||n.errorMsg(e,t)}startRuleBody(){this.depth++}endRule(){--this.depth==0&&!this.topLevel&&this.owner.popHandler()}},qs=class extends mg{constructor(e,t,n){super(e,t,n)}report(e){this.error(e,this.getCurrentToken())}reportAndSkip(e){this.report(e),this.owner.pushHandler(new mg(this.scope,this.owner,!1))}startSelectorRule(){this.reportAndSkip("E_CSS_UNEXPECTED_SELECTOR")}startFontFaceRule(){this.reportAndSkip("E_CSS_UNEXPECTED_FONT_FACE")}startFootnoteRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_FOOTNOTE")}startViewportRule(){this.reportAndSkip("E_CSS_UNEXPECTED_VIEWPORT")}startDefineRule(){this.reportAndSkip("E_CSS_UNEXPECTED_DEFINE")}startRegionRule(){this.reportAndSkip("E_CSS_UNEXPECTED_REGION")}startPageRule(){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE")}startWhenRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_WHEN")}startFlowRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_FLOW")}startPageTemplateRule(){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE_TEMPLATE")}startPageMasterRule(e,t,n){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE_MASTER")}startPartitionRule(e,t,n){this.reportAndSkip("E_CSS_UNEXPECTED_PARTITION")}startPartitionGroupRule(e,t,n){this.reportAndSkip("E_CSS_UNEXPECTED_PARTITION_GROUP")}startFuncWithSelector(e){this.reportAndSkip("E_CSS_UNEXPECTED_SELECTOR_FUNC")}endFuncWithSelector(){this.reportAndSkip("E_CSS_UNEXPECTED_END_SELECTOR_FUNC")}property(e,t,n){this.error("E_CSS_UNEXPECTED_PROPERTY",this.getCurrentToken())}},Ze=[],Ca=[],Me=[],Qe=[],dn=[],jt=[],Ke=[],ht=[],Be=[],gt=[],Ot=[],ft=[],qe=[],mr=55,vr=56,Sl=57;Ze[1]=28,Ze[36]=29,Ze[7]=29,Ze[9]=29,Ze[14]=29,Ze[18]=29,Ze[50]=29,Ze[20]=30,Ze[13]=27,Ze[0]=200,Ca[1]=46,Ca[0]=200,jt[1]=2,jt[36]=4,jt[7]=6,jt[9]=8,jt[14]=10,jt[18]=14,jt[50]=42,Me[37]=11,Me[23]=12,Me[35]=56,Me[1]=1,Me[36]=3,Me[7]=5,Me[9]=7,Me[14]=9,Me[12]=13,Me[18]=55,Me[50]=58,Me[16]=41,Qe[37]=11,Qe[23]=12,Qe[35]=56,Qe[1]=1,Qe[36]=3,Qe[7]=5,Qe[9]=7,Qe[14]=9,Qe[18]=55,dn[1]=2,dn[36]=4,dn[7]=6,dn[9]=8,dn[18]=14,dn[50]=42,dn[14]=10,dn[12]=13,Ke[1]=15,Ke[7]=16,Ke[4]=17,Ke[5]=18,Ke[3]=19,Ke[2]=20,Ke[8]=21,Ke[27]=57,Ke[16]=22,Ke[19]=23,Ke[6]=24,Ke[11]=25,Ke[17]=26,Ke[13]=48,Ke[31]=47,Ke[23]=54,Ke[0]=44,ht[1]=31,ht[4]=32,ht[5]=32,ht[3]=33,ht[2]=34,ht[10]=40,ht[6]=38,ht[31]=36,ht[24]=36,ht[32]=35,Be[1]=45,Be[16]=37,Be[37]=37,Be[38]=37,Be[47]=37,Be[48]=37,Be[39]=37,Be[49]=37,Be[41]=37,Be[26]=37,Be[25]=37,Be[23]=37,Be[24]=37,Be[19]=37,Be[21]=37,Be[36]=37,Be[18]=37,Be[22]=37,Be[11]=39,Be[12]=43,Be[17]=49,gt[0]=200,gt[12]=50,gt[13]=51,gt[14]=50,gt[15]=51,gt[10]=50,gt[11]=51,gt[17]=53,Ot[0]=200,Ot[12]=50,Ot[13]=52,Ot[14]=50,Ot[15]=51,Ot[10]=50,Ot[11]=51,Ot[17]=53,ft[0]=200,ft[12]=50,ft[13]=51,ft[14]=50,ft[15]=51,ft[10]=50,ft[11]=51,qe[11]=0,qe[16]=0,qe[22]=1,qe[18]=1,qe[26]=2,qe[25]=2,qe[38]=3,qe[37]=3,qe[48]=3,qe[47]=3,qe[39]=3,qe[49]=3,qe[41]=3,qe[23]=4,qe[24]=4,qe[36]=5,qe[19]=5,qe[21]=5,qe[0]=6,qe[mr]=2,qe[vr]=2;var Ks=class{constructor(e,t,n,i){this.actions=e,this.tokenizer=t,this.handler=n,this.baseURL=i,d(this,"valStack",[]),d(this,"namespacePrefixToURI",{}),d(this,"defaultNamespaceURI",null),d(this,"propName",null),d(this,"propImportant",!1),d(this,"exprContext"),d(this,"result",null),d(this,"importReady",!1),d(this,"importURL",null),d(this,"importCondition",null),d(this,"errorBrackets",[]),d(this,"ruleStack",[]),d(this,"regionRule",!1),d(this,"pageRule",!1),d(this,"inStyleDeclaration",!1),this.exprContext=2}extractVals(e,t){let n=[],i=this.valStack;for(;t<i.length&&(n.push(i[t++]),t!==i.length);){if(i[t++]!==e)throw new Error("Unexpected state");t===i.length&&n.push(fe)}return n}valStackReduce(e,t){let n=this.valStack,i=n.length,r=0,o;do if(o=n[--i],e===")"&&o instanceof Eo){if(o.text===")")r++;else if(o.text==="("){if(r===0)return null;r--}}while(typeof o<"u"&&typeof o!="string");let s=n.length-(i+1);if(s>1&&n.splice(i+1,s,new Ge(n.slice(i+1,n.length))),e==",")return null;i++;do o=n[--i];while(typeof o<"u"&&(typeof o!="string"||o==","));if(s=n.length-(i+1),o=="("){e!=")"&&t.type!==0&&(this.handler.error("E_CSS_MISMATCHED_C_PAR",t),this.actions=Ot);let a=new ho(n[i-1],this.extractVals(",",i+1));if(n.splice(i-1,s+2,a),a.name==="var"){let u=a.values[0]instanceof Jt&&a.values[0].name;(!ni(u)||u===this.propName)&&(this.handler.error(`E_CSS_INVALID_VAR ${a.toString()}`,t),this.actions=Ot)}return a}if(e!=";"||i>=0)return this.handler.error("E_CSS_UNEXPECTED_VAL_END",t),this.actions=Ot,null;if(s>1)return new Mt(this.extractVals(",",i+1));let l=n[0];return l instanceof Et?l:l?new Eo(l.toString()):fe}exprError(e,t){this.actions=this.propName?Ot:gt,le.warn(e,t.toString())}exprStackReduce(e,t){let n=this.valStack,i=this.handler,r=n.pop(),o;for(;;){let s=n.pop();if(e==11){let l=[r];for(;s==16;)l.unshift(n.pop()),s=n.pop();if(typeof s=="string"){if(s=="{"){for(;l.length>=2;){let a=l.shift(),u=l.shift(),h=new AC(i.getScope(),a,u);l.unshift(h)}return n.push(new re(l[0])),!0}else if(s=="("){let a=n.pop(),u=n.pop();r=new Qo(i.getScope(),Kh(u,a),l),e=0;continue}}if(s==10){r.isMediaName()&&(r=new ig(i.getScope(),r,null)),e=0;continue}}else if(typeof s=="string"){n.push(s);break}if(s<0)if(s==-31)r=new Ti(i.getScope(),r);else if(s==-24)r=new Ar(i.getScope(),r);else if(s==-Sl)r=new IC(i.getScope(),r);else return this.exprError("F_UNEXPECTED_STATE",t),!1;else{if(qe[e]>qe[s]){n.push(s);break}switch(o=n.pop(),s){case 26:r=new Hd(i.getScope(),o,r);break;case mr:r=new RC(i.getScope(),o,r);break;case vr:r=new LC(i.getScope(),o,r);break;case 25:r=new Wd(i.getScope(),o,r);break;case 38:r=new FC(i.getScope(),o,r);break;case 37:r=new BC(i.getScope(),o,r);break;case 48:r=new OC(i.getScope(),o,r);break;case 47:r=new Jh(i.getScope(),o,r);break;case 39:case 49:r=new jd(i.getScope(),o,r);break;case 41:r=new _C(i.getScope(),o,r);break;case 23:r=new iy(i.getScope(),o,r);break;case 24:r=new ry(i.getScope(),o,r);break;case 36:r=new Gd(i.getScope(),o,r);break;case 19:r=new oy(i.getScope(),o,r);break;case 21:r=new sy(i.getScope(),o,r);break;case 18:if(n.length>1)switch(n[n.length-1]){case 22:n.pop(),r=new $C(i.getScope(),n.pop(),o,r);break;case 10:if(o.isMediaName())r=new ig(i.getScope(),o,r);else return this.exprError("E_CSS_MEDIA_TEST",t),!1;break}else return this.exprError("E_CSS_EXPR_COND",t),!1;break;case 22:if(e!=18)return this.exprError("E_CSS_EXPR_COND",t),!1;case 10:return n.push(o),n.push(s),n.push(r),!1;default:return this.exprError("F_UNEXPECTED_STATE",t),!1}}}return n.push(r),!1}readSupportsTest(e){let t=e.type===6,n=this.tokenizer,i,r;if(t)r=e.text,i=e.position+r.length+1;else if(e.type===10){let h=n.nthToken(1),p=n.nthToken(2);if(h.type===1&&p.type===18)n.consume(),n.consume(),r=h.text,i=p.position+1;else{if(h.type===10||h.type===6||h.type===1&&h.text.toLowerCase()==="not"&&(p.type===10||p.type===6))return null;i=e.position+1}}else return null;let o=0,s,l=0;for(;o>=0;)switch(n.consume(),s=n.token(),s.type){case 11:o--;break;case 10:case 6:o++;break;case 16:o===0&&l++;break;case 0:return this.exprError("E_CSS_UNEXPECTED_EOF",s),null}n.consume();let a=s.position,u=t&&r==="selector"&&l>0?"":n.input.substring(i,a).trim();return new DC(this.handler.getScope(),r,u,t)}readPseudoParams(){let e=[];for(;;){let t=this.tokenizer.token();switch(t.type){case 1:e.push(t.text);break;case 23:e.push("+");break;case 4:case 5:e.push(t.num);break;default:return e}this.tokenizer.consume()}}readNthPseudoParams(){let e=!1,t=this.tokenizer.token();if(t.type===23)e=!0,this.tokenizer.consume(),t=this.tokenizer.token();else if(t.type===1&&(t.text==="even"||t.text==="odd"))return this.tokenizer.consume(),[2,t.text==="odd"?1:0];switch(t.type){case 3:if(e&&t.num<0)return null;case 1:if(e&&t.text.charAt(0)==="-")return null;if(t.text==="n"||t.text==="-n"){if(e&&t.precededBySpace)return null;let n=t.text==="-n"?-1:1;t.type===3&&(n=t.num);let i=0;this.tokenizer.consume(),t=this.tokenizer.token();let r=t.type===24,o=t.type===23||r;if(o&&(this.tokenizer.consume(),t=this.tokenizer.token()),t.type===5){if(i=t.num,1/i===-1/0){if(i=0,o)return null}else if(i<0){if(o)return null}else if(i>=0&&!o)return null;this.tokenizer.consume()}else if(o)return null;return[n,r&&i>0?-i:i]}else if(t.text==="n-"||t.text==="-n-"){if(e&&t.precededBySpace)return null;let n=t.text==="-n-"?-1:1;if(t.type===3&&(n=t.num),this.tokenizer.consume(),t=this.tokenizer.token(),t.type===5)return t.num<0||1/t.num===-1/0?null:(this.tokenizer.consume(),[n,t.num])}else{let n=t.text.match(/^n(-[0-9]+)$/);if(n)return e&&t.precededBySpace?null:(this.tokenizer.consume(),[t.type===3?t.num:1,parseInt(n[1],10)]);if(n=t.text.match(/^-n(-[0-9]+)$/),n)return this.tokenizer.consume(),[-1,parseInt(n[1],10)]}return null;case 5:return e&&(t.precededBySpace||t.num<0)?null:(this.tokenizer.consume(),[0,t.num])}return null}makeCondition(e,t){let n=this.handler.getScope();if(!n)return null;if(t=t||n._true,e){let i=e.split(/\s+/);for(let r of i)switch(r){case"vertical":t=mn(n,t,new Ti(n,new lt(n,"pref-horizontal")));break;case"horizontal":t=mn(n,t,new lt(n,"pref-horizontal"));break;case"day":t=mn(n,t,new Ti(n,new lt(n,"pref-night-mode")));break;case"night":t=mn(n,t,new lt(n,"pref-night-mode"));break;default:t=n._false}}return t===n._true?null:new re(t)}isInsidePropertyOnlyRule(){switch(this.ruleStack[this.ruleStack.length-1]){case"[selector]":case"font-face":case"-epubx-flow":case"-epubx-viewport":case"-epubx-define":case"-adapt-footnote-area":return!0}return!1}runParser(e,t,n,i,r,o){let s=this.handler,l=this.tokenizer,a=this.valStack,u,h,p,c,f,v,w,x=null;for(n&&(this.inStyleDeclaration=!0),i&&(this.exprContext=2,this.valStack.push("{"));e>0;--e){if(u=l.token(),r&&x===null&&(x=u.position-1,l.input[x]==="("&&x++),this.actions===Ke&&this.errorBrackets.length>0&&(u.type===this.errorBrackets[this.errorBrackets.length-1]||u.type===17||u.type===31)){if(u.type===this.errorBrackets[this.errorBrackets.length-1]&&(this.errorBrackets.pop(),u.type===11&&this.valStackReduce(")",u))){l.consume();continue}a.push(new Eo(u.toString())),l.consume();continue}switch(this.actions[u.type]){case 28:if(!this.inStyleDeclaration||l.nthToken(1).type!=18){this.isInsidePropertyOnlyRule()?(s.error("E_CSS_COLON_EXPECTED",l.nthToken(1)),this.actions=Ot):(this.actions=jt,s.startSelectorRule());continue}this.propName=u.text,this.propImportant=!1,l.consume(),l.consume(),this.actions=Ke,a.splice(0,a.length);continue;case 46:if(l.nthToken(1).type!=18){this.actions=Ot,s.error("E_CSS_COLON_EXPECTED",l.nthToken(1));continue}this.propName=u.text,this.propImportant=!1,l.consume(),l.consume(),this.actions=Ke,a.splice(0,a.length);continue;case 29:this.actions=jt,s.startSelectorRule();continue;case 1:if(!u.precededBySpace){this.actions=ft,s.error("E_CSS_SPACE_EXPECTED",u);continue}s.descendantSelector();case 2:if(l.nthToken(1).type==34)if(l.consume(),l.consume(),p=this.namespacePrefixToURI[u.text],p!=null)switch(u=l.token(),u.type){case 1:s.tagSelector(p,u.text),r?this.actions=Qe:this.actions=Me,l.consume();break;case 36:s.tagSelector(p,null),r?this.actions=Qe:this.actions=Me,l.consume();break;default:this.actions=gt,s.error("E_CSS_NAMESPACE",u)}else this.actions=gt,s.error("E_CSS_UNDECLARED_PREFIX",u);else s.tagSelector(this.defaultNamespaceURI,u.text),r?this.actions=Qe:this.actions=Me,l.consume();continue;case 3:if(!u.precededBySpace){this.actions=ft,s.error("E_CSS_SPACE_EXPECTED",u);continue}s.descendantSelector();case 4:if(l.nthToken(1).type==34)switch(l.consume(),l.consume(),u=l.token(),u.type){case 1:s.tagSelector(null,u.text),r?this.actions=Qe:this.actions=Me,l.consume();break;case 36:s.tagSelector(null,null),r?this.actions=Qe:this.actions=Me,l.consume();break;default:this.actions=gt,s.error("E_CSS_NAMESPACE",u)}else s.tagSelector(this.defaultNamespaceURI,null),r?this.actions=Qe:this.actions=Me,l.consume();continue;case 5:u.precededBySpace&&s.descendantSelector();case 6:if(!u.text){s.error("E_CSS_SYNTAX",u),l.consume();continue}s.idSelector(u.text),r?this.actions=Qe:this.actions=Me,l.consume();continue;case 7:u.precededBySpace&&s.descendantSelector();case 8:s.classSelector(u.text),r?this.actions=Qe:this.actions=Me,l.consume();continue;case 55:u.precededBySpace&&s.descendantSelector();case 14:l.consume(),u=l.token();e:switch(u.type){case 1:s.pseudoclassSelector(u.text,null),l.consume(),r?this.actions=Qe:this.actions=Me;continue;case 6:switch(c=u.text,l.consume(),c){case"is":case"not":case"where":case"has":this.actions=jt,s.startFuncWithSelector(c),this.runParser(Number.POSITIVE_INFINITY,!1,!1,!1,!0,c==="has")?this.actions=Me:this.actions=ft;continue;case"lang":case"href-epub-type":if(u=l.token(),u.type===1){w=[u.text],l.consume(),c==="href-epub-type"&&l.token().type===16&&(l.consume(),u=l.token(),u.type===1&&(w.push(u.text),l.consume()));break}else break e;case"nth-child":case"nth-of-type":case"nth-last-child":case"nth-last-of-type":case"nth":if(w=this.readNthPseudoParams(),w)break;break e;default:w=this.readPseudoParams()}if(u=l.token(),u.type==11){s.pseudoclassSelector(c,w),l.consume(),r?this.actions=Qe:this.actions=Me;continue}break}s.error("E_CSS_PSEUDOCLASS_SYNTAX",u),this.actions=gt;continue;case 58:u.precededBySpace&&s.descendantSelector();case 42:switch(l.consume(),u=l.token(),u.type){case 1:s.pseudoelementSelector(u.text,null),r?this.actions=Qe:this.actions=Me,l.consume();continue;case 6:if(c=u.text,l.consume(),c=="nth-fragment"){if(w=this.readNthPseudoParams(),w===null)break}else w=this.readPseudoParams();if(u=l.token(),u.type==11){s.pseudoelementSelector(c,w),r?this.actions=Qe:this.actions=Me,l.consume();continue}break}s.error("E_CSS_PSEUDOELEM_SYNTAX",u),this.actions=gt;continue;case 9:u.precededBySpace&&s.descendantSelector();case 10:if(l.consume(),u=l.token(),u.type==1)c=u.text,l.consume();else if(u.type==36)c=null,l.consume();else if(u.type==34)c="";else{this.actions=ft,s.error("E_CSS_ATTR",u),l.consume();continue}if(u=l.token(),u.type==34){if(p=c&&this.namespacePrefixToURI[c],p===void 0){this.actions=ft,s.error("E_CSS_UNDECLARED_PREFIX",u),l.consume();continue}if(l.consume(),u=l.token(),u.type!=1){this.actions=ft,s.error("E_CSS_ATTR_NAME_EXPECTED",u);continue}c=u.text,l.consume(),u=l.token()}else p="";switch(u.type){case 39:case 45:case 44:case 43:case 42:case 46:case 50:f=u.type,l.consume(),u=l.token();break;case 15:s.attributeSelector(p,c,0,null),r?this.actions=Qe:this.actions=Me,l.consume();continue;default:this.actions=ft,s.error("E_CSS_ATTR_OP_EXPECTED",u);continue}switch(u.type){case 1:case 2:s.attributeSelector(p,c,f,u.text),l.consume(),u=l.token();break;default:this.actions=ft,s.error("E_CSS_ATTR_VAL_EXPECTED",u);continue}if(u.type!=15){this.actions=ft,s.error("E_CSS_ATTR",u);continue}r?this.actions=Qe:this.actions=Me,l.consume();continue;case 11:s.childSelector(),this.actions=dn,l.consume();continue;case 12:s.adjacentSiblingSelector(),this.actions=dn,l.consume();continue;case 56:s.followingSiblingSelector(),this.actions=dn,l.consume();continue;case 13:this.regionRule?(this.ruleStack.push("-epubx-region"),this.regionRule=!1):this.pageRule?(this.ruleStack.push("page"),this.pageRule=!1,this.inStyleDeclaration=!0):(this.ruleStack.push("[selector]"),this.inStyleDeclaration=!0),s.startRuleBody(),this.actions=Ze,l.consume();continue;case 41:s.nextSelector(),this.actions=jt,l.consume();continue;case 15:a.push(q(u.text)),l.consume();continue;case 16:f=parseInt(u.text,16),a.push(new gy(u.text)),l.consume();continue;case 17:a.push(new $i(u.num)),l.consume();continue;case 18:a.push(new ar(u.num)),l.consume();continue;case 19:a.push(new z(u.num,u.text)),l.consume();continue;case 20:a.push(new ut(u.text)),l.consume();continue;case 21:a.push(new Nn(et(u.text,this.baseURL))),l.consume();continue;case 57:a.push(new my(u.text)),l.consume();continue;case 22:this.valStackReduce(",",u),a.push(","),l.consume();continue;case 23:a.push(Ja),l.consume();continue;case 24:c=u.text.toLowerCase(),c=="-epubx-expr"||c=="env"?(this.actions=ht,this.exprContext=0,a.push("{")):(a.push(c),a.push("("),this.errorBrackets.length>0&&this.errorBrackets.push(11)),l.consume();continue;case 25:this.valStackReduce(")",u),l.consume();continue;case 47:if(l.consume(),u=l.token(),h=l.nthToken(1),u.type==1&&u.text.toLowerCase()=="important"&&(h.type==17||h.type==0||h.type==13)){l.consume(),this.propImportant=!0;continue}this.exprError("E_CSS_SYNTAX",u);continue;case 54:switch(h=l.nthToken(1),h.type){case 4:case 3:case 5:if(!h.precededBySpace){l.consume();continue}}a.push(new Eo("+")),l.consume();continue;case 26:l.consume();case 48:v=this.valStackReduce(";",u),v&&this.propName&&s.property(this.propName,v,this.propImportant),this.actions=n?Ca:Ze;continue;case 44:for(l.consume();a.length>0;){let g=a.length;if(v=this.valStackReduce(";",u),!v||a.length===g)break}return t?(this.result=v,!0):(this.propName&&v&&s.property(this.propName,v,this.propImportant),!0);case 31:if(h=l.nthToken(1),h.type==9)l.nthToken(2).type==10&&!l.nthToken(2).precededBySpace?(a.push(u.text,h.text,"("),l.consume()):(a.push(new lt(s.getScope(),Kh(u.text,h.text))),this.actions=Be),l.consume();else{if(this.exprContext==2||this.exprContext==3)u.text.toLowerCase()=="not"?(l.consume(),a.push(new ng(s.getScope(),!0,h.text))):(u.text.toLowerCase()=="only"&&(l.consume(),u=h),a.push(new ng(s.getScope(),!1,u.text)));else if(this.exprContext===4&&u.text.toLowerCase()==="not"&&a[a.length-1]!==mr&&a[a.length-1]!==vr&&(h.type===10||h.type===6)){a.push(-Sl),l.consume();continue}else a.push(new lt(s.getScope(),u.text));this.actions=Be}l.consume();continue;case 38:if(this.exprContext===4){a.push(this.readSupportsTest(u)),this.actions=Be;continue}a.push(null,u.text,"("),l.consume();continue;case 32:a.push(new dt(s.getScope(),u.num)),l.consume(),this.actions=Be;continue;case 33:c=u.text,c=="%"&&(this.propName&&this.propName.match(/height|^(top|bottom)$/)?c="vh":c="vw"),a.push(new js(s.getScope(),u.num,c)),l.consume(),this.actions=Be;continue;case 34:a.push(new dt(s.getScope(),u.text)),l.consume(),this.actions=Be;continue;case 35:l.consume(),u=l.token(),u.type!=5||u.precededBySpace?this.exprError("E_CSS_SYNTAX",u):(a.push(new hy(s.getScope(),u.num)),l.consume(),this.actions=Be);continue;case 36:a.push(-u.type),l.consume();continue;case 37:this.actions=ht,this.exprStackReduce(u.type,u),a.push(u.type),l.consume();continue;case 45:u.text.toLowerCase()==="and"&&a[a.length-2]!==vr&&a[a.length-2]!==-Sl?(this.actions=ht,this.exprStackReduce(mr,u),a.push(mr),l.consume()):u.text.toLowerCase()==="or"&&a[a.length-2]!==mr&&a[a.length-2]!==-Sl?(this.actions=ht,this.exprStackReduce(vr,u),a.push(vr),l.consume()):this.exprError("E_CSS_SYNTAX",u);continue;case 39:this.exprStackReduce(u.type,u)&&(this.actions=Ke),l.consume();continue;case 43:this.exprStackReduce(11,u)&&(this.propName||this.exprContext==3?this.exprError("E_CSS_UNEXPECTED_BRC",u):(this.exprContext==1?s.startWhenRule(a.pop()):s.startMediaRule(a.pop()),this.ruleStack.push("media"),s.startRuleBody(),this.actions=Ze)),l.consume();continue;case 49:if(this.exprStackReduce(11,u))return this.propName||this.exprContext!=3?(this.exprError("E_CSS_UNEXPECTED_SEMICOL",u),this.actions=Ze,l.consume(),!1):(this.importCondition=a.pop(),this.importReady=!0,this.actions=Ze,l.consume(),!1);l.consume();continue;case 40:if(this.exprContext===4){let g=this.readSupportsTest(u);if(g){a.push(g),this.actions=Be;continue}}a.push(u.type),l.consume();continue;case 27:if(this.actions=Ze,l.consume(),s.endRule(),this.inStyleDeclaration=!1,this.ruleStack.length)switch(this.ruleStack.pop(),this.ruleStack[this.ruleStack.length-1]){case"page":case"-epubx-page-master":case"-epubx-partition-group":this.inStyleDeclaration=!0}continue;case 30:switch(c=u.text.toLowerCase(),c){case"import":if(l.consume(),u=l.token(),u.type==2||u.type==8){if(this.importURL=u.text,l.consume(),u=l.token(),u.type==17||u.type==0)return this.importReady=!0,l.consume(),!1;this.propName=null,this.exprContext=3,this.actions=ht,a.push("{");continue}s.error("E_CSS_IMPORT_SYNTAX",u),this.actions=gt;continue;case"namespace":switch(l.consume(),u=l.token(),u.type){case 1:if(c=u.text,l.consume(),u=l.token(),(u.type==2||u.type==8)&&l.nthToken(1).type==17){this.namespacePrefixToURI[c]=u.text,l.consume(),l.consume();continue}break;case 2:case 8:if(l.nthToken(1).type==17){this.defaultNamespaceURI=u.text,l.consume(),l.consume();continue}break}s.error("E_CSS_NAMESPACE_SYNTAX",u),this.actions=gt;continue;case"charset":if(l.consume(),u=l.token(),u.type==2&&l.nthToken(1).type==17){c=u.text.toLowerCase(),c!="utf-8"&&c!="utf-16"&&s.error(`E_CSS_UNEXPECTED_CHARSET ${c}`,u),l.consume(),l.consume();continue}s.error("E_CSS_CHARSET_SYNTAX",u),this.actions=gt;continue;case"font-face":case"-epubx-page-template":case"-epubx-define":case"-epubx-viewport":if(l.nthToken(1).type==12){switch(l.consume(),l.consume(),c){case"font-face":s.startFontFaceRule(),this.inStyleDeclaration=!0;break;case"-epubx-page-template":s.startPageTemplateRule();break;case"-epubx-define":s.startDefineRule(),this.inStyleDeclaration=!0;break;case"-epubx-viewport":s.startViewportRule(),this.inStyleDeclaration=!0;break}this.ruleStack.push(c),s.startRuleBody();continue}break;case"-adapt-footnote-area":switch(l.consume(),u=l.token(),u.type){case 12:l.consume(),s.startFootnoteRule(null),this.ruleStack.push(c),s.startRuleBody(),this.inStyleDeclaration=!0;continue;case 50:if(l.consume(),u=l.token(),u.type==1&&l.nthToken(1).type==12){c=u.text,l.consume(),l.consume(),s.startFootnoteRule(c),this.ruleStack.push("-adapt-footnote-area"),s.startRuleBody(),this.inStyleDeclaration=!0;continue}break}break;case"-epubx-region":l.consume(),s.startRegionRule(),this.regionRule=!0,this.actions=jt;continue;case"page":l.consume(),s.startPageRule(),this.pageRule=!0,this.actions=dn;continue;case"top-left-corner":case"top-left":case"top-center":case"top-right":case"top-right-corner":case"right-top":case"right-middle":case"right-bottom":case"bottom-right-corner":case"bottom-right":case"bottom-center":case"bottom-left":case"bottom-left-corner":case"left-bottom":case"left-middle":case"left-top":if(l.consume(),u=l.token(),u.type==12){l.consume(),s.startPageMarginBoxRule(c),this.ruleStack.push(c),s.startRuleBody(),this.inStyleDeclaration=!0;continue}break;case"-epubx-when":l.consume(),this.propName=null,this.exprContext=1,this.actions=ht,a.push("{");continue;case"media":l.consume(),this.propName=null,this.exprContext=2,this.actions=ht,a.push("{");continue;case"supports":l.consume(),this.propName=null,this.exprContext=4,this.actions=ht,a.push("{");continue;case"-epubx-flow":if(l.nthToken(1).type==1&&l.nthToken(2).type==12){s.startFlowRule(l.nthToken(1).text),l.consume(),l.consume(),l.consume(),this.ruleStack.push(c),s.startRuleBody(),this.inStyleDeclaration=!0;continue}break;case"-epubx-page-master":case"-epubx-partition":case"-epubx-partition-group":{l.consume(),u=l.token();let g=null,m=null,y=[];for(u.type==1&&(g=u.text,l.consume(),u=l.token()),u.type==18&&l.nthToken(1).type==1&&(m=l.nthToken(1).text,l.consume(),l.consume(),u=l.token());u.type==6&&u.text.toLowerCase()=="class"&&l.nthToken(1).type==1&&l.nthToken(2).type==11;)y.push(l.nthToken(1).text),l.consume(),l.consume(),l.consume(),u=l.token();if(u.type==12){switch(l.consume(),c){case"-epubx-page-master":s.startPageMasterRule(g,m,y);break;case"-epubx-partition":s.startPartitionRule(g,m,y);break;case"-epubx-partition-group":s.startPartitionGroupRule(g,m,y);break}this.ruleStack.push(c),s.startRuleBody(),this.inStyleDeclaration=!0;continue}break}case"":s.error(`E_CSS_UNEXPECTED_AT${c}`,u),this.actions=ft;continue;default:s.error(`E_CSS_AT_UNKNOWN ${c}`,u),this.actions=gt;continue}s.error(`E_CSS_AT_SYNTAX ${c}`,u),this.actions=gt;continue;case 50:this.errorBrackets.push(u.type+1),l.consume();continue;case 52:if(this.errorBrackets.length==0){this.actions=Ze;continue}case 51:if(r&&this.errorBrackets.length==0&&u.type==11)return l.consume(),s.endFuncWithSelector(),!0;this.errorBrackets.length>0&&this.errorBrackets[this.errorBrackets.length-1]==u.type&&this.errorBrackets.pop(),this.errorBrackets.length==0&&u.type==13&&(this.actions=Ze),l.consume();continue;case 53:this.errorBrackets.length==0&&(this.actions=Ze),l.consume();continue;case 200:return!0;default:if(i)return this.exprStackReduce(11,u)?(this.result=a.pop(),!0):!1;if(r){switch(u.type){case 16:case 11:if(this.actions===jt)s.error("E_CSS_SYNTAX",u);else{let g=l.input.substring(x,u.position);s.pushSelectorText(g),x=u.position+1}if(u.type===16){s.nextSelector(),this.actions=jt,l.consume();continue}else return s.endFuncWithSelector(),l.consume(),!0;case 37:case 23:case 35:if(o){this.actions=Me;continue}break;case 12:case 14:case 10:this.errorBrackets.push(u.type+1);break}s.error("E_CSS_SYNTAX",u),l.consume(),this.actions=ft;continue}if(this.actions!==gt&&this.actions!==ft&&this.actions!==Ot){if(u.type==54)s.error("E_CSS_SYNTAX",u);else if(this.actions===Ke){switch(u.type){case 10:case 12:case 14:this.errorBrackets.push(u.type+1);break}a.push(new Eo(u.toString())),l.consume();continue}else if(u.type===12&&this.actions==ht&&a.length>0){s.startMediaRule(a.pop()),this.ruleStack.push("media"),s.startRuleBody(),this.actions=Ze,l.consume();continue}else{if(u.type===17&&this.actions==ht)return this.actions=Ze,l.consume(),!1;s.error("E_CSS_SYNTAX",u)}this.isInsidePropertyOnlyRule()?this.actions=Ot:this.actions=ft;continue}l.consume();continue}}return!1}},$y=class extends Kd{constructor(e){super(null),this.scope=e}error(e,t){le.warn(e,t.toString())}getScope(){return this.scope}};function Xk(e,t,n,i,r){let o=X("parseStylesheet"),s=new Ks(Ze,e,t,n),l=null;return r&&(l=qk(new Fn(r,t),t,n)),l=s.makeCondition(i,l&&l.toExpr()),l&&(t.startMediaRule(l),t.startRuleBody()),o.loop(()=>{for(;!s.runParser(100,!1,!1,!1,!1);){if(s.importReady){let u=et(s.importURL,n);s.importCondition&&(t.startMediaRule(s.importCondition),t.startRuleBody());let h=X("parseStylesheet.import");return Dy(u,t,null,null).then(()=>{s.importCondition&&t.endRule(),s.importReady=!1,s.importURL=null,s.importCondition=null,h.finish(!0)}),h.result()}let a=o.timeSlice();if(a.isPending)return a}return R(!1)}).then(()=>{l&&t.endRule(),o.finish(!0)}),o.result()}function Qd(e,t,n,i,r){return to("parseStylesheetFromText",o=>{let s=new Fn(e,t);Xk(s,t,n,i,r).thenFinish(o)},(o,s)=>{le.warn(s,`Failed to parse stylesheet text: ${e}`),o.finish(!1)})}function Dy(e,t,n,i){return to("parseStylesheetFromURL",r=>{iu(e).then(o=>{o.responseText?Qd(o.responseText,t,e,n,i).then(s=>{s||le.warn(`Failed to parse stylesheet from ${e}`),r.finish(!0)}):r.finish(!0)})},(r,o)=>{le.warn(o,"Exception while fetching and parsing:",e),r.finish(!0)})}function co(e,t,n){let i=new Ks(Ke,t,new $y(e),n);return i.runParser(Number.POSITIVE_INFINITY,!0,!1,!1,!1),i.result}function Yk(e,t,n){new Ks(Ca,e,t,n).runParser(Number.POSITIVE_INFINITY,!1,!0,!1,!1)}function qk(e,t,n){let i=new Ks(ht,e,t,n);return i.runParser(Number.POSITIVE_INFINITY,!1,!1,!0,!1),i.result}var Kk={"z-index":!0,"column-count":!0,"flow-linger":!0,opacity:!0,page:!0,"flow-priority":!0,utilization:!0};function Qk(e){return!!Kk[e]}function Zk(e,t,n){let i=t.evaluate(e);switch(typeof i){case"number":return Qk(n)?i==Math.round(i)?new ar(i):new $i(i):new z(i,"px");case"string":return i?co(t.scope,new Fn(i,null),""):fe;case"boolean":return i?S._true:S._false;case"undefined":return fe}throw new Error("E_UNEXPECTED")}function Vy(e,t){let n={};return Object.keys(e).forEach(i=>{let r=n[i]={},o=e[i];Object.keys(o).forEach(s=>{r[s]=o[s].map(l=>{let a=t?l.logical:l.physical,u=t?l.physical:l.logical;return{regexp:new RegExp(`(-?)${a}(-?)`),to:`$1${u}$2`}})})}),n}function Uy(e,t,n,i){let r=i[t];if(!r)throw new Error(`unknown writing-mode: ${t}`);let o=r[n||"ltr"];if(!o)throw new Error(`unknown direction: ${n}`);for(let s of o){let l=e.replace(s.regexp,s.to);if(l!==e)return l}return e}var Hy={"horizontal-tb":{ltr:[{logical:"inline-start",physical:"left"},{logical:"inline-end",physical:"right"},{logical:"block-start",physical:"top"},{logical:"block-end",physical:"bottom"},{logical:"inline-size",physical:"width"},{logical:"block-size",physical:"height"}],rtl:[{logical:"inline-start",physical:"right"},{logical:"inline-end",physical:"left"},{logical:"block-start",physical:"top"},{logical:"block-end",physical:"bottom"},{logical:"inline-size",physical:"width"},{logical:"block-size",physical:"height"}]},"vertical-rl":{ltr:[{logical:"inline-start",physical:"top"},{logical:"inline-end",physical:"bottom"},{logical:"block-start",physical:"right"},{logical:"block-end",physical:"left"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}],rtl:[{logical:"inline-start",physical:"bottom"},{logical:"inline-end",physical:"top"},{logical:"block-start",physical:"right"},{logical:"block-end",physical:"left"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}]},"vertical-lr":{ltr:[{logical:"inline-start",physical:"top"},{logical:"inline-end",physical:"bottom"},{logical:"block-start",physical:"left"},{logical:"block-end",physical:"right"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}],rtl:[{logical:"inline-start",physical:"bottom"},{logical:"inline-end",physical:"top"},{logical:"block-start",physical:"left"},{logical:"block-end",physical:"right"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}]}},Jk=Vy(Hy,!0);function Wy(e,t,n){return Uy(e,t,n||null,Jk)}var eE=Vy(Hy,!1);function jy(e,t,n){return Uy(e,t,n||null,eE)}var tE={"horizontal-tb":[{logical:"line-left",physical:"left"},{logical:"line-right",physical:"right"},{logical:"over",physical:"top"},{logical:"under",physical:"bottom"}],"vertical-rl":[{logical:"line-left",physical:"top"},{logical:"line-right",physical:"bottom"},{logical:"over",physical:"right"},{logical:"under",physical:"left"}],"vertical-lr":[{logical:"line-left",physical:"top"},{logical:"line-right",physical:"bottom"},{logical:"over",physical:"right"},{logical:"under",physical:"left"}]};function nE(e,t){let n=tE[t];if(!n)throw new Error(`unknown writing-mode: ${t}`);for(let i=0;i<n.length;i++)if(n[i].physical===e)return n[i].logical;return e}function Zd(e,t,n){var i;let r=t,o={width:r.style.width,height:r.style.height};function s(c){return e.getElementComputedStyle(t).getPropertyValue(c)}let l=s("writing-mode")!=="horizontal-tb",a=l?"height":"width",u=l?"width":"height";function h(c,f){r.style[c]=f;let v=s(c);return r.style[c]=o[c],v}let p={};for(let c of n){let f;switch(c){case"max-content inline size":f=h(a,"max-content");break;case"min-content inline size":f=h(a,"min-content");break;case"fit-content inline size":f=h(a,"fit-content");break;case"max-content block size":f=h(u,"max-content");break;case"min-content block size":f=h(u,"min-content");break;case"fit-content block size":f=h(u,"fit-content");break;case"max-content width":f=h("width","max-content");break;case"max-content height":f=h("height","max-content");break;case"min-content width":f=h("width","min-content");break;case"min-content height":f=h("height","min-content");break;case"fit-content width":f=h("width","fit-content");break;case"fit-content height":f=h("height","fit-content");break}f==="0px"&&t.childNodes.length===1&&((i=t.firstElementChild)==null?void 0:i.localName)==="img"&&!t.firstElementChild.complete&&(f="1px"),p[c]=parseFloat(f)}return p}function Oo(e){var t,n;return((t=e==null?void 0:e.style)==null?void 0:t["box-decoration-break"])==="clone"||((n=e==null?void 0:e.style)==null?void 0:n["-webkit-box-decoration-break"])==="clone"}function Gy(e){let t=e.getAttribute("data-viv-box-break");return t?t.split(" "):[]}function Xy(e,t){e.setAttribute("data-viv-box-break",t.join(" "))}function tn(e,t){let n=Gy(e);n.includes(t)||(n.push(t),Xy(e,n))}function iE(e){let t=e.getAttribute("data-viv-margin-discard");return t?t.split(" "):[]}function rE(e,t){e.setAttribute("data-viv-margin-discard",t.join(" "))}function Xu(e,t){let n=iE(e);n.includes(t)||(n.push(t),rE(e,n))}function oE(e){let t=e.name,n=e.value;switch(t){case"page-break-before":case"page-break-after":case"page-break-inside":return{name:t.replace(/^page-/,""),value:n===S.always?S.page:n,important:e.important};default:return e}}var lc={page:!0,left:!0,right:!0,recto:!0,verso:!0,column:!0,region:!0};function Dt(e){return!!lc[e]}var sE={left:!0,right:!0,recto:!0,verso:!0};function Rs(e){return!!sE[e]}var lE={avoid:!0,"avoid-page":!0,"avoid-column":!0,"avoid-region":!0};function ka(e){return!!lE[e]}function Bt(e,t){if(e)if(t){if(Rs(t))return t;if(Rs(e))return e;{let n=Dt(e),i=Dt(t);if(n&&i)switch(t){case"column":return e;case"region":return e==="column"?t:e;default:return t}else return i?t:n?e:ka(t)?t:ka(e)?e:t}}else return e;else return t}function vg(e){return Dt(e)?e:"auto"}wn("SIMPLE_PROPERTY",oE);var Jo=iC(oC());function aE(e,t){return(0,Jo.default)(e,t,0)}function wg(e){return e.reduce((t,n)=>n[0]===Jo.default.DELETE?t:t+n[1],"")}function uE(e,t){return Yy(e,t,1)}function hE(e,t){return Yy(e,t,-1)}function Yy(e,t,n){let i=0,r=0;return e.some(o=>{for(let s=0;s<o[1].length;s++){switch(o[0]*n){case Jo.default.INSERT:i++;break;case Jo.default.DELETE:i--,r++;break;case Jo.default.EQUAL:r++;break}if(r>t)return!0}return!1}),Math.max(Math.min(t,r-1)+i,0)}var ac;(e=>{function t(n){return n&&n.formattingContextType==="Block"}e.isInstanceOfBlockFormattingContext=t})(ac||(ac={}));var Hr;(e=>{(t=>(t.INLINE="inline",t.COLUMN="column",t.REGION="region",t.PAGE="page"))(e.FloatReference||(e.FloatReference={}))})(Hr||(Hr={}));var Ea;(e=>{function t(n){return n&&n.flagmentLayoutConstraintType=="AfterIfContinue"}e.isInstanceOfAfterIfContinuesLayoutConstraint=t})(Ea||(Ea={}));var Ji;(e=>{function t(i){return i?i.formattingContextType==="RepetitiveElementsOwner"||Li.isInstanceOfTableFormattingContext(i):!1}e.isInstanceOfRepetitiveElementsOwnerFormattingContext=t;function n(i){return i?i.flagmentLayoutConstraintType==="RepetitiveElementsOwner"||Li.isInstanceOfTableRowLayoutConstraint(i):!1}e.isInstanceOfRepetitiveElementsOwnerLayoutConstraint=n})(Ji||(Ji={}));var Li;(e=>{function t(i){return i&&i.formattingContextType==="Table"}e.isInstanceOfTableFormattingContext=t;function n(i){return i&&i.flagmentLayoutConstraintType==="TableRow"}e.isInstanceOfTableRowLayoutConstraint=n})(Li||(Li={}));var ii;(e=>{(t=>(t[t.IGNORE=0]="IGNORE",t[t.NEWLINE=1]="NEWLINE",t[t.PRESERVE=2]="PRESERVE"))(e.Whitespace||(e.Whitespace={})),(t=>(t[t.NONE=0]="NONE",t[t.CONTENT=1]="CONTENT",t[t.ROOTLESS=2]="ROOTLESS",t[t.ROOTED=3]="ROOTED"))(e.ShadowType||(e.ShadowType={}))})(ii||(ii={}));var cE={transform:!0,"transform-origin":!0},dE={top:!0,bottom:!0,left:!0,right:!0},Jd=class{constructor(e,t,n){this.target=e,this.name=t,this.value=n}},pE={show:function(e){e.style.visibility="visible"},hide:function(e){e.style.visibility="hidden"},play:function(e){e.currentTime=0,e.play()},pause:function(e){e.pause()},resume:function(e){e.play()},mute:function(e){e.muted=!0},unmute:function(e){e.muted=!1}};function fE(e,t){let n=pE[t];return n?()=>{for(let i=0;i<e.length;i++)try{n(e[i])}catch{}}:null}var uc=class Bo extends Vd{constructor(t,n){super(),this.container=t,this.bleedBox=n,d(this,"pageAreaElement",null),d(this,"delayedItems",[]),d(this,"hrefHandler"),d(this,"elementsById",{}),d(this,"dimensions",{width:0,height:0}),d(this,"isFirstPage",!1),d(this,"isLastPage",!1),d(this,"isBlankPage",!1),d(this,"isAutoPageWidth",!0),d(this,"isAutoPageHeight",!0),d(this,"spineIndex",0),d(this,"position",null),d(this,"offset",-1),d(this,"side",null),d(this,"fetchers",[]),d(this,"marginBoxes",{top:{},bottom:{},left:{},right:{}}),d(this,"pageType",null),this.hrefHandler=i=>{let r=i.currentTarget,o=r.getAttribute("href")||r.getAttributeNS("http://www.w3.org/1999/xlink","href");if(o){let s={type:"hyperlink",target:null,currentTarget:null,anchorElement:r,href:o,preventDefault(){i.preventDefault()}};this.dispatchEvent(s)}}}setAutoPageWidth(t){this.isAutoPageWidth=t,t?this.container.setAttribute(Bo.AUTO_PAGE_WIDTH_ATTRIBUTE,"true"):this.container.removeAttribute(Bo.AUTO_PAGE_WIDTH_ATTRIBUTE)}setAutoPageHeight(t){this.isAutoPageHeight=t,t?this.container.setAttribute(Bo.AUTO_PAGE_HEIGHT_ATTRIBUTE,"true"):this.container.removeAttribute(Bo.AUTO_PAGE_HEIGHT_ATTRIBUTE)}registerElementWithId(t,n){let i=this.elementsById[n];i?i.push(t):this.elementsById[n]=[t]}finish(t,n){Object.keys(this.elementsById).forEach(o=>{let s=this.elementsById[o];for(let l=0;l<s.length;)this.container.contains(s[l])?l++:s.splice(l,1);s.length===0&&delete this.elementsById[o]});let i=this.delayedItems;for(let o=0;o<i.length;o++){let s=i[o];s.target===this.container&&s.name==="transform"&&!this.isAutoPageWidth&&!this.isAutoPageHeight||O(s.target,s.name,s.value.toString())}let r=n.getElementClientRect(this.container);this.dimensions.width=r.width,this.dimensions.height=r.height;for(let o=0;o<t.length;o++){let s=t[o],l=this.elementsById[s.ref],a=this.elementsById[s.observer];if(l&&a){let u=fE(l,s.action);if(u)for(let h=0;h<a.length;h++)a[h].addEventListener(s.event,u,!1)}}}};d(uc,"AUTO_PAGE_WIDTH_ATTRIBUTE","data-vivliostyle-auto-page-width"),d(uc,"AUTO_PAGE_HEIGHT_ATTRIBUTE","data-vivliostyle-auto-page-height");var qy=uc,no="data-adapt-spec",Vt=ii.Whitespace;function Ky(e){switch(e){case"normal":case"nowrap":return Vt.IGNORE;case"pre-line":return Vt.NEWLINE;case"pre":case"pre-wrap":case"break-spaces":return Vt.PRESERVE;default:return null}}function vt(e,t){if(!e)return!0;if(e.nodeType==1)return!1;let n=e.textContent;switch(t){case Vt.PRESERVE:return n.length==0;case Vt.NEWLINE:return!!n.match(/^[ \t]*$/);case Vt.IGNORE:default:return!!n.match(/^[ \t\r\n\f]*$/)}}var gE=class{constructor(e,t){this.flowName=e,this.parentFlowName=t,d(this,"forcedBreakOffsets",[]),d(this,"formattingContext",null)}},mE=class{constructor(e,t,n,i,r,o,s,l,a){this.flowName=e,this.element=t,this.startOffset=n,this.priority=i,this.linger=r,this.exclusive=o,this.repeated=s,this.last=l,this.breakBefore=a,d(this,"startPage",-1)}isBetter(e){return this.exclusive?!e.exclusive||this.priority>e.priority?!0:this.last:!1}};function vE(e,t){return e.top-t.top}function wE(e,t){return t.right-e.right}function Qy(e,t){var n,i;return e===t?!0:!e||!t?!1:(e.node===t.node||!!e.shadowContext&&!!t.shadowContext&&e.shadowType===ii.ShadowType.ROOTLESS&&t.shadowType===ii.ShadowType.ROOTLESS&&((n=e.node)==null?void 0:n.outerHTML)===((i=t.node)==null?void 0:i.outerHTML))&&e.shadowType===t.shadowType&&cc(e.shadowContext,t.shadowContext)&&cc(e.nodeShadow,t.nodeShadow)&&Qy(e.shadowSibling,t.shadowSibling)}function Fi(e,t){if(e===t)return!0;if(!e||!t||e.offsetInNode!==t.offsetInNode||e.after!==t.after||e.steps.length!==t.steps.length)return!1;for(let n=0;n<e.steps.length;n++)if(!Qy(e.steps[n],t.steps[n]))return!1;return!0}function yE(e){return{steps:[{node:e,shadowType:cn.NONE,shadowContext:null,nodeShadow:null,shadowSibling:null,formattingContext:null,fragmentIndex:0}],offsetInNode:0,after:!1,preprocessedTextContent:null}}function Pa(e,t){return{steps:[{node:e.sourceNode,shadowType:cn.NONE,shadowContext:e.shadowContext,nodeShadow:null,shadowSibling:null,formattingContext:null,fragmentIndex:t??e.fragmentIndex}],offsetInNode:0,after:!1,preprocessedTextContent:e.preprocessedTextContent}}function Na(e,t){let n=new _o(e.node,t,0);return n.shadowType=e.shadowType,n.shadowContext=e.shadowContext,n.nodeShadow=e.nodeShadow,n.shadowSibling=e.shadowSibling?Na(e.shadowSibling,t.copy()):null,n.formattingContext=e.formattingContext,n.fragmentIndex=e.fragmentIndex+1,n}var cn=ii.ShadowType,hc=class{constructor(e,t,n,i,r,o,s){this.owner=e,this.root=t,this.xmldoc=n,this.parentShadow=i,this.type=o,this.styler=s,d(this,"subShadow",null),r&&(r.subShadow=this)}equals(e){return e?this.owner===e.owner&&this.xmldoc===e.xmldoc&&this.type===e.type&&cc(this.parentShadow,e.parentShadow):!1}};function cc(e,t){return e===t||!!e&&!!t&&e.equals(t)}var xE=class{constructor(e,t){this.outer=e,this.count=t}},_o=class Zy{constructor(t,n,i){this.sourceNode=t,this.parent=n,this.boxOffset=i,d(this,"offsetInNode",0),d(this,"after",!1),d(this,"shadowType"),d(this,"shadowContext"),d(this,"nodeShadow",null),d(this,"shadowSibling",null),d(this,"shared",!1),d(this,"inline",!0),d(this,"overflow",!1),d(this,"breakPenalty"),d(this,"display",null),d(this,"floatReference"),d(this,"floatSide",null),d(this,"clearSide",null),d(this,"floatMinWrapBlock",null),d(this,"columnSpan",null),d(this,"verticalAlign","baseline"),d(this,"captionSide","top"),d(this,"inlineBorderSpacing",0),d(this,"blockBorderSpacing",0),d(this,"flexContainer",!1),d(this,"whitespace"),d(this,"hyphenateCharacter"),d(this,"breakWord"),d(this,"establishesBFC",!1),d(this,"containingBlockForAbsolute",!1),d(this,"breakBefore",null),d(this,"breakAfter",null),d(this,"viewNode",null),d(this,"clearSpacer",null),d(this,"inheritedProps"),d(this,"vertical"),d(this,"direction"),d(this,"firstPseudo"),d(this,"lang",null),d(this,"preprocessedTextContent",null),d(this,"formattingContext"),d(this,"repeatOnBreak",null),d(this,"pluginProps",{}),d(this,"fragmentIndex",1),d(this,"afterIfContinues",null),d(this,"footnotePolicy",null),d(this,"pageType"),this.shadowType=cn.NONE,this.shadowContext=n?n.shadowContext:null,this.breakPenalty=n?n.breakPenalty:0,this.floatReference=Hr.FloatReference.INLINE,this.whitespace=n?n.whitespace:Vt.IGNORE,this.hyphenateCharacter=n?n.hyphenateCharacter:null,this.breakWord=n?n.breakWord:!1,this.inheritedProps=n?n.inheritedProps:{},this.vertical=n?n.vertical:!1,this.direction=n?n.direction:"ltr",this.firstPseudo=n?n.firstPseudo:null,this.formattingContext=n?n.formattingContext:null,this.pageType=n?n.pageType:null}resetView(){this.inline=!0,this.breakPenalty=this.parent?this.parent.breakPenalty:0,this.viewNode=null,this.clearSpacer=null,this.offsetInNode=0,this.after=!1,this.display=null,this.floatReference=Hr.FloatReference.INLINE,this.floatSide=null,this.clearSide=null,this.floatMinWrapBlock=null,this.columnSpan=null,this.verticalAlign="baseline",this.flexContainer=!1,this.whitespace=this.parent?this.parent.whitespace:Vt.IGNORE,this.hyphenateCharacter=this.parent?this.parent.hyphenateCharacter:null,this.breakWord=this.parent?this.parent.breakWord:!1,this.breakBefore=null,this.breakAfter=null,this.nodeShadow=null,this.establishesBFC=!1,this.containingBlockForAbsolute=!1,this.vertical=this.parent?this.parent.vertical:!1,this.nodeShadow=null,this.preprocessedTextContent=null,this.formattingContext=this.parent?this.parent.formattingContext:null,this.repeatOnBreak=null,this.pluginProps={},this.fragmentIndex=1,this.afterIfContinues=null,this.footnotePolicy=null}cloneItem(){let t=new Zy(this.sourceNode,this.parent,this.boxOffset);return t.offsetInNode=this.offsetInNode,t.after=this.after,t.nodeShadow=this.nodeShadow,t.shadowType=this.shadowType,t.shadowContext=this.shadowContext,t.shadowSibling=this.shadowSibling,t.inline=this.inline,t.breakPenalty=this.breakPenalty,t.display=this.display,t.floatReference=this.floatReference,t.floatSide=this.floatSide,t.clearSide=this.clearSide,t.floatMinWrapBlock=this.floatMinWrapBlock,t.columnSpan=this.columnSpan,t.verticalAlign=this.verticalAlign,t.captionSide=this.captionSide,t.inlineBorderSpacing=this.inlineBorderSpacing,t.blockBorderSpacing=this.blockBorderSpacing,t.establishesBFC=this.establishesBFC,t.containingBlockForAbsolute=this.containingBlockForAbsolute,t.flexContainer=this.flexContainer,t.whitespace=this.whitespace,t.hyphenateCharacter=this.hyphenateCharacter,t.breakWord=this.breakWord,t.breakBefore=this.breakBefore,t.breakAfter=this.breakAfter,t.viewNode=this.viewNode,t.clearSpacer=this.clearSpacer,t.firstPseudo=this.firstPseudo,t.vertical=this.vertical,t.overflow=this.overflow,t.preprocessedTextContent=this.preprocessedTextContent,t.formattingContext=this.formattingContext,t.repeatOnBreak=this.repeatOnBreak,t.pluginProps=Object.create(this.pluginProps),t.fragmentIndex=this.fragmentIndex,t.afterIfContinues=this.afterIfContinues,t.footnotePolicy=this.footnotePolicy,t}modify(){return this.shared?this.cloneItem():this}copy(){let t=this;do{if(t.shared)break;t.shared=!0,t=t.parent}while(t);return this}clone(){let t=this.cloneItem(),n=t,i;for(;(i=n.parent)!=null;)i=i.cloneItem(),n.parent=i,n=i;return t}toNodePositionStep(){return{node:this.sourceNode,shadowType:this.shadowType,shadowContext:this.shadowContext,nodeShadow:this.nodeShadow,shadowSibling:this.shadowSibling?this.shadowSibling.toNodePositionStep():null,formattingContext:this.formattingContext,fragmentIndex:this.fragmentIndex}}toNodePosition(){var t,n,i;let r=this,o=[];r.shadowType===ii.ShadowType.ROOTLESS&&(r.floatReference!==Hr.FloatReference.INLINE||r.floatSide==="footnote")&&(i=(n=(t=r.shadowContext)==null?void 0:t.styler)==null?void 0:n.style)!=null&&i._pseudos&&(r=r.parent);do(!r.firstPseudo||!r.parent||r.parent.firstPseudo===r.firstPseudo)&&o.push(r.toNodePositionStep()),r=r.parent;while(r);let s=this.preprocessedTextContent?hE(this.preprocessedTextContent,this.offsetInNode):this.offsetInNode;return{steps:o,offsetInNode:s,after:this.after,preprocessedTextContent:this.preprocessedTextContent}}isInsideBFC(){let t=this.parent;for(;t;){if(t.establishesBFC)return!0;t=t.parent}return!1}getContainingBlockForAbsolute(){let t=this.parent;for(;t;){if(t.containingBlockForAbsolute)return t;t=t.parent}return null}belongsTo(t){return this.formattingContext===t&&!!this.parent&&this.parent.formattingContext===t}},Oi=class Jy{constructor(t){this.primary=t,d(this,"floats",null)}clone(){let t=new Jy(this.primary);if(this.floats){t.floats=[];for(let n=0;n<this.floats.length;++n)t.floats[n]=this.floats[n]}return t}isSamePosition(t){if(!t)return!1;if(this===t)return!0;if(!Fi(this.primary,t.primary))return!1;if(this.floats){if(!t.floats||this.floats.length!==t.floats.length)return!1;for(let n=0;n<this.floats.length;n++)if(!Fi(this.floats[n],t.floats[n]))return!1}else if(t.floats)return!1;return!0}},bE=class e0{constructor(t,n){this.chunkPosition=t,this.flowChunk=n}clone(){return new e0(this.chunkPosition.clone(),this.flowChunk)}isSamePosition(t){return!!t&&(this===t||this.chunkPosition.isSamePosition(t.chunkPosition))}},SE=class t0{constructor(){d(this,"positions",[]),d(this,"startBreakType",null),d(this,"breakAfter",null)}clone(){let t=new t0,n=this.positions,i=t.positions;for(let r=0;r<n.length;r++)i[r]=n[r].clone();return t.startBreakType=this.startBreakType,t.breakAfter=this.breakAfter,t}isSamePosition(t){if(this===t)return!0;if(!t||this.positions.length!==t.positions.length)return!1;for(let n=0;n<this.positions.length;n++)if(!this.positions[n].isSamePosition(t.positions[n]))return!1;return!0}hasContent(t){return this.positions.length>0&&this.positions[0].flowChunk.startOffset<=t}},CE=class n0{constructor(){d(this,"page",0),d(this,"flows",{}),d(this,"flowPositions",{}),d(this,"isBlankPage",!1),d(this,"highestSeenOffset",0),d(this,"highestSeenNode"),d(this,"lookupPositionOffset")}clone(){let t=new n0;t.page=this.page,t.isBlankPage=this.isBlankPage,t.highestSeenNode=this.highestSeenNode,t.highestSeenOffset=this.highestSeenOffset,t.lookupPositionOffset=this.lookupPositionOffset,t.flows=this.flows;for(let n in this.flowPositions)t.flowPositions[n]=this.flowPositions[n].clone();return t}isSamePosition(t){if(this===t)return!0;if(!t||this.page!==t.page)return!1;let n=Object.keys(this.flowPositions),i=Object.keys(t.flowPositions);if(n.length!==i.length)return!1;for(let r of n)if(!this.flowPositions[r].isSamePosition(t.flowPositions[r]))return!1;return!0}hasContent(t,n){let i=this.flowPositions[t];return i?i.hasContent(n):!1}startSideOfFlow(t){var n;let i=(n=this.flowPositions[t])==null?void 0:n.startBreakType;return i&&Rs(i)?i:"any"}firstFlowChunkOfFlow(t){let n=this.flowPositions[t];if(!n)return null;let i=n.positions[0];return i?i.flowChunk:null}},i0=class{constructor(e){this.element=e,d(this,"left",0),d(this,"top",0),d(this,"marginLeft",0),d(this,"marginRight",0),d(this,"marginTop",0),d(this,"marginBottom",0),d(this,"borderLeft",0),d(this,"borderRight",0),d(this,"borderTop",0),d(this,"borderBottom",0),d(this,"paddingLeft",0),d(this,"paddingRight",0),d(this,"paddingTop",0),d(this,"paddingBottom",0),d(this,"width",0),d(this,"height",0),d(this,"originX",0),d(this,"originY",0),d(this,"exclusions",null),d(this,"innerShape",null),d(this,"computedBlockSize",0),d(this,"snapWidth",0),d(this,"snapHeight",0),d(this,"snapOffsetX",0),d(this,"snapOffsetY",0),d(this,"vertical",!1),d(this,"rtl",!1),d(this,"borderBoxSizing",!1)}getInsetTop(){return this.marginTop+(this.borderBoxSizing?0:this.borderTop+this.paddingTop)}getInsetBottom(){return this.marginBottom+(this.borderBoxSizing?0:this.borderBottom+this.paddingBottom)}getInsetLeft(){return this.marginLeft+(this.borderBoxSizing?0:this.borderLeft+this.paddingLeft)}getInsetRight(){return this.marginRight+(this.borderBoxSizing?0:this.borderRight+this.paddingRight)}getInsetBefore(){return this.vertical?this.getInsetRight():this.getInsetTop()}getInsetAfter(){return this.vertical?this.getInsetLeft():this.getInsetBottom()}getInsetStart(){return this.vertical?this.getInsetTop():this.getInsetLeft()}getInsetEnd(){return this.vertical?this.getInsetBottom():this.getInsetRight()}getBeforeEdge(e){return this.vertical?e.right:e.top}getAfterEdge(e){return this.vertical?e.left:e.bottom}getStartEdge(e){return this.vertical?this.rtl?e.bottom:e.top:this.rtl?e.right:e.left}getEndEdge(e){return this.vertical?this.rtl?e.top:e.bottom:this.rtl?e.left:e.right}getInlineSize(e){return this.vertical?e.bottom-e.top:e.right-e.left}getBoxSize(e){return this.vertical?e.right-e.left:e.bottom-e.top}getBoxDir(){return this.vertical?-1:1}getInlineDir(){return this.rtl?-1:1}copyFrom(e){this.element=e.element,this.left=e.left,this.top=e.top,this.marginLeft=e.marginLeft,this.marginRight=e.marginRight,this.marginTop=e.marginTop,this.marginBottom=e.marginBottom,this.borderLeft=e.borderLeft,this.borderRight=e.borderRight,this.borderTop=e.borderTop,this.borderBottom=e.borderBottom,this.paddingLeft=e.paddingLeft,this.paddingRight=e.paddingRight,this.paddingTop=e.paddingTop,this.paddingBottom=e.paddingBottom,this.width=e.width,this.height=e.height,this.originX=e.originX,this.originY=e.originY,this.innerShape=e.innerShape,this.exclusions=e.exclusions,this.computedBlockSize=e.computedBlockSize,this.snapWidth=e.snapWidth,this.snapHeight=e.snapHeight,this.vertical=e.vertical,this.rtl=e.rtl,this.borderBoxSizing=e.borderBoxSizing}setVerticalPosition(e,t){this.top=e,this.height=t,O(this.element,"top",`${e}px`),O(this.element,"height",`${t}px`)}setHorizontalPosition(e,t){this.left=e,this.width=t,O(this.element,"left",`${e}px`),O(this.element,"width",`${t}px`)}setBlockPosition(e,t){if(this.vertical){let n=t+this.marginLeft+this.marginRight+(this.borderBoxSizing?0:this.paddingLeft+this.paddingRight+this.borderLeft+this.borderRight);this.setHorizontalPosition(e+n*this.getBoxDir(),t)}else this.setVerticalPosition(e,t)}setInlinePosition(e,t){if(this.vertical)if(this.rtl){let n=t+this.marginTop+this.marginBottom+(this.borderBoxSizing?0:this.paddingTop+this.paddingBottom+this.borderTop+this.borderBottom);this.setVerticalPosition(e+n*this.getInlineDir(),t)}else this.setVerticalPosition(e,t);else if(this.rtl){let n=t+this.marginLeft+this.marginRight+(this.borderBoxSizing?0:this.paddingLeft+this.paddingRight+this.borderLeft+this.borderRight);this.setHorizontalPosition(e+n*this.getInlineDir(),t)}else this.setHorizontalPosition(e,t)}clear(){let e=this.element,t;for(;t=e.lastChild;)e.removeChild(t)}getInnerShape(){let e=this.getInnerRect();return this.innerShape?this.innerShape.withOffset(e.x1,e.y1):Yd(e.x1,e.y1,e.x2,e.y2)}getInnerRect(){let e=this.originX+this.left+this.getInsetLeft(),t=this.originY+this.top+this.getInsetTop();return new on(e,t,e+this.width,t+this.height)}getPaddingRect(){let e=this.originX+this.left+this.marginLeft+this.borderLeft,t=this.originY+this.top+this.marginTop+this.borderTop,n=this.paddingLeft+this.width+this.paddingRight,i=this.paddingTop+this.height+this.paddingBottom;return new on(e,t,e+n,t+i)}getOuterShape(e,t){let n=this.getOuterRect();return Sy(e,n.x1,n.y1,n.x2-n.x1,n.y2-n.y1,t)}getOuterRect(){let e=this.originX+this.left,t=this.originY+this.top,n=this.getInsetLeft()+this.width+this.getInsetRight(),i=this.getInsetTop()+this.height+this.getInsetBottom();return new on(e,t,e+n,t+i)}},Ta=class extends li{constructor(e,t,n,i){super(),this.elem=e,this.context=t,this.rootContentValue=n,this.exprContentListener=i}visitStrInner(e,t){var n;if(!t){if(((n=this.elem.lastChild)==null?void 0:n.nodeType)===3){this.elem.lastChild.textContent+=e;return}t=this.elem.ownerDocument.createTextNode(e)}this.elem.appendChild(t)}visitStr(e){return this.visitStrInner(e.str),null}visitURL(e){if(this.rootContentValue.url)this.elem.setAttribute("src",e.url);else{let t=this.elem.ownerDocument.createElementNS("http://www.w3.org/1999/xhtml","img");t.setAttribute("src",e.url),this.elem.appendChild(t)}return null}visitSpaceList(e){return this.visitValues(e.values),null}visitExpr(e){let t=e.toExpr(),n=t.evaluate(this.context);if(typeof n=="string"){t instanceof lt&&(n=co(t.scope,new Fn(n,null),"").stringValue()),this.elem.ownerDocument;let i=this.exprContentListener(t,n,this.elem.ownerDocument);!i&&n&&t instanceof mt&&t.str.startsWith("running-element-")&&(n=""),this.visitStrInner(n,i)}return null}};function Bi(e){return e!=null&&e!==fe&&e!==S.normal&&e!==S.none&&!Te(e)}var at=Hr.FloatReference;function kE(e){switch(e){case"inline":return at.INLINE;case"column":return at.COLUMN;case"region":return at.REGION;case"page":return at.PAGE;default:throw new Error(`Unknown float-reference: ${e}`)}}function Wr(e){switch(e){case at.INLINE:return!1;case at.COLUMN:case at.REGION:case at.PAGE:return!0;default:throw new Error(`Unknown float-reference: ${e}`)}}function yg(e,t,n,i){let r=t?"vertical-rl":"horizontal-tb";if((e==="top"||e==="bottom")&&(e=jy(e,r,n)),e==="block-start"&&(e="inline-start"),e==="block-end"&&(e="inline-end"),e==="inline-start"||e==="inline-end"){let o=Wy(e,r,n),s=nE(o,r);s==="line-left"?e="left":s==="line-right"&&(e="right")}else e==="inside"?e=i==="left"?"right":"left":e==="outside"&&(e=i==="left"?"left":"right");return e!=="left"&&e!=="right"&&(le.warn(`Invalid float value: ${e}. Fallback to left.`),e="left"),e}var r0=class{constructor(e,t,n,i,r,o){this.nodePosition=e,this.floatReference=t,this.floatSide=n,this.clearSide=i,this.flowName=r,this.floatMinWrapBlock=o,d(this,"order",null),d(this,"id",null)}getOrder(){if(this.order===null)throw new Error("The page float is not yet added");return this.order}getId(){if(!this.id)throw new Error("The page float is not yet added");return this.id}isAllowedOnContext(e){return e.isAnchorAlreadyAppeared(this.getId())}isAllowedToPrecede(e){return!1}},EE=class{constructor(){d(this,"floats",[]),d(this,"nextPageFloatIndex",0)}nextOrder(){return this.nextPageFloatIndex++}createPageFloatId(e){return`pf${e}`}addPageFloat(e){if(this.floats.findIndex(t=>Fi(t.nodePosition,e.nodePosition))>=0)throw new Error("A page float with the same source node is already registered");{let t=e.order=this.nextOrder();e.id=this.createPageFloatId(t),this.floats.push(e)}}findPageFloatByNodePosition(e){let t=this.floats.findIndex(n=>Fi(n.nodePosition,e));return t>=0?this.floats[t]:null}findPageFloatById(e){let t=this.floats.findIndex(n=>n.id===e);return t>=0?this.floats[t]:null}},o0=class{constructor(e,t,n,i,r){this.floatReference=e,this.floatSide=t,this.continuations=n,this.area=i,this.continues=r}hasFloat(e){return this.continuations.some(t=>t.float===e)}findNotAllowedFloat(e){for(let t=this.continuations.length-1;t>=0;t--){let n=this.continuations[t].float;if(!n.isAllowedOnContext(e))return n}return null}getOuterShape(){return this.area.getOuterShape(null,null)}getOuterRect(){return this.area.getOuterRect()}getOrder(){let e=this.continuations.map(t=>t.float);return Math.min.apply(null,e.map(t=>t.getOrder()))}shouldBeStashedBefore(e){return this.getOrder()<e.getOrder()}addContinuations(e){e.forEach(t=>{this.continuations.push(t)})}getFlowName(){let e=this.continuations[0].float.flowName;return this.continuations.every(t=>t.float.flowName===e),e}},xg=class{constructor(e,t){this.float=e,this.nodePosition=t}equals(e){return e?this===e?!0:this.float===e.float&&Fi(this.nodePosition,e.nodePosition):!1}},Mo=class{constructor(e,t,n,i,r,o,s){this.parent=e,this.floatReference=t,this.container=n,this.flowName=i,this.generatingNodePosition=r,d(this,"children",[]),d(this,"writingMode"),d(this,"direction"),d(this,"invalidated",!1),d(this,"floatStore"),d(this,"forbiddenFloats",[]),d(this,"floatFragments",[]),d(this,"stashedFloatFragments",[]),d(this,"floatAnchors",{}),d(this,"floatsDeferredToNext",[]),d(this,"floatsDeferredFromPrevious"),d(this,"layoutConstraints",[]),d(this,"locked",!1),e&&e.children.push(this),this.writingMode=o||e&&e.writingMode||S.horizontal_tb,this.direction=s||e&&e.direction||S.ltr,this.floatStore=e?e.floatStore:new EE;let l=this.getPreviousSibling();this.floatsDeferredFromPrevious=l?[].concat(l.floatsDeferredToNext):[]}getParent(e){if(!this.parent)throw new Error(`No PageFloatLayoutContext for ${e}`);return this.parent}getPreviousSiblingOf(e,t,n,i){let r=this.children.indexOf(e);r<0&&(r=this.children.length);for(let o=r-1;o>=0;o--){let s=this.children[o];if(s.floatReference===t&&s.flowName===n&&Fi(s.generatingNodePosition,i)||(s=s.getPreviousSiblingOf(null,t,n,i),s))return s}return null}getPreviousSibling(){let e=this,t=this.parent,n;for(;t;){if(n=t.getPreviousSiblingOf(e,this.floatReference,this.flowName,this.generatingNodePosition),n)return n;e=t,t=t.parent}return null}getContainer(e){return!e||e===this.floatReference?this.container:this.getParent(e).getContainer(e)}setContainer(e){this.container=e,this.reattachFloatFragments()}addPageFloat(e){this.floatStore.addPageFloat(e)}getPageFloatLayoutContext(e){return e===this.floatReference?this:this.getParent(e).getPageFloatLayoutContext(e)}findPageFloatByNodePosition(e){return this.floatStore.findPageFloatByNodePosition(e)}forbid(e){let t=e.getId(),n=e.floatReference;n===this.floatReference?this.forbiddenFloats.includes(t)||(this.forbiddenFloats.push(t),new io().findByFloat(e).forbid(e,this)):this.getParent(n).forbid(e)}isForbidden(e){let t=e.getId(),n=e.floatReference;return n===this.floatReference?this.forbiddenFloats.includes(t):this.getParent(n).isForbidden(e)}addPageFloatFragment(e,t){let n=e.floatReference;n!==this.floatReference?this.getParent(n).addPageFloatFragment(e,t):this.floatFragments.includes(e)||(this.floatFragments.push(e),this.floatFragments.sort((i,r)=>i.getOrder()-r.getOrder())),t||this.invalidate()}removePageFloatFragment(e,t){let n=e.floatReference;if(n!==this.floatReference)this.getParent(n).removePageFloatFragment(e,t);else{let i=this.floatFragments.indexOf(e);if(i>=0){let r=this.floatFragments.splice(i,1)[0],o=r.area&&r.area.element;o&&o.parentNode&&o.parentNode.removeChild(o),t||this.invalidate()}}}findPageFloatFragment(e){if(e.floatReference!==this.floatReference)return this.getParent(e.floatReference).findPageFloatFragment(e);let t=this.floatFragments.findIndex(n=>n.hasFloat(e));return t>=0?this.floatFragments[t]:null}hasFloatFragments(e){return this.floatFragments.length>0&&(!e||this.floatFragments.some(e))?!0:this.parent?this.parent.hasFloatFragments(e):!1}hasContinuingFloatFragmentsInFlow(e){return this.hasFloatFragments(t=>t.continues&&t.getFlowName()===e)}registerPageFloatAnchor(e,t){this.floatAnchors[e.getId()]=t}collectPageFloatAnchors(){let e=Object.assign({},this.floatAnchors);return this.children.reduce((t,n)=>Object.assign(t,n.collectPageFloatAnchors()),e)}isAnchorAlreadyAppeared(e){if(this.getDeferredPageFloatContinuations().some(n=>n.float.getId()===e))return!0;let t=this.collectPageFloatAnchors()[e];return t&&this.container&&this.container.element?this.container.element.contains(t):!1}deferPageFloat(e){let t=e.float;if(t.floatReference===this.floatReference){let n=this.floatsDeferredToNext.findIndex(i=>i.float===t);n>=0?this.floatsDeferredToNext.splice(n,1,e):this.floatsDeferredToNext.push(e)}else this.getParent(t.floatReference).deferPageFloat(e)}hasPrecedingFloatsDeferredToNext(e,t){if(!t&&e.floatReference!==this.floatReference)return this.getParent(e.floatReference).hasPrecedingFloatsDeferredToNext(e,!1);let n=e.getOrder();return this.floatsDeferredToNext.some(i=>i.float.getOrder()<n&&!e.isAllowedToPrecede(i.float))?!0:this.parent?this.parent.hasPrecedingFloatsDeferredToNext(e,!0):!1}getLastFollowingFloatInFragments(e){let t=e.getOrder(),n=null;if(this.floatFragments.forEach(i=>{i.continuations.forEach(r=>{let o=r.float,s=o.getOrder();s>t&&(!n||s>n.getOrder())&&(n=o)})}),this.parent){let i=this.parent.getLastFollowingFloatInFragments(e);i&&(!n||i.getOrder()>n.getOrder())&&(n=i)}return n}getDeferredPageFloatContinuations(e){e=e||this.flowName;let t=this.floatsDeferredFromPrevious.filter(n=>!e||n.float.flowName===e);return this.parent&&(t=this.parent.getDeferredPageFloatContinuations(e).concat(t)),t.sort((n,i)=>n.float.getOrder()-i.float.getOrder())}getPageFloatContinuationsDeferredToNext(e){e=e||this.flowName;let t=this.floatsDeferredToNext.filter(n=>!e||n.float.flowName===e);return this.parent?this.parent.getPageFloatContinuationsDeferredToNext(e).concat(t):t}getFloatsDeferredToNextInChildContexts(){let e=[],t=[];for(let n=this.children.length-1;n>=0;n--){let i=this.children[n];t.includes(i.flowName)||(t.push(i.flowName),e=e.concat(i.floatsDeferredToNext.map(r=>r.float)),e=e.concat(i.getFloatsDeferredToNextInChildContexts()))}return e}checkAndForbidNotAllowedFloat(){if(this.checkAndForbidFloatFollowingDeferredFloat())return!0;for(let e=this.floatFragments.length-1;e>=0;e--){let t=this.floatFragments[e],n=t.findNotAllowedFloat(this);if(n)return this.locked?this.invalidate():(this.removePageFloatFragment(t),this.forbid(n),this.removeEndFloatFragments(t.floatSide)),!0}return this.floatReference===at.REGION&&this.parent.locked?this.parent.checkAndForbidNotAllowedFloat():!1}checkAndForbidFloatFollowingDeferredFloat(){let e=this.getFloatsDeferredToNextInChildContexts(),t=this.floatFragments.reduce((n,i)=>n.concat(i.continuations.map(r=>r.float)),[]);t.sort((n,i)=>i.getOrder()-n.getOrder());for(let n of t){let i=n.getOrder();if(e.some(r=>!n.isAllowedToPrecede(r)&&i>r.getOrder())){if(this.locked)this.invalidate();else{this.forbid(n);let r=this.findPageFloatFragment(n);this.removePageFloatFragment(r)}return!0}}return!1}finish(){if(!this.checkAndForbidNotAllowedFloat()){for(let e=this.floatsDeferredToNext.length-1;e>=0;e--)if(!this.floatsDeferredToNext[e].float.isAllowedOnContext(this)){if(this.locked){this.invalidate();return}this.floatsDeferredToNext.splice(e,1)}this.floatsDeferredFromPrevious.forEach(e=>{this.floatsDeferredToNext.findIndex(t=>e.equals(t))>=0||this.floatFragments.some(t=>t.hasFloat(e.float))||this.floatsDeferredToNext.push(e)})}}hasSameContainerAs(e){return!!this.container&&!!e.container&&this.container.element===e.container.element}invalidate(){this.invalidated=!0,!this.locked&&(this.container&&(this.children.forEach(e=>{this.hasSameContainerAs(e)&&e.floatFragments.forEach(t=>{let n=t.area.element;n&&n.parentNode&&n.parentNode.removeChild(n)})}),this.container.clear()),this.children.forEach(e=>{e.layoutConstraints.splice(0)}),this.children.splice(0),Object.keys(this.floatAnchors).forEach(e=>{delete this.floatAnchors[e]}))}detachChildren(){let e=this.children.splice(0);return e.forEach(t=>{t.floatFragments.forEach(n=>{let i=n.area.element;i&&i.parentNode&&i.parentNode.removeChild(i)})}),e}attachChildren(e){e.forEach(t=>{this.children.push(t),t.reattachFloatFragments()})}isInvalidated(){return this.invalidated||!!this.parent&&this.parent.isInvalidated()}validate(){this.invalidated=!1}toLogical(e){let t=this.writingMode.toString(),n=this.direction.toString();if(e==="inside"||e==="outside"){let i=!!this.container.element.closest("[data-vivliostyle-page-side='left']");e=e==="inside"?i?"right":"left":i?"left":"right"}return jy(e,t,n)}toPhysical(e){let t=this.writingMode.toString(),n=this.direction.toString();return Wy(e,t,n)}toLogicalFloatSides(e){let t=e.split(" "),n=[];for(let s of t){let l=this.toLogical(s);n.includes(l)||n.push(l)}let i=[],r=!1,o=!1;for(let s=0;s<n.length;s++){let l=n[s];l.includes("block")?r||(n.slice(s+1).some(a=>a.includes("block"))?(i.push("snap-block"),r=!0):i.push(l)):l.includes("inline")&&(o||(n.slice(s+1).some(a=>a.includes("inline"))?(i.push("snap-inline"),o=!0):i.push(l)))}return i}removeEndFloatFragments(e){let t=this.toLogicalFloatSides(e)[0];if(t==="block-end"||t==="inline-end"){let n=0;for(;n<this.floatFragments.length;){let i=this.floatFragments[n];this.toLogicalFloatSides(i.floatSide)[0]===t?this.removePageFloatFragment(i):n++}}}stashEndFloatFragments(e){let t=e.floatReference;if(t!==this.floatReference){this.getParent(t).stashEndFloatFragments(e);return}let n=this.toLogicalFloatSides(e.floatSide)[0];if(n==="block-end"||n==="snap-block"||n==="inline-end"||n==="snap-inline"){let i=0;for(;i<this.floatFragments.length;){let r=this.floatFragments[i],o=this.toLogicalFloatSides(r.floatSide)[0];(o===n||n==="snap-block"&&o==="block-end"||n==="snap-inline"&&o==="inline-end")&&r.shouldBeStashedBefore(e)?(this.stashedFloatFragments.push(r),this.floatFragments.splice(i,1)):i++}}}restoreStashedFragments(e){if(e!==this.floatReference){this.getParent(e).restoreStashedFragments(e);return}this.stashedFloatFragments.forEach(t=>{this.addPageFloatFragment(t,!0)}),this.stashedFloatFragments.splice(0)}discardStashedFragments(e){if(e!==this.floatReference){this.getParent(e).discardStashedFragments(e);return}this.stashedFloatFragments.splice(0)}getStashedFloatFragments(e){return e===this.floatReference?this.stashedFloatFragments.concat().sort((t,n)=>n.getOrder()-t.getOrder()):this.getParent(e).getStashedFloatFragments(e)}getLimitValue(e,t,n,i){this.container;let r=this.toLogical(e),o=this.toPhysical(e),s=this.getLimitValueInner(r,t,n,i);if(this.parent&&this.parent.container){let l=this.parent.getLimitValue(o,t,n,i);switch(o){case"top":return Math.max(s,l);case"left":return Math.max(s,l);case"bottom":return Math.min(s,l);case"right":return Math.min(s,l)}}return s}getLimitValueInner(e,t,n,i){this.container;let r=this.getLimitValuesInner(t,n,i);switch(e){case"block-start":return this.container.vertical?r.right:r.top;case"block-end":return this.container.vertical?r.left:r.bottom;case"inline-start":return this.container.vertical?this.container.rtl?r.bottom:r.top:this.container.rtl?r.right:r.left;case"inline-end":return this.container.vertical?this.container.rtl?r.top:r.bottom:this.container.rtl?r.left:r.right;default:throw new Error(`Unknown logical side: ${e}`)}}getLimitValuesInner(e,t,n){this.container;let i=this.container.originX,r=this.container.originY,o=this.container.getPaddingRect(),s={top:o.y1-r,left:o.x1-i,bottom:o.y2-r,right:o.x2-i,floatMinWrapBlockStart:0,floatMinWrapBlockEnd:0};function l(u,h,p){return u.unit==="%"?p*u.num/100:e.convertLengthToPx(u,h,t)}let a=this.floatFragments;return a.length>0&&(s=a.reduce((u,h)=>{if(n&&!n(h,this))return u;let p=this.toLogicalFloatSides(h.floatSide)[0],c=h.area,f=h.continuations[0].float.floatMinWrapBlock,v=u.top,w=u.left,x=u.bottom,g=u.right,m=u.floatMinWrapBlockStart,y=u.floatMinWrapBlockEnd;switch(p){case"inline-start":c.vertical?v=Math.max(v,c.top+c.height):w=Math.max(w,c.left+c.width);break;case"block-start":c.vertical?(f&&c.left<g&&(m=l(f,c.rootViewNodes[0],o.x2-o.x1)),g=Math.min(g,c.left)):(f&&c.top+c.height>v&&(m=l(f,c.rootViewNodes[0],o.y2-o.y1)),v=Math.max(v,c.top+c.height));break;case"inline-end":c.vertical?x=Math.min(x,c.top):g=Math.min(g,c.left);break;case"block-end":c.vertical?(f&&c.left+c.width>w&&(y=l(f,c.rootViewNodes[0],o.x2-o.x1)),w=Math.max(w,c.left+c.width)):(f&&c.top<x&&(y=l(f,c.rootViewNodes[0],o.y2-o.y1)),x=Math.min(x,c.top));break;default:throw new Error(`Unknown logical float side: ${p}`)}return{top:v,left:w,bottom:x,right:g,floatMinWrapBlockStart:m,floatMinWrapBlockEnd:y}},s)),s.left+=i,s.right+=i,s.top+=r,s.bottom+=r,s}setFloatAreaDimensions(e,t,n,i,r,o,s){if(t!==this.floatReference)return this.getParent(t).setFloatAreaDimensions(e,t,n,i,r,o,s);let l=this.toLogicalFloatSides(n);if(l[0]==="snap-block"){if(!s["block-start"]&&!s["block-end"])return null}else if(l[0]==="snap-inline"){if(!s["inline-start"]&&!s["inline-end"])return null}else if(!s[l[0]])return null;e.clientLayout;let a=this.getLimitValue("block-start",e.layoutContext,e.clientLayout),u=this.getLimitValue("block-end",e.layoutContext,e.clientLayout),h=this.getLimitValue("inline-start",e.layoutContext,e.clientLayout),p=this.getLimitValue("inline-end",e.layoutContext,e.clientLayout),c=e.vertical?e.originX:e.originY,f=e.vertical?e.originY:e.originX;a=e.vertical?Math.min(a,e.left+e.getInsetLeft()+e.width+e.getInsetRight()+c):Math.max(a,e.top+c),u=e.vertical?Math.max(u,e.left+c):Math.min(u,e.top+e.getInsetTop()+e.height+e.getInsetBottom()+c);function v(y,C){let P=y(e.bands,C);return P?(e.vertical&&(P=yy(P)),a=e.vertical?Math.min(a,P.x2):Math.max(a,P.y1),u=e.vertical?Math.max(u,P.x1):Math.min(u,P.y2),!0):o}let w,x,g,m;if(r){let y=e.vertical?Sa(new on(u,h,a,p)):new on(h,a,p,u);if((l[0]==="block-start"||l[0]==="snap-block"||l[0]==="inline-start"||l[0]==="snap-inline")&&!v(qC,y)||(l[0]==="block-end"||l[0]==="snap-block"||l[0]==="inline-end"||l[0]==="snap-inline")&&!v(KC,y)||(g=(u-a)*e.getBoxDir(),w=g-e.getInsetBefore()-e.getInsetAfter(),m=(p-h)*e.getInlineDir(),x=m-e.getInsetStart()-e.getInsetEnd(),!o&&(w<=0||x<=0)))return null}else{w=e.computedBlockSize,g=w+e.getInsetBefore()+e.getInsetAfter();let y=(u-a)*e.getBoxDir();if(l[0]==="snap-block"){if(i===null)l[0]="block-start";else{let P=this.container.getPaddingRect(),A=this.container.getBoxDir()*(i-(this.container.vertical?P.x2:P.y1)),I=this.container.getBoxDir()*((this.container.vertical?P.x1:P.y2)-i-g);A<=I?l[0]="block-start":l[0]="block-end"}if(!s[l[0]])if(s["block-end"])l[0]="block-end";else return null}else if(l[0]==="snap-inline")if(i===null)l[0]="inline-start";else if(s["inline-start"])l[0]="inline-start";else if(s["inline-end"])l[0]="inline-end";else return null;if(!o&&y<g)return null;l[0]==="inline-start"||l[0]==="inline-end"||l[1]?x=Zd(e.clientLayout,e.element,["fit-content inline size"])["fit-content inline size"]:e.adjustContentRelativeSize?x=e.getContentInlineSize():x=e.vertical?e.height:e.width,m=x+e.getInsetStart()+e.getInsetEnd();let C=(p-h)*e.getInlineDir();if(!o&&C<m)return null}return a-=c,u-=c,h-=f,p-=f,l.some(y=>y==="inline-start"||y==="snap-inline")||l.length===1&&(l[0]==="block-start"||l[0]==="snap-block")?e.setInlinePosition(h,x):(l.some(y=>y==="inline-end")||l.length===1&&l[0]==="block-end")&&e.setInlinePosition(p-m*e.getInlineDir(),x),l.some(y=>y==="block-start"||y==="snap-block")||l.length===1&&(l[0]==="inline-start"||l[0]==="snap-inline")?e.setBlockPosition(a,w):(l.some(y=>y==="block-end")||l.length===1&&l[0]==="inline-end")&&e.setBlockPosition(u-g*e.getBoxDir(),w),l.join(" ")}getFloatFragmentExclusions(){let e=this.floatFragments.map(t=>t.getOuterShape());return this.parent?this.parent.getFloatFragmentExclusions().concat(e):e}reattachFloatFragments(){let e=this.container.element&&this.container.element.parentNode;e&&this.floatFragments.forEach(t=>{e.appendChild(t.area.element)})}getMaxReachedAfterEdge(){let e=this.getContainer().vertical;return this.floatFragments.reduce((t,n)=>{let i=n.getOuterRect();return e?Math.min(t,i.x1):Math.max(t,i.y2)},e?1/0:0)}getBlockStartEdgeOfBlockEndFloats(){let e=this.getContainer().vertical;return this.floatFragments.filter(t=>t.floatSide==="block-end").reduce((t,n)=>{let i=n.getOuterRect();return e?Math.max(t,i.x2):Math.min(t,i.y1)},e?0:1/0)}getPageFloatClearEdge(e,t){function n(a){return u=>a.isAnchorAlreadyAppeared(u.float.getId())}function i(a,u){return a.continuations.some(n(u))}let r=t.getPaddingRect(),o=t.vertical?r.x1:r.y2,s=this;for(;s;){if(s.floatsDeferredToNext.some(n(s)))return o;s=s.parent}t.clientLayout;let l=this.getLimitValue("block-start",t.layoutContext,t.clientLayout,i);return this.getLimitValue("block-end",t.layoutContext,t.clientLayout,i)*t.getBoxDir()<o*t.getBoxDir()?o:l}getPageFloatPlacementCondition(e,t,n){if(e.floatReference!==this.floatReference)return this.getParent(e.floatReference).getPageFloatPlacementCondition(e,t,n);let i={"block-start":!0,"block-end":!0,"inline-start":!0,"inline-end":!0};if(!n)return i;let r=this.toLogicalFloatSides(t)[0],o=this.toLogical(n),s;o==="all"?s=["block-start","block-end","inline-start","inline-end"]:o==="both"?s=["inline-start","inline-end"]:o==="same"?r==="snap-block"?s=["block-start","block-end"]:s=[r]:s=[o];let l=e.getOrder();function a(p){return c=>c.floatSide===p&&c.getOrder()<l}function u(p,c){return p.children.some(f=>f.floatFragments.some(a(c))||u(f,c))}function h(p,c){let f=p.parent;return!!f&&(f.floatFragments.some(a(c))||h(f,c))}return s.forEach(p=>{switch(p){case"block-start":case"inline-start":i[p]=!u(this,p);break;case"block-end":case"inline-end":i[p]=!h(this,p);break;default:throw new Error(`Unexpected side: ${p}`)}}),i}getLayoutConstraints(){return(this.parent?this.parent.getLayoutConstraints():[]).concat(this.layoutConstraints)}addLayoutConstraint(e,t){t===this.floatReference?this.layoutConstraints.push(e):this.getParent(t).addLayoutConstraint(e,t)}isColumnFullWithPageFloats(e){let t=e.layoutContext,n=e.clientLayout,i=this,r=null;for(;i&&i.container;){let s=i.getLimitValuesInner(t,n);r?e.vertical?(s.right<r.right&&(r.right=s.right,r.floatMinWrapBlockStart=s.floatMinWrapBlockStart),s.left>r.left&&(r.left=s.left,r.floatMinWrapBlockEnd=s.floatMinWrapBlockEnd)):(s.top>r.top&&(r.top=s.top,r.floatMinWrapBlockStart=s.floatMinWrapBlockStart),s.bottom<r.bottom&&(r.bottom=s.bottom,r.floatMinWrapBlockEnd=s.floatMinWrapBlockEnd)):r=s,i=i.parent}let o=Math.max(r.floatMinWrapBlockStart,r.floatMinWrapBlockEnd);return(e.vertical?r.right-r.left:r.bottom-r.top)<=o}getMaxBlockSizeOfPageFloats(){let e=this.getContainer().vertical;return this.floatFragments.length?Math.max.apply(null,this.floatFragments.map(t=>{let n=t.area;return e?n.width:n.height})):0}lock(){this.locked=!0}unlock(){this.locked=!1}isLocked(){return this.locked}},Po=[],io=class{static register(e){Po.push(e)}findByNodeContext(e){for(let t=Po.length-1;t>=0;t--){let n=Po[t];if(n.appliesToNodeContext(e))return n}throw new Error(`No PageFloatLayoutStrategy found for ${e}`)}findByFloat(e){for(let t=Po.length-1;t>=0;t--){let n=Po[t];if(n.appliesToFloat(e))return n}throw new Error(`No PageFloatLayoutStrategy found for ${e}`)}},PE=class{appliesToNodeContext(e){return Wr(e.floatReference)}appliesToFloat(e){return!0}createPageFloat(e,t,n){let i=e.floatReference;e.floatSide;let r=e.floatSide,o=e.toNodePosition();return n.resolveFloatReferenceFromColumnSpan(i,e.columnSpan,e).thenAsync(s=>{i=s,t.flowName;let l=new r0(o,i,r,e.clearSide,t.flowName,e.floatMinWrapBlock);return t.addPageFloat(l),R(l)})}createPageFloatFragment(e,t,n,i){let r=e[0].float;return new o0(r.floatReference,t,e,n,i)}findPageFloatFragment(e,t){return t.findPageFloatFragment(e)}adjustPageFloatArea(e,t,n){}forbid(e,t){}};io.register(new PE);var NE=o0,dc=class s0 extends r0{constructor(t,n,i,r,o){super(t,n,"block-end",null,i,o),this.footnotePolicy=r}isAllowedToPrecede(t){return!(t instanceof s0)}},bg=class extends NE{constructor(e,t,n,i){super(e,"block-end",t,n,i)}getOrder(){return 1/0}shouldBeStashedBefore(e){return e instanceof dc?!0:this.getOrder()<e.getOrder()}},TE=class{constructor(e){this.footnote=e}allowLayout(e){let t=e.toNodePosition();return!Fi(t,this.footnote.nodePosition)}},IE=class{appliesToNodeContext(e){return e.floatSide==="footnote"}appliesToFloat(e){return e instanceof dc}createPageFloat(e,t,n){let i=at.REGION,r=t.getPageFloatLayoutContext(i);t.getPageFloatLayoutContext(at.PAGE).hasSameContainerAs(r)&&(i=at.PAGE);let o=e.toNodePosition();t.flowName;let s=new dc(o,i,t.flowName,e.footnotePolicy,e.floatMinWrapBlock);return t.addPageFloat(s),R(s)}createPageFloatFragment(e,t,n,i){let r=e[0].float;return new bg(r.floatReference,e,n,i)}findPageFloatFragment(e,t){let n=t.getPageFloatLayoutContext(e.floatReference).floatFragments.filter(i=>i instanceof bg);return n.length<=1,n[0]||null}adjustPageFloatArea(e,t,n){e.isFootnote=!0,e.adjustContentRelativeSize=!1;let i=e.element;e.vertical=n.layoutContext.applyFootnoteStyle(t.vertical,n.layoutContext.nodeContext&&n.layoutContext.nodeContext.direction==="rtl",i),e.convertPercentageSizesToPx(i),n.setComputedInsets(i,e),n.setComputedWidthAndHeight(i,e)}forbid(e,t){let n=e;switch(n.footnotePolicy){case S.line:{let i=new TE(n);t.addLayoutConstraint(i,n.floatReference);break}}}};io.register(new IE);var RE="data-vivliostyle-flow-root";function AE(e){return e.getAttribute(RE)==="true"}function Sg(e){let t=(e==null?void 0:e.toString())||"block",n;switch(t){case"inline-flex":n="flex";break;case"inline-grid":n="grid";break;case"inline-table":n="table";break;case"inline":case"table-row-group":case"table-column":case"table-column-group":case"table-header-group":case"table-footer-group":case"table-row":case"table-cell":case"table-caption":case"inline-block":n="block";break;default:n=t}return q(n)}function ep(e){return e===S.absolute||e===S.fixed}function pc(e){return e instanceof ho&&e.name==="running"}function l0(e,t,n,i){return e===S.none||(ep(t)?(n=S.none,e=Sg(e)):(n&&n!==S.none&&!Te(n)||i)&&(e=Sg(e))),{display:e,position:t,float:n}}function a0(e,t,n,i){return l0(e,t,n,i).display===S.block}function Ki(e){switch(e.toString()){case"inline":case"inline-block":case"inline-list-item":case"inline-flex":case"inline-grid":case"ruby":case"inline-table":return!0;default:return!1}}function u0(e){switch(e.toString()){case"ruby-base":case"ruby-text":case"ruby-base-container":case"ruby-text-container":return!0;default:return!1}}function LE(e,t,n,i,r,o,s){return r=r||o||S.horizontal_tb,!!s||!!n&&n!==S.none&&!Te(n)||ep(t)||e===S.inline_block||e===S.table_cell||e===S.table_caption||e==S.flex||e==S.grid||e==S.flow_root||(e===S.block||e===S.list_item)&&!!i&&i!==S.visible&&i!==S.clip&&!Te(i)||!!o&&r!==o}function FE(e){return e===S.relative||e===S.absolute||e===S.fixed}function wr(e,t,n,i){let r=e.viewNode;if(!r)return NaN;let o=r.nodeType===1?r:r.parentElement;if(o&&o.namespaceURI==="http://www.w3.org/1999/xhtml"){let s=o.style;if(s&&Ki(s.display)&&/^([\d\.]|super|(text-)?top)/.test(s.verticalAlign))return NaN}if(r===o){if(e.after||!e.inline){if(e.after&&!e.inline&&o.querySelector("ruby")){let l=o.parentNode,a=o.nextSibling;l.removeChild(o),l.insertBefore(o,a)}let s=t.getElementClientRect(o);if(s.left===0&&s.top===0&&s.right===0&&s.bottom===0)return NaN;if(s.right>=s.left&&s.bottom>=s.top)return e.after?i?s.left:s.bottom:i?s.right:s.top}return NaN}else{let s=NaN,l=r.ownerDocument.createRange(),a=r.textContent.length;if(!a)return NaN;e.after&&(n+=a),n>=a&&(n=a-1),l.setStart(r,n),l.setEnd(r,n+1);let u=t.getRangeClientRects(l);return u=u.filter(h=>h.right>h.left&&h.bottom>h.top),u.length?(i?s=Math.min.apply(null,u.map(h=>h.left)):s=Math.max.apply(null,u.map(h=>h.bottom)),s):NaN}}function fc(e,t,n){let i=t.clientLayout.getElementClientRect(e),r=t.getComputedMargin(e);return n?i.width+r.left+r.right:i.height+r.top+r.bottom}function Lr(e){for(;e;){if(e.parentNode===e.ownerDocument)return!1;e=e.parentNode}return!0}function h0(e,t){var n;if(e)for(let i=e.lastChild,r=i;i!==t;i=r)r=i.previousSibling,!(i.nodeType===1&&i.hasAttribute("data-vivliostyle-float-box-moved")&&((n=t.style)==null?void 0:n.display)==="inline")&&e.removeChild(i)}function tp(e){return!!e.getAttribute(no)}function zo(e){var t;if((e==null?void 0:e.nodeType)!==1)return!1;let n=e;if(tp(n))return!0;let i=(t=n.style)==null?void 0:t.position;return i==="absolute"||i==="fixed"}function Fr(e){let t=e==null?void 0:e.viewNode;return(t==null?void 0:t.nodeType)===1&&tp(t)}function OE(e){return e!=="inline"&&(Ki(e)||u0(e))}function Cg(e){var t;for(let n=e.parent;n;n=n.parent)if((n.display!=="inline"||n.vertical!==((t=n.parent)==null?void 0:t.vertical))&&Ki(n.display))return n;return null}var np=class{calculateOffset(e){return jr(this.getNodeContext(),e.collectElementsOffset())}breakPositionChosen(e){}getNodeContext(){return null}};function jr(e,t){return{current:t.reduce((n,i)=>n+i.calculateOffset(e),0),minimum:t.reduce((n,i)=>n+i.calculateMinimumOffset(e),0)}}var Qs=class extends np{constructor(e,t,n,i){super(),this.position=e,this.breakOnEdge=t,this.overflows=n,this.computedBlockSize=i,d(this,"overflowIfRepetitiveElementsDropped"),d(this,"isEdgeUpdated",!1),d(this,"edge",0),this.overflowIfRepetitiveElementsDropped=n}findAcceptableBreak(e,t){return this.updateOverflows(e),t<this.getMinBreakPenalty()?null:e.findEdgeBreakPosition(this)}getMinBreakPenalty(){if(!this.isEdgeUpdated)throw new Error("EdgeBreakPosition.prototype.updateEdge not called");let e=this.isFirstContentOfRepetitiveElementsOwner()&&!this.overflowIfRepetitiveElementsDropped;return(ka(this.breakOnEdge)?1:0)+(this.overflows&&!e?3:0)+(this.position.parent?this.position.parent.breakPenalty:0)}updateEdge(e){var t;let n=e.calculateClonedPaddingBorder(this.position);if(this.edge=wr(this.position,e.clientLayout,0,e.vertical)+n,!this.position.after&&!this.position.inline){let i=e.parseComputedLength(e.clientLayout.getElementComputedStyle(this.position.viewNode).marginBlockStart);this.edge-=(e.vertical?-1:1)*i}else if(this.position.after&&((t=this.position.shadowContext)==null?void 0:t.root.id)==="table-cell"){let i=e.element.parentElement,r=i==null?void 0:i.closest("table, [style*='display: table;']");if(r){let o=r.style.borderCollapse==="collapse",s=0,l=0;for(let a=i;a;a=a.parentElement){let u=e.clientLayout.getElementComputedStyle(a);if((a===i||a===r&&!o)&&(s+=e.parseComputedLength(u.paddingBlockEnd)),a===r&&!o&&(s+=e.parseComputedLength(u.borderSpacing.replace(/^\S+ (\S+)$/,"$1"))),o?l=Math.max(l,e.parseComputedLength(u.borderBlockEndWidth)):(a===i||a===r)&&(l+=e.parseComputedLength(u.borderBlockEndWidth)),a===r)break}this.edge+=(e.vertical?-1:1)*(s+l)}}this.isEdgeUpdated=!0}updateOverflows(e){this.isEdgeUpdated||this.updateEdge(e);let t=this.edge,n=this.calculateOffset(e);this.overflowIfRepetitiveElementsDropped=e.isOverflown(t+(e.vertical?-1:1)*n.minimum),this.overflows=this.position.overflow=e.isOverflown(t+(e.vertical?-1:1)*n.current)}getNodeContext(){return this.position}isFirstContentOfRepetitiveElementsOwner(){let e=this.getNodeContext();if(!e||!e.parent)return!1;let{formattingContext:t}=e.parent;if(!Ji.isInstanceOfRepetitiveElementsOwnerFormattingContext(t))return!1;let n=t.getRepetitiveElements();return n?n.isFirstContentNode(e):!1}},No=class{find(e){let t=An("RESOLVE_LAYOUT_PROCESSOR");for(let n=0;n<t.length;n++){let i=t[n](e);if(i)return i}throw new Error(`No processor found for a formatting context: ${e.getName()}`)}},Or=class{layout(e,t,n){return t.isFloatNodeContext(e)?t.layoutFloatOrFootnote(e):t.isBreakable(e)?t.layoutBreakableBlock(e):t.layoutUnbreakable(e)}createEdgeBreakPosition(e,t,n,i){return new Qs(e.copy(),t,n,i)}startNonInlineElementNode(e){return!1}afterNonInlineElementNode(e,t){return!1}clearOverflownViewNodes(e,t,n,i){var r;if(!n.viewNode||!n.viewNode.parentNode||n.shadowType===ii.ShadowType.ROOTLESS&&Fr(n))return;let o=n.viewNode;((r=o.parentElement)==null?void 0:r.localName)==="viv-ts-inner"&&(o=o.parentElement.parentElement);let s=o.parentNode;h0(s,o),i&&s.removeChild(o)}finishBreak(e,t,n,i){let r=n||t.viewNode!=null&&t.viewNode.nodeType==1&&!t.after;return e.clearOverflownViewNodes(t,r),i&&e.layoutContext.processFragmentedBlockEdge(t),R(!0)}},ip=class{constructor(e){this.parent=e,d(this,"formattingContextType","Block")}getName(){return"Block formatting context (BlockFormattingContext)"}isFirstTime(e,t){return t}getParent(){return this.parent}saveState(){}restoreState(e){}},rp=new Or,BE=ac.isInstanceOfBlockFormattingContext;wn("RESOLVE_FORMATTING_CONTEXT",(e,t,n,i,r,o)=>{let s=e.parent;return!s&&e.formattingContext||s&&e.formattingContext!==s.formattingContext?null:e.establishesBFC||!e.formattingContext&&a0(n,i,r,o)?new ip(s?s.formattingContext:null):null});wn("RESOLVE_LAYOUT_PROCESSOR",e=>e instanceof ip?rp:null);var op=class{constructor(){d(this,"initialBreakPositions",null),d(this,"initialStateOfFormattingContext",null),d(this,"initialPosition"),d(this,"initialFragmentLayoutConstraints")}layout(e,t){return this.prepareLayout(e,t),this.tryLayout(e,t)}tryLayout(e,t){let n=X("AbstractLayoutRetryer.tryLayout");this.saveState(e,t);let i=this.resolveLayoutMode(e);return i.doLayout(e,t).then(r=>{let o=i.accept(r,t);o=i.postLayout(r,this.initialPosition,t,o),o?n.finish(r):(this.initialPosition,this.clearNodes(this.initialPosition),this.restoreState(e,t),this.tryLayout(this.initialPosition,t).thenFinish(n))}),n.result()}prepareLayout(e,t){}clearNodes(e){let t=e.viewNode||e.parent.viewNode,n;for(;n=t.lastChild;)t.removeChild(n);let i;for(;i=t.nextSibling;)i.parentNode.removeChild(i)}saveState(e,t){this.initialPosition=e.copy(),this.initialBreakPositions=[].concat(t.breakPositions),this.initialFragmentLayoutConstraints=[].concat(t.fragmentLayoutConstraints),e.formattingContext&&(this.initialStateOfFormattingContext=e.formattingContext.saveState())}restoreState(e,t){t.breakPositions=this.initialBreakPositions,t.fragmentLayoutConstraints=this.initialFragmentLayoutConstraints,e.formattingContext&&e.formattingContext.restoreState(this.initialStateOfFormattingContext)}},_E=class{initialState(e){return{nodeContext:e,atUnforcedBreak:!1,break:!1}}startNonDisplayableNode(e){}afterNonDisplayableNode(e){}startIgnoredTextNode(e){}afterIgnoredTextNode(e){}startNonElementNode(e){}afterNonElementNode(e){}startInlineElementNode(e){}afterInlineElementNode(e){}startNonInlineElementNode(e){}afterNonInlineElementNode(e){}finish(e){}},gc=class{constructor(e,t){this.strategy=e,this.layoutContext=t}iterate(e){let t=this.strategy,n=t.initialState(e),i=X("LayoutIterator");return i.loopWithFrame(r=>{let o;for(;n.nodeContext;){n.nodeContext.viewNode?n.nodeContext.viewNode.nodeType!==1?vt(n.nodeContext.viewNode,n.nodeContext.whitespace)?n.nodeContext.after?o=t.afterIgnoredTextNode(n):o=t.startIgnoredTextNode(n):n.nodeContext.after?o=t.afterNonElementNode(n):o=t.startNonElementNode(n):n.nodeContext.inline?n.nodeContext.after?o=t.afterInlineElementNode(n):o=t.startInlineElementNode(n):n.nodeContext.after?o=t.afterNonInlineElementNode(n):o=t.startNonInlineElementNode(n):n.nodeContext.after?o=t.afterNonDisplayableNode(n):o=t.startNonDisplayableNode(n);let s=(o&&o.isPending()?o:R(!0)).thenAsync(()=>n.break?R(null):this.layoutContext.nextInTree(n.nodeContext,n.atUnforcedBreak));if(s.isPending()){s.then(l=>{n.break?r.breakLoop():(n.nodeContext=l,r.continueLoop())});return}else if(n.break){r.breakLoop();return}else n.nodeContext=s.get()}t.finish(n),r.breakLoop()}).then(()=>{i.finish(n.nodeContext)}),i.result()}},es=class extends _E{constructor(e){super(),this.leadingEdge=e}startNonInlineBox(e){}endEmptyNonInlineBox(e){}endNonInlineBox(e){}initialState(e){return{nodeContext:e,atUnforcedBreak:!!this.leadingEdge&&e.after,break:!1,leadingEdge:this.leadingEdge,breakAtTheEdge:null,onStartEdges:!1,leadingEdgeContexts:[],lastAfterNodeContext:null}}processForcedBreak(e,t){let n=!e.leadingEdge&&Dt(e.breakAtTheEdge);if(n){let i=e.nodeContext=e.leadingEdgeContexts[0]||e.nodeContext;i.viewNode.parentNode.removeChild(i.viewNode),t.pageBreakType=e.breakAtTheEdge}return n}saveEdgeAndProcessOverflow(e,t){let n=t.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!0,e.breakAtTheEdge);return n&&(e.nodeContext=(e.lastAfterNodeContext||e.nodeContext).modify(),e.nodeContext.overflow=!0),n}processLayoutConstraint(e,t,n){let i=e.nodeContext,r=!t.allowLayout(i);return r&&(n.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!1,e.breakAtTheEdge),i=e.nodeContext=i.modify(),i.overflow=!0),r}startNonElementNode(e){e.onStartEdges=!1}startNonInlineElementNode(e){return e.leadingEdgeContexts.push(e.nodeContext.copy()),e.breakAtTheEdge=Bt(e.breakAtTheEdge,e.nodeContext.breakBefore),e.onStartEdges=!0,this.startNonInlineBox(e)}afterNonInlineElementNode(e){let t,n;return e.onStartEdges?(t=this.endEmptyNonInlineBox(e),n=t&&t.isPending()?t:R(!0),n=n.thenAsync(()=>(e.break||(e.leadingEdgeContexts=[],e.leadingEdge=!1,e.atUnforcedBreak=!1,e.breakAtTheEdge=null),R(!0)))):(t=this.endNonInlineBox(e),n=t&&t.isPending()?t:R(!0)),n.thenAsync(()=>(e.break||(e.onStartEdges=!1,e.lastAfterNodeContext=e.nodeContext.copy(),e.breakAtTheEdge=Bt(e.breakAtTheEdge,e.nodeContext.breakAfter)),R(!0)))}},mc=[];function ME(){mc=[]}function c0(e,t,n){return e-=n,t===0?e===0:e%t===0&&e/t>=0}var zE=class{constructor(e){this.matchers=e}matches(){return this.matchers.some(e=>e.matches())}},$E=class{constructor(e){this.matchers=e}matches(){return this.matchers.every(e=>e.matches())}},d0=class Ul{constructor(t,n,i){this.elementOffset=t,this.a=n,this.b=i}static registerFragmentIndex(t,n,i){let r=Ul.fragmentIndices;(!r[t]||r[t].priority<=i)&&(r[t]={fragmentIndex:n,priority:i})}static clearFragmentIndices(){Ul.fragmentIndices={}}matches(){let t=Ul.fragmentIndices[this.elementOffset];return t!=null&&t.fragmentIndex!=null&&c0(t.fragmentIndex,this.a,this.b)}};d(d0,"fragmentIndices",{});var ru=d0,Cl=class{static buildViewConditionMatcher(e,t){let n=t.split("_");return n[0]=="NFS"?new ru(e,parseInt(n[1],10),parseInt(n[2],10)):null}static buildAllMatcher(e){return new $E(e)}static buildAnyMatcher(e){return new zE(e)}},p0={"border-collapse":!0,"border-spacing":!0,"caption-side":!0,"clip-rule":!0,color:!0,"color-interpolation":!0,"color-rendering":!0,cursor:!0,direction:!0,"empty-cells":!0,fill:!0,"fill-opacity":!0,"fill-rule":!0,"font-kerning":!0,"font-size":!0,"font-size-adjust":!0,"font-family":!0,"font-feature-settings":!0,"font-style":!0,"font-stretch":!0,"font-variant-ligatures":!0,"font-variant-caps":!0,"font-variant-numeric":!0,"font-variant-east-asian":!0,"font-weight":!0,"glyph-orientation-vertical":!0,"hanging-punctuation":!0,hyphens:!0,"hyphenate-character":!0,"hyphenate-limit-chars":!0,"hyphenate-limit-last":!0,"image-rendering":!0,"image-resolution":!0,"letter-spacing":!0,"line-break":!0,"line-height":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,marker:!0,"marker-end":!0,"marker-mid":!0,"marker-start":!0,orphans:!0,"overflow-wrap":!0,"paint-order":!0,"pointer-events":!0,quotes:!0,"ruby-align":!0,"ruby-position":!0,"shape-rendering":!0,stroke:!0,"stroke-dasharray":!0,"stroke-dashoffset":!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-miterlimit":!0,"stroke-opacity":!0,"stroke-width":!0,"tab-size":!0,"text-align":!0,"text-align-last":!0,"text-anchor":!0,"text-autospace":!0,"text-decoration-skip":!0,"text-decoration-skip-ink":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-fill-color":!0,"text-combine-upright":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-rendering":!0,"text-shadow":!0,"text-size-adjust":!0,"text-spacing-trim":!0,"text-stroke-color":!0,"text-stroke-width":!0,"text-transform":!0,"text-underline-offset":!0,"text-underline-position":!0,"text-wrap":!0,"text-wrap-mode":!0,"text-wrap-style":!0,visibility:!0,"white-space":!0,widows:!0,"word-break":!0,"word-spacing":!0,"writing-mode":!0},DE=["image-resolution","orphans","widows"];function VE(){return An("POLYFILLED_INHERITED_PROPS").reduce((e,t)=>e.concat(t()),[].concat(DE))}var UE={"http://www.idpf.org/2007/ops":!0,"http://www.w3.org/1999/xhtml":!0,"http://www.w3.org/2000/svg":!0,"http://www.w3.org/1998/Math/MathML":!0},vc=["margin-%","padding-%","border-%-width","border-%-style","border-%-color","%"],HE=["max-%","min-%","%"],kg=(()=>{let e=["left","right","top","bottom"],t={width:!0,height:!0,"max-width":!0,"max-height":!0,"min-width":!0,"min-height":!0};for(let n=0;n<vc.length;n++)for(let i=0;i<e.length;i++){let r=vc[n].replace("%",e[i]);t[r]=!0}return t})();function po(e,t){let n={};for(let i of vc)for(let r in e){let o=i.replace("%",r),s=i.replace("%",e[r]);n[o]=s,n[s]=o}for(let i of HE)for(let r in t){let o=i.replace("%",r),s=i.replace("%",t[r]);n[o]=s,n[s]=o}return n}var f0=po({"block-start":"right","block-end":"left","inline-start":"top","inline-end":"bottom"},{"block-size":"width","inline-size":"height"}),g0=po({"block-start":"top","block-end":"bottom","inline-start":"left","inline-end":"right"},{"block-size":"height","inline-size":"width"}),WE=po({"block-start":"right","block-end":"left","inline-start":"bottom","inline-end":"top"},{"block-size":"width","inline-size":"height"}),jE=po({"block-start":"top","block-end":"bottom","inline-start":"right","inline-end":"left"},{"block-size":"height","inline-size":"width"}),GE=po({inside:"right",outside:"left"},{}),XE=po({inside:"left",outside:"right"},{}),ke=class wc{constructor(t,n){this.value=t,this.priority=n}getBaseValue(){return this}filterValue(t){let n=this.value.visit(t);return n===this.value?this:new wc(n,this.priority)}increaseSpecificity(t){return t==0?this:new wc(this.value,this.priority+t)}evaluate(t,n,i,r){return n&&ni(n)?this.value:Ra(t,this.value,n,i,r)}isEnabled(t){return!0}},yc=class xc extends ke{constructor(t,n,i){super(t,n),this.condition=i}getBaseValue(){return new ke(this.value,this.priority)}filterValue(t){let n=this.value.visit(t);return n===this.value?this:new xc(n,this.priority,this.condition)}increaseSpecificity(t){return t==0?this:new xc(this.value,this.priority+t,this.condition)}isEnabled(t){try{return!!this.condition.evaluate(t)}catch(n){le.warn(n)}return!1}};function bc(e,t,n){return(!t||n.priority>=t.priority)&&n.isEnabled(e)?n.getBaseValue():t}function ri(e,t,n,i){if(e)if(!n)delete e[t];else{let r=e[t];(!r||n.priority>=r.priority)&&(i?n.isEnabled(i)&&(e[t]=n.getBaseValue()):e[t]=n)}}var m0={"region-id":!0,"fragment-selector-id":!0};function YE(e){return!!m0[e]}function Sc(e){return e.charAt(0)==="_"&&e!=="_viewConditionalStyles"}function Gr(e){return e.charAt(0)!=="_"&&!m0[e]}function ts(e){return!!p0[e]||ni(e)}function xt(e,t){return e[t]}function er(e,t,n){n?e[t]=n:delete e[t]}function Tn(e,t){return e[t]}function ou(e,t){let n=e[t];return n||(n={},e[t]=n),n}var v0=e=>{let t=e._viewConditionalStyles;return t||(t=[],e._viewConditionalStyles=t),t};function w0(e,t){return e[t]}function y0(e,t){let n=e[t];return n||(n=[],e[t]=n),n}function Ia(e,t,n,i,r,o,s){var l,a;if([{id:r,styleKey:"_pseudos"},{id:o,styleKey:"_regions"}].forEach(u=>{if(u.id){let h=ou(t,u.styleKey);t=h[u.id],t||(t={},h[u.id]=t)}}),s){let u=v0(t);t={},u.push({styles:t,matcher:s})}for(let u in n)if(!Sc(u))if(YE(u)){let h=w0(n,u),p=y0(t,u);Array.prototype.push.apply(p,h)}else{let h=xt(n,u);if(!h.isEnabled(e))continue;let p=h.increaseSpecificity(i);ri(t,u,p,e);let c=(a=(l=e.style)==null?void 0:l.validatorSet.shorthands[u])==null?void 0:a.propList;if(c)for(let f of c){let v=new ke(fe,p.priority);ri(t,f,v,e)}}}function qE(e,t){let n={};for(let i=0;i<t.length;i++)Ia(e,n,t[i],0,null,null,null);return n}function x0(e,t){if(e.length>0){e.sort((i,r)=>r.getPriority()-i.getPriority());let n=null;for(let i=e.length-1;i>=0;i--)n=e[i],n.chained=t,t=n;return n}return t}var KE=class extends uo{constructor(e,t){super(),this.props=e,this.context=t,d(this,"propName","")}setPropName(e){this.propName=e}getFontSize(){let e=xt(this.props,"font-size");if(!e.value.isNumeric())return $e.em;let t=e.value;if(!PC(t.unit))throw new Error("Unexpected state");return t.num*$e[t.unit]}visitNumeric(e){return this.context,this.propName==="font-size"?b0(e,this.getFontSize(),this.context):e.unit==="em"||e.unit==="ex"||e.unit==="rem"||e.unit==="lh"||e.unit==="rlh"?sp(e,this.getFontSize(),this.context):e}visitExpr(e){return this.propName=="font-size"?Ra(this.context,e,this.propName).visit(this):e}};function sp(e,t,n){let i=e.unit,r=e.num;if(i==="em"||i==="ex"){let o=$e[i]/$e.em;return new z(r*o*t,"px")}else return i==="rem"?new z(r*n.fontSize(),"px"):i==="rlh"?new z(r*n.rootLineHeight,"px"):e}function b0(e,t,n){e=sp(e,t,n);let i=e.unit,r=e.num;return i==="px"?e:i==="%"?new z(r/100*t,"px"):new z(r*n.queryUnitSize(i,!1),"px")}var fo=class{apply(e){}mergeWith(e){return new QE([this,e])}clone(){return this}},kl=class extends fo{constructor(e){super(),this.conditionItem=e}apply(e){e.pushConditionItem(this.conditionItem.fresh(e))}},QE=class S0 extends fo{constructor(t){super(),this.list=t}apply(t){for(let n=0;n<this.list.length;n++)this.list[n].apply(t)}mergeWith(t){return this.list.push(t),this}clone(){return new S0([].concat(this.list))}},lp=class extends fo{constructor(e,t,n,i,r){super(),this.style=e,this.specificity=t,this.pseudoelement=n,this.regionId=i,this.viewConditionId=r}apply(e){Ia(e.context,e.currentStyle,this.style,this.specificity,this.pseudoelement,this.regionId,e.buildViewConditionMatcher(this.viewConditionId))}},ze=class extends fo{constructor(){super(),d(this,"chained",null)}apply(e){this.chained.apply(e)}getPriority(){return 0}makePrimary(e){return!1}},ZE=class extends ze{constructor(e){super(),this.className=e}apply(e){e.currentClassNames.includes(this.className)&&this.chained.apply(e)}getPriority(){return 10}makePrimary(e){return this.chained&&e.insertInTable(e.classes,this.className,this.chained),!0}},JE=class extends ze{constructor(e){super(),this.id=e}apply(e){(e.currentId==this.id||e.currentXmlId==this.id)&&this.chained.apply(e)}getPriority(){return 11}makePrimary(e){return this.chained&&e.insertInTable(e.ids,this.id,this.chained),!0}},Eg=class extends ze{constructor(e){super(),this.localName=e}apply(e){e.currentLocalName==this.localName&&this.chained.apply(e)}getPriority(){return 8}makePrimary(e){return this.chained&&e.insertInTable(e.tags,this.localName,this.chained),!0}},eP=class extends ze{constructor(e,t){super(),this.ns=e,this.localName=t}apply(e){e.currentLocalName==this.localName&&e.currentNamespace==this.ns&&this.chained.apply(e)}getPriority(){return 8}makePrimary(e){if(this.chained){let t=e.nsPrefix[this.ns];t||(t=`ns${e.nsCount++}:`,e.nsPrefix[this.ns]=t);let n=t+this.localName;e.insertInTable(e.nstags,n,this.chained)}return!0}},tP=class extends ze{constructor(e,t){super(),this.epubTypePatt=e,this.targetLocalName=t}apply(e){let t=e.currentElement;if(t instanceof HTMLAnchorElement&&t.hash&&t.href==t.baseURI.replace(/#.*$/,"")+t.hash){let n=t.hash.substring(1),i=t.ownerDocument.getElementById(n);if(i&&(!this.targetLocalName||i.localName==this.targetLocalName)){let r=i.getAttributeNS("http://www.idpf.org/2007/ops","type")||i.getAttribute("epub:type");r&&r.match(this.epubTypePatt)&&this.chained.apply(e)}}}},nP=class extends ze{constructor(e){super(),this.ns=e}apply(e){e.currentNamespace==this.ns&&this.chained.apply(e)}};function su(e,t,n,i){if(!e)return!1;if(t!==null)return i(e,t,n);for(let r of e.getAttributeNames())if((r===n||r.endsWith(`:${n}`))&&i(e,r===n?"":e.lookupNamespaceURI(r.split(":")[0]),n))return!0;return!1}var Pg=class extends ze{constructor(e,t){super(),this.ns=e,this.name=t}apply(e){su(e.currentElement,this.ns,this.name,(t,n,i)=>t.hasAttributeNS(n,i))&&this.chained.apply(e)}},iP=class extends ze{constructor(e,t,n){super(),this.ns=e,this.name=t,this.value=n}apply(e){su(e.currentElement,this.ns,this.name,(t,n,i)=>t.getAttributeNS(n,i)==this.value)&&this.chained.apply(e)}getPriority(){return this.name=="type"&&this.ns=="http://www.idpf.org/2007/ops"?9:0}makePrimary(e){return this.name=="type"&&this.ns=="http://www.idpf.org/2007/ops"?(this.chained&&e.insertInTable(e.epubtypes,this.value,this.chained),!0):!1}},rP=class extends ze{constructor(e,t){super(),this.ns=e,this.name=t}apply(e){su(e.currentElement,this.ns,this.name,(t,n,i)=>!!UE[t.getAttributeNS(n,i)])&&this.chained.apply(e)}getPriority(){return 0}makePrimary(e){return!1}},To=class extends ze{constructor(e,t,n){super(),this.ns=e,this.name=t,this.regexp=n}apply(e){su(e.currentElement,this.ns,this.name,(t,n,i)=>{var r;return!!((r=t.getAttributeNS(n,i))!=null&&r.match(this.regexp))})&&this.chained.apply(e)}},oP=class extends ze{constructor(e){super(),this.langRegExp=e}apply(e){e.lang.match(this.langRegExp)&&this.chained.apply(e)}},Ng=class extends ze{constructor(){super()}apply(e){e.isFirst&&this.chained.apply(e)}getPriority(){return 6}},sP=class extends ze{constructor(){super()}apply(e){e.isRoot&&this.chained.apply(e)}getPriority(){return 12}},Zs=class extends ze{constructor(e,t){super(),this.a=e,this.b=t}matchANPlusB(e){return c0(e,this.a,this.b)}},lP=class extends Zs{constructor(e,t){super(e,t)}apply(e){this.matchANPlusB(e.currentSiblingOrder)&&this.chained.apply(e)}getPriority(){return 5}},Cc=class extends Zs{constructor(e,t){super(e,t)}apply(e){let t=e.currentSiblingTypeCounts[e.currentNamespace][e.currentLocalName];this.matchANPlusB(t)&&this.chained.apply(e)}getPriority(){return 5}},kc=class extends Zs{constructor(e,t){super(e,t)}apply(e){let t=e.currentFollowingSiblingOrder;t===null&&(t=e.currentFollowingSiblingOrder=e.currentElement.parentNode.childElementCount-e.currentSiblingOrder+1),this.matchANPlusB(t)&&this.chained.apply(e)}getPriority(){return 4}},Ec=class extends Zs{constructor(e,t){super(e,t)}apply(e){let t=e.currentFollowingSiblingTypeCounts;if(!t[e.currentNamespace]){let n=e.currentElement;do{let i=n.namespaceURI,r=n.localName,o=t[i];o||(o=t[i]={}),o[r]=(o[r]||0)+1}while(n=n.nextElementSibling)}this.matchANPlusB(t[e.currentNamespace][e.currentLocalName])&&this.chained.apply(e)}getPriority(){return 4}},aP=class extends ze{constructor(){super()}apply(e){let t=e.currentElement.firstChild;for(;t;){switch(t.nodeType){case Node.ELEMENT_NODE:return;case Node.TEXT_NODE:if(t.length>0)return}t=t.nextSibling}this.chained.apply(e)}getPriority(){return 4}},uP=class extends ze{constructor(){super()}apply(e){e.currentElement.disabled===!1&&this.chained.apply(e)}getPriority(){return 5}},hP=class extends ze{constructor(){super()}apply(e){e.currentElement.disabled===!0&&this.chained.apply(e)}getPriority(){return 5}},cP=class extends ze{constructor(){super()}apply(e){let t=e.currentElement;(t.selected===!0||t.checked===!0)&&this.chained.apply(e)}getPriority(){return 5}},Lt=class extends ze{constructor(e){super(),this.condition=e}apply(e){if(e.conditions[this.condition])try{e.dependentConditions.push(this.condition),this.chained.apply(e)}finally{e.dependentConditions.pop()}}getPriority(){return 5}},dP=class C0 extends fo{constructor(){super(),d(this,"applied",!1)}apply(t){this.applied=!0}clone(){let t=new C0;return t.applied=this.applied,t}},ap=class extends ze{constructor(e){super(),d(this,"checkAppliedAction"),d(this,"firstActions",[]),this.checkAppliedAction=new dP;for(let t of e)this.firstActions.push(x0(t,this.checkAppliedAction))}apply(e){for(let t of this.firstActions)if(t.apply(e),this.checkAppliedAction.applied)break;this.checkAppliedAction.applied===this.positive()&&this.chained.apply(e),this.checkAppliedAction.applied=!1}getPriority(){return Math.max(...this.firstActions.map(e=>e instanceof ze?e.getPriority():0))}positive(){return!0}relational(){return!1}},pP=class extends ap{positive(){return!1}},fP=class extends ap{constructor(e){super([]),this.selectorTexts=e}apply(e){for(let t of this.selectorTexts){let n,i;/^\s*[+~]/.test(t)?(i=e.currentElement.parentNode,n=`:scope > :nth-child(${Array.from(i.children).indexOf(e.currentElement)+1}) ${t}`):(i=e.currentElement,n=`:scope ${t}`);try{if(i.querySelector(n)){this.checkAppliedAction.apply(e);break}}catch{}}this.checkAppliedAction.applied&&this.chained.apply(e),this.checkAppliedAction.applied=!1}relational(){return!0}},lu=class{constructor(e,t,n){this.condition=e,this.viewConditionId=t,this.viewCondition=n}increment(e){e.increment(this.condition,this.viewCondition)}decrement(e){e.decrement(this.condition,this.viewCondition)}buildViewConditionMatcher(e){return e.buildViewConditionMatcher(this.viewConditionId)}},gP=class k0 extends lu{constructor(t,n,i){super(t,n,i)}fresh(t){return new k0(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(t,n){return n==0&&this.increment(t),!1}pop(t,n){return n==0?(this.decrement(t),!0):!1}},mP=class E0 extends lu{constructor(t,n,i){super(t,n,i)}fresh(t){return new E0(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(t,n){return n==0?this.increment(t):n==1&&this.decrement(t),!1}pop(t,n){return n==0?(this.decrement(t),!0):(n==1&&this.increment(t),!1)}},vP=class P0 extends lu{constructor(t,n,i){super(t,n,i),d(this,"fired",!1)}fresh(t){return new P0(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(t,n){return this.fired?(this.decrement(t),!0):!1}pop(t,n){return this.fired?(this.decrement(t),!0):(n==0&&(this.fired=!0,this.increment(t)),!1)}},wP=class N0 extends lu{constructor(t,n,i){super(t,n,i),d(this,"fired",!1)}fresh(t){return new N0(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(t,n){return this.fired&&(n==-1?this.increment(t):n==0&&this.decrement(t)),!1}pop(t,n){if(this.fired){if(n==-1)return this.decrement(t),!0;n==0&&this.increment(t)}else n==0&&(this.fired=!0,this.increment(t));return!1}},yP=class{constructor(e,t){this.afterprop=e,this.element=t}fresh(e){return this}push(e,t){return!1}pop(e,t){return t==0?(e.processPseudoelementProps(this.afterprop,this.element),!0):!1}},xP=class{constructor(e){this.lang=e}fresh(e){return this}push(e,t){return!1}pop(e,t){return t==0?(e.lang=this.lang,!0):!1}},bP=class{constructor(e){this.oldQuotes=e}fresh(e){return this}push(e,t){return!1}pop(e,t){return t==0?(e.quotes=this.oldQuotes,!0):!1}},SP=class extends uo{constructor(e){super(),this.element=e}createValueFromString(e,t){switch(t){case"url":return e?new Nn(e):new Nn("about:invalid");case"string":default:return e?new ut(e):new ut("")}}visitFunc(e){if(e.name!=="attr")return super.visitFunc(e);let t="string",n=null,i=null;if(e.values[0]instanceof Ge){let r=e.values[0].values;r.length>=2&&(t=r[1].stringValue()),n=r[0].stringValue()}else n=e.values[0].stringValue();return e.values.length>1?i=this.createValueFromString(e.values[1].stringValue(),t):i=this.createValueFromString(null,t),this.element&&this.element.hasAttribute(n)?this.createValueFromString(this.element.getAttribute(n),t):i}};function ns(e){if(Bi(e)){if(e instanceof ut)return e.stringValue();if(e instanceof Ge)return e.values.map(t=>ns(t)).join("")}return""}var Pc=class extends uo{constructor(e,t,n){super(),this.cascade=e,this.element=t,this.counterResolver=n}visitIdent(e){let t=this.cascade,n=t.quotes,i=Math.floor(n.length/2)-1;switch(e.name){case"open-quote":{let r=n[2*Math.min(i,t.quoteDepth)];return t.quoteDepth++,r}case"close-quote":return t.quoteDepth>0&&t.quoteDepth--,n[2*Math.min(i,t.quoteDepth)+1];case"no-open-quote":return t.quoteDepth++,new ut("");case"no-close-quote":return t.quoteDepth>0&&t.quoteDepth--,new ut("")}return e}format(e,t){let n=!1,i=!1,r;(r=t.match(/^upper-(.*)/))!=null?(n=!0,t=r[1]):(r=t.match(/^lower-(.*)/))!=null&&(i=!0,t=r[1]);let o="";return Tg[t]?o=kP(Tg[t],e):Ig[t]?o=PP(Ig[t],e):Rg[t]!=null?o=Rg[t]:t=="decimal-leading-zero"?(o=`${e}`,o.length==1&&(o=`0${o}`)):t=="cjk-ideographic"||t=="trad-chinese-informal"?o=TP(e,NP):o=`${e}`,n?o.toUpperCase():i?o.toLowerCase():o}visitFuncCounter(e){let t=e[0].toString(),n=e.length>1?e[1].stringValue():"decimal",i=this.cascade.counters[t];if(i&&i.length){let r=i&&i.length&&i[i.length-1]||0;return new ut(this.format(r,n))}else{let r=new re(this.counterResolver.getPageCounterVal(t,o=>this.format(o||0,n)));return new Ge([r])}}visitFuncCounters(e){let t=e[0].toString(),n=e[1].stringValue(),i=e.length>2?e[2].stringValue():"decimal",r=this.cascade.counters[t],o=new ti;if(r&&r.length)for(let l=0;l<r.length;l++)l>0&&o.append(n),o.append(this.format(r[l],i));let s=new re(this.counterResolver.getPageCountersVal(t,l=>{let a=[];if(l.length)for(let h=0;h<l.length;h++)a.push(this.format(l[h],i));let u=o.toString();return u.length&&a.push(u),a.length?a.join(n):this.format(0,i)}));return new Ge([s])}visitFuncTargetCounter(e){let t=e[0],n;t instanceof Nn?n=t.url:n=t.stringValue();let i=e[1].toString(),r=e.length>2?e[2].stringValue():"decimal",o=new re(this.counterResolver.getTargetCounterVal(n,i,s=>this.format(s||0,r)));return new Ge([o])}visitFuncTargetCounters(e){let t=e[0],n;t instanceof Nn?n=t.url:n=t.stringValue();let i=e[1].toString(),r=e[2].stringValue(),o=e.length>3?e[3].stringValue():"decimal",s=new re(this.counterResolver.getTargetCountersVal(n,i,l=>{let a=l.map(u=>this.format(u,o));return a.length?a.join(r):this.format(0,o)}));return new Ge([s])}visitFuncString(e){let t=e.length>0?e[0].stringValue():"",n=e.length>1?e[1].stringValue():"first";return new re(this.counterResolver.getNamedStringVal(t,n))}visitFuncElement(e){let t=e.length>0?e[0].stringValue():"",n=e.length>1?e[1].stringValue():"first";return new re(this.counterResolver.getRunningElementVal(t,n))}visitFuncContent(e){var t,n,i,r,o,s;let l=e.length>0?e[0].stringValue():"text",a="";switch(l){case"text":a=this.element.textContent;break;case"before":case"after":{let u=Tn(this.cascade.currentStyle,"_pseudos"),h=(n=(t=u==null?void 0:u[l])==null?void 0:t.content)==null?void 0:n.value;a=ns(h)}break;case"first-letter":{let u=Tn(this.cascade.currentStyle,"_pseudos"),h=(ns((r=(i=u==null?void 0:u.before)==null?void 0:i.content)==null?void 0:r.value)||this.element.textContent||ns((s=(o=u==null?void 0:u.after)==null?void 0:o.content)==null?void 0:s.value)).match(Xh);a=h?h[0]:""}break}return new ut(a)}visitFuncLeader(e){let t="";if(e[0]instanceof Jt)switch(e[0].stringValue()){case"dotted":t=".";break;case"solid":t="_";break;case"space":t=" ";break}else e[0]instanceof ut&&(t=e[0].stringValue());return t.length==0?new ut(""):new re(new mt(null,()=>t,"viv-leader"))}visitFunc(e){switch(e.name){case"counter":if(e.values.length<=2)return this.visitFuncCounter(e.values);break;case"counters":if(e.values.length<=3)return this.visitFuncCounters(e.values);break;case"target-counter":if(e.values.length<=3)return this.visitFuncTargetCounter(e.values);break;case"target-counters":if(e.values.length<=4)return this.visitFuncTargetCounters(e.values);break;case"string":if(e.values.length<=2)return this.visitFuncString(e.values);break;case"element":if(e.values.length<=2)return this.visitFuncElement(e.values);break;case"content":if(e.values.length<=1)return this.visitFuncContent(e.values);break;case"leader":if(e.values.length<=1)return this.visitFuncLeader(e.values);break}return e}},CP=(e,t,n)=>{let i=t.filter(r=>r.after&&r.viewNode.nodeType===1&&r.viewNode.getAttribute("data-viv-leader"));for(let r of i){let o=function(I){if(w==="rtl"){let M="‏";h.textContent=(I.startsWith(M)?"":M)+I+(I.endsWith(M)?"":M)}else h.textContent=I},s=function(){let I=n.clientLayout.getElementClientRect(p);return g.left>I.left||g.right<I.right||g.top>I.top||g.bottom<I.bottom},l=function(){let I,M;if(o(f),s())I=1,M=f.length/c.length;else{I=f.length/c.length,M=I;for(let G=0;G<16;G++){let j=f;for(let $=0;$<1<<G;$++)j+=c;if(o(j),s()){M+=1<<G;break}}}for(let G=0;G<16;G++){let j="",$=Math.floor((I+M)/2);for(let Z=0;Z<$;Z++)j+=c;if(o(j),s())M=$;else{if(I==$)return;I=$}}o(c)},a=function(I){let M=0,G=p.parentElement;for(;G&&G!==u.viewNode;)M+=n.getComputedInsets(G)[I],G=G.parentElement;return M},u=r.parent;for(;u&&u.inline;)u=u.parent;let h=r.viewNode,p=h.parentElement,c=h.getAttribute("data-viv-leader-value"),f=h.textContent||c,{writingMode:v,direction:w,marginInlineEnd:x}=n.clientLayout.getElementComputedStyle(p);h.style.marginInlineStart="1px",o(c),p.style.display="inline-block",p.style.textIndent="0";let g=n.clientLayout.getElementClientRect(u.viewNode),m=n.clientLayout.getElementClientRect(p),y=n.parseComputedLength(x);v==="vertical-rl"||v==="vertical-lr"?(w==="rtl"?g.top+=y:g.bottom-=y,g.left=m.left,g.right=m.right,g.top=Math.min(m.top,g.top),g.bottom=Math.max(m.bottom,g.bottom)):(w==="rtl"?g.left+=y:g.right-=y,g.top=m.top,g.bottom=m.bottom,g.left=Math.min(m.left,g.left),g.right=Math.max(m.right,g.right)),l();let C=n.clientLayout.getElementClientRect(p);w=="rtl"?p.style.float="left":p.style.float="right";let P=n.clientLayout.getElementClientRect(p),A=0;w=="rtl"?v=="vertical-rl"||v=="vertical-lr"?A=C.top-P.top-a("top"):A=C.left-P.left-a("left"):v=="vertical-rl"||v=="vertical-lr"?A=P.bottom-C.bottom-a("bottom"):A=P.right-C.right-a("right"),A=Math.max(0,A-.1),p.style.float="",h.style.marginInlineStart=`${A}px`}};wn("POST_LAYOUT_BLOCK",CP);var Tg={roman:[4999,1e3,"M",900,"CM",500,"D",400,"CD",100,"C",90,"XC",50,"L",40,"XL",10,"X",9,"IX",5,"V",4,"IV",1,"I"],armenian:[9999,9e3,"ք",8e3,"փ",7e3,"ւ",6e3,"ց",5e3,"ր",4e3,"տ",3e3,"վ",2e3,"ս",1e3,"ռ",900,"ջ",800,"պ",700,"չ",600,"ո",500,"շ",400,"ն",300,"յ",200,"մ",100,"ճ",90,"ղ",80,"ձ",70,"հ",60,"կ",50,"ծ",40,"խ",30,"լ",20,"ի",10,"ժ",9,"թ",8,"ը",7,"է",6,"զ",5,"ե",4,"դ",3,"գ",2,"բ",1,"ա"],georgian:[19999,1e4,"ჵ",9e3,"ჰ",8e3,"ჯ",7e3,"ჴ",6e3,"ხ",5e3,"ჭ",4e3,"წ",3e3,"ძ",2e3,"ც",1e3,"ჩ",900,"შ",800,"ყ",700,"ღ",600,"ქ",500,"ფ",400,"ჳ",300,"ტ",200,"ს",100,"რ",90,"ჟ",80,"პ",70,"ო",60,"ჲ",50,"ნ",40,"მ",30,"ლ",20,"კ",10,"ი",9,"თ",8,"ჱ",7,"ზ",6,"ვ",5,"ე",4,"დ",3,"გ",2,"ბ",1,"ა"],hebrew:[999,400,"ת",300,"ש",200,"ר",100,"ק",90,"צ",80,"פ",70,"ע",60,"ס",50,"נ",40,"מ",30,"ל",20,"כ",19,"יט",18,"יח",17,"יז",16,"טז",15,"טו",10,"י",9,"ט",8,"ח",7,"ז",6,"ו",5,"ה",4,"ד",3,"ג",2,"ב",1,"א"]},Ig={latin:"a-z",alpha:"a-z",greek:"α-ρσ-ω",russian:"а-ик-щэ-я"},Rg={square:"■",disc:"•",circle:"◦",none:""};function kP(e,t){let n=e[0];if(t>n||t<=0||t!=Math.round(t))return"";let i="";for(let r=1;r<e.length;r+=2){let o=e[r],s=Math.floor(t/o);if(s>20)return"";for(t-=s*o;s>0;)i+=e[r+1],s--}return i}function EP(e){let t=[],n=0;for(;n<e.length;)if(e.substr(n+1,1)=="-"){let i=e.charCodeAt(n),r=e.charCodeAt(n+2);n+=3;for(let o=i;o<=r;o++)t.push(String.fromCharCode(o))}else t.push(e.substr(n++,1));return t}function PP(e,t){if(t<=0||t!=Math.round(t))return"";let n=EP(e),i="";do{t--;let r=t%n.length;i=n[r]+i,t=(t-r)/n.length}while(t>0);return i}var NP={formal:!1,digits:"零一二三四五六七八九",markers:"十百千",negative:"負"};function TP(e,t){if(e>9999||e<-9999)return`${e}`;if(e==0)return t.digits.charAt(0);let n=new ti;if(e<0&&(n.append(t.negative),e=-e),e<10)n.append(t.digits.charAt(e));else if(e<=19)n.append(t.markers.charAt(0)),e!=0&&n.append(t.digits.charAt(e-10));else{let i=Math.floor(e/1e3);i&&(n.append(t.digits.charAt(i)),n.append(t.markers.charAt(2)));let r=Math.floor(e/100)%10;r&&(n.append(t.digits.charAt(r)),n.append(t.markers.charAt(1)));let o=Math.floor(e/10)%10;o&&(n.append(t.digits.charAt(o)),n.append(t.markers.charAt(0)));let s=e%10;s&&n.append(t.digits.charAt(s))}return n.toString()}var up=1/1048576;function pr(e,t){for(let n in e)t[n]=e[n].clone()}var IP=class T0{constructor(){d(this,"nsCount",0),d(this,"nsPrefix",{}),d(this,"tags",{}),d(this,"nstags",{}),d(this,"epubtypes",{}),d(this,"classes",{}),d(this,"ids",{}),d(this,"pagetypes",{}),d(this,"order",0)}clone(){let t=new T0;t.nsCount=this.nsCount;for(let n in this.nsPrefix)t.nsPrefix[n]=this.nsPrefix[n];return pr(this.tags,t.tags),pr(this.nstags,t.nstags),pr(this.epubtypes,t.epubtypes),pr(this.classes,t.classes),pr(this.ids,t.ids),pr(this.pagetypes,t.pagetypes),t.order=this.order,t}insertInTable(t,n,i){let r=t[n];r&&(i=r.mergeWith(i)),t[n]=i}createInstance(t,n,i,r){return new RP(this,t,n,i,r)}nextOrder(){return this.order+=up}},RP=class{constructor(e,t,n,i,r){this.context=t,this.counterListener=n,this.counterResolver=i,d(this,"code"),d(this,"stack",[[],[]]),d(this,"conditions",{}),d(this,"currentElement",null),d(this,"currentElementOffset",null),d(this,"currentStyle",null),d(this,"currentClassNames",null),d(this,"currentLocalName",""),d(this,"currentNamespace",""),d(this,"currentId",""),d(this,"currentXmlId",""),d(this,"currentNSTag",""),d(this,"currentEpubTypes",null),d(this,"currentPageType",null),d(this,"previousPageType",null),d(this,"firstPageType",null),d(this,"isFirst",!0),d(this,"isRoot",!0),d(this,"counters",{}),d(this,"counterScoping",[{}]),d(this,"quotes"),d(this,"quoteDepth",0),d(this,"lang",""),d(this,"siblingOrderStack",[0]),d(this,"currentSiblingOrder",0),d(this,"siblingTypeCountsStack",[{}]),d(this,"currentSiblingTypeCounts"),d(this,"currentFollowingSiblingOrder",null),d(this,"followingSiblingOrderStack"),d(this,"followingSiblingTypeCountsStack",[{}]),d(this,"currentFollowingSiblingTypeCounts"),d(this,"viewConditions",{}),d(this,"dependentConditions",[]),d(this,"elementStack"),this.code=e,this.quotes=[new ut("“"),new ut("”"),new ut("‘"),new ut("’")],this.currentSiblingTypeCounts=this.siblingTypeCountsStack[0],this.followingSiblingOrderStack=[this.currentFollowingSiblingOrder],this.currentFollowingSiblingTypeCounts=this.siblingTypeCountsStack[0]}pushConditionItem(e){this.stack[this.stack.length-1].push(e)}increment(e,t){this.conditions[e]=(this.conditions[e]||0)+1,t&&(this.viewConditions[e]?this.viewConditions[e].push(t):this.viewConditions[e]=[t])}decrement(e,t){this.conditions[e]--,this.viewConditions[e]&&(this.viewConditions[e]=this.viewConditions[e].filter(n=>n!==t),this.viewConditions[e].length===0&&delete this.viewConditions[e])}buildViewConditionMatcher(e){let t=null;e&&(this.currentElementOffset,t=Cl.buildViewConditionMatcher(this.currentElementOffset,e));let n=this.dependentConditions.map(i=>{let r=this.viewConditions[i];return r&&r.length>0?r.length===1?r[0]:Cl.buildAnyMatcher([].concat(r)):null}).filter(i=>i);return n.length<=0?t:t===null?n.length===1?n[0]:Cl.buildAllMatcher(n):Cl.buildAllMatcher([t].concat(n))}applyAction(e,t){let n=e[t];n&&n.apply(this)}pushRule(e,t,n){this.currentElement=null,this.currentElementOffset=null,this.currentStyle=n,this.currentNamespace="",this.currentLocalName="",this.currentId="",this.currentXmlId="",this.currentClassNames=e,this.currentNSTag="",this.currentEpubTypes=Yu,this.currentPageType=t,this.applyActions()}defineCounter(e,t){let n=this.counterScoping[this.counterScoping.length-1];n||(n={},this.counterScoping[this.counterScoping.length-1]=n),this.counters[e]?(n[e]&&this.counters[e].pop(),this.counters[e].push(t)):this.counters[e]=[t],n[e]=!0}pushCounters(e){var t,n,i,r,o,s,l;let a=S.inline,u=e.display;if(u&&(a=u.evaluate(this.context)),a===S.none){this.currentElement.setAttribute("data-viv-display-none","true"),this.counterScoping.push(null);return}else if(this.currentElement.closest("[data-viv-display-none]")){this.counterScoping.push(null);return}let h=S.inline,p=e.float;p&&(h=p.evaluate(this.context));let c=null,f=null,v=null,w=e["counter-reset"];if(w){let m=w.evaluate(this.context);m&&(c=Zo(m,!0))}let x=e["counter-set"];if(x){let m=x.evaluate(this.context);m&&(v=Zo(m,!1))}let g=e["counter-increment"];if(g){let m=g.evaluate(this.context);m&&(f=Zo(m,!1))}if((this.currentLocalName=="ol"||this.currentLocalName=="ul")&&this.currentNamespace=="http://www.w3.org/1999/xhtml"&&(c||(c={}),c["list-item"]=((n=(t=this.currentElement)==null?void 0:t.start)!=null?n:1)-1),a===S.list_item&&(f||(f={}),f["list-item"]=(i=f["list-item"])!=null?i:1,/^\s*[-+]?\d/.test((o=(r=this.currentElement)==null?void 0:r.getAttribute("value"))!=null?o:"")&&(v||(v={}),v["list-item"]=this.currentElement.value)),((s=this.currentElement)==null?void 0:s.parentNode.nodeType)===Node.DOCUMENT_NODE&&(c||(c={}),c.footnote===void 0&&(c.footnote=0)),h===S.footnote&&(f||(f={}),f.footnote===void 0)){let m=(l=this.currentStyle["counter-increment"])==null?void 0:l.value;(!m||!(m===S.footnote||m instanceof Ge&&m.values.includes(S.footnote)))&&(f.footnote=1)}if(c)for(let m in c)this.defineCounter(m,c[m]);if(f)for(let m in f){this.counters[m]||this.defineCounter(m,0);let y=this.counters[m];y[y.length-1]+=f[m]}if(v)for(let m in v)if(!this.counters[m])this.defineCounter(m,v[m]);else{let y=this.counters[m];y[y.length-1]=v[m]}if(a===S.list_item){let m=this.counters["list-item"],y=m[m.length-1];e["ua-list-item-count"]=new ke(new $i(y),0)}this.counterScoping.push(null)}popCounters(){let e=this.counterScoping.pop();if(e)for(let t in e){let n=this.counters[t];n&&(n.length==1?delete this.counters[t]:n.pop())}}setNamedStrings(e){let t=e["string-set"];if(!t)return;t=t.filterValue(new Pc(this,this.currentElement,this.counterResolver));let n=t.value instanceof Mt?t.value.values:[t.value];for(let i of n)if(i instanceof Ge){let r=i.values[0].stringValue(),o=i.values.slice(1).map(s=>ns(s)).join("");this.counterResolver.setNamedString(r,o,this.currentElementOffset)}delete e["string-set"]}setRunningElement(e){let t=e.position;if((t==null?void 0:t.value)instanceof ho&&t.value.name==="running"){let n=t.value.values[0].stringValue();this.counterResolver.setRunningElement(n,this.currentElementOffset)}}processPseudoelementProps(e,t){this.pushCounters(e);let n=e.content;n&&(e.content=n.filterValue(new Pc(this,t,this.counterResolver))),this.popCounters()}pushElement(e,t,n,i){var r,o;this.currentPageType=null,this.currentElement=t,this.currentElementOffset=i,this.currentStyle=n,this.currentNamespace=t.namespaceURI,this.currentLocalName=t.localName;let s=this.code.nsPrefix[this.currentNamespace];s?this.currentNSTag=s+this.currentLocalName:this.currentNSTag="",this.currentId=t.getAttribute("id"),this.currentXmlId=t.getAttributeNS("http://www.w3.org/XML/1998/namespace","id");let l=t.getAttribute("class");l?this.currentClassNames=l.split(/\s+/):this.currentClassNames=Yu;let a=t.getAttributeNS("http://www.idpf.org/2007/ops","type");a?this.currentEpubTypes=a.split(/\s+/):this.currentEpubTypes=Yu;let u=Yh(t);u&&(this.stack[this.stack.length-1].push(new xP(this.lang)),this.lang=u.toLowerCase());let h=this.isRoot,p=this.siblingOrderStack;this.currentSiblingOrder=++p[p.length-1],p.push(0);let c=this.siblingTypeCountsStack,f=this.currentSiblingTypeCounts=c[c.length-1],v=f[this.currentNamespace];v||(v=f[this.currentNamespace]={}),v[this.currentLocalName]=(v[this.currentLocalName]||0)+1,c.push({});let w=this.followingSiblingOrderStack;w[w.length-1]!==null?this.currentFollowingSiblingOrder=--w[w.length-1]:this.currentFollowingSiblingOrder=null,w.push(null);let x=this.followingSiblingTypeCountsStack,g=this.currentFollowingSiblingTypeCounts=x[x.length-1];g&&g[this.currentNamespace]&&g[this.currentNamespace][this.currentLocalName]--,x.push({}),this.applyActions(),this.applyVarFilter([this.currentStyle],e,t),this.applyCalcFilter(this.currentStyle,this.context),this.applyAttrFilter(t);let m=n.quotes,y=null;if(m){let A=m.evaluate(this.context);A&&(y=new bP(this.quotes),A===S.none?this.quotes=[new ut(""),new ut("")]:A===S.auto||A===S.initial?this.quotes=[new ut("“"),new ut("”"),new ut("‘"),new ut("’")]:A instanceof Ge&&(this.quotes=A.values))}this.pushCounters(this.currentStyle);let C=this.currentId||this.currentXmlId||t.getAttribute("name")||"";if(h||C){let A={};Object.keys(this.counters).forEach(I=>{A[I]=Array.from(this.counters[I])}),this.counterListener.countersOfId(C,A)}let P=Tn(this.currentStyle,"_pseudos");if(P){let A=!0;for(let I of AP){I||(A=!1);let M=P[I];M&&((I==="before"||I==="after")&&!Bi((r=M.content)==null?void 0:r.value)||(I==="footnote-call"||I==="footnote-marker")&&((o=xt(this.currentStyle,"float"))==null?void 0:o.value)!==S.footnote?delete P[I]:A?this.processPseudoelementProps(M,t):this.stack[this.stack.length-2].push(new yP(M,t)))}}this.setNamedStrings(this.currentStyle),this.setRunningElement(this.currentStyle),y&&this.stack[this.stack.length-2].push(y)}applyAttrFilterInner(e,t){for(let n in t)Gr(n)&&!ni(n)&&(t[n]=t[n].filterValue(e))}applyAttrFilter(e){let t=new SP(e),n=this.currentStyle,i=Tn(n,"_pseudos");for(let r in i)this.applyAttrFilterInner(t,i[r]);this.applyAttrFilterInner(t,n)}applyVarFilter(e,t,n){var i,r,o;let s=e[0],l=new DP(e,t,n),a=32,u={};for(let h in s)if(Sc(h)){let p=Tn(s,h);for(let c in p)this.applyVarFilter([p[c],...e],t,n)}else if(Gr(h)){let p=xt(s,h),c=p.value;for(let f=0;;f++){if(f>=a){c=fe;break}let v=c.visit(l);if(l.error){c=fe,l.error=!1;break}if(v===c)break;c=v}if(c!==p.value){let f=t.validatorSet,v=(i=f==null?void 0:f.shorthands[h])==null?void 0:i.clone();if(v)if(Te(c)){for(let w of v.propList){let x=new ke(c,p.priority),g=xt(s,w);er(u,w,bc(this.context,g,x))}delete s[h]}else{let w=co(t.scope,new Fn(c.toString(),null),"");if(w&&(w.visit(v),!v.error)){for(let x of v.propList){let g=new ke((o=(r=v.values[x])!=null?r:f.defaultValues[x])!=null?o:S.initial,p.priority),m=xt(s,x);er(u,x,bc(this.context,m,g))}delete s[h]}}else s[h]=new ke(c,p.priority)}if(u[h]){let f=xt(s,h);f&&f.value!==fe&&ri(u,h,f,this.context)}}for(let h in u)s[h]=u[h]}applyCalcFilter(e,t){let n=new _0(t);for(let i in e)if(Sc(i)){let r=Tn(e,i);for(let o in r)this.applyCalcFilter(r[o],t)}else if(Gr(i)&&!ni(i)){let r=xt(e,i),o=r.value.visit(n);o!==r.value&&(e[i]=new ke(o,r.priority))}}applyActions(){let e;for(e=0;e<this.currentClassNames.length;e++)this.applyAction(this.code.classes,this.currentClassNames[e]);for(e=0;e<this.currentEpubTypes.length;e++)this.applyAction(this.code.epubtypes,this.currentEpubTypes[e]);this.applyAction(this.code.ids,this.currentId),this.applyAction(this.code.tags,this.currentLocalName),this.currentLocalName!=""&&this.applyAction(this.code.tags,"*"),this.applyAction(this.code.nstags,this.currentNSTag),this.currentPageType!==null&&(this.applyAction(this.code.pagetypes,this.currentPageType),this.applyAction(this.code.pagetypes,"*")),this.stack.push([]);for(let t=1;t>=-1;--t){let n=this.stack[this.stack.length-t-2];for(e=0;e<n.length;)n[e].push(this,t)?n.splice(e,1):e++}this.isFirst=!0,this.isRoot=!1}pop(){for(let e=1;e>=-1;--e){let t=this.stack[this.stack.length-e-2],n=0;for(;n<t.length;)t[n].pop(this,e)?t.splice(n,1):n++}this.stack.pop(),this.isFirst=!1}popRule(){this.pop()}popElement(e){this.siblingOrderStack.pop(),this.siblingTypeCountsStack.pop(),this.followingSiblingOrderStack.pop(),this.followingSiblingTypeCountsStack.pop(),this.pop(),this.popCounters()}},Yu=[],AP=["before","transclusion-before","footnote-call","footnote-marker","inner","first-letter","first-line","","transclusion-after","after"],Nc=null;function LP(e){Nc=e}var As=class extends qs{constructor(e,t,n,i,r,o,s){super(e,t,s),this.condition=n,this.regionId=r,this.validatorSet=o,d(this,"chain",null),d(this,"specificity",0),d(this,"elementStyle",null),d(this,"conditionCount",0),d(this,"pseudoelement",null),d(this,"footnoteContent",!1),d(this,"cascade"),d(this,"state"),d(this,"viewConditionId",null),d(this,"insideSelectorRule"),d(this,"invalid",!1),this.cascade=i?i.cascade:Nc?Nc.clone():new IP,this.state=0}insertNonPrimary(e){this.cascade.insertInTable(this.cascade.tags,"*",e)}processChain(e){let t=x0(this.chain,e);t!==e&&t.makePrimary(this.cascade)||this.insertNonPrimary(t)}isInsideSelectorRule(e){return this.state!=0?(this.reportAndSkip(e),!0):!1}tagSelector(e,t){!t&&!e||(t&&(this.specificity+=1),t&&e?this.chain.push(new eP(e,t.toLowerCase())):t?this.chain.push(new Eg(t.toLowerCase())):this.chain.push(new nP(e)))}invalidSelector(e){le.warn(e),this.chain.push(new Lt("")),this.setInvalid()}setInvalid(){this.invalid=!0;for(let e=this;e instanceof Ls;e=e.parent)e.parent.invalid=!0}classSelector(e){if(this.pseudoelement){this.invalidSelector(`::${this.pseudoelement} followed by .${e}`);return}this.specificity+=256,this.chain.push(new ZE(e))}pseudoclassSelector(e,t){if(this.pseudoelement){this.invalidSelector(`::${this.pseudoelement} followed by :${e}`);return}switch(e.toLowerCase()){case"enabled":this.chain.push(new uP);break;case"disabled":this.chain.push(new hP);break;case"checked":this.chain.push(new cP);break;case"root":case"scope":this.chain.push(new sP);break;case"link":this.chain.push(new Eg("a")),this.chain.push(new Pg("","href"));break;case"-adapt-href-epub-type":case"href-epub-type":if(t&&t.length>=1&&typeof t[0]=="string"){let n=t[0],i=new RegExp(`(^|\\s)${ui(n)}($|\\s)`),r=t[1];this.chain.push(new tP(i,r))}else this.chain.push(new Lt(""));break;case"-adapt-footnote-content":case"footnote-content":this.footnoteContent=!0;break;case"visited":case"active":case"hover":case"focus":this.chain.push(new Lt(""));break;case"lang":if(t&&t.length==1&&typeof t[0]=="string"){let n=t[0];this.chain.push(new oP(new RegExp(`^${ui(n.toLowerCase())}($|-)`)))}else this.chain.push(new Lt(""));break;case"nth-child":case"nth-last-child":case"nth-of-type":case"nth-last-of-type":{let n=FP[e.toLowerCase()];t&&t.length==2?this.chain.push(new n(t[0],t[1])):this.chain.push(new Lt(""));break}case"first-child":this.chain.push(new Ng);break;case"last-child":this.chain.push(new kc(0,1));break;case"first-of-type":this.chain.push(new Cc(0,1));break;case"last-of-type":this.chain.push(new Ec(0,1));break;case"only-child":this.chain.push(new Ng),this.chain.push(new kc(0,1));break;case"only-of-type":this.chain.push(new Cc(0,1)),this.chain.push(new Ec(0,1));break;case"empty":this.chain.push(new aP);break;case"before":case"after":case"first-line":case"first-letter":this.pseudoelementSelector(e,t);return;default:this.invalidSelector(`Unknown pseudo-class :${e}`);return}this.specificity+=256}pseudoelementSelector(e,t){switch(e){case"before":case"after":case"first-line":case"first-letter":case"footnote-call":case"footnote-marker":case"inner":case"after-if-continues":if(!this.pseudoelement)this.pseudoelement=e;else{this.invalidSelector(`Double pseudo-element ::${this.pseudoelement}::${e}`);return}break;case"first-n-lines":if(t&&t.length==1&&typeof t[0]=="number"){let n=Math.round(t[0]);if(n>0&&n==t[0]){if(!this.pseudoelement)this.pseudoelement=`first-${n}-lines`;else{this.invalidSelector(`Double pseudo-element ::${this.pseudoelement}::${e}`);return}break}}this.chain.push(new Lt(""));break;case"nth-fragment":t&&t.length==2?this.viewConditionId=`NFS_${t[0]}_${t[1]}`:this.chain.push(new Lt(""));break;default:this.invalidSelector(`Unknown pseudo-element ::${e}`);return}this.specificity+=1}idSelector(e){this.specificity+=65536,this.chain.push(new JE(e))}attributeSelector(e,t,n,i){this.specificity+=256,t=t.toLowerCase(),i=i||"";let r;switch(n){case 0:r=new Pg(e,t);break;case 39:r=new iP(e,t,i);break;case 45:!i||i.match(/\s/)?r=new Lt(""):r=new To(e,t,new RegExp(`(^|\\s)${ui(i)}($|\\s)`));break;case 44:r=new To(e,t,new RegExp(`^${ui(i)}($|-)`));break;case 43:i?r=new To(e,t,new RegExp(`^${ui(i)}`)):r=new Lt("");break;case 42:i?r=new To(e,t,new RegExp(`${ui(i)}$`)):r=new Lt("");break;case 46:i?r=new To(e,t,new RegExp(ui(i))):r=new Lt("");break;case 50:if(i=="supported")r=new rP(e,t);else{this.invalidSelector(`Unsupported :: attr selector op: ${i}`);return}break;default:this.invalidSelector(`Unsupported attr selector: ${n}`);return}this.chain.push(r)}descendantSelector(){let e=`d${El++}`;this.processChain(new kl(new gP(e,this.viewConditionId,null))),this.chain=[new Lt(e)],this.viewConditionId=null}childSelector(){let e=`c${El++}`;this.processChain(new kl(new mP(e,this.viewConditionId,null))),this.chain=[new Lt(e)],this.viewConditionId=null}adjacentSiblingSelector(){let e=`a${El++}`;this.processChain(new kl(new vP(e,this.viewConditionId,null))),this.chain=[new Lt(e)],this.viewConditionId=null}followingSiblingSelector(){let e=`f${El++}`;this.processChain(new kl(new wP(e,this.viewConditionId,null))),this.chain=[new Lt(e)],this.viewConditionId=null}nextSelector(){this.finishChain(),this.pseudoelement=null,this.footnoteContent=!1,this.specificity=0,this.chain=[]}startSelectorRule(){this.isInsideSelectorRule("E_CSS_UNEXPECTED_SELECTOR")||(this.state=1,this.elementStyle={},this.pseudoelement=null,this.specificity=0,this.footnoteContent=!1,this.chain=[],this.invalid=!1)}error(e,t){super.error(e,t),this.state==1&&(this.state=0),this.setInvalid()}startStylesheet(e){super.startStylesheet(e),this.state=0}startRuleBody(){this.finishChain(),super.startRuleBody(),this.state==1&&(this.state=0)}endRule(){super.endRule(),this.insideSelectorRule=0}finishChain(){this.chain&&(this.processChain(this.makeApplyRuleAction(this.specificity)),this.chain=null,this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0)}makeApplyRuleAction(e){let t=this.regionId;return this.footnoteContent&&(t?t="xxx-bogus-xxx":t="footnote"),new lp(this.elementStyle,e,this.pseudoelement,t,this.viewConditionId)}special(e,t){let n;this.condition?n=new yc(t,0,this.condition):n=new ke(t,0),y0(this.elementStyle,e).push(n)}property(e,t,n){this.validatorSet.validatePropertyAndHandleShorthand(e,t,n,this)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}simpleProperty(e,t,n){e=="display"&&(t===S.oeb_page_head||t===S.oeb_page_foot)&&(this.simpleProperty("flow-options",new Ge([S.exclusive,S._static]),n),this.simpleProperty("flow-into",t,n),t=S.block),An("SIMPLE_PROPERTY").forEach(o=>{let s=o({name:e,value:t,important:n});e=s.name,t=s.value,n=s.important});let i=(n?this.getImportantSpecificity():this.getBaseSpecificity())+this.cascade.nextOrder(),r=this.condition?new yc(t,i,this.condition):new ke(t,i);ri(this.elementStyle,e,r)}finish(){return this.cascade}startFuncWithSelector(e){let t;switch(e){case"is":t=new Ls(this);break;case"not":t=new OP(this);break;case"where":t=new BP(this);break;case"has":t=new _P(this);break}t&&(t.startSelectorRule(),this.owner.pushHandler(t))}},FP={"nth-child":lP,"nth-of-type":Cc,"nth-last-child":kc,"nth-last-of-type":Ec},El=0,Ls=class I0 extends As{constructor(t){super(t.scope,t.owner,t.condition,t,t.regionId,t.validatorSet,!1),this.parent=t,d(this,"parentChain"),d(this,"chains",[]),d(this,"maxSpecificity",0),d(this,"selectorTexts",[]),this.parentChain=t.chain}nextSelector(){this.chain&&this.chains.push(this.chain),this.maxSpecificity=Math.max(this.maxSpecificity,this.specificity),this.chain=[],this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0}endFuncWithSelector(){this.chain&&this.chains.push(this.chain),this.chains.length>0?(this.maxSpecificity=Math.max(this.maxSpecificity,this.specificity),this.parentChain.push(this.relational()?new fP(this.selectorTexts):this.positive()?new ap(this.chains):new pP(this.chains)),this.increasingSpecificity()&&(this.parent.specificity+=this.maxSpecificity)):this.parentChain.push(new Lt("")),this.owner.popHandler()}startRuleBody(){this.reportAndSkip("E_CSS_UNEXPECTED_RULE_BODY")}error(t,n){super.error(t,n),this.chain=null,this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0;let i=!1;for(let r=this;r instanceof I0;r=r.parent)if(r.forgiving()){i=!0;break}i||this.owner.popHandler()}pushSelectorText(t){this.chain&&this.relational()&&this.selectorTexts.push(t)}positive(){return!0}increasingSpecificity(){return!0}forgiving(){return!0}relational(){return!1}},OP=class extends Ls{positive(){return!1}forgiving(){return!1}},BP=class extends Ls{increasingSpecificity(){return!1}},_P=class extends Ls{relational(){return!0}},MP=class extends qs{constructor(e,t){super(e,t,!1)}property(e,t,n){if(this.scope.values[e])this.error(`E_CSS_NAME_REDEFINED ${e}`,this.getCurrentToken());else{let i=e.match(/height|^(top|bottom)$/)?"vh":"vw",r=new js(this.scope,100,i);this.scope.defineName(e,t.toExpr(this.scope,r))}}},Pl=class extends qs{constructor(e,t,n,i,r,o){super(e,t,!1),this.condition=n,this.elementStyle=i,this.validatorSet=r,this.ruleType=o,d(this,"order"),this.order=0}property(e,t,n){n?le.warn("E_IMPORTANT_NOT_ALLOWED"):this.validatorSet.validatePropertyAndHandleShorthand(e,t,n,this)}invalidPropertyValue(e,t){le.warn("E_INVALID_PROPERTY_VALUE",`${e}:`,t.toString())}unknownProperty(e,t){le.warn("E_INVALID_PROPERTY",`${e}:`,t.toString())}simpleProperty(e,t,n){let i=n?this.getImportantSpecificity():this.getBaseSpecificity();i+=this.order,this.order+=up;let r=this.condition?new yc(t,i,this.condition):new ke(t,i);ri(this.elementStyle,e,r)}},zP=class extends $y{constructor(e,t){super(e),this.validatorSet=t,d(this,"elementStyle",{}),d(this,"order",0)}property(e,t,n){this.validatorSet.validatePropertyAndHandleShorthand(e,t,n,this)}invalidPropertyValue(e,t){le.warn("E_INVALID_PROPERTY_VALUE",`${e}:`,t.toString())}unknownProperty(e,t){le.warn("E_INVALID_PROPERTY",`${e}:`,t.toString())}simpleProperty(e,t,n){let i=n?zy:My;i+=this.order,this.order+=up;let r=new ke(t,i);ri(this.elementStyle,e,r)}};function R0(e,t){let n=v0(e);n&&n.forEach(i=>{i.matcher.matches()&&t(i.styles)})}function Tc(e,t,n){R0(n,i=>{is(e,i,t)})}function $P(e,t,n,i){let r=new zP(e,t),o=new Fn(i,r);try{Yk(o,r,n)}catch(s){le.warn(s,"Style attribute parse error:")}return r.elementStyle}function A0(e,t,n){let i=e["writing-mode"];if(i){let r=i.evaluate(t,"writing-mode");if(r&&r!==S.inherit&&r!==S.revert&&r!==S.unset)return r===S.vertical_rl}return n}function L0(e,t,n){let i=e.direction;if(i){let r=i.evaluate(t,"direction");if(r&&r!==S.inherit&&r!==S.revert&&r!==S.unset)return r===S.rtl}return n}function F0(e,t,n,i,r){let o={};for(let s in e)Gr(s)&&(o[s]=xt(e,s));return Tc(o,t,e),O0(e,n,i,(s,l)=>{is(o,l,t),Tc(o,t,l)}),o}function O0(e,t,n,i){let r=Tn(e,"_regions");if((t||n)&&r){if(n){let o=["footnote"];t?t=t.concat(o):t=o}for(let o of t){let s=r[o];s&&i(o,s)}}}function is(e,t,n){for(let i in t)if(Gr(i)){let r=xt(t,i),o=e[i];e[i]=bc(n,o,r)}}var B0=(e,t,n,i,r,o)=>{var s,l;let a=n?i?WE:f0:i?jE:g0,u=r?GE:XE;for(let h in e){let p=e[h];if(!p)continue;let c=(s=a[h])!=null?s:a[u[h]],f=(l=u[h])!=null?l:u[a[h]],v=c??f,w;if(v){let x=e[v];if(x&&x.priority>p.priority||c&&f&&c!==f&&(v=f,x=e[v],x&&x.priority>p.priority))continue;w=kg[c]?c:kg[f]?f:h}else w=h,h.startsWith("text-align")&&(p.value===S.inside||p.value===S.outside)&&(p=new ke(r===(p.value===S.inside)?S.right:S.left,p.priority));t[w]=o(h,p)}},DP=class extends uo{constructor(e,t,n){super(),this.elementStyles=e,this.styler=t,this.element=n}getVarValue(e){var t,n,i,r,o;let s=(t=this.element)!=null?t:this.styler.root;if((n=this.elementStyles)!=null&&n.length){for(let l of this.elementStyles){let a=(i=l[e])==null?void 0:i.value;if(a)return a}this.element&&(s=this.element.parentElement)}for(;s;s=s.parentElement){let l=(o=(r=this.styler.getStyle(s,!1))==null?void 0:r[e])==null?void 0:o.value;if(l)return l}return null}visitFunc(e){if(e.name!=="var")return super.visitFunc(e);let t=e.values[0]instanceof Jt&&e.values[0].name;return!t||!ni(t)?(this.error=!0,fe):this.getVarValue(t)||(e.values.length<2?(this.error=!0,fe):e.values.length===2?e.values[1]:new Mt(e.values.slice(1)))}},_0=class extends uo{constructor(e,t,n,i){super(),this.context=e,this.resolveViewportUnit=t,this.percentRef=n,this.vertical=i}visitFunc(e){let t=super.visitFunc(e);if(e.name!=="calc")return t;let n=t.toString().replace(/^calc\b/,"-epubx-expr");if(/\d(%|em|ex|cap|ch|ic|lh|p?v[whbi]|p?vmin|p?vmax)\W|\Wvar\(\s*--/i.test(n))return t;let i=co(this.context.rootScope,new Fn(n,null),"");if(i instanceof re)try{let r=i.expr.evaluate(this.context);typeof r=="number"&&!isNaN(r)&&(/\d(px|in|pt|pc|cm|mm|q|rem|rlh)\W/i.test(n)?t=new z(r,"px"):/\d[a-z]/i.test(n)||(t=new $i(r)))}catch(r){le.warn(r)}return t}visitNumeric(e){return this.resolveViewportUnit&&(Zw(e.unit)||TC(e.unit))?new z(e.num*this.context.queryUnitSize(e.unit,!1,this.vertical),"px"):typeof this.percentRef=="number"&&e.unit==="%"?new z(e.num*this.percentRef/100,"px"):e}};function Ra(e,t,n,i,r){try{if(t instanceof re)return t.expr instanceof mt&&(t.expr.str.startsWith("named-string-")||t.expr.str.startsWith("running-element-"))?t:Zk(e,t.expr,n);if(t instanceof z||t instanceof ho||t instanceof Ge||t instanceof Mt)return t.visit(new _0(e,!0,i,r))}catch(o){return le.warn(o),fe}return t}var Ag={first:!1,forceEnd:!1,allowEnd:!1,last:!1};function Lg(e){let t=e instanceof Et?e:typeof e=="string"?q(e):S.none;if(t===S.none)return Ag;let n=t instanceof Ge?t.values:[t],i=Object.create(Ag);for(let r of n)if(r instanceof Jt)switch(r.name){case"first":i.first=!0;break;case"force-end":i.forceEnd=!0,i.allowEnd=!1;break;case"allow-end":i.forceEnd=!1,i.allowEnd=!0;break;case"last":i.last=!0;break}return i}function Fg(e){return!e.first&&!e.last&&!e.forceEnd&&!e.allowEnd}var VP={trimStart:!1,spaceFirst:!1,trimEnd:!1,allowEnd:!1,trimAdjacent:!1},Og={trimStart:!1,spaceFirst:!1,trimEnd:!1,allowEnd:!0,trimAdjacent:!0},Bg={trimStart:!0,spaceFirst:!1,trimEnd:!0,allowEnd:!1,trimAdjacent:!0};function _g(e){let t=e instanceof Et?e:typeof e=="string"?q(e):S.normal;if(t===S.normal)return Og;if(t===S.auto)return Bg;let n=t instanceof Ge?t.values:[t],i=Object.create(Og);for(let r of n)if(r instanceof Jt)switch(r.name){case"trim-both":case"trim-auto":return Bg;case"space-all":return VP;case"trim-start":i.trimStart=!0,i.spaceFirst=!1;break;case"space-start":i.trimStart=!1,i.spaceFirst=!1;break;case"space-first":i.trimStart=!1,i.spaceFirst=!0;break;case"trim-end":i.trimEnd=!0,i.allowEnd=!1;break;case"space-end":i.trimEnd=!1,i.allowEnd=!1;break;case"allow-end":i.trimEnd=!1,i.allowEnd=!0;break;case"trim-adjacent":i.trimAdjacent=!0;break;case"space-adjacent":i.trimAdjacent=!1;break}return i}var qu={ideographAlpha:!1,ideographNumeric:!1},UP={ideographAlpha:!0,ideographNumeric:!0};function Mg(e){let t=e instanceof Et?e:typeof e=="string"?q(e):S.normal;if(t===S.normal||t===S.auto)return UP;if(t===S.none)return qu;let n=t instanceof Ge?t.values:[t],i=Object.create(qu);for(let r of n)if(r instanceof Jt)switch(r.name){case"no-autospace":return qu;case"ideograph-alpha":i.ideographAlpha=!0;break;case"ideograph-numeric":i.ideographNumeric=!0;break}return i}function zg(e,t){return!e.ideographAlpha&&!e.ideographNumeric&&!t.trimStart&&!t.spaceFirst&&!t.trimEnd&&!t.allowEnd&&!t.trimAdjacent}function $g(e){return e?(e=e.toLowerCase(),/^zh\b.*-(hant|tw|hk)\b/.test(e)?"zh-hant":/^zh\b/.test(e)?"zh-hans":/^ja\b/.test(e)?"ja":/^ko\b/.test(e)?"ko":e):null}var HP=class{getPolyfilledInheritedProps(){return["hanging-punctuation","text-autospace","text-spacing-trim"]}preprocessSingleDocument(e){e.body&&this.preprocessForTextSpacing(e.body)}preprocessForTextSpacing(e){var t;let n=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT);for(let i=n.nextNode();i;i=n.nextNode()){if(i.parentElement.namespaceURI!=="http://www.w3.org/1999/xhtml"||((t=i.parentElement.dataset)==null?void 0:t.mathTypeset)==="true")continue;let r=i.textContent.replace(new RegExp("(?![()\\[\\]{}])[\\p{Ps}\\p{Pe}\\p{Pf}\\p{Pi}、。，．：；､｡\\u3000]\\p{M}*(?=\\P{M})|.(?=(?![()\\[\\]{}])[\\p{Ps}\\p{Pe}\\p{Pf}\\p{Pi}、。，．：；､｡\\u3000])|(?!\\p{P})[\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF]\\p{M}*(?=(?![\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF\\uFF01-\\uFF60])[\\p{L}\\p{Nd}])|(?![\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF\\uFF01-\\uFF60])[\\p{L}\\p{Nd}]\\p{M}*(?=(?!\\p{P})[\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF])","gsu"),"$&\0").split("\0");if(r.length>1){let o=r.length-1;for(let s=0;s<o;s++)i.parentNode.insertBefore(document.createTextNode(r[s]),i);i.textContent=r[o]}}}processGeneratedContent(e,t,n,i,r,o){r=$g(r);let s=Mg(t),l=_g(n),a=Lg(i);if(Fg(a)&&zg(s,l))return;this.preprocessForTextSpacing(e);let u=e.style.whiteSpace;(o?e.offsetHeight:e.offsetWidth)===0&&(e.style.whiteSpace="pre");let h=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT),p=null,c=null;for(let f=h.nextNode();f;f=c){c=h.nextNode();let v=!p,w=!p||/\n$/.test(p.textContent),x=!c||/^\n/.test(c.textContent),g=!c;this.processTextSpacing(f,v||w,v,w,x,g,p,c,s,l,a,r,o),p=f}e.style.whiteSpace=u}postLayoutBlock(e,t){var n,i,r,o,s,l,a;let u=!e||e.fragmentIndex===1&&c(),h=u||f();function p(w){var x;if((w==null?void 0:w.nodeType)!==1)return!1;let g=w;if(g.hasAttribute(no))return!0;let{position:m,float:y}=(x=g.style)!=null?x:{};return m==="absolute"||m==="fixed"||y&&y!=="none"}function c(){let w=t[0];for(let x=w;;x=x.parent)if(!x||!x.inline){if((x==null?void 0:x.fragmentIndex)!==1)return!1;break}if(!w.inline)return!0;for(let x=w.viewNode.previousSibling;x;x=x.previousSibling)if(!vt(x,w.whitespace)&&!p(x))return!1;return!0}function f(){var w,x;let g=t[0],m;for(;g&&g.inline&&(m=(w=g.viewNode)==null?void 0:w.previousSibling,!(m&&(m.nodeType===3&&/^[ \t\r\n\f]*$/.test(m.textContent)&&g.whitespace!==Vt.PRESERVE&&(m=m.previousSibling),m)));)g=g.parent;for(;m;){if(m.nodeType===1){if(m.localName==="br")return!0;let y=(x=m.style)==null?void 0:x.display;if(y&&y!=="inline")return!/^(inline|ruby)\b/.test(y)}else if(m.nodeType===3){if(g.whitespace===Vt.PRESERVE){if(/\n$/.test(m.textContent))return!0}else if(g.whitespace===Vt.NEWLINE&&/\n[ \t\r\n\f]*$/.test(m.textContent))return!0}m=m.lastChild}return!1}let v=-1;for(let w=0;w<t.length;w++){let x=t[w];if(!x.after&&x.inline&&!x.display&&x.parent&&x.viewNode.parentNode&&x.viewNode.nodeType===Node.TEXT_NODE&&!vt(x.viewNode,x.whitespace)){let g=function(T){var k,B,V;if(((k=T.viewNode)==null?void 0:k.nodeType)===1)return T.viewNode.localName==="br";if(((B=T.viewNode)==null?void 0:B.nodeType)===3){if(T.whitespace===Vt.PRESERVE){if(/\n$/.test(T.viewNode.textContent))return!0}else if(T.whitespace===Vt.NEWLINE&&/\n[ \t\r\n\f]*$/.test(T.viewNode.textContent))return!0;if(((V=T.viewNode.previousElementSibling)==null?void 0:V.localName)==="br")return vt(T.viewNode,T.whitespace)}return!1},m=function(T){var k,B,V;if(((k=T.viewNode)==null?void 0:k.nodeType)===1)return T.viewNode.localName==="br";if(((B=T.viewNode)==null?void 0:B.nodeType)===3){if(T.whitespace===Vt.PRESERVE){if(/^\n/.test(T.viewNode.textContent))return!0}else if(T.whitespace===Vt.NEWLINE&&/^[ \t\r\n\f]*\n/.test(T.viewNode.textContent))return!0;if(((V=T.viewNode.nextElementSibling)==null?void 0:V.localName)==="br")return vt(T.viewNode,T.whitespace)}return!1},y=$g((o=(i=(n=x.lang)!=null?n:x.parent.lang)!=null?i:e==null?void 0:e.lang)!=null?o:(r=e==null?void 0:e.parent)==null?void 0:r.lang),C=Mg(x.inheritedProps["text-autospace"]),P=_g(x.inheritedProps["text-spacing-trim"]),A=Lg(x.inheritedProps["hanging-punctuation"]);if(Fg(A)&&zg(C,P)||/\b(flex|grid)\b/.test(x.parent.display))continue;v<0&&(v=w);let I=null,M=null,G=w===v,j=w===v&&u,$=w===v&&h,Z=!1,b=!1;for(let T=w-1;T>=0;T--){let k=t[T];if(g(k)){$=!0;break}if(!k.display&&k.viewNode.nodeType===Node.TEXT_NODE&&k.viewNode.textContent.length>0){I=k.viewNode;break}if(k.display&&!/^(inline|ruby)\b/.test(k.display)||((s=k.viewNode)==null?void 0:s.nodeType)===1&&(k.viewNode.localName==="br"||qi[k.viewNode.localName]))break;T===0&&(G=!0,u&&(j=!0,$=!0))}for(let T=w+1;T<t.length;T++){let k=t[T];if(m(k)){Z=!0;break}if(k.viewNode!==x.viewNode&&!k.display&&k.viewNode.nodeType===Node.TEXT_NODE&&k.viewNode.textContent.length>0){M=k.viewNode;break}if(k.display&&!/^(inline|ruby)\b/.test(k.display)||((l=k.viewNode)==null?void 0:l.nodeType)===1&&(k.viewNode.localName==="br"||qi[k.viewNode.localName])){T===t.length-1&&p(k.viewNode)&&(b=!0);break}if(T===t.length-1){Z=!0,b=!0;for(let B=k.viewNode.nextSibling;B;B=B.nextSibling)if(!p(B)){b=!1;break}}}if(((a=x.parent)==null?void 0:a.display)==="inline-block"){if(!j){let T=x.parent.viewNode.firstChild;for(;vt(T,x.whitespace);)T=T.nextSibling;x.viewNode===T&&(j=!0)}if(!b){let T=x.parent.viewNode.lastChild;for(;vt(T,x.whitespace);)T=T.previousSibling;x.viewNode===T&&(b=!0)}}this.processTextSpacing(x.viewNode,G,j,$,Z,b,I,M,C,P,A,y,x.vertical)}}}processTextSpacing(e,t,n,i,r,o,s,l,a,u,h,p,c){let f=e.textContent,v=e.ownerDocument,w,x,g;function m(){if(t)return!0;if(!s)return!1;w||(w=v.createRange(),w.selectNode(e));let $=w.getClientRects()[0];x||(x=v.createRange(),x.selectNode(s));let Z=x.getClientRects(),b=Z[Z.length-1];return!$||!b?!1:c?$.top<b.top+b.height-$.width||$.left+$.width<b.left+$.width/10||$.left>b.left+b.width-$.width/10:$.left<b.left+b.width-$.height||$.top>b.top+b.height-$.height/10||$.top+$.height<b.top+$.height/10}function y(){if(!l)return!1;w||(w=v.createRange(),w.selectNode(e));let $=w.getClientRects()[0];g||(g=v.createRange(),g.selectNode(l));let Z=g.getClientRects()[0];return!$||!Z?!1:c?$.top+$.height>Z.top+$.width||$.left>Z.left+Z.width-$.width/10||$.left+$.width<Z.left+$.width/10:$.left+$.width>Z.left+$.height||$.top+$.height<Z.top+$.height/10||$.top>Z.top+Z.height-$.height/10}let C=!1,P=!1,A=!1,I=!1,M;if(n&&h.first&&new RegExp(`^[\\p{Ps}\\p{Pf}\\p{Pi}'"\\u3000]\\p{M}*$`,"u").test(f)?(M="viv-ts-open",C=!0,P=!0):o&&h.last&&new RegExp(`^[\\p{Pe}\\p{Pf}\\p{Pi}'"]\\p{M}*$`,"u").test(f)?(M="viv-ts-close",C=!0,A=!0):(h.forceEnd||h.allowEnd)&&new RegExp("^[、。，．､｡]\\p{M}*$","u").test(f)?(M="viv-ts-close",C=!0,I=!0):(u.trimStart||u.spaceFirst||u.trimAdjacent)&&new RegExp("^[‘“〝（［｛｟〈〈《「『【〔〖〘〚]\\p{M}*$","u").test(f)?(M="viv-ts-open",C=!0):(u.trimEnd||u.allowEnd||u.trimAdjacent)&&(new RegExp("^[’”〞〟）］｝｠〉〉》」』】〕〗〙〛]\\p{M}*$","u").test(f)||p==="zh-hans"&&new RegExp("^[：；]\\p{M}*$","u").test(f)||p!=="zh-hant"&&new RegExp("^[、。，．]\\p{M}*$","u").test(f))&&(M="viv-ts-close",C=!0),C){let $=function(B){let V=parseFloat(v.defaultView.getComputedStyle(B).fontSize)*.7;return(c?B.offsetHeight:B.offsetWidth)>V},Z=function(){return c?b.offsetLeft:b.offsetTop};if(e.parentElement.localName==="viv-ts-inner")return;let b=v.createElement(M),T=v.createElement("viv-ts-inner");b.appendChild(T),e.parentNode.insertBefore(b,e),T.appendChild(e);let k=$(T);if(k||P||A||I){if(M==="viv-ts-open"){if(P)b.className="viv-hang-first";else if(n||i)u.trimStart?b.className="viv-ts-trim":b.className="viv-ts-space";else if(!(u.trimStart||u.spaceFirst)&&m())b.className="viv-ts-space";else if(u.trimAdjacent&&s&&new RegExp("[\\p{Ps}\\p{Pi}\\p{Pe}\\p{Pf}\\u00B7\\u2027\\u30FB\\u3000：；、。，．]\\p{M}*$","u").test(s.textContent)&&(!new RegExp("[\\p{Pe}\\p{Pf}]\\p{M}*$","u").test(s.textContent)||s.parentElement.localName==="viv-ts-inner"&&$(s.parentElement)))b.className="viv-ts-trim";else if((u.trimStart||u.spaceFirst)&&m()){let B=Z();b.className="viv-ts-auto",B===Z()&&!m()&&(b.className="viv-ts-trim")}}else if(M==="viv-ts-close"){if(A)b.className=k?"viv-hang-last":"viv-hang-last viv-hang-hw";else if(o||r){let B=Z();I?(b.className=k?h.allowEnd&&u.allowEnd?"viv-ts-auto":"viv-hang-end":"viv-hang-end viv-hang-hw",h.allowEnd&&B===Z()&&(u.trimEnd?b.className="viv-ts-trim":u.allowEnd?(b.className="viv-hang-end",B===Z()&&(b.className="")):b.className="viv-ts-space")):u.trimEnd?b.className="viv-ts-trim":u.allowEnd?(b.className="viv-ts-auto",B===Z()&&(b.className="")):b.className="viv-ts-space"}else if(l&&/^[\p{Pe}\p{Pf}\u00B7\u2027\u30FB\u3000：；、。，．]/u.test(l.textContent))k&&u.trimAdjacent&&(b.className="viv-ts-trim");else if(I){let B=y(),V=B&&h.allowEnd;V||(b.className=k?"viv-hang-end":"viv-hang-end viv-hang-hw"),k?V&&u.trimEnd?b.className="viv-ts-auto":!V&&!y()?b.className="":!B&&h.allowEnd&&(u.trimEnd?(b.className="viv-ts-auto",y()||(b.className="viv-hang-end")):(b.className="viv-ts-space",y()||(u.allowEnd?(b.className="viv-ts-auto",y()||(b.className="viv-hang-end")):b.className="viv-hang-end"))):!B&&!y()&&(b.className="")}else if(u.trimEnd||u.allowEnd)if(y())u.allowEnd?b.className="viv-ts-space":b.className="viv-ts-auto";else{let B=Z();b.className="viv-ts-auto",B===Z()&&(b.className="")}}}}function G($){var Z;let b=(Z=$==null?void 0:$.ownerDocument.defaultView)==null?void 0:Z.getComputedStyle($);return!!b&&(b.textOrientation==="upright"||b.textCombineUpright==="all"||b["-webkit-text-combine"]==="horizontal")}function j($,Z){if($.nodeType===1){let k=v.defaultView.getComputedStyle($);if(parseFloat(k.marginInlineEnd)||parseFloat(k.borderInlineEndWidth)||parseFloat(k.paddingInlineEnd))return!0}let b=$.parentElement;if(b&&!b.contains(Z))return j(b,Z);if(Z.nodeType===1){let k=v.defaultView.getComputedStyle(Z);if(parseFloat(k.marginInlineStart)||parseFloat(k.borderInlineStartWidth)||parseFloat(k.paddingInlineStart))return!0}let T=Z.parentElement;return T&&!T.contains($)?j($,T):!1}(a.ideographAlpha||a.ideographNumeric)&&(s&&new RegExp("^(?!\\p{P})[\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF]","u").test(f)&&(a.ideographAlpha&&new RegExp("(?![\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF\\uFF01-\\uFF60])\\p{L}\\p{M}*$","u").test(s.textContent)||a.ideographNumeric&&new RegExp("(?![\\uFF01-\\uFF60])\\p{Nd}\\p{M}*$","u").test(s.textContent))&&!(c&&G(s.parentElement))&&!j(s,e)&&e.parentNode.insertBefore(v.createElement("viv-ts-thin-sp"),e),l&&new RegExp("(?!\\p{P})[\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF]\\p{M}*$","u").test(f)&&(a.ideographAlpha&&new RegExp("^(?![\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF\\uFF01-\\uFF60])\\p{L}","u").test(l.textContent)||a.ideographNumeric&&new RegExp("^(?![\\uFF01-\\uFF60])\\p{Nd}","u").test(l.textContent))&&!(c&&G(l.parentElement))&&!j(e,l)&&e.parentNode.insertBefore(v.createElement("viv-ts-thin-sp"),e.nextSibling))}registerHooks(){wn("POLYFILLED_INHERITED_PROPS",this.getPolyfilledInheritedProps.bind(this)),wn("PREPROCESS_SINGLE_DOCUMENT",this.preprocessSingleDocument.bind(this)),wn("POST_LAYOUT_BLOCK",this.postLayoutBlock.bind(this),!0)}},hp=new HP;hp.registerHooks();function WP(e){hp.preprocessForTextSpacing(e)}function jP(e,t,n,i,r,o){hp.processGeneratedContent(e,t,n,i,r,o)}var Hl=new DOMParser().parseFromString('<root xmlns="http://www.pyroxy.com/ns/shadow"/>',"text/xml"),GP=["footnote-marker","first-5-lines","first-4-lines","first-3-lines","first-2-lines","first-line","first-letter","before","","after"],cp="data-adapt-pseudo";function Br(e){return e.getAttribute(cp)||""}function Ic(e,t){e.setAttribute(cp,t)}var Dg=class{constructor(e,t,n,i,r){this.element=e,this.style=t,this.styler=n,this.context=i,this.exprContentListener=r,d(this,"contentProcessed",{})}getStyle(e,t){let n=Br(e);this.styler&&n&&n.match(/after$/)&&(this.style=this.styler.getStyle(this.element,!0),this.styler=null);let i=Tn(this.style,"_pseudos")[n]||{};if(n.match(/^first-/)&&!i["x-first-pseudo"]){let r=1,o;n=="first-letter"?r=0:(o=n.match(/^first-([0-9]+)-lines$/))!=null&&(r=o[1]-0),i["x-first-pseudo"]=new ke(new ar(r),0)}return i}processContent(e,t,n){let i=Br(e);if(!this.contentProcessed[i]){this.contentProcessed[i]=!0;let r=t.content;r&&Bi(r)&&(r.visit(new Ta(e,this.context,r,this.exprContentListener)),WP(e))}}};Ea.isInstanceOfAfterIfContinuesLayoutConstraint;var XP=ru.registerFragmentIndex;ru.clearFragmentIndices;var YP=class{constructor(e,t){this.sourceNode=e,this.styler=t}createElement(e,t){let n=t.viewNode.ownerDocument.createElement("div"),i=new dp(e,n,t),r=i.getColumn().pageBreakType;return i.getColumn().pageBreakType=null,i.layout(this.createNodePositionForPseudoElement(),!0).thenAsync(()=>{this.styler.contentProcessed["after-if-continues"]=!1,i.getColumn().pageBreakType=r;let o=n.firstChild;return O(o,"display","block"),R(o)})}createNodePositionForPseudoElement(){let e=Hl.createElementNS("http://www.w3.org/1999/xhtml","div");Ic(e,"after-if-continues");let t=this.createShadowContext(e),n={steps:[{node:e,shadowType:t.type,shadowContext:t,nodeShadow:null,shadowSibling:null}],offsetInNode:0,after:!1,preprocessedTextContent:null};return new Oi(n)}createShadowContext(e){return new hc(this.sourceNode,e,null,null,null,ii.ShadowType.ROOTED,this.styler)}},qP=class M0{constructor(t,n,i){this.nodeContext=t,this.afterIfContinues=n,this.pseudoElementHeight=i,d(this,"flagmentLayoutConstraintType","AfterIfContinue")}allowLayout(t,n,i){return!(n&&!t||t&&t.overflow)}nextCandidate(t){return!1}postLayout(t,n,i,r){}finishBreak(t,n){return this.getRepetitiveElements().affectTo(t)?this.afterIfContinues.createElement(n,this.nodeContext).thenAsync(i=>(this.nodeContext.viewNode.appendChild(i),R(!0))):R(!0)}getRepetitiveElements(){return new KP(this.nodeContext,this.pseudoElementHeight)}equalsTo(t){return t instanceof M0?this.afterIfContinues==t.afterIfContinues:!1}getPriorityOfFinishBreak(){return 9}},KP=class{constructor(e,t){this.nodeContext=e,this.pseudoElementHeight=t}calculateOffset(e){return this.affectTo(e)?this.pseudoElementHeight:0}calculateMinimumOffset(e){return this.calculateOffset(e)}affectTo(e){if(!e)return!1;let t=e.shadowContext?e.shadowContext.owner:e.sourceNode;if(t===this.nodeContext.sourceNode)return!!e.after;for(let n=t.parentNode;n;n=n.parentNode)if(n===this.nodeContext.sourceNode)return!0;return!1}};function z0(e,t){if(!e||!e.afterIfContinues||e.after||t.isFloatNodeContext(e))return R(e);let n=e.afterIfContinues;return n.createElement(t,e).thenAsync(i=>{let r=ZP(e,t,i);return t.fragmentLayoutConstraints.push(new qP(e,n,r)),R(e)})}function $0(e,t){return e.thenAsync(n=>z0(n,t))}function QP(e,t){let n=X("processAfterIfContinuesOfAncestors"),i=e;return n.loop(()=>{if(i!==null){let r=z0(i,t);return i=i.parent,r.thenReturn(!0)}else return R(!1)}).then(()=>{n.finish(!0)}),n.result()}function ZP(e,t,n){let i=e.viewNode;i.appendChild(n);let r=fc(n,t,e.vertical);return i.removeChild(n),r}var JP=class{constructor(e){this.constraints=e}allowLayout(e){return this.constraints.every(t=>t.allowLayout(e))}},Wl=class extends np{constructor(e,t){super(),this.checkPoints=e,this.penalty=t,d(this,"alreadyEvaluated",!1),d(this,"breakNodeContext",null)}findAcceptableBreak(e,t){return t<this.getMinBreakPenalty()?null:(this.alreadyEvaluated||(this.breakNodeContext=e.findBoxBreakPosition(this,t>0),this.alreadyEvaluated=!!this.breakNodeContext||t>0||!!e.pseudoParent),this.breakNodeContext)}getMinBreakPenalty(){return this.penalty}getNodeContext(){return this.alreadyEvaluated?this.breakNodeContext:this.checkPoints[this.checkPoints.length-1]}},Aa=class extends i0{constructor(e,t,n,i,r){super(e),this.layoutContext=t,this.clientLayout=n,this.layoutConstraint=i,this.pageFloatLayoutContext=r,d(this,"last"),d(this,"viewDocument"),d(this,"flowRootFormattingContext",null),d(this,"isFloat",!1),d(this,"isFootnote",!1),d(this,"startEdge",0),d(this,"endEdge",0),d(this,"beforeEdge",0),d(this,"afterEdge",0),d(this,"footnoteEdge",0),d(this,"box",null),d(this,"chunkPositions",null),d(this,"bands",null),d(this,"overflown",!1),d(this,"breakPositions",null),d(this,"pageBreakType",null),d(this,"forceNonfitting",!0),d(this,"leftFloatEdge",0),d(this,"rightFloatEdge",0),d(this,"bottommostFloatTop",0),d(this,"stopAtOverflow",!0),d(this,"lastAfterPosition",null),d(this,"fragmentLayoutConstraints",[]),d(this,"pseudoParent",null),d(this,"nodeContextOverflowingDueToRepetitiveElements",null),d(this,"blockDistanceToBlockEndFloats",NaN),d(this,"breakAtTheEdgeBeforeFloat",null),this.last=e.lastChild,this.viewDocument=e.ownerDocument,r.setContainer(this)}getTopEdge(){return this.vertical?this.rtl?this.endEdge:this.startEdge:this.beforeEdge}getBottomEdge(){return this.vertical?this.rtl?this.startEdge:this.endEdge:this.afterEdge}getLeftEdge(){return this.vertical?this.afterEdge:this.rtl?this.endEdge:this.startEdge}getRightEdge(){return this.vertical?this.beforeEdge:this.rtl?this.startEdge:this.endEdge}isFloatNodeContext(e){return!!e.floatSide&&(!this.isFloat||!!e.parent)}stopByOverflow(e){return this.stopAtOverflow&&!!e&&e.overflow}isOverflown(e){return this.vertical?e<this.footnoteEdge:e>this.footnoteEdge}getExclusions(){let e=this.pageFloatLayoutContext.getFloatFragmentExclusions();return this.exclusions.concat(e)}openAllViews(e){let t=X("openAllViews"),n=e.steps;this.layoutContext.setViewRoot(this.element,this.isFootnote);let i=n.length-1,r=null;return t.loop(()=>{for(;i>=0;){let o=r,s=n[i];if(r=Na(s,o),i===n.length-1&&!r.formattingContext&&(r.formattingContext=this.flowRootFormattingContext),i==0&&(r.offsetInNode=this.calculateOffsetInNodeForNodeContext(e),r.after=e.after,r.preprocessedTextContent=e.preprocessedTextContent,r.after))break;let l=this.layoutContext.setCurrent(r,i==0&&r.offsetInNode==0);if(i--,l.isPending())return l}return R(!1)}).then(()=>{t.finish(r)}),t.result()}calculateOffsetInNodeForNodeContext(e){return e.preprocessedTextContent?uE(e.preprocessedTextContent,e.offsetInNode):e.offsetInNode}maybePeelOff(e,t){var n,i;if(e.firstPseudo&&e.inline&&!e.after&&e.firstPseudo.count==0&&e.viewNode.nodeType!=1){let r=e.viewNode.textContent,o=r.match(Xh),s=o?o[0].length:0;if(!o&&((n=e.sourceNode)==null?void 0:n.nodeType)===3&&((i=e.sourceNode.nextSibling)==null?void 0:i.nodeType)===3&&r===e.sourceNode.textContent){let l=r+e.sourceNode.nextSibling.textContent,a=l.match(Xh);if(a){let u=a[0];s=u.length,e.sourceNode.textContent=u,e.viewNode.textContent=u,e.sourceNode.nextSibling.textContent=l.substr(s)}}return this.layoutContext.peelOff(e,s)}return R(e)}buildViewToNextBlockEdge(e,t){let n=!1,i=X("buildViewToNextBlockEdge");return i.loopWithFrame(r=>{var o;e.viewNode&&!Fr(e)&&((o=e.viewNode.parentElement)==null?void 0:o.namespaceURI)==="http://www.w3.org/1999/xhtml"&&t.push(e.copy()),this.maybePeelOff(e,0).then(s=>{let l=s;l!==e&&(e=l,Fr(e)||t.push(e.copy())),this.nextInTree(e).then(a=>{if(e=a,!e){r.breakLoop();return}(n||!this.layoutConstraint.allowLayout(e))&&(n=!0,e=e.modify(),e.overflow=!0),this.isFloatNodeContext(e)&&(Wr(e.floatReference)||e.floatSide==="footnote")?this.layoutFloatOrFootnote(e).then(u=>{if(e=u,this.pageFloatLayoutContext.isInvalidated()&&(e=null),!e){r.breakLoop();return}r.continueLoop()}):e.inline?r.continueLoop():r.breakLoop()})})}).then(()=>{i.finish(e)}),i.result()}nextInTree(e,t){let n=this.layoutContext.nextInTree(e,t);return $0(n,this)}buildDeepElementView(e){if(!e.viewNode)return R(e);let t=[],n=e.sourceNode,i=X("buildDeepElementView");return i.loopWithFrame(r=>{e.viewNode&&e.inline&&!Fr(e)?t.push(e.copy()):(t.length>0&&this.postLayoutBlock(e,t),t=[]),this.maybePeelOff(e,0).then(o=>{let s=o;if(s!==e){let l=s;for(;l&&l.sourceNode!=n;)l=l.parent;if(l==null){e=s,r.breakLoop();return}Fr(s)||t.push(s.copy())}this.nextInTree(s).then(l=>{e=l,!e||e.sourceNode==n?r.breakLoop():this.layoutConstraint.allowLayout(e)?r.continueLoop():(e=e.modify(),e.overflow=!0,this.stopAtOverflow?r.breakLoop():r.continueLoop())})})}).then(()=>{t.length>0&&this.postLayoutBlock(e,t),i.finish(e)}),i.result()}createFloat(e,t,n,i){let r=this.viewDocument.createElement("div");return this.vertical?(i>=this.height&&(i-=.1),i<1&&(i=0),O(r,"height",`${n}px`),O(r,"width",`${i}px`)):(n>=this.width&&(n-=.1),n<1&&(n=0),O(r,"width",`${n}px`),O(r,"height",`${i}px`)),O(r,"float",t),O(r,"clear",t),this.element.insertBefore(r,e),r}killFloats(){let e=this.element.firstChild;for(;e;){let t=e.nextSibling;if(e.nodeType==1){let n=e,i=n.style.cssFloat;if(i=="left"||i=="right"||i==="none")this.element.removeChild(n);else break}e=t}}createFloats(){let e=this.element.firstChild,t=this.bands,n=this.vertical?this.getTopEdge():this.getLeftEdge(),i=this.vertical?this.getBottomEdge():this.getRightEdge(),r=null;for(let o of t){let s=o.y2-o.y1;o.left=this.createFloat(e,"left",o.x1-n,s),o.right=this.createFloat(e,"right",i-o.x2,s),o.x1<i&&o.x2>n?r=o:r||O(o.right,"float","none")}if(r){let o=t[t.length-1],s=this.vertical?-this.getLeftEdge():this.getBottomEdge();r!==o&&o.y2>=s&&(this.footnoteEdge=this.vertical?-r.y2:r.y2)}}calculateEdge(e,t,n,i){let r;if(e&&Lr(e.viewNode))return NaN;if(e&&e.after&&!e.inline&&(r=wr(e,this.clientLayout,0,this.vertical),!isNaN(r)))return r;e=t[n];let o=i-e.boxOffset;for(;;){if(r=wr(e,this.clientLayout,o,this.vertical),!isNaN(r))return r;if(o>0){o--;continue}if(n--,n<0)return this.beforeEdge;e=t[n],e.viewNode.nodeType!=1&&(o=e.viewNode.textContent.length)}}parseComputedLength(e){let t=e.match(/^(-?[0-9]*(\.[0-9]*)?)px$/);return t?this.clientLayout.adjustLengthValue(parseFloat(t[0])):0}getComputedMargin(e){let t=this.clientLayout.getElementComputedStyle(e),n=new Vu(0,0,0,0);return t&&(n.left=this.parseComputedLength(t.marginLeft),n.top=this.parseComputedLength(t.marginTop),n.right=this.parseComputedLength(t.marginRight),n.bottom=this.parseComputedLength(t.marginBottom)),n}getComputedPaddingBorder(e){let t=this.clientLayout.getElementComputedStyle(e),n=new Vu(0,0,0,0);return t&&(n.left=this.parseComputedLength(t.borderLeftWidth)+this.parseComputedLength(t.paddingLeft),n.top=this.parseComputedLength(t.borderTopWidth)+this.parseComputedLength(t.paddingTop),n.right=this.parseComputedLength(t.borderRightWidth)+this.parseComputedLength(t.paddingRight),n.bottom=this.parseComputedLength(t.borderBottomWidth)+this.parseComputedLength(t.paddingBottom)),n}getComputedInsets(e){let t=this.clientLayout.getElementComputedStyle(e),n=new Vu(0,0,0,0);if(t){if(t.boxSizing=="border-box")return this.getComputedMargin(e);n.left=this.parseComputedLength(t.marginLeft)+this.parseComputedLength(t.borderLeftWidth)+this.parseComputedLength(t.paddingLeft),n.top=this.parseComputedLength(t.marginTop)+this.parseComputedLength(t.borderTopWidth)+this.parseComputedLength(t.paddingTop),n.right=this.parseComputedLength(t.marginRight)+this.parseComputedLength(t.borderRightWidth)+this.parseComputedLength(t.paddingRight),n.bottom=this.parseComputedLength(t.marginBottom)+this.parseComputedLength(t.borderBottomWidth)+this.parseComputedLength(t.paddingBottom)}return n}setComputedInsets(e,t){let n=this.clientLayout.getElementComputedStyle(e);n&&(t.marginLeft=this.parseComputedLength(n.marginLeft),t.borderLeft=this.parseComputedLength(n.borderLeftWidth),t.paddingLeft=this.parseComputedLength(n.paddingLeft),t.marginTop=this.parseComputedLength(n.marginTop),t.borderTop=this.parseComputedLength(n.borderTopWidth),t.paddingTop=this.parseComputedLength(n.paddingTop),t.marginRight=this.parseComputedLength(n.marginRight),t.borderRight=this.parseComputedLength(n.borderRightWidth),t.paddingRight=this.parseComputedLength(n.paddingRight),t.marginBottom=this.parseComputedLength(n.marginBottom),t.borderBottom=this.parseComputedLength(n.borderBottomWidth),t.paddingBottom=this.parseComputedLength(n.paddingBottom))}setComputedWidthAndHeight(e,t){let n=this.clientLayout.getElementComputedStyle(e);n&&(t.width=this.parseComputedLength(n.width),t.height=this.parseComputedLength(n.height))}layoutUnbreakable(e){return this.buildDeepElementView(e)}layoutFloat(e){let t=X("layoutFloat"),n=e.viewNode,i=yg(e.floatSide,e.vertical,e.direction,this.layoutContext.page.side);return O(n,"float","none"),O(n,"display","inline-block"),O(n,"vertical-align","top"),this.buildDeepElementView(e).then(r=>{let o=this.clientLayout.getElementClientRect(n),s=this.getComputedMargin(n),l=new on(o.left-s.left,o.top-s.top,o.right+s.right,o.bottom+s.bottom),a=this.rtl?this.endEdge:this.startEdge,u=this.rtl?this.startEdge:this.endEdge,h=e.parent;for(;h&&h.inline;)h=h.parent;if(h){let y=h.viewNode.ownerDocument.createElement("div");y.style.left="0px",y.style.top="0px",this.vertical?(y.style.bottom="0px",y.style.width="1px"):(y.style.right="0px",y.style.height="1px"),h.viewNode.appendChild(y);let C=this.clientLayout.getElementClientRect(y);a=Math.max(this.rtl?this.getEndEdge(C):this.getStartEdge(C),a),u=Math.min(this.rtl?this.getStartEdge(C):this.getEndEdge(C),u),h.viewNode.removeChild(y);let P=this.vertical?l.y2-l.y1:l.x2-l.x1;i=="left"?u=Math.max(u,a+P):a=Math.min(a,u-P),h!==e.parent&&!e.firstPseudo&&(h.viewNode.appendChild(n),n.setAttribute("data-vivliostyle-float-box-moved","true"))}let p=new on(a,this.getBoxDir()*this.beforeEdge,u,this.getBoxDir()*this.afterEdge),c=l;this.vertical&&(c=Sa(l));let f=this.getBoxDir();if(c.y1<this.bottommostFloatTop*f){let y=c.y2-c.y1;c.y1=this.bottommostFloatTop*f,c.y2=c.y1+y}QC(p,this.bands,c,i),this.vertical&&(l=yy(c));let v=this.getComputedInsets(n);O(n,"width",`${l.x2-l.x1-v.left-v.right}px`),O(n,"height",`${l.y2-l.y1-v.top-v.bottom}px`),O(n,"position","absolute"),e.display,O(n,"display",e.display);let w,x=null;if(h&&(h.containingBlockForAbsolute?x=h:x=h.getContainingBlockForAbsolute()),x){let y=x.viewNode.ownerDocument.createElement("div");y.style.position="absolute",x.vertical?y.style.right="0":y.style.left="0",y.style.top="0",x.viewNode.appendChild(y),w=this.clientLayout.getElementClientRect(y),x.viewNode.removeChild(y)}else w={left:this.getLeftEdge()-this.paddingLeft,right:this.getRightEdge()+this.paddingRight,top:this.getTopEdge()-this.paddingTop};(x?x.vertical:this.vertical)?O(n,"right",`${w.right-l.x2}px`):O(n,"left",`${l.x1-w.left}px`),O(n,"top",`${l.y1-w.top}px`),e.clearSpacer&&(e.clearSpacer.parentNode.removeChild(e.clearSpacer),e.clearSpacer=null);let g=this.vertical?l.x1:l.y2,m=this.vertical?l.x2:l.y1;!this.isOverflown(g)||this.breakPositions.length==0?(this.killFloats(),p=new on(this.getLeftEdge(),this.getTopEdge(),this.getRightEdge(),this.getBottomEdge()),this.vertical&&(p=Sa(p)),ZC(p,this.bands,c,null,i),this.createFloats(),i=="left"?this.leftFloatEdge=g:this.rightFloatEdge=g,this.bottommostFloatTop=m,this.updateMaxReachedAfterEdge(g),t.finish(r)):(e=e.modify(),e.overflow=!0,t.finish(e))}),t.result()}setupFloatArea(e,t,n,i,r,o){let s=this.pageFloatLayoutContext,l=s.getContainer(t),a=e.element;l.element.parentNode.appendChild(a),e.isFloat=!0,e.originX=l.originX,e.originY=l.originY,e.vertical=l.vertical,e.rtl=l.rtl,e.marginLeft=e.marginRight=e.marginTop=e.marginBottom=0,e.borderLeft=e.borderRight=e.borderTop=e.borderBottom=0,e.paddingLeft=e.paddingRight=e.paddingTop=e.paddingBottom=0,e.exclusions=(l.exclusions||[]).concat(),e.forceNonfitting=!s.hasFloatFragments(),e.innerShape=null;let u=l.getPaddingRect();e.setHorizontalPosition(u.x1-l.originX,u.x2-u.x1),e.setVerticalPosition(u.y1-l.originY,u.y2-u.y1),r.adjustPageFloatArea(e,l,this),e.init();let h=!!s.setFloatAreaDimensions(e,t,n,i,!0,!s.hasFloatFragments(),o);return h?(e.killFloats(),e.init()):l.element.parentNode.removeChild(a),h}createPageFloatArea(e,t,n,i,r){let o=this.element.ownerDocument.createElement("div");O(o,"position","absolute");let s=this.pageFloatLayoutContext.getPageFloatLayoutContext(e.floatReference),l=new Mo(null,at.COLUMN,null,this.pageFloatLayoutContext.flowName,e.nodePosition,null,null),a=s.getContainer(),u=new nN(t,o,this.layoutContext.clone(),this.clientLayout,this.layoutConstraint,l,a);return l.setContainer(u),this.setupFloatArea(u,e.floatReference,t,n,i,r)?u:null}layoutSinglePageFloatFragment(e,t,n,i,r,o,s){let l=this.pageFloatLayoutContext;e=(s?s.continuations:[]).concat(e);let a=e[0].float,u=l.getPageFloatPlacementCondition(a,t,n),h=this.createPageFloatArea(a,t,o,r,u),p={floatArea:h,pageFloatFragment:null,newPosition:null};if(!h)return R(p);let c=X("layoutSinglePageFloatFragment"),f=!1,v=0;return c.loopWithFrame(w=>{if(v>=e.length){w.breakLoop();return}let x=e[v],g=new Oi(x.nodePosition);h.layout(g,!0).then(m=>{p.newPosition=m,!m||i?(v++,w.continueLoop()):(f=!0,w.breakLoop())})}).then(()=>{if(!f){let w=l.setFloatAreaDimensions(h,a.floatReference,t,o,!1,i,u);if(!w)f=!0;else{let x=r.createPageFloatFragment(e,w,h,!!p.newPosition);l.addPageFloatFragment(x,!0),p.pageFloatFragment=x}}c.finish(p)}),c.result()}layoutPageFloatInner(e,t,n,i){let r=this.pageFloatLayoutContext,o=e.float;r.stashEndFloatFragments(o);function s(a,u){u?r.removePageFloatFragment(u,!0):a&&a.element.parentNode.removeChild(a.element),r.restoreStashedFragments(o.floatReference),r.deferPageFloat(e)}let l=X("layoutPageFloatInner");return this.layoutSinglePageFloatFragment([e],o.floatSide,o.clearSide,!r.hasFloatFragments(),t,n,i).then(a=>{let u=a.floatArea,h=a.pageFloatFragment,p=a.newPosition;h?this.layoutStashedPageFloats(o.floatReference,[i]).then(c=>{if(c){if(r.addPageFloatFragment(h),r.discardStashedFragments(o.floatReference),p){let f=new xg(o,p.primary);r.deferPageFloat(f)}l.finish(!0)}else s(u,h),l.finish(!1)}):(s(u,h),l.finish(!1))}),l.result()}layoutStashedPageFloats(e,t){let n=this.pageFloatLayoutContext,i=n.getStashedFloatFragments(e),r=[],o=[],s=!1,l=X("layoutStashedPageFloats"),a=0;return l.loopWithFrame(u=>{if(a>=i.length){u.breakLoop();return}let h=i[a];if(t.includes(h)){a++,u.continueLoop();return}let p=new io().findByFloat(h.continuations[0].float);this.layoutSinglePageFloatFragment(h.continuations,h.floatSide,null,!1,p,null).then(c=>{let f=c.floatArea;f&&r.push(f);let v=c.pageFloatFragment;v?(o.push(v),a++,u.continueLoop()):(s=!0,u.breakLoop())})}).then(()=>{s?(o.forEach(u=>{n.removePageFloatFragment(u,!0)}),r.forEach(u=>{let h=u.element;h&&h.parentNode&&h.parentNode.removeChild(h)})):i.forEach(u=>{let h=u.area.element;h&&h.parentNode&&h.parentNode.removeChild(h)}),l.finish(!s)}),l.result()}setFloatAnchorViewNode(e){let t=e.viewNode.parentNode,n=t.ownerDocument.createElement("span");n.setAttribute(no,"1"),e.floatSide==="footnote"&&this.layoutContext.applyPseudoelementStyle(e,"footnote-call",n),t.appendChild(n),t.removeChild(e.viewNode);let i=e.modify();return i.after=!0,i.viewNode=n,i}resolveFloatReferenceFromColumnSpan(e,t,n){let i=X("resolveFloatReferenceFromColumnSpan"),r=this.pageFloatLayoutContext,o=r.getPageFloatLayoutContext(at.REGION);return r.getContainer().width<o.getContainer().width&&e===at.COLUMN?t===S.auto?this.buildDeepElementView(n.copy()).then(s=>{let l=s.viewNode,a=Zd(this.clientLayout,l,["min-content inline size"])["min-content inline size"],u=this.getComputedMargin(l);this.vertical?a+=u.top+u.bottom:a+=u.left+u.right,a>this.width?i.finish(at.REGION):i.finish(e)}):t===S.all?i.finish(at.REGION):i.finish(e):i.finish(e),i.result()}layoutPageFloat(e){let t=this.pageFloatLayoutContext,n=new io().findByNodeContext(e),i,r=t.findPageFloatByNodePosition(e.toNodePosition());return r?i=R(r):i=n.createPageFloat(e,t,this),i.thenAsync(o=>{let s=Pa(e,0),l=this.setFloatAnchorViewNode(e),a=n.findPageFloatFragment(o,t),u=new xg(o,s);if(a&&a.hasFloat(o))return t.registerPageFloatAnchor(o,l.viewNode),R(l);if(t.isForbidden(o)||t.hasPrecedingFloatsDeferredToNext(o))return t.deferPageFloat(u),t.registerPageFloatAnchor(o,l.viewNode),R(l);if(this.nodeContextOverflowingDueToRepetitiveElements)return R(null);{let h=wr(l,this.clientLayout,0,this.vertical);return this.isOverflown(h)?R(l):this.layoutPageFloatInner(u,n,h,a).thenAsync(p=>p?R(null):(t.registerPageFloatAnchor(o,l.viewNode),R(l)))}})}processLineStyling(e,t,n){let i=X("processLineStyling"),r=n.concat([]);n.splice(0,n.length);let o=0,s=e.firstPseudo;return s.count==0&&(s=s.outer),i.loopWithFrame(l=>{if(!s){l.breakLoop();return}let a=this.findLinePositions(r),u=s.count-o;if(a.length<=u){l.breakLoop();return}let h=this.findAcceptableBreakInside(r,a[u-1],!0);if(h==null){l.breakLoop();return}this.finishBreak(h,!1,!1).then(()=>{o+=u,this.layoutContext.peelOff(h,0).then(p=>{e=p,s=e.firstPseudo,r=[],this.buildViewToNextBlockEdge(e,r).then(c=>{t=c,l.continueLoop()})})})}).then(()=>{Array.prototype.push.apply(n,r),i.finish(t)}),i.result()}isLoneImage(e){return e.length!=2&&this.breakPositions.length>0?!1:e[0].sourceNode==e[1].sourceNode&&qi[e[0].sourceNode.localName]}getTrailingMarginEdgeAdjustment(e){let t=0,n=0;for(let i=e.length-1;i>=0;i--){let r=e[i];if(!r.after||!r.viewNode||r.viewNode.nodeType!=1)break;let o=this.getComputedMargin(r.viewNode),s=this.vertical?-o.left:o.bottom;s>0?t=Math.max(t,s):n=Math.min(n,s)}return t+n}layoutBreakableBlock(e){let t=X("layoutBreakableBlock"),n=[];return this.buildViewToNextBlockEdge(e,n).then(i=>{let r=n.length-1;if(r<0){t.finish(i);return}this.postLayoutBlock(i,n);let o=this.calculateEdge(i,n,r,n[r].boxOffset),s=!1;if(!i||!Lr(i.viewNode)){let a=jr(i,this.collectElementsOffset());s=this.isOverflown(o+(this.vertical?-1:1)*a.minimum),this.isOverflown(o+(this.vertical?-1:1)*a.current)&&!this.nodeContextOverflowingDueToRepetitiveElements&&(this.nodeContextOverflowingDueToRepetitiveElements=i)}i==null&&(o+=this.getTrailingMarginEdgeAdjustment(n)),this.updateMaxReachedAfterEdge(o);let l;e.firstPseudo?l=this.processLineStyling(e,i,n):l=R(i),l.then(a=>{n.length>0&&(this.saveBoxBreakPosition(n),s&&!this.isLoneImage(n)&&a&&(a=a.modify(),a.overflow=!0)),t.finish(a)})}),t.result()}postLayoutBlock(e,t){An("POST_LAYOUT_BLOCK").forEach(n=>{n(e,t,this)})}findEndOfLine(e,t,n){let i=this.vertical?e-1:e+1,r=0,o=t[0].boxOffset,s=r,l=t.length-1,a=t[l].boxOffset,u;for(;o<a;){u=o+Math.ceil((a-o)/2),s=r;let h=l;for(;s<h;){let c=s+Math.ceil((h-s)/2);t[c].boxOffset>u?h=c-1:s=c}let p=this.calculateEdge(null,t,s,u);if(this.vertical?p<=i:p>=i){for(a=u-1;t[s].boxOffset==u;)s--;l=s}else n&&this.updateMaxReachedAfterEdge(p),o=u,r=s}return{nodeContext:t[s],index:o,checkPointIndex:s}}findAcceptableBreakInside(e,t,n){var i,r,o;let s=this.findEndOfLine(t,e,!0),l=s.nodeContext;if(s.checkPointIndex===0&&s.index===l.boxOffset)return null;let a=l.viewNode;if(a.nodeType!=1&&((i=a.parentElement)==null?void 0:i.localName)!=="viv-ts-inner"){let u=a;l=this.resolveTextNodeBreaker(l).breakTextNode(u,l,s.index,e,s.checkPointIndex,n)}else{let u=Cg(l);if(u){if(((r=this.breakPositions)==null?void 0:r[0])instanceof Wl&&u!=null&&u.viewNode.contains(this.breakPositions[0].checkPoints[0].viewNode))return null;for(l=u;!l.after&&l.inline&&l.parent;){let h=(o=l.viewNode)==null?void 0:o.previousSibling;for(;h&&(vt(h,l.parent.whitespace)||zo(h));)h=h.previousSibling;if(h)break;l=l.parent}}}return this.clearOverflownViewNodes(l,!1),l}resolveTextNodeBreaker(e){return An("RESOLVE_TEXT_NODE_BREAKER").reduce((t,n)=>n(e)||t,La.instance)}getRangeBoxes(e,t){let n=[],i=e.ownerDocument.createRange(),r=!1,o=e,s=null,l=!1,a=!0;for(;a;){let u=!0;do{let h=null;o==t&&(t.nodeType===1?a=!(!t.firstChild||r):a=!1);let p=o.nodeType===1?o:null;p?r?r=!1:tp(p)?u=!l:!p.firstChild||qi[p.localName]||/^r(uby|[bt]c?)$/.test(p.localName)||OE(this.clientLayout.getElementComputedStyle(p).display)?(u=!l,u?(p.localName==="ruby"&&o.firstChild&&(o=o.firstChild),i.setStartBefore(o),l=!0,s=o):/^r(uby|tc?)$/.test(p.localName)||(s=o),o.contains(t)&&(a=!1)):h=o.firstChild:(l||(o.parentNode==null?a=!1:(i.setStartBefore(o),l=!0)),s=o),h||(h=o.nextSibling,h||(r=!0,h=o.parentNode)),o=h}while(u&&a);if(l){i.setEndAfter(s);let h=this.clientLayout.getRangeClientRects(i);for(let p=0;p<h.length;p++)n.push(h[p]);l=!1}}return n}findLinePositions(e){let t=[],n=this.getRangeBoxes(e[0].viewNode,e[e.length-1].viewNode);n.sort(this.vertical?wE:vE);let i=0,r=0,o=0,s=0,l=0,a=this.getBoxDir();for(;;){if(l<n.length){let u=n[l],h=1;if(s>0){let p=Math.max(this.getBoxSize(u),1);a*this.getBeforeEdge(u)<a*i?h=a*(this.getAfterEdge(u)-i)/p:a*this.getAfterEdge(u)>a*r?h=a*(r-this.getBeforeEdge(u))/p:h=1}if(s==0||h>=.6||h>=.2&&this.getStartEdge(u)>=o-1){o=this.getEndEdge(u),this.vertical?(i=s==0?u.right:Math.max(i,u.right),r=s==0?u.left:Math.min(r,u.left)):(i=s==0?u.top:Math.min(i,u.top),r=s==0?u.bottom:Math.max(r,u.bottom)),s++,l++;continue}}if(s>0&&(t.push(r),s=0),l>=n.length)break}return t.sort(jw),this.vertical&&t.reverse(),t}calculateClonedPaddingBorder(e){let t=0;for(let n=e;n;n=n.parent)if(!n.inline&&Oo(n.viewNode)){let i=this.getComputedPaddingBorder(n.viewNode);t+=n.vertical?-i.left:i.bottom,n.display==="table"&&(t+=(n.vertical?-1:1)*n.blockBorderSpacing)}return t}getOffsetByRepetitiveElements(e){let t;return e?t=e.calculateOffset(this):t=jr(null,this.collectElementsOffset()),t.current}findBoxBreakPosition(e,t){let n=this.element.parentNode,i=this.element.nextSibling;n.removeChild(this.element),n.insertBefore(this.element,i);let r=e.checkPoints,o=r[0];for(;o.parent&&o.inline;)o=o.parent;let s,l;t?(s=1,l=1):(s=Math.max((o.inheritedProps.widows||2)-0,1),l=Math.max((o.inheritedProps.orphans||2)-0,1));let a=this.calculateClonedPaddingBorder(o),u=this.findLinePositions(r),h=this.footnoteEdge-a,p=this.getBoxDir(),c=this.getOffsetByRepetitiveElements(e);h-=p*c;let f=this.findFirstOverflowingEdgeAndCheckPoint(r);isNaN(f.edge)&&(f.edge=p*(1/0));let v=Ai(u.length,m=>{let y=u[m];return this.vertical?y<h||y<=f.edge:y>h||y>=f.edge}),w=v<=0;w&&(v=Ai(u.length,m=>this.vertical?u[m]<h:u[m]>h));let x=r[r.length-1].viewNode;if((x==null?void 0:x.parentElement.localName)==="viv-ts-inner"&&(x=x.parentElement.parentElement),(v===u.length&&x.nextSibling||v>=u.length-1&&x.parentElement.querySelector(".MJXc-display"))&&(s=0),v=Math.min(u.length-s,v),v<l)return null;h=u[v-1];let g;if(w?g=f.checkPoint:g=this.findAcceptableBreakInside(e.checkPoints,h,t),g){let m=this.getAfterEdgeOfBlockContainer(g);!isNaN(m)&&p*(h-m)>0&&(h=m),this.computedBlockSize=p*(h-this.beforeEdge)+c}return g}getAfterEdgeOfBlockContainer(e){let t=e;do t=t.parent;while(t&&t.inline);return t?(t=t.copy().modify(),t.after=!0,wr(t,this.clientLayout,0,this.vertical)):NaN}findFirstOverflowingEdgeAndCheckPoint(e){let t=e.findIndex(i=>i.overflow);if(t<0)return{edge:NaN,checkPoint:null};let n=e[t];return{edge:this.calculateEdge(null,e,t,n.boxOffset),checkPoint:n}}findEdgeBreakPosition(e){return this.computedBlockSize=e.computedBlockSize+this.getOffsetByRepetitiveElements(e),e.position}finishBreak(e,t,n){e.formattingContext;let i=new No().find(e.formattingContext).finishBreak(this,e,t,n);return i||(i=rp.finishBreak(this,e,t,n)),i}findAcceptableBreakPosition(){let e=null,t=null,n=0,i=0;do{n=i,i=Number.MAX_VALUE;for(let r=this.breakPositions.length-1;r>=0&&!t;--r){e=this.breakPositions[r],t=e.findAcceptableBreak(this,n);let o=e.getMinBreakPenalty();o>n&&(i=Math.min(i,o))}}while(i>n&&!t&&this.forceNonfitting);return{breakPosition:t?e:null,nodeContext:t}}doFinishBreak(e,t,n,i){if(this.pageFloatLayoutContext.isInvalidated()||this.pageBreakType||!t)return R(e);let r=X("doFinishBreak"),o=!1;if(!e){if(this.forceNonfitting)return le.warn("Could not find any page breaks?!!"),this.skipTailEdges(t).then(s=>{s?(s=s.modify(),s.overflow=!1,this.finishBreak(s,o,!0).then(()=>{r.finish(s)})):r.finish(s)}),r.result();e=n,o=!0,this.computedBlockSize=i}return this.finishBreak(e,o,!0).then(()=>{r.finish(e)}),r.result()}isBreakable(e){for(let t=e;t;t=t.parent)if(zo(t.viewNode))return!1;if(e.after)return!0;switch(e.sourceNode.namespaceURI){case"http://www.w3.org/2000/svg":return!1}return!e.flexContainer}zeroIndent(e){let t=e.toString();return t==""||t=="auto"||!!t.match(/^0+(.0*)?[^0-9]/)}checkOverflowAndSaveEdge(e,t){if(!e)return!1;for(let o=e;o;o=o.parent)if(zo(o.viewNode))return!1;if(Lr(e.viewNode))return!1;let n=wr(e,this.clientLayout,0,this.vertical),i=jr(e,this.collectElementsOffset()),r=this.isOverflown(n+(this.vertical?-1:1)*i.minimum);if(this.isOverflown(n+(this.vertical?-1:1)*i.current)&&!this.nodeContextOverflowingDueToRepetitiveElements)this.nodeContextOverflowingDueToRepetitiveElements=e;else if(t){let o=n+this.getTrailingMarginEdgeAdjustment(t),s=this.footnoteEdge-this.getBoxDir()*i.current;n=this.vertical?Math.min(n,Math.max(o,s)):Math.max(n,Math.min(o,s))}return this.updateMaxReachedAfterEdge(n),r}checkOverflowAndSaveEdgeAndBreakPosition(e,t,n,i){if(!e||Lr(e.viewNode))return!1;let r=this.checkOverflowAndSaveEdge(e,t);return(n||!r)&&this.saveEdgeBreakPosition(e,i,r),r}applyClearance(e){if(!e.viewNode.parentNode)return!1;let t=this.getComputedMargin(e.viewNode),n=e.viewNode.ownerDocument.createElement("div");this.vertical?(n.style.bottom="0px",n.style.width="1px",n.style.marginRight=`${t.right}px`):(n.style.right="0px",n.style.height="1px",n.style.marginTop=`${t.top}px`),e.viewNode.parentNode.insertBefore(n,e.viewNode);let i=this.clientLayout.getElementClientRect(n),r=this.getBeforeEdge(i),o=this.getBoxDir(),s=e.clearSide,l=-this.getBoxDir()*(1/0);switch(s==="all"&&(l=this.pageFloatLayoutContext.getPageFloatClearEdge(s,this)),/^(top|bottom|inside|outside|(block|inline)-(start|end))$/.test(s)?yg(s,e.vertical,e.direction,this.layoutContext.page.side):s){case"left":l=o*Math.max(l*o,this.leftFloatEdge*o);break;case"right":l=o*Math.max(l*o,this.rightFloatEdge*o);break;default:l=o*Math.max(l*o,Math.max(this.rightFloatEdge*o,this.leftFloatEdge*o))}if(r*o>=l*o)return e.viewNode.parentNode.removeChild(n),!1;{let a=Math.max(1,(l-r)*o);this.vertical?n.style.width=`${a}px`:n.style.height=`${a}px`,i=this.clientLayout.getElementClientRect(n);let u=this.getAfterEdge(i);if(!e.floatSide)if(this.vertical){let h=u+t.right-l;h>0==t.right>=0&&(h+=t.right),n.style.marginLeft=`${h}px`}else{let h=l-(u+t.top);h>0==t.top>=0&&(h+=t.top),n.style.marginBottom=`${h}px`}return e.clearSpacer=n,!0}}isBFC(e){return!!(BE(e)||Ji.isInstanceOfRepetitiveElementsOwnerFormattingContext(e))}skipEdges(e,t,n){var i;let r=e.after?(i=e.parent)==null?void 0:i.formattingContext:e.formattingContext;if(r&&!this.isBFC(r))return R(e);let o=X("skipEdges"),s=!n&&t&&e&&e.after,l=n,a=null,u=[],h=[],p=!1;function c(){return!!n||!t&&Dt(l)&&!f()}function f(){var w;if(!a||e.floatSide)return!1;for(let x=a;x!=null&&x.parent;x=x.parent){let g=x.after?x.viewNode:(w=x.viewNode)==null?void 0:w.previousSibling;for(;g&&(vt(g,x.parent.whitespace)||zo(g));)g=g.previousSibling;if(g)return!1}return!0}let v=()=>{e=u[0]||e,e.viewNode.parentNode.removeChild(e.viewNode),this.pageBreakType=l};return o.loopWithFrame(w=>{for(var x;e;){e.formattingContext;let g=new No().find(e.formattingContext);do{if(!e.viewNode)break;if(e.inline&&e.viewNode.nodeType!=1){if(vt(e.viewNode,e.whitespace))break;if(!e.after){c()?v():this.checkOverflowAndSaveEdgeAndBreakPosition(a,null,!0,l)?(e=(this.stopAtOverflow&&a||e).modify(),e.overflow=!0):(e=e.modify(),e.breakBefore=l),w.breakLoop();return}}if(!e.after){if(e.floatSide&&(this.breakAtTheEdgeBeforeFloat=ka(l)?l:null),g&&g.startNonInlineElementNode(e))break;if(e.clearSide&&this.applyClearance(e)&&t&&this.breakPositions.length===0&&this.saveEdgeBreakPosition(e.copy(),l,!1),!e.inline&&!e.repeatOnBreak&&(a?Cg(a):this.breakPositions[this.breakPositions.length-1]instanceof Wl)&&this.saveEdgeBreakPosition(e.copy(),l,!1),!this.isBFC(e.formattingContext)||Ji.isInstanceOfRepetitiveElementsOwnerFormattingContext(e.formattingContext)||this.isFloatNodeContext(e)||e.flexContainer||!e.nodeShadow&&!e.sourceNode.firstElementChild&&vt(e.sourceNode.firstChild,e.whitespace)){u.push(e.copy()),l=Bt(l,e.breakBefore),c()?v():(this.checkOverflowAndSaveEdgeAndBreakPosition(a,null,!0,l)||!this.layoutConstraint.allowLayout(e))&&(e=(this.stopAtOverflow&&a||e).modify(),e.overflow=!0),w.breakLoop();return}}if(e.viewNode.nodeType!=1)break;let y=e.viewNode.style;if(e.after){e.floatSide&&(l=l??this.breakAtTheEdgeBeforeFloat,this.breakAtTheEdgeBeforeFloat=null);let C=e.sourceNode;if(C.localName==="svg"||C.localName==="math"||C.getAttribute("data-math-typeset")==="true"){p=!1,a=e.copy(),h.push(a),l=Bt(null,e.breakAfter),this.checkOverflowAndSaveEdgeAndBreakPosition(a,null,!this.stopAtOverflow,l);break}if(e.inline||g&&g.afterNonInlineElementNode(e,this.stopAtOverflow))break;if(p){if(c()){v(),w.breakLoop();return}u=[],t=!1,s=!1,l=null}p=!1,a=e.copy(),h.push(a),l=Bt(l,e.breakAfter),y&&!(this.zeroIndent(y.paddingBottom)&&this.zeroIndent(y.borderBottomWidth))&&(h=[a])}else{if(u.push(e.copy()),l=Bt(l,e.breakBefore),(e.pageType!=((x=e.parent)==null?void 0:x.pageType)||!Dt(l))&&!this.layoutConstraint.allowLayout(e)&&(this.checkOverflowAndSaveEdgeAndBreakPosition(a,null,!this.stopAtOverflow,l),e=e.modify(),e.overflow=!0,this.stopAtOverflow)){w.breakLoop();return}let C=e.viewNode.localName;if(qi[C]){c()?v():this.checkOverflowAndSaveEdgeAndBreakPosition(a,null,!0,l)&&(e=(this.stopAtOverflow&&a||e).modify(),e.overflow=!0),w.breakLoop();return}y&&!(this.zeroIndent(y.paddingTop)&&this.zeroIndent(y.borderTopWidth))&&(s=!1,h=[]),p=!0}}while(!1);let m=this.nextInTree(e,s);if(m.isPending()){m.then(y=>{e=y,w.continueLoop()});return}else e=m.get()}this.checkOverflowAndSaveEdgeAndBreakPosition(a,h,!this.stopAtOverflow,l)?a&&this.stopAtOverflow&&(e=a.modify(),e.overflow=!0):Dt(l)&&(this.pageBreakType=l),w.breakLoop()}).then(()=>{a&&(this.lastAfterPosition=a.toNodePosition()),o.finish(e)}),o.result()}skipTailEdges(e){let t=e.copy(),n=X("skipEdges"),i=null,r=!1;return n.loopWithFrame(o=>{for(;e;){do{if(!e.viewNode)break;if(e.inline&&e.viewNode.nodeType!=1){if(vt(e.viewNode,e.whitespace))break;if(!e.after){Dt(i)&&(this.pageBreakType=i),o.breakLoop();return}}if(!e.after&&(this.isFloatNodeContext(e)||e.flexContainer)){i=Bt(i,e.breakBefore),Dt(i)&&(this.pageBreakType=i),o.breakLoop();return}if(e.viewNode.nodeType!=1)break;let l=e.viewNode.style;if(e.after){if(r){if(Dt(i)){this.pageBreakType=i,o.breakLoop();return}i=null}r=!1,i=Bt(i,e.breakAfter)}else{i=Bt(i,e.breakBefore);let a=e.viewNode.localName;if(qi[a]){Dt(i)&&(this.pageBreakType=i),o.breakLoop();return}if(l&&!(this.zeroIndent(l.paddingTop)&&this.zeroIndent(l.borderTopWidth))){o.breakLoop();return}}r=!0}while(!1);let s=this.layoutContext.nextInTree(e);if(s.isPending()){s.then(l=>{e=l,o.continueLoop()});return}else e=s.get()}t=null,o.breakLoop()}).then(()=>{n.finish(t)}),n.result()}layoutFloatOrFootnote(e){return Wr(e.floatReference)||e.floatSide==="footnote"?this.layoutPageFloat(e):this.layoutFloat(e)}layoutNext(e,t,n){let i=X("layoutNext");return this.skipEdges(e,t,n||null).then(r=>{if(e=r,!e||this.pageBreakType||this.stopByOverflow(e))i.finish(e);else{let o=e.formattingContext;new No().find(o).layout(e,this,t).thenFinish(i)}}),i.result()}clearOverflownViewNodes(e,t){if(e)for(let n=e.parent;e;e=n,n=n?n.parent:null){let i=(n||e).formattingContext;new No().find(i).clearOverflownViewNodes(this,n,e,t),t=!1}}initGeom(){let e=this.element.ownerDocument.createElement("div");e.style.position="absolute",e.style.top=`${this.paddingTop}px`,e.style.right=`${this.paddingRight}px`,e.style.bottom=`${this.paddingBottom}px`,e.style.left=`${this.paddingLeft}px`,this.element.appendChild(e);let t=this.clientLayout.getElementClientRect(e);this.element.removeChild(e);let n=this.originX+this.left+this.getInsetLeft(),i=this.originY+this.top+this.getInsetTop();this.box=new on(n,i,n+this.width,i+this.height),this.startEdge=t?this.vertical?this.rtl?t.bottom:t.top:this.rtl?t.right:t.left:0,this.endEdge=t?this.vertical?this.rtl?t.top:t.bottom:this.rtl?t.left:t.right:0,this.beforeEdge=t?this.vertical?t.right:t.top:0,this.afterEdge=t?this.vertical?t.left:t.bottom:0,this.leftFloatEdge=this.beforeEdge,this.rightFloatEdge=this.beforeEdge,this.bottommostFloatTop=this.beforeEdge,this.footnoteEdge=this.afterEdge,this.bands=YC(this.box,[this.getInnerShape()],this.getExclusions(),8,this.snapHeight,this.vertical),this.createFloats()}init(){this.chunkPositions=[],O(this.element,"width",`${this.width}px`),O(this.element,"height",`${this.height}px`),this.initGeom(),this.computedBlockSize=0,this.overflown=!1,this.pageBreakType=null,this.lastAfterPosition=null}saveEdgeBreakPosition(e,t,n){e.formattingContext;let i=e.copy(),r=new No().find(e.formattingContext),o=this.calculateClonedPaddingBorder(i),s=r.createEdgeBreakPosition(i,t,n,this.computedBlockSize+o);this.breakPositions.push(s)}saveBoxBreakPosition(e){let t=e[0].breakPenalty;if(t){let i=e[0];for(;i.parent&&i.inline;)i=i.parent;t=i.breakPenalty}let n=new Wl(e,t);this.breakPositions.push(n)}updateMaxReachedAfterEdge(e){if(!isNaN(e)){let t=this.getBoxDir()*(e-this.beforeEdge);this.computedBlockSize=Math.max(t,this.computedBlockSize)}}layout(e,t,n){if(this.chunkPositions.push(e),e.primary.after&&(this.lastAfterPosition=e.primary),this.stopAtOverflow&&this.overflown)return R(e);if(this.isFullWithPageFloats())return e.primary.after&&e.primary.steps.length===1?R(null):R(e);let i=X("layout");return this.openAllViews(e.primary).then(r=>{let o=null;if(r.viewNode)o=r.copy();else{let l=a=>{a.nodeContext.viewNode&&(o=a.nodeContext,this.layoutContext.removeEventListener("nextInTree",l))};this.layoutContext.addEventListener("nextInTree",l)}let s=new eN(t,n);s.layout(r,this).then(l=>{this.doFinishBreak(l,s.context.overflownNodeContext,o,s.initialComputedBlockSize).then(a=>{let u=null;this.pseudoParent?u=R(null):u=this.doFinishBreakOfFragmentLayoutConstraints(a),u.then(()=>{if(this.pageFloatLayoutContext.isInvalidated()){i.finish(null);return}if(!a)i.finish(null);else{this.overflown=!0;let h=new Oi(a.toNodePosition());i.finish(h)}})})})}),i.result()}isFullWithPageFloats(){return this.pageFloatLayoutContext.isColumnFullWithPageFloats(this)}getMaxBlockSizeOfPageFloats(){return this.pageFloatLayoutContext.getMaxBlockSizeOfPageFloats()}doFinishBreakOfFragmentLayoutConstraints(e){let t=X("doFinishBreakOfFragmentLayoutConstraints"),n=[].concat(this.fragmentLayoutConstraints);n.sort((r,o)=>r.getPriorityOfFinishBreak()-o.getPriorityOfFinishBreak());let i=0;return t.loop(()=>i<n.length?n[i++].finishBreak(e,this).thenReturn(!0):R(!1)).then(()=>{t.finish(!0)}),t.result()}doLayout(e,t,n){let i=X("doLayout"),r=null;return this.breakPositions=[],this.nodeContextOverflowingDueToRepetitiveElements=null,i.loopWithFrame(o=>{for(;e;){let s=!0;if(this.layoutNext(e,t,n||null).then(l=>{if(t=!1,n=null,this.nodeContextOverflowingDueToRepetitiveElements&&this.stopAtOverflow?(this.pageBreakType=null,e=this.nodeContextOverflowingDueToRepetitiveElements,e.overflow=!0):e=l,this.pageFloatLayoutContext.isInvalidated())o.breakLoop();else if(this.pageBreakType)o.breakLoop();else if(e&&this.stopByOverflow(e)){r=e;let a=this.findAcceptableBreakPosition();e=a.nodeContext,a.breakPosition&&a.breakPosition.breakPositionChosen(this),o.breakLoop()}else s?s=!1:o.continueLoop()}),s){s=!1;return}}this.computedBlockSize+=this.getOffsetByRepetitiveElements(),o.breakLoop()}).then(()=>{i.finish({nodeContext:e,overflownNodeContext:r})}),i.result()}redoLayout(){let e=this.chunkPositions,t=this.element.lastChild;for(;t!=this.last;){let s=t.previousSibling;this.element===t.parentNode&&this.layoutContext.isPseudoelement(t)||this.element.removeChild(t),t=s}this.killFloats(),this.init();let n=X("redoLayout"),i=0,r=null,o=!0;return n.loopWithFrame(s=>{if(i<e.length){let l=e[i++];this.layout(l,o).then(a=>{o=!1,a?(r=a,s.breakLoop()):s.continueLoop()});return}s.breakLoop()}).then(()=>{n.finish(r)}),n.result()}saveDistanceToBlockEndFloats(){let e=this.pageFloatLayoutContext.getBlockStartEdgeOfBlockEndFloats();e>0&&isFinite(e)&&(this.blockDistanceToBlockEndFloats=this.getBoxDir()*(e-this.beforeEdge-this.computedBlockSize))}collectElementsOffset(){let e=[];for(let t=this;t;t=t.pseudoParent)t.fragmentLayoutConstraints.forEach(n=>{if(Ji.isInstanceOfRepetitiveElementsOwnerLayoutConstraint(n)){let i=n.getRepetitiveElements();e.push(i)}if(Ea.isInstanceOfAfterIfContinuesLayoutConstraint(n)){let i=n.getRepetitiveElements();e.push(i)}Li.isInstanceOfTableRowLayoutConstraint(n)&&n.getElementsOffsetsForTableCell(this).forEach(i=>{e.push(i)})});return e}},dp=class{constructor(e,t,n){d(this,"startNodeContexts",[]),d(this,"column"),this.column=Object.create(e),this.column.element=t,this.column.layoutContext=e.layoutContext.clone(),this.column.stopAtOverflow=!1,this.column.flowRootFormattingContext=n.formattingContext,this.column.pseudoParent=e;let i=this.column.calculateClonedPaddingBorder(n);this.column.footnoteEdge=this.column.footnoteEdge-i;let r=this;this.column.openAllViews=function(o){return Aa.prototype.openAllViews.call(this,o).thenAsync(s=>(r.startNodeContexts.push(s.copy()),R(s)))}}layout(e,t){return this.column.layout(e,t)}findAcceptableBreakPosition(e){let t=this.column.findAcceptableBreakPosition();if(e){let n=this.startNodeContexts[0].copy(),i=new Qs(n,null,n.overflow,0);if(i.findAcceptableBreak(this.column,0),!t.nodeContext)return{breakPosition:i,nodeContext:n}}return t}finishBreak(e,t,n){return this.column.finishBreak(e,t,n)}doFinishBreakOfFragmentLayoutConstraints(e){this.column.doFinishBreakOfFragmentLayoutConstraints(e)}isStartNodeContext(e){let t=this.startNodeContexts[0];return t.viewNode===e.viewNode&&t.after===e.after&&t.offsetInNode===e.offsetInNode}isLastAfterNodeContext(e){return Fi(e.toNodePosition(),this.column.lastAfterPosition)}getColumnElement(){return this.column.element}getColumn(){return this.column}},La=class{breakTextNode(e,t,n,i,r,o){if(t.after)t.offsetInNode=e.length;else{let s=n-t.boxOffset,l=e.data;l.charCodeAt(s)==173?s=this.breakAfterSoftHyphen(e,l,s,t):s=this.breakAfterOtherCharacter(e,l,s,t),s>0&&(t=this.updateNodeContext(t,s,e))}return t}breakAfterSoftHyphen(e,t,n,i){let r=new RegExp("[\\u0620\\u0626\\u0628\\u062A-\\u062E\\u0633-\\u0647\\u0649\\u064A\\u066E\\u066F\\u0678-\\u0687\\u069A-\\u06BF\\u06C1\\u06C2\\u06CC\\u06CE\\u06D0\\u06D1\\u06FA-\\u06FC\\u06FF\\u0712-\\u0714\\u071A-\\u071D\\u071F-\\u0727\\u0729\\u072B\\u072D\\u072E\\u074E-\\u0758\\u075C-\\u076A\\u076D-\\u0770\\u0772\\u0775-\\u0777\\u077A-\\u077F\\u07CA-\\u07EA\\u07FA\\u0841-\\u0845\\u0848\\u084A-\\u0853\\u0855\\u0860\\u0862-\\u0865\\u0868\\u0883-\\u0886\\u0889-\\u088D\\u08A0-\\u08A9\\u08AF\\u08B0\\u08B3-\\u08B8\\u08BA-\\u08C8\\u1807\\u180A\\u1820-\\u1878\\u1887-\\u18A8\\u18AA\\u200D\\uA840-\\uA871\\u{10AC0}-\\u{10AC4}\\u{10AD3}-\\u{10AD6}\\u{10AD8}-\\u{10ADC}\\u{10ADE}-\\u{10AE0}\\u{10AEB}-\\u{10AEE}\\u{10B80}\\u{10B82}\\u{10B86}-\\u{10B88}\\u{10B8A}\\u{10B8B}\\u{10B8D}\\u{10B90}\\u{10BAD}\\u{10BAE}\\u{10D01}-\\u{10D21}\\u{10D23}\\u{10EC3}\\u{10EC4}\\u{10F30}-\\u{10F32}\\u{10F34}-\\u{10F44}\\u{10F51}-\\u{10F53}\\u{10F70}-\\u{10F73}\\u{10F76}-\\u{10F81}\\u{10FB0}\\u{10FB2}\\u{10FB3}\\u{10FB8}\\u{10FBB}\\u{10FBC}\\u{10FBE}\\u{10FBF}\\u{10FC1}\\u{10FC4}\\u{10FCA}\\u{1E900}-\\u{1E943}]\\p{Mn}*$","u").test(t.slice(0,n))?"‍":"";if(e.replaceData(n,t.length-n,i.breakWord?"":r+Vg(i)),r){let o=i.preprocessedTextContent[0][1];i.preprocessedTextContent[0][1]=o.slice(0,n+1)+r+o.slice(n+1)}return n+1}breakAfterOtherCharacter(e,t,n,i){let r=t.charAt(n);n++;let o=t.charAt(n);return e.replaceData(n,t.length-n,!i.breakWord&&Xf(r)&&Xf(o)?Vg(i):""),n}updateNodeContext(e,t,n){return e=e.modify(),e.offsetInNode+=t,e.breakBefore=null,e}};d(La,"instance");La.instance=new La;function Vg(e){return e.hyphenateCharacter||e.parent&&e.parent.hyphenateCharacter||"-"}var eN=class extends op{constructor(e,t){super(),this.leadingEdge=e,d(this,"breakAfter"),d(this,"initialPageBreakType",null),d(this,"initialComputedBlockSize",0),d(this,"initialOverflown",!1),d(this,"context",{overflownNodeContext:null}),this.breakAfter=t||null}resolveLayoutMode(e){return new tN(this.leadingEdge,this.breakAfter,this.context)}prepareLayout(e,t){t.fragmentLayoutConstraints=[],t.pseudoParent||ME()}clearNodes(e){super.clearNodes(e);let t=e;for(;t;){let n=t.viewNode;n&&h0(n.parentNode,n),t=t.parent}}saveState(e,t){super.saveState(e,t),this.initialPageBreakType=t.pageBreakType,this.initialComputedBlockSize=t.computedBlockSize,this.initialOverflown=t.overflown}restoreState(e,t){super.restoreState(e,t),t.pageBreakType=this.initialPageBreakType,t.computedBlockSize=this.initialComputedBlockSize,t.overflown=this.initialOverflown}},tN=class{constructor(e,t,n){this.leadingEdge=e,this.breakAfter=t,this.context=n}doLayout(e,t){let n=X("DefaultLayoutMode.doLayout");return QP(e,t).then(()=>{t.doLayout(e,this.leadingEdge,this.breakAfter).then(i=>{this.context.overflownNodeContext=i.overflownNodeContext,n.finish(i.nodeContext)})}),n.result()}accept(e,t){return t.pageFloatLayoutContext.isInvalidated()||t.pageBreakType||t.fragmentLayoutConstraints.length<=0?!0:t.fragmentLayoutConstraints.every(n=>n.allowLayout(e,this.context.overflownNodeContext,t))}postLayout(e,t,n,i){return i||(i=!n.fragmentLayoutConstraints.some(r=>r.nextCandidate(e))),n.fragmentLayoutConstraints.forEach(r=>{r.postLayout(i,e,t,n)}),i}},nN=class extends Aa{constructor(e,t,n,i,r,o,s){super(t,n,i,r,o),this.floatSide=e,this.parentContainer=s,d(this,"rootViewNodes",[]),d(this,"floatMargins",[]),d(this,"adjustContentRelativeSize",!0)}openAllViews(e){return super.openAllViews(e).thenAsync(t=>(t&&this.fixFloatSizeAndPosition(t),R(t)))}convertPercentageSizesToPx(e){let t=this.parentContainer.getPaddingRect(),n=t.x2-t.x1,i=t.y2-t.y1;function r(o,s){o.forEach(l=>{let a=mi(e,l);if(a&&a.charAt(a.length-1)==="%"){let u=parseFloat(a),h=s*u/100;O(e,l,`${h}px`)}})}r(["width","max-width","min-width"],n),r(["height","max-height","min-height"],i),r(["margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left"],this.vertical?i:n),["margin-top","margin-right","margin-bottom","margin-left"].forEach(o=>{mi(e,o)==="auto"&&O(e,o,"0")})}fixFloatSizeAndPosition(e){for(;e.parent;)e=e.parent;e.viewNode.nodeType;let t=e.viewNode;if(this.rootViewNodes.push(t),this.adjustContentRelativeSize&&this.convertPercentageSizesToPx(t),this.floatMargins.push(this.getComputedMargin(t)),this.adjustContentRelativeSize){let n=this.floatSide;if(this.parentContainer.vertical){if(n==="block-end"||n==="left"){let i=mi(t,"height");i!==""&&i!=="auto"&&O(t,"margin-top","auto")}}else if(n==="block-end"||n==="bottom"){let i=mi(t,"width");i!==""&&i!=="auto"&&O(t,"margin-left","auto")}}}getContentInlineSize(){return Math.max.apply(null,this.rootViewNodes.map((e,t)=>{let n=this.clientLayout.getElementClientRect(e),i=this.floatMargins[t];return this.vertical?i.top+n.height+i.bottom:i.left+n.width+i.right}))}},ro=class{constructor(e,t){this.parent=e,this.rootSourceNode=t,d(this,"formattingContextType","RepetitiveElementsOwner"),d(this,"isRoot",!1),d(this,"repetitiveElements",null)}getName(){return"Repetitive elements owner formatting context (RepetitiveElementsOwnerFormattingContext)"}isFirstTime(e,t){return t}getParent(){return this.parent}getRepetitiveElements(){return this.repetitiveElements}getRootViewNode(e){let t=this.getRootNodeContext(e);return t?t.viewNode:null}getRootNodeContext(e){do if(!e.belongsTo(this)&&e.sourceNode===this.rootSourceNode)return e;while(e=e.parent);return null}initializeRepetitiveElements(e){this.repetitiveElements||mc.some(t=>t.root===this.rootSourceNode?(this.repetitiveElements=t.elements,!0):!1)||(this.repetitiveElements=new iN(e,this.rootSourceNode),mc.push({root:this.rootSourceNode,elements:this.repetitiveElements}))}saveState(){}restoreState(e){}},iN=class{constructor(e,t){this.vertical=e,this.ownerSourceNode=t,d(this,"headerSourceNode",null),d(this,"footerSourceNode",null),d(this,"headerViewNode",null),d(this,"footerViewNode",null),d(this,"headerNodePosition",null),d(this,"footerNodePosition",null),d(this,"headerHeight",0),d(this,"footerHeight",0),d(this,"isSkipHeader",!1),d(this,"isSkipFooter",!1),d(this,"enableSkippingFooter",!0),d(this,"enableSkippingHeader",!0),d(this,"doneInitialLayout",!1),d(this,"firstContentSourceNode",null),d(this,"lastContentSourceNode",null),d(this,"affectedNodeCache",[]),d(this,"afterLastContentNodeCache",[]),d(this,"allowInsert",!1),d(this,"allowInsertRepeatitiveElements")}setHeaderNodeContext(e){this.headerNodePosition||(this.headerNodePosition=Pa(e,0),this.headerSourceNode=e.sourceNode,this.headerViewNode=e.viewNode)}setFooterNodeContext(e){this.footerNodePosition||(this.footerNodePosition=Pa(e,0),this.footerSourceNode=e.sourceNode,this.footerViewNode=e.viewNode)}updateHeight(e){this.headerViewNode&&(this.headerHeight=fc(this.headerViewNode,e,this.vertical),this.headerViewNode=null),this.footerViewNode&&(this.footerHeight=fc(this.footerViewNode,e,this.vertical),this.footerViewNode=null)}prepareLayoutFragment(){this.isSkipHeader=this.isSkipFooter=!1,this.enableSkippingFooter=!0,this.enableSkippingHeader=!0}appendHeaderToFragment(e,t,n){return!this.headerNodePosition||this.isSkipHeader?R(!0):this.appendElementToFragment(this.headerNodePosition,e,t,n)}appendFooterToFragment(e,t,n){return!this.footerNodePosition||this.isSkipFooter?R(!0):this.appendElementToFragment(this.footerNodePosition,e,t,n)}appendElementToFragment(e,t,n,i){let r=t.viewNode.ownerDocument,o=t.viewNode,s=r.createElement("div");o.appendChild(s);let l=new dp(i,s,t),a=l.getColumn().pageBreakType;return l.getColumn().pageBreakType=null,this.allowInsertRepeatitiveElements=!0,l.layout(new Oi(e),!0).thenAsync(()=>(this.allowInsertRepeatitiveElements=!1,o.removeChild(s),this.moveChildren(s,o,n),l.getColumn().pageBreakType=a,R(!0)))}moveChildren(e,t,n){if(t)for(;e.firstChild;){let i=e.firstChild;e.removeChild(i),i.setAttribute(no,"1"),n?t.insertBefore(i,n):t.appendChild(i)}}calculateOffset(e){let t=0;return e&&!this.affectTo(e)||((!this.isSkipFooter||e&&this.isAfterLastContent(e))&&(t+=this.footerHeight),this.isSkipHeader||(t+=this.headerHeight)),t}calculateMinimumOffset(e){let t=0;return e&&!this.affectTo(e)||(!this.enableSkippingFooter&&e&&this.isAfterLastContent(e)&&(t+=this.footerHeight),this.enableSkippingHeader||(t+=this.headerHeight)),t}isAfterLastContent(e){return this.findResultFromCache(e,this.afterLastContentNodeCache,t=>this.isAfterNodeContextOf(this.lastContentSourceNode,e,!1))}affectTo(e){return this.findResultFromCache(e,this.affectedNodeCache,t=>this.isAfterNodeContextOf(this.ownerSourceNode,e,!0))}findResultFromCache(e,t,n){let i=t.filter(r=>r.nodeContext.sourceNode===e.sourceNode&&r.nodeContext.after===e.after);if(i.length>0)return i[0].result;{let r=n(e);return t.push({nodeContext:e,result:r}),r}}isAfterNodeContextOf(e,t,n){let i=[];for(let r=e;r;r=r.parentNode){if(t.sourceNode===r)return t.after;i.push(r)}for(let r=t.sourceNode;r;r=r.parentNode){let o=i.indexOf(r);if(o>=0)return n?o===0:!1;for(let s=r;s;s=s.previousElementSibling)if(i.includes(s))return!0}return t.after}isFirstContentNode(e){return e&&this.firstContentSourceNode===e.sourceNode}isEnableToUpdateState(){return!!(!this.isSkipFooter&&this.enableSkippingFooter&&this.footerNodePosition||!this.isSkipHeader&&this.enableSkippingHeader&&this.headerNodePosition)}updateState(){!this.isSkipFooter&&this.enableSkippingFooter&&this.footerNodePosition?this.isSkipFooter=!0:!this.isSkipHeader&&this.enableSkippingHeader&&this.headerNodePosition&&(this.isSkipHeader=!0)}preventSkippingHeader(){this.isSkipHeader=!1,this.enableSkippingHeader=!1}preventSkippingFooter(){this.isSkipFooter=!1,this.enableSkippingFooter=!1}isHeaderRegistered(){return!!this.headerNodePosition}isFooterRegistered(){return!!this.footerNodePosition}isHeaderSourceNode(e){return this.headerSourceNode===e}isFooterSourceNode(e){return this.footerSourceNode===e}},D0=class{constructor(e){this.formattingContext=e}accept(e,t){return!!e}postLayout(e,t,n,i){let r=this.formattingContext.getRepetitiveElements();return r&&(n.clientLayout,r.doneInitialLayout||(r.updateHeight(n),r.doneInitialLayout=!0)),i}},V0=class{constructor(e){this.formattingContext=e}accept(e,t){return!0}postLayout(e,t,n,i){return i}},rN=class extends D0{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return this.processor.doInitialLayout(e,t)}accept(e,t){return!1}},oN=class extends V0{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return!e.belongsTo(this.formattingContext)&&!e.after&&t.fragmentLayoutConstraints.unshift(new pp(e)),this.processor.doLayout(e,t)}},pp=class U0{constructor(t){d(this,"flagmentLayoutConstraintType","RepetitiveElementsOwner"),d(this,"nodeContext");let n=t.formattingContext;this.nodeContext=n.getRootNodeContext(t)}allowLayout(t,n,i){let r=this.getRepetitiveElements();return!r||Lr(this.nodeContext.viewNode)||!r.isEnableToUpdateState()?!0:!(n&&!t||t&&t.overflow)}nextCandidate(t){let n=this.getRepetitiveElements();return n&&n.isEnableToUpdateState()?(n.updateState(),!0):!1}postLayout(t,n,i,r){let o=this.getRepetitiveElements();o&&t&&r.stopAtOverflow&&(n==null||o.isAfterLastContent(n))&&o.preventSkippingFooter()}finishBreak(t,n){let i=this.nodeContext.formattingContext,r=this.getRepetitiveElements();if(!r)return R(!0);let o=this.nodeContext;return hN(i,o,n).thenAsync(()=>cN(i,o,n).thenAsync(()=>(r.prepareLayoutFragment(),R(!0))))}getRepetitiveElements(){return this.nodeContext.formattingContext.getRepetitiveElements()}equalsTo(t){return t instanceof U0?this.nodeContext.formattingContext===t.nodeContext.formattingContext:!1}getPriorityOfFinishBreak(){return 10}},sN=class extends op{constructor(e,t){super(),this.formattingContext=e,this.processor=t}resolveLayoutMode(e){let t=this.formattingContext.getRepetitiveElements();return!e.belongsTo(this.formattingContext)&&!t.doneInitialLayout?new rN(this.formattingContext,this.processor):(!e.belongsTo(this.formattingContext)&&!e.after&&t&&t.preventSkippingHeader(),new oN(this.formattingContext,this.processor))}},lN=class extends es{constructor(e,t){super(),this.formattingContext=e,this.column=t}startNonInlineElementNode(e){let t=this.formattingContext,n=e.nodeContext,i=t.getRepetitiveElements();if(n.parent&&t.rootSourceNode===n.parent.sourceNode){switch(n.repeatOnBreak){case"header":if(i.isHeaderRegistered())n.repeatOnBreak="none";else return i.setHeaderNodeContext(n),R(!0);break;case"footer":if(i.isFooterRegistered())n.repeatOnBreak="none";else return i.setFooterNodeContext(n),R(!0);break}i.firstContentSourceNode||(i.firstContentSourceNode=n.sourceNode)}return es.prototype.startNonInlineElementNode.call(this,e)}afterNonInlineElementNode(e){let t=this.formattingContext,n=e.nodeContext;return n.sourceNode===t.rootSourceNode&&(t.getRepetitiveElements().lastContentSourceNode=e.lastAfterNodeContext&&e.lastAfterNodeContext.sourceNode,e.break=!0),n.repeatOnBreak==="header"||n.repeatOnBreak==="footer"?R(!0):es.prototype.afterNonInlineElementNode.call(this,e)}},aN=class extends Or{layout(e,t,n){if(t.isFloatNodeContext(e))return t.layoutFloatOrFootnote(e);let i=e.formattingContext;return i.getRootViewNode(e)?(n&&H0(e.parent,t),e.belongsTo(i)?Or.prototype.layout.call(this,e,t,n):new sN(i,this).layout(e,t)):t.buildDeepElementView(e)}startNonInlineElementNode(e){let t=dN(e).getRepetitiveElements();return t&&!t.allowInsertRepeatitiveElements&&(t.isHeaderSourceNode(e.sourceNode)||t.isFooterSourceNode(e.sourceNode))&&e.viewNode.parentNode.removeChild(e.viewNode),!1}doInitialLayout(e,t){e.formattingContext;let n=X("BlockLayoutProcessor.doInitialLayout");return this.layoutEntireBlock(e,t).thenFinish(n),n.result()}layoutEntireBlock(e,t){let n=e.formattingContext,i=new lN(n,t);return new gc(i,t.layoutContext).iterate(e)}doLayout(e,t){let n=e.formattingContext,i=X("doLayout"),r=t.layoutContext.nextInTree(e,!1);return $0(r,t).then(o=>{let s=o;i.loopWithFrame(l=>{for(;s;){let a=!0;if(t.layoutNext(s,!1).then(u=>{s=u,t.pageFloatLayoutContext.isInvalidated()||t.pageBreakType||s&&t.stopByOverflow(s)||s&&s.after&&s.sourceNode==n.rootSourceNode?l.breakLoop():a?a=!1:l.continueLoop()}),a){a=!1;return}}l.breakLoop()}).then(()=>{i.finish(s)})}),i.result()}finishBreak(e,t,n,i){return Or.prototype.finishBreak.call(this,e,t,n,i)}clearOverflownViewNodes(e,t,n,i){Or.prototype.clearOverflownViewNodes(e,t,n,i)}};function uN(e,t){for(let n=e;n;n=n.parent){let i=n.formattingContext;i&&i instanceof ro&&!n.belongsTo(i)&&t(i,n)}}function H0(e,t){e&&uN(e.after?e.parent:e,(n,i)=>{Li.isInstanceOfTableFormattingContext(n)||t.fragmentLayoutConstraints.push(new pp(i))})}function hN(e,t,n){let i=e.getRepetitiveElements();if(i){let r=e.getRootNodeContext(t);if(r.viewNode){let o=r.viewNode.firstChild;return i.appendHeaderToFragment(r,o,n)}}return R(!0)}function cN(e,t,n){let i=e.getRepetitiveElements();if(i&&!i.isSkipFooter){let r=e.getRootNodeContext(t);if(r.viewNode)return i.appendFooterToFragment(r,null,n)}return R(!0)}function dN(e){let t=e.formattingContext;return!t||!(t instanceof ro)?null:t}var pN=new aN;wn("RESOLVE_LAYOUT_PROCESSOR",e=>e instanceof ro&&!Li.isInstanceOfTableFormattingContext(e)?pN:null);var W0=class{constructor(e,t){this.rowIndex=e,this.sourceNode=t,d(this,"cells",[])}addCell(e){this.cells.push(e)}getMinimumHeight(){return Math.min.apply(null,this.cells.map(e=>e.height))}},fN=class{constructor(e,t,n){this.rowIndex=e,this.columnIndex=t,d(this,"viewElement"),d(this,"colSpan"),d(this,"rowSpan"),d(this,"height",0),d(this,"anchorSlot",null),this.viewElement=n,this.colSpan=n.colSpan||1,this.rowSpan=n.rowSpan||1}setHeight(e){this.height=e}setAnchorSlot(e){this.anchorSlot=e}},gN=class{constructor(e,t,n){this.rowIndex=e,this.columnIndex=t,this.cell=n}},mN=class{constructor(e,t,n){this.column=e,this.cellNodeContext=n,d(this,"pseudoColumn"),d(this,"empty",!1),this.pseudoColumn=new dp(e,t,n)}findAcceptableBreakPosition(){let e=this.cellNodeContext.viewNode,{verticalAlign:t,alignContent:n}=e.style;t!=="top"&&t!=="baseline"&&O(e,"vertical-align","top"),n&&n!=="normal"&&O(e,"align-content","normal");let i=this.pseudoColumn.findAcceptableBreakPosition(!0);return O(e,"vertical-align",t),n&&n!=="normal"&&O(e,"align-content",n),i}},vN=class{constructor(e,t){this.viewNode=e,this.side=t}},wN=class extends Qs{constructor(e,t,n,i){super(e,t,n,i),d(this,"formattingContext"),d(this,"acceptableCellBreakPositions",null),d(this,"rowIndex",null),this.formattingContext=e.formattingContext}findAcceptableBreak(e,t){let n=super.findAcceptableBreak(e,t);return t<this.getMinBreakPenalty()?null:this.getAcceptableCellBreakPositions().every(i=>!!i.nodeContext)?n:null}getMinBreakPenalty(){let e=super.getMinBreakPenalty();this.getAcceptableCellBreakPositions().forEach(n=>{e+=n.breakPosition.getMinBreakPenalty()});let t=this.getCellFragments();return e+=Math.max(0,...t.map(n=>n.cellNodeContext.breakPenalty)),e}getAcceptableCellBreakPositions(){if(!this.acceptableCellBreakPositions){this.formattingContext;let e=this.getCellFragments();this.acceptableCellBreakPositions=e.map(t=>t.findAcceptableBreakPosition())}return this.acceptableCellBreakPositions}getRowIndex(){return this.rowIndex!=null?this.rowIndex:this.rowIndex=this.formattingContext.findRowIndexBySourceNode(this.position.sourceNode)}getCellFragments(){return this.formattingContext.getRowSpanningCellsOverflowingTheRow(this.getRowIndex()).map(this.formattingContext.getCellFragmentOfCell,this.formattingContext)}},yN=class extends np{constructor(e,t,n){super(),this.rowIndex=e,this.beforeNodeContext=t,this.formattingContext=n,d(this,"acceptableCellBreakPositions",null)}findAcceptableBreak(e,t){if(this!==e.breakPositions[0]&&t<this.getMinBreakPenalty())return null;let n=this.getCellFragments(),i=this.getAcceptableCellBreakPositions(),r=i.every(o=>!!o.nodeContext)&&i.some((o,s)=>{let l=n[s].pseudoColumn,a=o.nodeContext;return!l.isStartNodeContext(a)&&!l.isLastAfterNodeContext(a)});return this.beforeNodeContext.overflow=i.some(o=>o.nodeContext&&o.nodeContext.overflow),r?this.beforeNodeContext:null}getMinBreakPenalty(){this.formattingContext.getRowByIndex(this.rowIndex);let e=this.beforeNodeContext.breakPenalty,t=this.getAcceptableCellBreakPositions(),n=this.getCellFragments();e+=Math.max(0,...n.map(r=>r.cellNodeContext.breakPenalty));let i=t.some((r,o)=>r.breakPosition instanceof Wl&&n[o].cellNodeContext.sourceNode.rowSpan>1);return t.forEach((r,o)=>{let s=r.breakPosition.getMinBreakPenalty();i&&r.breakPosition instanceof Qs&&r.breakPosition.overflows&&s>=3&&(n[o].column.checkOverflowAndSaveEdge(r.nodeContext,null)||(s-=3)),e+=s}),e}getAcceptableCellBreakPositions(){if(!this.acceptableCellBreakPositions){let e=this.getCellFragments();this.acceptableCellBreakPositions=e.map(t=>t.findAcceptableBreakPosition())}return this.acceptableCellBreakPositions}getCellFragments(){return this.formattingContext.getCellsFallingOnRow(this.rowIndex).map(this.formattingContext.getCellFragmentOfCell,this.formattingContext)}},rs=class extends ro{constructor(e,t){super(e,t),this.tableSourceNode=t,d(this,"formattingContextType","Table"),d(this,"vertical",!1),d(this,"columnCount",-1),d(this,"tableWidth",0),d(this,"captions",[]),d(this,"colGroups",null),d(this,"colWidths",null),d(this,"inlineBorderSpacing",0),d(this,"rows",[]),d(this,"slots",[]),d(this,"cellFragments",[]),d(this,"lastRowViewNode",null),d(this,"cellBreakPositions",[]),d(this,"repetitiveElements",null)}getName(){return"Table formatting context (Table.TableFormattingContext)"}isFirstTime(e,t){if(!t)return t;switch(e.display){case"table-row":return this.cellBreakPositions.length===0;case"table-cell":return!this.cellBreakPositions.some(n=>n.cellNodePosition.steps[0].node===e.sourceNode);default:return t}}getParent(){return this.parent}finishFragment(){this.cellFragments=[]}addRow(e,t){this.rows[e]=t}getRowSlots(e){let t=this.slots[e];return t||(t=this.slots[e]=[]),t}addCell(e,t){let n=this.rows[e];n||(this.addRow(e,new W0(e,null)),n=this.rows[e]),n.addCell(t);let i=e+t.rowSpan,r=this.getRowSlots(e),o=0;for(;r[o];)o++;for(;e<i;e++){r=this.getRowSlots(e);for(let s=o;s<o+t.colSpan;s++){let l=r[s]=new gN(e,s,t);t.anchorSlot||t.setAnchorSlot(l)}}}getRowByIndex(e){return this.rows[e]}findRowIndexBySourceNode(e){return this.rows.findIndex(t=>e===t.sourceNode)}addCellFragment(e,t,n){let i=this.cellFragments[e];i||(i=this.cellFragments[e]=[]),i[t]=n}getCellsFallingOnRow(e){return this.getRowSlots(e).reduce((t,n)=>n.cell!==t[t.length-1]?t.concat(n.cell):t,[])}getRowSpanningCellsOverflowingTheRow(e){return this.getCellsFallingOnRow(e).filter(t=>t.rowIndex+t.rowSpan-1>e)}getCellFragmentOfCell(e){return this.cellFragments[e.rowIndex]&&this.cellFragments[e.rowIndex][e.columnIndex]}getColumnCount(){return this.columnCount<0&&(this.columnCount=Math.max.apply(null,this.rows.map(e=>e.cells.reduce((t,n)=>t+n.colSpan,0)))),this.columnCount}updateCellSizes(e){this.rows.forEach(t=>{t.cells.forEach(n=>{let i=e.getElementClientRect(n.viewElement);n.viewElement=null,n.setHeight(this.vertical?i.width:i.height)})})}findCellFromColumn(e){if(!e)return null;let t=null,n=0,i=0;e:for(n=0;n<this.cellFragments.length;n++)if(this.cellFragments[n]){for(i=0;i<this.cellFragments[n].length;i++)if(this.cellFragments[n][i]&&e===this.cellFragments[n][i].pseudoColumn.getColumn()){t=this.rows[n].cells[i];break e}}if(!t)return null;for(;n<this.slots.length;n++)for(;i<this.slots[n].length;i++){let r=this.slots[n][i];if(r.cell===t)return{rowIndex:r.rowIndex,columnIndex:r.columnIndex}}return null}collectElementsOffsetOfUpperCells(e){let t=[];return this.slots.reduce((n,i,r)=>{if(r>=e.rowIndex)return n;let o=i[e.columnIndex]&&this.getCellFragmentOfCell(i[e.columnIndex].cell);return!o||t.includes(o)||(this.collectElementsOffsetFromColumn(o.pseudoColumn.getColumn(),n),t.push(o)),n},[])}collectElementsOffsetOfHighestColumn(){let e=[];return this.rows.forEach(t=>{t.cells.forEach((n,i)=>{e[i]||(e[i]={collected:[],elements:[]});let r=e[i],o=this.getCellFragmentOfCell(n);!o||r.collected.includes(o)||(this.collectElementsOffsetFromColumn(o.pseudoColumn.getColumn(),r.elements),r.collected.push(o))})}),[new xN(e.map(t=>t.elements))]}collectElementsOffsetFromColumn(e,t){e.fragmentLayoutConstraints.forEach(n=>{if(Ji.isInstanceOfRepetitiveElementsOwnerLayoutConstraint(n)){let i=n.getRepetitiveElements();t.push(i)}Li.isInstanceOfTableRowLayoutConstraint(n)&&n.getElementsOffsetsForTableCell(null).forEach(i=>{t.push(i)})})}saveState(){return[].concat(this.cellBreakPositions)}restoreState(e){this.cellBreakPositions=e}},xN=class{constructor(e){this.repeatitiveElementsInColumns=e}calculateOffset(e){return this.calculateMaxOffsetOfColumn(e,t=>t.current)}calculateMinimumOffset(e){return this.calculateMaxOffsetOfColumn(e,t=>t.minimum)}calculateMaxOffsetOfColumn(e,t){let n=0;return this.repeatitiveElementsInColumns.forEach(i=>{let r=jr(e,i);n=Math.max(n,t(r))}),n}};function bN(e){return e==="table-row-group"||e==="table-header-group"||e==="table-footer-group"}function SN(e){return e==="table"||e==="inline-table"}function Ug(e){return bN(e)||SN(e)}function j0(e,t,n){let i=e.nodeContext,r=i.display,o=i.parent?i.parent.display:null,s=!1;if(o==="inline-table"&&!(i.formattingContext instanceof rs)){for(let l=i.parent;l;l=l.parent)if(l.formattingContext instanceof rs){s=l.formattingContext===t;break}}return s||r==="table-row"&&!Ug(o)||r==="table-cell"&&o!=="table-row"&&!Ug(o)||i.formattingContext instanceof rs&&i.formattingContext!==t?n.buildDeepElementView(i).thenAsync(l=>(e.nodeContext=l,R(!0))):null}var CN=class extends es{constructor(e,t){super(),this.formattingContext=e,this.column=t,d(this,"rowIndex",-1),d(this,"columnIndex",0),d(this,"inRow",!1),d(this,"checkPoints",[]),d(this,"inHeaderOrFooter",!1)}startNonInlineElementNode(e){let t=this.formattingContext,n=j0(e,t,this.column);if(n)return n;this.postLayoutBlockContents(e);let i=e.nodeContext,r=i.display,o=t.getRepetitiveElements();switch(r){case"table":t.inlineBorderSpacing=i.inlineBorderSpacing;break;case"table-caption":{let s=new vN(i.viewNode,i.captionSide);t.captions.push(s);break}case"table-header-group":return o.isHeaderRegistered()||(this.inHeaderOrFooter=!0,o.setHeaderNodeContext(i)),R(!0);case"table-footer-group":return o.isFooterRegistered()||(this.inHeaderOrFooter=!0,o.setFooterNodeContext(i)),R(!0);case"table-row":this.inHeaderOrFooter||(this.inRow=!0,this.rowIndex++,i.sourceNode,this.columnIndex=0,t.addRow(this.rowIndex,new W0(this.rowIndex,i.sourceNode)),o.firstContentSourceNode||(o.firstContentSourceNode=i.sourceNode));break}return super.startNonInlineElementNode(e)}afterNonInlineElementNode(e){let t=this.formattingContext,n=e.nodeContext,i=n.display,r=this.column.clientLayout;if(this.postLayoutBlockContents(e),n.sourceNode===t.tableSourceNode){let o=r.getElementComputedStyle(t.getRootViewNode(n));t.tableWidth=parseFloat(o[t.vertical?"height":"width"]),t.getRepetitiveElements().lastContentSourceNode=e.lastAfterNodeContext&&e.lastAfterNodeContext.sourceNode,e.break=!0}else switch(i){case"table-header-group":case"table-footer-group":if(this.inHeaderOrFooter)return this.inHeaderOrFooter=!1,R(!0);break;case"table-row":this.inHeaderOrFooter||(t.lastRowViewNode=n.viewNode,this.inRow=!1);break;case"table-cell":if(!this.inHeaderOrFooter){this.inRow||(this.rowIndex++,this.columnIndex=0,this.inRow=!0);let o=n.viewNode;t.addCell(this.rowIndex,new fN(this.rowIndex,this.columnIndex,o)),this.columnIndex++}break}return super.afterNonInlineElementNode(e)}startNonElementNode(e){this.registerCheckPoint(e)}afterNonElementNode(e){this.registerCheckPoint(e)}startInlineElementNode(e){this.registerCheckPoint(e)}afterInlineElementNode(e){this.registerCheckPoint(e)}registerCheckPoint(e){let t=e.nodeContext;t&&t.viewNode&&!Fr(t)&&this.checkPoints.push(t.clone())}postLayoutBlockContents(e){this.checkPoints.length>0&&this.column.postLayoutBlock(e.nodeContext,this.checkPoints),this.checkPoints=[]}},G0=class X0 extends es{constructor(t,n){super(!0),this.formattingContext=t,this.column=n,d(this,"inRow",!1),d(this,"currentRowIndex",-1),d(this,"currentColumnIndex",0),d(this,"originalStopAtOverflow"),d(this,"inHeader"),d(this,"inFooter"),this.originalStopAtOverflow=n.stopAtOverflow,n.stopAtOverflow=!1}resetColumn(){this.column.stopAtOverflow=this.originalStopAtOverflow}getColSpanningCellWidth(t){let n=this.formattingContext.colWidths,i=0;for(let r=0;r<t.colSpan;r++)i+=n[t.anchorSlot.columnIndex+r];return i+=this.formattingContext.inlineBorderSpacing*(t.colSpan-1),i}layoutCell(t,n,i){let r=t.rowIndex,o=t.columnIndex,s=t.colSpan,l=n.viewNode;n.verticalAlign,s>1&&(O(l,"box-sizing","border-box"),O(l,this.formattingContext.vertical?"height":"width",`${this.getColSpanningCellWidth(t)}px`));let a=l.ownerDocument.createElement("div");l.appendChild(a);let u=new mN(this.column,a,n);return this.formattingContext.addCellFragment(r,o,u),i.primary.steps.length===1&&i.primary.after&&(u.empty=!0),u.pseudoColumn.layout(i,!0).thenReturn(!0)}hasBrokenCellAtSlot(t){let n=this.formattingContext.cellBreakPositions[0];return n?n.cell.anchorSlot.columnIndex===t:!1}extractRowSpanningCellBreakPositions(){let t=this.formattingContext.cellBreakPositions;if(t.length===0)return[];let n=[],i=0;do{let r=t[i],o=r.cell.rowIndex;if(o<this.currentRowIndex){let s=n[o];s||(s=n[o]=[]),s.push(r),t.splice(i,1)}else i++}while(i<t.length);return n}layoutRowSpanningCellsFromPreviousFragment(t){let n=this.formattingContext,i=this.extractRowSpanningCellBreakPositions(),r=i.reduce(p=>p+1,0);if(r===0)return R(!0);let o=this.column.layoutContext,s=t.nodeContext;s.viewNode.parentNode.removeChild(s.viewNode);let l=X("layoutRowSpanningCellsFromPreviousFragment"),a=R(!0),u=0,h=[];return i.forEach(p=>{a=a.thenAsync(()=>{let c=Na(p[0].cellNodePosition.steps[1],s.parent);return o.setCurrent(c,!1).thenAsync(()=>{let f=R(!0),v=0;function w(x){for(;v<x;){if(!h.includes(v)){let g=c.viewNode.ownerDocument.createElement("td");O(g,"padding","0"),c.viewNode.appendChild(g)}v++}}return p.forEach(x=>{f=f.thenAsync(()=>{let g=x.cell;w(g.anchorSlot.columnIndex);let m=x.cellNodePosition,y=Na(m.steps[0],c);return y.offsetInNode=m.offsetInNode,y.after=m.after,y.fragmentIndex=m.steps[0].fragmentIndex+1,o.setCurrent(y,!1).thenAsync(()=>{let C=x.breakChunkPosition;for(let P=0;P<g.colSpan;P++)h.push(v+P);return v+=g.colSpan,this.layoutCell(g,y,C).thenAsync(()=>(y.viewNode.rowSpan=g.rowIndex+g.rowSpan-this.currentRowIndex+r-u,R(!0)))})})}),f.thenAsync(()=>(w(n.getColumnCount()),u++,R(!0)))})})}),a.then(()=>{o.setCurrent(s,!0,t.atUnforcedBreak).then(()=>{l.finish(!0)})}),l.result()}startTableRow(t){if(this.inHeader||this.inFooter)return R(!0);let n=t.nodeContext,i=this.formattingContext;return this.currentRowIndex<0?(n.sourceNode,this.currentRowIndex=i.findRowIndexBySourceNode(n.sourceNode)):this.currentRowIndex++,this.currentColumnIndex=0,this.inRow=!0,this.layoutRowSpanningCellsFromPreviousFragment(t).thenAsync(()=>(this.registerCellFragmentIndex(),this.column.checkOverflowAndSaveEdgeAndBreakPosition(t.lastAfterNodeContext,null,!0,t.breakAtTheEdge)&&i.getRowSpanningCellsOverflowingTheRow(this.currentRowIndex-1).length===0&&(this.resetColumn(),n.overflow=!0,t.break=!0),R(!0)))}registerCellFragmentIndex(){this.formattingContext.getRowByIndex(this.currentRowIndex).cells.forEach(t=>{let n=this.formattingContext.cellBreakPositions[t.columnIndex];if(n&&n.cell.anchorSlot.columnIndex==t.anchorSlot.columnIndex){let i=n.cellNodePosition.steps[0],r=this.column.layoutContext.xmldoc.getElementOffset(i.node);XP(r,i.fragmentIndex+1,1)}})}startTableCell(t){if(this.inHeader||this.inFooter)return R(!0);let n=t.nodeContext;this.inRow||(this.currentRowIndex<0?this.currentRowIndex=0:this.currentRowIndex++,this.currentColumnIndex=0,this.inRow=!0);let i=this.formattingContext.getRowByIndex(this.currentRowIndex).cells[this.currentColumnIndex];if(!i)return t.break=!0,R(!0);let r=n.copy().modify();r.after=!0,t.nodeContext=r;let o=X("startTableCell"),s;if(this.hasBrokenCellAtSlot(i.anchorSlot.columnIndex)){let l=this.formattingContext.cellBreakPositions.shift();n.fragmentIndex=l.cellNodePosition.steps[0].fragmentIndex+1,s=R(l.breakChunkPosition)}else s=this.column.nextInTree(n,t.atUnforcedBreak).thenAsync(l=>{l.viewNode&&n.viewNode.removeChild(l.viewNode);let a=Pa(l,0);return R(new Oi(a))});return s.then(l=>{this.layoutCell(i,n,l).then(()=>{this.afterNonInlineElementNode(t),this.currentColumnIndex++,o.finish(!0)})}),o.result()}startNonInlineBox(t){let n=j0(t,this.formattingContext,this.column);if(n)return n;let i=t.nodeContext,r=this.formattingContext.getRepetitiveElements(),o=i.display;return o==="table-header-group"&&r&&r.isHeaderSourceNode(i.sourceNode)?(this.inHeader=!0,R(!0)):o==="table-footer-group"&&r&&r.isFooterSourceNode(i.sourceNode)?(this.inFooter=!0,R(!0)):o==="table-row"?this.startTableRow(t):o==="table-cell"?this.startTableCell(t):R(!0)}endNonInlineBox(t){let n=t.nodeContext;if(n.display==="table-row"&&(this.inRow=!1,!this.inHeader&&!this.inFooter)){let i=n.copy().modify();i.after=!1;let r=new yN(this.currentRowIndex,i,this.formattingContext);this.column.breakPositions.push(r)}return R(!0)}afterNonInlineElementNode(t){let n=t.nodeContext,i=this.formattingContext.getRepetitiveElements(),r=n.display;if(r==="table-header-group"?i&&!i.allowInsertRepeatitiveElements&&i.isHeaderSourceNode(n.sourceNode)?(this.inHeader=!1,n.viewNode.parentNode.removeChild(n.viewNode)):O(n.viewNode,"display","table-row-group"):r==="table-footer-group"&&(i&&!i.allowInsertRepeatitiveElements&&i.isFooterSourceNode(n.sourceNode)?(this.inFooter=!1,n.viewNode.parentNode.removeChild(n.viewNode)):O(n.viewNode,"display","table-row-group")),r&&X0.ignoreList[r])n.viewNode.parentNode.removeChild(n.viewNode);else if(n.sourceNode===this.formattingContext.tableSourceNode)n.overflow=this.column.checkOverflowAndSaveEdge(n,null),this.resetColumn(),t.break=!0;else return super.afterNonInlineElementNode(t);return R(!0)}};d(G0,"ignoreList",{"table-caption":!0,"table-column-group":!0,"table-column":!0});var kN=G0,Fs=[];function EN(e){let t=Fs.findIndex(i=>i.root===e),n=Fs[t];return n?n.tableLayoutOption:null}function PN(e){let t=Fs.findIndex(n=>n.root===e);t>=0&&Fs.splice(t,1)}var Y0=class{layoutEntireTable(e,t){let n=e.formattingContext,i=new CN(n,t);return new gc(i,t.layoutContext).iterate(e)}getColumnWidths(e,t,n,i){let r=e.ownerDocument,o=r.createElement("tr"),s=[];for(let a=0;a<t;a++){let u=r.createElement("td");o.appendChild(u),s.push(u)}e.parentNode.insertBefore(o,e.nextSibling);let l=s.map(a=>{let u=i.getElementClientRect(a),h=n?u.height:u.width;return Math.ceil(h)});return e.parentNode.removeChild(o),l}getColGroupElements(e){let t=[],n=e.firstElementChild;for(;n;)n.localName==="colgroup"&&t.push(n),n=n.nextElementSibling;return t}normalizeAndGetColElements(e){let t=[];return e.forEach(n=>{let i=n.span;n.removeAttribute("span");let r=n.firstElementChild;for(;r;){if(r.localName==="col"){let o=r.span;for(r.removeAttribute("span"),i-=o;o-- >1;){let s=r.cloneNode(!0);n.insertBefore(s,r),t.push(s)}t.push(r)}r=r.nextElementSibling}for(;i-- >0;)r=n.ownerDocument.createElement("col"),n.appendChild(r),t.push(r)}),t}addMissingColElements(e,t,n,i){if(e.length<n){let r=i.ownerDocument.createElement("colgroup");t.push(r);for(let o=e.length;o<n;o++){let s=i.ownerDocument.createElement("col");r.appendChild(s),e.push(s)}}}normalizeColGroups(e,t,n){let i=e.vertical,r=e.lastRowViewNode;if(!r)return;e.lastRowViewNode=null;let o=r.ownerDocument.createDocumentFragment(),s=e.getColumnCount();if(!(s>0)){e.colGroups=o;return}let l=e.colWidths=this.getColumnWidths(r,s,i,n.clientLayout),a=this.getColGroupElements(t),u=this.normalizeAndGetColElements(a);this.addMissingColElements(u,a,s,t),u.forEach((h,p)=>{O(h,i?"height":"width",`${l[p]}px`)}),a.forEach(h=>{o.appendChild(h.cloneNode(!0))}),e.colGroups=o}doInitialLayout(e,t){let n=e.formattingContext;n.vertical=e.vertical,n.initializeRepetitiveElements(e.vertical),e.sourceNode;let i=EN(e.sourceNode);PN(e.sourceNode);let r=X("TableLayoutProcessor.doInitialLayout"),o=e.copy();return this.layoutEntireTable(e,t).then(s=>{let l=s.viewNode,a=t.clientLayout.getElementClientRect(l),u=t.vertical?a.left:a.bottom;if(u+=(t.vertical?-1:1)*jr(e,t.collectElementsOffset()).current,!t.isOverflown(u)&&(!i||!i.calculateBreakPositionsInside)){t.breakPositions.push(new RN(o)),r.finish(s);return}this.normalizeColGroups(n,l,t),n.updateCellSizes(t.clientLayout),r.finish(null)}),r.result()}addCaptions(e,t,n){let i=e.captions;i.forEach((r,o)=>{r&&(t.insertBefore(r.viewNode,n),r.side==="top"&&(i[o]=null))})}addColGroups(e,t,n){e.colGroups&&this.getColGroupElements(t).length===0&&(t.insertBefore(e.colGroups.cloneNode(!0),n),O(t,"table-layout","fixed"),O(t,e.vertical?"height":"width",`${e.tableWidth}px`))}removeColGroups(e,t){if(e.colGroups&&t){let n=this.getColGroupElements(t);n&&n.forEach(i=>{t.removeChild(i)})}}doLayout(e,t){let n=e.formattingContext,i=n.getRootViewNode(e),r=i.firstChild;this.addCaptions(n,i,r),this.addColGroups(n,i,r);let o=new kN(n,t),s=new gc(o,t.layoutContext),l=X("TableFormattingContext.doLayout");return s.iterate(e).thenFinish(l),l.result()}layout(e,t,n){let i=e.formattingContext;return i.getRootViewNode(e)?(n&&H0(e.parent,t),new TN(i,this).layout(e,t)):t.buildDeepElementView(e)}createEdgeBreakPosition(e,t,n,i){return new wN(e,t,n,i)}startNonInlineElementNode(e){return!1}afterNonInlineElementNode(e,t){return Ku(e),!1}finishBreak(e,t,n,i){let r=t.formattingContext;if(t.display==="table-row"){t.sourceNode;let o=r.findRowIndexBySourceNode(t.sourceNode);r.cellBreakPositions=[];let s;if(t.after?s=r.getRowSpanningCellsOverflowingTheRow(o):s=r.getCellsFallingOnRow(o),s.length){let l=X("TableLayoutProcessor.finishBreak"),a=0;return l.loopWithFrame(u=>{if(a===s.length){u.breakLoop();return}let h=s[a++],p=r.getCellFragmentOfCell(h),c=p.findAcceptableBreakPosition().nodeContext,f=p.cellNodeContext,v=f.toNodePosition(),w=new Oi(c.toNodePosition());r.cellBreakPositions.push({cellNodePosition:v,breakChunkPosition:w,cell:h});let x=f.viewNode;p.column.layoutContext.processFragmentedBlockEdge(p.cellNodeContext),o<h.rowIndex+h.rowSpan-1&&(x.rowSpan=o-h.rowIndex+1),p.empty?u.continueLoop():p.pseudoColumn.finishBreak(c,!1,!0).then(()=>{NN(p,r,c),u.continueLoop()})}).then(()=>{e.clearOverflownViewNodes(t,!1),e.layoutContext.processFragmentedBlockEdge(t),Ku(t),r.finishFragment(),l.finish(!0)}),l.result()}}return Ku(t),r.finishFragment(),rp.finishBreak(e,t,n,i)}clearOverflownViewNodes(e,t,n,i){Or.prototype.clearOverflownViewNodes(e,t,n,i)}};function NN(e,t,n){let i=t.getRepetitiveElements();if(!i||!(i.isHeaderRegistered()||i.isFooterRegistered()))return;let r=t.vertical,o=e.column,s=e.pseudoColumn.getColumnElement(),l=e.cellNodeContext.viewNode,a=o.clientLayout.getElementClientRect(l),u=o.getComputedPaddingBorder(l);if(r){let h=a.right-o.footnoteEdge-i.calculateOffset(n)-u.right;O(s,"max-width",`${h}px`)}else{let h=o.footnoteEdge-i.calculateOffset(n)-a.top-u.top;O(s,"max-height",`${h}px`)}}function Ku(e){let t=e.display==="table-row"?e.viewNode.parentElement:e.display==="table"?e.viewNode.querySelector("tbody"):null;if(!t)return;let n;try{n=t.querySelectorAll(":scope>tr:has(>:empty):not(:has(>:not([rowspan]:not([rowspan='1']),:empty)))")}catch{return}if(n.length===0)return;let i=Array.from(n).reduce((p,c)=>{let f=c.getBoundingClientRect(),v=e.vertical?f.width:f.height;return p+v},0),r=n[n.length-1],o=Array.from(t.children).indexOf(r),s=Array.from(r.children).reduce((p,c)=>{let f=c.rowSpan;return f>1&&o+f<t.childElementCount?Math.max(p,f):p},0),l=s?t.children[o+s-1]:t.lastElementChild;if(l!=t.lastElementChild&&l.querySelector(":scope>*>div>div")){for(let p=l;p&&p!==t.lastElementChild;p=p.nextElementSibling)if(p.querySelector(":scope>[rowspan]:not([rowspan='1'])")){l=p;break}}let a=l.getBoundingClientRect(),u=e.vertical?a.width:a.height,h=i+u;O(l,e.vertical?"width":"height",`${h}px`)}var TN=class extends op{constructor(e,t){super(),this.tableFormattingContext=e,this.processor=t}resolveLayoutMode(e){let t=this.tableFormattingContext.getRepetitiveElements();return!t||!t.doneInitialLayout?new IN(this.tableFormattingContext,this.processor):(e.sourceNode===this.tableFormattingContext.tableSourceNode&&!e.after&&t&&t.preventSkippingHeader(),new LN(this.tableFormattingContext,this.processor))}clearNodes(e){super.clearNodes(e);let t=this.tableFormattingContext.getRootViewNode(e);this.processor.removeColGroups(this.tableFormattingContext,t)}restoreState(e,t){super.restoreState(e,t),this.tableFormattingContext.finishFragment()}},IN=class extends D0{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return this.processor.doInitialLayout(e,t)}},RN=class extends Qs{constructor(e){super(e,null,e.overflow,0)}getMinBreakPenalty(){if(!this.isEdgeUpdated)throw new Error("EdgeBreakPosition.prototype.updateEdge not called");return(this.overflows?3:0)+(this.position.parent?this.position.parent.breakPenalty:0)}breakPositionChosen(e){e.fragmentLayoutConstraints.push(new AN(this.position.sourceNode))}},AN=class q0{constructor(t){this.tableRootNode=t,d(this,"flagmentLayoutConstraintType","EntireTable")}allowLayout(t,n,i){return t.overflow,!1}nextCandidate(t){return!0}postLayout(t,n,i,r){n.sourceNode,Fs.push({root:n.sourceNode,tableLayoutOption:{calculateBreakPositionsInside:!0}})}finishBreak(t,n){return R(!0)}equalsTo(t){return t instanceof q0&&t.tableRootNode===this.tableRootNode}getPriorityOfFinishBreak(){return 0}},LN=class extends V0{constructor(e,t){super(e),this.processor=t}doLayout(e,t){let n=this.formattingContext.getRepetitiveElements();if(n&&!n.isAfterLastContent(e)){let i=new FN(e);t.fragmentLayoutConstraints.some(r=>i.equalsTo(r))||t.fragmentLayoutConstraints.unshift(i)}return this.processor.doLayout(e,t)}},FN=class K0 extends pp{constructor(t){super(t),d(this,"flagmentLayoutConstraintType","TableRow"),d(this,"cellFragmentLayoutConstraints",[])}allowLayout(t,n,i){let r=this.getRepetitiveElements();return!r||i.pseudoParent||Lr(this.nodeContext.viewNode)||!r.isEnableToUpdateState()?!0:!(n&&!t||t&&t.overflow)}nextCandidate(t){let n=this.nodeContext.formattingContext;return this.collectCellFragmentLayoutConstraints(t,n).some(i=>i.constraints.some(r=>r.nextCandidate(t)))?!0:super.nextCandidate(t)}postLayout(t,n,i,r){let o=this.nodeContext.formattingContext;if(this.cellFragmentLayoutConstraints=this.collectCellFragmentLayoutConstraints(n,o),this.cellFragmentLayoutConstraints.forEach(s=>{s.constraints.forEach(l=>{l.postLayout(t,s.breakPosition,i,r)})}),!t){let s=o.getRootViewNode(this.nodeContext);new Y0().removeColGroups(o,s),this.removeDummyRowNodes(i)}super.postLayout(t,n,i,r)}finishBreak(t,n){this.nodeContext.formattingContext;let i=X("finishBreak"),r=this.cellFragmentLayoutConstraints.reduce((s,l)=>s.concat(l.constraints.map(a=>({constraint:a,breakPosition:l.breakPosition}))),[]),o=0;return i.loop(()=>{if(o<r.length){let s=r[o++];return s.constraint.finishBreak(s.breakPosition,n).thenReturn(!0)}else return R(!1)}).then(()=>{i.finish(!0)}),i.result().thenAsync(()=>super.finishBreak(t,n))}removeDummyRowNodes(t){if(!(!t||t.display!=="table-row"||!t.viewNode))for(;t.viewNode.previousElementSibling;){let n=t.viewNode.previousElementSibling;n.parentNode&&n.parentNode.removeChild(n)}}collectCellFragmentLayoutConstraints(t,n){return this.getCellFragemnts(t,n).map(i=>({constraints:i.fragment.pseudoColumn.getColumn().fragmentLayoutConstraints,breakPosition:i.breakPosition}))}getCellFragemnts(t,n){let i=Number.MAX_VALUE;t&&t.display==="table-row"&&(t.sourceNode,i=n.findRowIndexBySourceNode(t.sourceNode)+1),i=Math.min(n.cellFragments.length,i);let r=[];for(let o=0;o<i;o++)n.cellFragments[o]&&n.cellFragments[o].forEach(s=>{s&&r.push({fragment:s,breakPosition:s.findAcceptableBreakPosition().nodeContext})});return r}getElementsOffsetsForTableCell(t){let n=this.nodeContext.formattingContext,i=n.findCellFromColumn(t);return i?n.collectElementsOffsetOfUpperCells(i):n.collectElementsOffsetOfHighestColumn()}equalsTo(t){return t instanceof K0?this.nodeContext.formattingContext===t.nodeContext.formattingContext:!1}},ON=new Y0;function BN(e,t,n,i,r,o){if(!t)return null;if(n===S.table){let s=e.parent;return new rs(s?s.formattingContext:null,e.sourceNode)}return null}function _N(e){return e instanceof rs?ON:null}wn("RESOLVE_FORMATTING_CONTEXT",BN);wn("RESOLVE_LAYOUT_PROCESSOR",_N);function Hg(e){return e.reduce((t,n)=>t+n,0)/e.length}function MN(e){let t=Hg(e);return Hg(e.map(n=>{let i=n-t;return i*i}))}var zN=class{constructor(e,t){this.layoutResult=e,this.penalty=t}};function Os(e){return e.vertical?e.width:e.height}function Bs(e,t){e.vertical?e.width=t:e.height=t}var Q0=class{constructor(e,t,n){this.layoutContainer=e,this.columnGenerator=t,this.regionPageFloatLayoutContext=n,d(this,"originalContainerBlockSize"),this.originalContainerBlockSize=Os(e)}balanceColumns(e){let t=X("ColumnBalancer#balanceColumns");this.preBalance(e),this.savePageFloatLayoutContexts(e),this.layoutContainer.clear();let n=[this.createTrialResult(e)];return t.loopWithFrame(i=>{if(!this.hasNextCandidate(n)){i.breakLoop();return}this.updateCondition(n),this.columnGenerator().then(r=>{if(this.savePageFloatLayoutContexts(r),this.layoutContainer.clear(),!r){i.breakLoop();return}n.push(this.createTrialResult(r)),i.continueLoop()})}).then(()=>{let i=n.reduce((r,o)=>o.penalty<r.penalty?o:r,n[0]);this.restoreContents(i.layoutResult),this.postBalance(),t.finish(i.layoutResult)}),t.result()}createTrialResult(e){let t=this.calculatePenalty(e);return new zN(e,t)}preBalance(e){}postBalance(){Bs(this.layoutContainer,this.originalContainerBlockSize)}savePageFloatLayoutContexts(e){let t=this.regionPageFloatLayoutContext.detachChildren();e&&(e.columnPageFloatLayoutContexts=t)}restoreContents(e){let t=this.layoutContainer.element;e.columns.forEach(n=>{t.appendChild(n.element)}),e.columnPageFloatLayoutContexts,this.regionPageFloatLayoutContext.attachChildren(e.columnPageFloatLayoutContexts)}},Rc=1;function Z0(e){let t=e[e.length-1];if(t.penalty===0)return!1;let n=e[e.length-2];if(n&&t.penalty>=n.penalty)return!1;let i=t.layoutResult.columns,r=Math.max.apply(null,i.map(s=>s.computedBlockSize)),o=Math.max.apply(null,i.map(s=>s.getMaxBlockSizeOfPageFloats()));return r>o+Rc}function J0(e,t){var n;let i=e[e.length-1].layoutResult.columns,r=Math.max.apply(null,i.map(o=>isNaN(o.blockDistanceToBlockEndFloats)?o.computedBlockSize:o.computedBlockSize-o.blockDistanceToBlockEndFloats+Rc))-Rc;if(r<Os(t)?Bs(t,r):Bs(t,Os(t)-1),t.vertical){let o=parseFloat((n=t.element.style)==null?void 0:n.width);t.originX=o-t.width}}var $N=class extends Q0{constructor(e,t,n,i){super(n,e,t),this.columnCount=i,d(this,"originalPosition",null),d(this,"foundUpperBound",!1)}preBalance(e){let t=e.columns.reduce((n,i)=>n+i.computedBlockSize,0);Bs(this.layoutContainer,t/this.columnCount),this.originalPosition=e.position}checkPosition(e){return this.originalPosition?this.originalPosition.isSamePosition(e):e===null}calculatePenalty(e){if(!this.checkPosition(e.position))return 1/0;let t=e.columns;return Wg(t)?1/0:Math.max.apply(null,t.map(n=>n.computedBlockSize))}hasNextCandidate(e){if(e.length===1)return!0;if(this.foundUpperBound)return Z0(e);{let t=e[e.length-1];return this.checkPosition(t.layoutResult.position)&&!Wg(t.layoutResult.columns)?(this.foundUpperBound=!0,!0):Os(this.layoutContainer)<this.originalContainerBlockSize}}updateCondition(e){if(this.foundUpperBound)J0(e,this.layoutContainer);else{let t=Math.min(this.originalContainerBlockSize,Os(this.layoutContainer)+this.originalContainerBlockSize*.1);Bs(this.layoutContainer,t)}}};function Wg(e){if(e.length<=1)return!1;let t=e[e.length-1].computedBlockSize,n=e.slice(0,e.length-1),i=6;return n.every(r=>t>r.computedBlockSize+i)}var DN=class extends Q0{constructor(e,t,n){super(n,e,t)}calculatePenalty(e){if(e.columns.every(n=>n.computedBlockSize===0))return 1/0;let t=e.columns.filter(n=>!n.pageBreakType).map(n=>n.computedBlockSize);return MN(t)}hasNextCandidate(e){return Z0(e)}updateCondition(e){J0(e,this.layoutContainer)}};function VN(e,t,n,i,r,o,s){if(t===S.auto)return null;{let l=s.positions.length===0,a=o[o.length-1],u=!!(a&&a.pageBreakType);return l||u?new $N(n,i,r,e):t===S.balance_all?new DN(n,i,r):null}}var Qu=class{constructor(e,t,n){d(this,"endStuckFixed"),d(this,"endFixed"),d(this,"endSlipped"),this.endStuckFixed=e,this.endFixed=t,this.endSlipped=n}},UN=class{constructor(){d(this,"map",[])}getMaxFixed(){return this.map.length==0?0:this.map[this.map.length-1].endFixed}getMaxSlipped(){return this.map.length==0?0:this.map[this.map.length-1].endSlipped}addStuckRange(e){if(this.map.length==0)this.map.push(new Qu(e,e,e));else{let t=this.map[this.map.length-1],n=t.endSlipped+e-t.endFixed;t.endFixed==t.endStuckFixed?(t.endFixed=e,t.endStuckFixed=e,t.endSlipped=n):this.map.push(new Qu(e,e,n))}}addSlippedRange(e){this.map.length==0?this.map.push(new Qu(e,0,0)):this.map[this.map.length-1].endFixed=e}slippedByFixed(e){let t=Ai(this.map.length,i=>e<=this.map[i].endFixed),n=this.map[t];return n.endSlipped-Math.max(0,n.endStuckFixed-e)}fixedBySlipped(e){let t=Ai(this.map.length,i=>e<=this.map[i].endSlipped),n=this.map[t];return n.endStuckFixed-(n.endSlipped-e)}},HN=class Ac{constructor(t,n,i,r,o,s,l,a){if(this.context=t,this.style=n,this.offset=i,this.isRoot=r,this.flowChunk=o,this.atBlockStart=s,this.atFlowStart=l,this.isParentBoxDisplayed=a,d(this,"flowName"),d(this,"isBlockValue",null),d(this,"hasBoxValue",null),d(this,"styleValues",{}),d(this,"beforeBox",null),d(this,"afterBox",null),d(this,"breakBefore",null),this.flowName=o.flowName,this.hasBox()){let u=n._pseudos;if(u&&u.before){let h=new Ac(t,u.before,i,!1,o,this.isBlock(),l,!0),p=h.styleValue("content");Bi(p)&&(this.beforeBox=h,this.breakBefore=h.breakBefore)}}this.breakBefore=Bt(this.getBreakValue("before"),this.breakBefore),this.atFlowStart&&Dt(this.breakBefore)&&(o.breakBefore=Bt(o.breakBefore,this.breakBefore))}buildAfterPseudoElementBox(t,n,i){if(this.hasBox()){let r=this.style._pseudos;if(r&&r.after){let o=new Ac(this.context,r.after,t,!1,this.flowChunk,n,i,!0),s=o.styleValue("content");Bi(s)&&(this.afterBox=o)}}}styleValue(t,n){if(!(t in this.styleValues)){let i=this.style[t];this.styleValues[t]=i?i.evaluate(this.context,t):n||null}return this.styleValues[t]}displayValue(){return this.styleValue("display",S.inline)}isBlock(){if(this.isBlockValue===null){let t=this.displayValue(),n=this.styleValue("position"),i=this.styleValue("float");this.isBlockValue=a0(t,n,i,this.isRoot)}return this.isBlockValue}hasBox(){return this.hasBoxValue===null&&(this.hasBoxValue=this.isParentBoxDisplayed&&this.displayValue()!==S.none&&!pc(this.styleValue("position"))),this.hasBoxValue}getBreakValue(t){let n=null;if(this.isBlock()){let i=this.styleValue(`break-${t}`);i&&(n=i.toString())}return n}},WN=class{constructor(e){this.context=e,d(this,"stack",[]),d(this,"atBlockStart",!0),d(this,"atFlowStart",!0),d(this,"atStartStack",[])}empty(){return this.stack.length===0}lastBox(){return this.stack[this.stack.length-1]}lastFlowName(){let e=this.lastBox();return e?e.flowChunk.flowName:null}isCurrentBoxDisplayed(){return this.stack.every(e=>e.displayValue()!==S.none)}push(e,t,n,i){let r=this.lastBox();i&&r&&i.flowName!==r.flowName&&this.atStartStack.push({atBlockStart:this.atBlockStart,atFlowStart:this.atFlowStart});let o=i||r.flowChunk,s=this.atFlowStart||!!i,l=this.isCurrentBoxDisplayed(),a=new HN(this.context,e,t,n,o,s||this.atBlockStart,s,l);return this.stack.push(a),this.atBlockStart=a.hasBox()?!a.beforeBox&&a.isBlock():this.atBlockStart,this.atFlowStart=a.hasBox()?!a.beforeBox&&s:this.atFlowStart,a}encounteredTextNode(e){let t=this.lastBox();if((e.nodeType===Node.TEXT_NODE||e.nodeType===Node.CDATA_SECTION_NODE)&&(this.atBlockStart||this.atFlowStart)&&t.hasBox()){let n=t.styleValue("white-space",S.normal).toString(),i=Ky(n);i&&!vt(e,i)&&(this.atBlockStart=!1,this.atFlowStart=!1)}}pop(e){let t=this.stack.pop();if(t.buildAfterPseudoElementBox(e,this.atBlockStart,this.atFlowStart),this.atFlowStart&&t.afterBox){let i=t.afterBox.getBreakValue("before");t.flowChunk.breakBefore=Bt(t.flowChunk.breakBefore,i)}let n=this.lastBox();if(n)if(n.flowName===t.flowName)t.hasBox()&&(this.atBlockStart=this.atFlowStart=!1);else{let i=this.atStartStack.pop();this.atBlockStart=i.atBlockStart,this.atFlowStart=i.atFlowStart}return t}nearestBlockStartOffset(e){if(!e.atBlockStart)return e.offset;let t=this.stack.length-1,n=this.stack[t];for(n===e&&(t--,n=this.stack[t]);t>=0;){if(n.flowName!==e.flowName)return e.offset;if(!n.atBlockStart||n.isRoot)return n.offset;e=n,n=this.stack[--t]}throw new Error("No block start offset found!")}},jg=class{constructor(e,t,n,i,r,o,s,l){this.xmldoc=e,this.scope=n,this.context=i,this.primaryFlows=r,this.validatorSet=o,this.counterListener=s,d(this,"root"),d(this,"cascadeHolder"),d(this,"last"),d(this,"rootStyle",{}),d(this,"styleMap",{}),d(this,"flows",{}),d(this,"flowChunks",[]),d(this,"flowListener",null),d(this,"flowToReach",null),d(this,"idToReach",null),d(this,"cascade"),d(this,"offsetMap"),d(this,"primary",!0),d(this,"primaryStack",[]),d(this,"rootBackgroundAssigned",!1),d(this,"rootLayoutAssigned",!1),d(this,"lastOffset"),d(this,"breakBeforeValues",{}),d(this,"boxStack"),d(this,"bodyReached",!0),this.root=e.root,this.cascadeHolder=t,this.last=this.root,this.cascade=t.createInstance(i,s,l,e.lang),this.offsetMap=new UN;let a=e.getElementOffset(this.root);this.lastOffset=a,this.boxStack=new WN(i),this.offsetMap.addStuckRange(a);let u=this.getAttrStyle(this.root);switch(this.cascade.pushElement(this,this.root,u,a),this.postprocessTopStyle(u,!1),this.root.namespaceURI){case"http://www.w3.org/1999/xhtml":this.bodyReached=!1;break}this.primaryStack.push(!0),this.styleMap={},this.styleMap[`e${a}`]=u,this.lastOffset++,this.replayFlowElementsFromOffset(-1)}hasProp(e,t,n){let i=e[n];return i&&i.evaluate(this.context)!==t[n]}transferPropsToRoot(e,t){for(let n in t){let i=e[n];if(i)this.rootStyle[n]=i,delete e[n];else{let r=t[n];r&&(this.rootStyle[n]=new ke(r,_y))}}}postprocessTopStyle(e,t){var n;if(t)for(let i of["writing-mode","direction"])e[i]&&!(t&&this.rootStyle[i])&&(this.rootStyle[i]=e[i]);else for(let i in e)ts(i)&&(this.rootStyle[i]=e[i]);if(!this.rootBackgroundAssigned){let i=this.hasProp(e,this.validatorSet.backgroundProps,"background-color")?e["background-color"].evaluate(this.context):null,r=this.hasProp(e,this.validatorSet.backgroundProps,"background-image")?e["background-image"].evaluate(this.context):null;(i&&!Te(i)||r&&!Te(r))&&(this.transferPropsToRoot(e,this.validatorSet.backgroundProps),this.rootBackgroundAssigned=!0)}if(!this.rootLayoutAssigned){for(let i=0;i<Gg.length;i++)if(this.hasProp(e,this.validatorSet.layoutProps,Gg[i])){this.transferPropsToRoot(e,this.validatorSet.layoutProps),this.rootLayoutAssigned=!0;break}}if(!t){let i=e["font-size"],r=!0;if(i&&!Te(i.value)){let l=i.evaluate(this.context);if(l instanceof z){let a=l.num;switch(l.unit){case"em":case"rem":a*=this.context.initialFontSize;break;case"ex":a*=this.context.initialFontSize*$e.ex/$e.em;break;case"%":a*=this.context.initialFontSize/100;break;case"lh":case"rlh":a*=this.context.initialFontSize*$e.lh/$e.em;break;default:{let u=$e[l.unit];u&&(a*=u),r=!1}}this.context.rootFontSize=a,this.context.isRelativeRootFontSize=r}}let o=(n=this.context.rootFontSize)!=null?n:this.context.initialFontSize,s=e["line-height"];if(s&&!Te(s.value)){let l=s.evaluate(this.context);if(l instanceof $i)this.context.rootLineHeight=l.num*o;else if(l instanceof z){let a=l.num;switch(l.unit){case"em":case"rem":a*=o;break;case"ex":a*=o*$e.ex/$e.em;break;case"%":a*=o/100;break;case"lh":case"rlh":a*=this.context.initialFontSize*$e.lh/$e.em;break;default:{let u=$e[l.unit];u&&(a*=u)}}this.context.rootLineHeight=a}}else this.context.rootLineHeight=this.context.fontSize()*$e.lh/$e.em}}getTopContainerStyle(){let e=0;for(;!this.bodyReached&&(e+=5e3,this.styleUntil(e,0)!=Number.POSITIVE_INFINITY););return this.rootStyle}getAttrStyle(e){if(e.style instanceof CSSStyleDeclaration){let t=e.getAttribute("style");if(t)return $P(this.scope,this.validatorSet,this.xmldoc.url,t)}return{}}getReachedOffset(){return this.lastOffset}replayFlowElementsFromOffset(e){if(e>=this.lastOffset)return;let t=this.context,n=this.xmldoc.getElementOffset(this.root);if(e<n){let o=this.getStyle(this.root,!1),s=xt(o,"flow-into"),l=s?s.evaluate(t,"flow-into").toString():"body",a=this.encounteredFlowElement(l,o,this.root,n);this.boxStack.empty()&&this.boxStack.push(o,n,!0,a)}let i=this.xmldoc.getNodeByOffset(e),r=this.xmldoc.getNodeOffset(i,0,!1);if(!(r>=this.lastOffset))for(;;){if(i.nodeType!=1)r+=i.textContent.length;else{let s=i,l=this.getStyle(s,!1),a=l["flow-into"];if(a){let u=a.evaluate(t,"flow-into").toString();this.encounteredFlowElement(u,l,s,r)}r++}if(r>=this.lastOffset)break;let o=i.firstChild;if(o==null){for(;o=i.nextSibling,!o;)if(i=i.parentNode,i===this.root)return}i=o}}resetFlowChunkStream(e){this.flowListener=e;for(let t=0;t<this.flowChunks.length;t++)this.flowListener.encounteredFlowChunk(this.flowChunks[t],this.flows[this.flowChunks[t].flowName])}styleUntilFlowIsReached(e){this.flowToReach=e;let t=0;for(;!(this.flowToReach==null||(t+=5e3,this.styleUntil(t,0)==Number.POSITIVE_INFINITY)););}styleUntilIdIsReached(e){if(!e)return;this.idToReach=e;let t=0;for(;!(!this.idToReach||(t+=5e3,this.styleUntil(t,0)===Number.POSITIVE_INFINITY)););this.idToReach=null}encounteredFlowElement(e,t,n,i){let r=0,o=Number.POSITIVE_INFINITY,s=!1,l=!1,a=!1,u=t["flow-options"];if(u){let w=ek(u.evaluate(this.context,"flow-options"));s=!!w.exclusive,l=!!w.static,a=!!w.last}let h=t["flow-linger"];h&&(o=dg(h.evaluate(this.context,"flow-linger"),Number.POSITIVE_INFINITY));let p=t["flow-priority"];p&&(r=dg(p.evaluate(this.context,"flow-priority"),0));let c=this.breakBeforeValues[i]||null,f=this.flows[e];if(!f){let w=this.boxStack.lastFlowName();f=this.flows[e]=new gE(e,w)}let v=new mE(e,n,i,r,o,s,l,a,c);return this.flowChunks.push(v),this.flowToReach==e&&(this.flowToReach=null),this.flowListener&&this.flowListener.encounteredFlowChunk(v,f),v}registerForcedBreakOffset(e,t,n){if(Dt(e)){let r=this.flows[n].forcedBreakOffsets;(r.length===0||r[r.length-1]<t)&&r.push(t)}let i=this.breakBeforeValues[t];this.breakBeforeValues[t]=Bt(i,e)}styleUntil(e,t){let n=-1,i;if(e<=this.lastOffset&&(i=this.offsetMap.slippedByFixed(e),n=i+t,n<this.offsetMap.getMaxSlipped()))return this.offsetMap.fixedBySlipped(n);if(this.last==null)return Number.POSITIVE_INFINITY;let r=this.context;for(;;){let o=this.last.firstChild;if(o==null)for(;;){if(this.last.nodeType==1){this.cascade.popElement(this.last),this.primary=this.primaryStack.pop();let s=this.boxStack.pop(this.lastOffset),l=null;if(s.afterBox){let a=s.afterBox.getBreakValue("before");this.registerForcedBreakOffset(a,s.afterBox.atBlockStart?this.boxStack.nearestBlockStartOffset(s):s.afterBox.offset,s.flowName),l=s.afterBox.getBreakValue("after")}l=Bt(l,s.getBreakValue("after")),this.registerForcedBreakOffset(l,this.lastOffset,s.flowName)}if(o=this.last.nextSibling,o)break;if(this.last=this.last.parentNode,this.last===this.root)return this.last=null,e<this.lastOffset&&(n<0&&(i=this.offsetMap.slippedByFixed(e),n=i+t),n<=this.offsetMap.getMaxSlipped())?this.offsetMap.fixedBySlipped(n):Number.POSITIVE_INFINITY}if(this.last=o,this.last.nodeType!=1)this.lastOffset+=this.last.textContent.length,this.boxStack.encounteredTextNode(this.last),this.primary?this.offsetMap.addStuckRange(this.lastOffset):this.offsetMap.addSlippedRange(this.lastOffset);else{let s=this.last,l=this.getAttrStyle(s);this.primaryStack.push(this.primary),this.cascade.pushElement(this,s,l,this.lastOffset);let a=s.getAttribute("id")||s.getAttributeNS("http://www.w3.org/XML/1998/namespace","id");a&&a===this.idToReach&&(this.idToReach=null),!this.bodyReached&&s.localName=="body"&&s.parentNode==this.root&&(this.postprocessTopStyle(l,!0),this.bodyReached=!0);let u,h=l["flow-into"];if(h){let c=h.evaluate(r,"flow-into").toString(),f=this.encounteredFlowElement(c,l,s,this.lastOffset);this.primary=!!this.primaryFlows[c],u=this.boxStack.push(l,this.lastOffset,s===this.root,f)}else u=this.boxStack.push(l,this.lastOffset,s===this.root),s===this.xmldoc.body&&(u.breakBefore=Bt(u.flowChunk.breakBefore,u.breakBefore));let p=this.boxStack.nearestBlockStartOffset(u);if(p===0){let c=l.page,f=c&&!Te(c.value)&&c.value.toString();f&&f.toLowerCase()!=="auto"&&(this.cascade.firstPageType=f)}if(this.registerForcedBreakOffset(u.breakBefore,p,u.flowName),u.beforeBox){let c=u.beforeBox.getBreakValue("after");this.registerForcedBreakOffset(c,u.beforeBox.atBlockStart?p:u.offset,u.flowName)}if(this.primary&&u.displayValue()===S.none&&(this.primary=!1),this.styleMap[`e${this.lastOffset}`]=l,this.lastOffset++,this.primary?this.offsetMap.addStuckRange(this.lastOffset):this.offsetMap.addSlippedRange(this.lastOffset),this.bodyReached&&p===0)continue;if(e<this.lastOffset&&(n<0&&(i=this.offsetMap.slippedByFixed(e),n=i+t),n<=this.offsetMap.getMaxSlipped()))return this.offsetMap.fixedBySlipped(n)}}}getStyle(e,t){let n=this.xmldoc.getElementOffset(e),i=`e${n}`;return t&&(n=this.xmldoc.getNodeOffset(e,0,!0)),this.lastOffset<=n&&this.styleUntil(n,0),this.styleMap[i]}processContent(e,t,n){}},Gg=["column-count","column-width","column-fill"],_r=class{constructor(e){this.validator=e,d(this,"success",null),d(this,"failure",null),d(this,"code",0)}isSpecial(){return this.code!=0}markAsStartGroup(){this.code=-1}isStartGroup(){return this.code==-1}markAsEndGroup(){this.code=-2}isEndGroup(){return this.code==-2}markAsStartAlternate(e){this.code=2*e+1}isStartAlternate(){return this.code>0&&this.code%2!=0}markAsEndAlternate(e){this.code=2*e+2}isEndAlternate(){return this.code>0&&this.code%2==0}getAlternate(){return Math.floor((this.code-1)/2)}},Ui=class{constructor(e,t){this.where=e,this.success=t,d(this,"what",-1)}},Io=class ex{constructor(){d(this,"nodes",[]),d(this,"connections",[]),d(this,"match",[]),d(this,"nomatch",[]),d(this,"error",[]),d(this,"emptyHead",!0)}connect(t,n){for(let i=0;i<t.length;i++)this.connections[t[i]].what=n;t.splice(0,t.length)}clone(){let t=new ex;for(let n=0;n<this.nodes.length;n++){let i=this.nodes[n],r=new _r(i.validator);r.code=i.code,t.nodes.push(r)}for(let n=0;n<this.connections.length;n++){let i=this.connections[n],r=new Ui(i.where,i.success);r.what=i.what,t.connections.push(r)}return t.match.push(...this.match),t.nomatch.push(...this.nomatch),t.error.push(...this.error),t}addSpecialToArr(t,n,i){let r=this.nodes.length,o=new _r(Xg);i>=0?n?o.markAsStartAlternate(i):o.markAsEndAlternate(i):n?o.markAsStartGroup():o.markAsEndGroup(),this.nodes.push(o),this.connect(t,r);let s=new Ui(r,!0),l=new Ui(r,!1);t.push(this.connections.length),this.connections.push(l),t.push(this.connections.length),this.connections.push(s)}endSpecialGroup(){let t=[this.match,this.nomatch,this.error];for(let n=0;n<t.length;n++)this.addSpecialToArr(t[n],!1,-1)}startSpecialGroup(){if(this.nodes.length)throw new Error("invalid call");this.addSpecialToArr(this.match,!0,-1)}endClause(t){this.addSpecialToArr(this.match,!1,t)}startClause(t){if(this.nodes.length)throw new Error("invalid call");let n=new _r(Xg);n.markAsStartAlternate(t),this.nodes.push(n);let i=new Ui(0,!0),r=new Ui(0,!1);this.nomatch.push(this.connections.length),this.connections.push(r),this.match.push(this.connections.length),this.connections.push(i)}addPrimitive(t){let n=this.nodes.length;this.nodes.push(new _r(t));let i=new Ui(n,!0),r=new Ui(n,!1);this.connect(this.match,n),this.emptyHead?(this.nomatch.push(this.connections.length),this.emptyHead=!1):this.error.push(this.connections.length),this.connections.push(r),this.match.push(this.connections.length),this.connections.push(i)}isSimple(){return this.nodes.length==1&&!this.nodes[0].isSpecial()}isPrimitive(){return this.isSimple()&&this.nodes[0].validator instanceof it}addGroup(t,n){if(t.nodes.length==0)return;let i=this.nodes.length;if(n==4&&i==1&&t.isPrimitive()&&this.isPrimitive()){this.nodes[0].validator=this.nodes[0].validator.combine(t.nodes[0].validator);return}for(let o=0;o<t.nodes.length;o++)this.nodes.push(t.nodes[o]);n==4?(this.emptyHead=!0,this.connect(this.nomatch,i)):this.connect(this.match,i);let r=this.connections.length;for(let o=0;o<t.connections.length;o++){let s=t.connections[o];s.where+=i,s.what>=0&&(s.what+=i),this.connections.push(s)}for(let o=0;o<t.match.length;o++)this.match.push(t.match[o]+r);if(n==3&&this.connect(this.match,i),n==2||n==3)for(let o=0;o<t.nomatch.length;o++)this.match.push(t.nomatch[o]+r);else if(this.emptyHead){for(let o=0;o<t.nomatch.length;o++)this.nomatch.push(t.nomatch[o]+r);this.emptyHead=t.emptyHead}else for(let o=0;o<t.nomatch.length;o++)this.error.push(t.nomatch[o]+r);for(let o=0;o<t.error.length;o++)this.error.push(t.error[o]+r);t.nodes=null,t.connections=null}finish(t,n){let i=this.nodes.length;this.nodes.push(t),this.nodes.push(n),this.connect(this.match,i),this.connect(this.nomatch,i+1),this.connect(this.error,i+1);for(let r of this.connections)r.success?this.nodes[r.where].success=this.nodes[r.what]:this.nodes[r.where].failure=this.nodes[r.what];for(let r=0;r<i;r++)if(this.nodes[r].failure==null||this.nodes[r].success==null)throw new Error("Invalid validator state");return this.nodes[0]}},jN=1,tx=2,nx=4,ji=8,jl=16,Lc=32,Gl=64,ix=128,$o=256,Do=512,Fc=1024,rx=2048,ox=4096,sx=8192,lx=class extends li{constructor(){super()}validateForShorthand(e,t){let n=e[t].visit(this);return n?[n]:null}},it=class ax extends lx{constructor(t,n,i){super(),this.allowed=t,this.idents=n,this.units=i}visitEmpty(t){return this.allowed&jN?t:null}visitSlash(t){return this.allowed&rx?t:null}visitStr(t){return this.allowed&tx?t:null}visitIdent(t){return this.idents[t.name.toLowerCase()]||(this.allowed&nx||this.allowed&Gl&&CSS.supports("color",t.name)?t:null)}visitNumeric(t){return t.num==0&&!(this.allowed&Do)?t.unit=="%"&&this.allowed&Fc?t:null:t.num<0&&!(this.allowed&$o)?null:this.units[t.unit]?t:null}visitNum(t){return t.num==0?this.allowed&Do?t:null:t.num<=0&&!(this.allowed&$o)?null:this.allowed&jl?t:null}visitInt(t){return t.num==0?this.allowed&Do?t:null:t.num<=0&&!(this.allowed&$o)?null:this.allowed&(Lc|jl)?t:this.idents[`${t.num}`]||null}visitHexColor(t){return this.allowed&Gl&&/^([0-9A-F]{3,4}|([0-9A-F]{2}){3,4})$/i.test(t.hex)?t:null}visitURL(t){return this.allowed&ix?t:null}visitURange(t){return this.allowed&ox?t:null}visitSpaceList(t){return null}visitCommaList(t){return null}visitFunc(t){return this.allowed&Gl&&CSS.supports("color",t.toString())||this.allowed&sx&&CSS.supports("background-image",t.toString())||t.name==="calc"&&this.allowed&(ji|jl|Lc|$o|Do|Fc)?t:null}visitExpr(t){return this.allowed&2046?t:null}combine(t){let n={},i={};for(let r in this.idents)n[r]=this.idents[r];for(let r in t.idents)n[r]=t.idents[r];for(let r in this.units)i[r]=this.units[r];for(let r in t.units)i[r]=t.units[r];return new ax(this.allowed|t.allowed,n,i)}},Ae={},Xg=new it(0,Ae,Ae),fp=class extends lx{constructor(e){super(),d(this,"successTerminal"),d(this,"failureTerminal"),d(this,"first"),this.successTerminal=new _r(null),this.failureTerminal=new _r(null),this.first=e.finish(this.successTerminal,this.failureTerminal)}validateList(e,t,n){let i=t?[]:e,r=this.first,o=n,s=null,l=null;for(;r!==this.successTerminal&&r!==this.failureTerminal;){if(o>=e.length){r=r.failure;continue}let a=e[o],u=a;if(r.isSpecial()){let h=!0;r.isStartGroup()?(s?s.push(l):s=[l],l=[]):r.isEndGroup()?s.length>0?l=s.pop():l=null:r.isEndAlternate()?l[r.getAlternate()]="taken":h=l[r.getAlternate()]==null,r=h?r.success:r.failure}else{if(o==0&&!t&&r.validator instanceof os&&this instanceof os){if(u=new Ge(e).visit(r.validator),u){o=e.length,r=r.success;continue}}else if(o==0&&!t&&r.validator instanceof gp&&this instanceof os){if(u=new Mt(e).visit(r.validator),u){o=e.length,r=r.success;continue}}else u=a.visit(r.validator);if(!u){r=r.failure;continue}if(u!==a&&e===i){i=[];for(let h=0;h<o;h++)i[h]=e[h]}e!==i&&(i[o-n]=u),o++,r=r.success}}return r===this.successTerminal&&(t?i.length>0:o==e.length)?i:null}validateSingle(e){let t=null,n=this.first;for(;n!==this.successTerminal&&n!==this.failureTerminal;){if(!e){n=n.failure;continue}if(n.isSpecial()){n=n.success;continue}if(t=e.visit(n.validator),!t){n=n.failure;continue}e=null,n=n.success}return n===this.successTerminal?t:null}visitEmpty(e){return this.validateSingle(e)}visitSlash(e){return this.validateSingle(e)}visitStr(e){return this.validateSingle(e)}visitIdent(e){return this.validateSingle(e)}visitNumeric(e){return this.validateSingle(e)}visitNum(e){return this.validateSingle(e)}visitInt(e){return this.validateSingle(e)}visitHexColor(e){return this.validateSingle(e)}visitURL(e){return this.validateSingle(e)}visitURange(e){return this.validateSingle(e)}visitSpaceList(e){return null}visitCommaList(e){return null}visitFunc(e){return this.validateSingle(e)}visitExpr(e){return null}},os=class extends fp{constructor(e){super(e)}visitSpaceList(e){let t=this.validateList(e.values,!1,0);return t===e.values?e:t?new Ge(t):null}visitCommaList(e){let t=this.first,n=!1;for(;t;){if(t.validator instanceof gp){n=!0;break}t=t.failure}if(n){let i=this.validateList(e.values,!1,0);return i===e.values?e:i?new Mt(i):null}return null}validateForShorthand(e,t){return this.validateList(e,!0,t)}},gp=class extends fp{constructor(e){super(e)}visitSpaceList(e){return this.validateSingle(e)}visitCommaList(e){let t=this.validateList(e.values,!1,0);return t===e.values?e:t?new Mt(t):null}validateForShorthand(e,t){let n=this.first,i;for(;n!==this.failureTerminal;){if(i=n.validator.validateForShorthand(e,t),i)return i;n=n.failure}return null}},GN=class extends fp{constructor(e,t){super(t),this.name=e}validateSingle(e){return null}visitFunc(e){if(e.name.toLowerCase()!=this.name)return null;let t=this.validateList(e.values,!1,0);return t===e.values?e:t?new ho(e.name,t):null}},ux=class{tryParse(e,t,n){return t}success(e,t){}},hx=class extends ux{constructor(e,t){super(),this.name=t,d(this,"validator"),this.validator=e.validators[this.name]}tryParse(e,t,n){if(n.values[this.name])return t;let i=this.validator.validateForShorthand(e,t);if(i){let r=i.length,o=r>1?new Ge(i):i[0];return this.success(o,n),t+r}return t}success(e,t){t.values[this.name]=e}},XN=class extends hx{constructor(e,t){super(e,t[0]),this.names=t}success(e,t){for(let n=0;n<this.names.length;n++)t.values[this.names[n]]=e}},YN=class extends ux{constructor(e,t){super(),this.nodes=e,this.slash=t}tryParse(e,t,n){let i=t;if(this.slash)if(e[t]==Ja){if(++t==e.length)return i}else return i;let r=this.nodes[0].tryParse(e,t,n);if(r==t)return i;t=r;for(let o=1;o<this.nodes.length&&t<e.length&&(r=this.nodes[o].tryParse(e,t,n),r!=t);o++)t=r;return t}},mp=class extends li{constructor(){super(...arguments),d(this,"syntax",null),d(this,"propList",null),d(this,"error",!1),d(this,"values",{}),d(this,"validatorSet",null)}setOwner(e){this.validatorSet=e}syntaxNodeForProperty(e){return new hx(this.validatorSet,e)}clone(){let e=new this.constructor;return e.syntax=this.syntax,e.propList=this.propList,e.validatorSet=this.validatorSet,e}init(e,t){this.syntax=e,this.propList=t}finish(e,t){var n,i;if(!this.error){for(let r of this.propList)t.simpleProperty(r,(i=(n=this.values[r])!=null?n:this.validatorSet.defaultValues[r])!=null?i:S.initial,e);return!0}return!1}propagateDefaultingValue(e,t,n){for(let i of this.propList)n.simpleProperty(i,e,t)}validateList(e){return this.error=!0,0}validateSingle(e){return this.validateList([e]),null}visitEmpty(e){return this.validateSingle(e)}visitStr(e){return this.validateSingle(e)}visitIdent(e){return this.validateSingle(e)}visitNumeric(e){return this.validateSingle(e)}visitNum(e){return this.validateSingle(e)}visitInt(e){return this.validateSingle(e)}visitHexColor(e){return this.validateSingle(e)}visitURL(e){return this.validateSingle(e)}visitSpaceList(e){return this.validateList(e.values),null}visitCommaList(e){return this.error=!0,null}visitFunc(e){return this.validateSingle(e)}visitExpr(e){return this.validateSingle(e)}},go=class extends mp{constructor(){super()}validateList(e){let t=0,n=0;for(;t<e.length;){let i=this.syntax[n].tryParse(e,t,this);if(i>t){t=i,n=0;continue}if(++n==this.syntax.length){this.error=!0;break}}return t}},cx=class extends mp{constructor(){super()}validateList(e){if(e.length>this.syntax.length||e.length==0)return this.error=!0,0;for(let t=0;t<this.syntax.length;t++){let n=t;for(;n>=e.length;)n=n==1?0:n-2;if(this.syntax[t].tryParse(e,n,this)!=n+1)return this.error=!0,0}return e.length}createSyntaxNode(){return new XN(this.validatorSet,this.propList)}},qN=class extends mp{constructor(){super()}validateList(e){let t=e.length;for(let n=0;n<e.length;n++)if(e[n]===Ja){t=n;break}if(t>this.syntax.length||e.length==0)return this.error=!0,0;for(let n=0;n<this.syntax.length;n++){let i=n;for(;i>=t;)i=i==1?0:i-2;let r;if(t+1<e.length)for(r=t+n+1;r>=e.length;)r=r-(r==t+2?1:2);else r=i;let o=[e[i],e[r]];if(this.syntax[n].tryParse(o,0,this)!=2)return this.error=!0,0}return e.length}},KN=class extends go{constructor(){super()}mergeIn(e,t){var n,i;for(let r of this.propList){let o=(i=(n=t[r])!=null?n:this.validatorSet.defaultValues[r])!=null?i:S.initial,s=e[r];s||(s=[],e[r]=s),s.push(o)}}visitCommaList(e){let t={};for(let n=0;n<e.values.length;n++)if(this.values={},e.values[n]instanceof Mt?this.error=!0:(e.values[n].visit(this),this.mergeIn(t,this.values),this.values["background-color"]&&n!=e.values.length-1&&(this.error=!0)),this.error)return null;this.values={};for(let n in t)n=="background-color"?this.values[n]=t[n].pop():this.values[n]=new Mt(t[n]);return null}},QN=class extends go{constructor(){super()}init(e,t){super.init(e,t),this.propList.push("font-family","line-height","font-size","font-stretch","font-variant-ligatures","font-variant-caps","font-variant-numeric","font-variant-east-asian")}validateList(e){let t=super.validateList(e),n=this.values["font-variant_css2"];n&&(delete this.values["font-variant_css2"],this.values["font-variant-caps"]=n);let i=this.values["font-stretch_css3"];if(i&&(delete this.values["font-stretch_css3"],this.values["font-stretch"]=i),t+2>e.length)return this.error=!0,t;this.error=!1;let r=this.validatorSet.validators;if(!e[t].visit(r["font-size"]))return this.error=!0,t;if(this.values["font-size"]=e[t++],e[t]===Ja){if(t++,t+2>e.length)return this.error=!0,t;if(!e[t].visit(r["line-height"]))return this.error=!0,t;this.values["line-height"]=e[t++]}let o=t==e.length-1?e[t]:new Ge(e.slice(t,e.length));return o.visit(r["font-family"])?(this.values["font-family"]=o,e.length):(this.error=!0,t)}visitCommaList(e){if(e.values[0].visit(this),this.error)return null;let t=[this.values["font-family"]];for(let i=1;i<e.values.length;i++)t.push(e.values[i]);let n=new Mt(t);return n.visit(this.validatorSet.validators["font-family"])?this.values["font-family"]=n:this.error=!0,null}visitIdent(e){let t=this.validatorSet.systemFonts[e.name];if(t)for(let n in t)this.values[n]=t[n];else this.error=!0;return null}},ZN=class extends go{validateList(e){if(e.length===1&&e[0]instanceof Jt)switch(e[0].name.toLowerCase()){case"normal":e=[this.validatorSet.defaultValues["text-autospace"],this.validatorSet.defaultValues["text-spacing-trim"]];break;case"auto":e=[S.auto,S.auto];break;case"none":e=[q("no-autospace"),q("space-all")];break}return super.validateList(e)}},JN=["unicode-bidi","direction","margin-block-start","margin-block-end","margin-inline-start","margin-inline-end","padding-block-start","padding-block-end","padding-inline-start","padding-inline-end","border-block-start-color","border-block-end-color","border-inline-start-color","border-inline-end-color","border-block-start-style","border-block-end-style","border-inline-start-style","border-inline-end-style","border-block-start-width","border-block-end-width","border-inline-start-width","border-inline-end-width","block-start","block-end","inline-start","inline-end","block-size","inline-size","max-block-size","max-inline-size","min-block-size","min-inline-size","behavior","bleed","conflicting-partitions","crop-offset","crop-marks-line-color","enabled","flow-consume","flow-from","flow-into","flow-linger","flow-options","flow-priority","font-display","font-size-adjust","font-stretch_css3","font-variant_css2","glyph-orientation-vertical","marks","min-page-height","min-page-width","repeat-on-break","required","required-partitions","ruby-align","shape-inside","snap-height","snap-width","template","text-decoration-skip","text-justify","text-zoom","unicode-range","utilization","wrap-flow"],eT=class extends go{constructor(){super()}init(e,t){super.init(e,t);for(let n in this.validatorSet.validators)JN.includes(n)||this.propList.push(n)}validateList(e){return this.error=!0,0}},Yg={SIMPLE:go,INSETS:cx,INSETS_SLASH:qN,COMMA:KN,FONT:QN,TEXT_SPACING:ZN,ALL:eT},tT=class{constructor(){d(this,"validators",{}),d(this,"prefixes",{}),d(this,"defaultValues",{}),d(this,"namedValidators",{}),d(this,"systemFonts",{}),d(this,"shorthands",{}),d(this,"layoutProps",{}),d(this,"backgroundProps",{})}addReplacement(e,t){let n;if(t.type==3)n=new z(t.num,t.text);else if(t.type==7)n=new gy(t.text);else if(t.type==1)n=q(t.text);else throw new Error("unexpected replacement");if(e.isPrimitive()){let i=e.nodes[0].validator.idents;for(let r in i)i[r]=n;return e}throw new Error("unexpected replacement")}newGroup(e,t){let n=new Io;if(e=="||"){for(let r=0;r<t.length;r++){let o=new Io;o.startClause(r),o.addGroup(t[r],1),o.endClause(r),n.addGroup(o,r==0?1:4)}let i=new Io;return i.startSpecialGroup(),i.addGroup(n,3),i.endSpecialGroup(),i}else{let i;switch(e){case" ":i=1;break;case"|":case"||":i=4;break;default:throw new Error("unexpected op")}for(let r=0;r<t.length;r++)n.addGroup(t[r],r==0?1:i);return n}}addCounts(e,t,n){let i=new Io;for(let r=0;r<t;r++)i.addGroup(e.clone(),1);if(n==Number.POSITIVE_INFINITY)i.addGroup(e,3);else for(let r=t;r<n;r++)i.addGroup(e.clone(),2);return i}primitive(e){let t=new Io;return t.addPrimitive(e),t}newFunc(e,t){let n;switch(e){case"COMMA":n=new gp(t);break;case"SPACE":n=new os(t);break;default:n=new GN(e.toLowerCase(),t);break}return this.primitive(n)}initBuiltInValidators(){this.namedValidators.COLOR=this.primitive(new it(Gl,Ae,Ae)),this.namedValidators.IMAGE_FUNCTION=this.primitive(new it(sx,Ae,Ae)),this.namedValidators.POS_INT=this.primitive(new it(Lc,Ae,Ae)),this.namedValidators.POS_NUM=this.primitive(new it(jl,Ae,Ae)),this.namedValidators.POS_PERCENTAGE=this.primitive(new it(ji,Ae,{"%":fe})),this.namedValidators.NEGATIVE=this.primitive(new it($o,Ae,Ae)),this.namedValidators.ZERO=this.primitive(new it(Do,Ae,Ae)),this.namedValidators.ZERO_PERCENTAGE=this.primitive(new it(Fc,Ae,Ae)),this.namedValidators.POS_LENGTH=this.primitive(new it(ji,Ae,{em:fe,ex:fe,ch:fe,rem:fe,lh:fe,rlh:fe,vw:fe,vh:fe,vi:fe,vb:fe,vmin:fe,vmax:fe,pvw:fe,pvh:fe,pvi:fe,pvb:fe,pvmin:fe,pvmax:fe,cm:fe,mm:fe,in:fe,px:fe,pt:fe,pc:fe,q:fe})),this.namedValidators.POS_ANGLE=this.primitive(new it(ji,Ae,{deg:fe,grad:fe,rad:fe,turn:fe})),this.namedValidators.POS_TIME=this.primitive(new it(ji,Ae,{s:fe,ms:fe})),this.namedValidators.FREQUENCY=this.primitive(new it(ji,Ae,{Hz:fe,kHz:fe})),this.namedValidators.RESOLUTION=this.primitive(new it(ji,Ae,{dpi:fe,dpcm:fe,dppx:fe})),this.namedValidators.URI=this.primitive(new it(ix,Ae,Ae)),this.namedValidators.URANGE=this.primitive(new it(ox,Ae,Ae)),this.namedValidators.IDENT=this.primitive(new it(nx,Ae,Ae)),this.namedValidators.STRING=this.primitive(new it(tx,Ae,Ae)),this.namedValidators.SLASH=this.primitive(new it(rx,Ae,Ae));let e={"font-family":q("sans-serif")};this.systemFonts.caption=e,this.systemFonts.icon=e,this.systemFonts.menu=e,this.systemFonts["message-box"]=e,this.systemFonts["small-caption"]=e,this.systemFonts["status-bar"]=e}isBuiltIn(e){return!!e.match(/^[A-Z_0-9]+$/)}readNameAndPrefixes(e,t){let n=e.token();if(n.type==0)return null;let i={"":!0};if(n.type==14){do{if(e.consume(),n=e.token(),n.type!=1)throw new Error("Prefix name expected");i[n.text]=!0,e.consume(),n=e.token()}while(n.type==16);if(n.type!=15)throw new Error("']' expected");e.consume(),n=e.token()}if(n.type!=1)throw new Error("Property name expected");if(t==2?n.text=="SHORTHANDS":n.text=="DEFAULTS")return e.consume(),null;let r=n.text;if(e.consume(),t!=2){if(e.token().type!=39)throw new Error("'=' expected");this.isBuiltIn(r)||(this.prefixes[r]=i)}else if(e.token().type!=18)throw new Error("':' expected");return r}parseValidators(e){for(;;){let t=this.readNameAndPrefixes(e,1);if(!t)return;let n=[],i=[],r="",o,s=!0,l=()=>{if(n.length==0)throw new Error("No values");return n.length==1?n[0]:this.newGroup(r,n)},a=h=>{if(s)throw new Error(`'${h}': unexpected`);if(r&&r!=h)throw new Error(`mixed operators: '${h}' and '${r}'`);r=h,s=!0},u=null;for(;!u;){e.consume();let h=e.token();switch(h.type){case 1:if(s||a(" "),this.isBuiltIn(h.text)){let p=this.namedValidators[h.text];if(!p)throw new Error(`'${h.text}' unexpected`);n.push(p.clone())}else{let p={};p[h.text.toLowerCase()]=q(h.text),n.push(this.primitive(new it(0,p,Ae)))}s=!1;break;case 5:{let p={};p[`${h.num}`]=new ar(h.num),n.push(this.primitive(new it(0,p,Ae))),s=!1;break}case 34:a("|");break;case 25:a("||");break;case 14:s||a(" "),i.push({vals:n,op:r,b:"["}),r="",n=[],s=!0;break;case 6:s||a(" "),i.push({vals:n,op:r,b:"(",fn:h.text}),r="",n=[],s=!0;break;case 15:{o=l();let p=i.pop();if(p.b!="[")throw new Error("']' unexpected");n=p.vals,n.push(o),r=p.op,s=!1;break}case 11:{o=l();let p=i.pop();if(p.b!="(")throw new Error("')' unexpected");n=p.vals,n.push(this.newFunc(p.fn,o)),r=p.op,s=!1;break}case 18:if(s)throw new Error("':' unexpected");e.consume(),n.push(this.addReplacement(n.pop(),e.token()));break;case 22:if(s)throw new Error("'?' unexpected");n.push(this.addCounts(n.pop(),0,1));break;case 36:if(s)throw new Error("'*' unexpected");n.push(this.addCounts(n.pop(),0,Number.POSITIVE_INFINITY));break;case 23:if(s)throw new Error("'+' unexpected");n.push(this.addCounts(n.pop(),1,Number.POSITIVE_INFINITY));break;case 12:{if(e.consume(),h=e.token(),h.type!=5)throw new Error("<int> expected");let p=h.num,c=p;if(e.consume(),h=e.token(),h.type==16){if(e.consume(),h=e.token(),h.type!=5)throw new Error("<int> expected");c=h.num,e.consume(),h=e.token()}if(h.type!=13)throw new Error("'}' expected");n.push(this.addCounts(n.pop(),p,c));break}case 17:if(u=l(),i.length>0)throw new Error(`unclosed '${i.pop().b}'`);break;default:throw new Error("unexpected token")}}e.consume(),this.isBuiltIn(t)?this.namedValidators[t]=u:u.isSimple()?this.validators[t]=u.nodes[0].validator:this.validators[t]=new os(u)}}parseDefaults(e){for(;;){let t=this.readNameAndPrefixes(e,2);if(!t)return;let n=[];for(;;){e.consume();let i=e.token();if(i.type==17){e.consume();break}switch(i.type){case 1:n.push(q(i.text));break;case 4:n.push(new $i(i.num));break;case 5:n.push(new ar(i.num));break;case 3:n.push(new z(i.num,i.text));break;default:throw new Error("unexpected token")}}this.defaultValues[t]=n.length>1?new Ge(n):n[0]}}parseShorthands(e){for(;;){let t=this.readNameAndPrefixes(e,3);if(!t)return;let n=e.nthToken(1),i;n.type==1&&Yg[n.text]?(i=new Yg[n.text],e.consume()):i=new go,i.setOwner(this);let r=!1,o=[],s=!1,l=[],a=[];for(;!r;)switch(e.consume(),n=e.token(),n.type){case 1:if(this.validators[n.text])o.push(i.syntaxNodeForProperty(n.text)),n.text.includes("_")||a.push(n.text);else if(this.shorthands[n.text]instanceof cx){let u=this.shorthands[n.text];o.push(u.createSyntaxNode()),a.push(...u.propList)}else throw new Error(`'${n.text}' is neither a simple property nor an inset shorthand`);break;case 19:if(o.length>0||s)throw new Error("unexpected slash");s=!0;break;case 14:l.push({slash:s,syntax:o}),o=[],s=!1;break;case 15:{let u=new YN(o,s),h=l.pop();o=h.syntax,s=h.slash,o.push(u);break}case 17:r=!0,e.consume();break;default:throw new Error("unexpected token")}i.init(o,a),this.shorthands[t]=i}}parse(e){let t=new Fn(e,null);this.parseValidators(t),this.parseDefaults(t),this.parseShorthands(t),this.backgroundProps=this.makePropSet(["background"]),this.layoutProps=this.makePropSet(["margin","border","padding","columns","column-gap","column-rule","column-fill"])}makePropSet(e){var t;let n={};for(let i of e){let r=this.shorthands[i],o=r?r.propList:[i];for(let s of o)n[s]=(t=this.defaultValues[s])!=null?t:S.initial}return n}validatePropertyAndHandleShorthand(e,t,n,i){if(ni(e)||i.ruleType==="font-face"||iT(t)){i.simpleProperty(e,t,n);return}let r="",o=e;e=e.toLowerCase();let s=e.match(/^-([a-z]+)-([-a-z0-9]+)$/);s&&(r=s[1],e=s[2]);let l=this.prefixes[e];if(!l||!l[r]){CSS.supports(o,t.toString())?i.simpleProperty(o,t,n):r&&!Uw.includes(`-${r}-`)||i.unknownProperty(o,t);return}let a=this.validators[e];if(a){let u=Te(t)||t.isExpr()?t:t.visit(a);u?i.simpleProperty(e,u,n):!r&&CSS.supports(e,t.toString())?i.simpleProperty(e,t,n):i.invalidPropertyValue(o,t)}else{let u=this.shorthands[e].clone();Te(t)?u.propagateDefaultingValue(t,n,i):(t.visit(u),u.finish(n,i)||i.invalidPropertyValue(o,t))}}};function dx(){let e=new tT;return e.initBuiltInValidators(),e.parse(Iy),e}var nT=class extends li{constructor(){super(...arguments),d(this,"varFound",!1)}visitFunc(e){return e.name==="var"?this.varFound=!0:this.varFound||this.visitValues(e.values),null}};function iT(e){let t=new nT;return e.visit(t),t.varFound}`${new Date().valueOf()}`;function vp(e){return Object.keys(e).filter(t=>!["src","font-family","font-display"].includes(t)).sort()}function rT(e){let t=new ti;for(let n of vp(e))t.append(`${n}:${e[n].toString()};`);return t.toString()}function oT(e,t){let n={};for(let i in e)n[i]=xt(e,i).evaluate(t,i);return n}var px=class{constructor(e){this.properties=e,d(this,"fontTraitKey"),d(this,"src"),d(this,"blobURLs",[]),d(this,"blobs",[]),d(this,"family"),this.fontTraitKey=rT(this.properties),this.src=this.properties.src?this.properties.src.toString():null;let t=this.properties["font-family"];this.family=t?t.stringValue():null}traitsEqual(e){return this.fontTraitKey==e.fontTraitKey}makeAtRule(e,t){let n=new ti;n.append(`@font-face {
  font-family: `),n.append(this.family),n.append(`;
  `);for(let i of vp(this.properties))n.append(i),n.append(": "),this.properties[i].appendTo(n,!0),n.append(`;
  `);if(t){n.append('src: url("');let i=Dk(t);n.append(i),this.blobURLs.push(i),this.blobs.push(t),n.append('")')}else n.append("src: "),n.append(e);return n.append(`;
}
`),n.toString()}},sT=class{constructor(e){this.deobfuscator=e,d(this,"familyMap",{})}registerFamily(e,t){let n=e.family,i=this.familyMap[n],r=t.family;if(i){if(i!=r)throw new Error(`E_FONT_FAMILY_INCONSISTENT ${e.family}`)}else this.familyMap[n]=r}filterFontFamily(e){if(e instanceof Mt){let t=e.values,n=[];for(let i of t){let r=this.familyMap[i.stringValue()];r&&n.push(q(r)),n.push(i)}return new Mt(n)}else{let t=this.familyMap[e.stringValue()];return t?new Mt([q(t),e]):e}}},lT=class{constructor(e,t,n){this.head=e,this.body=t,d(this,"srcURLMap",{}),d(this,"familyPrefix"),d(this,"familyCounter",0),this.familyPrefix=n||"Fnt_"}getViewFontFamily(e,t){let n=e.family,i=t.familyMap[n];return i||(i=this.familyPrefix+ ++this.familyCounter,t.familyMap[n]=i,i)}initFont(e,t,n){let i=X("initFont"),r=e.src,o={};for(let u of vp(e.properties))o[u]=e.properties[u];let s=this.getViewFontFamily(e,n);o["font-family"]=q(s);let l=new px(o),a=this.head.ownerDocument.createElement("style");return a.textContent=l.makeAtRule(r,t),this.head.appendChild(a),le.debug("Load font:",r),i.finish(l),i.result()}loadFont(e,t){let n=e.src,i=e.family+";"+n,r=this.srcURLMap[i];return r?r.piggyback(o=>{let s=o;s.traitsEqual(e)?(t.registerFamily(e,s),le.debug("Found already-loaded font:",n)):le.warn("E_FONT_FACE_INCOMPATIBLE",e.src)}):(r=new Ys(()=>{let o=X("loadFont"),s=n.replace(/^url\("([^"]+)"\).*$/,"$1"),l=t.deobfuscator?t.deobfuscator(s):null;return l?iu(s,"blob").then(a=>{if(!a.responseBlob){o.finish(null);return}l(a.responseBlob).then(u=>{this.initFont(e,u,t).thenFinish(o)})}):this.initFont(e,null,t).thenFinish(o),o.result()},`loadFont ${n}`),this.srcURLMap[i]=r,r.start()),r}findOrLoadFonts(e,t){let n=[];for(let i of e){if(!i.src||!i.family){le.warn("E_FONT_FACE_INVALID");continue}n.push(this.loadFont(i,t))}return nu(n).thenAsync(()=>this.waitFontLoading())}waitFontLoading(){let e=this.head.ownerDocument.fonts,t=0;if(e.forEach(i=>{i.status==="unloaded"&&(t++,i.load().catch(r=>{}))}),t===0)return R(!0);let n=X("waitFontLoading");return n.loop(()=>n.sleep(20).thenAsync(()=>e.status==="loading"?R(!0):R(!1))).thenFinish(n),n.result()}},aT=1,au=class{constructor(e,t,n,i,r){this.name=t,this.pseudoName=n,this.classes=i,this.parent=r,d(this,"specified",{}),d(this,"children",[]),d(this,"pageMaster",null),d(this,"index",0),d(this,"key"),d(this,"_scope"),this._scope=e,this.key=`p${aT++}`,r&&(this.index=r.children.length,r.children.push(this))}get scope(){return this._scope}createInstance(e){throw new Error("E_UNEXPECTED_CALL")}clone(e){throw new Error("E_UNEXPECTED_CALL")}copySpecified(e){let t=this.specified,n=e.specified;for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}cloneChildren(e){for(let t=0;t<this.children.length;t++)this.children[t].clone({parent:e})}},uT=class extends au{constructor(e){super(e,null,null,[],null),this.specified.width=new ke(Gs,0),this.specified.height=new ke(Xs,0)}},qg=class extends Qh{constructor(e,t){super(e,i),this.pageMaster=t;let n=this;function i(r,o){let s=r.match(/^([^.]+)\.([^.]+)$/);if(s){let l=n.pageMaster.keyMap[s[1]];if(l){let a=this.lookupInstance(l);if(a)return o?a.resolveFunc(s[2]):a.resolveName(s[2])}}return null}}},fx=class gx extends au{constructor(t,n,i,r,o,s,l){super(t,n,i,r,o),this.condition=s,this.specificity=l,d(this,"keyMap",{}),t instanceof qg||(this._scope=new qg(t,this)),this.pageMaster=this,this.specified.width=new ke(Gs,0),this.specified.height=new ke(Xs,0),this.specified["wrap-flow"]=new ke(S.auto,0),this.specified.position=new ke(S.relative,0),this.specified.overflow=new ke(S.visible,0)}createInstance(t){return new yp(t,this)}clone(t){let n=new gx(this.scope,this.name,t.pseudoName||this.pseudoName,this.classes,this.parent,this.condition,this.specificity);return this.copySpecified(n),this.cloneChildren(n),n}resetScope(){this.scope.pageMaster=this}},mx=class vx extends au{constructor(t,n,i,r,o){super(t,n,i,r,o),this.pageMaster=o.pageMaster,n&&(this.pageMaster.keyMap[n]=this.key),this.specified["wrap-flow"]=new ke(S.auto,0)}createInstance(t){return new pT(t,this)}clone(t){let n=new vx(t.parent.scope,this.name,this.pseudoName,this.classes,t.parent);return this.copySpecified(n),this.cloneChildren(n),n}},Js=class wx extends au{constructor(t,n,i,r,o){super(t,n,i,r,o),this.pageMaster=o.pageMaster,n&&(this.pageMaster.keyMap[n]=this.key)}createInstance(t){return new el(t,this)}clone(t){let n=new wx(t.parent.scope,this.name,this.pseudoName,this.classes,t.parent);return this.copySpecified(n),this.cloneChildren(n),n}};function hT(e,t,n){return!t||Te(t)?new dt(e,n):t.toExpr(e,e.zero)}function Oe(e,t,n){return!t||t===S.auto||Te(t)?null:t.toExpr(e,n)}function cT(e,t,n){return!t||t===S.normal||Te(t)?null:t.toExpr(e,n)}function Yt(e,t,n){return!t||t===S.auto||Te(t)?e.zero:t.toExpr(e,n)}function Kg(e,t,n){return!t||Te(t)?e.zero:t===S.auto?null:t.toExpr(e,n)}function $n(e,t,n,i){return!t||n===S.none||Te(t)?e.zero:t.toExpr(e,i)}function yx(e,t,n){return!t||Te(t)?n:t===S._true?e._true:t===S._false?e._false:t.toExpr(e,e.zero)}var uu=class{constructor(e,t){this.parentInstance=e,this.pageBox=t,d(this,"cascaded",{}),d(this,"style",{}),d(this,"autoWidth",null),d(this,"autoHeight",null),d(this,"children",[]),d(this,"isAutoWidth",!1),d(this,"isAutoHeight",!1),d(this,"isTopDependentOnAutoHeight",!1),d(this,"isRightDependentOnAutoWidth",!1),d(this,"calculatedWidth",0),d(this,"calculatedHeight",0),d(this,"pageMasterInstance",null),d(this,"namedValues",{}),d(this,"namedFuncs",{}),d(this,"vertical",!1),d(this,"rtl",!1),d(this,"suppressEmptyBoxGeneration",!1),d(this,"borderBoxSizing",!1),e&&e.children.push(this)}reset(){this.calculatedWidth=0,this.calculatedHeight=0}addNamedValues(e,t){let n=this.resolveName(e),i=this.resolveName(t);if(!n||!i)throw new Error("E_INTERNAL");return Ce(this.pageBox.scope,n,i)}resolveName(e){let t=this.namedValues[e];if(t)return t;let n=this.style[e];switch(n&&(t=n.toExpr(this.pageBox.scope,this.pageBox.scope.zero)),e){case"margin-left-edge":t=this.resolveName("left");break;case"margin-top-edge":t=this.resolveName("top");break;case"margin-right-edge":t=this.addNamedValues("border-right-edge","margin-right");break;case"margin-bottom-edge":t=this.addNamedValues("border-bottom-edge","margin-bottom");break;case"border-left-edge":t=this.addNamedValues("margin-left-edge","margin-left");break;case"border-top-edge":t=this.addNamedValues("margin-top-edge","margin-top");break;case"border-right-edge":t=this.addNamedValues("padding-right-edge","border-right-width");break;case"border-bottom-edge":t=this.addNamedValues("padding-bottom-edge","border-bottom-width");break;case"padding-left-edge":t=this.addNamedValues("border-left-edge","border-left-width");break;case"padding-top-edge":t=this.addNamedValues("border-top-edge","border-top-width");break;case"padding-right-edge":t=this.addNamedValues("right-edge","padding-right");break;case"padding-bottom-edge":t=this.addNamedValues("bottom-edge","padding-bottom");break;case"left-edge":t=this.addNamedValues("padding-left-edge","padding-left");break;case"top-edge":t=this.addNamedValues("padding-top-edge","padding-top");break;case"right-edge":t=this.addNamedValues("left-edge","width");break;case"bottom-edge":t=this.addNamedValues("top-edge","height");break}if(!t){let i;if(e=="extent")i=this.vertical?"width":"height";else if(e=="measure")i=this.vertical?"height":"width";else{let r=this.vertical?f0:g0;i=e;for(let o in r)i=i.replace(o,r[o])}i!=e&&(t=this.resolveName(i))}return t&&(this.namedValues[e]=t),t}resolveFunc(e){let t=this.namedFuncs[e];if(t)return t;switch(e){case"columns":{let n=this.pageBox.scope,i=new hy(n,0),r=this.resolveName("column-count"),o=this.resolveName("column-width"),s=this.resolveName("column-gap");t=Fe(n,Vl(n,new Qo(n,"min",[i,r]),Ce(n,o,s)),s);break}}return t&&(this.namedFuncs[e]=t),t}initEnabled(){let e=this.pageBox.scope,t=this.style,n=yx(e,t.enabled,e._true),i=Oe(e,t.page,e.zero);if(i){let s=new lt(e,"page-number");n=mn(e,n,new jd(e,i,s))}let r=Oe(e,t["min-page-width"],e.zero);r&&(n=mn(e,n,new Jh(e,new lt(e,"page-width"),r)));let o=Oe(e,t["min-page-height"],e.zero);o&&(n=mn(e,n,new Jh(e,new lt(e,"page-height"),o))),n=this.boxSpecificEnabled(n),t.enabled=new re(n)}boxSpecificEnabled(e){return e}initHorizontal(){let e=this.pageBox.scope,t=this.style,n=this.parentInstance?this.parentInstance.style.width.toExpr(e,null):null,i=Oe(e,t.left,n),r=Oe(e,t["margin-left"],n),o=$n(e,t["border-left-width"],t["border-left-style"],n),s=Yt(e,t["padding-left"],n),l=Oe(e,t.width,n),a=Oe(e,t["max-width"],n),u=Yt(e,t["padding-right"],n),h=$n(e,t["border-right-width"],t["border-right-style"],n),p=Oe(e,t["margin-right"],n),c=Oe(e,t.right,n),f=Ce(e,o,s),v=Ce(e,o,u);if(i&&c&&l){let g=Fe(e,n,Ce(e,l,Ce(e,Ce(e,i,f),v)));r?p?c=Fe(e,g,p):p=Fe(e,g,Ce(e,c,r)):(g=Fe(e,g,c),p?r=Fe(e,g,p):(r=Vl(e,g,new dt(e,.5)),p=r))}else{r||(r=e.zero),p||(p=e.zero),!i&&!c&&!l&&(i=e.zero),!i&&!l?(l=this.autoWidth,this.isAutoWidth=!0):!i&&!c?i=e.zero:!l&&!c&&(l=this.autoWidth,this.isAutoWidth=!0);let g=Fe(e,n,Ce(e,Ce(e,r,f),Ce(e,p,v)));this.isAutoWidth&&(a||(a=Fe(e,g,i||c)),!this.vertical&&(Oe(e,t["column-width"],null)||Oe(e,t["column-count"],null))&&(l=a,this.isAutoWidth=!1)),i?l?c||(c=Fe(e,g,Ce(e,i,l))):l=Fe(e,g,Ce(e,i,c)):i=Fe(e,g,Ce(e,c,l))}let w=t["snap-width"]||(this.parentInstance?this.parentInstance.style["snap-width"]:null),x=Yt(e,w,n);t.left=new re(i),t["margin-left"]=new re(r),t["border-left-width"]=new re(o),t["padding-left"]=new re(s),t.width=new re(l),t["max-width"]=new re(a||l),t["padding-right"]=new re(u),t["border-right-width"]=new re(h),t["margin-right"]=new re(p),t.right=new re(c),t["snap-width"]=new re(x)}initVertical(){let e=this.pageBox.scope,t=this.style,n=this.parentInstance?this.parentInstance.style.width.toExpr(e,null):null,i=this.parentInstance?this.parentInstance.style.height.toExpr(e,null):null,r=Oe(e,t.top,i),o=Oe(e,t["margin-top"],n),s=$n(e,t["border-top-width"],t["border-top-style"],n),l=Yt(e,t["padding-top"],n),a=Oe(e,t.height,i),u=Oe(e,t["max-height"],i),h=Yt(e,t["padding-bottom"],n),p=$n(e,t["border-bottom-width"],t["border-bottom-style"],n),c=Oe(e,t["margin-bottom"],n),f=Oe(e,t.bottom,i),v=Ce(e,s,l),w=Ce(e,p,h);if(r&&f&&a){let m=Fe(e,i,Ce(e,a,Ce(e,Ce(e,r,v),w)));o?c?f=Fe(e,m,o):c=Fe(e,m,Ce(e,f,o)):(m=Fe(e,m,f),c?o=Fe(e,m,c):(o=Vl(e,m,new dt(e,.5)),c=o))}else{o||(o=e.zero),c||(c=e.zero),!r&&!f&&!a&&(r=e.zero),!r&&!a?(a=this.autoHeight,this.isAutoHeight=!0):!r&&!f?r=e.zero:!a&&!f&&(a=this.autoHeight,this.isAutoHeight=!0);let m=Fe(e,i,Ce(e,Ce(e,o,v),Ce(e,c,w)));this.isAutoHeight&&(u||(u=Fe(e,m,r||f)),this.vertical&&(Oe(e,t["column-width"],null)||Oe(e,t["column-count"],null))&&(a=u,this.isAutoHeight=!1)),r?a?f||(f=Fe(e,m,Ce(e,r,a))):a=Fe(e,m,Ce(e,f,r)):r=Fe(e,m,Ce(e,f,a))}let x=t["snap-height"]||(this.parentInstance?this.parentInstance.style["snap-height"]:null),g=Yt(e,x,n);t.top=new re(r),t["margin-top"]=new re(o),t["border-top-width"]=new re(s),t["padding-top"]=new re(l),t.height=new re(a),t["max-height"]=new re(u||a),t["padding-bottom"]=new re(h),t["border-bottom-width"]=new re(p),t["margin-bottom"]=new re(c),t.bottom=new re(f),t["snap-height"]=new re(g)}initColumns(){let e=this.pageBox.scope,t=this.style,n=Oe(e,t[this.vertical?"height":"width"],null),i=Oe(e,t["column-width"],n),r=Oe(e,t["column-count"],null),o=cT(e,t["column-gap"],null);o||(o=new js(e,1,"em")),i&&!r&&(r=new Qo(e,"floor",[ec(e,Ce(e,n,o),Ce(e,i,o))]),r=new Qo(e,"max",[e.one,r])),r||(r=e.one),i=Fe(e,ec(e,Ce(e,n,o),r),o),t["column-width"]=new re(i),t["column-count"]=new re(r),t["column-gap"]=new re(o)}depends(e,t,n){return this.style[e].toExpr(this.pageBox.scope,null).depend(t,n)}init(e){var t;e.registerInstance(this.pageBox.key,this);let n=this.pageBox.scope,i=this.style,r=this.parentInstance?this.parentInstance.getActiveRegions(e):null,o=F0(this.cascaded,e,r,!1);this.vertical=A0(o,e,this.parentInstance?this.parentInstance.vertical:!1),this.rtl=L0(o,e,this.parentInstance?this.parentInstance.rtl:!1),this.borderBoxSizing=((t=o["box-sizing"])==null?void 0:t.value)===S.border_box;let s=!!(e instanceof kp&&e.currentLayoutPosition&&new lt(n,"left-page").evaluate(e));B0(o,i,this.vertical,this.rtl,s,(l,a)=>a.value),this.autoWidth=new mt(n,()=>this.calculatedWidth,"autoWidth"),this.autoHeight=new mt(n,()=>this.calculatedHeight,"autoHeight"),this.initHorizontal(),this.initVertical(),this.initColumns(),this.initEnabled()}getProp(e,t){var n,i;let r=this.style[t];return!r&&ts(t)&&(t==="font-size"&&e.isRelativeRootFontSize&&e.rootFontSize?r=new z(e.rootFontSize,"px"):r=(i=((n=e.styler)==null?void 0:n.rootStyle)[t])==null?void 0:i.value),r&&(r=Ra(e,r,t)),r}getPropAsNumber(e,t){var n,i;let r=this.style[t];if(r){let o=/\b(height|top|bottom)\b/.test(t)?(n=e.pageAreaHeight)!=null?n:e.pageHeight():(i=e.pageAreaWidth)!=null?i:e.pageWidth();r=Ra(e,r,t,o)}return Ft(r,e)}getSpecial(e,t){let n=w0(this.cascaded,t);if(n){let i=[];for(let r=0;r<n.length;r++){let o=n[r].evaluate(e,"");o&&o!==fe&&i.push(o)}if(i.length)return i}return null}getActiveRegions(e){let t=this.getSpecial(e,"region-id");if(t){let n=[];for(let i=0;i<t.length;i++)n[i]=t[i].toString();return n}return null}propagateProperty(e,t,n,i){this.propagatePropertyToElement(e,t.element,n,i)}propagatePropertyToElement(e,t,n,i){let r=this.getProp(e,n);r&&(r.isNumeric()&&Jw(r.unit)&&(r=vy(r,e)),n==="font-family"&&(r=i.filterFontFamily(r)),(n.startsWith("background")||n==="z-index")&&t.parentElement.hasAttribute("data-vivliostyle-bleed-box")&&(t=t.parentElement),O(t,n,r.toString()))}propagateDelayedProperty(e,t,n,i){let r=this.getProp(e,n);r&&i.push(new Jd(t.element,n,r))}assignLeftPosition(e,t){let n=this.getPropAsNumber(e,"left"),i=this.getPropAsNumber(e,"margin-left"),r=this.getPropAsNumber(e,"padding-left"),o=this.getPropAsNumber(e,"border-left-width"),s=this.getPropAsNumber(e,"width");t.setHorizontalPosition(n,s),O(t.element,"margin-left",`${i}px`),O(t.element,"padding-left",`${r}px`),O(t.element,"border-left-width",`${o}px`),t.marginLeft=i,t.borderLeft=o,t.paddingLeft=r}assignRightPosition(e,t){let n=this.getPropAsNumber(e,"right"),i=this.getPropAsNumber(e,"snap-height"),r=this.getPropAsNumber(e,"margin-right"),o=this.getPropAsNumber(e,"padding-right"),s=this.getPropAsNumber(e,"border-right-width");if(O(t.element,"margin-right",`${r}px`),O(t.element,"padding-right",`${o}px`),O(t.element,"border-right-width",`${s}px`),t.marginRight=r,t.borderRight=s,this.vertical&&i>0){let l=n+t.getInsetRight(),a=l-Math.floor(l/i)*i;a>0&&(t.snapOffsetX=i-a,o+=t.snapOffsetX)}t.paddingRight=o,t.snapWidth=i}assignTopPosition(e,t){let n=this.getPropAsNumber(e,"snap-height"),i=this.getPropAsNumber(e,"top"),r=this.getPropAsNumber(e,"margin-top"),o=this.getPropAsNumber(e,"padding-top"),s=this.getPropAsNumber(e,"border-top-width");if(t.top=i,t.marginTop=r,t.borderTop=s,t.snapHeight=n,!this.vertical&&n>0){let l=i+t.getInsetTop(),a=l-Math.floor(l/n)*n;a>0&&(t.snapOffsetY=n-a,o+=t.snapOffsetY)}t.paddingTop=o,O(t.element,"top",`${i}px`),O(t.element,"margin-top",`${r}px`),O(t.element,"padding-top",`${o}px`),O(t.element,"border-top-width",`${s}px`)}assignBottomPosition(e,t){let n=this.getPropAsNumber(e,"margin-bottom"),i=this.getPropAsNumber(e,"padding-bottom"),r=this.getPropAsNumber(e,"border-bottom-width"),o=this.getPropAsNumber(e,"height")-t.snapOffsetY;O(t.element,"height",`${o}px`),O(t.element,"margin-bottom",`${n}px`),O(t.element,"padding-bottom",`${i}px`),O(t.element,"border-bottom-width",`${r}px`),t.height=o-t.snapOffsetY,t.marginBottom=n,t.borderBottom=r,t.paddingBottom=i}assignBeforePosition(e,t){this.vertical?this.assignRightPosition(e,t):this.assignTopPosition(e,t)}assignAfterPosition(e,t){this.vertical?this.assignLeftPosition(e,t):this.assignBottomPosition(e,t)}assignStartEndPosition(e,t){this.vertical?(this.assignTopPosition(e,t),this.assignBottomPosition(e,t)):(this.assignRightPosition(e,t),this.assignLeftPosition(e,t))}sizeWithMaxHeight(e,t){O(t.element,"border-top-width","0px");let n=this.getPropAsNumber(e,"max-height");this.isTopDependentOnAutoHeight?t.setVerticalPosition(0,n):(this.assignTopPosition(e,t),n-=t.snapOffsetY,t.height=n,O(t.element,"height",`${n}px`))}sizeWithMaxWidth(e,t){O(t.element,"border-left-width","0px");let n=this.getPropAsNumber(e,"max-width");if(this.isRightDependentOnAutoWidth)t.setHorizontalPosition(0,n);else{this.assignRightPosition(e,t),n-=t.snapOffsetX,t.width=n;let i=this.getPropAsNumber(e,"right");O(t.element,"right",`${i}px`),O(t.element,"width",`${n}px`)}}prepareContainer(e,t,n,i,r){(!this.parentInstance||this.vertical!=this.parentInstance.vertical)&&O(t.element,"writing-mode",this.vertical?"vertical-rl":"horizontal-tb"),(!this.parentInstance||this.rtl!=this.parentInstance.rtl)&&O(t.element,"direction",this.rtl?"rtl":"ltr"),(this.vertical?this.isAutoWidth:this.isAutoHeight)?this.vertical?this.sizeWithMaxWidth(e,t):this.sizeWithMaxHeight(e,t):(this.assignBeforePosition(e,t),this.assignAfterPosition(e,t)),(this.vertical?this.isAutoHeight:this.isAutoWidth)?this.vertical?this.sizeWithMaxHeight(e,t):this.sizeWithMaxWidth(e,t):this.assignStartEndPosition(e,t);for(let o=0;o<Qg.length;o++)this.propagateProperty(e,t,Qg[o],i)}transferContentProps(e,t,n,i){for(let r=0;r<Jg.length;r++)this.propagateProperty(e,t,Jg[r],i);if(this.style["text-overflow"]){let r=t.element.firstElementChild;O(r,"text-overflow","inherit"),O(r,"overflow","inherit")}}transferSingleUriContentProps(e,t,n){let i=()=>{var o,s;let l=(s=(o=this.cascaded.width)!=null?o:this.cascaded[this.vertical?"block-size":"inline-size"])==null?void 0:s.value;return!!l&&l!==S.auto&&!Te(l)},r=()=>{var o,s;let l=(s=(o=this.cascaded.height)!=null?o:this.cascaded[this.vertical?"inline-size":"block-size"])==null?void 0:s.value;return!!l&&l!==S.auto&&!Te(l)};for(let o=0;o<em.length;o++){let s=em[o];if(s==="width"||s==="height"){if(s==="width"&&!i()||s==="height"&&!r())continue;O(t,s,"100%");continue}this.propagatePropertyToElement(e,t,s,n)}}finishContainer(e,t,n,i,r,o,s){this.vertical?this.calculatedWidth=t.computedBlockSize+t.snapOffsetX:this.calculatedHeight=t.computedBlockSize+t.snapOffsetY;let l=(this.vertical||!i)&&this.isAutoHeight,a=(!this.vertical||!i)&&this.isAutoWidth,u=null;if((a||l)&&(a&&O(t.element,"width","auto"),l&&O(t.element,"height","auto"),u=o.getElementClientRect(i?i.element:t.element),a&&(this.calculatedWidth=Math.ceil(u.right-u.left-t.paddingLeft-t.borderLeft-t.paddingRight-t.borderRight),this.vertical&&(this.calculatedWidth+=t.snapOffsetX)),l&&(this.calculatedHeight=u.bottom-u.top-t.paddingTop-t.borderTop-t.paddingBottom-t.borderBottom,this.vertical||(this.calculatedHeight+=t.snapOffsetY))),(this.vertical?this.isAutoHeight:this.isAutoWidth)&&this.assignStartEndPosition(e,t),(this.vertical?this.isAutoWidth:this.isAutoHeight)&&((this.vertical?this.isRightDependentOnAutoWidth:this.isTopDependentOnAutoHeight)&&this.assignBeforePosition(e,t),this.assignAfterPosition(e,t)),r>1){let h=this.getPropAsNumber(e,"column-rule-width"),p=this.getProp(e,"column-rule-style"),c=this.getProp(e,"column-rule-color");if(h>0&&p&&p!=S.none&&c!=S.transparent){let f=this.getPropAsNumber(e,"column-gap"),v=this.vertical?t.height:t.width,w=this.vertical?"border-top":"border-left";for(let x=1;x<r;x++){let g=this.vertical?(v+f)*x/r-f/2+t.paddingTop-h/2:(v+f)*x/r-f/2+t.paddingLeft-h/2,m=this.vertical?t.width+t.paddingLeft+t.paddingRight:t.height+t.paddingTop+t.paddingBottom,y=t.element.ownerDocument.createElement("div");O(y,"position","absolute"),O(y,this.vertical?"left":"top","0px"),O(y,this.vertical?"top":"left",`${g}px`),O(y,this.vertical?"height":"width","0px"),O(y,this.vertical?"width":"height",`${m}px`),O(y,w,`${h}px ${p.toString()}${c?` ${c.toString()}`:""}`),t.element.insertBefore(y,t.element.firstChild)}}}for(let h=0;h<Zg.length;h++)this.propagateProperty(e,t,Zg[h],s);for(let h=0;h<tm.length;h++)this.propagateDelayedProperty(e,t,tm[h],n.delayedItems)}applyCascadeAndInit(e,t){let n=this.cascaded,i=this.pageBox.specified;for(let o in i)this instanceof ls&&this.pageBox.pseudoName=="vivliostyle-page-rule-master"&&(o==="writing-mode"||o==="direction")||Gr(o)&&er(n,o,xt(i,o));if(this.pageBox.pseudoName==wp)for(let o in t)(o.match(/^background-/)||o=="writing-mode")&&(n[o]=t[o]);if(this.pageBox.pseudoName=="layout-host")for(let o in t)!o.match(/^background-/)&&o!="writing-mode"&&(n[o]=t[o]);e.pushRule(this.pageBox.classes,null,n);let r=n.content;r&&(n.content=r.filterValue(new Pc(e,null,e.counterResolver))),this.init(e.context);for(let o of this.pageBox.children)o.createInstance(this).applyCascadeAndInit(e,t);e.popRule()}resolveAutoSizing(e){this.isAutoWidth&&(this.isRightDependentOnAutoWidth=this.depends("right",this.autoWidth,e)||this.depends("margin-right",this.autoWidth,e)||this.depends("border-right-width",this.autoWidth,e)||this.depends("padding-right",this.autoWidth,e)),this.isAutoHeight&&(this.isTopDependentOnAutoHeight=this.depends("top",this.autoHeight,e)||this.depends("margin-top",this.autoHeight,e)||this.depends("border-top-width",this.autoHeight,e)||this.depends("padding-top",this.autoHeight,e));for(let t of this.children)t.resolveAutoSizing(e)}},Qg=["border-left-style","border-right-style","border-top-style","border-bottom-style","border-left-color","border-right-color","border-top-color","border-bottom-color","box-sizing","outline-style","outline-color","outline-width","overflow","visibility"],Zg=["border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius","border-start-start-radius","border-start-end-radius","border-end-start-radius","border-end-end-radius","border-image-source","border-image-slice","border-image-width","border-image-outset","border-image-repeat","background-attachment","background-color","background-image","background-repeat","background-position","background-clip","background-origin","background-size","box-shadow","opacity","z-index","background-blend-mode","isolation","mix-blend-mode","filter"],Jg=["color","font-family","font-size","font-style","font-weight","line-height","letter-spacing","text-align","text-align-last","text-decoration","text-indent","text-transform","white-space","text-wrap","text-wrap-mode","text-wrap-style","word-spacing","font-feature-settings","font-kerning","font-size-adjust","font-variant-ligatures","font-variant-caps","font-variant-numeric","font-variant-east-asian","font-stretch","text-combine-upright","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-skip-ink","text-decoration-style","text-decoration-thickness","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-fill-color","text-orientation","text-shadow","text-stroke-color","text-stroke-width","text-underline-offset","text-underline-position","text-overflow"],em=["width","height","image-resolution","object-fit","object-position"],tm=["transform","transform-origin"],wp="background-host",dT=class extends uu{constructor(e){super(null,e)}applyCascadeAndInit(e,t){super.applyCascadeAndInit(e,t),this.children.sort((n,i)=>i.pageBox.specificity-n.pageBox.specificity||n.pageBox.index-i.pageBox.index)}},yp=class extends uu{constructor(e,t){super(e,t),this.pageMasterInstance=this}boxSpecificEnabled(e){let t=this.pageBox.pageMaster;return t.condition&&(e=mn(t.scope,e,t.condition)),e}adjustPageLayout(e,t,n){}},pT=class extends uu{constructor(e,t){super(e,t),this.pageMasterInstance=e.pageMasterInstance}},el=class extends uu{constructor(e,t){super(e,t),this.pageMasterInstance=e.pageMasterInstance}processPartitionList(e,t,n){let i=null;if(t instanceof Jt&&(i=[t]),t instanceof Mt&&(i=t.values),i){let r=this.pageBox.scope;for(let o=0;o<i.length;o++)if(i[o]instanceof Jt){let s=Kh(i[o].name,"enabled"),l=new lt(r,s);n&&(l=new Ti(r,l)),e=mn(r,e,l)}}return e}boxSpecificEnabled(e){let t=this.pageBox.scope,n=this.style,i=yx(t,n.required,t._false)!==t._false;if(i||this.isAutoHeight){let r=hT(t,n["flow-from"],"body"),o=new Qo(t,"has-content",[r]);e=mn(t,e,o)}if(e=this.processPartitionList(e,n["required-partitions"],!1),e=this.processPartitionList(e,n["conflicting-partitions"],!0),i){let r=this.pageMasterInstance.style.enabled,o=r?r.toExpr(t,null):t._true;o=mn(t,o,e),this.pageMasterInstance.style.enabled=new re(o)}return e}prepareContainer(e,t,n,i,r){var o;this.pageBox.pageMaster instanceof kx||(O(t.element,"overflow","hidden"),t.element.setAttribute("data-vivliostyle-page-partition",(o=this.pageBox.name)!=null?o:"")),super.prepareContainer(e,t,n,i,r)}},xp=class extends qs{constructor(e,t,n,i){super(e,t,!1),this.target=n,this.validatorSet=i}property(e,t,n){this.validatorSet.validatePropertyAndHandleShorthand(e,t,n,this)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}simpleProperty(e,t,n){this.target.specified[e]=new ke(t,n?My:zy)}},xx=class extends xp{constructor(e,t,n,i){super(e,t,n,i)}},fT=class bx extends xp{constructor(t,n,i,r){super(t,n,i,r),i.specified.width=new ke(rg,0),i.specified.height=new ke(rg,0)}startPartitionRule(t,n,i){let r=new Js(this.scope,t,n,i,this.target),o=new xx(this.scope,this.owner,r,this.validatorSet);this.owner.pushHandler(o)}startPartitionGroupRule(t,n,i){let r=new mx(this.scope,t,n,i,this.target),o=new bx(this.scope,this.owner,r,this.validatorSet);this.owner.pushHandler(o)}},gT=class extends xp{constructor(e,t,n,i){super(e,t,n,i)}startPartitionRule(e,t,n){let i=new Js(this.scope,e,t,n,this.target),r=new xx(this.scope,this.owner,i,this.validatorSet);this.owner.pushHandler(r)}startPartitionGroupRule(e,t,n){let i=new mx(this.scope,e,t,n,this.target),r=new fT(this.scope,this.owner,i,this.validatorSet);this.owner.pushHandler(r)}};function Sx(e){var t,n;let i=(t=e["writing-mode"])==null?void 0:t.value,r=(n=e.direction)==null?void 0:n.value;return i===S.vertical_lr||i!==S.vertical_rl&&r!==S.rtl?"ltr":"rtl"}var mT={a10:{width:new z(26,"mm"),height:new z(37,"mm")},a9:{width:new z(37,"mm"),height:new z(52,"mm")},a8:{width:new z(52,"mm"),height:new z(74,"mm")},a7:{width:new z(74,"mm"),height:new z(105,"mm")},a6:{width:new z(105,"mm"),height:new z(148,"mm")},a5:{width:new z(148,"mm"),height:new z(210,"mm")},a4:{width:new z(210,"mm"),height:new z(297,"mm")},a3:{width:new z(297,"mm"),height:new z(420,"mm")},a2:{width:new z(420,"mm"),height:new z(594,"mm")},a1:{width:new z(594,"mm"),height:new z(841,"mm")},a0:{width:new z(841,"mm"),height:new z(1189,"mm")},b10:{width:new z(31,"mm"),height:new z(44,"mm")},b9:{width:new z(44,"mm"),height:new z(62,"mm")},b8:{width:new z(62,"mm"),height:new z(88,"mm")},b7:{width:new z(88,"mm"),height:new z(125,"mm")},b6:{width:new z(125,"mm"),height:new z(176,"mm")},b5:{width:new z(176,"mm"),height:new z(250,"mm")},b4:{width:new z(250,"mm"),height:new z(353,"mm")},b3:{width:new z(353,"mm"),height:new z(500,"mm")},b2:{width:new z(500,"mm"),height:new z(707,"mm")},b1:{width:new z(707,"mm"),height:new z(1e3,"mm")},b0:{width:new z(1e3,"mm"),height:new z(1414,"mm")},c10:{width:new z(28,"mm"),height:new z(40,"mm")},c9:{width:new z(40,"mm"),height:new z(57,"mm")},c8:{width:new z(57,"mm"),height:new z(81,"mm")},c7:{width:new z(81,"mm"),height:new z(114,"mm")},c6:{width:new z(114,"mm"),height:new z(162,"mm")},c5:{width:new z(162,"mm"),height:new z(229,"mm")},c4:{width:new z(229,"mm"),height:new z(324,"mm")},c3:{width:new z(324,"mm"),height:new z(458,"mm")},c2:{width:new z(458,"mm"),height:new z(648,"mm")},c1:{width:new z(648,"mm"),height:new z(917,"mm")},c0:{width:new z(917,"mm"),height:new z(1297,"mm")},"jis-b10":{width:new z(32,"mm"),height:new z(45,"mm")},"jis-b9":{width:new z(45,"mm"),height:new z(64,"mm")},"jis-b8":{width:new z(64,"mm"),height:new z(91,"mm")},"jis-b7":{width:new z(91,"mm"),height:new z(128,"mm")},"jis-b6":{width:new z(128,"mm"),height:new z(182,"mm")},"jis-b5":{width:new z(182,"mm"),height:new z(257,"mm")},"jis-b4":{width:new z(257,"mm"),height:new z(364,"mm")},"jis-b3":{width:new z(364,"mm"),height:new z(515,"mm")},"jis-b2":{width:new z(515,"mm"),height:new z(728,"mm")},"jis-b1":{width:new z(728,"mm"),height:new z(1030,"mm")},"jis-b0":{width:new z(1030,"mm"),height:new z(1456,"mm")},letter:{width:new z(8.5,"in"),height:new z(11,"in")},legal:{width:new z(8.5,"in"),height:new z(14,"in")},ledger:{width:new z(11,"in"),height:new z(17,"in")}},vT=new z(.24,"pt");new z(3,"mm");var wT=new z(10,"mm"),yT=new z(13,"mm");function Fa(e){let t={width:Gs,height:Xs,bleed:Ve,bleedOffset:Ve,cropOffset:Ve},n=e.size;if(!(!n||n.value===S.auto)){let u=n.value,h,p;if(u.isSpaceList()?(h=u.values[0],p=u.values[1]):(h=u,p=null),h.isNumeric())t.width=h,t.height=p||h;else{let c=h.name&&mT[h.name.toLowerCase()];c&&(p&&p===S.landscape?(t.width=c.height,t.height=c.width):(t.width=c.width,t.height=c.height))}}let i=e.marks,r=e.bleed,o=i&&!Te(i.value)?i.value:S.none,s=r&&!Te(r.value)?r.value:S.auto;if(s===S.auto){if(o!==S.none){let u=!1;o.isSpaceList()?u=o.values.some(h=>h===S.crop):u=o===S.crop,u&&(t.bleed=new z(6,"pt"))}}else s.isNumeric()&&(t.bleed=s);let l=e["crop-offset"],a=l&&!Te(l.value)?l.value:S.auto;return a===S.auto?o!==S.none&&(t.bleedOffset=yT):a.isNumeric()&&(t.cropOffset=a),t}function nm(e,t){let n={},i=Math.max(0,e.bleed.num)*t.queryUnitSize(e.bleed.unit,!1),r=!e.cropOffset.num&&e.bleedOffset.num?e.bleedOffset.num*t.queryUnitSize(e.bleedOffset.unit,!1):Math.max(0,e.cropOffset.num*t.queryUnitSize(e.cropOffset.unit,!1)-i),o=i+r,s=e.width;s===Gs?t.pref.defaultPaperSize?n.pageWidth=t.pref.defaultPaperSize.width*t.queryUnitSize("px",!1):n.pageWidth=(t.pref.spreadView?Math.floor(t.viewportWidth/2)-t.pref.pageBorder:t.viewportWidth)-o*2:n.pageWidth=s.num*t.queryUnitSize(s.unit,!1);let l=e.height;return l===Xs?t.pref.defaultPaperSize?n.pageHeight=t.pref.defaultPaperSize.height*t.queryUnitSize("px",!1):n.pageHeight=t.viewportHeight-o*2:n.pageHeight=l.num*t.queryUnitSize(l.unit,!1),n.bleed=i,n.bleedOffset=r,n.cropOffset=o,n}function Cx(e,t,n){let i=e.createElementNS("http://www.w3.org/2000/svg","svg");return i.setAttribute("width",t),i.setAttribute("height",n),i.style.position="absolute",i}function ss(e,t,n,i){i=i||"polyline";let r=e.createElementNS("http://www.w3.org/2000/svg",i);return r.setAttribute("stroke",n===S.auto?"#010101":n.toString()),r.setAttribute("stroke-width",t),r.setAttribute("fill","none"),r}var Oc=(e=>(e.TOP_LEFT="top left",e.TOP_RIGHT="top right",e.BOTTOM_LEFT="bottom left",e.BOTTOM_RIGHT="bottom right",e))(Oc||{});function xT(e,t,n,i,r,o,s){let l=r;l<=o+2*$e.mm&&(l=o+r/2);let a=Math.max(r,l),u=o+a+n/2,h=Cx(e,u,u),p=[[0,o+r],[r,o+r],[r,o+r-l]],c=p.map(w=>[w[1],w[0]]);(t==="top right"||t==="bottom right")&&(p=p.map(w=>[o+a-w[0],w[1]]),c=c.map(w=>[o+a-w[0],w[1]])),(t==="bottom left"||t==="bottom right")&&(p=p.map(w=>[w[0],o+a-w[1]]),c=c.map(w=>[w[0],o+a-w[1]]));let f=ss(e,n,i);f.setAttribute("points",p.map(w=>w.join(",")).join(" ")),h.appendChild(f);let v=ss(e,n,i);return v.setAttribute("points",c.map(w=>w.join(",")).join(" ")),h.appendChild(v),t.split(" ").forEach(w=>{h.style[w]=`${s}px`}),h}var _s=(e=>(e.TOP="top",e.BOTTOM="bottom",e.LEFT="left",e.RIGHT="right",e))(_s||{});function bT(e,t,n,i,r,o){let s=r*2,l,a;t==="top"||t==="bottom"?(l=s,a=r):(l=r,a=s);let u=Cx(e,l,a),h=ss(e,n,i);h.setAttribute("points",`0,${a/2} ${l},${a/2}`),u.appendChild(h);let p=ss(e,n,i);p.setAttribute("points",`${l/2},0 ${l/2},${a}`),u.appendChild(p);let c=ss(e,n,i,"circle");c.setAttribute("cx",l/2),c.setAttribute("cy",a/2),c.setAttribute("r",r/4),u.appendChild(c);let f;switch(t){case"top":f="bottom";break;case"bottom":f="top";break;case"left":f="right";break;case"right":f="left";break}return Object.keys(_s).forEach(v=>{let w=_s[v];w===t?u.style[w]=`${o}px`:w!==f&&(u.style[w]="0",u.style[`margin-${w}`]="auto")}),u}function ST(e,t,n,i){let r=!1,o=!1,s=e.marks;if(s){let w=s.value;w instanceof Ge?w.values.forEach(x=>{x===S.crop?r=!0:x===S.cross&&(o=!0)}):w===S.crop?r=!0:w===S.cross&&(o=!0)}let l=t.bleed;if(!r&&!o)return;let a=n.container,u=a.ownerDocument,h=Ft(vT,i),p=Math.max(0,t.bleedOffset-Ft(wT,i)),c=t.bleedOffset-p,f=e["crop-marks-line-color"],v=f&&!Te(f.value)?f.value:S.auto;r&&Object.keys(Oc).forEach(w=>{let x=Oc[w],g=xT(u,x,h,v,c,l,p);a.appendChild(g)}),o&&Object.keys(_s).forEach(w=>{let x=_s[w],g=bT(u,x,h,v,c,p);a.appendChild(g)})}var Bc=(()=>{let e=["left","right","top","bottom","before","after","start","end","block-start","block-end","inline-start","inline-end","inside","outside"],t={width:!0,height:!0,"block-size":!0,"inline-size":!0,margin:!0,padding:!0,border:!0,outline:!0,"outline-width":!0,"outline-style":!0,"outline-color":!0,"border-radius":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-bottom-right-radius":!0,"border-bottom-left-radius":!0,"border-start-start-radius":!0,"border-start-end-radius":!0,"border-end-start-radius":!0,"border-end-end-radius":!0,"box-shadow":!0,"box-sizing":!0};return e.forEach(n=>{t[`margin-${n}`]=!0,t[`padding-${n}`]=!0,t[`border-${n}-width`]=!0,t[`border-${n}-style`]=!0,t[`border-${n}-color`]=!0}),t})(),bp={"top-left-corner":{order:1,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:null},"top-left":{order:2,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"start"},"top-center":{order:3,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"center"},"top-right":{order:4,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"end"},"top-right-corner":{order:5,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:null},"right-top":{order:6,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:"start"},"right-middle":{order:7,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:"center"},"right-bottom":{order:8,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:"end"},"bottom-right-corner":{order:9,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:null},"bottom-right":{order:10,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"end"},"bottom-center":{order:11,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"center"},"bottom-left":{order:12,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"start"},"bottom-left-corner":{order:13,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:null},"left-bottom":{order:14,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:"end"},"left-middle":{order:15,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:"center"},"left-top":{order:16,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:"start"}},CT=(()=>{let e=bp;return Object.keys(e).sort((t,n)=>e[t].order-e[n].order)})(),Sp="vivliostyle-page-rule-master",Ms="_marginBoxes",kx=class extends fx{constructor(e,t,n){super(e,null,Sp,[],t,null,0),d(this,"pageMarginBoxes",{});let i=Fa(n);new kT(this.scope,this,n,i),this.createPageMarginBoxes(n),this.applySpecified(n,i)}createPageMarginBoxes(e){let t=e[Ms];t&&CT.forEach(n=>{t[n]&&(this.pageMarginBoxes[n]=new PT(this.scope,this,n,e))})}applySpecified(e,t){this.specified.position=new ke(S.relative,0),this.specified.width=new ke(t.width,0),this.specified.height=new ke(t.height,0);for(let n in e)!Bc[n]&&n!=="background-clip"&&(this.specified[n]=e[n])}createInstance(e){return new ls(e,this)}},kT=class extends Js{constructor(e,t,n,i){super(e,null,null,[],t),this.pageSize=i,new ET(this.scope,this),this.applySpecified(n)}applySpecified(e){this.specified["wrap-flow"]=new ke(S.auto,0),this.specified["z-index"]=new ke(new ar(0),0),this.specified.position=new ke(S.absolute,0),this.specified.overflow=new ke(S.visible,0);for(let t in Bc)Bc.hasOwnProperty(t)&&(this.specified[t]=e[t])}createInstance(e){return new TT(e,this)}},ET=class extends Js{constructor(e,t){super(e,null,null,[],t),this.specified["flow-from"]=new ke(q("body"),0)}createInstance(e){return new Ex(e,this)}},PT=class extends Js{constructor(e,t,n,i){super(e,null,null,[],t),this.marginBoxName=n,this.applySpecified(i)}applySpecified(e){let t=e[Ms][this.marginBoxName];for(let n in e){let i=e[n],r=t[n];(p0[n]||r&&r.value===S.inherit)&&(this.specified[n]=i)}for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let i=t[n];i&&i.value!==fe&&i.value!==S.inherit&&i.value!==S.unset&&i.value!==S.revert&&(this.specified[n]=i)}}createInstance(e){return new IT(e,this)}},ls=class extends yp{constructor(e,t){super(e,t),d(this,"pageAreaDimension",null),d(this,"pageMarginBoxInstances",{})}applyCascadeAndInit(e,t){let n=this.cascaded;for(let i in t)if(Object.prototype.hasOwnProperty.call(t,i))switch(i){case"writing-mode":case"direction":n[i]=t[i]}super.applyCascadeAndInit(e,t)}initHorizontal(){let e=this.style;e.left=Ve,e["margin-left"]=Ve,e["border-left-width"]=Ve,e["padding-left"]=Ve,e["padding-right"]=Ve,e["border-right-width"]=Ve,e["margin-right"]=Ve,e.right=Ve}initVertical(){let e=this.style;e.top=Ve,e["margin-top"]=Ve,e["border-top-width"]=Ve,e["padding-top"]=Ve,e["padding-bottom"]=Ve,e["border-bottom-width"]=Ve,e["margin-bottom"]=Ve,e.bottom=Ve}setPageAreaDimension(e){this.pageAreaDimension=e;let t=this.style;t.width=new re(e.borderBoxWidth),t.height=new re(e.borderBoxHeight),t["padding-left"]=new re(e.marginLeft),t["padding-right"]=new re(e.marginRight),t["padding-top"]=new re(e.marginTop),t["padding-bottom"]=new re(e.marginBottom)}adjustPageLayout(e,t,n){let i=t.marginBoxes,r={start:this.pageAreaDimension.marginLeft,end:this.pageAreaDimension.marginRight,extent:this.pageAreaDimension.borderBoxWidth},o={start:this.pageAreaDimension.marginTop,end:this.pageAreaDimension.marginBottom,extent:this.pageAreaDimension.borderBoxHeight};this.sizeMarginBoxesAlongVariableDimension(i.top,!0,r,e,n),this.sizeMarginBoxesAlongVariableDimension(i.bottom,!0,r,e,n),this.sizeMarginBoxesAlongVariableDimension(i.left,!1,o,e,n),this.sizeMarginBoxesAlongVariableDimension(i.right,!1,o,e,n)}sizeMarginBoxesAlongVariableDimension(e,t,n,i,r){let o="start",s="center",l="end",a=this.pageBox.scope,u={},h={},p={};for(let y in e){let C=bp[y];if(C){let P=e[y],A=this.pageMarginBoxInstances[y],I=new Xl(P,A.style,t,a,r);u[C.positionAlongVariableDimension]=P,h[C.positionAlongVariableDimension]=A,p[C.positionAlongVariableDimension]=I}}let c={start:n.start.evaluate(i),end:n.end.evaluate(i),extent:n.extent.evaluate(i)},f=this.getSizesOfMarginBoxesAlongVariableDimension(p,c.extent),v=!1,w={};Object.keys(u).forEach(y=>{let C=y,P=Oe(a,h[C].style[t?"max-width":"max-height"],n.extent);if(P){let A=P.evaluate(i);if(f[C]>A){let I=p[C]=new im(u[C],h[C].style,t,a,r,A);w[C]=I.getOuterSize(),v=!0}}}),v&&(f=this.getSizesOfMarginBoxesAlongVariableDimension(p,c.extent),v=!1,[o,s,l].forEach(y=>{var C;f[y]=(C=w[y])!=null?C:f[y]}));let x={};Object.keys(u).forEach(y=>{let C=y,P=Oe(a,h[C].style[t?"min-width":"min-height"],n.extent);if(P){let A=P.evaluate(i);if(f[C]<A){let I=p[C]=new im(u[C],h[C].style,t,a,r,A);x[C]=I.getOuterSize(),v=!0}}}),v&&(f=this.getSizesOfMarginBoxesAlongVariableDimension(p,c.extent),[o,s,l].forEach(y=>{f[y]=x[y]||f[y]}));let g=c.start+c.extent,m=c.start+(c.start+c.extent);[o,s,l].forEach(y=>{let C=f[y];if(C!=null){let P=u[y],A=0;switch(y){case o:A=t?P.left:P.top;break;case s:A=(m-C)/2;break;case l:A=g-C;break}t?P.setHorizontalPosition(A,C-P.getInsetLeft()-P.getInsetRight()):P.setVerticalPosition(A,C-P.getInsetTop()-P.getInsetBottom())}})}getSizesOfMarginBoxesAlongVariableDimension(e,t){var n;let i=e.start,r=e.center,o=e.end,s={};if(r){let l=[i,o],a=new NT(l),u=this.distributeAutoMarginBoxSizes(r,a,t);u.xSize!=null&&(s.center=u.xSize);let h=(n=u.xSize)!=null?n:r.getOuterSize(),p=Math.max((t-h)/2,0);i&&(s.start=i.hasAutoSize()?p:i.getOuterSize()),o&&(s.end=o.hasAutoSize()?p:o.getOuterSize())}else{let l=this.distributeAutoMarginBoxSizes(i,o,t);l.xSize!=null&&(s.start=l.xSize),l.ySize!=null&&(s.end=l.ySize)}return s}distributeAutoMarginBoxSizes(e,t,n){let i={xSize:null,ySize:null};if(e instanceof Xl&&e.minMaxFitContent&&(i.xSize=e.getOuterSize()),t instanceof Xl&&t.minMaxFitContent&&(i.ySize=t.getOuterSize()),e&&t)if(e.hasAutoSize()&&t.hasAutoSize()){let r=e.getOuterMaxContentSize(),o=t.getOuterMaxContentSize();if(r>0&&o>0){let s=r+o;if(s<n)i.xSize=n*r/s;else{let l=e.getOuterMinContentSize(),a=t.getOuterMinContentSize(),u=l+a;u<n?i.xSize=l+(n-u)*(r-l)/(s-u):u>0&&(i.xSize=n*l/u)}i.xSize>0&&(i.ySize=n-i.xSize)}else r>0?i.xSize=n:o>0&&(i.ySize=n)}else e.hasAutoSize()?i.xSize=Math.max(n-t.getOuterSize(),0):t.hasAutoSize()&&(i.ySize=Math.max(n-e.getOuterSize(),0));else e?e.hasAutoSize()&&(i.xSize=n):t&&t.hasAutoSize()&&(i.ySize=n);return i}prepareContainer(e,t,n,i,r){t.element.setAttribute("data-vivliostyle-page-box",!0),super.prepareContainer(e,t,n,i,r)}},Xl=class{constructor(e,t,n,i,r){this.container=e,this.isHorizontal=n,this.clientLayout=r,d(this,"hasAutoSize_"),d(this,"size",null),d(this,"minMaxFitContent",null);let o=t[n?"width":"height"];if(this.hasAutoSize_=!o||o===S.auto||Te(o),this.minMaxFitContent=o instanceof Jt&&(o.name==="min-content"||o.name==="max-content"||o.name==="fit-content")?o.name:null,this.minMaxFitContent){let s=this.getSize();if(this.isHorizontal){let l=s[this.minMaxFitContent==="min-content"?"min-content width":this.minMaxFitContent==="max-content"?"max-content width":"fit-content width"];this.container.setHorizontalPosition(this.container.left,l)}else{let l=s[this.minMaxFitContent==="min-content"?"min-content height":this.minMaxFitContent==="max-content"?"max-content height":"fit-content height"];this.container.setVerticalPosition(this.container.top,l)}}}hasAutoSize(){return this.hasAutoSize_}getSize(){if(!this.size){let e=this.isHorizontal?["max-content width","min-content width","fit-content width"]:["max-content height","min-content height","fit-content height"];this.size=Zd(this.clientLayout,this.container.element,e)}return this.size}getOuterMaxContentSize(){let e=this.getSize();return this.isHorizontal?this.container.getInsetLeft()+e["max-content width"]+this.container.getInsetRight():this.container.getInsetTop()+e["max-content height"]+this.container.getInsetBottom()}getOuterMinContentSize(){let e=this.getSize();return this.isHorizontal?this.container.getInsetLeft()+e["min-content width"]+this.container.getInsetRight():this.container.getInsetTop()+e["min-content height"]+this.container.getInsetBottom()}getOuterSize(){return this.isHorizontal?this.container.getInsetLeft()+this.container.width+this.container.getInsetRight():this.container.getInsetTop()+this.container.height+this.container.getInsetBottom()}},NT=class{constructor(e){this.params=e}hasAutoSize(){return this.params.some(e=>{var t;return(t=e==null?void 0:e.hasAutoSize())!=null?t:!1})}getOuterMaxContentSize(){let e=this.params.map(t=>{var n;return(n=t==null?void 0:t.getOuterMaxContentSize())!=null?n:0});return Math.max.apply(null,e)*e.length}getOuterMinContentSize(){let e=this.params.map(t=>{var n;return(n=t==null?void 0:t.getOuterMinContentSize())!=null?n:0});return Math.max.apply(null,e)*e.length}getOuterSize(){let e=this.params.map(t=>{var n;return(n=t==null?void 0:t.getOuterSize())!=null?n:0});return Math.max.apply(null,e)*e.length}},im=class extends Xl{constructor(e,t,n,i,r,o){super(e,t,n,i,r),d(this,"fixedSize"),this.fixedSize=o}hasAutoSize(){return!1}getOuterMaxContentSize(){return this.getOuterSize()}getOuterMinContentSize(){return this.getOuterSize()}getOuterSize(){return this.isHorizontal?this.container.getInsetLeft()+this.fixedSize+this.container.getInsetRight():this.container.getInsetTop()+this.fixedSize+this.container.getInsetBottom()}},TT=class extends el{constructor(e,t){super(e,t),d(this,"borderBoxWidth",null),d(this,"borderBoxHeight",null),d(this,"contentBoxWidth",null),d(this,"contentBoxHeight",null),d(this,"marginTop",null),d(this,"marginRight",null),d(this,"marginBottom",null),d(this,"marginLeft",null)}applyCascadeAndInit(e,t){for(let n in t)n.match(/^background-/)&&(this.cascaded[n]=t[n]);super.applyCascadeAndInit(e,t),this.parentInstance.setPageAreaDimension({borderBoxWidth:this.borderBoxWidth,borderBoxHeight:this.borderBoxHeight,marginTop:this.marginTop,marginRight:this.marginRight,marginBottom:this.marginBottom,marginLeft:this.marginLeft})}initHorizontal(){let e=this.resolvePageBoxDimensions({start:"left",end:"right",extent:"width"});this.borderBoxWidth=e.borderBoxExtent,this.contentBoxWidth=e.contentBoxExtent,this.marginLeft=e.marginStart,this.marginRight=e.marginEnd}initVertical(){let e=this.resolvePageBoxDimensions({start:"top",end:"bottom",extent:"height"});this.borderBoxHeight=e.borderBoxExtent,this.contentBoxHeight=e.contentBoxExtent,this.marginTop=e.marginStart,this.marginBottom=e.marginEnd}resolvePageBoxDimensions(e){let t=this.style,n=this.pageBox.pageSize,i=this.pageBox.scope,r=e.start,o=e.end,s=e.extent,l=n[s].toExpr(i,null),a=Oe(i,t[s],l),u=Oe(i,t[`margin-${r}`],l),h=Oe(i,t[`margin-${o}`],l),p=Yt(i,t[`padding-${r}`],l),c=Yt(i,t[`padding-${o}`],l),f=$n(i,t[`border-${r}-width`],t[`border-${r}-style`],l),v=$n(i,t[`border-${o}-width`],t[`border-${o}-style`],l),w=Ce(i,Ce(i,f,p),Ce(i,v,c)),x,g,m;return a?(this.borderBoxSizing?(g=a,m=Fe(i,g,w)):(m=a,g=Ce(i,m,w)),x=Fe(i,l,g),!u&&!h?(u=Vl(i,x,new dt(i,.5)),h=u):u?h=Fe(i,x,u):u=Fe(i,x,h)):(u||(u=i.zero),h||(h=i.zero),x=Ce(i,u,h),g=Fe(i,l,x),m=Fe(i,g,w),a=this.borderBoxSizing?g:m),t[r]=new re(u),t[o]=new re(h),t[`margin-${r}`]=Ve,t[`margin-${o}`]=Ve,t[`border-${r}-width`]=new re(f),t[`border-${o}-width`]=new re(v),t[`padding-${r}`]=new re(p),t[`padding-${o}`]=new re(c),t[s]=new re(a),t[`max-${s}`]=new re(a),{borderBoxExtent:g,contentBoxExtent:m,marginStart:u,marginEnd:h}}prepareContainer(e,t,n,i,r){t.element.setAttribute("data-vivliostyle-page-area-container",!0),super.prepareContainer(e,t,n,i,r),O(t.element,"position","relative"),O(t.element,"inset",""),O(t.element,"display","flow-root")}},Ex=class extends el{constructor(e,t){super(e,t)}applyCascadeAndInit(e,t){for(let n in t)n.match(/^column.*$/)&&(this.cascaded[n]=t[n]);super.applyCascadeAndInit(e,{})}initHorizontal(){let e=this.style,t=this.parentInstance.style,n=this.pageBox.scope;e.left=t["padding-left"],e.width=new re(this.parentInstance.contentBoxWidth),e["margin-left"]=new re(new Ar(n,t.left.toExpr(n,null))),e["margin-right"]=new re(new Ar(n,t.right.toExpr(n,null))),e["border-left-width"]=t.left,e["border-right-width"]=t.right,e["border-left-style"]=S.solid,e["border-right-style"]=S.solid,e["border-left-color"]=S.transparent,e["border-right-color"]=S.transparent}initVertical(){let e=this.style,t=this.parentInstance.style,n=this.pageBox.scope;e.top=t["padding-top"],e.height=new re(this.parentInstance.contentBoxHeight),e["margin-top"]=new re(new Ar(n,t.top.toExpr(n,null))),e["margin-bottom"]=new re(new Ar(n,t.bottom.toExpr(n,null))),e["border-top-width"]=t.top,e["border-bottom-width"]=t.bottom,e["border-top-style"]=S.solid,e["border-bottom-style"]=S.solid,e["border-top-color"]=S.transparent,e["border-bottom-color"]=S.transparent}prepareContainer(e,t,n,i,r){t.element.setAttribute("data-vivliostyle-page-area",!0),n.pageAreaElement=t.element,super.prepareContainer(e,t,n,i,r),e.pageAreaWidth=parseFloat(n.pageAreaElement.style.width),e.pageAreaHeight=parseFloat(n.pageAreaElement.style.height),O(t.element,"position","relative"),O(t.element,"inset",""),O(t.element,"display","flow-root")}},IT=class extends el{constructor(e,t){super(e,t),d(this,"boxInfo"),d(this,"suppressEmptyBoxGeneration",!0);let n=t.marginBoxName;this.boxInfo=bp[n];let i=e;i.pageMarginBoxInstances[n]=this}prepareContainer(e,t,n,i,r){t.element.setAttribute("data-vivliostyle-page-margin-box",this.pageBox.marginBoxName),this.applyVerticalAlign(e,t.element),super.prepareContainer(e,t,n,i,r)}applyVerticalAlign(e,t){O(t,"display","flex"),O(t,"flex-flow",this.vertical?this.rtl?"row-reverse":"row":"column");let n=this.getProp(e,"vertical-align"),i=null;n===q("middle")?i="center":n===q("top")?i="flex-start":n===q("bottom")&&(i="flex-end"),i&&O(t,"justify-content",i);let r=this.getProp(e,"content");if(this.vertical||r instanceof Nn||r instanceof re&&r.expr instanceof mt&&r.expr.str.startsWith("running-element-")){let o="center";(this.boxInfo.isInTopRow||this.boxInfo.isInBottomRow)&&(this.boxInfo.isInLeftColumn||this.boxInfo.positionAlongVariableDimension==="end"?o=this.vertical||this.rtl?"start":"end":(this.boxInfo.isInRightColumn||this.boxInfo.positionAlongVariableDimension==="start")&&(o=this.vertical||this.rtl?"end":"start")),O(t,"align-items",o)}}positionAlongVariableDimension(e,t){let n=this.style,i=this.pageBox.scope,r=e.start,o=e.end,s=e.extent,l=r==="left",a=l?t.borderBoxWidth:t.borderBoxHeight,u=Oe(i,n[s],a),h=l?t.marginLeft:t.marginTop;if(this.boxInfo.positionAlongVariableDimension==="start")n[r]=new re(h);else if(u){let p=Yt(i,n[`margin-${r}`],a),c=Yt(i,n[`margin-${o}`],a),f=Yt(i,n[`padding-${r}`],a),v=Yt(i,n[`padding-${o}`],a),w=$n(i,n[`border-${r}-width`],n[`border-${r}-style`],a),x=$n(i,n[`border-${o}-width`],n[`border-${o}-style`],a),g=Ce(i,u,Ce(i,this.borderBoxSizing?i.zero:Ce(i,Ce(i,f,v),Ce(i,w,x)),Ce(i,p,c)));switch(this.boxInfo.positionAlongVariableDimension){case"center":n[r]=new re(Ce(i,h,ec(i,Fe(i,a,g),new dt(i,2))));break;case"end":n[r]=new re(Fe(i,Ce(i,h,a),g));break}}}positionAndSizeAlongFixedDimension(e,t){let n=this.style,i=this.pageBox.scope,r=this.borderBoxSizing,o=e.inside,s=e.outside,l=e.extent,a=t[`margin${s.charAt(0).toUpperCase()}${s.substring(1)}`],u=Kg(i,n[`margin-${o}`],a),h=Kg(i,n[`margin-${s}`],a),p=Yt(i,n[`padding-${o}`],a),c=Yt(i,n[`padding-${s}`],a),f=$n(i,n[`border-${o}-width`],n[`border-${o}-style`],a),v=$n(i,n[`border-${s}-width`],n[`border-${s}-style`],a),w=Oe(i,n[l],a),x=null;function g(m){if(x)return x;x={extent:w?w.evaluate(m):null,marginInside:u?u.evaluate(m):null,marginOutside:h?h.evaluate(m):null};let y=a.evaluate(m),C=0;return r||[f,p,c,v].forEach(P=>{P&&(C+=P.evaluate(m))}),(x.marginInside===null||x.marginOutside===null)&&C+x.extent+x.marginInside+x.marginOutside>y&&(x.marginInside===null&&(x.marginInside=0),x.marginOutside===null&&(x.marginOutside=0)),x.extent!==null&&x.marginInside!==null&&x.marginOutside!==null&&(x.marginOutside=null),x.extent===null?(x.extent=y-C-x.marginInside-x.marginOutside,x.marginInside===null&&(x.marginInside=0),x.marginOutside===null&&(x.marginOutside=0)):typeof x.extent=="number"&&(x.marginInside===null&&typeof x.marginOutside=="number"?x.marginInside=y-C-x.extent-x.marginOutside:typeof x.marginInside=="number"&&x.marginOutside===null?x.marginOutside=y-C-x.extent-x.marginInside:x.marginInside=x.marginOutside=(y-C-x.extent)/2),x}n[l]=new re(new mt(i,function(){let m=g(this).extent;return m===null?"auto":m},l)),n[`margin-${o}`]=new re(new mt(i,function(){let m=g(this).marginInside;return m===null?"auto":m},`margin-${o}`)),n[`margin-${s}`]=new re(new mt(i,function(){let m=g(this).marginOutside;return m===null?"auto":m},`margin-${s}`)),o==="left"?n.left=new re(Ce(i,t.marginLeft,t.borderBoxWidth)):o==="top"&&(n.top=new re(Ce(i,t.marginTop,t.borderBoxHeight)))}initHorizontal(){let e=this.parentInstance.pageAreaDimension;this.boxInfo.isInLeftColumn?this.positionAndSizeAlongFixedDimension({inside:"right",outside:"left",extent:"width"},e):this.boxInfo.isInRightColumn?this.positionAndSizeAlongFixedDimension({inside:"left",outside:"right",extent:"width"},e):this.positionAlongVariableDimension({start:"left",end:"right",extent:"width"},e)}initVertical(){let e=this.parentInstance.pageAreaDimension;this.boxInfo.isInTopRow?this.positionAndSizeAlongFixedDimension({inside:"bottom",outside:"top",extent:"height"},e):this.boxInfo.isInBottomRow?this.positionAndSizeAlongFixedDimension({inside:"top",outside:"bottom",extent:"height"},e):this.positionAlongVariableDimension({start:"top",end:"bottom",extent:"height"},e)}finishContainer(e,t,n,i,r,o,s){super.finishContainer(e,t,n,i,r,o,s);let l=n.marginBoxes,a=this.pageBox.marginBoxName,u=this.boxInfo;!u.isInLeftColumn&&!u.isInRightColumn?u.isInTopRow?l.top[a]=t:u.isInBottomRow&&(l.bottom[a]=t):!u.isInTopRow&&!u.isInBottomRow&&(u.isInLeftColumn?l.left[a]=t:u.isInRightColumn&&(l.right[a]=t));let h=this.parentInstance.pageAreaDimension,p=this.getProp(e,"width"),c=p instanceof Jt&&(p.name==="min-content"||p.name==="max-content"||p.name==="fit-content")?p.name:null,f=this.getPropAsNumber(e,"min-width"),v=this.getPropAsNumber(e,"max-width");if(c||f||v){c&&O(t.element,"width",c),f&&O(t.element,"min-width",`${f}px`),v&&O(t.element,"max-width",`${v}px`);let y=this.getProp(e,"margin-left"),C=this.getProp(e,"margin-right");if(u.isInLeftColumn){let P=h.borderBoxWidth.evaluate(e)+h.marginRight.evaluate(e);O(t.element,"right",`${P}px`),(y===S.auto||C!==S.auto)&&O(t.element,"margin-left","auto"),C===S.auto&&O(t.element,"margin-right","auto")}else u.isInRightColumn&&(O(t.element,"right","0"),(C===S.auto||y!==S.auto)&&O(t.element,"margin-right","auto"),y===S.auto&&O(t.element,"margin-left","auto"))}let w=this.getProp(e,"height"),x=w instanceof Jt&&(w.name==="min-content"||w.name==="max-content"||w.name==="fit-content")?w.name:null,g=this.getPropAsNumber(e,"min-height"),m=this.getPropAsNumber(e,"max-height");if(x||g||m){x&&O(t.element,"height",x),g&&O(t.element,"min-height",`${g}px`),m&&O(t.element,"max-height",`${m}px`);let y=this.getProp(e,"margin-top"),C=this.getProp(e,"margin-bottom");if(u.isInTopRow){let P=h.borderBoxHeight.evaluate(e)+h.marginBottom.evaluate(e);O(t.element,"bottom",`${P}px`),(y===S.auto||C!==S.auto)&&O(t.element,"margin-top","auto"),C===S.auto&&O(t.element,"margin-bottom","auto")}else u.isInBottomRow&&(O(t.element,"bottom","0"),(C===S.auto||y!==S.auto)&&O(t.element,"margin-bottom","auto"),y===S.auto&&O(t.element,"margin-top","auto"))}}},RT=class{constructor(e,t,n,i,r){this.cascadeInstance=e,this.pageScope=t,this.rootPageBoxInstance=n,this.context=i,this.docElementStyle=r,d(this,"pageMasterCache",{}),this.definePageProgression()}definePageProgression(){let e=this.pageScope,t=this.context,n=t.isVersoFirstPage,i=new lt(e,"page-number"),r=new jd(e,new sy(e,i,new dt(e,2)),n?e.one:e.zero);e.defineName("recto-page",new Ti(e,r)),e.defineName("verso-page",r),(t.pageProgression||Sx(this.docElementStyle))==="ltr"?(e.defineName("left-page",r),e.defineName("right-page",new Ti(e,r))):(e.defineName("left-page",new Ti(e,r)),e.defineName("right-page",r))}getCascadedPageStyle(e){let t={};return this.cascadeInstance.pushRule([],e,t),this.cascadeInstance.popRule(),t}getPageRulePageMaster(e,t){let n=e.pageBox;if(Object.keys(t).length===0)return n.resetScope(),e;let i=this.makeCacheKey(t,n),r=this.pageMasterCache[i];return r||(n.pseudoName===wp?r=this.generatePageRuleMaster(t):r=this.generateCascadedPageMaster(t,n),this.pageMasterCache[i]=r),r.pageBox.resetScope(),r}makeCacheKey(e,t){var n;let i=this.makeCascadeValueObjectKey(e),r=((n=this.context.currentLayoutPosition)==null?void 0:n.page)%2;return`${t.key}^${i}^${r}`}makeCascadeValueObjectKey(e){let t=[];for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let i=e[n],r;i instanceof ke?r=`${i.value}`:r=this.makeCascadeValueObjectKey(i),t.push(n+r+(i.priority||""))}return t.sort().join("^")}generatePageRuleMaster(e){let t=new kx(this.pageScope,this.rootPageBoxInstance.pageBox,e).createInstance(this.rootPageBoxInstance);return t.applyCascadeAndInit(this.cascadeInstance,this.docElementStyle),t.resolveAutoSizing(this.context),t}generateCascadedPageMaster(e,t){let n=t.clone({pseudoName:Sp}),i=n.specified,r=e.size;if(r&&!Te(r.value)){let s=Fa(e),l=r.priority;ri(i,"width",new ke(s.width,l),this.context),ri(i,"height",new ke(s.height,l),this.context)}["counter-reset","counter-increment"].forEach(s=>{i[s]&&(e[s]=i[s])});let o=n.createInstance(this.rootPageBoxInstance);return o.applyCascadeAndInit(this.cascadeInstance,this.docElementStyle),o.resolveAutoSizing(this.context),o}},AT=class extends ze{constructor(e){super(),this.pageType=e}apply(e){e.currentPageType===this.pageType&&this.chained.apply(e)}getPriority(){return 3}makePrimary(e){return this.chained&&e.insertInTable(e.pagetypes,this.pageType,this.chained),!0}},LT=class extends ze{constructor(e){super(),this.scope=e}apply(e){new lt(this.scope,"page-number").evaluate(e.context)===1&&this.chained.apply(e)}getPriority(){return 2}},FT=class extends ze{constructor(e){super(),this.scope=e}apply(e){new lt(this.scope,"blank-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 2}},OT=class extends ze{constructor(e){super(),this.scope=e}apply(e){new lt(this.scope,"left-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},BT=class extends ze{constructor(e){super(),this.scope=e}apply(e){new lt(this.scope,"right-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},_T=class extends ze{constructor(e){super(),this.scope=e}apply(e){new lt(this.scope,"recto-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},MT=class extends ze{constructor(e){super(),this.scope=e}apply(e){new lt(this.scope,"verso-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},zT=class extends Zs{constructor(e,t,n){super(t,n),this.scope=e,this.a=t,this.b=n}apply(e){let t=e.context,n=t.layoutPositionAtPageStart.page;t.blankPageAtStart&&n--,n&&this.matchANPlusB(n)&&this.chained.apply(e)}getPriority(){return 2}},$T=class extends lp{constructor(e,t){super(e,t,null,null,null)}apply(e){DT(e.context,e.currentStyle,this.style,this.specificity)}};function DT(e,t,n,i,r){Ia(e,t,n,i,null,null,null);let o=n[Ms];if(o){let s=ou(t,Ms);for(let l in o)if(o.hasOwnProperty(l)){let a=s[l];a||(a={},s[l]=a),Ia(e,a,o[l],i,null,null,null)}}}var VT=class extends As{constructor(e,t,n,i,r){super(e,t,n==null?void 0:n.condition,n,null,i,!1),this.pageProps=r,d(this,"currentPageSelectors",[]),d(this,"currentNamedPageSelector",""),d(this,"currentPseudoPageClassSelectors",[])}startPageRule(){this.startSelectorRule()}tagSelector(e,t){this.currentNamedPageSelector=t,t&&(this.chain.push(new AT(t)),this.specificity+=65536)}pseudoclassSelector(e,t){if(e=e.toLowerCase(),t)switch(e){case"nth":{let[n,i]=t;this.currentPseudoPageClassSelectors.push(`:${e}(${n}n${i<0?i:"+"+i})`),this.chain.push(new zT(this.scope,n,i)),this.specificity+=256}break;default:this.reportAndSkip(`E_INVALID_PAGE_SELECTOR :${e}(${t.join("")})`);break}else switch(this.currentPseudoPageClassSelectors.push(`:${e}`),e){case"first":this.chain.push(new LT(this.scope)),this.specificity+=256;break;case"blank":this.chain.push(new FT(this.scope)),this.specificity+=256;break;case"left":this.chain.push(new OT(this.scope)),this.specificity+=1;break;case"right":this.chain.push(new BT(this.scope)),this.specificity+=1;break;case"recto":this.chain.push(new _T(this.scope)),this.specificity+=1;break;case"verso":this.chain.push(new MT(this.scope)),this.specificity+=1;break;default:this.reportAndSkip(`E_INVALID_PAGE_SELECTOR :${e}`);break}}finishSelector(){let e;!this.currentNamedPageSelector&&!this.currentPseudoPageClassSelectors.length?e=null:e=[this.currentNamedPageSelector].concat(this.currentPseudoPageClassSelectors.sort()),this.currentPageSelectors.push({selectors:e,specificity:this.specificity}),this.currentNamedPageSelector="",this.currentPseudoPageClassSelectors=[]}nextSelector(){this.finishSelector(),super.nextSelector()}startRuleBody(){this.finishSelector(),super.startRuleBody()}simpleProperty(e,t,n){if((e==="bleed"||e==="marks")&&!this.currentPageSelectors.some(o=>o.selectors===null))return;super.simpleProperty(e,t,n);let i=xt(this.elementStyle,e),r=this.pageProps;if(e==="bleed"||e==="marks")r[""]||(r[""]={}),Object.keys(r).forEach(o=>{er(r[o],e,i)});else if(e==="size"){let o=r[""];this.currentPageSelectors.forEach(s=>{let l=new ke(i.value,i.priority+s.specificity),a=s.selectors?s.selectors.join(""):"",u=r[a];u?ri(u,e,l):(u=r[a]={},er(u,e,l),o&&["bleed","marks"].forEach(h=>{o[h]&&er(u,h,o[h])}))})}}insertNonPrimary(e){this.cascade.insertInTable(this.cascade.pagetypes,"*",e)}makeApplyRuleAction(e){return new $T(this.elementStyle,e)}startPageMarginBoxRule(e){let t=ou(this.elementStyle,Ms),n=t[e];n||(n={},t[e]=n);let i=new UT(this.scope,this.owner,this.validatorSet,n);this.owner.pushHandler(i)}},UT=class extends qs{constructor(e,t,n,i){super(e,t,!1),this.validatorSet=n,this.boxStyle=i}property(e,t,n){this.validatorSet.validatePropertyAndHandleShorthand(e,t,n,this)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}simpleProperty(e,t,n){let i=n?this.getImportantSpecificity():this.getBaseSpecificity(),r=new ke(t,i);er(this.boxStyle,e,r)}},oi=!0;function HT(e){oi=e}var tr=[];function rm(e,t){return e===t||(e.src||t.src?e.src===t.src:e.textContent===t.textContent)}function Px(e){let t=Array.from(e.querySelectorAll("body > :not(script):not(link):not(style) ~ script"));return Array.from(e.querySelectorAll("head > script, body > script")).filter(n=>!t.includes(n))}function Cp(e,t,n){var i,r;if(!oi||!(n!=null&&n.inHead)&&!(n!=null&&n.atEnd)&&Px(e.ownerDocument).includes(e))return R(!1);let o=e.textContent,s=e.src,l=e.type==="module",a=(l||s)&&e.async,u=l&&!a||s&&e.defer,h=!(n!=null&&n.atEnd)&&((n==null?void 0:n.forceDefer)||u||a);if(Nx(t)||(t.onload=null),h)return tr.some(c=>rm(c,e))||tr.push(e),R(!0);if(s.includes("/mathjax")){let c=t.document.head.querySelector("script[src*='MathJax.js']:not([data-vivliostyle-scripting])");if(c){if(s.includes("/mathjax@3"))t.document.head.removeChild(c),(r=(i=t.MathJax)==null?void 0:i.version)!=null&&r.startsWith("2.")&&delete t.MathJax;else if(s.includes("/MathJax.js"))return R(!0)}}for(let c of t.document.head.getElementsByTagName("script"))c.hasAttribute("data-vivliostyle-scripting")&&rm(c,e)&&t.document.head.removeChild(c);let p=t.document.createElement("script");p.textContent=o,s&&(p.src=s),p.async=a,p.defer=u,p.setAttribute("data-vivliostyle-scripting","true");for(let c of e.attributes)["src","async","defer"].includes(c.name)||p.setAttribute(c.name,c.value);if(le.debug("script:",s),s){let c=gr(p);return t.document.head.appendChild(p),nu([c])}else return t.document.head.appendChild(p),R(!0)}function WT(e,t){var n;let i={},r=s=>{var l;let a=(l=s["font-family"])==null?void 0:l.value;if(a)if(a.values)for(let h of a.values)i[h.stringValue()]=!0;else i[a.stringValue()]=!0;let u=s._marginBoxes;if(u)for(let h of Object.values(u))r(h)},o=s=>{if(s instanceof lp)r(s.style);else if(s instanceof fo||Array.isArray(s))for(let l of Object.values(s))o(l)};for(let s of Object.values(t.cascade.code))for(let l of Object.values(s??{}))o(l);for(let s of e.querySelectorAll("[style]"))(n=s.style)!=null&&n.fontFamily&&(i[s.style.fontFamily]=!0);return Object.keys(i).join(",")}function jT(e,t,n){var i;let r=(i=t.document.querySelector("[data-vivliostyle-textcontent]"))!=null?i:t.document.createElement("div");return r.style.position="fixed",r.style.fontSize="0",r.setAttribute("data-vivliostyle-textcontent","true"),r.setAttribute("aria-hidden","true"),r.style.fontFamily=WT(e,n),r.textContent=e.documentElement.textContent,t.document.body.appendChild(r),r}function GT(e,t,n){if(!oi)return R(!1);let i=Px(e);if(i.length===0)return R(!1);let r=i.some(h=>!(h.async||h.defer||h.type==="module")),o=r?jT(e,t,n):null,s=t.document.fonts,l=t.$,a=!1,u=X("loadScripts");return u.loop(()=>{if(i.length===0)return r?u.sleep(20).thenAsync(()=>{var p,c;return s.status==="loading"||t.document.documentElement.classList.contains("wf-loading")||(p=t.FontJSON)!=null&&p.Font&&(c=t.ret)!=null&&c.readyState&&t.ret.readyState<4?R(!0):R(!1)}):R(!1);let h=i.shift();return Cp(h,t,{inHead:!0,forceDefer:a}).thenAsync(()=>(!a&&t.$!==l&&(tr.push(h),a=!0),i.length===0&&r&&(le.debug("dispatchEvent: DOMContentLoaded (document)"),t.document.dispatchEvent(new Event("DOMContentLoaded"))),R(!0)))}).then(()=>{o&&o.remove(),u.finish(!0)}),u.result()}function XT(e){if(!oi)return R(!1);let t=X("loadScripts");return t.loop(()=>tr.length===0?R(!1):Cp(tr.shift(),e,{atEnd:!0}).thenReturn(tr.length>0)).then(()=>{le.debug("dispatchEvent: DOMContentLoaded (window)"),e.dispatchEvent(new Event("DOMContentLoaded")),le.debug("dispatchEvent: load (window)"),e.dispatchEvent(new Event("load")),t.finish(!0)}),t.result()}function Nx(e){return oi?tr.length>0||!!e.document.head.querySelector("script[data-vivliostyle-scripting]"):!1}var YT=(e,t,n)=>e.replace(/[uU][rR][lL]\(\s*"((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^"\r\n])+)"/gm,(i,r)=>`url("${n.transformURL(r,t)}"`).replace(/[uU][rR][lL]\(\s*'((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^'\r\n])+)'/gm,(i,r)=>`url('${n.transformURL(r,t)}'`).replace(/[uU][rR][lL]\(\s*((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^"'\r\n\)\s])+)/gm,(i,r)=>`url(${n.transformURL(r,t)}`),qT={};function KT(e){e.addEventListener("load",()=>{e.contentWindow.navigator.epubReadingSystem={name:"adapt",version:"0.1",layoutStyle:"paginated",hasFeature:function(t,n){switch(t){case"mouse-events":return!0}return!1}}},!1)}var Tx=class _c extends Vd{constructor(t,n,i,r,o,s,l,a,u,h,p,c,f){super(),this.flowName=t,this.context=n,this.viewport=i,this.styler=r,this.regionIds=o,this.xmldoc=s,this.docFaces=l,this.footnoteStyle=a,this.stylerProducer=u,this.page=h,this.customRenderer=p,this.fallbackMap=c,this.documentURLTransformer=f,d(this,"document"),d(this,"exprContentListener"),d(this,"nodeContext",null),d(this,"viewRoot",null),d(this,"isFootnote",!1),d(this,"sourceNode",null),d(this,"offsetInNode",0),d(this,"viewNode",null),this.document=i.document,this.exprContentListener=r.counterListener.getExprContentListener()}clone(){return new _c(this.flowName,this.context,this.viewport,this.styler,this.regionIds,this.xmldoc,this.docFaces,this.footnoteStyle,this.stylerProducer,this.page,this.customRenderer,this.fallbackMap,this.documentURLTransformer)}createPseudoelementShadow(t,n,i,r,o,s,l,a){let u=this.getPseudoMap(i,this.regionIds,this.isFootnote,this.nodeContext,s);if(!u)return a;let h=[],p=Hl.createElementNS("http://www.pyroxy.com/ns/shadow","root"),c=p;for(let v of GP){let w;if(v){if(!u[v]||v=="footnote-marker"&&!(n&&this.isFootnote))continue;if(v.match(/^first-/)){let x=r.display;if(!x||x===S.inline)continue;let g=t.firstElementChild;if(g&&vt(g.previousSibling)){let m=o.getStyle(g,!1);if(m){let y=xt(m,"display");if(y!=null&&y.value&&y.value!==S.inline)continue}}}if(v==="before"||v==="after"){let x=u[v].content;if(!x||!Bi(x.value))continue}h.push(v),w=Hl.createElementNS("http://www.w3.org/1999/xhtml","span"),Ic(w,v)}else w=Hl.createElementNS("http://www.pyroxy.com/ns/shadow","content");c.appendChild(w),v.match(/^first-/)&&(c=w)}if(!h.length)return a;let f=new Dg(t,i,o,s,this.exprContentListener);return new hc(t,p,null,l,a,cn.ROOTLESS,f)}getPseudoMap(t,n,i,r,o){let s=Tn(t,"_pseudos");if(!s)return null;let l={};for(let a in s){let u=l[a]={};is(u,s[a],o),Tc(u,o,s[a]),O0(s[a],n,i,(h,p)=>{is(u,p,o),R0(p,c=>{is(u,c,o)})})}return l}createRefShadow(t,n,i,r,o){let s=X("createRefShadow");return this.xmldoc.store.load(t).then(l=>{let a=l;if(a){let u=a.getElement(t);if(u){let h=this.stylerProducer.getStylerForDoc(a);o=new hc(i,u,a,r,o,n,h)}}s.finish(o)}),s.result()}createShadows(t,n,i,r,o,s,l){let a=X("createShadows"),u=null,h=r.template,p;if(h instanceof Nn||h===S.footnote){let c=h instanceof Nn?h.url:et("user-agent.xml#footnote",lr);p=this.createRefShadow(c,cn.ROOTLESS,t,l,u)}else p=R(u);return p.then(c=>{let f=null;if(t.namespaceURI=="http://www.pyroxy.com/ns/shadow"&&t.localName=="include"){let w=t.getAttribute("href"),x=null;w?x=l?l.xmldoc:this.xmldoc:l&&(l.owner.namespaceURI=="http://www.w3.org/1999/xhtml"?w=l.owner.getAttribute("href"):w=l.owner.getAttributeNS("http://www.w3.org/1999/xlink","href"),x=l.parentShadow?l.parentShadow.xmldoc:this.xmldoc),w&&(w=et(w,x.url),f=this.createRefShadow(w,cn.ROOTED,t,l,c))}f==null&&(f=R(c));let v=null;f.then(w=>{if(r.display===S.table_cell){let x=et("user-agent.xml#table-cell",lr);v=this.createRefShadow(x,cn.ROOTLESS,t,l,w)}else v=R(w);v.then(x=>{x=this.createPseudoelementShadow(t,n,i,r,o,s,l,x),a.finish(x)})})}),a.result()}setViewRoot(t,n){this.viewRoot=t,this.isFootnote=n}computeStyle(t,n,i,r){var o;let s=this.context,l=F0(i,s,this.regionIds,this.isFootnote,this.nodeContext),a=!((o=this.nodeContext)!=null&&o.parent);a&&(!l["writing-mode"]&&this.styler.rootStyle["writing-mode"]&&(l["writing-mode"]=this.styler.rootStyle["writing-mode"]),!l.direction&&this.styler.rootStyle.direction&&(l.direction=this.styler.rootStyle.direction));let u=t;t=A0(l,s,t);let h=!a&&t!==u;n=L0(l,s,n);let p=(g,m)=>{let y;h&&(t?/^(min-|max-)?(height|inline-size)$/.test(g)&&(y=s.pageAreaHeight):/^(min-|max-)?(width|inline-size)$/.test(g)&&(y=s.pageAreaWidth));let C=m.evaluate(s,g,y,t);return g=="font-family"&&(C=this.docFaces.filterFontFamily(C)),C},c=!!new lt(s.style.pageScope,"left-page").evaluate(s);if(B0(l,r,t,n,c,p),h){let g=r[t?"height":"width"];(!g||g===S.auto)&&(r[t?"height":"width"]=S.max_content)}if(pc(r.position))return r.position=S.fixed,r.visibility=S.hidden,t;let f=r.position,v=r.float,w=r.display||(this.sourceNode.namespaceURI==="http://www.w3.org/1999/xhtml"?S.inline:void 0),x=l0(w,f,v,this.sourceNode===this.xmldoc.root);return["display","position","float"].forEach(g=>{x[g]&&(r[g]=x[g])}),t}inheritFromSourceParent(t){let n=this.nodeContext.sourceNode,i=[],r=null,o=this.nodeContext.shadowContext,s=-1;for(;n&&n.nodeType==1;){let p=o&&o.root==n;if(!p||o.type==cn.ROOTLESS){let c=(o?o.styler:this.styler).getStyle(n,!1);i.push(c),r=r||Yh(n)}p?(n=o.owner,o=o.parentShadow):(n=n.parentNode,s++)}let l=s===0,a=this.context.queryUnitSize("em",l),u={"font-size":new ke(new z(a,"px"),0)},h=new KE(u,this.context);for(let p=i.length-1;p>=0;--p){let c=i[p],f=[];for(let x in c)ts(x)&&f.push(x);f.sort(sg);let v,w;for(let x of f){h.setPropName(x);let g=xt(c,x),m=g;Te(g.value)||(x==="font-size"&&p===i.length-1&&this.context.isRelativeRootFontSize&&this.context.rootFontSize?m=new ke(new z(this.context.rootFontSize,"px"),g.priority):x==="line-height"&&p===i.length-1&&this.context.rootLineHeight&&g.value instanceof z&&(g.value.unit==="lh"||g.value.unit==="rlh")?m=new ke(new z(this.context.rootLineHeight,"px"),g.priority):p===0&&g.value instanceof z&&g.value.unit==="lh"?m=new ke(new z(g.value.num*this.getLineHeightUnitSize(x,v,w),"px"),g.priority):ni(x)||(m=g.filterValue(h)),x==="font-size"?v=m.value:x==="line-height"&&(w=m.value),u[x]=m)}}for(let p in t)ts(p)||(u[p]=t[p]);return{lang:r,elementStyle:u}}resolveURL(t){return t=et(t,this.xmldoc.url),this.fallbackMap[t]||t}inheritLangAttribute(){this.nodeContext.lang=Yh(this.nodeContext.sourceNode)||this.nodeContext.parent&&this.nodeContext.parent.lang||this.nodeContext.lang}transferPolyfilledInheritedProps(t){let n=VE().filter(i=>t[i]);if(n.length){let i=this.nodeContext.inheritedProps;if(this.nodeContext.parent){i=this.nodeContext.inheritedProps={};for(let r in this.nodeContext.parent.inheritedProps)i[r]=this.nodeContext.parent.inheritedProps[r]}n.forEach(r=>{let o=t[r];if(o){if(Te(o))o===S.initial&&(i[r]=void 0);else if(o instanceof ar)i[r]=o.num;else if(o instanceof Jt)i[r]=o.name;else if(o instanceof z){let s=o;switch(s.unit){case"dpi":case"dpcm":case"dppx":i[r]=s.num*$e[s.unit];break;default:i[r]=o}}else i[r]=o;["widows","orphans"].includes(r)||delete t[r]}})}}resolveFormattingContext(t,n,i,r,o,s){let l=An("RESOLVE_FORMATTING_CONTEXT");for(let a=0;a<l.length;a++){let u=l[a](t,n,i,r,o,s);if(u){t.formattingContext=u;return}}}createElementView(t,n){var i,r,o,s;let l=!0,a=X("createElementView"),u=this.sourceNode,h=this.nodeContext.shadowContext?this.nodeContext.shadowContext.styler:this.styler,p=h.getStyle(u,!1);if(!this.nodeContext.shadowContext){let C=this.xmldoc.getElementOffset(u);ru.registerFragmentIndex(C,this.nodeContext.fragmentIndex,0)}let c={};if(!this.nodeContext.parent){let C=this.inheritFromSourceParent(p);p=C.elementStyle,this.nodeContext.lang=C.lang}let f=p.position,v=p.float,w=p["float-reference"],x=v&&!Te(v.value)&&v.value!==S.none&&w&&!Te(w.value)?kE(w.value.toString()):null;if(this.nodeContext.parent&&(pc(f==null?void 0:f.value)||x&&Wr(x))){let C=this.inheritFromSourceParent(p);p=C.elementStyle,this.nodeContext.lang=C.lang}this.nodeContext.vertical=this.computeStyle(this.nodeContext.vertical,this.nodeContext.direction==="rtl",p,c),x&&Wr(x)&&c.display===S.block&&(c.display=S.flow_root),h.processContent(u,c,(r=this.nodeContext.viewNode)!=null?r:(i=this.nodeContext.parent)==null?void 0:i.viewNode),this.transferPolyfilledInheritedProps(c),this.inheritLangAttribute(),c.direction&&(this.nodeContext.direction=c.direction.toString());let g=c["flow-into"];if(g&&g.toString()!=this.flowName)return a.finish(!1),a.result();if(oi&&u.localName==="script"&&u.namespaceURI==="http://www.w3.org/1999/xhtml")return Cp(u,this.viewport.window).thenFinish(a),a.result();let m=c.display;if(Te(m)&&(m===S.initial||m===S.unset?m=S.inline:m===S.inherit?m=((o=this.nodeContext.parent)==null?void 0:o.display)&&q((s=this.nodeContext.parent)==null?void 0:s.display):m=null),m===S.none)return a.finish(!1),a.result();let y=this.nodeContext.parent==null;return this.nodeContext.flexContainer=m===S.flex,this.createShadows(u,y,p,c,h,this.context,this.nodeContext.shadowContext).then(C=>{var P,A;this.nodeContext.nodeShadow=C;let I=c.position,M=c.float,G=c.clear,j=this.nodeContext.vertical?S.vertical_rl:S.horizontal_tb,$=this.nodeContext.parent?this.nodeContext.parent.vertical?S.vertical_rl:S.horizontal_tb:j,Z=AE(u);this.nodeContext.establishesBFC=LE(m,I,M,c.overflow,j,$,Z),this.nodeContext.containingBlockForAbsolute=FE(I),this.nodeContext.isInsideBFC()&&M!==S.footnote&&!(x&&Wr(x))&&(M=null,G=null);let b=M instanceof Ge||M===S.left||M===S.right||M===S.top||M===S.bottom||M===S.inline_start||M===S.inline_end||M===S.block_start||M===S.block_end||M===S.snap_block||M===S.snap_inline||M===S.inside||M===S.outside||M===S.footnote;M&&(delete c.float,M===S.footnote&&(this.isFootnote?(b=!1,c.display=S.block):c.display=S.inline)),G&&(G===S.inherit&&this.nodeContext.parent&&this.nodeContext.parent.clearSide&&(G=q(this.nodeContext.parent.clearSide)),(G===S.left||G===S.right||G===S.top||G===S.bottom||G===S.inline_start||G===S.inline_end||G===S.block_start||G===S.block_end||G===S.inside||G===S.outside||G===S.both||G===S.all||G===S.same)&&(delete c.clear,c.display&&c.display!=S.inline&&(this.nodeContext.clearSide=G.toString())));let T=m===S.list_item&&c["ua-list-item-count"],k=c["break-inside"];(b||k&&!Te(k)&&k!==S.auto)&&this.nodeContext.breakPenalty++,m&&m!==S.inline&&Ki(m)&&this.nodeContext.breakPenalty++,this.nodeContext.inline=!b&&!m||Ki(m)||u0(m),this.nodeContext.display=m?m.toString():"inline",this.nodeContext.floatSide=b?M.toString():null,this.nodeContext.floatReference=x||at.INLINE;let B=c["float-min-wrap-block"];this.nodeContext.floatMinWrapBlock=B&&!Te(B)?B:null;let V=this.isInsideNonRootMultiColumn(),E=c["column-span"];if(this.nodeContext.columnSpan=!V&&E&&!Te(E)?E:null,!this.nodeContext.inline){let U=c["break-after"];U&&!Te(U)&&!(V&&U===S.column)&&(this.nodeContext.breakAfter=U.toString(),lc[this.nodeContext.breakAfter]&&delete c["break-after"]);let pe=c["break-before"];pe&&!Te(pe)&&!(V&&pe===S.column)&&(this.nodeContext.fragmentIndex===1&&(this.nodeContext.breakBefore=pe.toString()),lc[this.nodeContext.breakBefore]&&delete c["break-before"]);let we=c.page,ne=we&&!Te(we)&&we.toString();!ne&&!this.nodeContext.parent&&(this.nodeContext.shadowContext||m===S.table_header_group||m===S.table_footer_group)&&(ne=this.styler.cascade.currentPageType),!ne||ne.toLowerCase()==="auto"?ne=this.nodeContext.pageType:this.nodeContext.pageType=ne,this.styler.cascade.currentPageType!==ne&&!(!ne&&c.position===S.fixed)&&(this.nodeContext.fragmentIndex===1&&!Rs(this.nodeContext.breakBefore)&&(this.nodeContext.breakBefore="page"),ne!==this.styler.cascade.previousPageType&&(this.styler.cascade.previousPageType=this.styler.cascade.currentPageType),this.styler.cascade.currentPageType=ne)}this.nodeContext.verticalAlign=c["vertical-align"]&&c["vertical-align"].toString()||"baseline",this.nodeContext.captionSide=c["caption-side"]&&c["caption-side"].toString()||"top";let _=c["border-collapse"];if(!_||_===q("separate")){let U=c["border-spacing"],pe,we;U&&(U instanceof Ge?(pe=U.values[0],we=U.values[1]):pe=we=U,pe.isNumeric()&&(this.nodeContext.inlineBorderSpacing=Ft(pe,this.context)),we.isNumeric()&&(this.nodeContext.blockBorderSpacing=Ft(we,this.context)))}let W=c["footnote-policy"];this.nodeContext.footnotePolicy=W&&!Te(W)?W:null;let J=c["x-first-pseudo"];if(J){let U=this.nodeContext.parent?this.nodeContext.parent.firstPseudo:null;this.nodeContext.firstPseudo=new xE(U,J.num)}this.nodeContext.inline||this.processAfterIfcontinues(u,p,h,this.context);let L=c["white-space"];if(L){let U=Ky(L.toString());U!==null&&(this.nodeContext.whitespace=U)}let F=c["hyphenate-character"];F&&F instanceof ut&&(this.nodeContext.hyphenateCharacter=F.str);let D=c["word-break"],te=c["line-break"],N=c["overflow-wrap"];(D===S.break_all||te===S.anywhere||N===S.break_word||N===S.anywhere)&&(this.nodeContext.breakWord=!0),this.resolveFormattingContext(this.nodeContext,t,m,I,M,y),this.nodeContext.parent&&this.nodeContext.parent.formattingContext&&(t=this.nodeContext.parent.formattingContext.isFirstTime(this.nodeContext,t)),this.nodeContext.inline||(this.nodeContext.repeatOnBreak=this.processRepeatOnBreak(c),this.findAndProcessRepeatingElements(u,h));let ee=!1,H=[],ce=u.namespaceURI,K=u.localName;if(ce=="http://www.w3.org/1999/xhtml"?(K=="html"||K=="body"||K=="script"||K=="link"||K=="meta"?K="div":K=="vide_"?K="video":K=="audi_"?K="audio":K=="object"&&(ee=!!this.customRenderer),u.getAttribute(cp)&&(A=(P=p.content)==null?void 0:P.value)!=null&&A.url&&(K="img")):ce=="http://www.idpf.org/2007/ops"?(K="span",ce="http://www.w3.org/1999/xhtml"):ce=="http://www.pyroxy.com/ns/shadow"?(ce="http://www.w3.org/1999/xhtml",K=this.nodeContext.inline?"span":"div"):ee=!!this.customRenderer,T)t?K="li":(K="div",m=S.block,c.display=m);else if(K=="body"||K=="li")K="div";else if(K=="q")K="span";else if(K=="a"){let U=c["hyperlink-processing"];U&&U.toString()!="normal"&&(K="span")}c.behavior&&c.behavior.toString()!="none"&&this.customRenderer&&(ee=!0),u.dataset&&u.getAttribute("data-math-typeset")==="true"&&(ee=!0);let ge;if(ee){let U=this.nodeContext.parent?this.nodeContext.parent.viewNode:null;ge=this.customRenderer(u,U,c)}else ge=R(null);ge.then(U=>{if(U)ee&&(l=U.getAttribute("data-adapt-process-children")=="true");else if(c.display===S.none){a.finish(!1);return}else U=this.createElement(ce,K);K=="a"&&U.addEventListener("click",this.page.hrefHandler,!1),U.localName=="iframe"&&U.namespaceURI=="http://www.w3.org/1999/xhtml"&&KT(U);let pe=this.nodeContext.inheritedProps["image-resolution"],we=[],ne=c.width,Re=c.height,xe=u.getAttribute("width"),Xe=u.getAttribute("height"),ae=ne===S.auto||!ne&&!xe,ie=Re===S.auto||!Re&&!Xe,be=u.attributes,Pe=be.length,ve=null,Y=null;for(let ye=0;ye<Pe;ye++){let Ee=be[ye],de=Ee.namespaceURI,me=Ee.localName,ue=Ee.nodeValue;if(de){if(de=="http://www.w3.org/2000/xmlns/")continue;de=="http://www.w3.org/1999/xlink"&&me=="href"&&(ue=this.documentURLTransformer.transformURL(this.resolveURL(ue),this.xmldoc.url))}else{if(!oi&&me.match(/^on/)||me=="style")continue;if((me=="id"||me=="name")&&t){let Ne=this.documentURLTransformer.transformFragment(ue,this.xmldoc.url);U.setAttribute(me,ue),U.setAttribute("data-vivliostyle-id",Ne);let De=U.ownerDocument.createElement("a");De.setAttribute(me,Ne),De.setAttribute(no,"1"),U.appendChild(De),this.page.registerElementWithId(U,Ne);continue}if(me=="src"||me=="href"||me=="poster")ue=this.resolveURL(ue),me==="href"&&(ue=this.documentURLTransformer.transformURL(ue,this.xmldoc.url));else if(me=="srcset")ue=ue.split(",").map(Ne=>this.resolveURL(Ne.trim())).join(",");else if(me==="data"&&ee&&K==="object"&&U.hasAttribute("data"))continue;if(me==="poster"&&K==="video"&&ce==="http://www.w3.org/1999/xhtml"&&ae&&ie){let Ne=new Image,De=gr(Ne,ue);H.push(De),we.push({image:Ne,element:U,fetcher:De})}}if(ce=="http://www.w3.org/2000/svg"&&/^[A-Z\-]+$/.test(me)&&(me=me.toLowerCase()),this.isSVGUrlAttribute(me)&&(ue=YT(ue,this.xmldoc.url,this.documentURLTransformer)),de){let Ne=qT[de];Ne&&(me=`${Ne}:${me}`)}if(me=="src"&&!de&&(K=="img"||K=="input")&&ce=="http://www.w3.org/1999/xhtml")ve=ue;else if(me=="alt"&&!de&&K=="img"&&ce=="http://www.w3.org/1999/xhtml")Y=ue;else if(me=="href"&&K=="image"&&ce=="http://www.w3.org/2000/svg"&&de=="http://www.w3.org/1999/xlink")this.page.fetchers.push(gr(U,ue));else if(de)U.setAttributeNS(de,me,ue);else try{U.setAttribute(me,ue)}catch(Ne){le.warn(Ne)}}if(ve){let ye=K==="input"?new Image:U,Ee=gr(ye,ve,Y);ye!==U&&(U.src=ve);let de=()=>{var me,ue;if(c.position===S.fixed)return!0;for(let Ne=(me=this.nodeContext.parent)==null?void 0:me.viewNode;Ne&&Ne!==this.viewRoot;Ne=Ne.parentElement)if(((ue=Ne.style)==null?void 0:ue.position)==="fixed")return!0;return!1};!ae&&!ie&&!(()=>{let me=this.nodeContext.vertical?ne:Re;return me instanceof z&&me.unit==="%"})()&&!de()?this.page.fetchers.push(Ee):(ae&&ie&&pe&&pe!==1&&we.push({image:ye,element:U,fetcher:Ee}),H.push(Ee))}delete c.content;let Se=c["list-style-image"];if(Se&&Se instanceof Nn){let ye=Se.url;H.push(gr(new Image,ye))}if(this.preprocessElementStyle(c),this.applyComputedStyles(U,c),this.nodeContext.inline)t||(tn(U,"inline-start"),Oo(U)&&tn(U,"clone"));else if(t){if(!ep(c.position)){let ye=c["margin-break"],Ee=this.getBreakTypeAt(this.nodeContext),de=Ee!==null,me=Ee==="auto";(ye===S.discard&&de||ye!==S.keep&&me&&!this.nodeContext.floatSide)&&Xu(U,"block-start")}}else{let ye=this.nodeContext.vertical?"width":"height";mi(U,ye)&&O(U,ye,this.nodeContext.display==="table-row"?"0.01px":""),tn(U,"block-start"),Oo(U)&&tn(U,"clone"),Xu(U,"block-start")}T&&U.setAttribute("value",c["ua-list-item-count"].stringValue()),this.viewNode=U,H.length?nu(H).then(()=>{pe>0&&this.modifyElemDimensionWithImageResolution(we,pe,c,this.nodeContext.vertical),a.finish(l)}):a.timeSlice().then(()=>{a.finish(l)})})}),a.result()}isInsideNonRootMultiColumn(){var t;for(let n=(t=this.nodeContext.parent)==null?void 0:t.viewNode;n;n=n.parentNode){let i=n.nodeType===1?n.style:null;if(!i)break;if(!isNaN(parseFloat(i.columnCount))||!isNaN(parseFloat(i.columnWidth)))return!0;if(i.position==="absolute")break}return!1}getBreakTypeAt(t){var n,i,r,o,s;if(this.isInsideTable(t))return null;for(let a=t;a&&!a.after;a=a.parent){if(Dt(a.breakBefore))return a.breakBefore;if(a.fragmentIndex===1&&!a.parent)return a.sourceNode===a.sourceNode.ownerDocument.documentElement?"page":null;if((n=a.parent)!=null&&n.floatSide)return null;let u=(i=a.parent)==null?void 0:i.viewNode;if(u){let h=this.viewport.window.getComputedStyle(u),p=parseFloat(h.paddingBlockStart),c=parseFloat(h.borderBlockStartWidth);if(p||c)return null;let f=u==null?void 0:u.firstChild;for(;f&&(vt(f,a.parent.whitespace)||!a.floatSide&&zo(f));)f=f.nextSibling;if(f&&f!==a.viewNode)return null}}let l=(s=(o=(r=this.context)==null?void 0:r.currentLayoutPosition)==null?void 0:o.flowPositions[this.flowName])==null?void 0:s.startBreakType;return Dt(l)?l:"auto"}isInsideTable(t){for(let n=t;n&&!n.after;n=n.parent)if(n.display&&n.display.startsWith("table"))return!0;return!1}processAfterIfcontinues(t,n,i,r){let o=this.getPseudoMap(n,this.regionIds,this.isFootnote,this.nodeContext,r);if(o&&o["after-if-continues"]&&o["after-if-continues"].content){let s=new Dg(t,n,i,r,this.exprContentListener);this.nodeContext.afterIfContinues=new YP(t,s)}}isSVGUrlAttribute(t){return _c.SVG_URL_ATTRIBUTES.includes(t.toLowerCase())}modifyElemDimensionWithImageResolution(t,n,i,r){t.forEach(o=>{if(o.fetcher.get().get()==="load"){let s=o.image,l=s.width/n,a=s.height/n,u=o.element;if(l>0&&a>0){if(i["box-sizing"]===S.border_box&&(i["border-left-style"]!==S.none&&(l+=Ft(i["border-left-width"],this.context)),i["border-right-style"]!==S.none&&(l+=Ft(i["border-right-width"],this.context)),i["border-top-style"]!==S.none&&(a+=Ft(i["border-top-width"],this.context)),i["border-bottom-style"]!==S.none&&(a+=Ft(i["border-bottom-width"],this.context))),n>1){let h=i["max-width"]||S.none,p=i["max-height"]||S.none;if(h===S.none&&p===S.none)O(u,"max-width",`${l}px`);else if(h!==S.none&&p===S.none)O(u,"width",`${l}px`);else if(h===S.none&&p!==S.none)O(u,"height",`${a}px`);else{h.isNumeric(),p.isNumeric();let c=h,f=p;c.unit!=="%"?O(u,"max-width",`${Math.min(l,Ft(c,this.context))}px`):f.unit!=="%"?O(u,"max-height",`${Math.min(a,Ft(f,this.context))}px`):r?O(u,"height",`${a}px`):O(u,"width",`${l}px`)}}else if(n<1){let h=i["min-width"]||Ve,p=i["min-height"]||Ve;h.isNumeric(),h.isNumeric();let c=h,f=p;c.num===0&&f.num===0?O(u,"min-width",`${l}px`):c.num!==0&&f.num===0?O(u,"width",`${l}px`):c.num===0&&f.num!==0?O(u,"height",`${a}px`):c.unit!=="%"?O(u,"min-width",`${Math.max(l,Ft(c,this.context))}px`):f.unit!=="%"?O(u,"min-height",`${Math.max(a,Ft(f,this.context))}px`):r?O(u,"height",`${a}px`):O(u,"width",`${l}px`)}}}})}preprocessElementStyle(t){An("PREPROCESS_ELEMENT_STYLE").forEach(n=>{n(this.nodeContext,t)})}findAndProcessRepeatingElements(t,n){for(let i=t.firstChild;i;i=i.nextSibling){if(i.nodeType!==1)continue;let r={},o=n.getStyle(i,!1);if(this.computeStyle(this.nodeContext.vertical,this.nodeContext.direction==="rtl",o,r),!this.processRepeatOnBreak(r))continue;if(this.nodeContext.formattingContext instanceof ro&&!this.nodeContext.belongsTo(this.nodeContext.formattingContext))return;let s=this.nodeContext.parent,l=s&&s.formattingContext;this.nodeContext.formattingContext=new ro(l,this.nodeContext.sourceNode),this.nodeContext.formattingContext.initializeRepetitiveElements(this.nodeContext.vertical);return}}processRepeatOnBreak(t){let n=t["repeat-on-break"];return n!==S.none&&((n===S.auto||Te(n))&&(t.display===S.table_header_group?n=S.header:t.display===S.table_footer_group?n=S.footer:n=S.none),n&&n!==S.none)?n.toString():null}createTextNodeView(){let t=X("createTextNodeView");return this.preprocessTextContent().then(()=>{let n=this.offsetInNode||0,i=wg(this.nodeContext.preprocessedTextContent).substr(n);this.viewNode=document.createTextNode(i),t.finish(!0)}),t.result()}preprocessTextContent(){if(this.nodeContext.preprocessedTextContent!=null)return R(!0);let t,n=t=this.sourceNode.textContent,i=X("preprocessTextContent"),r=An("PREPROCESS_TEXT_CONTENT"),o=0;return i.loop(()=>o>=r.length?R(!1):r[o++](this.nodeContext,n).thenAsync(s=>(n=s,R(!0)))).then(()=>{this.nodeContext.preprocessedTextContent=aE(t,n),i.finish(!0)}),i.result()}createNodeView(t,n){let i=X("createNodeView"),r,o=!0;return this.sourceNode.nodeType==1?r=this.createElementView(t,n):this.sourceNode.nodeType==8?(this.viewNode=null,r=R(!0)):r=this.createTextNodeView(),r.then(s=>{var l,a;if(o=s,this.nodeContext.viewNode=this.viewNode,this.viewNode){let u=(c,f)=>(c==null?void 0:c.nodeType)===1&&Br(c)===f,h=this.nodeContext.parent,p=h?u(this.viewNode,"after")&&u(h.viewNode,"first-letter")&&(l=h.viewNode)!=null&&l.hasChildNodes()?h.parent.viewNode:h.viewNode:this.viewRoot;if(p&&(this.nodeContext.inline&&!(this.viewNode.nodeType===3&&vt(this.viewNode))&&!p.hasChildNodes()&&Gy(p).includes("block-start")&&tn(p,"text-start"),p.appendChild(this.viewNode),this.viewNode.nodeType===1&&this.viewNode.hasAttribute("data-vivliostyle-id"))){let c=this.viewNode,f=c.querySelector(":scope > a:empty[id^='viv-id-']");if(f&&(c.closest("[style*='position: absolute']")||/(table|flex|grid|ruby)/.test(c.style.display))){let v=f.getAttribute("id");f.ownerDocument.querySelectorAll(`a[id="${v}"]`).forEach(x=>{var g;(g=x.parentElement)==null||g.removeChild(x)});let w=p.closest("[data-vivliostyle-bleed-box]");(a=w==null?void 0:w.parentElement)==null||a.insertBefore(f,w)}}}i.finish(o)}),i.result()}setCurrent(t,n,i){return this.nodeContext=t,t?(this.sourceNode=t.sourceNode,this.offsetInNode=t.offsetInNode):(this.sourceNode=null,this.offsetInNode=-1),this.viewNode=null,this.nodeContext?this.createNodeView(n,!!i):R(!0)}processShadowContent(t){if(t.shadowContext==null||t.sourceNode.localName!="content"||t.sourceNode.namespaceURI!="http://www.pyroxy.com/ns/shadow")return t;let n=t.boxOffset,i=t.shadowContext,r=t.parent,o,s,l=i.subShadow||i.parentShadow;i.subShadow?(o=i.root,s=i.type,s==cn.ROOTLESS&&(o=o.firstChild)):(o=i.owner.firstChild,s=cn.ROOTLESS);let a=t.sourceNode.nextSibling;if(a?(t.sourceNode=a,t.resetView()):t.shadowSibling?t=t.shadowSibling:o?t=null:(t=t.parent.modify(),t.after=!0),o){let u=new _o(o,r,n);return u.shadowContext=l,u.shadowType=s,u.shadowSibling=t,u}return t.boxOffset=n,t}nextPositionInTree(t){let n=t.boxOffset+1;if(t.after){if(!t.parent)return null;if(t.shadowType!=cn.ROOTED){let i=t.sourceNode.nextSibling;if(i)return t=t.modify(),t.boxOffset=n,t.sourceNode=i,t.resetView(),this.processShadowContent(t)}return t.shadowSibling?(t=t.shadowSibling.modify(),t.boxOffset=n,t):(t=t.parent.modify(),t.boxOffset=n,t.after=!0,t)}else{if(t.nodeShadow){let r=t.nodeShadow.root;if(t.nodeShadow.type==cn.ROOTLESS&&(r=r.firstChild),r){let o=new _o(r,t,n);return o.shadowContext=t.nodeShadow,o.shadowType=t.nodeShadow.type,this.processShadowContent(o)}}let i=t.sourceNode.firstChild;if(i)return this.processShadowContent(new _o(i,t,n));if(t.sourceNode.nodeType!=1){let r=wg(t.preprocessedTextContent);n+=r.length-1-t.offsetInNode}return t=t.modify(),t.boxOffset=n,t.after=!0,t}}isTransclusion(t,n,i){let r=xt(n,"hyperlink-processing");if(!r)return!1;let o=r.evaluate(this.context,"hyperlink-processing");return o?o.toString()==i:!1}nextInTree(t,n){let i=this.nextPositionInTree(t);if(!i||i.after)return R(i);let r=X("nextInTree");return this.setCurrent(i,!0,n).then(o=>{(!i.viewNode||!o)&&(i=i.modify(),i.after=!0,i.viewNode||(i.inline=!0)),this.dispatchEvent({type:"nextInTree",nodeContext:i}),r.finish(i)}),r.result()}addImageFetchers(t){if(t instanceof Mt){let n=t.values;for(let i=0;i<n.length;i++)this.addImageFetchers(n[i])}else if(t instanceof Nn){let n=t.url;this.page.fetchers.push(gr(new Image,n))}}applyComputedStyles(t,n){var i,r,o;let s=n["background-image"];s&&this.addImageFetchers(s);let l=n.position===S.relative,a=((i=this.nodeContext)==null?void 0:i.parent)===null&&((r=this.sourceNode)==null?void 0:r.parentElement)===null&&!!((o=this.viewRoot)!=null&&o.parentElement),u=Object.keys(n);u.sort(sg);let h,p;for(let c of u){if(ZT[c])continue;let f=n[c];if(!(!f||f===fe&&!ni(c))){if(f=f.visit(new rk(this.xmldoc.url,this.documentURLTransformer)),f instanceof z&&Jw(f.unit)&&(f.unit==="lh"?f=new z(f.num*this.getLineHeightUnitSize(c,h,p),"px"):f=vy(f,this.context)),c==="font-size"?h=f:c==="line-height"&&(p=f),cE[c]||l&&dE[c]){this.page.delayedItems.push(new Jd(t,c,f));continue}a&&this.page.pageAreaElement&&ts(c)?O(this.page.pageAreaElement.parentElement.parentElement,c,f.toString()):O(t,c,f.toString())}}}getLineHeightUnitSize(t,n,i){var r,o,s,l;let a=$e.lh/$e.em,u=((o=(r=this.nodeContext.parent)==null?void 0:r.viewNode)==null?void 0:o.nodeType)===1?this.viewport.window.getComputedStyle(this.nodeContext.parent.viewNode):null,h=u?parseFloat(u.fontSize):this.context.fontSize(),p=u?u.lineHeight==="normal"?h*a:parseFloat(u.lineHeight):this.context.rootLineHeight;if(t==="line-height"||t==="font-size")return p;let c=null;if(i){if(i instanceof $i||i instanceof z&&(i.unit==="em"||i.unit==="%"))c=i instanceof z&&i.unit==="%"?i.num/100:i.num;else if(i instanceof z)return i.num*this.context.queryUnitSize(i.unit,!1)}else for(let f=(s=this.nodeContext.parent)==null?void 0:s.viewNode;;f=f.parentNode){if(!f||f.nodeType!==1){c=a;break}let v=(l=f==null?void 0:f.style)==null?void 0:l.lineHeight;if(v){/^[0-9.]+$/.test(v)&&(c=parseFloat(v)),v==="normal"&&(c=a);break}}return c!==null?n instanceof z?c*b0(n,h,this.context).num:c*h:p}applyPseudoelementStyle(t,n,i){if(t.after)return;let r=this.sourceNode,o=(t.shadowContext?t.shadowContext.styler:this.styler).getStyle(r,!1),s=Tn(o,"_pseudos");if(!s||(o=s[n],!o))return;let l={};t.vertical=this.computeStyle(t.vertical,t.direction==="rtl",o,l);let a=l.content;Bi(a)&&(a.visit(new Ta(i,this.context,a,this.exprContentListener)),delete l.content),this.applyComputedStyles(i,l)}peelOff(t,n){let i=X("peelOff"),r=t.firstPseudo,o=t.offsetInNode,s=t.after;if(n>0){let p=t.viewNode.textContent;t.viewNode.textContent=p.substr(0,n),o+=n}else if(!s&&t.viewNode&&o==0){let p=t.viewNode.parentNode;p&&p.removeChild(t.viewNode)}let l=t.boxOffset+n,a=[];for(;t.firstPseudo===r;)a.push(t),t=t.parent;let u=a.pop(),h=u.shadowSibling;return i.loop(()=>{for(;a.length>0;){u=a.pop(),t=new _o(u.sourceNode,t,l),a.length==0&&(t.offsetInNode=o,t.after=s),t.shadowType=u.shadowType,t.shadowContext=u.shadowContext,t.nodeShadow=u.nodeShadow,t.shadowSibling=u.shadowSibling?u.shadowSibling:h,h=null;let p=this.setCurrent(t,!1);if(p.isPending())return p}return R(!1)}).then(()=>{i.finish(t)}),i.result()}createElement(t,n){return t=="http://www.w3.org/1999/xhtml"?this.document.createElement(n):this.document.createElementNS(t,n)}applyFootnoteStyle(t,n,i){let r={},o=Tn(this.footnoteStyle,"_pseudos");if(t=this.computeStyle(t,n,this.footnoteStyle,r),o&&o.before){let s={},l=this.createElement("http://www.w3.org/1999/xhtml","span");Ic(l,"before"),i.appendChild(l),this.computeStyle(t,n,o.before,s),delete s.content,this.applyComputedStyles(l,s)}return delete r.content,this.applyComputedStyles(i,r),t}processFragmentedBlockEdge(t){var n,i,r;let o=!t.inline&&t.after?t.parent:t,s=!1;if(t.inline&&t.after&&!t.shadowContext&&((n=t.sourceNode.nextSibling)==null?void 0:n.nodeType)===1){let a=t.sourceNode.nextSibling,u=(i=xt(this.styler.getStyle(a,!1),"display"))==null?void 0:i.value.toString();s=u&&!Ki(u)||a.getAttribute("data-math-typeset")==="true"&&/^\s*(\$\$|\\\[)/.test(a.textContent)}let l=0;for(let a=o;a;a=a.parent){if(((r=a.viewNode)==null?void 0:r.nodeType)!==1)continue;let u=a.viewNode;if(u.style)if(a.inline){if(tn(u,"inline-end"),Oo(u)){let h=a.vertical?u.offsetWidth:u.offsetHeight;tn(u,"clone"),(a.vertical?u.offsetWidth:u.offsetHeight)>h&&this.fixClonedBoxDecorationOverflow(u)}}else{let h=this.nodeContext.vertical?"width":"height";if(mi(u,h)&&O(u,h,""),tn(u,"block-end"),!l++&&a!==o){let{textAlign:p}=this.viewport.window.getComputedStyle(u);if(p==="justify"&&!s){let c=this.createChildAnonymousBlockIfNeeded(u);c?c!==u?Xy(c,["block-start","text-start","block-end","text-end","justify"]):(tn(u,"text-end"),tn(u,"justify")):tn(u,"text-end")}else tn(u,"text-end")}Oo(u)&&tn(u,"clone"),Xu(u,"block-end")}}}fixClonedBoxDecorationOverflow(t){let n=this.viewport.window.getComputedStyle(t),i=parseFloat(n.paddingInlineEnd),r=parseFloat(n.borderInlineEndWidth),o=-(i+r);isNaN(o)||(t.style.marginInlineEnd=`${o}px`)}createChildAnonymousBlockIfNeeded(t){let n=o=>{let{display:s,position:l,float:a}=this.viewport.window.getComputedStyle(o);if(o.localName==="ruby"||qi[o.localName])return!1;if(o.localName==="br")return!0;if((s==="inline"||s==="contents")&&o.hasChildNodes()){let u=o.lastElementChild;if(u&&(!u.nextSibling||u.nextSibling===o.lastChild&&vt(u.nextSibling))){let h=n(u);if(h||h===null)return h}for(let h=u==null?void 0:u.previousElementSibling;h;h=h.previousElementSibling){let p=n(h);if(p||p===null)return null}return!1}if(s==="none"||l==="absolute"||l==="fixed"||a&&a!=="none"||o.hasAttribute(no)){let u=o.previousElementSibling;return u&&(u.nextSibling===o||u.nextSibling===o.previousSibling&&vt(u.nextSibling))?n(u):!1}return!(!s||Ki(s))},i=null;for(let o=t.lastElementChild;o;o=o.previousElementSibling){let s=n(o);if(s){i=o;break}if(s===null)return null}if(!i)return t;if(i===t.lastElementChild&&(!i.nextSibling||i.nextSibling===t.lastChild&&vt(i.nextSibling)))return null;let r=t.ownerDocument.createElement("span");r.className="viv-anonymous-block";for(let o=i.nextSibling,s=null;o;o=s)s=o.nextSibling,r.appendChild(o);return t.appendChild(r),r}convertLengthToPx(t,n,i){let r=t.num,o=t.unit;if(NC(o)){let s=n;for(;s&&s.nodeType!==1;)s=s.parentNode;let l=parseFloat(i.getElementComputedStyle(s)["font-size"]);return this.context,sp(t,l,this.context).num}else{let s=this.context.queryUnitSize(o,!1);return s?r*s:t}}isSameNodePositionStep(t,n){if(t.shadowContext){if(!n.shadowContext)return!1;let i=t.node.nodeType===1?t.node:t.node.parentElement,r=n.node.nodeType===1?n.node:n.node.parentElement;return t.shadowContext.owner===n.shadowContext.owner&&Br(i)===Br(r)}else return t.node===n.node}isSameNodePosition(t,n){return t.offsetInNode===n.offsetInNode&&t.after==n.after&&t.steps.length===n.steps.length&&t.steps.every((i,r)=>{let o=n.steps[r];return this.isSameNodePositionStep(i,o)})}isPseudoelement(t){return!!Br(t)}};d(Tx,"SVG_URL_ATTRIBUTES",["color-profile","clip-path","cursor","filter","marker","marker-start","marker-end","marker-mid","fill","stroke","mask"]);var QT=Tx,ZT={"float-min-wrap-block":!0,"float-reference":!0,"flow-into":!0,"flow-linger":!0,"flow-options":!0,"flow-priority":!0,"footnote-policy":!0,"margin-break":!0,page:!0},Yl=null,JT=class{constructor(e){d(this,"layoutBox"),d(this,"window"),d(this,"scaleRatio"),this.layoutBox=e.layoutBox,this.window=e.window,this.scaleRatio=e.scaleRatio}scaleRect(e){return Yl?{left:e.left*this.scaleRatio,top:e.top*this.scaleRatio,right:e.right*this.scaleRatio,bottom:e.bottom*this.scaleRatio,width:e.width*this.scaleRatio,height:e.height*this.scaleRatio}:e}subtractOffsets(e,t){let n=t.left,i=t.top;return{left:e.left-n,top:e.top-i,right:e.right-n,bottom:e.bottom-i,width:e.width,height:e.height}}getRangeClientRects(e){let t=e.getClientRects(),n=this.layoutBox.getBoundingClientRect();return Array.from(t).map(i=>this.scaleRect(this.subtractOffsets(i,n)))}getElementClientRect(e){let t=e.getBoundingClientRect();if(t.left===0&&t.top===0&&t.right===0&&t.bottom===0)return t;let n=this.layoutBox.getBoundingClientRect();return this.scaleRect(this.subtractOffsets(t,n))}getElementComputedStyle(e){return this.window.getComputedStyle(e,null)}adjustLengthValue(e){let t=64*(this.scaleRatio||1);return Math.floor(e*t)/t}},Oa=class{constructor(e,t,n,i,r,o){this.window=e,this.fontSize=t,this.pixelRatio=n,d(this,"document"),d(this,"root"),d(this,"outerZoomBox"),d(this,"contentContainer"),d(this,"layoutBox"),d(this,"width"),d(this,"height"),d(this,"scaleRatio",1),this.document=e.document,this.root=i||this.document.body;let s=this.root.firstElementChild;s||(s=this.document.createElement("div"),s.setAttribute("data-vivliostyle-outer-zoom-box","true"),this.root.appendChild(s));let l=s.firstElementChild;l||(l=this.document.createElement("div"),l.setAttribute("data-vivliostyle-spread-container","true"),s.appendChild(l)),n>0&&CSS.supports("zoom","8")&&(O(this.root,"--viv-outputPixelRatio",`${n}`),O(this.root,"--viv-devicePixelRatio",`${e.devicePixelRatio}`),this.scaleRatio=n/e.devicePixelRatio,Yl===null&&(Yl=!("currentCSSZoom"in l)),Yl&&O(this.root,"--viv-scaleRectRatio",`${this.scaleRatio}`));let a=s.nextElementSibling;a||(a=this.document.createElement("div"),a.setAttribute("data-vivliostyle-layout-box","true"),this.root.appendChild(a)),this.outerZoomBox=s,this.contentContainer=l,this.layoutBox=a,this.width=r||parseFloat(e.getComputedStyle(this.root).width)||this.root.offsetWidth||e.innerWidth,this.height=o||parseFloat(e.getComputedStyle(this.root).height)||this.root.offsetHeight||e.innerHeight;let u={width:794,height:1056},h=!e.outerWidth&&!e.outerHeight||/Headless/.test(navigator.userAgent)||navigator.webdriver&&e.innerWidth===800&&e.innerHeight===600;(!this.width||!r&&h)&&(this.width=u.width),(!this.height||!o&&h)&&(this.height=u.height)}resetZoom(){O(this.outerZoomBox,"width",""),O(this.outerZoomBox,"height",""),O(this.contentContainer,"width",""),O(this.contentContainer,"height",""),O(this.contentContainer,"transform","")}zoom(e,t,n){O(this.root,"--viv-outputScale",`${n}`),O(this.outerZoomBox,"width",`${e*n}px`),O(this.outerZoomBox,"height",`${t*n}px`),O(this.contentContainer,"width",`${e}px`),O(this.contentContainer,"height",`${t}px`)}clear(){let e=this.root;for(;e.lastChild;)e.removeChild(e.lastChild)}},Ix=class{constructor(e,t,n){this.store=e,this.url=t,this.document=n,d(this,"lang",null),d(this,"totalOffset",-1),d(this,"root"),d(this,"body"),d(this,"head"),d(this,"last"),d(this,"lastOffset",1),d(this,"idMap"),this.root=n.documentElement;let i=null,r=null;if(this.root.namespaceURI=="http://www.w3.org/1999/xhtml"){for(let o=this.root.firstChild;o;o=o.nextSibling){if(o.nodeType!=1)continue;let s=o;if(s.namespaceURI=="http://www.w3.org/1999/xhtml")switch(s.localName){case"head":r=s;break;case"body":i=s;break}}this.lang=this.root.getAttribute("lang")}this.body=i,this.head=r,this.last=this.root,this.last.setAttribute(jn,"0")}doc(){return new Ax([this.document])}getElementOffset(e){let t=e.getAttribute(jn);if(t)return parseInt(t,10);let n=this.lastOffset,i=this.last;for(;i!=e;){let r=i.firstChild;if(!r){for(;r=i.nextSibling,!r;)if(i=i.parentNode,i==null)throw new Error("Internal error")}i=r,r.nodeType==1?(r.setAttribute(jn,n.toString()),++n):n+=r.textContent.length}return this.lastOffset=n,this.last=e,n-1}getNodeOffset(e,t,n){let i=0,r=e,o=null;if(r.nodeType==1){if(!n)return this.getElementOffset(r)}else{if(i=t,o=r.previousSibling,!o)return r=r.parentNode,i+=1,this.getElementOffset(r)+i;r=o}for(;;){for(;r.lastChild;)r=r.lastChild;if(r.nodeType==1)break;if(i+=r.textContent.length,o=r.previousSibling,!o){r=r.parentNode;break}r=o}return i+=1,this.getElementOffset(r)+i}getTotalOffset(){return this.totalOffset<0&&(this.totalOffset=this.getNodeOffset(this.root,0,!0)),this.totalOffset}getNodeByOffset(e){let t,n=this.root;for(;;){if(t=this.getElementOffset(n),t>=e)return n;let l=n.children;if(!l)break;let a=Ai(l.length,u=>{let h=l[u];return this.getElementOffset(h)>e});if(a==0)break;n=l[a-1]}let i=t+1,r=n,o=r.firstChild||r.nextSibling,s=null;for(;;){if(o){if(o.nodeType==1||(r=o,s=r,i+=o.textContent.length,i>e&&!/^\s*$/.test(o.textContent)))break}else if(r=r.parentNode,!r)break;o=r.nextSibling}return o&&s&&/^\s*$/.test(s.textContent)&&(s=o),s||n}buildIdMap(e){let t=e.getAttribute("id");t&&!this.idMap[t]&&(this.idMap[t]=e);let n=e.getAttributeNS("http://www.w3.org/XML/1998/namespace","id");n&&!this.idMap[n]&&(this.idMap[n]=e);for(let i=e.firstElementChild;i;i=i.nextElementSibling)this.buildIdMap(i)}getElement(e){let t=e.match(/([^#]*)#(.+)$/);if(!t||t[1]&&t[1]!=this.url)return null;let n=t[2],i=this.document.getElementById(n);return!i&&this.document.getElementsByName&&(i=this.document.getElementsByName(n)[0]),i||(this.idMap||(this.idMap={},this.buildIdMap(this.document.documentElement)),i=this.idMap[n]),i}},Mc=(e=>(e.TEXT_HTML="text/html",e.TEXT_XML="text/xml",e.APPLICATION_XML="application/xml",e.APPLICATION_XHTML_XML="application/xhtml+xml",e.IMAGE_SVG_XML="image/svg+xml",e))(Mc||{});function Nl(e,t,n){let i=n||new DOMParser,r;try{r=i.parseFromString(e,t)}catch{}if(r){let o=r.documentElement,s="parsererror";if(o.localName===s)return null;for(let l=o.firstElementChild;l;l=l.nextElementSibling)if(l.localName===s)return null}else return null;return r}function eI(e){let t=e.contentType;if(t){let i=Object.keys(Mc);for(let r=0;r<i.length;r++)if(Mc[i[r]]===t)return t;if(t.match(/\+xml$/))return"application/xml"}let n=e.url.match(/\.([^./]+)$/);if(n)switch(n[1]){case"html":case"htm":return"text/html";case"xhtml":case"xht":return"application/xhtml+xml";case"svg":case"svgz":return"image/svg+xml";case"opf":case"xml":return"application/xml"}return null}function Rx(e,t){let n=e.responseXML;if(!n){let r=new DOMParser,o=e.responseText;if(o){let s=eI(e);if(n=Nl(o,s||"application/xml",r),n&&!s){let l=n.documentElement;l.localName.toLowerCase()==="html"&&!l.namespaceURI?n=Nl(o,"text/html",r):l.localName.toLowerCase()==="svg"&&n.contentType!=="image/svg+xml"&&(n=Nl(o,"image/svg+xml",r))}n||(n=Nl(o,"text/html",r))}}let i=n?new Ix(t,e.url,n):null;return R(i)}function tI(){return new qd(Rx,"document")}var nI=class zc{constructor(t){this.fn=t}check(t){return this.fn(t)}withAttribute(t,n){return new zc(i=>this.check(i)&&i.nodeType==1&&i.getAttribute(t)==n)}withChild(t,n){return new zc(i=>{if(!this.check(i))return!1;let r=new Ax([i]);return r=r.child(t),n&&(r=r.predicate(n)),r.size()>0})}},om=new nI(e=>!0),Ax=class $c{constructor(t){this.nodes=t}asArray(){return this.nodes}size(){return this.nodes.length}predicate(t){let n=[];for(let i of this.nodes)t.check(i)&&n.push(i);return new $c(n)}forEachNode(t){let n=[],i=r=>{n.push(r)};for(let r=0;r<this.nodes.length;r++)t(this.nodes[r],i);return new $c(n)}forEach(t){let n=[];for(let i=0;i<this.nodes.length;i++)n.push(t(this.nodes[i]));return n}forEachNonNull(t){let n=[];for(let i=0;i<this.nodes.length;i++){let r=t(this.nodes[i]);r!=null&&n.push(r)}return n}child(t){return this.forEachNode((n,i)=>{for(let r=n.firstChild;r;r=r.nextSibling)r.nodeType==1&&r.localName==t&&i(r)})}childElements(){return this.forEachNode((t,n)=>{for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType==1&&n(i)})}attribute(t){return this.forEachNonNull(n=>n.nodeType==1?n.getAttribute(t):null)}textContent(){return this.forEach(t=>t.textContent)}},iI=new Ys(()=>{let e=X("uaStylesheetBase"),t=dx(),n=et("user-agent-base.css",lr),i=new As(null,null,null,null,null,t,!0);return i.startStylesheet("UA"),LP(i.cascade),Qd(Ly,i,n,null,null).thenFinish(e),e.result()},"uaStylesheetBaseFetcher");function rI(){return iI.get()}var oI=class{constructor(e,t,n,i,r,o,s,l,a,u){this.store=e,this.rootScope=t,this.pageScope=n,this.cascade=i,this.rootBox=r,this.fontFaces=o,this.footnoteProps=s,this.flowProps=l,this.viewportProps=a,this.pageProps=u,d(this,"fontDeobfuscator"),d(this,"validatorSet"),this.fontDeobfuscator=e.fontDeobfuscator,this.validatorSet=e.validatorSet,this.pageScope.defineBuiltIn("has-content",function(h){h=h;let p=this,c=p.currentLayoutPosition,f=c.firstFlowChunkOfFlow(h);return p.matchPageSide(c.startSideOfFlow(h))&&c.hasContent(h,p.lookupOffset)&&!!f&&!p.flowChunkIsAfterParentFlowForcedBreak(f)}),this.pageScope.defineName("page-number",new mt(this.pageScope,function(){let h=this;return h.pageNumberOffset+h.currentLayoutPosition.page},"page-number")),this.pageScope.defineName("blank-page",new mt(this.pageScope,function(){let h=this.currentLayoutPosition;return h==null?void 0:h.isBlankPage},"blank-page"))}sizeViewport(e,t,n,i){if(this.viewportProps.length){let r=new Zh(this.rootScope,e,t,n),o=qE(r,this.viewportProps),s=o.width,l=o.height,a=o["text-zoom"],u=1;if(s&&l||a){let h=$e.em;if((a?a.evaluate(r,"text-zoom"):null)===S.scale&&(u=h/n,n=h,e*=u,t*=u),s&&l){let p=Ft(s.evaluate(r,"width"),r),c=Ft(l.evaluate(r,"height"),r);if(p>0&&c>0)return{width:i&&i.spreadView?(p+i.pageBorder)*2:p,height:c,fontSize:n}}}}return{width:e,height:t,fontSize:n}}},kp=class extends Zh{constructor(e,t,n,i,r,o,s,l,a,u,h,p,c){super(e.rootScope,i.width,i.height,i.fontSize),this.style=e,this.xmldoc=t,this.viewport=i,this.clientLayout=r,this.fontMapper=o,this.customRenderer=s,this.fallbackMap=l,this.pageNumberOffset=a,this.documentURLTransformer=u,this.counterStore=h,d(this,"lang"),d(this,"primaryFlows",{body:!0}),d(this,"rootPageBoxInstance",null),d(this,"styler",null),d(this,"stylerMap",null),d(this,"currentLayoutPosition",null),d(this,"layoutPositionAtPageStart",null),d(this,"lookupOffset",0),d(this,"faces"),d(this,"pageBoxInstances",{}),d(this,"pageManager",null),d(this,"rootPageFloatLayoutContext"),d(this,"pageBreaks",{}),d(this,"pageProgression",null),d(this,"isVersoFirstPage",!1),d(this,"blankPageAtStart",!1),d(this,"pageSheetSize",{}),d(this,"pageSheetHeight",0),d(this,"pageSheetWidth",0),this.lang=t.lang||n,this.faces=new sT(this.style.fontDeobfuscator),this.rootPageFloatLayoutContext=new Mo(null,null,null,null,null,null,null),this.pageProgression=p||null,this.isVersoFirstPage=!!c;for(let f in e.flowProps){let v=e.flowProps[f],w=xt(v,"flow-consume");w&&(w.evaluate(this,"flow-consume")==S.all?this.primaryFlows[f]=!0:delete this.primaryFlows[f])}}init(){let e=X("StyleInstance.init"),t=this.counterStore.createCounterListener(this.xmldoc.url),n=this.counterStore.createCounterResolver(this.xmldoc.url,this.style.rootScope,this.style.pageScope);this.styler=new jg(this.xmldoc,this.style.cascade,this.style.rootScope,this,this.primaryFlows,this.style.validatorSet,t,n),n.setStyler(this.styler),this.styler.resetFlowChunkStream(this),this.stylerMap={},this.stylerMap[this.xmldoc.url]=this.styler;let i=this.styler.getTopContainerStyle();this.pageProgression||(this.pageProgression=Sx(i)),this.matchStartPageSide(this.styler.breakBeforeValues[0])||(this.pageNumberOffset===0?this.isVersoFirstPage=!0:this.blankPageAtStart=!0);let r=this.style.rootBox;this.rootPageBoxInstance=new dT(r);let o=this.style.cascade.createInstance(this,t,n,this.lang);this.styler.cascade.currentPageType=this.styler.cascade.firstPageType,this.rootPageBoxInstance.applyCascadeAndInit(o,i),this.rootPageBoxInstance.resolveAutoSizing(this),this.pageManager=new RT(o,this.style.pageScope,this.rootPageBoxInstance,this,i);let s=[];for(let a of this.style.fontFaces){if(a.condition&&!a.condition.evaluate(this))continue;let u=oT(a.properties,this),h=new px(u);s.push(h)}this.fontMapper.findOrLoadFonts(s,this.faces).then(()=>{GT(this.xmldoc.document,this.viewport.window,this.styler).thenFinish(e)});let l=this.style.pageProps;return l[""]||(l[""]={}),Object.keys(l).forEach(a=>{let u=l[a];this.styler.cascade.applyVarFilter([u],this.styler,null),this.styler.cascade.applyCalcFilter(u,this.styler.context);let h=nm(Fa(u),this);this.pageSheetSize[a]={width:h.pageWidth+h.cropOffset*2,height:h.pageHeight+h.cropOffset*2}}),e.result()}matchStartPageSide(e){let t=this.pageNumberOffset%2==(this.isVersoFirstPage?1:0),n=this.pageProgression=="ltr";switch(e){case"left":return t!==n;case"right":return t===n;case"recto":return t;case"verso":return!t;default:return!0}}getStylerForDoc(e){let t=this.stylerMap[e.url];if(!t){let n=this.style.store.getStyleForDoc(e),i=new Zh(n.rootScope,this.pageWidth(),this.pageHeight(),this.initialFontSize),r=this.counterStore.createCounterListener(e.url),o=this.counterStore.createCounterResolver(e.url,n.rootScope,n.pageScope);t=new jg(e,n.cascade,n.rootScope,i,this.primaryFlows,n.validatorSet,r,o),this.stylerMap[e.url]=t}return t}registerInstance(e,t){this.pageBoxInstances[e]=t}lookupInstance(e){return this.pageBoxInstances[e]}encounteredFlowChunk(e,t){let n=this.currentLayoutPosition;if(n){n.flows[e.flowName]?t=n.flows[e.flowName]:n.flows[e.flowName]=t;let i=n.flowPositions[e.flowName];i||(i=new SE,n.flowPositions[e.flowName]=i);let r=yE(e.element),o=new Oi(r),s=new bE(o,e);i.positions.push(s)}}evalSupportsTest(e,t,n){if(n)return e==="selector"?this.evalSupportsSelector(t):!1;if(!e)return!1;let i=!0;class r{unknownProperty(a,u){i=!1}invalidPropertyValue(a,u){i=!1}simpleProperty(a,u,h){}}let o=new r,s=co(this.style.rootScope,new Fn(t,null),"");return s?(this.xmldoc.store.validatorSet.validatePropertyAndHandleShorthand(e,s,!1,o),i):!1}evalSupportsSelector(e){let t=new Lx(null),n=new Fn(e+"{}",t);return new Ks(Ze,n,t,"").runParser(Number.POSITIVE_INFINITY,!1,!1,!1,!1)?!t.cascadeParserHandler.invalid:!1}getConsumedOffset(e){let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.positions.length;n++){let i=e.positions[n].chunkPosition.primary,r=i.steps[0].node,o=i.offsetInNode,s=i.after,l=0;for(;r.ownerDocument!=this.xmldoc.document;)l++,r=i.steps[l].node,s=!1,o=0;let a=this.xmldoc.getNodeOffset(r,o,s);a<t&&(t=a)}return t}getPosition(e,t){if(!e)return 0;let n=Number.POSITIVE_INFINITY;for(let i in this.primaryFlows){let r=e.flowPositions[i];if(!t&&(!r||r.positions.length==0)&&this.currentLayoutPosition&&(this.styler.styleUntilFlowIsReached(i),r=this.currentLayoutPosition.flowPositions[i],e!=this.currentLayoutPosition&&r&&(r=r.clone(),e.flowPositions[i]=r)),r){let o=this.getConsumedOffset(r);o<n&&(n=o)}}return n}dumpLocation(e){le.debug("Location - page",this.currentLayoutPosition.page),le.debug("  current:",e),le.debug("  lookup:",this.lookupOffset);for(let t in this.currentLayoutPosition.flowPositions){let n=this.currentLayoutPosition.flowPositions[t];for(let i of n.positions)le.debug("  Chunk",`${t}:`,i.flowChunk.startOffset)}}matchPageSide(e){switch(e){case"left":case"right":case"recto":case"verso":return new lt(this.style.pageScope,`${e}-page`).evaluate(this);default:return!0}}updateStartSide(e){for(let t in e.flowPositions){let n=e.flowPositions[t];if(n&&n.positions.length>0){let i=n.positions[0].flowChunk;if(this.getConsumedOffset(n)===i.startOffset){let r=n.positions[0].flowChunk.breakBefore,o=n.startBreakType;n.startBreakType=vg(Bt(o,r))}}}}selectPageMaster(e){let t=this.currentLayoutPosition,n=this.getPosition(t);if(n==Number.POSITIVE_INFINITY)return null;let i=this.rootPageBoxInstance.children,r;for(let o=0;o<i.length;o++){if(r=i[o],r.pageBox.pseudoName===Sp)continue;let s=1;r.pageBox.pseudoName===wp&&!(this.actualPageWidth&&this.actualPageHeight)&&(s=1/0);let l=r.getProp(this,"utilization");l&&l.isNum()&&(s=l.num);let a=this.queryUnitSize("em",!1),u=this.pageWidth()*this.pageHeight(),h=Math.ceil(s*u/(a*a)),p=this.styler.cascade.currentPageType;this.lookupOffset=this.styler.styleUntil(n,h),this.styler.cascade.currentPageType=p,this.updateStartSide(t),this.layoutPositionAtPageStart=t.clone(),this.initLingering(),this.clearScope(this.style.pageScope);let c=r.getProp(this,"enabled");if(!c||c===S._true){if(t.page===1&&this.blankPageAtStart){r.style={};let f=e.size;e={},f&&(e.size=f)}return this.pageManager.getPageRulePageMaster(r,e)}}throw new Error("No enabled page masters")}flowChunkIsAfterParentFlowForcedBreak(e){let t=this.layoutPositionAtPageStart.flows,n=t[e.flowName].parentFlowName;if(n){let i=e.startOffset,r=t[n].forcedBreakOffsets;if(!r.length||i<r[0])return!1;let o=Ai(r.length,u=>r[u]>i)-1,s=r[o],l=this.layoutPositionAtPageStart.flowPositions[n],a=this.getConsumedOffset(l);return s<a?!1:a<s?!0:!this.matchPageSide(l.startBreakType)}return!1}setFormattingContextToColumn(e,t){let n=this.currentLayoutPosition.flows[t];n.formattingContext||(n.formattingContext=new ip(null)),e.flowRootFormattingContext=n.formattingContext}layoutDeferredPageFloats(e){let t=e.pageFloatLayoutContext,n=t.getDeferredPageFloatContinuations(),i=l=>{if(l.floatReference!==at.PAGE)return!1;let a=this.layoutPositionAtPageStart.flowPositions.body,u=a&&this.getConsumedOffset(a),h=this.xmldoc.getNodeOffset(l.nodePosition.steps[0].node,0,!1);return h!=null&&u!=null&&h>u},r=X("layoutDeferredPageFloats"),o=!1,s=0;return r.loopWithFrame(l=>{if(s===n.length){l.breakLoop();return}let a=n[s++],u=a.float;if(i(u)){l.breakLoop();return}let h=new io().findByFloat(u),p=h.findPageFloatFragment(u,t);if(p&&p.hasFloat(u)){l.continueLoop();return}else if(t.isForbidden(u)||t.hasPrecedingFloatsDeferredToNext(u)){t.deferPageFloat(a),l.breakLoop();return}e.layoutPageFloatInner(a,h,null,p).then(c=>{if(!c){l.breakLoop();return}let f=t.parent.isInvalidated();if(f){l.breakLoop();return}else t.isInvalidated()&&!f&&(o=!0,t.validate());l.continueLoop()})}).then(()=>{o&&t.invalidate(),r.finish(!0)}),r.result()}getLastAfterPositionIfDeferredFloatsExists(e,t){if(e.pageFloatLayoutContext.getPageFloatContinuationsDeferredToNext().length>0)if(e.lastAfterPosition){let n;return t?(n=t.clone(),n.primary=e.lastAfterPosition):n=new Oi(e.lastAfterPosition),n}else return null;else return null}layoutColumn(e,t){let n=this.currentLayoutPosition.flowPositions[t];if(!n||!this.matchPageSide(n.startBreakType))return R(!0);this.setFormattingContextToColumn(e,t),e.init(),this.primaryFlows[t]&&e.bands.length>0&&(e.forceNonfitting=!1);let i=X("layoutColumn");return this.layoutDeferredPageFloats(e).then(()=>{if(e.pageFloatLayoutContext.isInvalidated()){i.finish(!0);return}let r=[],o=[],s=!0;i.loopWithFrame(l=>{if(e.pageFloatLayoutContext.hasContinuingFloatFragmentsInFlow(t)){l.breakLoop();return}for(;n.positions.length-o.length>0;){let a=0;for(;o.includes(a);)a++;let u=n.positions[a];if(u.flowChunk.startOffset>this.lookupOffset||this.flowChunkIsAfterParentFlowForcedBreak(u.flowChunk))break;for(let c=a+1;c<n.positions.length;c++){if(o.includes(c))continue;let f=n.positions[c];if(f.flowChunk.startOffset>this.lookupOffset||this.flowChunkIsAfterParentFlowForcedBreak(f.flowChunk))break;f.flowChunk.isBetter(u.flowChunk)&&(u=f,a=c)}let h=u.flowChunk,p=!0;if(e.layout(u.chunkPosition,s,n.breakAfter).then(c=>{if(e.pageFloatLayoutContext.isInvalidated()){l.breakLoop();return}if(s=!1,u.flowChunk.repeated&&(c===null||h.exclusive)&&r.push(a),h.exclusive){o.push(a),l.breakLoop();return}else{let f=!!c||!!e.pageBreakType,v=this.getLastAfterPositionIfDeferredFloatsExists(e,c);if(e.pageBreakType&&v?(u.chunkPosition=v,n.breakAfter=e.pageBreakType,e.pageBreakType=null):(o.push(a),(c||v)&&(u.chunkPosition=c||v,r.push(a)),n.startBreakType=vg(e.pageBreakType)),f){l.breakLoop();return}}e.forceNonfitting=!1,p?p=!1:l.continueLoop()}),p){p=!1;return}}l.breakLoop()}).then(()=>{if(!e.pageFloatLayoutContext.isInvalidated()){n.positions=n.positions.filter((a,u)=>r.includes(u)||!o.includes(u)),n.breakAfter==="column"&&(n.breakAfter=null),e.saveDistanceToBlockEndFloats();let l=e.pageFloatLayoutContext.getMaxReachedAfterEdge();e.updateMaxReachedAfterEdge(l)}i.finish(!0)})}),i.result()}createLayoutConstraint(e){let t=this.currentLayoutPosition.page-1,n=this.counterStore.createLayoutConstraint(t);return new JP([n].concat(e.getLayoutConstraints()))}createAndLayoutColumn(e,t,n,i,r,o,s,l,a,u,h,p,c,f){let v=e.vertical?e.isAutoWidth&&e.isRightDependentOnAutoWidth:e.isAutoHeight&&e.isTopDependentOnAutoHeight,w=r.element,x=new Mo(l,at.COLUMN,null,s,null,null,null),g=this.currentLayoutPosition.clone(),m=X("createAndLayoutColumn"),y;return m.loopWithFrame(C=>{let P=this.createLayoutConstraint(x);if(a>1){let A=this.viewport.document.createElement("div");if(O(A,"position","absolute"),w.appendChild(A),y=new Aa(A,c,this.clientLayout,P,x),y.forceNonfitting=f,y.vertical=r.vertical,y.rtl=r.rtl,y.snapHeight=r.snapHeight,y.snapWidth=r.snapWidth,r.vertical){let I=(r.rtl?a-o-1:o)*(h+u)+r.paddingTop,M=parseFloat(w.style.width);y.setHorizontalPosition(r.paddingLeft+M-r.width,r.width),y.setVerticalPosition(I,h)}else{let I=(r.rtl?a-o-1:o)*(h+u)+r.paddingLeft;y.setVerticalPosition(r.paddingTop,r.height),y.setHorizontalPosition(I,h)}y.originX=t,y.originY=n}else y=new Aa(w,c,this.clientLayout,P,x),y.copyFrom(r);y.exclusions=v?[]:i.concat(),y.innerShape=p,x.setContainer(y),(y.vertical?y.height:y.width)>=0?this.layoutColumn(y,s).then(()=>{x.isInvalidated()||x.finish(),y.pageFloatLayoutContext.isInvalidated()&&!l.isInvalidated()?(y.pageFloatLayoutContext.validate(),this.currentLayoutPosition=g.clone(),y.element!==w&&w.removeChild(y.element),C.continueLoop()):C.breakLoop()}):(x.finish(),C.breakLoop())}).then(()=>{m.finish(y)}),m.result()}setPagePageFloatLayoutContextContainer(e,t,n){(t instanceof Ex||t instanceof yp&&!(t instanceof ls))&&e.setContainer(n)}getRegionPageFloatLayoutContext(e,t,n,i){let r=t.getProp(this,"writing-mode")||null,o=t.getProp(this,"direction")||null;return new Mo(e,at.REGION,n,i,null,r,o)}layoutFlowColumnsWithBalancing(e,t,n,i,r,o,s,l,a){let u=this.currentLayoutPosition.clone(),h=this.getRegionPageFloatLayoutContext(o,t,s,l),p=!0,c=()=>(this.currentLayoutPosition=u.clone(),this.layoutFlowColumns(e,t,n,i,r,o,h,s,l,a,p).thenAsync(f=>R(f?{columns:f,position:this.currentLayoutPosition}:null)));return c().thenAsync(f=>{if(!f)return R(null);if(a<=1)return R(f.columns);let v=t.getProp(this,"column-fill")||S.balance,w=this.currentLayoutPosition.flowPositions[l],x=VN(a,v,c,h,s,f.columns,w);return x?(p=!1,o.lock(),h.lock(),x.balanceColumns(f).thenAsync(g=>(o.unlock(),o.validate(),h.unlock(),this.currentLayoutPosition=g.position,R(g.columns)))):R(f.columns)})}layoutFlowColumns(e,t,n,i,r,o,s,l,a,u,h){let p=X("layoutFlowColumns"),c=this.currentLayoutPosition.clone(),f=t.getPropAsNumber(this,"column-gap"),v=u>1?t.getPropAsNumber(this,"column-width"):l.vertical?l.height:l.width,w=t.getActiveRegions(this),x=t.getProp(this,"shape-inside"),g=Sy(x,0,0,l.width,l.height,this),m=new QT(a,this,this.viewport,this.styler,w,this.xmldoc,this.faces,this.style.footnoteProps,this,e,this.customRenderer,this.fallbackMap,this.documentURLTransformer),y=0,C=null,P=[];return p.loopWithFrame(A=>{this.createAndLayoutColumn(t,n,i,r,l,y++,a,s,u,f,v,g,m,h).then(I=>{if(o.isInvalidated()){P=null,A.breakLoop();return}if((I.pageBreakType&&I.pageBreakType!=="column"||y===u)&&!s.isInvalidated()&&s.finish(),s.isInvalidated()){y=0,this.currentLayoutPosition=c.clone(),s.validate(),s.isLocked()?(P=null,A.breakLoop()):A.continueLoop();return}C=I,P[y-1]=C,C.pageBreakType&&C.pageBreakType!="column"&&(y=u,C.pageBreakType!="region"&&(this.pageBreaks[a]=!0)),y<u?A.continueLoop():A.breakLoop()})}).then(()=>{p.finish(P)}),p.result()}layoutContainer(e,t,n,i,r,o,s){t.reset();let l=t.getProp(this,"enabled");if(l&&l!==S._true)return R(!0);let a=X("layoutContainer"),u=t.getProp(this,"wrap-flow")===S.auto,h=t.getProp(this,"flow-from"),p=this.viewport.document.createElement("div"),c=t.getProp(this,"position");O(p,"position",c?c.name:"absolute");let f=t instanceof ls;t instanceof el?n.appendChild(p):n.insertBefore(p,n.firstChild);let v=new i0(p);v.vertical=t.vertical,v.rtl=t.rtl,v.borderBoxSizing=t.borderBoxSizing,v.exclusions=o,t.prepareContainer(this,v,e,this.faces,this.clientLayout),t instanceof ls&&(v.width<=0||v.height<=0)&&le.warn("Negative or zero page area size"),v.originX=i,v.originY=r,i+=v.left+v.marginLeft+v.borderLeft,r+=v.top+v.marginTop+v.borderTop,this.setPagePageFloatLayoutContextContainer(s,t,v);let w,x=!1;if(!h||!h.isIdent()){let g=t.getProp(this,"content");if(g instanceof re&&g.expr instanceof mt&&g.expr.str.startsWith("running-element-"))g.visit(new Ta(p,this,g,this.counterStore.getExprContentListener()));else if(g&&Bi(g)){let m="span";g.url&&(m="img");let y=this.viewport.document.createElement(m);g.visit(new Ta(y,this,g,this.counterStore.getExprContentListener())),p.appendChild(y),m=="img"&&t.transferSingleUriContentProps(this,y,this.faces),t.transferContentProps(this,v,e,this.faces),m=="span"&&jP(y,t.getProp(this,"text-autospace"),t.getProp(this,"text-spacing-trim"),t.getProp(this,"hanging-punctuation"),this.lang,t.vertical)}else t.suppressEmptyBoxGeneration&&(n.removeChild(p),x=!0);x||t.finishContainer(this,v,e,null,1,this.clientLayout,this.faces),w=R(!0)}else if(this.pageBreaks[h.toString()])s.isInvalidated()||t.finishContainer(this,v,e,null,1,this.clientLayout,this.faces),w=R(!0);else{let g=X("layoutContainer.inner"),m=h.toString(),y=t.getPropAsNumber(this,"column-count");this.layoutFlowColumnsWithBalancing(e,t,i,r,o,s,v,m,y).then(C=>{if(!s.isInvalidated()){let P=C[0];P.element===p&&(v=P),v.computedBlockSize=Math.max.apply(null,C.map(I=>I.computedBlockSize)),t.finishContainer(this,v,e,P,y,this.clientLayout,this.faces);let A=this.currentLayoutPosition.flowPositions[m];A&&A.breakAfter==="region"&&(A.breakAfter=null)}g.finish(!0)}),w=g.result()}return w.then(()=>{if(s.isInvalidated()){a.finish(!0);return}if(!t.isAutoHeight||Math.floor(v.computedBlockSize)>0){if(!x&&!u){let m=t.getProp(this,"shape-outside"),y=v.getOuterShape(m,this);o.push(y)}}else if(t.children.length==0){n.removeChild(p),a.finish(!0);return}let g=f?0:t.children.length-1;a.loop(()=>{for(;g>=0&&g<t.children.length;){let m=t.children[f?g++:g--],y=this.layoutContainer(e,m,p,i,r,o,s);if(y.isPending())return y.thenAsync(()=>R(!s.isInvalidated()));if(s.isInvalidated())break}return R(!1)}).then(()=>{a.finish(!0)})}),a.result()}processLinger(){let e=this.currentLayoutPosition.page;for(let t in this.currentLayoutPosition.flowPositions){let n=this.currentLayoutPosition.flowPositions[t];for(let i=n.positions.length-1;i>=0;i--){let r=n.positions[i];r.flowChunk.startPage>=0&&r.flowChunk.startPage+r.flowChunk.linger-1<=e&&n.positions.splice(i,1)}}}initLingering(){let e=this.currentLayoutPosition.page;for(let t in this.currentLayoutPosition.flowPositions){let n=this.currentLayoutPosition.flowPositions[t];for(let i=n.positions.length-1;i>=0;i--){let r=n.positions[i];r.flowChunk.startPage<0&&r.flowChunk.startOffset<this.lookupOffset&&(r.flowChunk.startPage=e)}}}noMorePrimaryFlows(e){for(let t in this.primaryFlows){let n=e.flowPositions[t];if(n&&n.positions.length>0)return!1}return!0}layoutNextPage(e,t){var n;let i=e.container===e.bleedBox;this.pageBreaks={},t?(this.currentLayoutPosition=t.clone(),this.styler.replayFlowElementsFromOffset(t.highestSeenOffset)):(this.currentLayoutPosition=new CE,this.styler.replayFlowElementsFromOffset(-1)),this.lang&&e.bleedBox.setAttribute("lang",this.lang),t=this.currentLayoutPosition;let r=1e4;if(t.page>r)throw new Error(`Too many pages generated (over ${r} pages)`);let o=t.startSideOfFlow("body");t.isBlankPage=Rs(o)&&this.matchPageSide(o),e.isBlankPage=t.isBlankPage,t.page++,e.pageType==null&&(e.pageType=(n=e.isBlankPage?this.styler.cascade.previousPageType:this.styler.cascade.currentPageType)!=null?n:"",this.styler.cascade.previousPageType=this.styler.cascade.currentPageType),this.clearScope(this.style.pageScope),this.layoutPositionAtPageStart=t.clone();let s=i?{}:this.pageManager.getCascadedPageStyle(e.pageType);if(this.styler.cascade.applyVarFilter([s],this.styler,null),this.styler.cascade.applyCalcFilter(s,this.styler.context),!i){let f=new lt(this.style.pageScope,"left-page");e.side=f.evaluate(this)?"left":"right",e.container.setAttribute("data-vivliostyle-page-side",e.side)}let l=this.selectPageMaster(s);if(!l)return R(null);let a=0;if(!i){e.setAutoPageWidth(l.pageBox.specified.width.value===Gs),e.setAutoPageHeight(l.pageBox.specified.height.value===Xs),this.counterStore.setCurrentPage(e),this.counterStore.updatePageCounters(s,this);let f=nm(Fa(s),this);this.setPageSizeAndBleed(f,e),ST(s,f,e,this),a=f.bleedOffset+f.bleed}let u=!i&&l.getProp(this,"writing-mode")||S.horizontal_tb;this.pageVertical=u!=S.horizontal_tb;let h=l.getProp(this,"direction")||S.ltr,p=new Mo(this.rootPageFloatLayoutContext,at.PAGE,null,null,null,u,h),c=X("layoutNextPage");return c.loopWithFrame(f=>{this.layoutContainer(e,l,e.bleedBox,a,a,[],p).then(()=>{p.isInvalidated()||p.finish(),p.isInvalidated()?(this.currentLayoutPosition=this.layoutPositionAtPageStart.clone(),p.validate(),f.continueLoop()):f.breakLoop()})}).then(()=>{l.adjustPageLayout(this,e,this.clientLayout),i||(this.processLinger(),t=this.currentLayoutPosition,Object.keys(t.flowPositions).forEach(v=>{let w=t.flowPositions[v],x=w.breakAfter;x&&(x==="page"||!this.matchPageSide(x))&&(w.breakAfter=null)})),this.currentLayoutPosition=this.layoutPositionAtPageStart=null,t.highestSeenOffset=this.styler.getReachedOffset();let f=this.style.store.getTriggersForDoc(this.xmldoc);e.finish(f,this.clientLayout),this.noMorePrimaryFlows(t)&&(t=null),c.finish(t)}),c.result()}setPageSizeAndBleed(e,t){this.actualPageWidth=e.pageWidth,this.actualPageHeight=e.pageHeight,this.pageSheetWidth=e.pageWidth+e.cropOffset*2,this.pageSheetHeight=e.pageHeight+e.cropOffset*2,t.container.style.width=`${this.pageSheetWidth}px`,t.container.style.height=`${this.pageSheetHeight}px`,t.bleedBox.style.left=`${e.bleedOffset}px`,t.bleedBox.style.width=`${e.pageWidth}px`,t.bleedBox.style.top=`${e.bleedOffset}px`,t.bleedBox.style.height=`${e.pageHeight}px`,t.bleedBox.style.padding=`${e.bleed}px`}},sI=class Dc extends As{constructor(t,n,i,r){super(t.rootScope,t,n,i,r,t.validatorSet,!i),this.masterHandler=t,d(this,"insideRegion",!1)}startPageTemplateRule(){}startPageMasterRule(t,n,i){let r=new fx(this.masterHandler.pageScope,t,n,i,this.masterHandler.rootBox,this.condition,this.owner.getBaseSpecificity());this.masterHandler.pushHandler(new gT(r.scope,this.masterHandler,r,this.validatorSet))}startWhenRule(t){let n=t.expr;this.condition!=null&&(n=mn(this.scope,this.condition,n)),this.masterHandler.pushHandler(new Dc(this.masterHandler,n,this,this.regionId))}startDefineRule(){this.masterHandler.pushHandler(new MP(this.scope,this.owner))}startFontFaceRule(){let t={};this.masterHandler.fontFaces.push({properties:t,condition:this.condition}),this.masterHandler.pushHandler(new Pl(this.scope,this.owner,null,t,this.masterHandler.validatorSet,"font-face"))}startFlowRule(t){let n=this.masterHandler.flowProps[t];n||(n={},this.masterHandler.flowProps[t]=n),this.masterHandler.pushHandler(new Pl(this.scope,this.owner,null,n,this.masterHandler.validatorSet))}startViewportRule(){let t={};this.masterHandler.viewportProps.push(t),this.masterHandler.pushHandler(new Pl(this.scope,this.owner,this.condition,t,this.masterHandler.validatorSet))}startFootnoteRule(t){let n=this.masterHandler.footnoteProps;if(t){let i=ou(n,"_pseudos");n=i[t],n||(n={},i[t]=n)}this.masterHandler.pushHandler(new Pl(this.scope,this.owner,null,n,this.masterHandler.validatorSet))}startRegionRule(){this.insideRegion=!0,this.startSelectorRule()}startPageRule(){let t=new VT(this.masterHandler.pageScope,this.masterHandler,this,this.validatorSet,this.masterHandler.pageProps);this.masterHandler.pushHandler(t),t.startPageRule()}startRuleBody(){if(As.prototype.startRuleBody.call(this),this.insideRegion){this.insideRegion=!1;let t=`R${this.masterHandler.regionCount++}`;this.special("region-id",q(t)),this.endRule();let n=new Dc(this.masterHandler,this.condition,this,t);this.masterHandler.pushHandler(n),n.startRuleBody()}}},Lx=class extends Gk{constructor(e){super(),this.validatorSet=e,d(this,"rootScope"),d(this,"pageScope"),d(this,"rootBox"),d(this,"cascadeParserHandler"),d(this,"regionCount",0),d(this,"fontFaces",[]),d(this,"footnoteProps",{}),d(this,"flowProps",{}),d(this,"viewportProps",[]),d(this,"pageProps",{}),this.rootScope=new Qh(null),this.pageScope=new Qh(this.rootScope),this.rootBox=new uT(this.rootScope),this.cascadeParserHandler=new sI(this,null,null,null),this.slave=this.cascadeParserHandler}};function lI(e,t){return t.parseOPSResource(e)}var aI=class extends qd{constructor(e){super(lI,"document"),this.fontDeobfuscator=e,d(this,"styleByKey",{}),d(this,"styleFetcherByKey",{}),d(this,"styleByDocURL",{}),d(this,"triggersByDocURL",{}),d(this,"validatorSet",null),d(this,"styleSheets",[]),d(this,"triggerSingleDocumentPreprocessing",!1)}init(e,t){this.setStyleSheets(e,t);let n=X("OPSDocStore.init");return this.validatorSet=dx(),rI().then(()=>{this.triggerSingleDocumentPreprocessing=!0,n.finish(!0)}),n.result()}getStyleForDoc(e){return this.styleByDocURL[e.url]}getTriggersForDoc(e){return this.triggersByDocURL[e.url]}setStyleSheets(e,t){this.clearStyleSheets(),e&&e.forEach(this.addAuthorStyleSheet,this),t&&t.forEach(this.addUserStyleSheet,this)}clearStyleSheets(){this.styleSheets.splice(0)}addAuthorStyleSheet(e){let t=e.url;t&&(t=et(Is(t),eo)),this.styleSheets.push({url:t,text:e.text,flavor:"Author",classes:null,media:null})}addUserStyleSheet(e){let t=e.url;t&&(t=et(Is(t),eo)),this.styleSheets.push({url:t,text:e.text,flavor:"User",classes:null,media:null})}parseOPSResource(e){let t=X("OPSDocStore.load"),n=e.url,i=n.endsWith("?viv-toc-box");return Rx(e,this).then(r=>{var o;if(!r){t.finish(null);return}if(this.triggerSingleDocumentPreprocessing){let c=An("PREPROCESS_SINGLE_DOCUMENT");for(let f=0;f<c.length;f++)try{c[f](r.document)}catch(v){le.warn("Error during single document preprocessing:",v)}}let s=[],l=r.document.getElementsByTagNameNS("http://www.idpf.org/2007/ops","trigger");for(let c=0;c<l.length;c++){let f=l[c],v=f.getAttributeNS("http://www.w3.org/2001/xml-events","observer"),w=f.getAttributeNS("http://www.w3.org/2001/xml-events","event"),x=f.getAttribute("action"),g=f.getAttribute("ref");v&&w&&x&&g&&s.push({observer:v,event:w,action:x,ref:g})}this.triggersByDocURL[n]=s;let a=[];if(a.push({url:et("user-agent-page.css",lr),text:Ay,flavor:"UA",classes:null,media:null}),i)a.push({url:et("user-agent-toc.css",lr),text:Fy,flavor:"UA",classes:null,media:null});else{let c=r.document.querySelectorAll("style, link, meta");for(let f of c){let v=f.namespaceURI,w=f.localName;if(v=="http://www.w3.org/1999/xhtml")if(w=="style"){let x=f.getAttribute("class"),g=f.getAttribute("media"),m=f.getAttribute("title");a.push({url:n,text:f.textContent,flavor:"Author",classes:m?x:null,media:g})}else if(w=="link"){let x=f.getAttribute("href"),g=(o=f.getAttribute("rel"))==null?void 0:o.split(/\s+/),m=f.getAttribute("class"),y=f.getAttribute("media");if(x&&g!=null&&g.includes("stylesheet")&&(!g.includes("alternate")||m)){let C=et(x,n),P=f.getAttribute("title");a.push({url:C,text:null,classes:P?m:null,media:y,flavor:"Author"})}}else w=="meta"&&f.getAttribute("name")=="viewport"&&a.push({url:n,text:this.processViewportMeta(f),flavor:"Author",classes:null,media:null})}for(let f=0;f<this.styleSheets.length;f++)a.push(this.styleSheets[f])}let u="";for(let c=0;c<a.length;c++)u+=a[c].url,u+="^",a[c].text&&(u+=a[c].text),u+="^";let h=this.styleByKey[u];if(h){this.styleByDocURL[n]=h,t.finish(r);return}let p=this.styleFetcherByKey[u];p||(p=new Ys(()=>{let c=X("fetchStylesheet"),f=0,v=new Lx(this.validatorSet);return c.loop(()=>{if(f<a.length){let w=a[f++];return v.startStylesheet(w.flavor),w.text!==null?Qd(w.text,v,w.url,w.classes,w.media).thenReturn(!0):Dy(w.url,v,w.classes,w.media)}return R(!1)}).then(()=>{let w=v.cascadeParserHandler.finish();h=new oI(this,v.rootScope,v.pageScope,w,v.rootBox,v.fontFaces,v.footnoteProps,v.flowProps,v.viewportProps,v.pageProps),this.styleByKey[u]=h,delete this.styleFetcherByKey[u],c.finish(h)}),c.result()},`FetchStylesheet ${n}`),this.styleFetcherByKey[u]=p,p.start()),p.get().then(c=>{this.styleByDocURL[n]=c,t.finish(r)})}),t.result()}processViewportMeta(e){return""}},as="▸",sm="▾",uI="▹";function Ep(e){let t=Array.from(e.querySelectorAll("nav[*|type],nav[epub\\:type]"));if(t.length>0||(t=Array.from(e.querySelectorAll("[role=doc-toc]")),t.length>0))return t;let n="nav,.toc,#toc,#table-of-contents,#contents,[role=directory]";for(let i of e.querySelectorAll(n)){if(t.find(o=>o.contains(i)))continue;let r=i;/^h[1-6]$/.test(r.localName)&&(r.previousElementSibling?r=r.nextElementSibling:r=r.parentElement),r&&r.querySelector("li a[href]")&&t.push(r)}return t}function hI(e){let t=Ep(e),n=[];for(let i of t)for(let r of i.querySelectorAll("li a[href]"))n.push(r);return n}var cI=class{constructor(e,t,n,i,r,o,s,l,a,u){this.store=e,this.url=t,this.lang=n,this.clientLayout=i,this.fontMapper=r,this.rendererFactory=s,this.fallbackMap=l,this.documentURLTransformer=a,this.counterStore=u,d(this,"pref"),d(this,"page",null),d(this,"instance",null),this.pref=qw(o),this.pref.spreadView=!1}setAutoHeight(e,t){if(t--!=0){for(let n=e.firstChild;n;n=n.nextSibling)if(n.nodeType==1){let i=n;mi(i,"height","auto")!="auto"&&(O(i,"height","auto"),this.setAutoHeight(i,t)),mi(i,"position","static")=="absolute"&&(O(i,"position","relative"),this.setAutoHeight(i,t))}}}makeCustomRenderer(e){let t=this.rendererFactory.makeCustomRenderer(e);return(n,i,r)=>{let o=r.behavior;if(o)switch(o.toString()){case"toc-node-anchor":r.color=S.inherit,r["text-decoration"]=S.none;break;case"toc-node":r.display=S.block,r.margin=Ve,r.padding=Ve,r["padding-inline-start"]=new z(1.25,"em");break;case"toc-node-first-child":r.display=S.inline_block,r.margin=new z(.2,"em"),r["vertical-align"]=S.top,r.color=S.inherit,r["text-decoration"]=S.none;break;case"toc-container":r.padding=Ve;break}if(!o||o.toString()!="toc-node"&&o.toString()!="toc-container")return t(n,i,r);let s=n.firstChild;s&&s.nodeType!==1&&vt(s)&&n.replaceChild(n.ownerDocument.createComment(s.textContent),s);let l=i.getAttribute("data-adapt-class");if(l=="toc-node"){let u=i.firstChild;u.textContent!=as&&(u.textContent=as,O(u,"cursor","pointer"),u.addEventListener("click",dI,!1),u.setAttribute("role","button"),u.setAttribute("aria-expanded","false"),i.setAttribute("aria-expanded","false"),i.style.height!=="0px"&&(u.tabIndex=0))}let a=i.ownerDocument.createElement("div");if(a.setAttribute("data-adapt-process-children","true"),o.toString()=="toc-node"){let u=i.ownerDocument.createElement("div");if(u.textContent=uI,O(u,"margin","0.2em 0 0 -1em"),O(u,"margin-inline-start","-1em"),O(u,"margin-inline-end","0"),O(u,"display","inline-block"),O(u,"width","1em"),O(u,"text-align","center"),O(u,"vertical-align","top"),O(u,"cursor","default"),O(u,"font-family","Menlo,sans-serif"),a.appendChild(u),O(a,"overflow","hidden"),a.setAttribute("data-adapt-class","toc-node"),a.setAttribute("role","treeitem"),l=="toc-node"||l=="toc-container"){O(a,"height","0px");let h=n.firstElementChild;h&&h.localName==="a"&&(h.tabIndex=-1)}else i.setAttribute("role","tree")}else l=="toc-node"&&(a.setAttribute("data-adapt-class","toc-container"),a.setAttribute("role","group"),a.setAttribute("aria-hidden","true"));return R(a)}}showTOC(e,t,n,i,r){if(this.page)return R(this.page);let o=X("showTOC"),s=new qy(e,e);this.page=s;let l=Yn(this.url)+"?viv-toc-box";return this.store.load(l).then(a=>{for(let f of Ep(a.document))f.setAttribute("data-vivliostyle-role","doc-toc");let u=this.store.getStyleForDoc(a),h=u.sizeViewport(n,1e5,r);t=new Oa(t.window,h.fontSize,0,t.root,h.width,h.height);let p=this.makeCustomRenderer(a),c=new kp(u,a,this.lang,t,this.clientLayout,this.fontMapper,p,this.fallbackMap,0,this.documentURLTransformer,this.counterStore);this.instance=c,c.pref=this.pref,c.init().then(()=>{c.layoutNextPage(s,null).then(()=>{this.setAutoHeight(e,2),o.finish(s)})})}),o.result()}hideTOC(){this.page&&(this.page.container.style.visibility="hidden",this.page.container.setAttribute("aria-hidden","true"))}isTOCVisible(){return!!this.page&&this.page.container.style.visibility==="visible"}getTOC(){if(!this.page)return[];function e(i){if(!i)return[];let r=i.querySelectorAll(":scope > [role=treeitem] > a[href]");return Array.from(r).map(t)}function t(i){let r=new URL(i.href),[,o]=r.hash.match(/^#?(.*)$/),s=i.innerText,l=i.parentElement.querySelector("[role=group]"),a=e(l);return{id:o,title:s,children:a}}let n=this.page.container.querySelector("[role=tree]");return e(n)}};function dI(e){let t=e.target,n=t.textContent==as;t.textContent=n?sm:as;let i=t.parentNode;t.setAttribute("aria-expanded",n?"true":"false"),i.setAttribute("aria-expanded",n?"true":"false");let r=i.firstChild;for(;r;){if(r.nodeType===1){let o=r,s=o.getAttribute("data-adapt-class");if(s==="toc-container"){if(o.setAttribute("aria-hidden",n?"false":"true"),o.firstChild){r=o.firstChild;continue}}else if(s==="toc-node"&&(o.style.height=n?"auto":"0px",o.children.length>=2&&(o.children[1].tabIndex=n?0:-1),o.children.length>=3&&(o.children[0].tabIndex=n?0:-1,!n))){let l=o.children[0];if(l.textContent==sm){l.textContent=as,l.setAttribute("aria-expanded","false"),o.setAttribute("aria-expanded","false"),r=o.children[2];continue}}}for(;!r.nextSibling&&r.parentNode!==i;)r=r.parentNode;r=r.nextSibling}e.stopPropagation()}var lm=class extends aI{constructor(){super(null),d(this,"plainXMLStore"),d(this,"jsonStore"),d(this,"opfByURL",{}),d(this,"primaryOPFByEPubURL",{}),d(this,"deobfuscators",{}),d(this,"documents",{}),this.fontDeobfuscator=this.makeDeobfuscatorFactory(),this.plainXMLStore=tI(),this.jsonStore=Uk()}makeDeobfuscatorFactory(){return e=>this.deobfuscators[e]}loadAsPlainXML(e,t,n){return this.plainXMLStore.load(e,t,n)}startLoadingAsPlainXML(e){this.plainXMLStore.fetch(e)}loadAsJSON(e,t,n){return this.jsonStore.load(e,t,n)}loadPubDoc(e){let t=X("loadPubDoc");return iu(e,null,"HEAD").then(n=>{if(n.status>=400)this.loadEPUBDoc(e).then(i=>{if(i){t.finish(i);return}le.error(`Failed to fetch a source document from ${e} (${n.status}${n.statusText?" "+n.statusText:""})`),t.finish(null)});else if(!n.status&&!n.responseXML&&!n.responseText&&!n.responseBlob&&!n.contentType&&/\/[^/.]+(?:[#?]|$)/.test(e)&&(e=e.replace(/([#?]|$)/,"/$1")),n.contentType=="application/oebps-package+xml"||/\.opf(?:[#?]|$)/.test(e)){let[,i,r]=e.match(/^((?:.*\/)?)([^/]*)$/);this.loadOPF(i,r).thenFinish(t)}else n.contentType=="application/ld+json"||n.contentType=="application/webpub+json"||n.contentType=="application/audiobook+json"||n.contentType=="application/json"||/\.json(?:ld)?(?:[#?]|$)/.test(e)?this.loadAsJSON(e,!0).then(i=>{if(!i){this.reportLoadError(e),t.finish(null);return}let r=new ql(this,e);r.initWithWebPubManifest(i,void 0,e).then(()=>{t.finish(r)})}):this.loadWebPub(e).then(i=>{if(i){t.finish(i);return}this.loadEPUBDoc(e).then(r=>{if(r){t.finish(r);return}le.error(`Failed to load ${e}.`),t.finish(null)})})}),t.result()}loadEPUBDoc(e){let t=X("loadEPUBDoc");e.endsWith("/")||(e=e+"/"),this.startLoadingAsPlainXML(e+"META-INF/encryption.xml");let n=e+"META-INF/container.xml";return this.loadAsPlainXML(n).then(i=>{if(i){let r=i.doc().child("container").child("rootfiles").child("rootfile").attribute("full-path");for(let o of r)if(o){this.loadOPF(e,o).thenFinish(t);return}}t.finish(null)}),t.result()}loadOPF(e,t){let n=e+t,i=this.opfByURL[n];if(i)return R(i);let r=X("loadOPF");return this.loadAsPlainXML(n,!0,`Failed to fetch EPUB OPF ${n}`).then(o=>{o?(i=new ql(this,e),this.opfByURL[n]=i,this.primaryOPFByEPubURL[e]=i,this.plainXMLStore.resources[e+"META-INF/container.xml"]?this.loadAsPlainXML(e+"META-INF/encryption.xml").then(s=>{i.initWithXMLDoc(o,s).then(()=>{r.finish(i)})}):i.initWithXMLDoc(o,null).then(()=>{r.finish(i)})):this.reportLoadError(n)}),r.result()}loadWebPub(e){let t=X("loadWebPub");return this.load(e).then(n=>{if(!n)this.reportLoadError(e);else if(n.document.querySelector("a[href='META-INF/'],a[href$='/META-INF/']"))t.finish(null);else{let i=n.document,r=new ql(this,e),o=i.querySelector("link[rel='publication'],link[rel='manifest'][type='application/webpub+json']");if(o){let s=o.getAttribute("href");if(/^#/.test(s)){let l=Dd(i.getElementById(s.substr(1)).textContent);r.initWithWebPubManifest(l,i).then(()=>{t.finish(r)})}else{let l=et(o.getAttribute("href"),e);this.loadAsJSON(l,!0,`Failed to fetch Publication Manifest ${l}`).then(a=>{r.initWithWebPubManifest(a,i,l).then(()=>{t.finish(r)})})}}else r.initWithWebPubManifest({},i).then(()=>{r.toc&&r.toc.src===n.url&&Ep(i).length===0&&(r.toc=null),t.finish(r)})}}),t.result()}addDocument(e,t){let n=X("EPUBDocStore.load"),i=Yn(e);return(this.documents[i]=this.parseOPSResource({status:200,statusText:"",url:i,contentType:t.contentType,responseText:null,responseXML:t,responseBlob:null})).thenFinish(n),n.result()}reportLoadError(e){let t=i=>i.replace(/([^:/?#]|^)[/?#].*/,"$1"),n=()=>{let i=t(e);return!(i===t(eo)||Object.keys(this.resources).find(r=>this.resources[r]&&t(r)===i)||!/^https?:?\/\/[^/]/.test(e)||/\.(xhtml|xht|xml|opf)$/i.test(e))};e.startsWith("data:")?le.error(`Failed to load ${e}. Invalid data.`):e.startsWith("http:")&&eo.startsWith("https:")?le.error(`Failed to load ${e}. Mixed Content ("http:" content on "https:" context) is not allowed.`):n()?le.error(`Failed to load ${e}. This may be caused by the server not allowing cross-origin resource sharing (CORS).`):le.error(`Failed to load ${e}. The target resource is invalid.`)}load(e){let t=Yn(e),n=this.documents[t];if(n)return n.isPending()?n:R(n.get());{let i=X("EPUBDocStore.load");return n=super.load(t,!0,`Failed to fetch a source document from ${t}`),n.then(r=>{r?i.finish(r):this.reportLoadError(t)}),i.result()}}processViewportMeta(e){let t=e.getAttribute("content");if(!t)return"";let n={},i;for(;(i=t.match(/^,?\s*([-A-Za-z_.][-A-Za-z_0-9.]*)\s*=\s*([-+A-Za-z_0-9.]*)\s*/))!=null;)t=t.substr(i[0].length),n[i[1]]=i[2];let r=n.width-0,o=n.height-0;if(r&&o){let s=!!Object.values(this.primaryOPFByEPubURL).find(l=>l.prePaginated);return`@-epubx-viewport{width:${r}px;height:${o}px;}`+(s?`@page{size:${r}px ${o}px;margin:0;}`:"@page{margin:0;}")}return""}},am=class{constructor(){d(this,"id",null),d(this,"src",""),d(this,"mediaType",null),d(this,"title",null),d(this,"itemRefElement",null),d(this,"spineIndex",-1),d(this,"compressedSize",0),d(this,"compressed",null),d(this,"epage",0),d(this,"epageCount",0),d(this,"startPage",null),d(this,"skipPagesBefore",null),d(this,"itemProperties"),this.itemProperties=dC}initWithElement(e,t){this.id=e.getAttribute("id"),this.src=et(e.getAttribute("href"),t),this.mediaType=e.getAttribute("media-type");let n=e.getAttribute("properties");n&&(this.itemProperties=yC(n.split(/\s+/)))}initWithParam(e){this.spineIndex=e.index,this.id=`item${e.index+1}`,this.src=e.url,this.startPage=e.startPage,this.skipPagesBefore=e.skipPagesBefore}};function pI(e){return e.id}function fI(e){return t=>{let n=X("deobfuscator");return gI("SHA-1",e).then(i=>{let r=t.slice(0,1040),o=t.slice(1040,t.size);$k(r).then(s=>{let l=new DataView(s);for(let a=0;a<l.byteLength;a++){let u=l.getUint8(a);u^=i[a%20],l.setUint8(a,u)}n.finish(By([l,o]))})}),n.result()}}function gI(e,t){let n=X("makeDigest"),i=n.suspend();return window.crypto.subtle.digest(e,new TextEncoder().encode(t)).then(r=>{i.schedule(new Uint8Array(r))}),n.result()}var wi={dcterms:"http://purl.org/dc/terms/",marc:"http://id.loc.gov/vocabulary/",media:"http://www.idpf.org/epub/vocab/overlays/#",rendition:"http://www.idpf.org/vocab/rendition/#",onix:"http://www.editeur.org/ONIX/book/codelists/current.html#",xsd:"http://www.w3.org/2001/XMLSchema#",opf:"http://www.idpf.org/2007/opf"},Vo="http://idpf.org/epub/vocab/package/meta/#",rt={language:`${wi.dcterms}language`,title:`${wi.dcterms}title`,creator:`${wi.dcterms}creator`,layout:`${wi.rendition}layout`,titleType:`${Vo}title-type`,displaySeq:`${Vo}display-seq`,alternateScript:`${Vo}alternate-script`,role:`${Vo}role`};function mI(e,t){let n={};return(i,r)=>{var o,s,l,a,u,h;let p,c,f=i.r||n,v=r.r||n;if(e==rt.title&&(p=((o=f[rt.titleType])==null?void 0:o[0].v)=="main",c=((s=v[rt.titleType])==null?void 0:s[0].v)=="main",p!=c))return p?-1:1;let w=parseInt((l=f[rt.displaySeq])==null?void 0:l[0].v,10);isNaN(w)&&(w=Number.MAX_VALUE);let x=parseInt((a=v[rt.displaySeq])==null?void 0:a[0].v,10);return isNaN(x)&&(x=Number.MAX_VALUE),w!=x?w-x:e!=rt.language&&t&&(p=((u=f[rt.language]||f[rt.alternateScript])==null?void 0:u[0].v)==t,c=((h=v[rt.language]||v[rt.alternateScript])==null?void 0:h[0].v)==t,p!=c)?p?-1:1:i.o-r.o}}function vI(e,t){let n;if(!t)n=wi;else{n={};for(let c in wi)n[c]=wi[c];let p;for(;(p=t.match(/^\s*([A-Z_a-z\u007F-\uFFFF][-.A-Z_a-z0-9\u007F-\uFFFF]*):\s*(\S+)/))!=null;)t=t.substr(p[0].length),n[p[1]]=p[2]}let i=p=>{if(p){let c=p.match(/^\s*(([^:]*):)?(\S+)\s*$/);if(c){let f=c[2]?n[c[2]]:Vo;if(f)return f+c[3]}}return null},r=1,o=e.childElements().forEachNonNull(p=>{if(p.localName=="meta"){let c=i(p.getAttribute("property"));if(c)return{name:c,value:p.textContent,id:p.getAttribute("id"),order:r++,refines:p.getAttribute("refines"),lang:null,scheme:i(p.getAttribute("scheme")),role:null}}else if(p.namespaceURI=="http://purl.org/dc/elements/1.1/")return{name:wi.dcterms+p.localName,order:r++,lang:p.getAttribute("xml:lang"),value:p.textContent,id:p.getAttribute("id"),refines:null,scheme:null,role:p.getAttribute("role")||p.getAttribute("opf:role")};return null}),s=$u(o,p=>p.refines),l=p=>xC(p,(c,f)=>c.map(v=>{let w={v:v.value,o:v.order};v.scheme&&(w.s=v.scheme);let x=s[`#${v.id}`]||[];if(x.length||v.lang||v.role){v.lang&&x.push({name:rt.language,value:v.lang,lang:null,id:null,refines:v.id,scheme:null,order:v.order,role:null}),v.role&&x.push({name:rt.role,value:v.role,lang:null,id:null,refines:v.id,scheme:null,order:v.order,role:null});let g=$u(x,m=>m.name);w.r=l(g)}return w})),a=l($u(o,p=>p.refines?null:p.name)),u=null;a[rt.language]&&(u=a[rt.language][0].v);let h=p=>{for(let c in p){let f=p[c];f.sort(mI(c,u));for(let v=0;v<f.length;v++){let w=f[v].r;w&&h(w)}}};return h(a),a}function wI(){let e=window.MathJax;return e?e.Hub:null}var um={"application/xhtml+xml":!0,"image/jpeg":!0,"image/png":!0,"image/svg+xml":!0,"image/gif":!0,"audio/mp3":!0},Zu="viv-id-",ql=class{constructor(e,t){this.store=e,this.pubURL=t,d(this,"opfXML",null),d(this,"encXML",null),d(this,"items",null),d(this,"spine",null),d(this,"itemMap",null),d(this,"itemMapByPath",null),d(this,"uid",null),d(this,"bindings",{}),d(this,"lang",null),d(this,"epageCount",0),d(this,"prePaginated",!1),d(this,"epageIsRenderedPage",!0),d(this,"epageCountCallback",null),d(this,"metadata",{}),d(this,"toc",null),d(this,"cover",null),d(this,"fallbackMap",{}),d(this,"pageProgression",null),d(this,"documentURLTransformer"),this.documentURLTransformer=this.createDocumentURLTransformer()}createDocumentURLTransformer(){let e=this;class t{transformFragment(i,r){let o=r+(i?`#${i}`:"");return Zu+Ww(o,":")}transformURL(i,r){let o=i.match(/^([^#]*)#?(.*)$/);if(o){let s=o[1]||r.replace(/\?viv-toc-box$/,""),l=decodeURIComponent(o[2]);if(s&&e.spine.some(a=>a.src===s))return`#${this.transformFragment(l,s)}`}return i}restoreURL(i){i.charAt(0)==="#"&&(i=i.substring(1)),i.indexOf(Zu)===0&&(i=i.substring(Zu.length));let r=wC(i,":").match(/^([^#]*)#?(.*)$/);return r?[r[1],r[2]]:[]}}return new t}getMetadata(){return this.metadata}getPathFromURL(e){if(e.startsWith("data:"))return e===this.pubURL?"":e;if(this.pubURL){let t=et("",this.pubURL);return e===t||e+"/"===t?"":(t.charAt(t.length-1)!="/"&&(t+="/"),e.substr(0,t.length)==t?decodeURIComponent(e.substr(t.length)):null)}else return e}initWithXMLDoc(e,t){this.opfXML=e,this.encXML=t;let n=e.doc().child("package"),i=n.attribute("unique-identifier")[0];if(i){let a=e.getElement(`${e.url}#${i}`);a&&(this.uid=a.textContent.replace(/[ \n\r\t]/g,""))}let r={};this.items=n.child("manifest").child("item").asArray().map(a=>{let u=new am,h=a;u.initWithElement(h,e.url);let p=h.getAttribute("fallback");return p&&!um[u.mediaType]&&(r[u.src]=p),!this.toc&&u.itemProperties.nav&&(this.toc=u),!this.cover&&u.itemProperties["cover-image"]&&(this.cover=u),u}),this.itemMap=Yf(this.items,pI),this.itemMapByPath=Yf(this.items,a=>this.getPathFromURL(a.src));for(let a in r){let u=a;for(;;){let h=this.itemMap[r[u]];if(!h)break;if(um[h.mediaType]){this.fallbackMap[a]=h.src;break}u=h.src}}this.spine=n.child("spine").child("itemref").asArray().map((a,u)=>{let h=a,p=h.getAttribute("idref"),c=this.itemMap[p];return c&&(c.itemRefElement=h,c.spineIndex=u),c});let o=n.child("spine").attribute("page-progression-direction")[0];o&&(this.pageProgression=_w(o));let s=t?t.doc().child("encryption").child("EncryptedData").predicate(om.withChild("EncryptionMethod",om.withAttribute("Algorithm","http://www.idpf.org/2008/embedding"))).child("CipherData").child("CipherReference").attribute("URI"):[],l=n.child("bindings").child("mediaType").asArray();for(let a=0;a<l.length;a++){let u=l[a].getAttribute("handler"),h=l[a].getAttribute("media-type");h&&u&&this.itemMap[u]&&(this.bindings[h]=this.itemMap[u].src)}if(this.metadata=vI(n.child("metadata"),n.attribute("prefix")[0]),this.metadata[rt.language]&&(this.lang=this.metadata[rt.language][0].v),this.metadata[rt.layout]&&(this.prePaginated=this.metadata[rt.layout][0].v==="pre-paginated"),s.length>0&&this.uid){let a=fI(this.uid);for(let u=0;u<s.length;u++)this.store.deobfuscators[this.pubURL+s[u]]=a}return this.prePaginated&&this.assignAutoPages(),R(!0)}assignAutoPages(){let e=0;for(let t of this.spine){let n=this.prePaginated?1:Math.ceil(t.compressedSize/1024);t.epage=e,t.epageCount=n,e+=n}this.epageCount=e,this.epageCountCallback&&this.epageCountCallback(this.epageCount)}setEPageCountMode(e){this.epageIsRenderedPage=e||this.prePaginated}countEPages(e){if(this.epageCountCallback=e,this.epageIsRenderedPage)return this.prePaginated&&this.epageCount==0&&this.assignAutoPages(),R(!0);let t=0,n=0,i=X("countEPages");return i.loopWithFrame(r=>{if(n===this.spine.length){r.breakLoop();return}let o=this.spine[n++];o.epage=t,this.store.load(o.src).then(s=>{let l=1800,a=s.lang||this.lang;a&&a.match(/^(ja|ko|zh)/)&&(l/=3),o.epageCount=Math.ceil(s.getTotalOffset()/l),t+=o.epageCount,this.epageCount=t,this.epageCountCallback&&this.epageCountCallback(this.epageCount),r.continueLoop()})}).thenFinish(i),i.result()}initWithChapters(e,t){this.itemMap={},this.itemMapByPath={},this.items=[],this.spine=this.items;let n=this.opfXML=new Ix(null,"",new DOMParser().parseFromString("<spine></spine>","text/xml"));return e.forEach(i=>{let r=new am;r.initWithParam(i),r.id;let o=n.document.createElement("itemref");o.setAttribute("idref",r.id),n.root.appendChild(o),r.itemRefElement=o,this.itemMap[r.id]=r;let s=this.getPathFromURL(i.url);s==null&&(s=i.url),this.itemMapByPath[s]=r,this.items.push(r)}),t?this.store.addDocument(e[0].url,t):R(null)}initWithWebPubManifest(e,t,n){var i,r,o,s;e.readingProgression&&(this.pageProgression=e.readingProgression),this.metadata===void 0&&(this.metadata={});let l=e.name||((i=e.metadata)==null?void 0:i.title)||(t==null?void 0:t.title);l&&(this.metadata[rt.title]=(Array.isArray(l)?l:[l]).map(w=>{var x;return{v:(x=w.value)!=null?x:w}}));let a=e.author||e.creator||((r=e.metadata)==null?void 0:r.author)||Array.from((o=t==null?void 0:t.querySelectorAll("meta[name='author'], meta[name='DC.Creator']"))!=null?o:[]).map(w=>w.content);a&&a.length!==0&&(this.metadata[rt.creator]=(Array.isArray(a)?a:[a]).map(w=>{var x;return{v:(x=w.name)!=null?x:w}}));let u=e.inLanguage||((s=e.metadata)==null?void 0:s.language)||(t==null?void 0:t.documentElement.lang)||(t==null?void 0:t.documentElement.getAttribute("xml:lang"));u&&(this.metadata[rt.language]=(Array.isArray(u)?u:[u]).map(w=>({v:w})));let h=this.getPathFromURL(this.pubURL);if(!e.readingOrder&&t&&h!==null){e.readingOrder=[encodeURI(h)];for(let w of hI(t)){let x=w.getAttribute("href");if(/^(https?:)?\/\//.test(x)||/\.(jpe?g|png|gif|pdf|svg|mml)([#?]|$)/.test(x))continue;let g=Yn(et(x,this.pubURL)),m=this.getPathFromURL(g),y=m!==null?encodeURI(m):g;e.readingOrder.indexOf(y)==-1&&e.readingOrder.push(y)}}let p=[],c=0,f=-1;[e.readingOrder,e.resources].forEach(w=>{w instanceof Array&&w.forEach(x=>{let g=w===e.readingOrder,m=typeof x=="string"?x:x.url||x.href,y=typeof x=="string"?"":x.encodingFormat||x.href&&x.type||"";if(g||y==="text/html"||y==="application/xhtml+xml"||!y&&x.rel!=="stylesheet"&&/(^|\/)([^/]+\.(x?html|htm|xht)|[^/.]*)([#?]|$)/.test(m)){let C=n?n.replace(/\/[^/]+$/,"/"):this.pubURL,P={url:et(Is(m),C),index:c++,startPage:null,skipPagesBefore:null};x.rel==="contents"&&f===-1&&(f=P.index),p.push(P)}})});let v=X("initWithWebPubManifest");return this.initWithChapters(p).then(()=>{var w,x;f!==-1&&(this.toc=this.items[f]),this.toc||(this.toc=n?(w=this.items)==null?void 0:w[0]:this.itemMapByPath[h]);let g=(x=e.readingOrder)==null?void 0:x.length;g&&g<this.items.length&&this.items.splice(g),v.finish(!0)}),v.result()}getCFI(e,t){let n=this.spine[e],i=X("getCFI");return this.store.load(n.src).then(r=>{let o=r.getNodeByOffset(t),s=null;if(o){let l=r.getNodeOffset(o,0,!1),a=t-l,u=new eg;u.prependPathFromNode(o,a,!1,null),n.itemRefElement&&u.prependPathFromNode(n.itemRefElement,0,!1,null),s=u.toString()}i.finish(s)}),i.result()}resolveFragment(e){return to("resolveFragment",t=>{if(!e){t.finish(null);return}let n=new eg;n.fromString(e);let i;if(this.opfXML){let r=n.navigate(this.opfXML.document);if(r.node.nodeType!=1||r.after||!r.ref){t.finish(null);return}let o=r.node,s=o.getAttribute("idref");if(o.localName!="itemref"||!s||!this.itemMap[s]){t.finish(null);return}i=this.itemMap[s],n=r.ref}else i=this.spine[0];this.store.load(i.src).then(r=>{let o=n.navigate(r.document),s=r.getNodeOffset(o.node,o.offset,o.after);t.finish({spineIndex:i.spineIndex,offsetInItem:s,pageIndex:-1})})},(t,n)=>{le.warn(n,"Cannot resolve fragment:",e),t.finish(null)})}resolveEPage(e){return to("resolveEPage",t=>{if(e<=0){t.finish({spineIndex:0,offsetInItem:0,pageIndex:-1});return}if(this.epageIsRenderedPage){let r=this.spine.findIndex(l=>l.epage==0&&l.epageCount==0||l.epage<=e&&l.epage+l.epageCount>e);r==-1&&(r=this.spine.length-1);let o=this.spine[r];(!o||o.epageCount==0)&&(o=this.spine[--r]);let s=Math.floor(e-o.epage);t.finish({spineIndex:r,offsetInItem:-1,pageIndex:s});return}let n=Ai(this.spine.length,r=>{let o=this.spine[r];return o.epage+o.epageCount>e});n==this.spine.length&&n--;let i=this.spine[n];this.store.load(i.src).then(r=>{e-=i.epage,e>i.epageCount&&(e=i.epageCount);let o=0;if(e>0){let s=r.getTotalOffset();o=Math.round(s*e/i.epageCount),o==s&&o--}t.finish({spineIndex:n,offsetInItem:o,pageIndex:-1})})},(t,n)=>{le.warn(n,"Cannot resolve epage:",e),t.finish(null)})}getEPageFromPosition(e){let t=this.spine[e.spineIndex];if(this.epageIsRenderedPage){let i=t.epage+e.pageIndex;return R(i)}if(e.offsetInItem<=0)return R(t.epage);let n=X("getEPage");return this.store.load(t.src).then(i=>{let r=i.getTotalOffset(),o=Math.min(r,e.offsetInItem);n.finish(t.epage+o*t.epageCount/r)}),n.result()}},Tl=(e,t)=>({page:e,position:{spineIndex:e.spineIndex,pageIndex:t,offsetInItem:e.offset}}),yI=class{constructor(e,t,n,i,r){this.opf=e,this.viewport=t,this.fontMapper=n,this.pageSheetSizeReporter=r,d(this,"spineItems",[]),d(this,"spineItemLoadingContinuations",[]),d(this,"pref"),d(this,"clientLayout"),d(this,"counterStore"),d(this,"tocAutohide",!1),d(this,"tocVisible",!1),d(this,"tocView"),this.pref=qw(i),this.clientLayout=new JT(t),this.counterStore=new ak(e.documentURLTransformer)}getPage(e){let t=this.spineItems[e.spineIndex];return t?t.pages[e.pageIndex]:null}getCurrentPageProgression(e){if(this.opf.pageProgression)return this.opf.pageProgression;{let t=this.spineItems[e?e.spineIndex:0];return t?t.instance.pageProgression:null}}finishPageContainer(e,t,n){t.container.style.display="none",t.container.style.visibility="visible",t.container.style.position="",t.container.style.top="",t.container.style.left="",t.container.setAttribute("data-vivliostyle-page-side",t.side);let i=e.pages[n];if(t.isFirstPage=e.item.spineIndex==0&&n==0,e.pages[n]=t,this.opf.epageIsRenderedPage){if(n==0&&e.item.spineIndex>0){let r=this.opf.spine[e.item.spineIndex-1];e.item.epage=r.epage+r.epageCount}e.item.epageCount=e.pages.length,this.opf.epageCount=this.opf.spine.reduce((r,o)=>r+o.epageCount,0),this.opf.epageCountCallback&&this.opf.epageCountCallback(this.opf.epageCount)}if(i)e.instance.viewport.contentContainer.replaceChild(t.container,i.container),i.dispatchEvent({type:"replaced",target:null,currentTarget:null,preventDefault:null,newPage:t});else{let r=null;if(n>0)r=e.pages[n-1].container.nextElementSibling;else for(let o=e.item.spineIndex+1;o<this.spineItems.length;o++){let s=this.spineItems[o];if(s&&s.pages[0]){r=s.pages[0].container;break}}e.instance.viewport.contentContainer.insertBefore(t.container,r)}this.pageSheetSizeReporter({width:e.instance.pageSheetWidth,height:e.instance.pageSheetHeight},e.instance.pageSheetSize,e.item.spineIndex,e.instance.pageNumberOffset+n)}renderSinglePage(e,t){let n=X("renderSinglePage"),i=e.pages[t?t.page:0],r=this.makePage(e,t);return i&&(r.pageType=i.pageType),e.instance.layoutNextPage(r,t).then(o=>{t=o;let s=t?t.page-1:e.layoutPositions.length-1;this.finishPageContainer(e,r,s),this.counterStore.finishPage(r.spineIndex,s);let l=null;if(t){let a=e.layoutPositions[t.page];e.layoutPositions[t.page]=t,a&&e.pages[t.page]&&(t.isSamePosition(a)||(l=this.renderSinglePage(e,t)))}l||(l=R(!0)),l.then(()=>{let a=this.counterStore.getUnresolvedRefsToPage(r),u=0;n.loopWithFrame(h=>{if(u++,u>a.length){h.breakLoop();return}let p=a[u-1];if(p.refs=p.refs.filter(c=>!c.isResolved()),p.refs.length===0){h.continueLoop();return}this.getPageViewItem(p.spineIndex).then(c=>{if(!c){h.continueLoop();return}let{currentPageType:f,previousPageType:v}=c.instance.styler.cascade,w=c.instance.scopes;c.instance.scopes={},this.counterStore.pushPageCounters(p.pageCounters),this.counterStore.pushReferencesToSolve(p.refs);let x=c.layoutPositions[p.pageIndex];this.renderSinglePage(c,x).then(g=>{c.instance.styler.cascade.currentPageType=f,c.instance.styler.cascade.previousPageType=v,c.instance.scopes=w,this.counterStore.popPageCounters(),this.counterStore.popReferencesToSolve();let m=g.pageAndPosition.position;m.spineIndex===r.spineIndex&&m.pageIndex===s&&(r=g.pageAndPosition.page),h.continueLoop()})})}).then(()=>{r.container.parentElement||(r=e.pages[s]),r.isLastPage=!t&&e.item.spineIndex===this.opf.spine.length-1,r.isLastPage&&(this.viewport,this.counterStore.finishLastPage(this.viewport)),r.container.setAttribute("data-vivliostyle-page-index",s),r.container.setAttribute("data-vivliostyle-spine-index",r.spineIndex),n.finish({pageAndPosition:Tl(r,s),nextLayoutPosition:t})})})}),n.result()}normalizeSeekPosition(e,t){let n=e.pageIndex,i=-1;if(n<0){i=e.offsetInItem;let r=Ai(t.layoutPositions.length,o=>t.instance.getPosition(t.layoutPositions[o],!0)>i);r===t.layoutPositions.length?t.complete?n=t.layoutPositions.length-1:n=Number.POSITIVE_INFINITY:n=r-1}else n===Number.POSITIVE_INFINITY&&e.offsetInItem!==-1&&(i=e.offsetInItem);return{spineIndex:e.spineIndex,pageIndex:n,offsetInItem:i}}findPage(e,t){let n=X("findPage");return this.getPageViewItem(e.spineIndex).then(i=>{if(!i){n.finish(null);return}let r=null,o;n.loopWithFrame(s=>{let l=this.normalizeSeekPosition(e,i);o=l.pageIndex,r=i.pages[o],r?s.breakLoop():i.complete?(o=i.layoutPositions.length-1,r=i.pages[o],s.breakLoop()):t?this.renderPage(l).then(a=>{a&&(r=a.page,o=a.position.pageIndex),s.breakLoop()}):n.sleep(100).then(()=>{s.continueLoop()})}).then(()=>{n.finish(Tl(r,o))})}),n.result()}renderPage(e){let t=X("renderPage");return this.getPageViewItem(e.spineIndex).then(n=>{if(!n){t.finish(null);return}let i=this.normalizeSeekPosition(e,n),r=i.pageIndex,o=i.offsetInItem,s=n.pages[r];if(s){t.finish(Tl(s,r));return}t.loopWithFrame(l=>{if(r<n.layoutPositions.length){l.breakLoop();return}if(n.complete){r=n.layoutPositions.length-1,l.breakLoop();return}let a=n.layoutPositions[n.layoutPositions.length-1];this.renderSinglePage(n,a).then(u=>{let h=u.pageAndPosition.page;if(a=u.nextLayoutPosition,a){if(o>=0&&n.instance.getPosition(a)>o){s=h,r=n.layoutPositions.length-2,l.breakLoop();return}l.continueLoop()}else s=h,r=u.pageAndPosition.position.pageIndex,n.complete=!0,l.breakLoop()})}).then(()=>{s=s||n.pages[r];let l=n.layoutPositions[r];if(s){t.finish(Tl(s,r));return}this.renderSinglePage(n,l).then(a=>{a.nextLayoutPosition||(n.complete=!0),t.finish(a.pageAndPosition)})})}),t.result()}renderAllPages(){let e=X("renderAllPages");return this.renderPagesUpto({spineIndex:this.opf.spine.length-1,pageIndex:Number.POSITIVE_INFINITY,offsetInItem:-1},!1).then(t=>{e.loopWithFrame(n=>{this.spineItems.some(i=>i==null?void 0:i.pages.some(r=>r==null?void 0:r.fetchers.some(o=>!o.arrived)))?e.sleep(100).then(()=>{n.continueLoop()}):n.breakLoop()}).then(()=>{e.finish(t)})}),e.result()}renderPagesUpto(e,t){let n=X("renderPagesUpto");e||(e={spineIndex:0,pageIndex:0,offsetInItem:0});let i=e.spineIndex,r=e.pageIndex,o=0;t&&(o=i);let s;return n.loopWithFrame(l=>{let a={spineIndex:o,pageIndex:o===i?r:Number.POSITIVE_INFINITY,offsetInItem:o===i?e.offsetInItem:-1};this.renderPage(a).then(u=>{s=u,++o>i?l.breakLoop():l.continueLoop()})}).then(()=>{n.finish(s)}),n.result()}firstPage(e,t){return this.findPage({spineIndex:0,pageIndex:0,offsetInItem:-1},t)}lastPage(e,t){return this.findPage({spineIndex:this.opf.spine.length-1,pageIndex:Number.POSITIVE_INFINITY,offsetInItem:-1},t)}nextPage(e,t){let n=e.spineIndex,i=e.pageIndex,r=X("nextPage");return this.getPageViewItem(n).then(o=>{if(!o){r.finish(null);return}if(o.complete&&i==o.layoutPositions.length-1){if(n>=this.opf.spine.length-1){r.finish(null);return}n++,i=0;let s=this.spineItems[n],l=s&&s.pages[0],a=o.pages[o.pages.length-1];l&&a&&l.side==a.side&&(s.pages.forEach(u=>{u.container&&u.container.remove()}),this.spineItems[n]=null,this.spineItemLoadingContinuations[n]=null)}else i++;this.findPage({spineIndex:n,pageIndex:i,offsetInItem:-1},t).thenFinish(r)}),r.result()}previousPage(e,t){let n=e.spineIndex,i=e.pageIndex;if(i==0){if(n==0)return R(null);n--,i=Number.POSITIVE_INFINITY}else i--;return this.findPage({spineIndex:n,pageIndex:i,offsetInItem:-1},t)}isRectoPage(e,t){let n=e.side==="left",i=this.getCurrentPageProgression(t)==="ltr";return!n&&i||n&&!i}getSpread(e,t){let n=this.getPage(e);if(!n)return R({left:null,right:null});let i=X("getSpread"),r=n.side==="left",o;return this.isRectoPage(n,e)?o=this.previousPage(e,t):o=this.nextPage(e,t),o.then(s=>{let l=this.getPage(e),a=s&&s.page;a&&a.side===l.side&&(a=null),r?i.finish({left:l,right:a}):i.finish({left:a,right:l})}),i.result()}nextSpread(e,t){let n=this.getPage(e);if(!n)return R(null);let i=this.isRectoPage(n,e),r=this.nextPage(e,t);return i?r:r.thenAsync(o=>{if(o){if(o.page.side===n.side)return r;let s=this.nextPage(o.position,t);return s.thenAsync(l=>l?s:r)}else return R(null)})}previousSpread(e,t){let n=this.getPage(e);if(!n)return R(null);let i=this.isRectoPage(n,e),r=this.previousPage(e,t),o=n.container.previousElementSibling;return i?r.thenAsync(s=>s?s.page.side===n.side||s.page.container!==o?r:this.previousPage(s.position,t):R(null)):r}navigateToEPage(e,t,n){let i=X("navigateToEPage");return this.opf.resolveEPage(e).then(r=>{r?this.findPage(r,n).thenFinish(i):i.finish(null)}),i.result()}navigateToFragment(e,t,n){let i=X("navigateToCFI");return this.opf.resolveFragment(e).then(r=>{r?this.findPage(r,n).thenFinish(i):i.finish(null)}),i.result()}navigateTo(e,t,n){le.debug("Navigate to",e);let i=this.opf.getPathFromURL(Yn(e));if(!i){if(this.opf.opfXML&&e.match(/^#epubcfi\(/))i=this.opf.getPathFromURL(this.opf.opfXML.url);else if(e.charAt(0)==="#"){let s=this.opf.documentURLTransformer.restoreURL(e);this.opf.opfXML?(i=this.opf.getPathFromURL(s[0]),i==null&&(i=s[0])):i=s[0],e=s[0]+(s[1]?`#${s[1]}`:"")}if(i==null)return R(null)}let r=this.opf.itemMapByPath[i];if(!r){if(this.opf.opfXML&&i==this.opf.getPathFromURL(this.opf.opfXML.url)){let s=e.indexOf("#");if(s>=0)return this.navigateToFragment(e.substr(s+1),t,n)}return R(null)}let o=X("navigateTo");return this.getPageViewItem(r.spineIndex).then(s=>{if(!s){o.finish(null);return}let l=s.xmldoc.getElement(e);this.findPage({spineIndex:r.spineIndex,pageIndex:-1,offsetInItem:l?s.xmldoc.getElementOffset(l):0},n).thenFinish(o)}),o.result()}makePage(e,t){let n=e.instance.viewport,i=n.document.createElement("div");i.setAttribute("data-vivliostyle-page-container","true"),i.setAttribute("role","region"),Ts||(i.style.visibility="hidden"),n.layoutBox.appendChild(i);let r=n.document.createElement("div");r.setAttribute("data-vivliostyle-bleed-box","true"),i.appendChild(r);let o=new qy(i,r);if(o.spineIndex=e.item.spineIndex,o.position=t,o.offset=e.instance.getPosition(t),o.offset===0&&!(e.instance.blankPageAtStart&&e.pages.length===0)){let s=this.opf.documentURLTransformer.transformFragment("",e.item.src);r.setAttribute("id",s),o.registerElementWithId(r,s)}if(n!==this.viewport){let s=Kw(this.viewport.width,this.viewport.height,n.width,n.height),l=co(null,new Fn(s,null),"");o.delayedItems.push(new Jd(i,"transform",l))}return o}makeObjectView(e,t,n,i){let r=t.getAttribute("data"),o=null;if(r){r=et(r,e.url);let s=t.getAttribute("media-type");if(!s){let l=this.opf.getPathFromURL(r);if(l){let a=this.opf.itemMapByPath[l];a&&(s=a.mediaType)}}if(s){let l=this.opf.bindings[s];if(l){o=this.viewport.document.createElement("iframe"),o.style.border="none";let a=Gf(r),u=Gf(s),h=new ti;h.append(l),h.append("?src="),h.append(a),h.append("&type="),h.append(u);for(let f=t.firstChild;f;f=f.nextSibling)if(f.nodeType==1){let v=f;if(v.localName=="param"&&v.namespaceURI=="http://www.w3.org/1999/xhtml"){let w=v.getAttribute("name"),x=v.getAttribute("value");w&&x&&(h.append("&"),h.append(encodeURIComponent(w)),h.append("="),h.append(encodeURIComponent(x)))}}o.setAttribute("src",h.toString());let p=t.getAttribute("width");p&&o.setAttribute("width",p);let c=t.getAttribute("height");c&&o.setAttribute("height",c)}}}return o||(o=this.viewport.document.createElement("object"),r&&o.setAttribute("data",r),o.setAttribute("data-adapt-process-children","true")),R(o)}makeMathJaxView(e,t,n,i){let r=wI();if(r){let o=n.ownerDocument,s=o.createElement("span");n.appendChild(s);let l=o.importNode(t,!0);this.resolveURLsInMathML(l,e),s.appendChild(l);let a=r.queue;a.Push(["Typeset",r,s]);let u=X("makeMathJaxView"),h=u.suspend();return a.Push(()=>{h.schedule(s)}),u.result()}return R(null)}resolveURLsInMathML(e,t){if(e!=null){if(e.nodeType===1&&e.tagName==="mglyph"){let n=Array.from(e.attributes);for(let i of n){if(i.name!=="src")continue;let r=et(i.nodeValue,t.url);i.namespaceURI?e.setAttributeNS(i.namespaceURI,i.name,r):e.setAttribute(i.name,r)}}e.firstChild&&this.resolveURLsInMathML(e.firstChild,t),e.nextSibling&&this.resolveURLsInMathML(e.nextSibling,t)}}makeCustomRenderer(e){return(t,n,i)=>t.localName=="object"&&t.namespaceURI=="http://www.w3.org/1999/xhtml"?this.makeObjectView(e,t,n,i):t.namespaceURI=="http://www.w3.org/1998/Math/MathML"?this.makeMathJaxView(e,t,n,i):t.dataset&&t.dataset.mathTypeset=="true"?this.makeMathJaxView(e,t,n,i):R(null)}getPageViewItem(e){if(e===-1||e>=this.opf.spine.length)return R(null);let t=this.spineItems[e];if(t)return R(t);let n=X("getPageViewItem"),i=this.spineItemLoadingContinuations[e];if(i){let s=n.suspend();return i.push(s),n.result()}else i=this.spineItemLoadingContinuations[e]=[];let r=this.opf.spine[e],o=this.opf.store;return o.load(r.src).then(s=>{var l;let a=r.itemRefElement.getAttribute("properties");a&&s.root.setAttribute("data-vivliostyle-epub-spine-properties",a),r.title=s.document.title;let u=o.getStyleForDoc(s),h=this.makeCustomRenderer(s),p=this.viewport,c=u.sizeViewport(p.width,p.height,p.fontSize,this.pref);(c.width!=p.width||c.height!=p.height||c.fontSize!=p.fontSize)&&(p=new Oa(p.window,c.fontSize,p.pixelRatio,p.root,c.width,c.height));let f=(l=this.spineItems[0])==null?void 0:l.instance.isVersoFirstPage,v=this.spineItems[e-1],w,x;if(r.startPage!==null)w=r.startPage-1,x=w;else{if(e>0&&(!v||!v.complete))w=r.epage||e,!this.opf.prePaginated&&w%2==(f?1:0)&&w++,x=w;else{w=v?v.instance.pageNumberOffset+v.pages.length:0;let y=this.counterStore.currentPageCounters.page;x=!y||!y.length?w:y[y.length-1]}r.skipPagesBefore!==null&&(w+=r.skipPagesBefore,x+=r.skipPagesBefore)}this.counterStore.forceSetPageCounter(x);let g=new kp(u,s,this.opf.lang,p,this.clientLayout,this.fontMapper,h,this.opf.fallbackMap,w,this.opf.documentURLTransformer,this.counterStore,this.opf.pageProgression,f);g.pref=this.pref;let m=this.opf.metadata&&this.opf.metadata[rt.title];g.pubTitle=m&&m[0]&&m[0].v||"",g.docTitle=r.title||"",g.init().then(()=>{!this.opf.pageProgression&&g.pageProgression&&(this.opf.pageProgression=g.pageProgression),t={item:r,xmldoc:s,instance:g,layoutPositions:[null],pages:[],complete:!1},this.spineItems[e]=t,n.finish(t),i.forEach(y=>{y.schedule(t)})})}),n.result()}removeRenderedPages(){let e=this.spineItems;for(let t of e)t&&t.pages.splice(0);this.viewport.clear()}hasAutoSizedPages(){let e=this.spineItems;for(let t of e)if(t){let n=t.pages;for(let i of n)if(i.isAutoPageWidth&&i.isAutoPageHeight)return!0}return!1}hasPages(){return this.spineItems.some(e=>e&&e.pages.length>0)}showTOC(e){let t=this.opf,n=t.toc;if(this.tocAutohide=e,!n)return R(null);if(this.tocVisible=!0,this.tocView&&this.tocView.page)return this.tocView.page.container.style.visibility="visible",this.tocView.page.container.setAttribute("aria-hidden","false"),R(this.tocView.page);let i=X("showTOC");this.tocView||(this.tocView=new cI(t.store,n.src,t.lang,this.clientLayout,this.fontMapper,this.pref,this,t.fallbackMap,t.documentURLTransformer,this.counterStore));let r=this.viewport,o=Math.min(344,Math.round(.67*r.width)-16),s=r.height-6,l=r.document.createElement("div");return r.root.appendChild(l),Ts||(l.style.visibility="hidden"),l.style.width=`${o+16}px`,l.style.maxHeight=`${s}px`,l.setAttribute("data-vivliostyle-toc-box","true"),l.setAttribute("role","navigation"),this.tocView.showTOC(l,r,o,s,this.viewport.fontSize).then(a=>{l.style.visibility="visible",l.setAttribute("aria-hidden","false"),i.finish(a)}),i.result()}hideTOC(){this.tocVisible=!1,this.tocView&&this.tocView.hideTOC()}isTOCVisible(){return this.tocVisible&&!!this.tocView&&this.tocView.isTOCVisible()}},hm="data-vivliostyle-viewer-status",xI="data-vivliostyle-spread-view",Fx=(e=>(e.SINGLE_PAGE="singlePage",e.SPREAD="spread",e.AUTO_SPREAD="autoSpread",e))(Fx||{}),bI=class{constructor(e,t,n,i){this.window=e,this.viewportElement=t,this.instanceId=n,this.callbackFn=i,d(this,"fontMapper"),d(this,"kick"),d(this,"sendCommand"),d(this,"resizeListener"),d(this,"hyperlinkListener"),d(this,"pageRuleStyleElement"),d(this,"pageSheetSizeAlreadySet",!1),d(this,"renderTask",null),d(this,"actions"),d(this,"readyState"),d(this,"packageURL"),d(this,"opf"),d(this,"touchActive"),d(this,"touchX"),d(this,"touchY"),d(this,"needResize"),d(this,"resized"),d(this,"needRefresh"),d(this,"viewportSize"),d(this,"currentPage"),d(this,"currentSpread"),d(this,"pagePosition"),d(this,"fontSize"),d(this,"zoom"),d(this,"fitToScreen"),d(this,"pageViewMode"),d(this,"waitForLoading"),d(this,"renderAllPages"),d(this,"pref"),d(this,"pageSizes"),d(this,"pixelRatio"),d(this,"pixelRatioLimit"),d(this,"viewport"),d(this,"opfView");let r=t.ownerDocument,o=(s,l)=>{let a=r.getElementById(s);return a||(a=r.createElement("style"),a.id=s,l&&(a.textContent=l),r.head.appendChild(a)),a};o("vivliostyle-viewport-screen-css",Ny),o("vivliostyle-viewport-css",Ty),o("vivliostyle-polyfill-css",Oy),t.setAttribute("data-vivliostyle-viewer-viewport",!0),Ts&&t.setAttribute("data-vivliostyle-debug",!0),t.setAttribute(hm,"loading"),this.fontMapper=new lT(r.head,t),this.init(),this.kick=()=>{},this.sendCommand=()=>{},this.resizeListener=()=>{this.needResize=!0,this.resized=!0,this.kick()},this.pageReplacedListener=this.pageReplacedListener.bind(this),this.hyperlinkListener=s=>{},this.pageRuleStyleElement=o("vivliostyle-page-rules"),this.actions={loadPublication:this.loadPublication,loadXML:this.loadXML,configure:this.configure,moveTo:this.moveTo,toc:this.showTOC},this.addLogListeners()}init(){this.readyState="loading",this.packageURL=[],this.opf=null,this.touchActive=!1,this.touchX=0,this.touchY=0,this.needResize=!1,this.resized=!1,this.needRefresh=!1,this.viewportSize=null,this.currentPage=null,this.currentSpread=null,this.pagePosition=null,this.fontSize=16,this.zoom=1,this.fitToScreen=!1,this.pageViewMode="singlePage",this.waitForLoading=!1,this.renderAllPages=!0,this.pref=Yw(),this.pageSizes=[],this.pixelRatioLimit=/Chrome/.test(navigator.userAgent)?16:0,this.pixelRatio=Math.min(8,this.pixelRatioLimit)}addLogListeners(){let e=$w;le.addListener(e.DEBUG,t=>{this.callback({t:"debug",content:t})}),le.addListener(e.INFO,t=>{this.callback({t:"info",content:t})}),le.addListener(e.WARN,t=>{this.callback({t:"warn",content:t})}),le.addListener(e.ERROR,t=>{this.callback({t:"error",content:t})})}callback(e){e.i=this.instanceId,this.callbackFn(e)}setReadyState(e){this.readyState!==e&&(this.readyState=e,this.viewportElement.setAttribute(hm,e),this.callback({t:"readystatechange"}))}loadPublication(e){Xt.registerStartTiming("beforeRender"),this.setReadyState("loading");let t=e.url,n=e.fragment,i=e.authorStyleSheet,r=e.userStyleSheet;this.viewport=null;let o=X("loadPublication");return this.configure(e).then(()=>{let s=new lm;s.init(i,r).then(()=>{let l=et(Is(t),this.window.location.href);this.packageURL=[l],s.loadPubDoc(l).then(a=>{a?(this.opf=a,this.render(n).then(()=>{o.finish(!0)})):o.finish(!1)})})}),o.result()}loadXML(e){Xt.registerStartTiming("beforeRender"),this.setReadyState("loading");let t=e.url,n=e.document,i=e.fragment,r=e.authorStyleSheet,o=e.userStyleSheet;this.viewport=null;let s=X("loadXML");return this.configure(e).then(()=>{let l=new lm;l.init(r,o).then(()=>{let a=t.map((u,h)=>({url:et(Is(u.url),this.window.location.href),index:h,startPage:u.startPage,skipPagesBefore:u.skipPagesBefore}));this.packageURL=a.map(u=>u.url),this.opf=new ql(l,""),this.opf.initWithChapters(a,n).then(()=>{this.render(i).then(()=>{s.finish(!0)})})})}),s.result()}render(e){this.cancelRenderingTask();let t;return e?t=this.opf.resolveFragment(e).thenAsync(n=>(this.pagePosition=n,R(!0))):t=R(!0),t.thenAsync(()=>(Xt.registerEndTiming("beforeRender"),this.resize()))}resolveLength(e){let t=parseFloat(e),n=/[a-z]+$/,i;if(typeof e=="string"&&(i=e.match(n))){let r=i[0];if(r==="em"||r==="rem")return t*this.fontSize;if(r==="ex")return t*$e.ex*this.fontSize/$e.em;let o=$e[r];if(o)return t*o}return t}configure(e){if(typeof e.autoresize=="boolean"&&(e.autoresize?(this.viewportSize=null,this.window.addEventListener("resize",this.resizeListener,!1),this.needResize=!0):this.window.removeEventListener("resize",this.resizeListener,!1)),typeof e.fontSize=="number"){let t=e.fontSize;t>=5&&t<=72&&this.fontSize!=t&&(this.fontSize=t,this.needResize=!0)}if(typeof e.viewport=="object"&&e.viewport){let t=e.viewport,n={marginLeft:this.resolveLength(t["margin-left"])||0,marginRight:this.resolveLength(t["margin-right"])||0,marginTop:this.resolveLength(t["margin-top"])||0,marginBottom:this.resolveLength(t["margin-bottom"])||0,width:this.resolveLength(t.width)||0,height:this.resolveLength(t.height)||0};(n.width>=200||n.height>=200)&&(this.window.removeEventListener("resize",this.resizeListener,!1),this.viewportSize=n,this.needResize=!0)}if(typeof e.hyphenate=="boolean"&&(this.pref.hyphenate=e.hyphenate,this.needResize=!0),typeof e.horizontal=="boolean"&&(this.pref.horizontal=e.horizontal,this.needResize=!0),typeof e.nightMode=="boolean"&&(this.pref.nightMode=e.nightMode,this.needResize=!0),typeof e.lineHeight=="number"&&(this.pref.lineHeight=e.lineHeight,this.needResize=!0),typeof e.columnWidth=="number"&&(this.pref.columnWidth=e.columnWidth,this.needResize=!0),typeof e.fontFamily=="string"&&(this.pref.fontFamily=e.fontFamily,this.needResize=!0),typeof e.load=="boolean"&&(this.waitForLoading=e.load),typeof e.renderAllPages=="boolean"&&(this.renderAllPages=e.renderAllPages),typeof e.userAgentRootURL=="string"&&(Hf(e.userAgentRootURL.replace(/resources\/?$/,"")),Wf(e.userAgentRootURL)),typeof e.rootURL=="string"&&(Hf(e.rootURL),Wf(`${eo}resources/`)),typeof e.pageViewMode=="string"&&e.pageViewMode!==this.pageViewMode&&(this.pageViewMode=e.pageViewMode,this.needResize=!0),typeof e.pageBorder=="number"&&e.pageBorder!==this.pref.pageBorder&&(this.viewport=null,this.pref.pageBorder=e.pageBorder,this.needResize=!0),typeof e.zoom=="number"&&e.zoom!==this.zoom&&(this.zoom=e.zoom,this.needRefresh=!0),typeof e.fitToScreen=="boolean"&&e.fitToScreen!==this.fitToScreen&&(this.fitToScreen=e.fitToScreen,this.needRefresh=!0),typeof e.defaultPaperSize=="object"&&typeof e.defaultPaperSize.width=="number"&&typeof e.defaultPaperSize.height=="number"&&(this.viewport=null,this.pref.defaultPaperSize=e.defaultPaperSize,this.needResize=!0),typeof e.allowScripts=="boolean"&&e.allowScripts!==oi&&(HT(e.allowScripts),this.needResize=!0),typeof e.pixelRatio=="number"){let t=Math.min(e.pixelRatio,this.pixelRatioLimit);t!==this.pixelRatio&&(this.pixelRatio=t,this.needResize=!0)}return this.configurePlugins(e),R(!0)}configurePlugins(e){An("CONFIGURATION").forEach(t=>{let n=t(e);this.needResize=n.needResize||this.needResize,this.needRefresh=n.needRefresh||this.needRefresh})}pageReplacedListener(e){let t=this.currentPage,n=this.currentSpread,i=e.target;n?(n.left===i||n.right===i)&&this.showCurrent(e.newPage):t===e.target&&this.showCurrent(e.newPage)}forCurrentPages(e){let t=[];this.currentPage&&t.push(this.currentPage),this.currentSpread&&(t.push(this.currentSpread.left),t.push(this.currentSpread.right)),t.forEach(n=>{n&&e(n)})}removePageListeners(){this.forCurrentPages(e=>{e.removeEventListener("hyperlink",this.hyperlinkListener,!1),e.removeEventListener("replaced",this.pageReplacedListener,!1)})}hidePages(){this.removePageListeners(),this.forCurrentPages(e=>{O(e.container,"display","none")}),this.currentPage=null,this.currentSpread=null}showSinglePage(e){e.addEventListener("hyperlink",this.hyperlinkListener,!1),e.addEventListener("replaced",this.pageReplacedListener,!1),O(e.container,"visibility","visible"),O(e.container,"display","block")}showPage(e){this.hidePages(),this.currentPage=e,e.container.style.marginLeft="",e.container.style.marginRight="",this.showSinglePage(e)}showSpread(e){if(this.hidePages(),this.currentSpread=e,e.left&&e.right){let t=parseFloat(e.left.container.style.width),n=parseFloat(e.right.container.style.width);t&&n&&t!==n&&(t<n?e.left.container.style.marginLeft=`${n-t}px`:e.right.container.style.marginRight=`${t-n}px`)}e.left&&(this.showSinglePage(e.left),e.right?e.left.container.removeAttribute("data-vivliostyle-unpaired-page"):e.left.container.setAttribute("data-vivliostyle-unpaired-page",!0)),e.right&&(this.showSinglePage(e.right),e.left?e.right.container.removeAttribute("data-vivliostyle-unpaired-page"):e.right.container.setAttribute("data-vivliostyle-unpaired-page",!0))}reportPosition(){let e=X("reportPosition");return this.pagePosition,this.opf.getCFI(this.pagePosition.spineIndex,this.pagePosition.offsetInItem).then(t=>{let n=this.currentPage;(this.waitForLoading&&n.fetchers.length>0?nu(n.fetchers):R(!0)).then(()=>{this.sendLocationNotification(n,t).thenFinish(e)})}),e.result()}createViewport(){let e=this.viewportElement;if(this.viewportSize){let t=this.viewportSize;return e.style.marginLeft=`${t.marginLeft}px`,e.style.marginRight=`${t.marginRight}px`,e.style.marginTop=`${t.marginTop}px`,e.style.marginBottom=`${t.marginBottom}px`,new Oa(this.window,this.fontSize,this.pixelRatio,e,t.width,t.height)}else return new Oa(this.window,this.fontSize,this.pixelRatio,e)}resolveSpreadView(e,t){switch(this.pageViewMode){case"singlePage":return!1;case"spread":return!0;case"autoSpread":default:return(e.width-this.pref.pageBorder)/e.height>=(t?t.width*2/t.height:1.45)&&(!!t||e.width>800)}}updateSpreadView(e){this.pref.spreadView=e,this.viewportElement.setAttribute(xI,e.toString())}sizeIsGood(){var e;let t=this.createViewport(),n=((e=this.opfView)==null?void 0:e.hasPages())&&!this.opfView.hasAutoSizedPages(),i=this.resolveSpreadView(t,this.resized&&n?this.pageSizes[0]:null);this.resized=!1;let r=this.pref.spreadView!==i;return this.updateSpreadView(i),this.pixelRatio&&this.opfView&&this.pixelRatio/this.window.devicePixelRatio!==this.opfView.clientLayout.scaleRatio||this.viewportSize||!this.viewport||this.viewport.fontSize!=this.fontSize?!1:!r&&t.width==this.viewport.width&&t.height==this.viewport.height||!r&&t.width==this.viewport.width&&t.height!=this.viewport.height&&/Android|iPhone|iPad|iPod/.test(navigator.userAgent)?!0:n?(this.viewport.width=t.width,this.viewport.height=t.height,this.needRefresh=!0,!0):!1}setPageSize(e,t,n,i){this.pageSizes[i]=e,this.setPageSizePageRules(t,n,i),i===0&&this.pageViewMode==="autoSpread"&&!this.opfView.hasAutoSizedPages()&&this.updateSpreadView(this.resolveSpreadView(this.viewport,e))}setPageSizePageRules(e,t,n){var i,r;if(this.pageRuleStyleElement&&(!this.pageSheetSizeAlreadySet||this.pageSizes[n].width!==((i=this.pageSizes[n-1])==null?void 0:i.width)||this.pageSizes[n].height!==((r=this.pageSizes[n-1])==null?void 0:r.height))){let o=function(f){let v=f*.75;return Math.ceil(v)},s=Math.max(...this.pageSizes.map(f=>f.width)),l=Math.max(...this.pageSizes.map(f=>f.height)),a=o(s),u=o(l),h=a*((this.pixelRatio||1)-1)+2,p=u*((this.pixelRatio||1)-1)+2,c=`@page {size: ${a}pt ${u}pt; margin: 0 ${-h}pt ${-p}pt 0;}`;this.pageRuleStyleElement.textContent=c,this.pageSheetSizeAlreadySet=!0}}removePageSizePageRules(){this.pageRuleStyleElement&&(this.pageRuleStyleElement.textContent="",this.pageSheetSizeAlreadySet=!1)}reset(){let e=!1,t=!1;this.opfView&&(e=this.opfView.tocVisible,t=this.opfView.tocAutohide,this.opfView.removeRenderedPages()),this.pageSizes=[],this.removePageSizePageRules(),this.viewport=this.createViewport(),this.viewport.resetZoom(),this.opfView=new yI(this.opf,this.viewport,this.fontMapper,this.pref,this.setPageSize.bind(this)),e&&this.sendCommand({a:"toc",v:"show",autohide:t})}showCurrent(e,t){this.needRefresh=!1,this.removePageListeners();let n=this.resolveSpreadView(this.viewport,e.dimensions);return n!==this.pref.spreadView&&this.updateSpreadView(n),n?this.opfView.getSpread(this.pagePosition,t).thenAsync(i=>!i.left&&!i.right?R(null):i.left&&i.right&&(!this.resolveSpreadView(this.viewport,i.left.dimensions)||!this.resolveSpreadView(this.viewport,i.right.dimensions))?(this.updateSpreadView(!1),this.showPage(e),this.setPageZoom(e),this.currentPage=e,R(null)):(this.showSpread(i),this.setSpreadZoom(i),this.currentPage=e.side==="left"?i.left:i.right,R(null))):(this.showPage(e),this.setPageZoom(e),this.currentPage=e,R(null))}setPageZoom(e){let t=this.getAdjustedZoomFactor(e.dimensions);this.viewport.zoom(e.dimensions.width,e.dimensions.height,t)}setSpreadZoom(e){let t=this.getSpreadDimensions(e);this.viewport.zoom(t.width,t.height,this.getAdjustedZoomFactor(t))}getAdjustedZoomFactor(e){return this.fitToScreen?this.calculateZoomFactorToFitInsideViewPort(e):this.zoom}getSpreadDimensions(e){let t=0,n=0;return e.left&&(t+=e.left.dimensions.width,n=e.left.dimensions.height),e.right&&(t+=e.right.dimensions.width,n=Math.max(n,e.right.dimensions.height)),e.left&&e.right&&(t+=this.pref.pageBorder*2,t+=Math.abs(e.left.dimensions.width-e.right.dimensions.width)),{width:t,height:n}}queryZoomFactor(e){if(!this.currentPage)throw new Error("no page exists.");switch(e){case"fit inside viewport":{let t;return this.pref.spreadView?(this.currentSpread,t=this.getSpreadDimensions(this.currentSpread)):t=this.currentPage.dimensions,this.calculateZoomFactorToFitInsideViewPort(t)}default:throw new Error(`unknown zoom type: ${e}`)}}calculateZoomFactorToFitInsideViewPort(e){if(!this.viewport)return this.zoom;let t=this.viewport.width/e.width,n=this.viewport.height/e.height;return Math.min(t,n)}cancelRenderingTask(){this.renderTask&&this.renderTask.interrupt(new cm),this.renderTask=null}resize(){if(this.needResize=!1,this.needRefresh=!1,this.sizeIsGood())return R(!0);this.setReadyState("loading"),this.cancelRenderingTask();let e=oc().getScheduler().run(()=>to("resize",t=>{if(!this.opf){t.finish(!1);return}this.renderTask=e,Xt.registerStartTiming("render (resize)"),this.reset(),this.pagePosition&&(this.pagePosition.pageIndex==0&&this.pagePosition.offsetInItem==0||(this.pagePosition.pageIndex=-1)),this.opf.setEPageCountMode(this.renderAllPages),this.opfView.renderPagesUpto(this.pagePosition,!this.renderAllPages).then(n=>{if(!n){t.finish(!1);return}this.pagePosition=n.position,this.showCurrent(n.page,!0).then(()=>{this.setReadyState("interactive"),this.opf.countEPages(i=>{let r={t:"nav",epageCount:i,first:this.currentPage.isFirstPage,last:this.currentPage.isLastPage,metadata:this.opf.metadata,docTitle:this.opf.spine[this.pagePosition.spineIndex].title};(this.currentPage.isFirstPage||this.pagePosition.pageIndex==0&&this.opf.spine[this.pagePosition.spineIndex].epage)&&(r.epage=this.opf.spine[this.pagePosition.spineIndex].epage),this.callback(r)}).then(()=>{this.reportPosition().then(i=>{(this.renderAllPages?this.opfView.renderAllPages():R(null)).then(()=>{this.renderTask===e&&(this.renderTask=null),Xt.registerEndTiming("render (resize)"),oi&&Nx(this.window)?XT(this.window).then(()=>{this.renderAllPages&&this.setReadyState("complete"),this.callback({t:"loaded"}),t.finish(i)}):(this.renderAllPages&&this.setReadyState("complete"),this.callback({t:"loaded"}),t.finish(i))})})})})})},(t,n)=>{if(n instanceof cm)Xt.registerEndTiming("render (resize)"),le.debug(n.message);else throw n}));return R(!0)}sendLocationNotification(e,t){let n=X("sendLocationNotification"),i={t:"nav",first:e.isFirstPage,last:e.isLastPage,metadata:this.opf.metadata,docTitle:this.opf.spine[e.spineIndex].title};return this.opf.getEPageFromPosition(this.pagePosition).then(r=>{i.epage=r,i.epageCount=this.opf.epageCount,t&&(i.cfi=t),this.callback(i),n.finish(!0)}),n.result()}getCurrentPageProgression(){return this.opfView?this.opfView.getCurrentPageProgression(this.pagePosition):null}moveTo(e){var t;let n;if(this.readyState!=="complete"&&e.where!=="next"&&this.setReadyState("loading"),typeof e.where=="string"){let r;switch(e.where){case"next":r=this.pref.spreadView?this.opfView.nextSpread:this.opfView.nextPage;break;case"previous":r=this.pref.spreadView?this.opfView.previousSpread:this.opfView.previousPage;break;case"last":r=this.opfView.lastPage;break;case"first":r=this.opfView.firstPage;break;default:return R(!0)}r&&(n=()=>r.call(this.opfView,this.pagePosition,!this.renderAllPages))}else if(typeof e.epage=="number"){let r=e.epage;n=()=>this.opfView.navigateToEPage(r,this.pagePosition,!this.renderAllPages)}else if(typeof e.url=="string"){let r=e.url;n=()=>this.opfView.navigateTo(r,this.pagePosition,!this.renderAllPages)}else if(typeof((t=e.position)==null?void 0:t.spineIndex)=="number"){let r=e.position;n=()=>this.opfView.findPage(r,!this.renderAllPages)}else return R(!0);if(!this.opfView)return R(!0);let i=X("moveTo");return n.call(this.opfView).then(r=>{let o;if(r){this.pagePosition=r.position;let s=X("moveTo.showCurrent");o=s.result(),this.showCurrent(r.page,!this.renderAllPages).then(()=>{this.reportPosition().thenFinish(s)})}else o=R(!0);o.then(s=>{this.readyState==="loading"&&this.setReadyState("interactive"),i.finish(s)})}),i.result()}showTOC(e){let t=!!e.autohide,n=e.v,i=this.opfView.isTOCVisible(),r=t!=this.opfView.tocAutohide&&n!="hide";if(i){if(n=="show"&&!r)return R(!0)}else if(n=="hide")return R(!0);if(i&&n!="show")return this.opfView.hideTOC(),R(!0);{let o=X("showTOC");return this.opfView.showTOC(t).then(s=>{if(s){if(r&&(s.listeners={}),t){let l=()=>{this.opfView.hideTOC()};s.addEventListener("hyperlink",l,!1)}s.addEventListener("hyperlink",this.hyperlinkListener,!1)}o.finish(!0)}),o.result()}}runCommand(e){let t=e.a||"";return to("runCommand",n=>{let i=this.actions[t];i?i.call(this,e).then(()=>{this.callback({t:"done",a:t}),n.finish(!0)}):(le.error("No such action:",t),n.finish(!0))},(n,i)=>{le.error(i,"Error during action:",t),n.finish(!0)})}initEmbed(e){let t=dm(e),n=null,i=this;Fk(()=>{let r=X("commandLoop"),o=oc().getScheduler();return i.hyperlinkListener=s=>{let l=s,a=l.href.charAt(0)==="#"||i.packageURL.some(u=>l.href.substr(0,u.length)==u);if(a){s.preventDefault();let u={t:"hyperlink",href:l.href,internal:a};o.run(()=>(i.callback(u),R(!0)))}},r.loopWithFrame(s=>{if(i.needResize)i.resize().then(()=>{s.continueLoop()});else if(i.needRefresh)i.currentPage&&i.showCurrent(i.currentPage,!this.renderAllPages).then(()=>{s.continueLoop()});else if(t){let l=t;t=null,i.runCommand(l).then(()=>{s.continueLoop()})}else{let l=X("waitForCommand");n=l.suspend(this),l.result().then(()=>{s.continueLoop()})}}).thenFinish(r),r.result()}),i.kick=()=>{let r=n;r&&(n=null,r.schedule(!0))},i.sendCommand=r=>t?!1:(t=dm(r),i.kick(),!0),this.window.adapt_command=i.sendCommand}},Ox=(e=>(e.FIT_INSIDE_VIEWPORT="fit inside viewport",e))(Ox||{}),cm=class Bx extends Error{constructor(){super(),d(this,"name","RenderingCanceledError"),d(this,"message","Page rendering has been canceled"),d(this,"stack"),Object.setPrototypeOf(this,Bx.prototype),this.stack=new Error().stack}};function dm(e){return typeof e=="string"?Dd(e):e}var pm=$d;function SI(){return{autoResize:!0,fontSize:16,pageBorderWidth:1,renderAllPages:!0,pageViewMode:"autoSpread",zoom:1,fitToScreen:!1,defaultPaperSize:void 0,allowScripts:!0,pixelRatio:8}}function fm(e){let t={};return Object.keys(e).forEach(n=>{let i=e[n];switch(n){case"autoResize":t.autoresize=i;break;case"pageBorderWidth":t.pageBorder=i;break;default:t[n]=i}}),t}var _x=class{constructor(e,t){this.settings=e,d(this,"initialized",!1),d(this,"adaptViewer_"),d(this,"options"),d(this,"eventTarget"),d(this,"readyState"),Bw(e.debug),this.adaptViewer_=new bI(e.window||window,e.viewportElement,"main",this.dispatcher.bind(this)),this.options=SI(),t&&this.setOptions(t),this.eventTarget=new Vd,Object.defineProperty(this,"readyState",{get(){return this.adaptViewer_.readyState}})}setOptions(e){let t=Object.assign({a:"configure"},fm(e));this.adaptViewer_.sendCommand(t),Object.assign(this.options,e)}dispatcher(e){let t={type:e.t},n=e;Object.keys(n).forEach(i=>{i!=="t"&&(t[i]=n[i])}),this.eventTarget.dispatchEvent(t)}addListener(e,t){this.eventTarget.addEventListener(e,t,!1)}removeListener(e,t){this.eventTarget.removeEventListener(e,t,!1)}loadDocument(e,t,n){if(!e||(Array.isArray(e)?!e[0]||typeof e[0]!="string"&&!e[0].url:typeof e!="string"&&!e.url)){this.eventTarget.dispatchEvent({type:"error",content:{error:new Error("No URL specified")}});return}this.loadDocumentOrPublication(e,null,t,n)}loadPublication(e,t,n){if(!e){this.eventTarget.dispatchEvent({type:"error",content:{error:new Error("No URL specified")}});return}this.loadDocumentOrPublication(null,e,t,n)}loadDocumentOrPublication(e,t,n,i){let r=n||{};function o(u){if(u)return u.map(h=>({url:h.url||null,text:h.text||null}))}let s=o(r.authorStyleSheet),l=o(r.userStyleSheet);i&&Object.assign(this.options,i);let a=Object.assign({a:e?"loadXML":"loadPublication",userAgentRootURL:this.settings.userAgentRootURL,url:CI(e)||t,document:r.documentObject,fragment:r.fragment,authorStyleSheet:s,userStyleSheet:l},fm(this.options));this.initialized?this.adaptViewer_.sendCommand(a):(this.initialized=!0,this.adaptViewer_.initEmbed(a))}getCurrentPageProgression(){return this.adaptViewer_.getCurrentPageProgression()}resolveNavigation(e){switch(e){case"left":return this.getCurrentPageProgression()===pm.LTR?"previous":"next";case"right":return this.getCurrentPageProgression()===pm.LTR?"next":"previous";default:return e}}navigateToPage(e,t){e==="epage"?this.adaptViewer_.sendCommand({a:"moveTo",epage:t}):this.adaptViewer_.sendCommand({a:"moveTo",where:this.resolveNavigation(e)})}navigateToInternalUrl(e){this.adaptViewer_.sendCommand({a:"moveTo",url:e})}navigateToPosition(e){var t,n;this.adaptViewer_.sendCommand({a:"moveTo",position:{spineIndex:e.spineIndex,pageIndex:(t=e.pageIndex)!=null?t:-1,offsetInItem:(n=e.offsetInItem)!=null?n:-1}})}isTOCVisible(){return this.adaptViewer_.opfView&&this.adaptViewer_.opfView.opf&&this.adaptViewer_.opfView.opf.toc?!!this.adaptViewer_.opfView.isTOCVisible():null}showTOC(e,t){let n=e==null?"toggle":e?"show":"hide";this.adaptViewer_.sendCommand({a:"toc",v:n,autohide:t})}queryZoomFactor(e){return this.adaptViewer_.queryZoomFactor(e)}getPageSizes(){return this.adaptViewer_.pageSizes}getTOC(){var e,t;return(t=(e=this.adaptViewer_.opfView)==null?void 0:e.tocView)==null?void 0:t.getTOC()}getMetadata(){return this.adaptViewer_.opf.getMetadata()}getCover(){return this.adaptViewer_.opf.cover}};function CI(e){function t(i){return typeof i=="number"?i:null}function n(i){return typeof i=="string"?{url:i,startPage:null,skipPagesBefore:null}:{url:i.url,startPage:t(i.startPage),skipPagesBefore:t(i.skipPagesBefore)}}return Array.isArray(e)?e.map(n):e?[n(e)]:null}var Mx=(e=>(e.PREVIOUS="previous",e.NEXT="next",e.LEFT="left",e.RIGHT="right",e.FIRST="first",e.LAST="last",e.EPAGE="epage",e))(Mx||{}),kI=Ox,EI=Fx;Xt.forceRegisterEndTiming("load_vivliostyle");var PI=class{constructor(e,{title:t="",printCallback:n=s=>s.print(),errorCallback:i=null,hideIframe:r=!0,removeIframe:o=!0}){d(this,"htmlDoc"),d(this,"title"),d(this,"printCallback"),d(this,"errorCallback"),d(this,"hideIframe"),d(this,"removeIframe"),d(this,"iframe"),d(this,"iframeWin"),d(this,"window"),this.htmlDoc=e,this.title=t,this.printCallback=n,this.errorCallback=i,this.hideIframe=r,this.removeIframe=o}init(){this.iframe=document.createElement("iframe"),this.hideIframe&&(this.iframe.style.width="0",this.iframe.style.height="0",this.iframe.style.borderWidth="0"),this.window=window,this.window.printInstance=this,this.iframe.srcdoc=`
      <!DOCTYPE html>
      <html data-vivliostyle-paginated="true">
        <head>
          <meta charset='utf-8'/>
          <meta name='viewport' content='width=device-width, initial-scale=1.0'/>
          <title>${this.title}</title>
          <style>
            html[data-vivliostyle-paginated] {
              width: 100%;
              height: 100%;
            }
            html[data-vivliostyle-paginated] body,
            html[data-vivliostyle-paginated] [data-vivliostyle-viewer-viewport] {
              width: 100% !important;
              height: 100% !important;
            }
            html[data-vivliostyle-paginated],
            html[data-vivliostyle-paginated] body {
              margin: 0;
              padding: 0;
            }
          </style>
          <style id='vivliostyle-page-rules'></style>
        </head>
        <body onload='parent.printInstance.runInIframe(window)'>
          <div id="vivliostyle-viewer-viewport"></div>
        </body>
      </html>`,document.body.appendChild(this.iframe)}runInIframe(e){return this.iframeWin=e,this.preparePrint().then(()=>this.browserPrint()).then(()=>this.cleanUp())}preparePrint(){this.iframeWin.document.title=this.title;let e=new Blob([this.htmlDoc],{type:"text/html"}),t=URL.createObjectURL(e),n=new _x({viewportElement:this.iframeWin.document.body.firstElementChild,window:this.iframeWin,debug:!0});return new Promise(i=>{n.addListener("readystatechange",()=>{n.readyState==="complete"&&i()}),this.errorCallback&&n.addListener("error",r=>{var o,s;let l=(s=(o=r.content.error)==null?void 0:o.toString())!=null?s:r.content.messages.join(`
`);this.errorCallback(l)}),n.loadDocument({url:t})})}browserPrint(){this.printCallback(this.iframeWin)}cleanUp(){delete this.window.printInstance,this.removeIframe&&this.iframe.parentElement.removeChild(this.iframe)}};function NI(e,t){new PI(e,t).init()}function Vc(){return Vc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Vc.apply(null,arguments)}let gm;const TI=({source:e,page:t=1,zoom:n=1,bookMode:i=!0,fontSize:r=16,background:o="#ececec",renderAllPages:s=!0,autoResize:l=!0,pageViewMode:a=wl.PageViewMode.SINGLE_PAGE,defaultPaperSize:u,pageBorderWidth:h=1,fitToScreen:p=!1,userStyleSheet:c,authorStyleSheet:f,style:v,onMessage:w,onError:x,onReadyStateChange:g,onLoad:m,onNavigation:y,onHyperlink:C,children:P})=>{const A=se.useRef(null),I=se.useRef(),M=Ye.useRef();function G(){I.current.setOptions({fontSize:r,pageViewMode:a,renderAllPages:s,autoResize:l,defaultPaperSize:u,pageBorderWidth:h})}function j(){const Z=I.current,b=Vc({},c?{userStyleSheet:[{[c.endsWith(".css")?"url":"text"]:c}]}:null,f?{authorStyleSheet:[{[f.endsWith(".css")?"url":"text"]:f}]}:null);i?Z.loadPublication(e,b):Z.loadDocument({url:e},b,{fontSize:r,pageViewMode:a,zoom:n,renderAllPages:s,autoResize:l,defaultPaperSize:u,pageBorderWidth:h,fitToScreen:p})}se.useEffect(()=>(I.current=new wl.CoreViewer({viewportElement:A.current}),G(),function(){const Z=F=>{var D,te;return(D=(te=F.content.error)==null?void 0:te.toString())!=null?D:F.content.messages.join(`
`)};function b(F,D){w&&w(Z(F),D)}const T=F=>b(F,"debug"),k=F=>b(F,"info"),B=F=>b(F,"warn");function V(F){x&&x(Z(F))}function E(){const{readyState:F}=I.current;g&&g(F)}function _(){m&&m(M.current)}function W(F){const{docTitle:D,epageCount:te,epage:N,metadata:ee}=F,H={docTitle:D,epageCount:te,epage:N,metadata:ee};M.current=H,y&&y(H)}function J(F){C&&C(F)}const L=I.current;return L.addListener("debug",T),L.addListener("info",k),L.addListener("warn",B),L.addListener("error",V),L.addListener("readystatechange",E),L.addListener("loaded",_),L.addListener("nav",W),L.addListener("hyperlink",J),()=>{g&&g(wl.ReadyState.LOADING),L.removeListener("debug",T),L.removeListener("info",k),L.removeListener("warn",B),L.removeListener("error",V),L.removeListener("readystatechange",E),L.removeListener("loaded",_),L.removeListener("nav",W),L.removeListener("hyperlink",J)}}()),[]),se.useEffect(()=>{j()},[e,f,c,n,p]),se.useEffect(()=>{G()},[r,a,s,l,u,h]),se.useEffect(()=>{var Z;(Z=I.current)==null||Z.navigateToPage(wl.Navigation.EPAGE,t-1)},[t]);const $=Ye.createElement(II,{ref:A,style:v,background:o});return typeof P=="function"&&P instanceof Function?P({container:$,reload:j}):$},II=Gh.div(gm||(gm=(e=>e)`
  overflow: scroll;
  background: ${0} !important;
`),({background:e})=>e);function RI(){let e=null,t=0;const n=new Map,i=()=>new Worker("/vfm-worker.js"),r=()=>new Worker(new URL(""+new URL("vfmWorker.worker-D0Q1v-BB.js",import.meta.url).href,import.meta.url),{type:"module"}),o=async()=>{try{const l=await fetch("/vfm-worker.js");if(!l.ok)throw new Error("fetch failed: "+l.status);const a=l.headers.get("content-type")||"";if(!/javascript|application\/ecmascript|text\/javascript|application\/javascript/i.test(a))throw new Error("unexpected content-type: "+a);const u=await l.text(),h=new Blob([u],{type:"application/javascript"}),p=URL.createObjectURL(h),c=new Worker(p);return URL.revokeObjectURL(p),c}catch{try{const a="https://unpkg.com/@vivliostyle/vfm@2.2.1/dist/vfm.min.js";console.debug("[vfmWorkerClient] attempting to fetch vfm lib to inline into worker",a);const u=await fetch(a);if(!u.ok)throw new Error("vfm lib fetch failed: "+u.status);const p=await u.text()+`
self.onmessage = function(ev){ var seq=ev.data&&ev.data.seq?ev.data.seq:null; var md=ev.data&&ev.data.markdown?ev.data.markdown:''; try{ var html=(typeof self.vfm!=='undefined'&&self.vfm.stringify)?self.vfm.stringify(md): (typeof vfm!=='undefined'&&vfm.stringify)?vfm.stringify(md): ''; self.postMessage({seq,ok:true,html}); }catch(e){ self.postMessage({seq,ok:false,error:String(e)}); } };`,c=new Blob([p],{type:"application/javascript"}),f=URL.createObjectURL(c),v=new Worker(f);return URL.revokeObjectURL(f),v}catch(a){throw console.error("[vfmWorkerClient] inline fetch-of-lib failed; importScripts fallback disabled",a),a}}},s=async()=>{if(e)return e;try{try{console.debug("[vfmWorkerClient] attempting bundled worker createWorkerFromBundle()"),e=r(),console.debug("[vfmWorkerClient] worker created from bundled worker")}catch(l){try{console.debug('[vfmWorkerClient] bundled worker failed, attempting fetch-first -> createWorkerFromBlob("/vfm-worker.js")',l),e=await o(),console.debug("[vfmWorkerClient] worker created from fetch+blob or inline fallback")}catch(a){if(console.warn('[vfmWorkerClient] fetch+blob fallback failed, attempting direct Worker("/vfm-worker.js") with ping',a),e=i(),!await new Promise(h=>{let p=!1;const c=window.setTimeout(()=>{p||(p=!0,h(!1))},1500),f=w=>{const x=w.data;x&&x.seq===0&&(p||(p=!0,clearTimeout(c),h(!0)))},v=w=>{p||(p=!0,clearTimeout(c),h(!1))};e.addEventListener("message",f),e.addEventListener("error",v);try{e.postMessage({seq:0,markdown:""})}catch{p||(p=!0,clearTimeout(c),h(!1))}})){try{e.terminate()}catch{}throw e=null,new Error("worker ping failed (possible wrong MIME or script error)")}console.debug("[vfmWorkerClient] worker created and pinged /vfm-worker.js")}}return e.onmessage=l=>{let a=l.data;if(typeof a=="string")try{a=JSON.parse(a)}catch(p){console.error("[vfmWorkerClient] failed to parse worker JSON",p),a={seq:null,ok:!1,error:"invalid json from worker"}}const u=a;console.debug("[vfmWorkerClient] worker.onmessage",{seq:u.seq,ok:u.ok,htmlLen:u.html?u.html.length:0});const h=n.get(u.seq??-1);h&&(n.delete(u.seq??-1),h(u))},e}catch(l){throw console.error("[vfmWorkerClient] ensureWorker failed",l),l}};return{async stringify(l){t+=1;const a=t,u=await s();return new Promise((h,p)=>{n.set(a,c=>c.ok?h(c.html):p(new Error(c.error||"unknown")));try{const c=JSON.stringify({seq:a,markdown:l});console.debug("[vfmWorkerClient] postMessage to worker (json)",{seq:a,len:l.length}),u.postMessage(c)}catch(c){n.delete(a),p(c)}})},terminate(){e&&(e.terminate(),e=null)}}}const AI=({markdown:e,isVisible:t})=>{const[n,i]=se.useState(""),[r,o]=se.useState(null),[s,l]=se.useState(0),[a,u]=se.useState(0),[h,p]=se.useState(""),c=Ye.useRef(null),[f,v]=se.useState(null),[w,x]=se.useState(!1),[g,m]=se.useState({pageRuleFound:!1}),[y,C]=se.useState(null),P=Ye.useRef(null),A=Ye.useRef(null),I=Ye.useRef(!1),M=Ye.useRef(null),G=Ye.useRef(!1),j=Ye.useRef(null),[$,Z]=se.useState(null),[b,T]=se.useState(""),[k,B]=se.useState(""),V=Ye.useRef(null),E=Ye.useMemo(()=>RI(),[]),[_,W]=se.useState({width:0,height:0});if(se.useEffect(()=>{if(!t)return;if(console.debug("[VivlioDBG][Preview] effect start",{mdLen:e.length,time:Date.now()}),!e){i(""),o(null),console.debug("[VivlioDBG][Preview] empty markdown");return}V.current&&V.current.abort();const ae=new AbortController;V.current=ae;const ie=ae.signal,be=async()=>{if(!ie.aborted)try{try{Z(e),T(L(e||""))}catch{}const ve=F(e||""),Y=await E.stringify(ve);if(ie.aborted)return;p(Y),l(Y.length),console.debug("[VivlioDBG][Preview] html generated",{htmlLen:Y.length,sample:Y.slice(0,120)});try{const Se=Y.match(/@page[^}]*{[^}]*}/g);if(Se&&Se.length){const ye=Se.map(ue=>{const Ne=ue.trim(),De=Ne.match(/^@page\s*([^\{]*)\{/i),St=De&&De[1].trim()||"@page",en=Ne.match(/\{([\s\S]*)\}/),Sn=(en?en[1]:"").split(";").map(It=>It.trim()).filter(Boolean).map(It=>It.replace(/;$/,""));return{selector:St,declarations:Sn}}),Ee=Se[0],de=Ee.match(/size:\s*([^;]+);?/),me=Array.from(Ee.matchAll(/margin[a-z-]*:\s*[^;]+;?/g)).map(ue=>ue[0]);m({pageRuleFound:!0,rules:ye,size:de?de[1].trim():null,margins:me})}else m({pageRuleFound:!1,rules:[]})}catch{m({pageRuleFound:!1,rules:[]})}try{const Se=new Blob([Y],{type:"text/html"}),ye=URL.createObjectURL(Se);if(ie.aborted)return;if(c.current)try{URL.revokeObjectURL(c.current)}catch{}c.current=ye,u(Y.length),i(ye)}catch{const Ee=`data:text/html;base64,${btoa(unescape(encodeURIComponent(Y)))}`;if(ie.aborted)return;u(Ee.length),i(Ee)}o(null),console.debug("[VivlioDBG][Preview] dataUrl ready",{encodedLen:Y.length})}catch(ve){if(ie.aborted)return;console.error("[VivlioDBG][Preview] stringify failed",ve),o(ve.message),i("")}};setTimeout(async()=>{var ve;await be(),typeof((ve=window.scheduler)==null?void 0:ve.yield)=="function"&&await window.scheduler.yield()},0)},[e,t]),se.useEffect(()=>{if(t)return console.debug("[VivlioDBG][Preview] mount",{time:Date.now()}),()=>{console.debug("[VivlioDBG][Preview] unmount",{time:Date.now()})}},[t]),!t)return null;Ye.useEffect(()=>{var ie,be,Pe,ve;let ae=null;try{const Y=window.EditorView||((ie=window.CodeMirror)==null?void 0:ie.EditorView);if(!Y||typeof Y.findFromDOM!="function")return;const Se=document.querySelector(".cm-editor");if(!Se)return;const ye=Y.findFromDOM(Se);if(!ye)return;const Ee=()=>{try{let de="";ye.state&&ye.state.doc&&typeof ye.state.doc.toString=="function"?de=ye.state.doc.toString():ye.state&&typeof ye.state.sliceDoc=="function"&&(de=ye.state.sliceDoc()),de&&de!==f&&v(de)}catch{}};Ee();try{if(Y.updateListener&&typeof Y.updateListener.of=="function"){const de=Y.updateListener.of(me=>{me.docChanged&&Ee()});try{(ve=ye.dispatch)==null||ve.call(ye,{effects:(Pe=(be=window.StateEffect)==null?void 0:be.appendConfig)==null?void 0:Pe.of(de)})}catch{}}else ae=window.setInterval(Ee,500)}catch{ae=window.setInterval(Ee,500)}}catch{}return()=>{ae&&clearInterval(ae)}},[]),Ye.useEffect(()=>{if(!f)return;V.current&&V.current.abort();const ae=new AbortController;V.current=ae;const ie=ae.signal;let be=null;const Pe=async()=>{if(!ie.aborted)try{const ve=F(f||""),Y=await E.stringify(ve);if(ie.aborted)return;if(!(/<\s*!doctype|<html[\s>]/i.test(Y)&&/<body[\s>]/i.test(Y))){console.error("[VivlioDBG][Preview] stringify produced invalid HTML sample",{sample:Y.slice(0,200)}),o("Vivliostyle produced invalid HTML. Check input.");return}p(Y),l(Y.length);try{try{const de=Y.match(/@page[^}]*{[^}]*}/g);if(de&&de.length){const me=de.map(St=>{const en=St.trim(),hn=en.match(/\{([\s\S]*)\}/),It=(hn?hn[1]:"").split(";").map(mo=>mo.trim()).filter(Boolean).map(mo=>mo.replace(/;$/,""));return{raw:en,declarations:It}}),ue=de[0],Ne=ue.match(/size:\s*([^;]+);?/),De=Array.from(ue.matchAll(/margin[a-z-]*:\s*[^;]+;?/g)).map(St=>St[0]);m({pageRuleFound:!0,rules:me,size:Ne?Ne[1].trim():null,margins:De})}else m({pageRuleFound:!1,rules:[]})}catch{m({pageRuleFound:!1,rules:[]})}const ye=new Blob([Y],{type:"text/html"}),Ee=URL.createObjectURL(ye);if(ie.aborted)return;if(c.current)try{URL.revokeObjectURL(c.current)}catch{}c.current=Ee,u(Y.length),i(Ee)}catch{const de=`data:text/html;base64,${btoa(unescape(encodeURIComponent(Y)))}`;if(ie.aborted)return;u(de.length),i(de)}o(null),console.debug("[VivlioDBG][Preview] stringify(editorMd) ok",{htmlLen:Y.length,sample:Y.slice(0,120)})}catch(ve){if(ie.aborted)return;console.error("[VivlioDBG][Preview] stringify failed (editorMd)",ve),o(ve.message),i("")}};return be=window.setTimeout(Pe,120),()=>{be&&clearTimeout(be)}},[f]);const J=n||null,L=ae=>{const ie=ae.match(/```vivliocss\s*([\s\S]*?)```/i);if(ie)return ie[1].trim();if(h){const be=h.match(/<pre[^>]*class=(?:"|')([^"']*language-vivliocss[^"']*)(?:"|')[^>]*>([\s\S]*?)<\/pre>/i);if(be){let Pe=be[2]||"";return Pe=Pe.replace(/^\s*<code[^>]*>/i,"").replace(/<\/code>\s*$/i,""),Pe=Pe.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"'),Pe=Pe.replace(/[\u2026]+$|\.\.\.+$/m,"").trim(),Pe}}return""},F=ae=>ae&&ae.replace(/```vivliocss\b[\s\S]*?```/ig,"").trim(),D=L(e||""),N=(ae=>{const ie=ae.match(/@page[^{]*{([\s\S]*?)}/i);if(ie){const be=ie[1],Pe=be.match(/size:\s*([^;]+);?/i);if(Pe){const Y=Pe[1].trim().split(/\s+/);return Y.length>=2?{width:Y[0],height:Y[1],margin:null}:{width:Y[0],height:null,margin:null}}const ve=be.match(/margin:\s*([^;]+);?/i);return{width:null,height:null,margin:ve?ve[1].trim():null}}return{width:null,height:null,margin:null}})(D),ee=N.width||"210mm",H=N.height||"297mm";N.margin;const ce=D||"",ge=`${ce}

/* Plugin-injected: center bleed-box and visual helpers */
html, body { height: 100%; margin: 0; padding: 0; }
body { display: flex; align-items: center; justify-content: center; }

[data-vivliostyle-bleed-box] {
  background: #fff;
  box-shadow: 0 8px 24px rgba(0,0,0,.25);
  border: 1px solid #ddd;
}

[data-vivliostyle-page-area] {
  background: rgba(144, 238, 144, .25);
  background-clip: border-box;
}

[data-vivliostyle-page-box] {
  background: rgba(100, 149, 237, .25);
}
@page { size: 148mm 210mm; margin: 20mm; }
`;Ye.useEffect(()=>{try{B(ce||"")}catch{}},[ce]);const U=Ye.useRef(null),pe=Ye.useRef(null),we=Ye.useRef(null),ne=Ye.useRef(null),[Re,xe]=Ye.useState(1),Xe=async()=>{var ae;try{const ie=we.current;if(!ie){C({error:"no-wrap",collectedAt:Date.now()});return}const be=ie.querySelector("iframe");let Pe=!1,ve=ie,Y=null;if(be){const ue=be.contentDocument||((ae=be.contentWindow)==null?void 0:ae.document);ue&&(Pe=!0,ve=ue,Y=Ne=>be.contentWindow?be.contentWindow.getComputedStyle(Ne):null)}Pe||(ve=ie,Y=ue=>window.getComputedStyle(ue));const ye=Array.from(ve.querySelectorAll?Array.from(ve.querySelectorAll("[data-vivliostyle-page-side], [data-vivliostyle-auto-page-width], [data-vivliostyle-auto-page-height]")):[]);if(ye.length===0){const ue=Array.from(ve.querySelectorAll?Array.from(ve.querySelectorAll('.vivliostyle-page, .page, [role="document"], article')):[]);ye.push(...ue)}const Ee=ye.slice(0,6).map(ue=>{const Ne=ue.getAttribute("style")||"",De={};try{Object.keys(ue.dataset||{}).forEach(It=>{De[It]=ue.dataset[It]})}catch{}const St=Y?Y(ue):null,en=St?{width:St.width,height:St.height,left:St.left,top:St.top,padding:St.padding}:null,hn=ue.querySelector?ue.querySelector("[data-bleed], .bleed, .vivliostyle-bleed, [data-vivliostyle-bleed]"):null,Sn=hn?hn.getAttribute("style")||"":null;return{tag:ue.tagName.toLowerCase(),id:ue.id||null,className:ue.className||null,dataset:De,inlineStyle:Ne,computed:en,bleedInline:Sn}});let de=null,me=null;try{const ue=ve.querySelector?ve.querySelector("[data-vivliostyle-page-side], .vivliostyle-page, .page"):null;ue&&(de=ue.getAttribute("style")&&ue.style.width||null,me=ue.getAttribute("style")&&ue.style.height||null)}catch{}C({entries:Ee,pageSheetWidth:de,pageSheetHeight:me,rootIsDocument:Pe,collectedAt:Date.now()})}catch(ie){C({error:ie.message,collectedAt:Date.now()})}};return Ye.useLayoutEffect(()=>{function ae(){const be=U.current,Pe=pe.current;if(!be||!Pe)return;const ve=be.getBoundingClientRect();let Y=Pe.getBoundingClientRect();try{const de=we.current;if(de){const me=de.querySelector("iframe");if(me&&me.contentDocument){const ue=me.contentDocument,Ne=ue.documentElement||ue.body;if(Ne){const De=Ne.getBoundingClientRect();De.width>0&&De.height>0&&(Y=De)}}}}catch{}const Se=ve.width,ye=ve.height;if(Y.width<=0||Y.height<=0)return;const Ee=Math.min(Se/Y.width,ye/Y.height,1);xe(Number(Ee.toFixed(4))),we.current&&(we.current.style.display="flex",we.current.style.alignItems="center",we.current.style.justifyContent="center"),ne.current&&(ne.current.style.transformOrigin="center center",ne.current.style.transform=`translate(-0px, -0px) scale(${Ee})`),W({width:Math.round(Y.width),height:Math.round(Y.height)})}ae(),window.addEventListener("resize",ae);const ie=new ResizeObserver(ae);return U.current&&ie.observe(U.current),pe.current&&ie.observe(pe.current),()=>{window.removeEventListener("resize",ae),ie.disconnect()}},[h,n,D,ee,H]),Ye.useEffect(()=>{if(!n)return;const ae=window.setTimeout(()=>{try{Xe()}catch{}},300);return()=>{clearTimeout(ae)}},[n]),Ye.useEffect(()=>{w&&Xe()},[w]),Ye.useEffect(()=>()=>{if(c.current){try{URL.revokeObjectURL(c.current)}catch{}c.current=null}V.current&&(V.current.abort(),V.current=null),E.terminate()},[E]),he.jsxs("div",{style:{width:"100%",height:"100vh",position:"relative",zIndex:10,background:"#2b2b2b",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",boxSizing:"border-box"},children:[he.jsx("div",{ref:U,style:{padding:24,overflow:"auto",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",boxSizing:"border-box"},children:he.jsxs("div",{ref:pe,style:{width:ee,height:H,overflow:"hidden",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},children:[r&&he.jsxs("div",{style:{position:"absolute",top:8,right:8,left:8,padding:"8px 10px",background:"#ffeeee",border:"1px solid #e99",color:"#a00",fontSize:12,borderRadius:4},children:["VFM Error: ",r]}),J?he.jsx("div",{style:{width:"100%",height:"100%",overflow:"hidden",position:"relative"},children:he.jsx("div",{ref:we,style:{width:"100%",height:"100%",overflow:"hidden",willChange:"transform"},children:he.jsx("div",{ref:ne,style:{width:"100%",height:"100%"},children:he.jsx(TI,{source:J,bookMode:!1,userStyleSheet:ge,renderAllPages:!1})})})}):r?null:he.jsx("div",{style:{padding:"2em",textAlign:"center",color:"#666"},children:"Markdownを入力してください..."})]})}),!w&&he.jsx("button",{type:"button","aria-label":"show vivliostyle preview info",onClick:()=>x(!0),style:{position:"absolute",top:6,right:6,width:26,height:26,borderRadius:"50%",border:"1px solid #999",background:"#fff",color:"#333",fontSize:14,cursor:"pointer",lineHeight:"24px",textAlign:"center",boxShadow:"0 1px 2px rgba(0,0,0,.15)"},title:"Preview info",children:"i"}),w&&he.jsxs(he.Fragment,{children:[he.jsxs("div",{ref:P,onPointerDown:ae=>{const ie=P.current;if(!ie)return;const be=ie.getBoundingClientRect(),Pe=ae.clientX-be.left,ve=ae.clientY-be.top,Y=8,Se=be.width-Pe<=Y,ye=be.height-ve<=Y,Ee=Pe<=Y,de=ve<=Y,me=ae.target,ue=A.current;if(ue&&me&&ue.contains(me)&&!(me.closest&&me.closest("button,a,input,textarea,select"))){ae.preventDefault();const Ne=ie.offsetParent,De=Ne?Ne.getBoundingClientRect():{left:0,top:0},St=be.left-De.left,en=be.top-De.top;ie.style.left=`${St}px`,ie.style.right="auto",ie.style.top=`${en}px`,I.current=!0,M.current={x:ae.clientX,y:ae.clientY,left:St,top:en};const hn=It=>{if(!I.current||!M.current||!ie)return;const mo=It.clientX-M.current.x,Wx=It.clientY-M.current.y,jx=Math.max(0,M.current.left+mo),Gx=Math.max(0,M.current.top+Wx);ie.style.left=`${jx}px`,ie.style.top=`${Gx}px`},Sn=()=>{I.current=!1,M.current=null,window.removeEventListener("pointermove",hn),window.removeEventListener("pointerup",Sn)};window.addEventListener("pointermove",hn),window.addEventListener("pointerup",Sn);return}if(Se||ye||Ee||de){ae.preventDefault(),G.current=!0,j.current={x:ae.clientX,y:ae.clientY,width:be.width,height:be.height,edge:Se?"right":Ee?"left":ye?"bottom":"top"};const Ne=St=>{if(!G.current||!j.current||!ie)return;const en=St.clientX-j.current.x,hn=St.clientY-j.current.y;let Sn=j.current.width,It=j.current.height;j.current.edge==="right"&&(Sn=Math.max(220,j.current.width+en)),j.current.edge==="left"&&(Sn=Math.max(220,j.current.width-en)),j.current.edge==="bottom"&&(It=Math.max(120,j.current.height+hn)),j.current.edge==="top"&&(It=Math.max(120,j.current.height-hn)),ie.style.width=`${Sn}px`,ie.style.height=`${It}px`},De=()=>{G.current=!1,j.current=null,window.removeEventListener("pointermove",Ne),window.removeEventListener("pointerup",De)};window.addEventListener("pointermove",Ne),window.addEventListener("pointerup",De);return}},style:{position:"absolute",top:8,right:8,width:320,maxHeight:"80%",overflow:"auto",minWidth:220,minHeight:120,background:"rgba(18,20,22,0.56)",backdropFilter:"blur(8px) saturate(120%)",border:"1px solid rgba(255,255,255,0.06)",borderRadius:8,padding:"10px 12px",fontSize:12,lineHeight:1.4,color:"#e6e6e6",boxShadow:"0 8px 24px rgba(0,0,0,0.45)",zIndex:20},children:[he.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[he.jsx("div",{ref:A,style:{display:"flex",alignItems:"center",gap:8,cursor:"grab"},children:he.jsx("strong",{style:{fontSize:13,color:"#f3f4f6"},children:"Vivliostyle Preview Info"})}),he.jsx("span",{style:{marginLeft:"auto"},children:he.jsx("button",{type:"button",onClick:()=>x(!1),style:{border:"none",background:"transparent",cursor:"pointer",fontSize:16,lineHeight:1,padding:0,color:"#d0d4d8"},"aria-label":"close info",children:"×"})})]}),he.jsxs("ul",{style:{listStyle:"disc",paddingLeft:16,margin:0,display:"flex",flexDirection:"column",gap:2},children:[he.jsxs("li",{children:["Characters (Markdown): ",e.length]}),he.jsxs("li",{children:["Lines: ",e.split(/\r?\n/).length]}),he.jsxs("li",{children:["Words (approx): ",e.trim()?e.trim().split(/\s+/).length:0]}),he.jsxs("li",{children:["@page rules: ",g.pageRuleFound?"":"none"]}),g.pageRuleFound&&g.rules&&g.rules.length>0&&he.jsx("ul",{style:{marginTop:4,marginLeft:12,listStyle:"circle"},children:g.rules.map((ae,ie)=>he.jsxs("li",{style:{marginBottom:6},children:[he.jsx("div",{style:{fontFamily:"monospace",fontSize:12,color:"#d9e2e6"},children:ae.selector}),ae.declarations&&ae.declarations.length>0&&he.jsx("ul",{style:{marginTop:4,marginLeft:12,listStyle:"square"},children:ae.declarations.map((be,Pe)=>he.jsx("li",{style:{fontFamily:"monospace",fontSize:12,color:"#cfd6da"},children:be},Pe))}),g.size&&he.jsxs("div",{style:{marginTop:6,fontSize:12,color:"#d9e2e6"},children:["Page size: ",g.size]}),g.margins&&g.margins.map((be,Pe)=>he.jsx("div",{style:{fontSize:12,color:"#d9e2e6"},children:be},Pe))]},ie))})]}),he.jsxs("details",{style:{marginTop:8},children:[he.jsx("summary",{style:{cursor:"pointer"},children:"User CSS (extracted from Markdown)"}),he.jsx("pre",{style:{whiteSpace:"pre-wrap",maxHeight:220,overflow:"auto",background:"rgba(0,0,0,0.18)",padding:8,border:"1px solid rgba(255,255,255,0.04)",color:"#e6e6e6",userSelect:"text"},children:D||""})]}),he.jsxs("details",{style:{marginTop:8},children:[he.jsx("summary",{style:{cursor:"pointer"},children:"Markdown (raw)"}),he.jsx("pre",{style:{whiteSpace:"pre-wrap",maxHeight:240,overflow:"auto",background:"rgba(0,0,0,0.18)",padding:8,border:"1px solid rgba(255,255,255,0.04)",color:"#e6e6e6",userSelect:"text"},children:$||e||""})]}),h&&he.jsxs("details",{style:{marginTop:8},children:[he.jsx("summary",{style:{cursor:"pointer"},children:"HTML (VFM)"}),he.jsx("pre",{style:{maxHeight:480,overflow:"auto",background:"rgba(0,0,0,0.28)",padding:8,border:"1px solid rgba(255,255,255,0.04)",color:"#e6e6e6"},children:h})]}),he.jsxs("details",{style:{marginTop:8},children:[he.jsx("summary",{style:{cursor:"pointer"},children:"Final CSS (Renderer)"}),he.jsx("pre",{style:{whiteSpace:"pre-wrap",maxHeight:320,overflow:"auto",background:"rgba(0,0,0,0.18)",padding:8,border:"1px solid rgba(255,255,255,0.04)",color:"#e6e6e6",userSelect:"text"},children:k||""})]}),he.jsxs("details",{style:{marginTop:8},children:[he.jsx("summary",{style:{cursor:"pointer"},children:"Vivliostyle iframe debug (runtime)"}),he.jsxs("div",{style:{marginTop:8},children:[he.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[he.jsx("button",{type:"button",onClick:()=>{try{Xe()}catch{}},style:{padding:"6px 8px",fontSize:12,cursor:"pointer",borderRadius:4},children:"Refresh"}),he.jsx("button",{type:"button",onClick:()=>{var ae;try{y&&((ae=navigator.clipboard)==null||ae.writeText(JSON.stringify(y,null,2)))}catch{}},style:{padding:"6px 8px",fontSize:12,cursor:"pointer",borderRadius:4},children:"Copy JSON"})]}),he.jsx("pre",{style:{whiteSpace:"pre-wrap",maxHeight:320,overflow:"auto",background:"rgba(0,0,0,0.18)",padding:8,border:"1px solid rgba(255,255,255,0.04)",color:"#e6e6e6",fontSize:12},children:y?JSON.stringify(y,null,2):"No debug information collected. Open the panel, wait a moment and click Refresh."})]})]})]}),P.current&&he.jsx("div",{onPointerDown:ae=>{const ie=P.current;if(!ie)return;ae.preventDefault();const be=ae.clientX,Pe=ae.clientY,ve=ie.getBoundingClientRect(),Y=ve.width,Se=ve.height,ye=de=>{const me=be-de.clientX,ue=de.clientY-Pe,Ne=Math.max(220,Y+me),De=Math.max(120,Se+ue);ie.style.width=`${Ne}px`,ie.style.height=`${De}px`},Ee=()=>{window.removeEventListener("pointermove",ye),window.removeEventListener("pointerup",Ee)};window.addEventListener("pointermove",ye),window.addEventListener("pointerup",Ee)},style:{position:"absolute",left:8,bottom:8,width:14,height:14,background:"rgba(255,255,255,0.06)",borderRadius:2,cursor:"nwse-resize",zIndex:30},"aria-hidden":!0})]})]})},LI=["textarea.editor","#page-editor textarea",".CodeMirror textarea",'[data-testid="editor-textarea"]',".page-editor textarea"],FI=[".cm-editor",".cm-editor .cm-content",".cm-editor .cm-scroller",'.cm-content[contenteditable="true"]',".cm-scroller",".grw-editor",".editor","#page-editor",".page-editor"];function OI(e={}){const{debounceMs:t=300}=e,[n,i]=se.useState(""),r=se.useRef(""),o=se.useRef("init"),s=se.useRef(null),l=se.useRef(null),a=se.useRef(null),u=se.useRef([]),h=se.useRef(null),p=se.useRef(0),c=se.useRef(null),f=se.useRef(0),v=se.useRef(null),w=se.useCallback(x=>{const g=r.current,m=g!==x,y=m?x.length-g.length:0;s.current&&window.clearTimeout(s.current),s.current=window.setTimeout(()=>{r.current=x,i(x),console.debug("[VivlioDBG] useEditorMarkdown:update",{phase:o.current,length:x.length,changed:m,delta:y,head20:x.slice(0,20)})},t)},[t]);return se.useEffect(()=>{let x=!1,g=null;function m(){var y,C,P,A,I,M;if(!x){for(const G of LI){const j=document.querySelector(G);if(j){o.current="textarea",console.debug("[VivlioDBG] useEditorMarkdown: textarea found",{sel:G,valueLen:j.value.length});const $=()=>w(j.value);$(),j.addEventListener("input",$),a.current=()=>j.removeEventListener("input",$);return}}try{const G=window.EditorView||((y=window.CodeMirror)==null?void 0:y.EditorView);let j=null;for(const Z of FI){const b=Array.from(document.querySelectorAll(Z)),T=k=>{if(!k)return null;try{if(k.state&&(k.state.doc||typeof k.state.sliceDoc=="function"))return k}catch{}try{const B=Object.getOwnPropertyNames(k||{}).slice(0,200);for(const E of B)try{const _=k[E];if(_&&typeof _=="object"&&_.state&&(_.state.doc||typeof _.state.sliceDoc=="function"))return _}catch{}const V=Object.getOwnPropertySymbols(k||{});for(const E of V)try{const _=k[E];if(_&&typeof _=="object"&&_.state&&(_.state.doc||typeof _.state.sliceDoc=="function"))return _}catch{}}catch{}return null};for(const k of b)try{if(G&&typeof G.findFromDOM=="function")try{const B=G.findFromDOM(k);if(B){j=B;break}}catch{}if(!j){const B=k.cmView||k.view||k.__cmView||k.CodeMirrorView;if(B){if(B.state&&(B.state.doc||typeof B.state.sliceDoc=="function")){j=B;break}const V=T(B);if(V){j=V;break}}}}catch{}if(j)break}const $=j;if($){o.current="cm6",console.debug("[VivlioDBG] useEditorMarkdown: CM6 view found",{sel:"multiple-candidates",len:(C=$.state)!=null&&C.doc?typeof $.state.doc.toString=="function"?$.state.doc.toString().length:typeof $.state.sliceDoc=="function"?$.state.sliceDoc().length:0:0});const Z=window.EditorView||$&&$.constructor;console.debug("[VivlioDBG] useEditorMarkdown: EditorViewCtor resolution",{hasGlobal:!!window.EditorView,ctorType:typeof Z,ctorName:Z==null?void 0:Z.name});const b=()=>{try{const T=$.state&&$.state.doc&&typeof $.state.doc.toString=="function"?$.state.doc.toString():$.state&&typeof $.state.sliceDoc=="function"?$.state.sliceDoc():"";w(T)}catch{}};b();try{if(console.debug("[VivlioDBG] useEditorMarkdown: EditorView presence",{hasEditorView:!!G,editorViewType:typeof G}),Z&&Z.updateListener&&typeof Z.updateListener.of=="function"){const T=Z.updateListener.of(B=>{try{console.debug("[VivlioDBG] useEditorMarkdown: CM6 updateListener fired",{docChanged:!!B.docChanged})}catch{}B.docChanged&&b()});let k=!1;try{let B=window.StateEffect,V=B?"window":null;if(!B)try{Z!=null&&Z.StateEffect&&(B=Z.StateEffect,V="EditorViewCtor")}catch{}if(!B)try{$.constructor&&$.constructor.StateEffect&&(B=$.constructor.StateEffect,V="view.constructor")}catch{}if(console.debug("[VivlioDBG] useEditorMarkdown: StateEffect resolution",{source:V}),B&&B.appendConfig&&typeof B.appendConfig.of=="function"&&typeof $.dispatch=="function")$.dispatch({effects:B.appendConfig.of(T)}),k=!0,console.debug("[VivlioDBG] useEditorMarkdown: CM6 updateListener appended via StateEffect.appendConfig",{source:V});else throw new Error("appendConfig or dispatch unavailable")}catch(B){console.debug("[VivlioDBG] useEditorMarkdown: CM6 updateListener append failed, falling back to polling",{error:String(B)})}if(k)a.current=()=>{};else{console.debug("[VivlioDBG] useEditorMarkdown: CM6 polling started (fallback, hybrid)");const B=()=>{var L,F;c.current&&(clearInterval(c.current),c.current=null),g&&(clearInterval(g),g=null);try{const D=v.current&&(((L=$.dom)==null?void 0:L.querySelector("textarea"))||$.dom);D&&v.current&&((F=D.removeEventListener)==null||F.call(D,"input",v.current))}catch{}},V=L=>{try{b()}catch{}B()};v.current=V;let E=!1;try{let L=null;$&&$.dom instanceof HTMLElement?L=$.dom:$.root&&$.root.dom&&(L=$.root.dom);const F=L==null?void 0:L.querySelector("textarea");F&&(F.addEventListener("input",V),u.current.push({target:F,event:"input",fn:V}),E=!0,console.debug("[VivlioDBG] useEditorMarkdown: attached input listener to hidden textarea",{textareaFound:!0}))}catch{}if(!E)try{const L=[],F=$&&$.dom instanceof HTMLElement?$.dom:(P=$.root)==null?void 0:P.dom,D=((A=F==null?void 0:F.querySelector)==null?void 0:A.call(F,".cm-content"))??F??null;if(D){const te=["beforeinput","input","keydown","paste","cut","compositionend"];for(const ee of te){const H=ce=>{try{b()}catch{}try{c.current&&(clearInterval(c.current),c.current=null),g&&(clearInterval(g),g=null)}catch{}};L.push([ee,H]),D.addEventListener(ee,H),u.current.push({target:D,event:ee,fn:H})}console.debug("[VivlioDBG] useEditorMarkdown: attached DOM event handlers to view.dom/cm-content",{eventsAttached:te.length});const N=a.current;a.current=()=>{try{for(const{target:ee,event:H,fn:ce}of u.current)ee==null||ee.removeEventListener(H,ce)}catch{}u.current=[];try{N==null||N()}catch{}}}}catch{}((L=180)=>{f.current=0;const F=()=>{try{b()}catch{}f.current+=1,f.current>=8&&(c.current&&(clearInterval(c.current),c.current=null),c.current=window.setInterval(b,500))};c.current&&(clearInterval(c.current),c.current=null),c.current=window.setInterval(F,L),g=c.current})(180);let W=null;try{const L=[".vivlio-viewer","#vivlio-viewer",".vivlio-iframe",".vivlio-preview",".viewer",".preview",".vivlio","iframe"],F=te=>{let N=!1;for(const ee of te){if(ee.addedNodes&&ee.addedNodes.length>0){N=!0;break}if(ee.type==="characterData"||ee.type==="attributes"){N=!0;break}const H=ee.target;if(H&&L.some(ce=>{var K,ge;return((K=H.matches)==null?void 0:K.call(H,ce))||((ge=H.closest)==null?void 0:ge.call(H,ce))})){N=!0;break}}if(N)try{b()}catch{}},D=((I=$.dom)==null?void 0:I.closest(".cm-editor"))||((M=$.dom)==null?void 0:M.parentElement)||document.body;l.current=new MutationObserver(F),l.current.observe(D,{childList:!0,subtree:!0,characterData:!0,attributes:!0}),W=te=>{try{b()}catch{}},window.addEventListener("message",W),h.current=W,console.debug("[VivlioDBG] useEditorMarkdown: viewer mutation observer and message listener attached")}catch{}const J=a.current;a.current=()=>{var L;try{for(const{target:F,event:D,fn:te}of u.current)F==null||F.removeEventListener(D,te)}catch{}if(u.current=[],c.current&&(clearInterval(c.current),c.current=null),g&&(clearInterval(g),g=null),v.current){try{const F=$.dom,D=F==null?void 0:F.querySelector("textarea");D&&D.removeEventListener("input",v.current)}catch{}v.current=null}try{(L=l.current)==null||L.disconnect(),l.current=null}catch{}if(h.current)try{window.removeEventListener("message",h.current),h.current=null}catch{}try{J==null||J()}catch{}}}}else console.debug("[VivlioDBG] useEditorMarkdown: CM6 updateListener not available, using polling"),g=window.setInterval(b,500),a.current=()=>{g&&(clearInterval(g),g=null)}}catch(T){console.debug("[VivlioDBG] useEditorMarkdown: CM6 updateListener unexpected error, using polling",{error:String(T)}),g=window.setInterval(b,500),a.current=()=>{g&&(clearInterval(g),g=null)}}return}}catch{}try{const G=document.querySelector(".CodeMirror");if(G&&G.CodeMirror){o.current="cm5",console.debug("[VivlioDBG] useEditorMarkdown: CM5 instance found");const j=G.CodeMirror,$=()=>{try{w(j.getValue())}catch{}};$();try{j.on("change",$),a.current=()=>{try{j.off("change",$)}catch{}}}catch{const b=window.setInterval($,500);a.current=()=>clearInterval(b)}return}}catch{}if(p.current+=1,console.debug("[VivlioDBG] useEditorMarkdown: retry",{retry:p.current,phase:o.current}),p.current<45){const G=p.current<8?200:600;setTimeout(m,G)}else console.warn("[VivlioDBG] useEditorMarkdown: editor detection failed after extended retries")}}return m(),()=>{var y,C;x=!0;try{for(const{target:P,event:A,fn:I}of u.current)P==null||P.removeEventListener(A,I)}catch{}u.current=[],(y=a.current)==null||y.call(a);try{(C=l.current)==null||C.disconnect(),l.current=null}catch{}if(h.current)try{window.removeEventListener("message",h.current),h.current=null}catch{}s.current&&window.clearTimeout(s.current),g&&(clearInterval(g),g=null),console.debug("[VivlioDBG] useEditorMarkdown: cleanup",{phase:o.current})}},[w]),{markdown:n}}const zx=se.createContext(null),BI=({children:e})=>{const[t,n]=se.useState(!1),{markdown:i}=OI({debounceMs:250}),[r,o]=se.useState(null),s=se.useRef(Math.random().toString(36).slice(2,8));console.debug("[VivlioDBG][AppProvider] created",{contextId:s.current});const l=se.useCallback(()=>{console.debug("[VivlioDBG][AppContext] toggle() invoked",{time:Date.now(),contextId:s.current}),n(u=>{var p;const h=!u;return console.debug("[VivlioDBG][AppContext] state transition",{from:u,to:h,contextId:s.current,stack:(p=new Error().stack)==null?void 0:p.split(`
`).slice(0,4)}),window.__vivlio_debug=window.__vivlio_debug||{toggles:[]},window.__vivlio_debug.toggles.push({at:Date.now(),from:u,to:h,contextId:s.current}),h})},[]),a={isVivliostyleActive:t,setIsVivliostyleActive:n,isOpen:t,toggle:l,markdown:r??i,forceUpdateMarkdown:u=>{console.debug("[VivlioDBG] forceUpdateMarkdown",{length:u.length,contextId:s.current}),o(u)},__contextId:s.current};return he.jsx(zx.Provider,{value:a,children:e})},$x=()=>{const e=se.useContext(zx);if(!e)throw new Error("useAppContext must be used within an AppProvider");return se.useEffect(()=>{console.debug("[VivlioDBG][useAppContext] hook used",{contextId:e.__contextId,isOpen:e.isOpen})},[e]),e},_I=()=>{const{isOpen:e,markdown:t}=$x();return se.useEffect(()=>(console.debug("[VivlioDBG][PreviewShell] mount",{time:Date.now()}),()=>{console.debug("[VivlioDBG][PreviewShell] unmount",{time:Date.now()})}),[]),se.useEffect(()=>{const n=document.getElementById("vivlio-preview-container"),i=document.querySelector(".page-editor-preview-container");if(!n){console.warn("[VivlioDBG][PreviewShell] host container missing when toggling",{isOpen:e});return}n.dataset.vivlioMount="true",n.style.display=e?"block":"none",e&&(n.style.position="relative",n.style.width="100%",n.style.height="100%",n.style.overflow="auto",n.style.zIndex="10",n.style.minHeight||(n.style.minHeight="400px"));let r=0,o=0;const s=[];i&&Array.from(i.children).forEach((a,u)=>{a!==n&&(s.push(`${u}:${a.className||a.id||a.tagName}`),e?(a.dataset.vivlioPrevDisplay||(a.dataset.vivlioPrevDisplay=a.style.display||""),a.style.setProperty("display","none","important"),a.setAttribute("aria-hidden","true"),r+=1):(a.dataset.vivlioPrevDisplay!==void 0?(a.style.display=a.dataset.vivlioPrevDisplay,delete a.dataset.vivlioPrevDisplay):a.style.display="",a.removeAttribute("aria-hidden"),o+=1))}),console.debug("[VivlioDBG][PreviewShell] toggle siblings",{isOpen:e,hasHost:!!n,hasPreviewContainer:!!i,hostDisplay:n.style.display,markdownLen:t.length,hiddenCount:r,restoredCount:o,processed:s,previewChildren:i?i.children.length:-1})},[e]),e?he.jsx("div",{"data-vivlio-shell-root":!0,children:he.jsx(AI,{markdown:t,isVisible:e})}):null},MI=['[data-testid="view-button"]',".page-editor-meta .btn-edit-page",'[data-testid="editor-button"]',".page-editor-header .btn-edit",".btn-edit-page"];function zI(e){return!e||!e.length?null:e[0]}function Uc(e){return(e.textContent||"").replace(/\s+/g," ").trim().toLowerCase()}function $I(){for(const e of MI){const t=document.querySelector(e);if(t instanceof HTMLElement)return t}return null}function DI(){const e=Array.from(document.querySelectorAll("button, a.btn, a")),t=[];return e.forEach(n=>{const i=Uc(n);if(!i)return;let r=0;/view/.test(i)&&(r+=4),/edit/.test(i)&&(r+=2),/page/.test(i)&&(r+=1),/\bedit\b/.test(i)&&(r+=1),r>0&&t.push({el:n,score:r})}),t.sort((n,i)=>i.score-n.score),zI(t.map(n=>n.el))}function VI(){return $I()||DI()}const UI=()=>{const{isOpen:e,toggle:t}=$x(),[n,i]=se.useState(null),[r,o]=se.useState(""),[s,l]=se.useState(null),a=se.useRef(!1),u=se.useRef(null),h=se.useRef(null);if(se.useEffect(()=>{function v(x){if(a.current||!x.parentElement)return;let g=x.parentElement.querySelector(".vivlio-inline-toggle");g||(g=document.createElement("span"),g.className="vivlio-inline-toggle",g.style.marginRight="6px",g.style.display="inline-flex",g.style.alignItems="center",x.parentElement.insertBefore(g,x),console.debug("[VivlioDBG][ExternalToggle] wrapper created & inserted",{time:Date.now(),parent:x.parentElement.className,anchorText:Uc(x)})),h.current=x;try{const C=window.getComputedStyle(x);l({height:C.height||"",paddingTop:C.paddingTop||"",paddingBottom:C.paddingBottom||"",paddingLeft:C.paddingLeft||"",paddingRight:C.paddingRight||"",fontSize:C.fontSize||"",lineHeight:C.lineHeight||"",borderRadius:C.borderRadius||"",minWidth:C.minWidth||""})}catch{}function m(C){if(!C)return null;const P=I=>!I||I==="transparent"||/rgba\(\s*0+\s*,\s*0+\s*,\s*0?\.?0*\s*\)/i.test(I);try{const I=window.getComputedStyle(C),M=["--vivlio-comp-color","--accent-color","--primary-color","--color"];for(const G of M){const j=I.getPropertyValue(G).trim();if(j)return j}}catch{}let A=C;for(let I=0;A&&I<8;I++,A=A.parentElement)try{const M=window.getComputedStyle(A),G=[M.backgroundColor,M.borderColor,M.color];for(const j of G)if(!P(j))return j}catch{}try{const I=C.querySelectorAll("*");for(const M of Array.from(I))try{const G=window.getComputedStyle(M),j=[G.backgroundColor,G.borderColor,G.color];for(const $ of j)if(!P($))return $}catch{}}catch{}return null}function y(){try{const C=m(x);if(C&&C!==u.current){try{g.style.setProperty("--vivlio-comp-color",C);const P=g.querySelector("button");P&&P.style.setProperty("--vivlio-comp-color",C)}catch{}u.current=C,console.debug("[VivlioDBG][ExternalToggle] applied effective color",{effective:C})}else console.debug("[VivlioDBG][ExternalToggle] no effective color found",{effective:C})}catch(C){console.warn("[VivlioDBG][ExternalToggle] error applying effective color",C)}}y(),i(g),a.current=!0,console.debug("[VivlioDBG][ExternalToggle] attached to anchor",{anchorSel:x.className,text:Uc(x)})}const w=VI();w&&v(w)},[]),se.useEffect(()=>{if(n)try{const v=n.querySelector("button.vivlio-toggle-btn");if(!v)return;const w="linear-gradient(135deg, #1a63b8 0%, #3b82f6 18%, #1a63b8 28%, #d05232 48%, #f28b6b 68%, #1a63b8 100%)",g=`radial-gradient(circle at center, rgba(0,0,0,0.82) 0%, rgba(0,0,0,0.78) 40%, rgba(0,0,0,0.68) 65%, rgba(0,0,0,0.0) 100%), ${w}`;v.style.setProperty("background",e?w:g,"important");const m=e?"100% 50%":"0% 50%";if(v.style.setProperty("background-position",m,"important"),v.style.setProperty("color",e?"#ffffff":"#9aa0a6","important"),v.style.setProperty("filter","none","important"),v.style.setProperty("box-shadow",e?"0 4px 0 rgba(0,0,0,0.18), inset 0 1px 0 rgba(255,255,255,0.12)":"0 4px 0 rgba(0,0,0,0.22), inset 0 1px 0 rgba(255,255,255,0.16), inset 0 -12px 28px rgba(0,0,0,0.9)","important"),v.style.setProperty("border","1px solid rgba(255,255,255,0.12)","important"),v.style.setProperty("box-sizing","border-box","important"),v.style.setProperty("border-radius","6px","important"),v.style.setProperty("border-radius","6px","important"),v.style.setProperty("padding","6px 10px","important"),v.style.setProperty("font-weight","600","important"),s)try{s.height&&v.style.setProperty("height",s.height,"important"),s.fontSize&&v.style.setProperty("font-size",s.fontSize,"important"),v.style.setProperty("line-height","normal","important");const P=s.paddingTop||"6px",A=s.paddingBottom||"6px",I=s.paddingLeft||"10px",M=s.paddingRight||"10px";v.style.setProperty("padding",`${P} ${M}`,"important");const G=s.borderRadius&&s.borderRadius!=="0px"?s.borderRadius:"6px";v.style.setProperty("border-radius",G,"important"),s.minWidth&&v.style.setProperty("min-width",s.minWidth,"important")}catch{}console.debug("[VivlioDBG][ExternalToggle] applied important inline styles to button (isOpen="+e+")")}catch{}},[n,e,s]),se.useEffect(()=>{if(!n)return;const v=()=>document.querySelector(".layout-root")||document.documentElement,w=()=>{const g=v(),m=g&&g.classList&&g.classList.contains("editing");try{n.style.display=m?"inline-flex":"none"}catch{}};w();const x=new MutationObserver(g=>{for(const m of g){if(m.type==="attributes"&&m.attributeName==="class"){w();return}if(m.type==="childList"){w();return}}});return x.observe(document.documentElement,{attributes:!0,attributeFilter:["class"],subtree:!0,childList:!0}),()=>x.disconnect()},[n]),!n)return null;const c=`${r.split(/\s+/).filter(v=>v&&v!=="active").join(" ")} vivlio-toggle-btn vivlio-comp${e?" active":""}`.trim(),f={background:"linear-gradient(135deg, #1a63b8 0%, #1a63b8 25%, #d05232 25%, #d05232 75%, #1a63b8 75%, #1a63b8 100%)",color:"#ffffff",border:"1px solid rgba(255,255,255,0.08)",padding:"6px 10px",borderRadius:"6px",boxShadow:"0 4px 0 rgba(0,0,0,0.18), inset 0 1px 0 rgba(255,255,255,0.12)",boxSizing:"border-box",cursor:"pointer",fontWeight:600,display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:"normal",verticalAlign:"middle",WebkitAppearance:"none",backgroundSize:"200% 100%",backgroundPosition:"0% 50%",transition:"background-position 0.225s ease, color 0.225s ease, box-shadow 0.225s ease, border-color 0.225s ease"};return Tw.createPortal(he.jsx("button",{type:"button",className:c,style:f,onClick:v=>{console.debug("[VivlioDBG][ExternalToggle] click",{isOpenBefore:e,time:Date.now(),anchorClasses:r}),t()},"aria-pressed":e,title:"Toggle Vivliostyle Preview","data-vivlio-toggle":"true",children:"Vivliostyle"}),n)},HI="growi-plugin-vivliostyle-preview",WI="1.0.0",jI="GROWI plugin template for script",GI="MIT",XI=["growi","growi-plugin"],YI="module",qI={dev:"vite",build:"tsc && vite build","build-and-push":'powershell -NoProfile -ExecutionPolicy Bypass -File ./build-and-push.ps1 "$npm_config_message"',test:"jest",preview:"vite preview"},KI={"@types/markdown-it":"^14.1.2","@types/unist":"^3.0.3","@vivliostyle/react":"^2.34.1","@vivliostyle/vfm":"^2.2.1",hastscript:"^9.0.1","markdown-it":"^14.1.0","react-innertext":"^1.1.5",unified:"^11.0.5","unist-util-visit":"^5.0.0"},QI={react:">=18","react-dom":">=18"},ZI={"@testing-library/dom":"^10.4.1","@testing-library/jest-dom":"^6.8.0","@testing-library/react":"^16.3.0","@types/jest":"^30.0.0","@types/react":"^18.3.3","@types/react-dom":"^18.3.0","@typescript-eslint/eslint-plugin":"^5.0.0","@typescript-eslint/parser":"^5.0.0","@vitejs/plugin-react":"^4.3.1",eslint:"^8.18.0","eslint-config-next":"^14.2.4","eslint-config-weseek":"^2.1.0","eslint-import-resolver-typescript":"^3.2.5","eslint-plugin-import":"^2.29.1","eslint-plugin-jest":"^27.1.0","eslint-plugin-react":"^7.30.1","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-regex":"^1.10.0","html-whitespace-sensitive-tag-names":"^3.0.1","identity-obj-proxy":"^3.0.0",jest:"^29.7.0","jest-environment-jsdom":"^30.1.2",react:"^18.3.1","react-dom":"^18.3.1",typescript:"^5.5.2",vite:"^5.3.2","vite-plugin-static-copy":"^3.1.2"},JI={schemaVersion:"4",types:["script"]},Dx={name:HI,version:WI,description:jI,license:GI,keywords:XI,type:YI,scripts:qI,dependencies:KI,peerDependencies:QI,devDependencies:ZI,growiPlugin:JI};console.debug("[VivlioDBG][entry] script file evaluated",{time:Date.now(),plugin:Dx.name});const Vx=Dx.name,Hc="vivlio-preview-container",Ux=[".page-editor-preview-container","#page-editor-preview-container",".page-editor-preview",".page-editor-preview-body"];function eR(){for(const e of Ux){const t=document.querySelector(e);if(t)return t}return null}function Wc(){if(console.debug("[VivlioDBG] activate -> mount called, readyState=",document.readyState),document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>Wc(),{once:!0});return}const e=eR();if(console.debug("[VivlioDBG][mount] query preview container",{found:!!e,candidates:Ux}),!e){console.debug("[VivlioDBG][mount] previewContainer not found, retry scheduling (200ms)"),setTimeout(()=>{window.__vivlio_root||Wc()},200);return}let t=document.getElementById(Hc);t||(t=document.createElement("div"),t.id=Hc,t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.right="0",t.style.bottom="0",t.style.display="none",e.appendChild(t),console.debug("[VivlioDBG][mount] host container created and appended"));let n=window.__vivlio_root;n?console.debug("[VivlioDBG][mount] root already exists - skipping re-create"):(n=Iw(t),window.__vivlio_root=n),console.debug("[VivlioDBG][mount] rendering React tree",{hasHost:!!t,childrenBefore:t.childElementCount}),n.render(he.jsx(se.StrictMode,{children:he.jsx(BI,{children:he.jsxs("div",{style:{display:"contents"},children:[he.jsx(_I,{}),he.jsx(UI,{})]})})})),console.debug("[VivlioDBG][mount] mount finished",{hostChildrenAfter:t.childElementCount})}function Hx(){console.debug("[VivlioDBG][unmount] called");const e=window.__vivlio_root;e&&(e.unmount(),delete window.__vivlio_root,console.debug("[VivlioDBG][unmount] root unmounted"));const t=document.getElementById(Hc);t!=null&&t.parentNode&&t.parentNode.removeChild(t)}const Pp=()=>{console.debug("[VivlioDBG] activate() invoked",{time:Date.now()}),Wc()},tR=()=>{console.debug("[VivlioDBG] deactivate() invoked",{time:Date.now()}),Hx()};window.pluginActivators==null&&(window.pluginActivators={});window.pluginActivators[Vx]={activate:Pp,deactivate:tR};console.debug("[VivlioDBG][entry] pluginActivators registered",{id:Vx});window.__vivlio_autoActivateTimer||(window.__vivlio_autoActivateTimer=setTimeout(()=>{window.__vivlio_root?console.debug("[VivlioDBG][entry] skip auto activate root already present"):(console.debug("[VivlioDBG][entry] auto activating (fallback)"),Pp())},3e3));window.__vivlio_forceActivate=Pp;window.__vivlio_forceUnmount=Hx;

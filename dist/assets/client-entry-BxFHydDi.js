import*as s from"react";import y from"react";import g from"react-dom";var v={exports:{}},u={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _=y,b=Symbol.for("react.element"),k=Symbol.for("react.fragment"),h=Object.prototype.hasOwnProperty,j=_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,x={key:!0,ref:!0,__self:!0,__source:!0};function m(t,e,l){var i,n={},r=null,o=null;l!==void 0&&(r=""+l),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)h.call(e,i)&&!x.hasOwnProperty(i)&&(n[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)n[i]===void 0&&(n[i]=e[i]);return{$$typeof:b,type:t,key:r,ref:o,props:n,_owner:j.current}}u.Fragment=k;u.jsx=m;u.jsxs=m;v.exports=u;var c=v.exports,w,p=g;w=p.createRoot,p.hydrateRoot;const E="/plugins/growi-plugin-vivliostyle-preview/viewer/index.html",R=()=>c.jsx("iframe",{id:"vivlio-iframe",title:"Vivliostyle Viewer",src:E,style:{width:"100%",height:"100%",border:0},sandbox:"allow-scripts allow-same-origin"});function O(t={}){const{debounceMs:e=250}=t,[l,i]=s.useState(""),n=s.useRef(null),r=s.useCallback(o=>{n.current&&window.clearTimeout(n.current),n.current=window.setTimeout(()=>i(o),e)},[e]);return s.useEffect(()=>{const o=document.querySelector("textarea.editor")||document.querySelector("#page-editor textarea"),d=()=>{const f=(o==null?void 0:o.value)??"";r(f)};return d(),o==null||o.addEventListener("input",d),()=>{o==null||o.removeEventListener("input",d),n.current&&window.clearTimeout(n.current)}},[r]),{markdown:l}}function I(){const[t,e]=s.useState(""),l=s.useCallback(i=>{var r;e(i);const n=document.querySelector("#vivlio-iframe");(r=n==null?void 0:n.contentWindow)==null||r.postMessage({type:"vivlio:update",html:i},"*")},[]);return{html:t,updateViewer:l}}function S(){const[t,e]=s.useState(()=>localStorage.getItem("vivlio:isOpen")==="1"),l=s.useCallback(()=>e(!0),[]),i=s.useCallback(()=>e(!1),[]),n=s.useCallback(()=>e(r=>!r),[]);return s.useEffect(()=>{localStorage.setItem("vivlio:isOpen",t?"1":"0")},[t]),{isOpen:t,open:l,close:i,toggle:n}}const C=require("markdown-it"),N=new C({html:!0,linkify:!0}),V=()=>{const{isOpen:t,toggle:e}=S(),{markdown:l}=O({debounceMs:250}),{updateViewer:i}=I();return s.useEffect(()=>{if(!t)return;const n=N.render(l);i(n)},[l,t,i]),c.jsxs("div",{className:`vivlio-preview ${t?"is-open":"is-closed"}`,children:[c.jsx("div",{className:"vivlio-toolbar",children:c.jsx("button",{onClick:e,"aria-expanded":t,children:t?"Close Vivliostyle":"Open Vivliostyle"})}),c.jsx("div",{className:"vivlio-body",role:"region","aria-label":"Vivliostyle preview",children:t&&c.jsx(R,{})})]})},D="growi-plugin-vivliostyle-preview",P="1.0.0",T="GROWI plugin template for script",L="MIT",M=["growi","growi-plugin"],q="module",$={dev:"vite",build:"tsc && vite build",test:"jest",preview:"vite preview"},A={"@types/unist":"^3.0.3","@vivliostyle/viewer":"^2.34.1",hastscript:"^9.0.1","markdown-it":"^14.1.0","react-innertext":"^1.1.5",unified:"^11.0.5","unist-util-visit":"^5.0.0"},B={react:">=18","react-dom":">=18"},U={"@testing-library/dom":"^10.4.1","@testing-library/jest-dom":"^6.8.0","@testing-library/react":"^16.3.0","@types/jest":"^30.0.0","@types/markdown-it":"^14.1.2","@types/react":"^18.3.3","@types/react-dom":"^18.3.0","@typescript-eslint/eslint-plugin":"^5.0.0","@typescript-eslint/parser":"^5.0.0","@vitejs/plugin-react":"^4.3.1",eslint:"^8.18.0","eslint-config-next":"^14.2.4","eslint-config-weseek":"^2.1.0","eslint-import-resolver-typescript":"^3.2.5","eslint-plugin-import":"^2.29.1","eslint-plugin-jest":"^27.1.0","eslint-plugin-react":"^7.30.1","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-regex":"^1.10.0","identity-obj-proxy":"^3.0.0",jest:"^29.7.0","jest-environment-jsdom":"^30.1.2",react:"^18.3.1","react-dom":"^18.3.1",typescript:"^5.5.2",vite:"^5.3.2"},W={schemaVersion:"4",types:["script"]},F={name:D,version:P,description:T,license:L,keywords:M,type:q,scripts:$,dependencies:A,peerDependencies:B,devDependencies:U,growiPlugin:W},G=F.name,a="vivlio-preview-container";function H(){let t=document.getElementById(a);t||(t=document.createElement("div"),t.id=a,document.body.appendChild(t));const e=w(t);e.render(c.jsx(V,{})),window.__vivlio_root=e}function J(){const t=window.__vivlio_root;t&&(t.unmount(),delete window.__vivlio_root);const e=document.getElementById(a);e!=null&&e.parentNode&&e.parentNode.removeChild(e)}const Y=()=>{H()},z=()=>{J()};window.pluginActivators==null&&(window.pluginActivators={});window.pluginActivators[G]={activate:Y,deactivate:z};

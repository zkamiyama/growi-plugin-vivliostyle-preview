import*as l from"react";import b from"react";import x from"react-dom";var m={exports:{}},u={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var h=b,_=Symbol.for("react.element"),E=Symbol.for("react.fragment"),j=Object.prototype.hasOwnProperty,k=h.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,S={key:!0,ref:!0,__self:!0,__source:!0};function g(e,t,r){var i,n={},o=null,s=null;r!==void 0&&(o=""+r),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(s=t.ref);for(i in t)j.call(t,i)&&!S.hasOwnProperty(i)&&(n[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps,t)n[i]===void 0&&(n[i]=t[i]);return{$$typeof:_,type:e,key:o,ref:s,props:n,_owner:k.current}}u.Fragment=E;u.jsx=g;u.jsxs=g;m.exports=u;var c=m.exports,f,v=x;f=v.createRoot,v.hydrateRoot;const R="/plugins/growi-plugin-vivliostyle-preview/viewer/index.html",C=()=>c.jsx("iframe",{id:"vivlio-iframe",title:"Vivliostyle Viewer",src:R,style:{width:"100%",height:"100%",border:0},sandbox:"allow-scripts allow-same-origin"});function O(e={}){const{debounceMs:t=250}=e,[r,i]=l.useState(""),n=l.useRef(null),o=l.useCallback(s=>{n.current&&window.clearTimeout(n.current),n.current=window.setTimeout(()=>i(s),t)},[t]);return l.useEffect(()=>{const s=document.querySelector("textarea.editor")||document.querySelector("#page-editor textarea"),a=()=>{const y=(s==null?void 0:s.value)??"";o(y)};return a(),s==null||s.addEventListener("input",a),()=>{s==null||s.removeEventListener("input",a),n.current&&window.clearTimeout(n.current)}},[o]),{markdown:r}}function V(){const[e,t]=l.useState(""),r=l.useCallback(i=>{var o;t(i);const n=document.querySelector("#vivlio-iframe");(o=n==null?void 0:n.contentWindow)==null||o.postMessage({type:"vivlio:update",html:i},"*")},[]);return{html:e,updateViewer:r}}function p(){const[e,t]=l.useState(()=>localStorage.getItem("vivlio:isOpen")==="1"),r=l.useCallback(()=>t(!0),[]),i=l.useCallback(()=>t(!1),[]),n=l.useCallback(()=>t(o=>!o),[]);return l.useEffect(()=>{localStorage.setItem("vivlio:isOpen",e?"1":"0");try{window.dispatchEvent(new CustomEvent("vivlio:state-changed",{detail:{isOpen:e}}))}catch{}},[e]),{isOpen:e,open:r,close:i,toggle:n}}const I=require("markdown-it"),N=new I({html:!0,linkify:!0}),P=()=>{const{isOpen:e,toggle:t}=p(),{markdown:r}=O({debounceMs:250}),{updateViewer:i}=V();return l.useEffect(()=>{if(!e)return;const n=N.render(r);i(n)},[r,e,i]),c.jsxs("div",{className:`vivlio-preview ${e?"is-open":"is-closed"}`,children:[c.jsx("div",{className:"vivlio-toolbar",children:c.jsx("button",{onClick:t,"aria-expanded":e,children:e?"Close Vivliostyle":"Open Vivliostyle"})}),c.jsx("div",{className:"vivlio-body",role:"region","aria-label":"Vivliostyle preview",children:e&&c.jsx(C,{})})]})};function T(){const e=[".btn-edit","#edit-button",".grw-page-control-buttons .btn-primary"];for(const t of e){const r=document.querySelector(t);if(r)return r}return null}const D=()=>{const{isOpen:e,toggle:t}=p(),[r,i]=l.useState(!1);return l.useEffect(()=>{const n=T();if(!n||n.parentElement==null)return;if(n.parentElement.querySelector(".vivlio-inline-toggle")){i(!0);return}const o=document.createElement("span");return o.className="vivlio-inline-toggle",o.style.marginLeft="8px",n.parentElement.insertBefore(o,n.nextSibling),i(!0),()=>{o.parentElement&&o.parentElement.removeChild(o)}},[]),r?c.jsx("button",{type:"button",className:`btn btn-sm ${e?"btn-secondary":"btn-outline-secondary"}`,onClick:t,"aria-pressed":e,title:"Toggle Vivliostyle Preview",children:e?"Vivlio Close":"Vivlio Preview"}):null},L={position:"fixed",right:"20px",bottom:"20px",zIndex:2147483647,padding:"10px 16px",fontSize:"14px",fontWeight:600,borderRadius:"9999px",border:"1px solid #ccc",background:"#fff",boxShadow:"0 4px 12px rgba(0,0,0,.15)",cursor:"pointer"},M=()=>{const{isOpen:e,toggle:t}=p();return c.jsx("button",{type:"button","aria-pressed":e,onClick:t,style:L,title:"Vivliostyle Preview",children:e?"Close Vivliostyle":"Vivliostyle"})},q="growi-plugin-vivliostyle-preview",$="1.0.0",A="GROWI plugin template for script",B="MIT",F=["growi","growi-plugin"],W="module",U={dev:"vite",build:"tsc && vite build",test:"jest",preview:"vite preview"},z={"@types/unist":"^3.0.3","@vivliostyle/viewer":"^2.34.1",hastscript:"^9.0.1","markdown-it":"^14.1.0","react-innertext":"^1.1.5",unified:"^11.0.5","unist-util-visit":"^5.0.0"},G={react:">=18","react-dom":">=18"},H={"@testing-library/dom":"^10.4.1","@testing-library/jest-dom":"^6.8.0","@testing-library/react":"^16.3.0","@types/jest":"^30.0.0","@types/markdown-it":"^14.1.2","@types/react":"^18.3.3","@types/react-dom":"^18.3.0","@typescript-eslint/eslint-plugin":"^5.0.0","@typescript-eslint/parser":"^5.0.0","@vitejs/plugin-react":"^4.3.1",eslint:"^8.18.0","eslint-config-next":"^14.2.4","eslint-config-weseek":"^2.1.0","eslint-import-resolver-typescript":"^3.2.5","eslint-plugin-import":"^2.29.1","eslint-plugin-jest":"^27.1.0","eslint-plugin-react":"^7.30.1","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-regex":"^1.10.0","identity-obj-proxy":"^3.0.0",jest:"^29.7.0","jest-environment-jsdom":"^30.1.2",react:"^18.3.1","react-dom":"^18.3.1",typescript:"^5.5.2",vite:"^5.3.2"},J={schemaVersion:"4",types:["script"]},Y={name:q,version:$,description:A,license:B,keywords:F,type:W,scripts:U,dependencies:z,peerDependencies:G,devDependencies:H,growiPlugin:J},K=Y.name,d="vivlio-preview-container";function w(){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>w(),{once:!0});return}let e=document.getElementById(d);e||(e=document.createElement("div"),e.id=d,document.body.appendChild(e));const t=f(e);t.render(c.jsxs(c.Fragment,{children:[c.jsx(P,{}),c.jsx(D,{}),c.jsx(M,{})]})),window.__vivlio_root=t}function Q(){const e=window.__vivlio_root;e&&(e.unmount(),delete window.__vivlio_root);const t=document.getElementById(d);t!=null&&t.parentNode&&t.parentNode.removeChild(t)}const X=()=>{w()},Z=()=>{Q()};window.pluginActivators==null&&(window.pluginActivators={});window.pluginActivators[K]={activate:X,deactivate:Z};

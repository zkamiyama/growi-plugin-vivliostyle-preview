function zx(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var hm={exports:{}},Ia={},cm={exports:{}},ve={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ls=Symbol.for("react.element"),$x=Symbol.for("react.portal"),Dx=Symbol.for("react.fragment"),Vx=Symbol.for("react.strict_mode"),Ux=Symbol.for("react.profiler"),Hx=Symbol.for("react.provider"),Wx=Symbol.for("react.context"),Gx=Symbol.for("react.forward_ref"),jx=Symbol.for("react.suspense"),Xx=Symbol.for("react.memo"),Yx=Symbol.for("react.lazy"),bp=Symbol.iterator;function qx(e){return e===null||typeof e!="object"?null:(e=bp&&e[bp]||e["@@iterator"],typeof e=="function"?e:null)}var dm={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},pm=Object.assign,fm={};function eo(e,t,n){this.props=e,this.context=t,this.refs=fm,this.updater=n||dm}eo.prototype.isReactComponent={};eo.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};eo.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function gm(){}gm.prototype=eo.prototype;function $c(e,t,n){this.props=e,this.context=t,this.refs=fm,this.updater=n||dm}var Dc=$c.prototype=new gm;Dc.constructor=$c;pm(Dc,eo.prototype);Dc.isPureReactComponent=!0;var Sp=Array.isArray,mm=Object.prototype.hasOwnProperty,Vc={current:null},vm={key:!0,ref:!0,__self:!0,__source:!0};function wm(e,t,n){var i,r={},o=null,s=null;if(t!=null)for(i in t.ref!==void 0&&(s=t.ref),t.key!==void 0&&(o=""+t.key),t)mm.call(t,i)&&!vm.hasOwnProperty(i)&&(r[i]=t[i]);var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){for(var a=Array(l),u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}if(e&&e.defaultProps)for(i in l=e.defaultProps,l)r[i]===void 0&&(r[i]=l[i]);return{$$typeof:Ls,type:e,key:o,ref:s,props:r,_owner:Vc.current}}function Kx(e,t){return{$$typeof:Ls,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Uc(e){return typeof e=="object"&&e!==null&&e.$$typeof===Ls}function Qx(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Cp=/\/+/g;function ru(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Qx(""+e.key):t.toString(36)}function Cl(e,t,n,i,r){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var s=!1;if(e===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case Ls:case $x:s=!0}}if(s)return s=e,r=r(s),e=i===""?"."+ru(s,0):i,Sp(r)?(n="",e!=null&&(n=e.replace(Cp,"$&/")+"/"),Cl(r,t,n,"",function(u){return u})):r!=null&&(Uc(r)&&(r=Kx(r,n+(!r.key||s&&s.key===r.key?"":(""+r.key).replace(Cp,"$&/")+"/")+e)),t.push(r)),1;if(s=0,i=i===""?".":i+":",Sp(e))for(var l=0;l<e.length;l++){o=e[l];var a=i+ru(o,l);s+=Cl(o,t,n,a,r)}else if(a=qx(e),typeof a=="function")for(e=a.call(e),l=0;!(o=e.next()).done;)o=o.value,a=i+ru(o,l++),s+=Cl(o,t,n,a,r);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function qs(e,t,n){if(e==null)return e;var i=[],r=0;return Cl(e,i,"","",function(o){return t.call(n,o,r++)}),i}function Zx(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var _t={current:null},kl={transition:null},Jx={ReactCurrentDispatcher:_t,ReactCurrentBatchConfig:kl,ReactCurrentOwner:Vc};function ym(){throw Error("act(...) is not supported in production builds of React.")}ve.Children={map:qs,forEach:function(e,t,n){qs(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return qs(e,function(){t++}),t},toArray:function(e){return qs(e,function(t){return t})||[]},only:function(e){if(!Uc(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ve.Component=eo;ve.Fragment=Dx;ve.Profiler=Ux;ve.PureComponent=$c;ve.StrictMode=Vx;ve.Suspense=jx;ve.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jx;ve.act=ym;ve.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=pm({},e.props),r=e.key,o=e.ref,s=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,s=Vc.current),t.key!==void 0&&(r=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(a in t)mm.call(t,a)&&!vm.hasOwnProperty(a)&&(i[a]=t[a]===void 0&&l!==void 0?l[a]:t[a])}var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){l=Array(a);for(var u=0;u<a;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:Ls,type:e.type,key:r,ref:o,props:i,_owner:s}};ve.createContext=function(e){return e={$$typeof:Wx,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Hx,_context:e},e.Consumer=e};ve.createElement=wm;ve.createFactory=function(e){var t=wm.bind(null,e);return t.type=e,t};ve.createRef=function(){return{current:null}};ve.forwardRef=function(e){return{$$typeof:Gx,render:e}};ve.isValidElement=Uc;ve.lazy=function(e){return{$$typeof:Yx,_payload:{_status:-1,_result:e},_init:Zx}};ve.memo=function(e,t){return{$$typeof:Xx,type:e,compare:t===void 0?null:t}};ve.startTransition=function(e){var t=kl.transition;kl.transition={};try{e()}finally{kl.transition=t}};ve.unstable_act=ym;ve.useCallback=function(e,t){return _t.current.useCallback(e,t)};ve.useContext=function(e){return _t.current.useContext(e)};ve.useDebugValue=function(){};ve.useDeferredValue=function(e){return _t.current.useDeferredValue(e)};ve.useEffect=function(e,t){return _t.current.useEffect(e,t)};ve.useId=function(){return _t.current.useId()};ve.useImperativeHandle=function(e,t,n){return _t.current.useImperativeHandle(e,t,n)};ve.useInsertionEffect=function(e,t){return _t.current.useInsertionEffect(e,t)};ve.useLayoutEffect=function(e,t){return _t.current.useLayoutEffect(e,t)};ve.useMemo=function(e,t){return _t.current.useMemo(e,t)};ve.useReducer=function(e,t,n){return _t.current.useReducer(e,t,n)};ve.useRef=function(e){return _t.current.useRef(e)};ve.useState=function(e){return _t.current.useState(e)};ve.useSyncExternalStore=function(e,t,n){return _t.current.useSyncExternalStore(e,t,n)};ve.useTransition=function(){return _t.current.useTransition()};ve.version="18.3.1";cm.exports=ve;var le=cm.exports;const Et=zx(le);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var e1=le,t1=Symbol.for("react.element"),n1=Symbol.for("react.fragment"),i1=Object.prototype.hasOwnProperty,r1=e1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o1={key:!0,ref:!0,__self:!0,__source:!0};function xm(e,t,n){var i,r={},o=null,s=null;n!==void 0&&(o=""+n),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(s=t.ref);for(i in t)i1.call(t,i)&&!o1.hasOwnProperty(i)&&(r[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps,t)r[i]===void 0&&(r[i]=t[i]);return{$$typeof:t1,type:e,key:o,ref:s,props:r,_owner:r1.current}}Ia.Fragment=n1;Ia.jsx=xm;Ia.jsxs=xm;hm.exports=Ia;var we=hm.exports,bm={exports:{}},en={},Sm={exports:{}},Cm={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(P,_){var G=P.length;P.push(_);e:for(;0<G;){var ee=G-1>>>1,I=P[ee];if(0<r(I,_))P[ee]=_,P[G]=I,G=ee;else break e}}function n(P){return P.length===0?null:P[0]}function i(P){if(P.length===0)return null;var _=P[0],G=P.pop();if(G!==_){P[0]=G;e:for(var ee=0,I=P.length,T=I>>>1;ee<T;){var B=2*(ee+1)-1,Y=P[B],E=B+1,W=P[E];if(0>r(Y,G))E<I&&0>r(W,Y)?(P[ee]=W,P[E]=G,ee=E):(P[ee]=Y,P[B]=G,ee=B);else if(E<I&&0>r(W,G))P[ee]=W,P[E]=G,ee=E;else break e}}return _}function r(P,_){var G=P.sortIndex-_.sortIndex;return G!==0?G:P.id-_.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();e.unstable_now=function(){return s.now()-l}}var a=[],u=[],h=1,p=null,c=3,f=!1,v=!1,w=!1,y=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(P){for(var _=n(u);_!==null;){if(_.callback===null)i(u);else if(_.startTime<=P)i(u),_.sortIndex=_.expirationTime,t(a,_);else break;_=n(u)}}function C(P){if(w=!1,x(P),!v)if(n(a)!==null)v=!0,M(N);else{var _=n(u);_!==null&&H(C,_.startTime-P)}}function N(P,_){v=!1,w&&(w=!1,g(z),z=-1),f=!0;var G=c;try{for(x(_),p=n(a);p!==null&&(!(p.expirationTime>_)||P&&!D());){var ee=p.callback;if(typeof ee=="function"){p.callback=null,c=p.priorityLevel;var I=ee(p.expirationTime<=_);_=e.unstable_now(),typeof I=="function"?p.callback=I:p===n(a)&&i(a),x(_)}else i(a);p=n(a)}if(p!==null)var T=!0;else{var B=n(u);B!==null&&H(C,B.startTime-_),T=!1}return T}finally{p=null,c=G,f=!1}}var A=!1,L=null,z=-1,q=5,Q=-1;function D(){return!(e.unstable_now()-Q<q)}function Z(){if(L!==null){var P=e.unstable_now();Q=P;var _=!0;try{_=L(!0,P)}finally{_?b():(A=!1,L=null)}}else A=!1}var b;if(typeof m=="function")b=function(){m(Z)};else if(typeof MessageChannel<"u"){var R=new MessageChannel,k=R.port2;R.port1.onmessage=Z,b=function(){k.postMessage(null)}}else b=function(){y(Z,0)};function M(P){L=P,A||(A=!0,b())}function H(P,_){z=y(function(){P(e.unstable_now())},_)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(P){P.callback=null},e.unstable_continueExecution=function(){v||f||(v=!0,M(N))},e.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):q=0<P?Math.floor(1e3/P):5},e.unstable_getCurrentPriorityLevel=function(){return c},e.unstable_getFirstCallbackNode=function(){return n(a)},e.unstable_next=function(P){switch(c){case 1:case 2:case 3:var _=3;break;default:_=c}var G=c;c=_;try{return P()}finally{c=G}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(P,_){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var G=c;c=P;try{return _()}finally{c=G}},e.unstable_scheduleCallback=function(P,_,G){var ee=e.unstable_now();switch(typeof G=="object"&&G!==null?(G=G.delay,G=typeof G=="number"&&0<G?ee+G:ee):G=ee,P){case 1:var I=-1;break;case 2:I=250;break;case 5:I=1073741823;break;case 4:I=1e4;break;default:I=5e3}return I=G+I,P={id:h++,callback:_,priorityLevel:P,startTime:G,expirationTime:I,sortIndex:-1},G>ee?(P.sortIndex=G,t(u,P),n(a)===null&&P===n(u)&&(w?(g(z),z=-1):w=!0,H(C,G-ee))):(P.sortIndex=I,t(a,P),v||f||(v=!0,M(N))),P},e.unstable_shouldYield=D,e.unstable_wrapCallback=function(P){var _=c;return function(){var G=c;c=_;try{return P.apply(this,arguments)}finally{c=G}}}})(Cm);Sm.exports=Cm;var s1=Sm.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l1=le,Jt=s1;function J(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var km=new Set,is={};function ir(e,t){Ur(e,t),Ur(e+"Capture",t)}function Ur(e,t){for(is[e]=t,e=0;e<t.length;e++)km.add(t[e])}var Hn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xu=Object.prototype.hasOwnProperty,a1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,kp={},Ep={};function u1(e){return Xu.call(Ep,e)?!0:Xu.call(kp,e)?!1:a1.test(e)?Ep[e]=!0:(kp[e]=!0,!1)}function h1(e,t,n,i){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function c1(e,t,n,i){if(t===null||typeof t>"u"||h1(e,t,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Mt(e,t,n,i,r,o,s){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var xt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){xt[e]=new Mt(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];xt[t]=new Mt(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){xt[e]=new Mt(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){xt[e]=new Mt(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){xt[e]=new Mt(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){xt[e]=new Mt(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){xt[e]=new Mt(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){xt[e]=new Mt(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){xt[e]=new Mt(e,5,!1,e.toLowerCase(),null,!1,!1)});var Hc=/[\-:]([a-z])/g;function Wc(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Hc,Wc);xt[t]=new Mt(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Hc,Wc);xt[t]=new Mt(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Hc,Wc);xt[t]=new Mt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){xt[e]=new Mt(e,1,!1,e.toLowerCase(),null,!1,!1)});xt.xlinkHref=new Mt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){xt[e]=new Mt(e,1,!1,e.toLowerCase(),null,!0,!0)});function Gc(e,t,n,i){var r=xt.hasOwnProperty(t)?xt[t]:null;(r!==null?r.type!==0:i||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(c1(t,n,r,i)&&(n=null),i||r===null?u1(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=n===null?r.type===3?!1:"":n:(t=r.attributeName,i=r.attributeNamespace,n===null?e.removeAttribute(t):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}var Zn=l1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ks=Symbol.for("react.element"),fr=Symbol.for("react.portal"),gr=Symbol.for("react.fragment"),jc=Symbol.for("react.strict_mode"),Yu=Symbol.for("react.profiler"),Em=Symbol.for("react.provider"),Pm=Symbol.for("react.context"),Xc=Symbol.for("react.forward_ref"),qu=Symbol.for("react.suspense"),Ku=Symbol.for("react.suspense_list"),Yc=Symbol.for("react.memo"),ni=Symbol.for("react.lazy"),Nm=Symbol.for("react.offscreen"),Pp=Symbol.iterator;function ho(e){return e===null||typeof e!="object"?null:(e=Pp&&e[Pp]||e["@@iterator"],typeof e=="function"?e:null)}var We=Object.assign,ou;function ko(e){if(ou===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);ou=t&&t[1]||""}return`
`+ou+e}var su=!1;function lu(e,t){if(!e||su)return"";su=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var i=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){i=u}e.call(t.prototype)}else{try{throw Error()}catch(u){i=u}e()}}catch(u){if(u&&i&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),o=i.stack.split(`
`),s=r.length-1,l=o.length-1;1<=s&&0<=l&&r[s]!==o[l];)l--;for(;1<=s&&0<=l;s--,l--)if(r[s]!==o[l]){if(s!==1||l!==1)do if(s--,l--,0>l||r[s]!==o[l]){var a=`
`+r[s].replace(" at new "," at ");return e.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",e.displayName)),a}while(1<=s&&0<=l);break}}}finally{su=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?ko(e):""}function d1(e){switch(e.tag){case 5:return ko(e.type);case 16:return ko("Lazy");case 13:return ko("Suspense");case 19:return ko("SuspenseList");case 0:case 2:case 15:return e=lu(e.type,!1),e;case 11:return e=lu(e.type.render,!1),e;case 1:return e=lu(e.type,!0),e;default:return""}}function Qu(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case gr:return"Fragment";case fr:return"Portal";case Yu:return"Profiler";case jc:return"StrictMode";case qu:return"Suspense";case Ku:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Pm:return(e.displayName||"Context")+".Consumer";case Em:return(e._context.displayName||"Context")+".Provider";case Xc:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Yc:return t=e.displayName||null,t!==null?t:Qu(e.type)||"Memo";case ni:t=e._payload,e=e._init;try{return Qu(e(t))}catch{}}return null}function p1(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qu(t);case 8:return t===jc?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function bi(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Tm(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function f1(e){var t=Tm(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(s){i=""+s,o.call(this,s)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(s){i=""+s},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Qs(e){e._valueTracker||(e._valueTracker=f1(e))}function Im(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=Tm(e)?e.checked?"true":"false":e.value),e=i,e!==n?(t.setValue(e),!0):!1}function Wl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Zu(e,t){var n=t.checked;return We({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Np(e,t){var n=t.defaultValue==null?"":t.defaultValue,i=t.checked!=null?t.checked:t.defaultChecked;n=bi(t.value!=null?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Rm(e,t){t=t.checked,t!=null&&Gc(e,"checked",t,!1)}function Ju(e,t){Rm(e,t);var n=bi(t.value),i=t.type;if(n!=null)i==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(i==="submit"||i==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?eh(e,t.type,n):t.hasOwnProperty("defaultValue")&&eh(e,t.type,bi(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Tp(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!(i!=="submit"&&i!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function eh(e,t,n){(t!=="number"||Wl(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Eo=Array.isArray;function Lr(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+bi(n),t=null,r=0;r<e.length;r++){if(e[r].value===n){e[r].selected=!0,i&&(e[r].defaultSelected=!0);return}t!==null||e[r].disabled||(t=e[r])}t!==null&&(t.selected=!0)}}function th(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(J(91));return We({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Ip(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(J(92));if(Eo(n)){if(1<n.length)throw Error(J(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:bi(n)}}function Am(e,t){var n=bi(t.value),i=bi(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),i!=null&&(e.defaultValue=""+i)}function Rp(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Lm(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function nh(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Lm(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Zs,Fm=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,i,r){MSApp.execUnsafeLocalFunction(function(){return e(t,n,i,r)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Zs=Zs||document.createElement("div"),Zs.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Zs.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function rs(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var _o={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},g1=["Webkit","ms","Moz","O"];Object.keys(_o).forEach(function(e){g1.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),_o[t]=_o[e]})});function Om(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||_o.hasOwnProperty(e)&&_o[e]?(""+t).trim():t+"px"}function Bm(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=Om(n,t[n],i);n==="float"&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}var m1=We({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ih(e,t){if(t){if(m1[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(J(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(J(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(J(61))}if(t.style!=null&&typeof t.style!="object")throw Error(J(62))}}function rh(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var oh=null;function qc(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var sh=null,Fr=null,Or=null;function Ap(e){if(e=Bs(e)){if(typeof sh!="function")throw Error(J(280));var t=e.stateNode;t&&(t=Oa(t),sh(e.stateNode,e.type,t))}}function _m(e){Fr?Or?Or.push(e):Or=[e]:Fr=e}function Mm(){if(Fr){var e=Fr,t=Or;if(Or=Fr=null,Ap(e),t)for(e=0;e<t.length;e++)Ap(t[e])}}function zm(e,t){return e(t)}function $m(){}var au=!1;function Dm(e,t,n){if(au)return e(t,n);au=!0;try{return zm(e,t,n)}finally{au=!1,(Fr!==null||Or!==null)&&($m(),Mm())}}function os(e,t){var n=e.stateNode;if(n===null)return null;var i=Oa(n);if(i===null)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(e=e.type,i=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!i;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(J(231,t,typeof n));return n}var lh=!1;if(Hn)try{var co={};Object.defineProperty(co,"passive",{get:function(){lh=!0}}),window.addEventListener("test",co,co),window.removeEventListener("test",co,co)}catch{lh=!1}function v1(e,t,n,i,r,o,s,l,a){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(h){this.onError(h)}}var Mo=!1,Gl=null,jl=!1,ah=null,w1={onError:function(e){Mo=!0,Gl=e}};function y1(e,t,n,i,r,o,s,l,a){Mo=!1,Gl=null,v1.apply(w1,arguments)}function x1(e,t,n,i,r,o,s,l,a){if(y1.apply(this,arguments),Mo){if(Mo){var u=Gl;Mo=!1,Gl=null}else throw Error(J(198));jl||(jl=!0,ah=u)}}function rr(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Vm(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Lp(e){if(rr(e)!==e)throw Error(J(188))}function b1(e){var t=e.alternate;if(!t){if(t=rr(e),t===null)throw Error(J(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(r===null)break;var o=r.alternate;if(o===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return Lp(r),e;if(o===i)return Lp(r),t;o=o.sibling}throw Error(J(188))}if(n.return!==i.return)n=r,i=o;else{for(var s=!1,l=r.child;l;){if(l===n){s=!0,n=r,i=o;break}if(l===i){s=!0,i=r,n=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===n){s=!0,n=o,i=r;break}if(l===i){s=!0,i=o,n=r;break}l=l.sibling}if(!s)throw Error(J(189))}}if(n.alternate!==i)throw Error(J(190))}if(n.tag!==3)throw Error(J(188));return n.stateNode.current===n?e:t}function Um(e){return e=b1(e),e!==null?Hm(e):null}function Hm(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Hm(e);if(t!==null)return t;e=e.sibling}return null}var Wm=Jt.unstable_scheduleCallback,Fp=Jt.unstable_cancelCallback,S1=Jt.unstable_shouldYield,C1=Jt.unstable_requestPaint,tt=Jt.unstable_now,k1=Jt.unstable_getCurrentPriorityLevel,Kc=Jt.unstable_ImmediatePriority,Gm=Jt.unstable_UserBlockingPriority,Xl=Jt.unstable_NormalPriority,E1=Jt.unstable_LowPriority,jm=Jt.unstable_IdlePriority,Ra=null,An=null;function P1(e){if(An&&typeof An.onCommitFiberRoot=="function")try{An.onCommitFiberRoot(Ra,e,void 0,(e.current.flags&128)===128)}catch{}}var xn=Math.clz32?Math.clz32:I1,N1=Math.log,T1=Math.LN2;function I1(e){return e>>>=0,e===0?32:31-(N1(e)/T1|0)|0}var Js=64,el=4194304;function Po(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Yl(e,t){var n=e.pendingLanes;if(n===0)return 0;var i=0,r=e.suspendedLanes,o=e.pingedLanes,s=n&268435455;if(s!==0){var l=s&~r;l!==0?i=Po(l):(o&=s,o!==0&&(i=Po(o)))}else s=n&~r,s!==0?i=Po(s):o!==0&&(i=Po(o));if(i===0)return 0;if(t!==0&&t!==i&&!(t&r)&&(r=i&-i,o=t&-t,r>=o||r===16&&(o&4194240)!==0))return t;if(i&4&&(i|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=i;0<t;)n=31-xn(t),r=1<<n,i|=e[n],t&=~r;return i}function R1(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function A1(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-xn(o),l=1<<s,a=r[s];a===-1?(!(l&n)||l&i)&&(r[s]=R1(l,t)):a<=t&&(e.expiredLanes|=l),o&=~l}}function uh(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Xm(){var e=Js;return Js<<=1,!(Js&4194240)&&(Js=64),e}function uu(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Fs(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-xn(t),e[t]=n}function L1(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-xn(n),o=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~o}}function Qc(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-xn(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var Ee=0;function Ym(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var qm,Zc,Km,Qm,Zm,hh=!1,tl=[],ci=null,di=null,pi=null,ss=new Map,ls=new Map,ri=[],F1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Op(e,t){switch(e){case"focusin":case"focusout":ci=null;break;case"dragenter":case"dragleave":di=null;break;case"mouseover":case"mouseout":pi=null;break;case"pointerover":case"pointerout":ss.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ls.delete(t.pointerId)}}function po(e,t,n,i,r,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},t!==null&&(t=Bs(t),t!==null&&Zc(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,r!==null&&t.indexOf(r)===-1&&t.push(r),e)}function O1(e,t,n,i,r){switch(t){case"focusin":return ci=po(ci,e,t,n,i,r),!0;case"dragenter":return di=po(di,e,t,n,i,r),!0;case"mouseover":return pi=po(pi,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return ss.set(o,po(ss.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,ls.set(o,po(ls.get(o)||null,e,t,n,i,r)),!0}return!1}function Jm(e){var t=Di(e.target);if(t!==null){var n=rr(t);if(n!==null){if(t=n.tag,t===13){if(t=Vm(n),t!==null){e.blockedOn=t,Zm(e.priority,function(){Km(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function El(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=ch(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var i=new n.constructor(n.type,n);oh=i,n.target.dispatchEvent(i),oh=null}else return t=Bs(n),t!==null&&Zc(t),e.blockedOn=n,!1;t.shift()}return!0}function Bp(e,t,n){El(e)&&n.delete(t)}function B1(){hh=!1,ci!==null&&El(ci)&&(ci=null),di!==null&&El(di)&&(di=null),pi!==null&&El(pi)&&(pi=null),ss.forEach(Bp),ls.forEach(Bp)}function fo(e,t){e.blockedOn===t&&(e.blockedOn=null,hh||(hh=!0,Jt.unstable_scheduleCallback(Jt.unstable_NormalPriority,B1)))}function as(e){function t(r){return fo(r,e)}if(0<tl.length){fo(tl[0],e);for(var n=1;n<tl.length;n++){var i=tl[n];i.blockedOn===e&&(i.blockedOn=null)}}for(ci!==null&&fo(ci,e),di!==null&&fo(di,e),pi!==null&&fo(pi,e),ss.forEach(t),ls.forEach(t),n=0;n<ri.length;n++)i=ri[n],i.blockedOn===e&&(i.blockedOn=null);for(;0<ri.length&&(n=ri[0],n.blockedOn===null);)Jm(n),n.blockedOn===null&&ri.shift()}var Br=Zn.ReactCurrentBatchConfig,ql=!0;function _1(e,t,n,i){var r=Ee,o=Br.transition;Br.transition=null;try{Ee=1,Jc(e,t,n,i)}finally{Ee=r,Br.transition=o}}function M1(e,t,n,i){var r=Ee,o=Br.transition;Br.transition=null;try{Ee=4,Jc(e,t,n,i)}finally{Ee=r,Br.transition=o}}function Jc(e,t,n,i){if(ql){var r=ch(e,t,n,i);if(r===null)yu(e,t,i,Kl,n),Op(e,i);else if(O1(r,e,t,n,i))i.stopPropagation();else if(Op(e,i),t&4&&-1<F1.indexOf(e)){for(;r!==null;){var o=Bs(r);if(o!==null&&qm(o),o=ch(e,t,n,i),o===null&&yu(e,t,i,Kl,n),o===r)break;r=o}r!==null&&i.stopPropagation()}else yu(e,t,i,null,n)}}var Kl=null;function ch(e,t,n,i){if(Kl=null,e=qc(i),e=Di(e),e!==null)if(t=rr(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Vm(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kl=e,null}function ev(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(k1()){case Kc:return 1;case Gm:return 4;case Xl:case E1:return 16;case jm:return 536870912;default:return 16}default:return 16}}var si=null,ed=null,Pl=null;function tv(){if(Pl)return Pl;var e,t=ed,n=t.length,i,r="value"in si?si.value:si.textContent,o=r.length;for(e=0;e<n&&t[e]===r[e];e++);var s=n-e;for(i=1;i<=s&&t[n-i]===r[o-i];i++);return Pl=r.slice(e,1<i?1-i:void 0)}function Nl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function nl(){return!0}function _p(){return!1}function tn(e){function t(n,i,r,o,s){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(n=e[l],this[l]=n?n(o):o[l]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?nl:_p,this.isPropagationStopped=_p,this}return We(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=nl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=nl)},persist:function(){},isPersistent:nl}),t}var to={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=tn(to),Os=We({},to,{view:0,detail:0}),z1=tn(Os),hu,cu,go,Aa=We({},Os,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nd,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==go&&(go&&e.type==="mousemove"?(hu=e.screenX-go.screenX,cu=e.screenY-go.screenY):cu=hu=0,go=e),hu)},movementY:function(e){return"movementY"in e?e.movementY:cu}}),Mp=tn(Aa),$1=We({},Aa,{dataTransfer:0}),D1=tn($1),V1=We({},Os,{relatedTarget:0}),du=tn(V1),U1=We({},to,{animationName:0,elapsedTime:0,pseudoElement:0}),H1=tn(U1),W1=We({},to,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),G1=tn(W1),j1=We({},to,{data:0}),zp=tn(j1),X1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Y1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},q1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function K1(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=q1[e])?!!t[e]:!1}function nd(){return K1}var Q1=We({},Os,{key:function(e){if(e.key){var t=X1[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Nl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Y1[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nd,charCode:function(e){return e.type==="keypress"?Nl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Nl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Z1=tn(Q1),J1=We({},Aa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$p=tn(J1),eb=We({},Os,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nd}),tb=tn(eb),nb=We({},to,{propertyName:0,elapsedTime:0,pseudoElement:0}),ib=tn(nb),rb=We({},Aa,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),ob=tn(rb),sb=[9,13,27,32],id=Hn&&"CompositionEvent"in window,zo=null;Hn&&"documentMode"in document&&(zo=document.documentMode);var lb=Hn&&"TextEvent"in window&&!zo,nv=Hn&&(!id||zo&&8<zo&&11>=zo),Dp=" ",Vp=!1;function iv(e,t){switch(e){case"keyup":return sb.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function rv(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var mr=!1;function ab(e,t){switch(e){case"compositionend":return rv(t);case"keypress":return t.which!==32?null:(Vp=!0,Dp);case"textInput":return e=t.data,e===Dp&&Vp?null:e;default:return null}}function ub(e,t){if(mr)return e==="compositionend"||!id&&iv(e,t)?(e=tv(),Pl=ed=si=null,mr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return nv&&t.locale!=="ko"?null:t.data;default:return null}}var hb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Up(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!hb[e.type]:t==="textarea"}function ov(e,t,n,i){_m(i),t=Ql(t,"onChange"),0<t.length&&(n=new td("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var $o=null,us=null;function cb(e){mv(e,0)}function La(e){var t=yr(e);if(Im(t))return e}function db(e,t){if(e==="change")return t}var sv=!1;if(Hn){var pu;if(Hn){var fu="oninput"in document;if(!fu){var Hp=document.createElement("div");Hp.setAttribute("oninput","return;"),fu=typeof Hp.oninput=="function"}pu=fu}else pu=!1;sv=pu&&(!document.documentMode||9<document.documentMode)}function Wp(){$o&&($o.detachEvent("onpropertychange",lv),us=$o=null)}function lv(e){if(e.propertyName==="value"&&La(us)){var t=[];ov(t,us,e,qc(e)),Dm(cb,t)}}function pb(e,t,n){e==="focusin"?(Wp(),$o=t,us=n,$o.attachEvent("onpropertychange",lv)):e==="focusout"&&Wp()}function fb(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return La(us)}function gb(e,t){if(e==="click")return La(t)}function mb(e,t){if(e==="input"||e==="change")return La(t)}function vb(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Cn=typeof Object.is=="function"?Object.is:vb;function hs(e,t){if(Cn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!Xu.call(t,r)||!Cn(e[r],t[r]))return!1}return!0}function Gp(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function jp(e,t){var n=Gp(e);e=0;for(var i;n;){if(n.nodeType===3){if(i=e+n.textContent.length,e<=t&&i>=t)return{node:n,offset:t-e};e=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Gp(n)}}function av(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?av(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function uv(){for(var e=window,t=Wl();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Wl(e.document)}return t}function rd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function wb(e){var t=uv(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&av(n.ownerDocument.documentElement,n)){if(i!==null&&rd(n)){if(t=i.start,e=i.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(i.start,r);i=i.end===void 0?o:Math.min(i.end,r),!e.extend&&o>i&&(r=i,i=o,o=r),r=jp(n,o);var s=jp(n,i);r&&s&&(e.rangeCount!==1||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&(t=t.createRange(),t.setStart(r.node,r.offset),e.removeAllRanges(),o>i?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var yb=Hn&&"documentMode"in document&&11>=document.documentMode,vr=null,dh=null,Do=null,ph=!1;function Xp(e,t,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ph||vr==null||vr!==Wl(i)||(i=vr,"selectionStart"in i&&rd(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Do&&hs(Do,i)||(Do=i,i=Ql(dh,"onSelect"),0<i.length&&(t=new td("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=vr)))}function il(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wr={animationend:il("Animation","AnimationEnd"),animationiteration:il("Animation","AnimationIteration"),animationstart:il("Animation","AnimationStart"),transitionend:il("Transition","TransitionEnd")},gu={},hv={};Hn&&(hv=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);function Fa(e){if(gu[e])return gu[e];if(!wr[e])return e;var t=wr[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in hv)return gu[e]=t[n];return e}var cv=Fa("animationend"),dv=Fa("animationiteration"),pv=Fa("animationstart"),fv=Fa("transitionend"),gv=new Map,Yp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ti(e,t){gv.set(e,t),ir(t,[e])}for(var mu=0;mu<Yp.length;mu++){var vu=Yp[mu],xb=vu.toLowerCase(),bb=vu[0].toUpperCase()+vu.slice(1);Ti(xb,"on"+bb)}Ti(cv,"onAnimationEnd");Ti(dv,"onAnimationIteration");Ti(pv,"onAnimationStart");Ti("dblclick","onDoubleClick");Ti("focusin","onFocus");Ti("focusout","onBlur");Ti(fv,"onTransitionEnd");Ur("onMouseEnter",["mouseout","mouseover"]);Ur("onMouseLeave",["mouseout","mouseover"]);Ur("onPointerEnter",["pointerout","pointerover"]);Ur("onPointerLeave",["pointerout","pointerover"]);ir("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ir("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ir("onBeforeInput",["compositionend","keypress","textInput","paste"]);ir("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ir("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ir("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var No="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Sb=new Set("cancel close invalid load scroll toggle".split(" ").concat(No));function qp(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,x1(i,t,void 0,e),e.currentTarget=null}function mv(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var s=i.length-1;0<=s;s--){var l=i[s],a=l.instance,u=l.currentTarget;if(l=l.listener,a!==o&&r.isPropagationStopped())break e;qp(r,l,u),o=a}else for(s=0;s<i.length;s++){if(l=i[s],a=l.instance,u=l.currentTarget,l=l.listener,a!==o&&r.isPropagationStopped())break e;qp(r,l,u),o=a}}}if(jl)throw e=ah,jl=!1,ah=null,e}function Le(e,t){var n=t[wh];n===void 0&&(n=t[wh]=new Set);var i=e+"__bubble";n.has(i)||(vv(t,e,2,!1),n.add(i))}function wu(e,t,n){var i=0;t&&(i|=4),vv(n,e,i,t)}var rl="_reactListening"+Math.random().toString(36).slice(2);function cs(e){if(!e[rl]){e[rl]=!0,km.forEach(function(n){n!=="selectionchange"&&(Sb.has(n)||wu(n,!1,e),wu(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[rl]||(t[rl]=!0,wu("selectionchange",!1,t))}}function vv(e,t,n,i){switch(ev(t)){case 1:var r=_1;break;case 4:r=M1;break;default:r=Jc}n=r.bind(null,t,n,e),r=void 0,!lh||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(r=!0),i?r!==void 0?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):r!==void 0?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function yu(e,t,n,i,r){var o=i;if(!(t&1)&&!(t&2)&&i!==null)e:for(;;){if(i===null)return;var s=i.tag;if(s===3||s===4){var l=i.stateNode.containerInfo;if(l===r||l.nodeType===8&&l.parentNode===r)break;if(s===4)for(s=i.return;s!==null;){var a=s.tag;if((a===3||a===4)&&(a=s.stateNode.containerInfo,a===r||a.nodeType===8&&a.parentNode===r))return;s=s.return}for(;l!==null;){if(s=Di(l),s===null)return;if(a=s.tag,a===5||a===6){i=o=s;continue e}l=l.parentNode}}i=i.return}Dm(function(){var u=o,h=qc(n),p=[];e:{var c=gv.get(e);if(c!==void 0){var f=td,v=e;switch(e){case"keypress":if(Nl(n)===0)break e;case"keydown":case"keyup":f=Z1;break;case"focusin":v="focus",f=du;break;case"focusout":v="blur",f=du;break;case"beforeblur":case"afterblur":f=du;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=Mp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=D1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=tb;break;case cv:case dv:case pv:f=H1;break;case fv:f=ib;break;case"scroll":f=z1;break;case"wheel":f=ob;break;case"copy":case"cut":case"paste":f=G1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=$p}var w=(t&4)!==0,y=!w&&e==="scroll",g=w?c!==null?c+"Capture":null:c;w=[];for(var m=u,x;m!==null;){x=m;var C=x.stateNode;if(x.tag===5&&C!==null&&(x=C,g!==null&&(C=os(m,g),C!=null&&w.push(ds(m,C,x)))),y)break;m=m.return}0<w.length&&(c=new f(c,v,null,n,h),p.push({event:c,listeners:w}))}}if(!(t&7)){e:{if(c=e==="mouseover"||e==="pointerover",f=e==="mouseout"||e==="pointerout",c&&n!==oh&&(v=n.relatedTarget||n.fromElement)&&(Di(v)||v[Wn]))break e;if((f||c)&&(c=h.window===h?h:(c=h.ownerDocument)?c.defaultView||c.parentWindow:window,f?(v=n.relatedTarget||n.toElement,f=u,v=v?Di(v):null,v!==null&&(y=rr(v),v!==y||v.tag!==5&&v.tag!==6)&&(v=null)):(f=null,v=u),f!==v)){if(w=Mp,C="onMouseLeave",g="onMouseEnter",m="mouse",(e==="pointerout"||e==="pointerover")&&(w=$p,C="onPointerLeave",g="onPointerEnter",m="pointer"),y=f==null?c:yr(f),x=v==null?c:yr(v),c=new w(C,m+"leave",f,n,h),c.target=y,c.relatedTarget=x,C=null,Di(h)===u&&(w=new w(g,m+"enter",v,n,h),w.target=x,w.relatedTarget=y,C=w),y=C,f&&v)t:{for(w=f,g=v,m=0,x=w;x;x=sr(x))m++;for(x=0,C=g;C;C=sr(C))x++;for(;0<m-x;)w=sr(w),m--;for(;0<x-m;)g=sr(g),x--;for(;m--;){if(w===g||g!==null&&w===g.alternate)break t;w=sr(w),g=sr(g)}w=null}else w=null;f!==null&&Kp(p,c,f,w,!1),v!==null&&y!==null&&Kp(p,y,v,w,!0)}}e:{if(c=u?yr(u):window,f=c.nodeName&&c.nodeName.toLowerCase(),f==="select"||f==="input"&&c.type==="file")var N=db;else if(Up(c))if(sv)N=mb;else{N=fb;var A=pb}else(f=c.nodeName)&&f.toLowerCase()==="input"&&(c.type==="checkbox"||c.type==="radio")&&(N=gb);if(N&&(N=N(e,u))){ov(p,N,n,h);break e}A&&A(e,c,u),e==="focusout"&&(A=c._wrapperState)&&A.controlled&&c.type==="number"&&eh(c,"number",c.value)}switch(A=u?yr(u):window,e){case"focusin":(Up(A)||A.contentEditable==="true")&&(vr=A,dh=u,Do=null);break;case"focusout":Do=dh=vr=null;break;case"mousedown":ph=!0;break;case"contextmenu":case"mouseup":case"dragend":ph=!1,Xp(p,n,h);break;case"selectionchange":if(yb)break;case"keydown":case"keyup":Xp(p,n,h)}var L;if(id)e:{switch(e){case"compositionstart":var z="onCompositionStart";break e;case"compositionend":z="onCompositionEnd";break e;case"compositionupdate":z="onCompositionUpdate";break e}z=void 0}else mr?iv(e,n)&&(z="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(z="onCompositionStart");z&&(nv&&n.locale!=="ko"&&(mr||z!=="onCompositionStart"?z==="onCompositionEnd"&&mr&&(L=tv()):(si=h,ed="value"in si?si.value:si.textContent,mr=!0)),A=Ql(u,z),0<A.length&&(z=new zp(z,e,null,n,h),p.push({event:z,listeners:A}),L?z.data=L:(L=rv(n),L!==null&&(z.data=L)))),(L=lb?ab(e,n):ub(e,n))&&(u=Ql(u,"onBeforeInput"),0<u.length&&(h=new zp("onBeforeInput","beforeinput",null,n,h),p.push({event:h,listeners:u}),h.data=L))}mv(p,t)})}function ds(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Ql(e,t){for(var n=t+"Capture",i=[];e!==null;){var r=e,o=r.stateNode;r.tag===5&&o!==null&&(r=o,o=os(e,n),o!=null&&i.unshift(ds(e,o,r)),o=os(e,t),o!=null&&i.push(ds(e,o,r))),e=e.return}return i}function sr(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Kp(e,t,n,i,r){for(var o=t._reactName,s=[];n!==null&&n!==i;){var l=n,a=l.alternate,u=l.stateNode;if(a!==null&&a===i)break;l.tag===5&&u!==null&&(l=u,r?(a=os(n,o),a!=null&&s.unshift(ds(n,a,l))):r||(a=os(n,o),a!=null&&s.push(ds(n,a,l)))),n=n.return}s.length!==0&&e.push({event:t,listeners:s})}var Cb=/\r\n?/g,kb=/\u0000|\uFFFD/g;function Qp(e){return(typeof e=="string"?e:""+e).replace(Cb,`
`).replace(kb,"")}function ol(e,t,n){if(t=Qp(t),Qp(e)!==t&&n)throw Error(J(425))}function Zl(){}var fh=null,gh=null;function mh(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var vh=typeof setTimeout=="function"?setTimeout:void 0,Eb=typeof clearTimeout=="function"?clearTimeout:void 0,Zp=typeof Promise=="function"?Promise:void 0,Pb=typeof queueMicrotask=="function"?queueMicrotask:typeof Zp<"u"?function(e){return Zp.resolve(null).then(e).catch(Nb)}:vh;function Nb(e){setTimeout(function(){throw e})}function xu(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){e.removeChild(r),as(t);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);as(t)}function fi(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Jp(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var no=Math.random().toString(36).slice(2),In="__reactFiber$"+no,ps="__reactProps$"+no,Wn="__reactContainer$"+no,wh="__reactEvents$"+no,Tb="__reactListeners$"+no,Ib="__reactHandles$"+no;function Di(e){var t=e[In];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Wn]||n[In]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Jp(e);e!==null;){if(n=e[In])return n;e=Jp(e)}return t}e=n,n=e.parentNode}return null}function Bs(e){return e=e[In]||e[Wn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function yr(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(J(33))}function Oa(e){return e[ps]||null}var yh=[],xr=-1;function Ii(e){return{current:e}}function Fe(e){0>xr||(e.current=yh[xr],yh[xr]=null,xr--)}function Re(e,t){xr++,yh[xr]=e.current,e.current=t}var Si={},At=Ii(Si),Wt=Ii(!1),Ki=Si;function Hr(e,t){var n=e.type.contextTypes;if(!n)return Si;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r={},o;for(o in n)r[o]=t[o];return i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function Gt(e){return e=e.childContextTypes,e!=null}function Jl(){Fe(Wt),Fe(At)}function ef(e,t,n){if(At.current!==Si)throw Error(J(168));Re(At,t),Re(Wt,n)}function wv(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in t))throw Error(J(108,p1(e)||"Unknown",r));return We({},n,i)}function ea(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Si,Ki=At.current,Re(At,e),Re(Wt,Wt.current),!0}function tf(e,t,n){var i=e.stateNode;if(!i)throw Error(J(169));n?(e=wv(e,t,Ki),i.__reactInternalMemoizedMergedChildContext=e,Fe(Wt),Fe(At),Re(At,e)):Fe(Wt),Re(Wt,n)}var _n=null,Ba=!1,bu=!1;function yv(e){_n===null?_n=[e]:_n.push(e)}function Rb(e){Ba=!0,yv(e)}function Ri(){if(!bu&&_n!==null){bu=!0;var e=0,t=Ee;try{var n=_n;for(Ee=1;e<n.length;e++){var i=n[e];do i=i(!0);while(i!==null)}_n=null,Ba=!1}catch(r){throw _n!==null&&(_n=_n.slice(e+1)),Wm(Kc,Ri),r}finally{Ee=t,bu=!1}}return null}var br=[],Sr=0,ta=null,na=0,on=[],sn=0,Qi=null,zn=1,$n="";function Mi(e,t){br[Sr++]=na,br[Sr++]=ta,ta=e,na=t}function xv(e,t,n){on[sn++]=zn,on[sn++]=$n,on[sn++]=Qi,Qi=e;var i=zn;e=$n;var r=32-xn(i)-1;i&=~(1<<r),n+=1;var o=32-xn(t)+r;if(30<o){var s=r-r%5;o=(i&(1<<s)-1).toString(32),i>>=s,r-=s,zn=1<<32-xn(t)+r|n<<r|i,$n=o+e}else zn=1<<o|n<<r|i,$n=e}function od(e){e.return!==null&&(Mi(e,1),xv(e,1,0))}function sd(e){for(;e===ta;)ta=br[--Sr],br[Sr]=null,na=br[--Sr],br[Sr]=null;for(;e===Qi;)Qi=on[--sn],on[sn]=null,$n=on[--sn],on[sn]=null,zn=on[--sn],on[sn]=null}var Zt=null,Kt=null,Oe=!1,vn=null;function bv(e,t){var n=ln(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function nf(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Zt=e,Kt=fi(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Zt=e,Kt=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Qi!==null?{id:zn,overflow:$n}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=ln(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,Zt=e,Kt=null,!0):!1;default:return!1}}function xh(e){return(e.mode&1)!==0&&(e.flags&128)===0}function bh(e){if(Oe){var t=Kt;if(t){var n=t;if(!nf(e,t)){if(xh(e))throw Error(J(418));t=fi(n.nextSibling);var i=Zt;t&&nf(e,t)?bv(i,n):(e.flags=e.flags&-4097|2,Oe=!1,Zt=e)}}else{if(xh(e))throw Error(J(418));e.flags=e.flags&-4097|2,Oe=!1,Zt=e}}}function rf(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Zt=e}function sl(e){if(e!==Zt)return!1;if(!Oe)return rf(e),Oe=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!mh(e.type,e.memoizedProps)),t&&(t=Kt)){if(xh(e))throw Sv(),Error(J(418));for(;t;)bv(e,t),t=fi(t.nextSibling)}if(rf(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(J(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Kt=fi(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Kt=null}}else Kt=Zt?fi(e.stateNode.nextSibling):null;return!0}function Sv(){for(var e=Kt;e;)e=fi(e.nextSibling)}function Wr(){Kt=Zt=null,Oe=!1}function ld(e){vn===null?vn=[e]:vn.push(e)}var Ab=Zn.ReactCurrentBatchConfig;function mo(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(J(309));var i=n.stateNode}if(!i)throw Error(J(147,e));var r=i,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(s){var l=r.refs;s===null?delete l[o]:l[o]=s},t._stringRef=o,t)}if(typeof e!="string")throw Error(J(284));if(!n._owner)throw Error(J(290,e))}return e}function ll(e,t){throw e=Object.prototype.toString.call(t),Error(J(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function of(e){var t=e._init;return t(e._payload)}function Cv(e){function t(g,m){if(e){var x=g.deletions;x===null?(g.deletions=[m],g.flags|=16):x.push(m)}}function n(g,m){if(!e)return null;for(;m!==null;)t(g,m),m=m.sibling;return null}function i(g,m){for(g=new Map;m!==null;)m.key!==null?g.set(m.key,m):g.set(m.index,m),m=m.sibling;return g}function r(g,m){return g=wi(g,m),g.index=0,g.sibling=null,g}function o(g,m,x){return g.index=x,e?(x=g.alternate,x!==null?(x=x.index,x<m?(g.flags|=2,m):x):(g.flags|=2,m)):(g.flags|=1048576,m)}function s(g){return e&&g.alternate===null&&(g.flags|=2),g}function l(g,m,x,C){return m===null||m.tag!==6?(m=Tu(x,g.mode,C),m.return=g,m):(m=r(m,x),m.return=g,m)}function a(g,m,x,C){var N=x.type;return N===gr?h(g,m,x.props.children,C,x.key):m!==null&&(m.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===ni&&of(N)===m.type)?(C=r(m,x.props),C.ref=mo(g,m,x),C.return=g,C):(C=Ol(x.type,x.key,x.props,null,g.mode,C),C.ref=mo(g,m,x),C.return=g,C)}function u(g,m,x,C){return m===null||m.tag!==4||m.stateNode.containerInfo!==x.containerInfo||m.stateNode.implementation!==x.implementation?(m=Iu(x,g.mode,C),m.return=g,m):(m=r(m,x.children||[]),m.return=g,m)}function h(g,m,x,C,N){return m===null||m.tag!==7?(m=ji(x,g.mode,C,N),m.return=g,m):(m=r(m,x),m.return=g,m)}function p(g,m,x){if(typeof m=="string"&&m!==""||typeof m=="number")return m=Tu(""+m,g.mode,x),m.return=g,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case Ks:return x=Ol(m.type,m.key,m.props,null,g.mode,x),x.ref=mo(g,null,m),x.return=g,x;case fr:return m=Iu(m,g.mode,x),m.return=g,m;case ni:var C=m._init;return p(g,C(m._payload),x)}if(Eo(m)||ho(m))return m=ji(m,g.mode,x,null),m.return=g,m;ll(g,m)}return null}function c(g,m,x,C){var N=m!==null?m.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return N!==null?null:l(g,m,""+x,C);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Ks:return x.key===N?a(g,m,x,C):null;case fr:return x.key===N?u(g,m,x,C):null;case ni:return N=x._init,c(g,m,N(x._payload),C)}if(Eo(x)||ho(x))return N!==null?null:h(g,m,x,C,null);ll(g,x)}return null}function f(g,m,x,C,N){if(typeof C=="string"&&C!==""||typeof C=="number")return g=g.get(x)||null,l(m,g,""+C,N);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Ks:return g=g.get(C.key===null?x:C.key)||null,a(m,g,C,N);case fr:return g=g.get(C.key===null?x:C.key)||null,u(m,g,C,N);case ni:var A=C._init;return f(g,m,x,A(C._payload),N)}if(Eo(C)||ho(C))return g=g.get(x)||null,h(m,g,C,N,null);ll(m,C)}return null}function v(g,m,x,C){for(var N=null,A=null,L=m,z=m=0,q=null;L!==null&&z<x.length;z++){L.index>z?(q=L,L=null):q=L.sibling;var Q=c(g,L,x[z],C);if(Q===null){L===null&&(L=q);break}e&&L&&Q.alternate===null&&t(g,L),m=o(Q,m,z),A===null?N=Q:A.sibling=Q,A=Q,L=q}if(z===x.length)return n(g,L),Oe&&Mi(g,z),N;if(L===null){for(;z<x.length;z++)L=p(g,x[z],C),L!==null&&(m=o(L,m,z),A===null?N=L:A.sibling=L,A=L);return Oe&&Mi(g,z),N}for(L=i(g,L);z<x.length;z++)q=f(L,g,z,x[z],C),q!==null&&(e&&q.alternate!==null&&L.delete(q.key===null?z:q.key),m=o(q,m,z),A===null?N=q:A.sibling=q,A=q);return e&&L.forEach(function(D){return t(g,D)}),Oe&&Mi(g,z),N}function w(g,m,x,C){var N=ho(x);if(typeof N!="function")throw Error(J(150));if(x=N.call(x),x==null)throw Error(J(151));for(var A=N=null,L=m,z=m=0,q=null,Q=x.next();L!==null&&!Q.done;z++,Q=x.next()){L.index>z?(q=L,L=null):q=L.sibling;var D=c(g,L,Q.value,C);if(D===null){L===null&&(L=q);break}e&&L&&D.alternate===null&&t(g,L),m=o(D,m,z),A===null?N=D:A.sibling=D,A=D,L=q}if(Q.done)return n(g,L),Oe&&Mi(g,z),N;if(L===null){for(;!Q.done;z++,Q=x.next())Q=p(g,Q.value,C),Q!==null&&(m=o(Q,m,z),A===null?N=Q:A.sibling=Q,A=Q);return Oe&&Mi(g,z),N}for(L=i(g,L);!Q.done;z++,Q=x.next())Q=f(L,g,z,Q.value,C),Q!==null&&(e&&Q.alternate!==null&&L.delete(Q.key===null?z:Q.key),m=o(Q,m,z),A===null?N=Q:A.sibling=Q,A=Q);return e&&L.forEach(function(Z){return t(g,Z)}),Oe&&Mi(g,z),N}function y(g,m,x,C){if(typeof x=="object"&&x!==null&&x.type===gr&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case Ks:e:{for(var N=x.key,A=m;A!==null;){if(A.key===N){if(N=x.type,N===gr){if(A.tag===7){n(g,A.sibling),m=r(A,x.props.children),m.return=g,g=m;break e}}else if(A.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===ni&&of(N)===A.type){n(g,A.sibling),m=r(A,x.props),m.ref=mo(g,A,x),m.return=g,g=m;break e}n(g,A);break}else t(g,A);A=A.sibling}x.type===gr?(m=ji(x.props.children,g.mode,C,x.key),m.return=g,g=m):(C=Ol(x.type,x.key,x.props,null,g.mode,C),C.ref=mo(g,m,x),C.return=g,g=C)}return s(g);case fr:e:{for(A=x.key;m!==null;){if(m.key===A)if(m.tag===4&&m.stateNode.containerInfo===x.containerInfo&&m.stateNode.implementation===x.implementation){n(g,m.sibling),m=r(m,x.children||[]),m.return=g,g=m;break e}else{n(g,m);break}else t(g,m);m=m.sibling}m=Iu(x,g.mode,C),m.return=g,g=m}return s(g);case ni:return A=x._init,y(g,m,A(x._payload),C)}if(Eo(x))return v(g,m,x,C);if(ho(x))return w(g,m,x,C);ll(g,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,m!==null&&m.tag===6?(n(g,m.sibling),m=r(m,x),m.return=g,g=m):(n(g,m),m=Tu(x,g.mode,C),m.return=g,g=m),s(g)):n(g,m)}return y}var Gr=Cv(!0),kv=Cv(!1),ia=Ii(null),ra=null,Cr=null,ad=null;function ud(){ad=Cr=ra=null}function hd(e){var t=ia.current;Fe(ia),e._currentValue=t}function Sh(e,t,n){for(;e!==null;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,i!==null&&(i.childLanes|=t)):i!==null&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function _r(e,t){ra=e,ad=Cr=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Ht=!0),e.firstContext=null)}function cn(e){var t=e._currentValue;if(ad!==e)if(e={context:e,memoizedValue:t,next:null},Cr===null){if(ra===null)throw Error(J(308));Cr=e,ra.dependencies={lanes:0,firstContext:e}}else Cr=Cr.next=e;return t}var Vi=null;function cd(e){Vi===null?Vi=[e]:Vi.push(e)}function Ev(e,t,n,i){var r=t.interleaved;return r===null?(n.next=n,cd(t)):(n.next=r.next,r.next=n),t.interleaved=n,Gn(e,i)}function Gn(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var ii=!1;function dd(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Pv(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Un(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function gi(e,t,n){var i=e.updateQueue;if(i===null)return null;if(i=i.shared,be&2){var r=i.pending;return r===null?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Gn(e,n)}return r=i.interleaved,r===null?(t.next=t,cd(i)):(t.next=r.next,r.next=t),i.interleaved=t,Gn(e,n)}function Tl(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var i=t.lanes;i&=e.pendingLanes,n|=i,t.lanes=n,Qc(e,n)}}function sf(e,t){var n=e.updateQueue,i=e.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?r=o=s:o=o.next=s,n=n.next}while(n!==null);o===null?r=o=t:o=o.next=t}else r=o=t;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function oa(e,t,n,i){var r=e.updateQueue;ii=!1;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,l=r.shared.pending;if(l!==null){r.shared.pending=null;var a=l,u=a.next;a.next=null,s===null?o=u:s.next=u,s=a;var h=e.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==s&&(l===null?h.firstBaseUpdate=u:l.next=u,h.lastBaseUpdate=a))}if(o!==null){var p=r.baseState;s=0,h=u=a=null,l=o;do{var c=l.lane,f=l.eventTime;if((i&c)===c){h!==null&&(h=h.next={eventTime:f,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var v=e,w=l;switch(c=t,f=n,w.tag){case 1:if(v=w.payload,typeof v=="function"){p=v.call(f,p,c);break e}p=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=w.payload,c=typeof v=="function"?v.call(f,p,c):v,c==null)break e;p=We({},p,c);break e;case 2:ii=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,c=r.effects,c===null?r.effects=[l]:c.push(l))}else f={eventTime:f,lane:c,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(u=h=f,a=p):h=h.next=f,s|=c;if(l=l.next,l===null){if(l=r.shared.pending,l===null)break;c=l,l=c.next,c.next=null,r.lastBaseUpdate=c,r.shared.pending=null}}while(!0);if(h===null&&(a=p),r.baseState=a,r.firstBaseUpdate=u,r.lastBaseUpdate=h,t=r.shared.interleaved,t!==null){r=t;do s|=r.lane,r=r.next;while(r!==t)}else o===null&&(r.shared.lanes=0);Ji|=s,e.lanes=s,e.memoizedState=p}}function lf(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(J(191,r));r.call(i)}}}var _s={},Ln=Ii(_s),fs=Ii(_s),gs=Ii(_s);function Ui(e){if(e===_s)throw Error(J(174));return e}function pd(e,t){switch(Re(gs,t),Re(fs,e),Re(Ln,_s),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:nh(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=nh(t,e)}Fe(Ln),Re(Ln,t)}function jr(){Fe(Ln),Fe(fs),Fe(gs)}function Nv(e){Ui(gs.current);var t=Ui(Ln.current),n=nh(t,e.type);t!==n&&(Re(fs,e),Re(Ln,n))}function fd(e){fs.current===e&&(Fe(Ln),Fe(fs))}var Ve=Ii(0);function sa(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Su=[];function gd(){for(var e=0;e<Su.length;e++)Su[e]._workInProgressVersionPrimary=null;Su.length=0}var Il=Zn.ReactCurrentDispatcher,Cu=Zn.ReactCurrentBatchConfig,Zi=0,He=null,dt=null,gt=null,la=!1,Vo=!1,ms=0,Lb=0;function St(){throw Error(J(321))}function md(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Cn(e[n],t[n]))return!1;return!0}function vd(e,t,n,i,r,o){if(Zi=o,He=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Il.current=e===null||e.memoizedState===null?_b:Mb,e=n(i,r),Vo){o=0;do{if(Vo=!1,ms=0,25<=o)throw Error(J(301));o+=1,gt=dt=null,t.updateQueue=null,Il.current=zb,e=n(i,r)}while(Vo)}if(Il.current=aa,t=dt!==null&&dt.next!==null,Zi=0,gt=dt=He=null,la=!1,t)throw Error(J(300));return e}function wd(){var e=ms!==0;return ms=0,e}function Pn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gt===null?He.memoizedState=gt=e:gt=gt.next=e,gt}function dn(){if(dt===null){var e=He.alternate;e=e!==null?e.memoizedState:null}else e=dt.next;var t=gt===null?He.memoizedState:gt.next;if(t!==null)gt=t,dt=e;else{if(e===null)throw Error(J(310));dt=e,e={memoizedState:dt.memoizedState,baseState:dt.baseState,baseQueue:dt.baseQueue,queue:dt.queue,next:null},gt===null?He.memoizedState=gt=e:gt=gt.next=e}return gt}function vs(e,t){return typeof t=="function"?t(e):t}function ku(e){var t=dn(),n=t.queue;if(n===null)throw Error(J(311));n.lastRenderedReducer=e;var i=dt,r=i.baseQueue,o=n.pending;if(o!==null){if(r!==null){var s=r.next;r.next=o.next,o.next=s}i.baseQueue=r=o,n.pending=null}if(r!==null){o=r.next,i=i.baseState;var l=s=null,a=null,u=o;do{var h=u.lane;if((Zi&h)===h)a!==null&&(a=a.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var p={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};a===null?(l=a=p,s=i):a=a.next=p,He.lanes|=h,Ji|=h}u=u.next}while(u!==null&&u!==o);a===null?s=i:a.next=l,Cn(i,t.memoizedState)||(Ht=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=a,n.lastRenderedState=i}if(e=n.interleaved,e!==null){r=e;do o=r.lane,He.lanes|=o,Ji|=o,r=r.next;while(r!==e)}else r===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Eu(e){var t=dn(),n=t.queue;if(n===null)throw Error(J(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,o=t.memoizedState;if(r!==null){n.pending=null;var s=r=r.next;do o=e(o,s.action),s=s.next;while(s!==r);Cn(o,t.memoizedState)||(Ht=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function Tv(){}function Iv(e,t){var n=He,i=dn(),r=t(),o=!Cn(i.memoizedState,r);if(o&&(i.memoizedState=r,Ht=!0),i=i.queue,yd(Lv.bind(null,n,i,e),[e]),i.getSnapshot!==t||o||gt!==null&&gt.memoizedState.tag&1){if(n.flags|=2048,ws(9,Av.bind(null,n,i,r,t),void 0,null),mt===null)throw Error(J(349));Zi&30||Rv(n,t,r)}return r}function Rv(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=He.updateQueue,t===null?(t={lastEffect:null,stores:null},He.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Av(e,t,n,i){t.value=n,t.getSnapshot=i,Fv(t)&&Ov(e)}function Lv(e,t,n){return n(function(){Fv(t)&&Ov(e)})}function Fv(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Cn(e,n)}catch{return!0}}function Ov(e){var t=Gn(e,1);t!==null&&bn(t,e,1,-1)}function af(e){var t=Pn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:vs,lastRenderedState:e},t.queue=e,e=e.dispatch=Bb.bind(null,He,e),[t.memoizedState,e]}function ws(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},t=He.updateQueue,t===null?(t={lastEffect:null,stores:null},He.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e)),e}function Bv(){return dn().memoizedState}function Rl(e,t,n,i){var r=Pn();He.flags|=e,r.memoizedState=ws(1|t,n,void 0,i===void 0?null:i)}function _a(e,t,n,i){var r=dn();i=i===void 0?null:i;var o=void 0;if(dt!==null){var s=dt.memoizedState;if(o=s.destroy,i!==null&&md(i,s.deps)){r.memoizedState=ws(t,n,o,i);return}}He.flags|=e,r.memoizedState=ws(1|t,n,o,i)}function uf(e,t){return Rl(8390656,8,e,t)}function yd(e,t){return _a(2048,8,e,t)}function _v(e,t){return _a(4,2,e,t)}function Mv(e,t){return _a(4,4,e,t)}function zv(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function $v(e,t,n){return n=n!=null?n.concat([e]):null,_a(4,4,zv.bind(null,t,e),n)}function xd(){}function Dv(e,t){var n=dn();t=t===void 0?null:t;var i=n.memoizedState;return i!==null&&t!==null&&md(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Vv(e,t){var n=dn();t=t===void 0?null:t;var i=n.memoizedState;return i!==null&&t!==null&&md(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Uv(e,t,n){return Zi&21?(Cn(n,t)||(n=Xm(),He.lanes|=n,Ji|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Ht=!0),e.memoizedState=n)}function Fb(e,t){var n=Ee;Ee=n!==0&&4>n?n:4,e(!0);var i=Cu.transition;Cu.transition={};try{e(!1),t()}finally{Ee=n,Cu.transition=i}}function Hv(){return dn().memoizedState}function Ob(e,t,n){var i=vi(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Wv(e))Gv(t,n);else if(n=Ev(e,t,n,i),n!==null){var r=Bt();bn(n,e,i,r),jv(n,t,i)}}function Bb(e,t,n){var i=vi(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Wv(e))Gv(t,r);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var s=t.lastRenderedState,l=o(s,n);if(r.hasEagerState=!0,r.eagerState=l,Cn(l,s)){var a=t.interleaved;a===null?(r.next=r,cd(t)):(r.next=a.next,a.next=r),t.interleaved=r;return}}catch{}finally{}n=Ev(e,t,r,i),n!==null&&(r=Bt(),bn(n,e,i,r),jv(n,t,i))}}function Wv(e){var t=e.alternate;return e===He||t!==null&&t===He}function Gv(e,t){Vo=la=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function jv(e,t,n){if(n&4194240){var i=t.lanes;i&=e.pendingLanes,n|=i,t.lanes=n,Qc(e,n)}}var aa={readContext:cn,useCallback:St,useContext:St,useEffect:St,useImperativeHandle:St,useInsertionEffect:St,useLayoutEffect:St,useMemo:St,useReducer:St,useRef:St,useState:St,useDebugValue:St,useDeferredValue:St,useTransition:St,useMutableSource:St,useSyncExternalStore:St,useId:St,unstable_isNewReconciler:!1},_b={readContext:cn,useCallback:function(e,t){return Pn().memoizedState=[e,t===void 0?null:t],e},useContext:cn,useEffect:uf,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Rl(4194308,4,zv.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Rl(4194308,4,e,t)},useInsertionEffect:function(e,t){return Rl(4,2,e,t)},useMemo:function(e,t){var n=Pn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=Pn();return t=n!==void 0?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Ob.bind(null,He,e),[i.memoizedState,e]},useRef:function(e){var t=Pn();return e={current:e},t.memoizedState=e},useState:af,useDebugValue:xd,useDeferredValue:function(e){return Pn().memoizedState=e},useTransition:function(){var e=af(!1),t=e[0];return e=Fb.bind(null,e[1]),Pn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=He,r=Pn();if(Oe){if(n===void 0)throw Error(J(407));n=n()}else{if(n=t(),mt===null)throw Error(J(349));Zi&30||Rv(i,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,uf(Lv.bind(null,i,o,e),[e]),i.flags|=2048,ws(9,Av.bind(null,i,o,n,t),void 0,null),n},useId:function(){var e=Pn(),t=mt.identifierPrefix;if(Oe){var n=$n,i=zn;n=(i&~(1<<32-xn(i)-1)).toString(32)+n,t=":"+t+"R"+n,n=ms++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=Lb++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Mb={readContext:cn,useCallback:Dv,useContext:cn,useEffect:yd,useImperativeHandle:$v,useInsertionEffect:_v,useLayoutEffect:Mv,useMemo:Vv,useReducer:ku,useRef:Bv,useState:function(){return ku(vs)},useDebugValue:xd,useDeferredValue:function(e){var t=dn();return Uv(t,dt.memoizedState,e)},useTransition:function(){var e=ku(vs)[0],t=dn().memoizedState;return[e,t]},useMutableSource:Tv,useSyncExternalStore:Iv,useId:Hv,unstable_isNewReconciler:!1},zb={readContext:cn,useCallback:Dv,useContext:cn,useEffect:yd,useImperativeHandle:$v,useInsertionEffect:_v,useLayoutEffect:Mv,useMemo:Vv,useReducer:Eu,useRef:Bv,useState:function(){return Eu(vs)},useDebugValue:xd,useDeferredValue:function(e){var t=dn();return dt===null?t.memoizedState=e:Uv(t,dt.memoizedState,e)},useTransition:function(){var e=Eu(vs)[0],t=dn().memoizedState;return[e,t]},useMutableSource:Tv,useSyncExternalStore:Iv,useId:Hv,unstable_isNewReconciler:!1};function gn(e,t){if(e&&e.defaultProps){t=We({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Ch(e,t,n,i){t=e.memoizedState,n=n(i,t),n=n==null?t:We({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Ma={isMounted:function(e){return(e=e._reactInternals)?rr(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=Bt(),r=vi(e),o=Un(i,r);o.payload=t,n!=null&&(o.callback=n),t=gi(e,o,r),t!==null&&(bn(t,e,r,i),Tl(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=Bt(),r=vi(e),o=Un(i,r);o.tag=1,o.payload=t,n!=null&&(o.callback=n),t=gi(e,o,r),t!==null&&(bn(t,e,r,i),Tl(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Bt(),i=vi(e),r=Un(n,i);r.tag=2,t!=null&&(r.callback=t),t=gi(e,r,i),t!==null&&(bn(t,e,i,n),Tl(t,e,i))}};function hf(e,t,n,i,r,o,s){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(i,o,s):t.prototype&&t.prototype.isPureReactComponent?!hs(n,i)||!hs(r,o):!0}function Xv(e,t,n){var i=!1,r=Si,o=t.contextType;return typeof o=="object"&&o!==null?o=cn(o):(r=Gt(t)?Ki:At.current,i=t.contextTypes,o=(i=i!=null)?Hr(e,r):Si),t=new t(n,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Ma,e.stateNode=t,t._reactInternals=e,i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function cf(e,t,n,i){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,i),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Ma.enqueueReplaceState(t,t.state,null)}function kh(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},dd(e);var o=t.contextType;typeof o=="object"&&o!==null?r.context=cn(o):(o=Gt(t)?Ki:At.current,r.context=Hr(e,o)),r.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(Ch(e,t,o,n),r.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(t=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),t!==r.state&&Ma.enqueueReplaceState(r,r.state,null),oa(e,n,r,i),r.state=e.memoizedState),typeof r.componentDidMount=="function"&&(e.flags|=4194308)}function Xr(e,t){try{var n="",i=t;do n+=d1(i),i=i.return;while(i);var r=n}catch(o){r=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:r,digest:null}}function Pu(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Eh(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var $b=typeof WeakMap=="function"?WeakMap:Map;function Yv(e,t,n){n=Un(-1,n),n.tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){ha||(ha=!0,Bh=i),Eh(e,t)},n}function qv(e,t,n){n=Un(-1,n),n.tag=3;var i=e.type.getDerivedStateFromError;if(typeof i=="function"){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){Eh(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){Eh(e,t),typeof i!="function"&&(mi===null?mi=new Set([this]):mi.add(this));var s=t.stack;this.componentDidCatch(t.value,{componentStack:s!==null?s:""})}),n}function df(e,t,n){var i=e.pingCache;if(i===null){i=e.pingCache=new $b;var r=new Set;i.set(t,r)}else r=i.get(t),r===void 0&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Jb.bind(null,e,t,n),t.then(e,e))}function pf(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function ff(e,t,n,i,r){return e.mode&1?(e.flags|=65536,e.lanes=r,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Un(-1,1),t.tag=2,gi(n,t,1))),n.lanes|=1),e)}var Db=Zn.ReactCurrentOwner,Ht=!1;function Lt(e,t,n,i){t.child=e===null?kv(t,null,n,i):Gr(t,e.child,n,i)}function gf(e,t,n,i,r){n=n.render;var o=t.ref;return _r(t,r),i=vd(e,t,n,i,o,r),n=wd(),e!==null&&!Ht?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,jn(e,t,r)):(Oe&&n&&od(t),t.flags|=1,Lt(e,t,i,r),t.child)}function mf(e,t,n,i,r){if(e===null){var o=n.type;return typeof o=="function"&&!Td(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=o,Kv(e,t,o,i,r)):(e=Ol(n.type,null,i,t,t.mode,r),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&r)){var s=o.memoizedProps;if(n=n.compare,n=n!==null?n:hs,n(s,i)&&e.ref===t.ref)return jn(e,t,r)}return t.flags|=1,e=wi(o,i),e.ref=t.ref,e.return=t,t.child=e}function Kv(e,t,n,i,r){if(e!==null){var o=e.memoizedProps;if(hs(o,i)&&e.ref===t.ref)if(Ht=!1,t.pendingProps=i=o,(e.lanes&r)!==0)e.flags&131072&&(Ht=!0);else return t.lanes=e.lanes,jn(e,t,r)}return Ph(e,t,n,i,r)}function Qv(e,t,n){var i=t.pendingProps,r=i.children,o=e!==null?e.memoizedState:null;if(i.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Re(Er,qt),qt|=n;else{if(!(n&1073741824))return e=o!==null?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Re(Er,qt),qt|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=o!==null?o.baseLanes:n,Re(Er,qt),qt|=i}else o!==null?(i=o.baseLanes|n,t.memoizedState=null):i=n,Re(Er,qt),qt|=i;return Lt(e,t,r,n),t.child}function Zv(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ph(e,t,n,i,r){var o=Gt(n)?Ki:At.current;return o=Hr(t,o),_r(t,r),n=vd(e,t,n,i,o,r),i=wd(),e!==null&&!Ht?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,jn(e,t,r)):(Oe&&i&&od(t),t.flags|=1,Lt(e,t,n,r),t.child)}function vf(e,t,n,i,r){if(Gt(n)){var o=!0;ea(t)}else o=!1;if(_r(t,r),t.stateNode===null)Al(e,t),Xv(t,n,i),kh(t,n,i,r),i=!0;else if(e===null){var s=t.stateNode,l=t.memoizedProps;s.props=l;var a=s.context,u=n.contextType;typeof u=="object"&&u!==null?u=cn(u):(u=Gt(n)?Ki:At.current,u=Hr(t,u));var h=n.getDerivedStateFromProps,p=typeof h=="function"||typeof s.getSnapshotBeforeUpdate=="function";p||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==i||a!==u)&&cf(t,s,i,u),ii=!1;var c=t.memoizedState;s.state=c,oa(t,i,s,r),a=t.memoizedState,l!==i||c!==a||Wt.current||ii?(typeof h=="function"&&(Ch(t,n,h,i),a=t.memoizedState),(l=ii||hf(t,n,l,i,c,a,u))?(p||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(t.flags|=4194308)):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=a),s.props=i,s.state=a,s.context=u,i=l):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),i=!1)}else{s=t.stateNode,Pv(e,t),l=t.memoizedProps,u=t.type===t.elementType?l:gn(t.type,l),s.props=u,p=t.pendingProps,c=s.context,a=n.contextType,typeof a=="object"&&a!==null?a=cn(a):(a=Gt(n)?Ki:At.current,a=Hr(t,a));var f=n.getDerivedStateFromProps;(h=typeof f=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==p||c!==a)&&cf(t,s,i,a),ii=!1,c=t.memoizedState,s.state=c,oa(t,i,s,r);var v=t.memoizedState;l!==p||c!==v||Wt.current||ii?(typeof f=="function"&&(Ch(t,n,f,i),v=t.memoizedState),(u=ii||hf(t,n,u,i,c,v,a)||!1)?(h||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(i,v,a),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(i,v,a)),typeof s.componentDidUpdate=="function"&&(t.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof s.componentDidUpdate!="function"||l===e.memoizedProps&&c===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&c===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=v),s.props=i,s.state=v,s.context=a,i=u):(typeof s.componentDidUpdate!="function"||l===e.memoizedProps&&c===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&c===e.memoizedState||(t.flags|=1024),i=!1)}return Nh(e,t,n,i,o,r)}function Nh(e,t,n,i,r,o){Zv(e,t);var s=(t.flags&128)!==0;if(!i&&!s)return r&&tf(t,n,!1),jn(e,t,o);i=t.stateNode,Db.current=t;var l=s&&typeof n.getDerivedStateFromError!="function"?null:i.render();return t.flags|=1,e!==null&&s?(t.child=Gr(t,e.child,null,o),t.child=Gr(t,null,l,o)):Lt(e,t,l,o),t.memoizedState=i.state,r&&tf(t,n,!0),t.child}function Jv(e){var t=e.stateNode;t.pendingContext?ef(e,t.pendingContext,t.pendingContext!==t.context):t.context&&ef(e,t.context,!1),pd(e,t.containerInfo)}function wf(e,t,n,i,r){return Wr(),ld(r),t.flags|=256,Lt(e,t,n,i),t.child}var Th={dehydrated:null,treeContext:null,retryLane:0};function Ih(e){return{baseLanes:e,cachePool:null,transitions:null}}function ew(e,t,n){var i=t.pendingProps,r=Ve.current,o=!1,s=(t.flags&128)!==0,l;if((l=s)||(l=e!==null&&e.memoizedState===null?!1:(r&2)!==0),l?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(r|=1),Re(Ve,r&1),e===null)return bh(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=i.children,e=i.fallback,o?(i=t.mode,o=t.child,s={mode:"hidden",children:s},!(i&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=Da(s,i,0,null),e=ji(e,i,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Ih(n),t.memoizedState=Th,e):bd(t,s));if(r=e.memoizedState,r!==null&&(l=r.dehydrated,l!==null))return Vb(e,t,s,i,l,r,n);if(o){o=i.fallback,s=t.mode,r=e.child,l=r.sibling;var a={mode:"hidden",children:i.children};return!(s&1)&&t.child!==r?(i=t.child,i.childLanes=0,i.pendingProps=a,t.deletions=null):(i=wi(r,a),i.subtreeFlags=r.subtreeFlags&14680064),l!==null?o=wi(l,o):(o=ji(o,s,n,null),o.flags|=2),o.return=t,i.return=t,i.sibling=o,t.child=i,i=o,o=t.child,s=e.child.memoizedState,s=s===null?Ih(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=e.childLanes&~n,t.memoizedState=Th,i}return o=e.child,e=o.sibling,i=wi(o,{mode:"visible",children:i.children}),!(t.mode&1)&&(i.lanes=n),i.return=t,i.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function bd(e,t){return t=Da({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function al(e,t,n,i){return i!==null&&ld(i),Gr(t,e.child,null,n),e=bd(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Vb(e,t,n,i,r,o,s){if(n)return t.flags&256?(t.flags&=-257,i=Pu(Error(J(422))),al(e,t,s,i)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=i.fallback,r=t.mode,i=Da({mode:"visible",children:i.children},r,0,null),o=ji(o,r,s,null),o.flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,t.mode&1&&Gr(t,e.child,null,s),t.child.memoizedState=Ih(s),t.memoizedState=Th,o);if(!(t.mode&1))return al(e,t,s,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var l=i.dgst;return i=l,o=Error(J(419)),i=Pu(o,i,void 0),al(e,t,s,i)}if(l=(s&e.childLanes)!==0,Ht||l){if(i=mt,i!==null){switch(s&-s){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|s)?0:r,r!==0&&r!==o.retryLane&&(o.retryLane=r,Gn(e,r),bn(i,e,r,-1))}return Nd(),i=Pu(Error(J(421))),al(e,t,s,i)}return r.data==="$?"?(t.flags|=128,t.child=e.child,t=eS.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,Kt=fi(r.nextSibling),Zt=t,Oe=!0,vn=null,e!==null&&(on[sn++]=zn,on[sn++]=$n,on[sn++]=Qi,zn=e.id,$n=e.overflow,Qi=t),t=bd(t,i.children),t.flags|=4096,t)}function yf(e,t,n){e.lanes|=t;var i=e.alternate;i!==null&&(i.lanes|=t),Sh(e.return,t,n)}function Nu(e,t,n,i,r){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function tw(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(Lt(e,t,i.children,n),i=Ve.current,i&2)i=i&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&yf(e,n,t);else if(e.tag===19)yf(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Re(Ve,i),!(t.mode&1))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;n!==null;)e=n.alternate,e!==null&&sa(e)===null&&(r=n),n=n.sibling;n=r,n===null?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Nu(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;r!==null;){if(e=r.alternate,e!==null&&sa(e)===null){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Nu(t,!0,n,null,o);break;case"together":Nu(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Al(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function jn(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Ji|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(J(153));if(t.child!==null){for(e=t.child,n=wi(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=wi(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function Ub(e,t,n){switch(t.tag){case 3:Jv(t),Wr();break;case 5:Nv(t);break;case 1:Gt(t.type)&&ea(t);break;case 4:pd(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Re(ia,i._currentValue),i._currentValue=r;break;case 13:if(i=t.memoizedState,i!==null)return i.dehydrated!==null?(Re(Ve,Ve.current&1),t.flags|=128,null):n&t.child.childLanes?ew(e,t,n):(Re(Ve,Ve.current&1),e=jn(e,t,n),e!==null?e.sibling:null);Re(Ve,Ve.current&1);break;case 19:if(i=(n&t.childLanes)!==0,e.flags&128){if(i)return tw(e,t,n);t.flags|=128}if(r=t.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Re(Ve,Ve.current),i)break;return null;case 22:case 23:return t.lanes=0,Qv(e,t,n)}return jn(e,t,n)}var nw,Rh,iw,rw;nw=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Rh=function(){};iw=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,Ui(Ln.current);var o=null;switch(n){case"input":r=Zu(e,r),i=Zu(e,i),o=[];break;case"select":r=We({},r,{value:void 0}),i=We({},i,{value:void 0}),o=[];break;case"textarea":r=th(e,r),i=th(e,i),o=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(e.onclick=Zl)}ih(n,i);var s;n=null;for(u in r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var l=r[u];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(is.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in i){var a=i[u];if(l=r!=null?r[u]:void 0,i.hasOwnProperty(u)&&a!==l&&(a!=null||l!=null))if(u==="style")if(l){for(s in l)!l.hasOwnProperty(s)||a&&a.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in a)a.hasOwnProperty(s)&&l[s]!==a[s]&&(n||(n={}),n[s]=a[s])}else n||(o||(o=[]),o.push(u,n)),n=a;else u==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,l=l?l.__html:void 0,a!=null&&l!==a&&(o=o||[]).push(u,a)):u==="children"?typeof a!="string"&&typeof a!="number"||(o=o||[]).push(u,""+a):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(is.hasOwnProperty(u)?(a!=null&&u==="onScroll"&&Le("scroll",e),o||l===a||(o=[])):(o=o||[]).push(u,a))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}};rw=function(e,t,n,i){n!==i&&(t.flags|=4)};function vo(e,t){if(!Oe)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Ct(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=e,r=r.sibling;else for(r=e.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Hb(e,t,n){var i=t.pendingProps;switch(sd(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ct(t),null;case 1:return Gt(t.type)&&Jl(),Ct(t),null;case 3:return i=t.stateNode,jr(),Fe(Wt),Fe(At),gd(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(sl(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,vn!==null&&(zh(vn),vn=null))),Rh(e,t),Ct(t),null;case 5:fd(t);var r=Ui(gs.current);if(n=t.type,e!==null&&t.stateNode!=null)iw(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(t.stateNode===null)throw Error(J(166));return Ct(t),null}if(e=Ui(Ln.current),sl(t)){i=t.stateNode,n=t.type;var o=t.memoizedProps;switch(i[In]=t,i[ps]=o,e=(t.mode&1)!==0,n){case"dialog":Le("cancel",i),Le("close",i);break;case"iframe":case"object":case"embed":Le("load",i);break;case"video":case"audio":for(r=0;r<No.length;r++)Le(No[r],i);break;case"source":Le("error",i);break;case"img":case"image":case"link":Le("error",i),Le("load",i);break;case"details":Le("toggle",i);break;case"input":Np(i,o),Le("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},Le("invalid",i);break;case"textarea":Ip(i,o),Le("invalid",i)}ih(n,o),r=null;for(var s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="children"?typeof l=="string"?i.textContent!==l&&(o.suppressHydrationWarning!==!0&&ol(i.textContent,l,e),r=["children",l]):typeof l=="number"&&i.textContent!==""+l&&(o.suppressHydrationWarning!==!0&&ol(i.textContent,l,e),r=["children",""+l]):is.hasOwnProperty(s)&&l!=null&&s==="onScroll"&&Le("scroll",i)}switch(n){case"input":Qs(i),Tp(i,o,!0);break;case"textarea":Qs(i),Rp(i);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(i.onclick=Zl)}i=r,t.updateQueue=i,i!==null&&(t.flags|=4)}else{s=r.nodeType===9?r:r.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Lm(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=s.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof i.is=="string"?e=s.createElement(n,{is:i.is}):(e=s.createElement(n),n==="select"&&(s=e,i.multiple?s.multiple=!0:i.size&&(s.size=i.size))):e=s.createElementNS(e,n),e[In]=t,e[ps]=i,nw(e,t,!1,!1),t.stateNode=e;e:{switch(s=rh(n,i),n){case"dialog":Le("cancel",e),Le("close",e),r=i;break;case"iframe":case"object":case"embed":Le("load",e),r=i;break;case"video":case"audio":for(r=0;r<No.length;r++)Le(No[r],e);r=i;break;case"source":Le("error",e),r=i;break;case"img":case"image":case"link":Le("error",e),Le("load",e),r=i;break;case"details":Le("toggle",e),r=i;break;case"input":Np(e,i),r=Zu(e,i),Le("invalid",e);break;case"option":r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=We({},i,{value:void 0}),Le("invalid",e);break;case"textarea":Ip(e,i),r=th(e,i),Le("invalid",e);break;default:r=i}ih(n,r),l=r;for(o in l)if(l.hasOwnProperty(o)){var a=l[o];o==="style"?Bm(e,a):o==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&Fm(e,a)):o==="children"?typeof a=="string"?(n!=="textarea"||a!=="")&&rs(e,a):typeof a=="number"&&rs(e,""+a):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(is.hasOwnProperty(o)?a!=null&&o==="onScroll"&&Le("scroll",e):a!=null&&Gc(e,o,a,s))}switch(n){case"input":Qs(e),Tp(e,i,!1);break;case"textarea":Qs(e),Rp(e);break;case"option":i.value!=null&&e.setAttribute("value",""+bi(i.value));break;case"select":e.multiple=!!i.multiple,o=i.value,o!=null?Lr(e,!!i.multiple,o,!1):i.defaultValue!=null&&Lr(e,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(e.onclick=Zl)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Ct(t),null;case 6:if(e&&t.stateNode!=null)rw(e,t,e.memoizedProps,i);else{if(typeof i!="string"&&t.stateNode===null)throw Error(J(166));if(n=Ui(gs.current),Ui(Ln.current),sl(t)){if(i=t.stateNode,n=t.memoizedProps,i[In]=t,(o=i.nodeValue!==n)&&(e=Zt,e!==null))switch(e.tag){case 3:ol(i.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&ol(i.nodeValue,n,(e.mode&1)!==0)}o&&(t.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[In]=t,t.stateNode=i}return Ct(t),null;case 13:if(Fe(Ve),i=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Oe&&Kt!==null&&t.mode&1&&!(t.flags&128))Sv(),Wr(),t.flags|=98560,o=!1;else if(o=sl(t),i!==null&&i.dehydrated!==null){if(e===null){if(!o)throw Error(J(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(J(317));o[In]=t}else Wr(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Ct(t),o=!1}else vn!==null&&(zh(vn),vn=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(i=i!==null,i!==(e!==null&&e.memoizedState!==null)&&i&&(t.child.flags|=8192,t.mode&1&&(e===null||Ve.current&1?ft===0&&(ft=3):Nd())),t.updateQueue!==null&&(t.flags|=4),Ct(t),null);case 4:return jr(),Rh(e,t),e===null&&cs(t.stateNode.containerInfo),Ct(t),null;case 10:return hd(t.type._context),Ct(t),null;case 17:return Gt(t.type)&&Jl(),Ct(t),null;case 19:if(Fe(Ve),o=t.memoizedState,o===null)return Ct(t),null;if(i=(t.flags&128)!==0,s=o.rendering,s===null)if(i)vo(o,!1);else{if(ft!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(s=sa(e),s!==null){for(t.flags|=128,vo(o,!1),i=s.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;n!==null;)o=n,e=i,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,e=s.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Re(Ve,Ve.current&1|2),t.child}e=e.sibling}o.tail!==null&&tt()>Yr&&(t.flags|=128,i=!0,vo(o,!1),t.lanes=4194304)}else{if(!i)if(e=sa(s),e!==null){if(t.flags|=128,i=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),vo(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!Oe)return Ct(t),null}else 2*tt()-o.renderingStartTime>Yr&&n!==1073741824&&(t.flags|=128,i=!0,vo(o,!1),t.lanes=4194304);o.isBackwards?(s.sibling=t.child,t.child=s):(n=o.last,n!==null?n.sibling=s:t.child=s,o.last=s)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=tt(),t.sibling=null,n=Ve.current,Re(Ve,i?n&1|2:n&1),t):(Ct(t),null);case 22:case 23:return Pd(),i=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==i&&(t.flags|=8192),i&&t.mode&1?qt&1073741824&&(Ct(t),t.subtreeFlags&6&&(t.flags|=8192)):Ct(t),null;case 24:return null;case 25:return null}throw Error(J(156,t.tag))}function Wb(e,t){switch(sd(t),t.tag){case 1:return Gt(t.type)&&Jl(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return jr(),Fe(Wt),Fe(At),gd(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return fd(t),null;case 13:if(Fe(Ve),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(J(340));Wr()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Fe(Ve),null;case 4:return jr(),null;case 10:return hd(t.type._context),null;case 22:case 23:return Pd(),null;case 24:return null;default:return null}}var ul=!1,It=!1,Gb=typeof WeakSet=="function"?WeakSet:Set,oe=null;function kr(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){Xe(e,t,i)}else n.current=null}function Ah(e,t,n){try{n()}catch(i){Xe(e,t,i)}}var xf=!1;function jb(e,t){if(fh=ql,e=uv(),rd(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var s=0,l=-1,a=-1,u=0,h=0,p=e,c=null;t:for(;;){for(var f;p!==n||r!==0&&p.nodeType!==3||(l=s+r),p!==o||i!==0&&p.nodeType!==3||(a=s+i),p.nodeType===3&&(s+=p.nodeValue.length),(f=p.firstChild)!==null;)c=p,p=f;for(;;){if(p===e)break t;if(c===n&&++u===r&&(l=s),c===o&&++h===i&&(a=s),(f=p.nextSibling)!==null)break;p=c,c=p.parentNode}p=f}n=l===-1||a===-1?null:{start:l,end:a}}else n=null}n=n||{start:0,end:0}}else n=null;for(gh={focusedElem:e,selectionRange:n},ql=!1,oe=t;oe!==null;)if(t=oe,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,oe=e;else for(;oe!==null;){t=oe;try{var v=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var w=v.memoizedProps,y=v.memoizedState,g=t.stateNode,m=g.getSnapshotBeforeUpdate(t.elementType===t.type?w:gn(t.type,w),y);g.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(J(163))}}catch(C){Xe(t,t.return,C)}if(e=t.sibling,e!==null){e.return=t.return,oe=e;break}oe=t.return}return v=xf,xf=!1,v}function Uo(e,t,n){var i=t.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,o!==void 0&&Ah(t,n,o)}r=r.next}while(r!==i)}}function za(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function Lh(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function ow(e){var t=e.alternate;t!==null&&(e.alternate=null,ow(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[In],delete t[ps],delete t[wh],delete t[Tb],delete t[Ib])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sw(e){return e.tag===5||e.tag===3||e.tag===4}function bf(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||sw(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Fh(e,t,n){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Zl));else if(i!==4&&(e=e.child,e!==null))for(Fh(e,t,n),e=e.sibling;e!==null;)Fh(e,t,n),e=e.sibling}function Oh(e,t,n){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(i!==4&&(e=e.child,e!==null))for(Oh(e,t,n),e=e.sibling;e!==null;)Oh(e,t,n),e=e.sibling}var wt=null,mn=!1;function ei(e,t,n){for(n=n.child;n!==null;)lw(e,t,n),n=n.sibling}function lw(e,t,n){if(An&&typeof An.onCommitFiberUnmount=="function")try{An.onCommitFiberUnmount(Ra,n)}catch{}switch(n.tag){case 5:It||kr(n,t);case 6:var i=wt,r=mn;wt=null,ei(e,t,n),wt=i,mn=r,wt!==null&&(mn?(e=wt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):wt.removeChild(n.stateNode));break;case 18:wt!==null&&(mn?(e=wt,n=n.stateNode,e.nodeType===8?xu(e.parentNode,n):e.nodeType===1&&xu(e,n),as(e)):xu(wt,n.stateNode));break;case 4:i=wt,r=mn,wt=n.stateNode.containerInfo,mn=!0,ei(e,t,n),wt=i,mn=r;break;case 0:case 11:case 14:case 15:if(!It&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var o=r,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&Ah(n,t,s),r=r.next}while(r!==i)}ei(e,t,n);break;case 1:if(!It&&(kr(n,t),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(l){Xe(n,t,l)}ei(e,t,n);break;case 21:ei(e,t,n);break;case 22:n.mode&1?(It=(i=It)||n.memoizedState!==null,ei(e,t,n),It=i):ei(e,t,n);break;default:ei(e,t,n)}}function Sf(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new Gb),t.forEach(function(i){var r=tS.bind(null,e,i);n.has(i)||(n.add(i),i.then(r,r))})}}function fn(e,t){var n=t.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var o=e,s=t,l=s;e:for(;l!==null;){switch(l.tag){case 5:wt=l.stateNode,mn=!1;break e;case 3:wt=l.stateNode.containerInfo,mn=!0;break e;case 4:wt=l.stateNode.containerInfo,mn=!0;break e}l=l.return}if(wt===null)throw Error(J(160));lw(o,s,r),wt=null,mn=!1;var a=r.alternate;a!==null&&(a.return=null),r.return=null}catch(u){Xe(r,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)aw(t,e),t=t.sibling}function aw(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(fn(t,e),En(e),i&4){try{Uo(3,e,e.return),za(3,e)}catch(w){Xe(e,e.return,w)}try{Uo(5,e,e.return)}catch(w){Xe(e,e.return,w)}}break;case 1:fn(t,e),En(e),i&512&&n!==null&&kr(n,n.return);break;case 5:if(fn(t,e),En(e),i&512&&n!==null&&kr(n,n.return),e.flags&32){var r=e.stateNode;try{rs(r,"")}catch(w){Xe(e,e.return,w)}}if(i&4&&(r=e.stateNode,r!=null)){var o=e.memoizedProps,s=n!==null?n.memoizedProps:o,l=e.type,a=e.updateQueue;if(e.updateQueue=null,a!==null)try{l==="input"&&o.type==="radio"&&o.name!=null&&Rm(r,o),rh(l,s);var u=rh(l,o);for(s=0;s<a.length;s+=2){var h=a[s],p=a[s+1];h==="style"?Bm(r,p):h==="dangerouslySetInnerHTML"?Fm(r,p):h==="children"?rs(r,p):Gc(r,h,p,u)}switch(l){case"input":Ju(r,o);break;case"textarea":Am(r,o);break;case"select":var c=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var f=o.value;f!=null?Lr(r,!!o.multiple,f,!1):c!==!!o.multiple&&(o.defaultValue!=null?Lr(r,!!o.multiple,o.defaultValue,!0):Lr(r,!!o.multiple,o.multiple?[]:"",!1))}r[ps]=o}catch(w){Xe(e,e.return,w)}}break;case 6:if(fn(t,e),En(e),i&4){if(e.stateNode===null)throw Error(J(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(w){Xe(e,e.return,w)}}break;case 3:if(fn(t,e),En(e),i&4&&n!==null&&n.memoizedState.isDehydrated)try{as(t.containerInfo)}catch(w){Xe(e,e.return,w)}break;case 4:fn(t,e),En(e);break;case 13:fn(t,e),En(e),r=e.child,r.flags&8192&&(o=r.memoizedState!==null,r.stateNode.isHidden=o,!o||r.alternate!==null&&r.alternate.memoizedState!==null||(kd=tt())),i&4&&Sf(e);break;case 22:if(h=n!==null&&n.memoizedState!==null,e.mode&1?(It=(u=It)||h,fn(t,e),It=u):fn(t,e),En(e),i&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!h&&e.mode&1)for(oe=e,h=e.child;h!==null;){for(p=oe=h;oe!==null;){switch(c=oe,f=c.child,c.tag){case 0:case 11:case 14:case 15:Uo(4,c,c.return);break;case 1:kr(c,c.return);var v=c.stateNode;if(typeof v.componentWillUnmount=="function"){i=c,n=c.return;try{t=i,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(w){Xe(i,n,w)}}break;case 5:kr(c,c.return);break;case 22:if(c.memoizedState!==null){kf(p);continue}}f!==null?(f.return=c,oe=f):kf(p)}h=h.sibling}e:for(h=null,p=e;;){if(p.tag===5){if(h===null){h=p;try{r=p.stateNode,u?(o=r.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(l=p.stateNode,a=p.memoizedProps.style,s=a!=null&&a.hasOwnProperty("display")?a.display:null,l.style.display=Om("display",s))}catch(w){Xe(e,e.return,w)}}}else if(p.tag===6){if(h===null)try{p.stateNode.nodeValue=u?"":p.memoizedProps}catch(w){Xe(e,e.return,w)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===e)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===e)break e;for(;p.sibling===null;){if(p.return===null||p.return===e)break e;h===p&&(h=null),p=p.return}h===p&&(h=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:fn(t,e),En(e),i&4&&Sf(e);break;case 21:break;default:fn(t,e),En(e)}}function En(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(sw(n)){var i=n;break e}n=n.return}throw Error(J(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(rs(r,""),i.flags&=-33);var o=bf(e);Oh(e,o,r);break;case 3:case 4:var s=i.stateNode.containerInfo,l=bf(e);Fh(e,l,s);break;default:throw Error(J(161))}}catch(a){Xe(e,e.return,a)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Xb(e,t,n){oe=e,uw(e)}function uw(e,t,n){for(var i=(e.mode&1)!==0;oe!==null;){var r=oe,o=r.child;if(r.tag===22&&i){var s=r.memoizedState!==null||ul;if(!s){var l=r.alternate,a=l!==null&&l.memoizedState!==null||It;l=ul;var u=It;if(ul=s,(It=a)&&!u)for(oe=r;oe!==null;)s=oe,a=s.child,s.tag===22&&s.memoizedState!==null?Ef(r):a!==null?(a.return=s,oe=a):Ef(r);for(;o!==null;)oe=o,uw(o),o=o.sibling;oe=r,ul=l,It=u}Cf(e)}else r.subtreeFlags&8772&&o!==null?(o.return=r,oe=o):Cf(e)}}function Cf(e){for(;oe!==null;){var t=oe;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:It||za(5,t);break;case 1:var i=t.stateNode;if(t.flags&4&&!It)if(n===null)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:gn(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&lf(t,o,i);break;case 3:var s=t.updateQueue;if(s!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}lf(t,s,n)}break;case 5:var l=t.stateNode;if(n===null&&t.flags&4){n=l;var a=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&n.focus();break;case"img":a.src&&(n.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var p=h.dehydrated;p!==null&&as(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(J(163))}It||t.flags&512&&Lh(t)}catch(c){Xe(t,t.return,c)}}if(t===e){oe=null;break}if(n=t.sibling,n!==null){n.return=t.return,oe=n;break}oe=t.return}}function kf(e){for(;oe!==null;){var t=oe;if(t===e){oe=null;break}var n=t.sibling;if(n!==null){n.return=t.return,oe=n;break}oe=t.return}}function Ef(e){for(;oe!==null;){var t=oe;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{za(4,t)}catch(a){Xe(t,n,a)}break;case 1:var i=t.stateNode;if(typeof i.componentDidMount=="function"){var r=t.return;try{i.componentDidMount()}catch(a){Xe(t,r,a)}}var o=t.return;try{Lh(t)}catch(a){Xe(t,o,a)}break;case 5:var s=t.return;try{Lh(t)}catch(a){Xe(t,s,a)}}}catch(a){Xe(t,t.return,a)}if(t===e){oe=null;break}var l=t.sibling;if(l!==null){l.return=t.return,oe=l;break}oe=t.return}}var Yb=Math.ceil,ua=Zn.ReactCurrentDispatcher,Sd=Zn.ReactCurrentOwner,un=Zn.ReactCurrentBatchConfig,be=0,mt=null,at=null,yt=0,qt=0,Er=Ii(0),ft=0,ys=null,Ji=0,$a=0,Cd=0,Ho=null,Dt=null,kd=0,Yr=1/0,Bn=null,ha=!1,Bh=null,mi=null,hl=!1,li=null,ca=0,Wo=0,_h=null,Ll=-1,Fl=0;function Bt(){return be&6?tt():Ll!==-1?Ll:Ll=tt()}function vi(e){return e.mode&1?be&2&&yt!==0?yt&-yt:Ab.transition!==null?(Fl===0&&(Fl=Xm()),Fl):(e=Ee,e!==0||(e=window.event,e=e===void 0?16:ev(e.type)),e):1}function bn(e,t,n,i){if(50<Wo)throw Wo=0,_h=null,Error(J(185));Fs(e,n,i),(!(be&2)||e!==mt)&&(e===mt&&(!(be&2)&&($a|=n),ft===4&&oi(e,yt)),jt(e,i),n===1&&be===0&&!(t.mode&1)&&(Yr=tt()+500,Ba&&Ri()))}function jt(e,t){var n=e.callbackNode;A1(e,t);var i=Yl(e,e===mt?yt:0);if(i===0)n!==null&&Fp(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(n!=null&&Fp(n),t===1)e.tag===0?Rb(Pf.bind(null,e)):yv(Pf.bind(null,e)),Pb(function(){!(be&6)&&Ri()}),n=null;else{switch(Ym(i)){case 1:n=Kc;break;case 4:n=Gm;break;case 16:n=Xl;break;case 536870912:n=jm;break;default:n=Xl}n=vw(n,hw.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function hw(e,t){if(Ll=-1,Fl=0,be&6)throw Error(J(327));var n=e.callbackNode;if(Mr()&&e.callbackNode!==n)return null;var i=Yl(e,e===mt?yt:0);if(i===0)return null;if(i&30||i&e.expiredLanes||t)t=da(e,i);else{t=i;var r=be;be|=2;var o=dw();(mt!==e||yt!==t)&&(Bn=null,Yr=tt()+500,Gi(e,t));do try{Qb();break}catch(l){cw(e,l)}while(!0);ud(),ua.current=o,be=r,at!==null?t=0:(mt=null,yt=0,t=ft)}if(t!==0){if(t===2&&(r=uh(e),r!==0&&(i=r,t=Mh(e,r))),t===1)throw n=ys,Gi(e,0),oi(e,i),jt(e,tt()),n;if(t===6)oi(e,i);else{if(r=e.current.alternate,!(i&30)&&!qb(r)&&(t=da(e,i),t===2&&(o=uh(e),o!==0&&(i=o,t=Mh(e,o))),t===1))throw n=ys,Gi(e,0),oi(e,i),jt(e,tt()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(J(345));case 2:zi(e,Dt,Bn);break;case 3:if(oi(e,i),(i&130023424)===i&&(t=kd+500-tt(),10<t)){if(Yl(e,0)!==0)break;if(r=e.suspendedLanes,(r&i)!==i){Bt(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=vh(zi.bind(null,e,Dt,Bn),t);break}zi(e,Dt,Bn);break;case 4:if(oi(e,i),(i&4194240)===i)break;for(t=e.eventTimes,r=-1;0<i;){var s=31-xn(i);o=1<<s,s=t[s],s>r&&(r=s),i&=~o}if(i=r,i=tt()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Yb(i/1960))-i,10<i){e.timeoutHandle=vh(zi.bind(null,e,Dt,Bn),i);break}zi(e,Dt,Bn);break;case 5:zi(e,Dt,Bn);break;default:throw Error(J(329))}}}return jt(e,tt()),e.callbackNode===n?hw.bind(null,e):null}function Mh(e,t){var n=Ho;return e.current.memoizedState.isDehydrated&&(Gi(e,t).flags|=256),e=da(e,t),e!==2&&(t=Dt,Dt=n,t!==null&&zh(t)),e}function zh(e){Dt===null?Dt=e:Dt.push.apply(Dt,e)}function qb(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!Cn(o(),r))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function oi(e,t){for(t&=~Cd,t&=~$a,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-xn(t),i=1<<n;e[n]=-1,t&=~i}}function Pf(e){if(be&6)throw Error(J(327));Mr();var t=Yl(e,0);if(!(t&1))return jt(e,tt()),null;var n=da(e,t);if(e.tag!==0&&n===2){var i=uh(e);i!==0&&(t=i,n=Mh(e,i))}if(n===1)throw n=ys,Gi(e,0),oi(e,t),jt(e,tt()),n;if(n===6)throw Error(J(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,zi(e,Dt,Bn),jt(e,tt()),null}function Ed(e,t){var n=be;be|=1;try{return e(t)}finally{be=n,be===0&&(Yr=tt()+500,Ba&&Ri())}}function er(e){li!==null&&li.tag===0&&!(be&6)&&Mr();var t=be;be|=1;var n=un.transition,i=Ee;try{if(un.transition=null,Ee=1,e)return e()}finally{Ee=i,un.transition=n,be=t,!(be&6)&&Ri()}}function Pd(){qt=Er.current,Fe(Er)}function Gi(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Eb(n)),at!==null)for(n=at.return;n!==null;){var i=n;switch(sd(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Jl();break;case 3:jr(),Fe(Wt),Fe(At),gd();break;case 5:fd(i);break;case 4:jr();break;case 13:Fe(Ve);break;case 19:Fe(Ve);break;case 10:hd(i.type._context);break;case 22:case 23:Pd()}n=n.return}if(mt=e,at=e=wi(e.current,null),yt=qt=t,ft=0,ys=null,Cd=$a=Ji=0,Dt=Ho=null,Vi!==null){for(t=0;t<Vi.length;t++)if(n=Vi[t],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,o=n.pending;if(o!==null){var s=o.next;o.next=r,i.next=s}n.pending=i}Vi=null}return e}function cw(e,t){do{var n=at;try{if(ud(),Il.current=aa,la){for(var i=He.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}la=!1}if(Zi=0,gt=dt=He=null,Vo=!1,ms=0,Sd.current=null,n===null||n.return===null){ft=1,ys=t,at=null;break}e:{var o=e,s=n.return,l=n,a=t;if(t=yt,l.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var u=a,h=l,p=h.tag;if(!(h.mode&1)&&(p===0||p===11||p===15)){var c=h.alternate;c?(h.updateQueue=c.updateQueue,h.memoizedState=c.memoizedState,h.lanes=c.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=pf(s);if(f!==null){f.flags&=-257,ff(f,s,l,o,t),f.mode&1&&df(o,u,t),t=f,a=u;var v=t.updateQueue;if(v===null){var w=new Set;w.add(a),t.updateQueue=w}else v.add(a);break e}else{if(!(t&1)){df(o,u,t),Nd();break e}a=Error(J(426))}}else if(Oe&&l.mode&1){var y=pf(s);if(y!==null){!(y.flags&65536)&&(y.flags|=256),ff(y,s,l,o,t),ld(Xr(a,l));break e}}o=a=Xr(a,l),ft!==4&&(ft=2),Ho===null?Ho=[o]:Ho.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var g=Yv(o,a,t);sf(o,g);break e;case 1:l=a;var m=o.type,x=o.stateNode;if(!(o.flags&128)&&(typeof m.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(mi===null||!mi.has(x)))){o.flags|=65536,t&=-t,o.lanes|=t;var C=qv(o,l,t);sf(o,C);break e}}o=o.return}while(o!==null)}fw(n)}catch(N){t=N,at===n&&n!==null&&(at=n=n.return);continue}break}while(!0)}function dw(){var e=ua.current;return ua.current=aa,e===null?aa:e}function Nd(){(ft===0||ft===3||ft===2)&&(ft=4),mt===null||!(Ji&268435455)&&!($a&268435455)||oi(mt,yt)}function da(e,t){var n=be;be|=2;var i=dw();(mt!==e||yt!==t)&&(Bn=null,Gi(e,t));do try{Kb();break}catch(r){cw(e,r)}while(!0);if(ud(),be=n,ua.current=i,at!==null)throw Error(J(261));return mt=null,yt=0,ft}function Kb(){for(;at!==null;)pw(at)}function Qb(){for(;at!==null&&!S1();)pw(at)}function pw(e){var t=mw(e.alternate,e,qt);e.memoizedProps=e.pendingProps,t===null?fw(e):at=t,Sd.current=null}function fw(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=Wb(n,t),n!==null){n.flags&=32767,at=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{ft=6,at=null;return}}else if(n=Hb(n,t,qt),n!==null){at=n;return}if(t=t.sibling,t!==null){at=t;return}at=t=e}while(t!==null);ft===0&&(ft=5)}function zi(e,t,n){var i=Ee,r=un.transition;try{un.transition=null,Ee=1,Zb(e,t,n,i)}finally{un.transition=r,Ee=i}return null}function Zb(e,t,n,i){do Mr();while(li!==null);if(be&6)throw Error(J(327));n=e.finishedWork;var r=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(J(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(L1(e,o),e===mt&&(at=mt=null,yt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||hl||(hl=!0,vw(Xl,function(){return Mr(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=un.transition,un.transition=null;var s=Ee;Ee=1;var l=be;be|=4,Sd.current=null,jb(e,n),aw(n,e),wb(gh),ql=!!fh,gh=fh=null,e.current=n,Xb(n),C1(),be=l,Ee=s,un.transition=o}else e.current=n;if(hl&&(hl=!1,li=e,ca=r),o=e.pendingLanes,o===0&&(mi=null),P1(n.stateNode),jt(e,tt()),t!==null)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(ha)throw ha=!1,e=Bh,Bh=null,e;return ca&1&&e.tag!==0&&Mr(),o=e.pendingLanes,o&1?e===_h?Wo++:(Wo=0,_h=e):Wo=0,Ri(),null}function Mr(){if(li!==null){var e=Ym(ca),t=un.transition,n=Ee;try{if(un.transition=null,Ee=16>e?16:e,li===null)var i=!1;else{if(e=li,li=null,ca=0,be&6)throw Error(J(331));var r=be;for(be|=4,oe=e.current;oe!==null;){var o=oe,s=o.child;if(oe.flags&16){var l=o.deletions;if(l!==null){for(var a=0;a<l.length;a++){var u=l[a];for(oe=u;oe!==null;){var h=oe;switch(h.tag){case 0:case 11:case 15:Uo(8,h,o)}var p=h.child;if(p!==null)p.return=h,oe=p;else for(;oe!==null;){h=oe;var c=h.sibling,f=h.return;if(ow(h),h===u){oe=null;break}if(c!==null){c.return=f,oe=c;break}oe=f}}}var v=o.alternate;if(v!==null){var w=v.child;if(w!==null){v.child=null;do{var y=w.sibling;w.sibling=null,w=y}while(w!==null)}}oe=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,oe=s;else e:for(;oe!==null;){if(o=oe,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Uo(9,o,o.return)}var g=o.sibling;if(g!==null){g.return=o.return,oe=g;break e}oe=o.return}}var m=e.current;for(oe=m;oe!==null;){s=oe;var x=s.child;if(s.subtreeFlags&2064&&x!==null)x.return=s,oe=x;else e:for(s=m;oe!==null;){if(l=oe,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:za(9,l)}}catch(N){Xe(l,l.return,N)}if(l===s){oe=null;break e}var C=l.sibling;if(C!==null){C.return=l.return,oe=C;break e}oe=l.return}}if(be=r,Ri(),An&&typeof An.onPostCommitFiberRoot=="function")try{An.onPostCommitFiberRoot(Ra,e)}catch{}i=!0}return i}finally{Ee=n,un.transition=t}}return!1}function Nf(e,t,n){t=Xr(n,t),t=Yv(e,t,1),e=gi(e,t,1),t=Bt(),e!==null&&(Fs(e,1,t),jt(e,t))}function Xe(e,t,n){if(e.tag===3)Nf(e,e,n);else for(;t!==null;){if(t.tag===3){Nf(t,e,n);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(mi===null||!mi.has(i))){e=Xr(n,e),e=qv(t,e,1),t=gi(t,e,1),e=Bt(),t!==null&&(Fs(t,1,e),jt(t,e));break}}t=t.return}}function Jb(e,t,n){var i=e.pingCache;i!==null&&i.delete(t),t=Bt(),e.pingedLanes|=e.suspendedLanes&n,mt===e&&(yt&n)===n&&(ft===4||ft===3&&(yt&130023424)===yt&&500>tt()-kd?Gi(e,0):Cd|=n),jt(e,t)}function gw(e,t){t===0&&(e.mode&1?(t=el,el<<=1,!(el&130023424)&&(el=4194304)):t=1);var n=Bt();e=Gn(e,t),e!==null&&(Fs(e,t,n),jt(e,n))}function eS(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),gw(e,n)}function tS(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(J(314))}i!==null&&i.delete(t),gw(e,n)}var mw;mw=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Wt.current)Ht=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return Ht=!1,Ub(e,t,n);Ht=!!(e.flags&131072)}else Ht=!1,Oe&&t.flags&1048576&&xv(t,na,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Al(e,t),e=t.pendingProps;var r=Hr(t,At.current);_r(t,n),r=vd(null,t,i,e,r,n);var o=wd();return t.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Gt(i)?(o=!0,ea(t)):o=!1,t.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,dd(t),r.updater=Ma,t.stateNode=r,r._reactInternals=t,kh(t,i,e,n),t=Nh(null,t,i,!0,o,n)):(t.tag=0,Oe&&o&&od(t),Lt(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Al(e,t),e=t.pendingProps,r=i._init,i=r(i._payload),t.type=i,r=t.tag=iS(i),e=gn(i,e),r){case 0:t=Ph(null,t,i,e,n);break e;case 1:t=vf(null,t,i,e,n);break e;case 11:t=gf(null,t,i,e,n);break e;case 14:t=mf(null,t,i,gn(i.type,e),n);break e}throw Error(J(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:gn(i,r),Ph(e,t,i,r,n);case 1:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:gn(i,r),vf(e,t,i,r,n);case 3:e:{if(Jv(t),e===null)throw Error(J(387));i=t.pendingProps,o=t.memoizedState,r=o.element,Pv(e,t),oa(t,i,null,n);var s=t.memoizedState;if(i=s.element,o.isDehydrated)if(o={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){r=Xr(Error(J(423)),t),t=wf(e,t,i,n,r);break e}else if(i!==r){r=Xr(Error(J(424)),t),t=wf(e,t,i,n,r);break e}else for(Kt=fi(t.stateNode.containerInfo.firstChild),Zt=t,Oe=!0,vn=null,n=kv(t,null,i,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Wr(),i===r){t=jn(e,t,n);break e}Lt(e,t,i,n)}t=t.child}return t;case 5:return Nv(t),e===null&&bh(t),i=t.type,r=t.pendingProps,o=e!==null?e.memoizedProps:null,s=r.children,mh(i,r)?s=null:o!==null&&mh(i,o)&&(t.flags|=32),Zv(e,t),Lt(e,t,s,n),t.child;case 6:return e===null&&bh(t),null;case 13:return ew(e,t,n);case 4:return pd(t,t.stateNode.containerInfo),i=t.pendingProps,e===null?t.child=Gr(t,null,i,n):Lt(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:gn(i,r),gf(e,t,i,r,n);case 7:return Lt(e,t,t.pendingProps,n),t.child;case 8:return Lt(e,t,t.pendingProps.children,n),t.child;case 12:return Lt(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,o=t.memoizedProps,s=r.value,Re(ia,i._currentValue),i._currentValue=s,o!==null)if(Cn(o.value,s)){if(o.children===r.children&&!Wt.current){t=jn(e,t,n);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var l=o.dependencies;if(l!==null){s=o.child;for(var a=l.firstContext;a!==null;){if(a.context===i){if(o.tag===1){a=Un(-1,n&-n),a.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?a.next=a:(a.next=h.next,h.next=a),u.pending=a}}o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Sh(o.return,n,t),l.lanes|=n;break}a=a.next}}else if(o.tag===10)s=o.type===t.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(J(341));s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),Sh(s,n,t),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===t){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}Lt(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,_r(t,n),r=cn(r),i=i(r),t.flags|=1,Lt(e,t,i,n),t.child;case 14:return i=t.type,r=gn(i,t.pendingProps),r=gn(i.type,r),mf(e,t,i,r,n);case 15:return Kv(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:gn(i,r),Al(e,t),t.tag=1,Gt(i)?(e=!0,ea(t)):e=!1,_r(t,n),Xv(t,i,r),kh(t,i,r,n),Nh(null,t,i,!0,e,n);case 19:return tw(e,t,n);case 22:return Qv(e,t,n)}throw Error(J(156,t.tag))};function vw(e,t){return Wm(e,t)}function nS(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ln(e,t,n,i){return new nS(e,t,n,i)}function Td(e){return e=e.prototype,!(!e||!e.isReactComponent)}function iS(e){if(typeof e=="function")return Td(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Xc)return 11;if(e===Yc)return 14}return 2}function wi(e,t){var n=e.alternate;return n===null?(n=ln(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ol(e,t,n,i,r,o){var s=2;if(i=e,typeof e=="function")Td(e)&&(s=1);else if(typeof e=="string")s=5;else e:switch(e){case gr:return ji(n.children,r,o,t);case jc:s=8,r|=8;break;case Yu:return e=ln(12,n,t,r|2),e.elementType=Yu,e.lanes=o,e;case qu:return e=ln(13,n,t,r),e.elementType=qu,e.lanes=o,e;case Ku:return e=ln(19,n,t,r),e.elementType=Ku,e.lanes=o,e;case Nm:return Da(n,r,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Em:s=10;break e;case Pm:s=9;break e;case Xc:s=11;break e;case Yc:s=14;break e;case ni:s=16,i=null;break e}throw Error(J(130,e==null?e:typeof e,""))}return t=ln(s,n,t,r),t.elementType=e,t.type=i,t.lanes=o,t}function ji(e,t,n,i){return e=ln(7,e,i,t),e.lanes=n,e}function Da(e,t,n,i){return e=ln(22,e,i,t),e.elementType=Nm,e.lanes=n,e.stateNode={isHidden:!1},e}function Tu(e,t,n){return e=ln(6,e,null,t),e.lanes=n,e}function Iu(e,t,n){return t=ln(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function rS(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=uu(0),this.expirationTimes=uu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=uu(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Id(e,t,n,i,r,o,s,l,a){return e=new rS(e,t,n,l,a),t===1?(t=1,o===!0&&(t|=8)):t=0,o=ln(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},dd(o),e}function oS(e,t,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:fr,key:i==null?null:""+i,children:e,containerInfo:t,implementation:n}}function ww(e){if(!e)return Si;e=e._reactInternals;e:{if(rr(e)!==e||e.tag!==1)throw Error(J(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Gt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(J(171))}if(e.tag===1){var n=e.type;if(Gt(n))return wv(e,n,t)}return t}function yw(e,t,n,i,r,o,s,l,a){return e=Id(n,i,!0,e,r,o,s,l,a),e.context=ww(null),n=e.current,i=Bt(),r=vi(n),o=Un(i,r),o.callback=t??null,gi(n,o,r),e.current.lanes=r,Fs(e,r,i),jt(e,i),e}function Va(e,t,n,i){var r=t.current,o=Bt(),s=vi(r);return n=ww(n),t.context===null?t.context=n:t.pendingContext=n,t=Un(o,s),t.payload={element:e},i=i===void 0?null:i,i!==null&&(t.callback=i),e=gi(r,t,s),e!==null&&(bn(e,r,s,o),Tl(e,r,s)),s}function pa(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Tf(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Rd(e,t){Tf(e,t),(e=e.alternate)&&Tf(e,t)}function sS(){return null}var xw=typeof reportError=="function"?reportError:function(e){console.error(e)};function Ad(e){this._internalRoot=e}Ua.prototype.render=Ad.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(J(409));Va(e,t,null,null)};Ua.prototype.unmount=Ad.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;er(function(){Va(null,e,null,null)}),t[Wn]=null}};function Ua(e){this._internalRoot=e}Ua.prototype.unstable_scheduleHydration=function(e){if(e){var t=Qm();e={blockedOn:null,target:e,priority:t};for(var n=0;n<ri.length&&t!==0&&t<ri[n].priority;n++);ri.splice(n,0,e),n===0&&Jm(e)}};function Ld(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Ha(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function If(){}function lS(e,t,n,i,r){if(r){if(typeof i=="function"){var o=i;i=function(){var u=pa(s);o.call(u)}}var s=yw(t,i,e,0,null,!1,!1,"",If);return e._reactRootContainer=s,e[Wn]=s.current,cs(e.nodeType===8?e.parentNode:e),er(),s}for(;r=e.lastChild;)e.removeChild(r);if(typeof i=="function"){var l=i;i=function(){var u=pa(a);l.call(u)}}var a=Id(e,0,!1,null,null,!1,!1,"",If);return e._reactRootContainer=a,e[Wn]=a.current,cs(e.nodeType===8?e.parentNode:e),er(function(){Va(t,a,n,i)}),a}function Wa(e,t,n,i,r){var o=n._reactRootContainer;if(o){var s=o;if(typeof r=="function"){var l=r;r=function(){var a=pa(s);l.call(a)}}Va(t,s,e,r)}else s=lS(n,t,e,r,i);return pa(s)}qm=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Po(t.pendingLanes);n!==0&&(Qc(t,n|1),jt(t,tt()),!(be&6)&&(Yr=tt()+500,Ri()))}break;case 13:er(function(){var i=Gn(e,1);if(i!==null){var r=Bt();bn(i,e,1,r)}}),Rd(e,1)}};Zc=function(e){if(e.tag===13){var t=Gn(e,134217728);if(t!==null){var n=Bt();bn(t,e,134217728,n)}Rd(e,134217728)}};Km=function(e){if(e.tag===13){var t=vi(e),n=Gn(e,t);if(n!==null){var i=Bt();bn(n,e,t,i)}Rd(e,t)}};Qm=function(){return Ee};Zm=function(e,t){var n=Ee;try{return Ee=e,t()}finally{Ee=n}};sh=function(e,t,n){switch(t){case"input":if(Ju(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=Oa(i);if(!r)throw Error(J(90));Im(i),Ju(i,r)}}}break;case"textarea":Am(e,n);break;case"select":t=n.value,t!=null&&Lr(e,!!n.multiple,t,!1)}};zm=Ed;$m=er;var aS={usingClientEntryPoint:!1,Events:[Bs,yr,Oa,_m,Mm,Ed]},wo={findFiberByHostInstance:Di,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},uS={bundleType:wo.bundleType,version:wo.version,rendererPackageName:wo.rendererPackageName,rendererConfig:wo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Zn.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Um(e),e===null?null:e.stateNode},findFiberByHostInstance:wo.findFiberByHostInstance||sS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cl.isDisabled&&cl.supportsFiber)try{Ra=cl.inject(uS),An=cl}catch{}}en.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=aS;en.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ld(t))throw Error(J(200));return oS(e,t,null,n)};en.createRoot=function(e,t){if(!Ld(e))throw Error(J(299));var n=!1,i="",r=xw;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(r=t.onRecoverableError)),t=Id(e,1,!1,null,null,n,!1,i,r),e[Wn]=t.current,cs(e.nodeType===8?e.parentNode:e),new Ad(t)};en.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(J(188)):(e=Object.keys(e).join(","),Error(J(268,e)));return e=Um(t),e=e===null?null:e.stateNode,e};en.flushSync=function(e){return er(e)};en.hydrate=function(e,t,n){if(!Ha(t))throw Error(J(200));return Wa(null,e,t,!0,n)};en.hydrateRoot=function(e,t,n){if(!Ld(e))throw Error(J(405));var i=n!=null&&n.hydratedSources||null,r=!1,o="",s=xw;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),t=yw(t,null,e,1,n??null,r,!1,o,s),e[Wn]=t.current,cs(e),i)for(e=0;e<i.length;e++)n=i[e],r=n._getVersion,r=r(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Ua(t)};en.render=function(e,t,n){if(!Ha(t))throw Error(J(200));return Wa(null,e,t,!1,n)};en.unmountComponentAtNode=function(e){if(!Ha(e))throw Error(J(40));return e._reactRootContainer?(er(function(){Wa(null,null,e,!1,function(){e._reactRootContainer=null,e[Wn]=null})}),!0):!1};en.unstable_batchedUpdates=Ed;en.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Ha(n))throw Error(J(200));if(e==null||e._reactInternals===void 0)throw Error(J(38));return Wa(e,t,n,!1,i)};en.version="18.3.1-next-f1338f8080-20240426";function bw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(bw)}catch(e){console.error(e)}}bw(),bm.exports=en;var Sw=bm.exports,Cw,Rf=Sw;Cw=Rf.createRoot,Rf.hydrateRoot;function xs(e){"@babel/helpers - typeof";return xs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xs(e)}function hS(e,t){if(xs(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t||"default");if(xs(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function cS(e){var t=hS(e,"string");return xs(t)=="symbol"?t:t+""}function dS(e,t,n){return(t=cS(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kw(e){var t={};return function(n){return t[n]===void 0&&(t[n]=e(n)),t[n]}}var pS=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|inert|itemProp|itemScope|itemType|itemID|itemRef|on|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,fS=kw(function(e){return pS.test(e)||e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)<91});function gS(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}function mS(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),e.nonce!==void 0&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t}var vS=function(){function e(n){this.isSpeedy=n.speedy===void 0?!0:n.speedy,this.tags=[],this.ctr=0,this.nonce=n.nonce,this.key=n.key,this.container=n.container,this.before=null}var t=e.prototype;return t.insert=function(i){if(this.ctr%(this.isSpeedy?65e3:1)===0){var r=mS(this),o;this.tags.length===0?o=this.before:o=this.tags[this.tags.length-1].nextSibling,this.container.insertBefore(r,o),this.tags.push(r)}var s=this.tags[this.tags.length-1];if(this.isSpeedy){var l=gS(s);try{var a=i.charCodeAt(1)===105&&i.charCodeAt(0)===64;l.insertRule(i,a?0:l.cssRules.length)}catch{}}else s.appendChild(document.createTextNode(i));this.ctr++},t.flush=function(){this.tags.forEach(function(i){return i.parentNode.removeChild(i)}),this.tags=[],this.ctr=0},e}();function wS(e){function t(I,T,B,Y,E){for(var W=0,V=0,te=0,j=0,re,U,ue=0,ce=0,ne,me=ne=re=0,de=0,ut=0,Fn=0,Qe=0,Li=B.length,Fi=Li-1,bt,he="",Ae="",ht="",zt="",_e;de<Li;){if(U=B.charCodeAt(de),de===Fi&&V+j+te+W!==0&&(V!==0&&(U=V===47?10:47),j=te=W=0,Li++,Fi++),V+j+te+W===0){if(de===Fi&&(0<ut&&(he=he.replace(c,"")),0<he.trim().length)){switch(U){case 32:case 9:case 59:case 13:case 10:break;default:he+=B.charAt(de)}U=59}switch(U){case 123:for(he=he.trim(),re=he.charCodeAt(0),ne=1,Qe=++de;de<Li;){switch(U=B.charCodeAt(de)){case 123:ne++;break;case 125:ne--;break;case 47:switch(U=B.charCodeAt(de+1)){case 42:case 47:e:{for(me=de+1;me<Fi;++me)switch(B.charCodeAt(me)){case 47:if(U===42&&B.charCodeAt(me-1)===42&&de+2!==me){de=me+1;break e}break;case 10:if(U===47){de=me+1;break e}}de=me}}break;case 91:U++;case 40:U++;case 34:case 39:for(;de++<Fi&&B.charCodeAt(de)!==U;);}if(ne===0)break;de++}switch(ne=B.substring(Qe,de),re===0&&(re=(he=he.replace(p,"").trim()).charCodeAt(0)),re){case 64:switch(0<ut&&(he=he.replace(c,"")),U=he.charCodeAt(1),U){case 100:case 109:case 115:case 45:ut=T;break;default:ut=M}if(ne=t(T,ut,ne,U,E+1),Qe=ne.length,0<P&&(ut=n(M,he,Fn),_e=l(3,ne,ut,T,b,Z,Qe,U,E,Y),he=ut.join(""),_e!==void 0&&(Qe=(ne=_e.trim()).length)===0&&(U=0,ne="")),0<Qe)switch(U){case 115:he=he.replace(A,s);case 100:case 109:case 45:ne=he+"{"+ne+"}";break;case 107:he=he.replace(m,"$1 $2"),ne=he+"{"+ne+"}",ne=k===1||k===2&&o("@"+ne,3)?"@-webkit-"+ne+"@"+ne:"@"+ne;break;default:ne=he+ne,Y===112&&(ne=(Ae+=ne,""))}else ne="";break;default:ne=t(T,n(T,he,Fn),ne,Y,E+1)}ht+=ne,ne=Fn=ut=me=re=0,he="",U=B.charCodeAt(++de);break;case 125:case 59:if(he=(0<ut?he.replace(c,""):he).trim(),1<(Qe=he.length))switch(me===0&&(re=he.charCodeAt(0),re===45||96<re&&123>re)&&(Qe=(he=he.replace(" ",":")).length),0<P&&(_e=l(1,he,T,I,b,Z,Ae.length,Y,E,Y))!==void 0&&(Qe=(he=_e.trim()).length)===0&&(he="\0\0"),re=he.charCodeAt(0),U=he.charCodeAt(1),re){case 0:break;case 64:if(U===105||U===99){zt+=he+B.charAt(de);break}default:he.charCodeAt(Qe-1)!==58&&(Ae+=r(he,re,U,he.charCodeAt(2)))}Fn=ut=me=re=0,he="",U=B.charCodeAt(++de)}}switch(U){case 13:case 10:V===47?V=0:1+re===0&&Y!==107&&0<he.length&&(ut=1,he+="\0"),0<P*G&&l(0,he,T,I,b,Z,Ae.length,Y,E,Y),Z=1,b++;break;case 59:case 125:if(V+j+te+W===0){Z++;break}default:switch(Z++,bt=B.charAt(de),U){case 9:case 32:if(j+W+V===0)switch(ue){case 44:case 58:case 9:case 32:bt="";break;default:U!==32&&(bt=" ")}break;case 0:bt="\\0";break;case 12:bt="\\f";break;case 11:bt="\\v";break;case 38:j+V+W===0&&(ut=Fn=1,bt="\f"+bt);break;case 108:if(j+V+W+R===0&&0<me)switch(de-me){case 2:ue===112&&B.charCodeAt(de-3)===58&&(R=ue);case 8:ce===111&&(R=ce)}break;case 58:j+V+W===0&&(me=de);break;case 44:V+te+j+W===0&&(ut=1,bt+="\r");break;case 34:case 39:V===0&&(j=j===U?0:j===0?U:j);break;case 91:j+V+te===0&&W++;break;case 93:j+V+te===0&&W--;break;case 41:j+V+W===0&&te--;break;case 40:if(j+V+W===0){if(re===0)switch(2*ue+3*ce){case 533:break;default:re=1}te++}break;case 64:V+te+j+W+me+ne===0&&(ne=1);break;case 42:case 47:if(!(0<j+W+te))switch(V){case 0:switch(2*U+3*B.charCodeAt(de+1)){case 235:V=47;break;case 220:Qe=de,V=42}break;case 42:U===47&&ue===42&&Qe+2!==de&&(B.charCodeAt(Qe+2)===33&&(Ae+=B.substring(Qe,de+1)),bt="",V=0)}}V===0&&(he+=bt)}ce=ue,ue=U,de++}if(Qe=Ae.length,0<Qe){if(ut=T,0<P&&(_e=l(2,Ae,ut,I,b,Z,Qe,Y,E,Y),_e!==void 0&&(Ae=_e).length===0))return zt+Ae+ht;if(Ae=ut.join(",")+"{"+Ae+"}",k*R!==0){switch(k!==2||o(Ae,2)||(R=0),R){case 111:Ae=Ae.replace(C,":-moz-$1")+Ae;break;case 112:Ae=Ae.replace(x,"::-webkit-input-$1")+Ae.replace(x,"::-moz-$1")+Ae.replace(x,":-ms-input-$1")+Ae}R=0}}return zt+Ae+ht}function n(I,T,B){var Y=T.trim().split(y);T=Y;var E=Y.length,W=I.length;switch(W){case 0:case 1:var V=0;for(I=W===0?"":I[0]+" ";V<E;++V)T[V]=i(I,T[V],B).trim();break;default:var te=V=0;for(T=[];V<E;++V)for(var j=0;j<W;++j)T[te++]=i(I[j]+" ",Y[V],B).trim()}return T}function i(I,T,B){var Y=T.charCodeAt(0);switch(33>Y&&(Y=(T=T.trim()).charCodeAt(0)),Y){case 38:return T.replace(g,"$1"+I.trim());case 58:return I.trim()+T.replace(g,"$1"+I.trim());default:if(0<1*B&&0<T.indexOf("\f"))return T.replace(g,(I.charCodeAt(0)===58?"":"$1")+I.trim())}return I+T}function r(I,T,B,Y){var E=I+";",W=2*T+3*B+4*Y;if(W===944){I=E.indexOf(":",9)+1;var V=E.substring(I,E.length-1).trim();return V=E.substring(0,I).trim()+V+";",k===1||k===2&&o(V,1)?"-webkit-"+V+V:V}if(k===0||k===2&&!o(E,1))return E;switch(W){case 1015:return E.charCodeAt(10)===97?"-webkit-"+E+E:E;case 951:return E.charCodeAt(3)===116?"-webkit-"+E+E:E;case 963:return E.charCodeAt(5)===110?"-webkit-"+E+E:E;case 1009:if(E.charCodeAt(4)!==100)break;case 969:case 942:return"-webkit-"+E+E;case 978:return"-webkit-"+E+"-moz-"+E+E;case 1019:case 983:return"-webkit-"+E+"-moz-"+E+"-ms-"+E+E;case 883:if(E.charCodeAt(8)===45)return"-webkit-"+E+E;if(0<E.indexOf("image-set(",11))return E.replace(D,"$1-webkit-$2")+E;break;case 932:if(E.charCodeAt(4)===45)switch(E.charCodeAt(5)){case 103:return"-webkit-box-"+E.replace("-grow","")+"-webkit-"+E+"-ms-"+E.replace("grow","positive")+E;case 115:return"-webkit-"+E+"-ms-"+E.replace("shrink","negative")+E;case 98:return"-webkit-"+E+"-ms-"+E.replace("basis","preferred-size")+E}return"-webkit-"+E+"-ms-"+E+E;case 964:return"-webkit-"+E+"-ms-flex-"+E+E;case 1023:if(E.charCodeAt(8)!==99)break;return V=E.substring(E.indexOf(":",15)).replace("flex-","").replace("space-between","justify"),"-webkit-box-pack"+V+"-webkit-"+E+"-ms-flex-pack"+V+E;case 1005:return v.test(E)?E.replace(f,":-webkit-")+E.replace(f,":-moz-")+E:E;case 1e3:switch(V=E.substring(13).trim(),T=V.indexOf("-")+1,V.charCodeAt(0)+V.charCodeAt(T)){case 226:V=E.replace(N,"tb");break;case 232:V=E.replace(N,"tb-rl");break;case 220:V=E.replace(N,"lr");break;default:return E}return"-webkit-"+E+"-ms-"+V+E;case 1017:if(E.indexOf("sticky",9)===-1)break;case 975:switch(T=(E=I).length-10,V=(E.charCodeAt(T)===33?E.substring(0,T):E).substring(I.indexOf(":",7)+1).trim(),W=V.charCodeAt(0)+(V.charCodeAt(7)|0)){case 203:if(111>V.charCodeAt(8))break;case 115:E=E.replace(V,"-webkit-"+V)+";"+E;break;case 207:case 102:E=E.replace(V,"-webkit-"+(102<W?"inline-":"")+"box")+";"+E.replace(V,"-webkit-"+V)+";"+E.replace(V,"-ms-"+V+"box")+";"+E}return E+";";case 938:if(E.charCodeAt(5)===45)switch(E.charCodeAt(6)){case 105:return V=E.replace("-items",""),"-webkit-"+E+"-webkit-box-"+V+"-ms-flex-"+V+E;case 115:return"-webkit-"+E+"-ms-flex-item-"+E.replace(z,"")+E;default:return"-webkit-"+E+"-ms-flex-line-pack"+E.replace("align-content","").replace(z,"")+E}break;case 973:case 989:if(E.charCodeAt(3)!==45||E.charCodeAt(4)===122)break;case 931:case 953:if(Q.test(I)===!0)return(V=I.substring(I.indexOf(":")+1)).charCodeAt(0)===115?r(I.replace("stretch","fill-available"),T,B,Y).replace(":fill-available",":stretch"):E.replace(V,"-webkit-"+V)+E.replace(V,"-moz-"+V.replace("fill-",""))+E;break;case 962:if(E="-webkit-"+E+(E.charCodeAt(5)===102?"-ms-"+E:"")+E,B+Y===211&&E.charCodeAt(13)===105&&0<E.indexOf("transform",10))return E.substring(0,E.indexOf(";",27)+1).replace(w,"$1-webkit-$2")+E}return E}function o(I,T){var B=I.indexOf(T===1?":":"{"),Y=I.substring(0,T!==3?B:10);return B=I.substring(B+1,I.length-1),_(T!==2?Y:Y.replace(q,"$1"),B,T)}function s(I,T){var B=r(T,T.charCodeAt(0),T.charCodeAt(1),T.charCodeAt(2));return B!==T+";"?B.replace(L," or ($1)").substring(4):"("+T+")"}function l(I,T,B,Y,E,W,V,te,j,re){for(var U=0,ue=T,ce;U<P;++U)switch(ce=H[U].call(h,I,ue,B,Y,E,W,V,te,j,re)){case void 0:case!1:case!0:case null:break;default:ue=ce}if(ue!==T)return ue}function a(I){switch(I){case void 0:case null:P=H.length=0;break;default:if(typeof I=="function")H[P++]=I;else if(typeof I=="object")for(var T=0,B=I.length;T<B;++T)a(I[T]);else G=!!I|0}return a}function u(I){return I=I.prefix,I!==void 0&&(_=null,I?typeof I!="function"?k=1:(k=2,_=I):k=0),u}function h(I,T){var B=I;if(33>B.charCodeAt(0)&&(B=B.trim()),ee=B,B=[ee],0<P){var Y=l(-1,T,B,B,b,Z,0,0,0,0);Y!==void 0&&typeof Y=="string"&&(T=Y)}var E=t(M,B,T,0,0);return 0<P&&(Y=l(-2,E,B,B,b,Z,E.length,0,0,0),Y!==void 0&&(E=Y)),ee="",R=0,Z=b=1,E}var p=/^\0+/g,c=/[\0\r\f]/g,f=/: */g,v=/zoo|gra/,w=/([,: ])(transform)/g,y=/,\r+?/g,g=/([\t\r\n ])*\f?&/g,m=/@(k\w+)\s*(\S*)\s*/,x=/::(place)/g,C=/:(read-only)/g,N=/[svh]\w+-[tblr]{2}/,A=/\(\s*(.*)\s*\)/g,L=/([\s\S]*?);/g,z=/-self|flex-/g,q=/[^]*?(:[rp][el]a[\w-]+)[^]*/,Q=/stretch|:\s*\w+\-(?:conte|avail)/,D=/([^-])(image-set\()/,Z=1,b=1,R=0,k=1,M=[],H=[],P=0,_=null,G=0,ee="";return h.use=a,h.set=u,e!==void 0&&u(e),h}var $h="/*|*/",yS=$h+"}";function xS(e){e&&fa.current.insert(e+"}")}var fa={current:null},bS=function(t,n,i,r,o,s,l,a,u,h){switch(t){case 1:{switch(n.charCodeAt(0)){case 64:return fa.current.insert(n+";"),"";case 108:if(n.charCodeAt(2)===98)return""}break}case 2:{if(a===0)return n+$h;break}case 3:switch(a){case 102:case 112:return fa.current.insert(i[0]+n),"";default:return n+(h===0?$h:"")}case-2:n.split(yS).forEach(xS)}},SS=function(t){t===void 0&&(t={});var n=t.key||"css",i;t.prefix!==void 0&&(i={prefix:t.prefix});var r=new wS(i),o={},s;{s=t.container||document.head;var l=document.querySelectorAll("style[data-emotion-"+n+"]");Array.prototype.forEach.call(l,function(h){var p=h.getAttribute("data-emotion-"+n);p.split(" ").forEach(function(c){o[c]=!0}),h.parentNode!==s&&s.appendChild(h)})}var a;r.use(t.stylisPlugins)(bS),a=function(p,c,f,v){var w=c.name;fa.current=f,r(p,c.styles),v&&(u.inserted[w]=!0)};var u={key:n,sheet:new vS({key:n,container:s,nonce:t.nonce,speedy:t.speedy}),nonce:t.nonce,inserted:o,registered:{},insert:a};return u},CS=!0;function kS(e,t,n){var i="";return n.split(" ").forEach(function(r){e[r]!==void 0?t.push(e[r]):i+=r+" "}),i}var ES=function(t,n,i){var r=t.key+"-"+n.name;if((i===!1||CS===!1)&&t.registered[r]===void 0&&(t.registered[r]=n.styles),t.inserted[n.name]===void 0){var o=n;do t.insert("."+r,o,t.sheet,!0),o=o.next;while(o!==void 0)}};function PS(e){for(var t=0,n,i=0,r=e.length;r>=4;++i,r-=4)n=e.charCodeAt(i)&255|(e.charCodeAt(++i)&255)<<8|(e.charCodeAt(++i)&255)<<16|(e.charCodeAt(++i)&255)<<24,n=(n&65535)*1540483477+((n>>>16)*59797<<16),n^=n>>>24,t=(n&65535)*1540483477+((n>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(r){case 3:t^=(e.charCodeAt(i+2)&255)<<16;case 2:t^=(e.charCodeAt(i+1)&255)<<8;case 1:t^=e.charCodeAt(i)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var NS={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},TS=/[A-Z]|^ms/g,IS=/_EMO_([^_]+?)_([^]*?)_EMO_/g,Ew=function(t){return t.charCodeAt(1)===45},Af=function(t){return t!=null&&typeof t!="boolean"},Ru=kw(function(e){return Ew(e)?e:e.replace(TS,"-$&").toLowerCase()}),Lf=function(t,n){switch(t){case"animation":case"animationName":if(typeof n=="string")return n.replace(IS,function(i,r,o){return Tn={name:r,styles:o,next:Tn},r})}return NS[t]!==1&&!Ew(t)&&typeof n=="number"&&n!==0?n+"px":n};function bs(e,t,n,i){if(n==null)return"";if(n.__emotion_styles!==void 0)return n;switch(typeof n){case"boolean":return"";case"object":{if(n.anim===1)return Tn={name:n.name,styles:n.styles,next:Tn},n.name;if(n.styles!==void 0){var r=n.next;if(r!==void 0)for(;r!==void 0;)Tn={name:r.name,styles:r.styles,next:Tn},r=r.next;var o=n.styles+";";return o}return RS(e,t,n)}case"function":{if(e!==void 0){var s=Tn,l=n(e);return Tn=s,bs(e,t,l,i)}break}}if(t==null)return n;var a=t[n];return a!==void 0&&!i?a:n}function RS(e,t,n){var i="";if(Array.isArray(n))for(var r=0;r<n.length;r++)i+=bs(e,t,n[r],!1);else for(var o in n){var s=n[o];if(typeof s!="object")t!=null&&t[s]!==void 0?i+=o+"{"+t[s]+"}":Af(s)&&(i+=Ru(o)+":"+Lf(o,s)+";");else if(Array.isArray(s)&&typeof s[0]=="string"&&(t==null||t[s[0]]===void 0))for(var l=0;l<s.length;l++)Af(s[l])&&(i+=Ru(o)+":"+Lf(o,s[l])+";");else{var a=bs(e,t,s,!1);switch(o){case"animation":case"animationName":{i+=Ru(o)+":"+a+";";break}default:i+=o+"{"+a+"}"}}}return i}var Ff=/label:\s*([^\s;\n{]+)\s*;/g,Tn,AS=function(t,n,i){if(t.length===1&&typeof t[0]=="object"&&t[0]!==null&&t[0].styles!==void 0)return t[0];var r=!0,o="";Tn=void 0;var s=t[0];s==null||s.raw===void 0?(r=!1,o+=bs(i,n,s,!1)):o+=s[0];for(var l=1;l<t.length;l++)o+=bs(i,n,t[l],o.charCodeAt(o.length-1)===46),r&&(o+=s[l]);Ff.lastIndex=0;for(var a="",u;(u=Ff.exec(o))!==null;)a+="-"+u[1];var h=PS(o)+a;return{name:h,styles:o,next:Tn}},Pw=le.createContext(typeof HTMLElement<"u"?SS():null),LS=le.createContext({});Pw.Provider;var FS=function(t){var n=function(r,o){return le.createElement(Pw.Consumer,null,function(s){return t(r,s,o)})};return le.forwardRef(n)},OS=fS,BS=function(t){return t!=="theme"&&t!=="innerRef"},Of=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?OS:BS};function Bf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function _S(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Bf(Object(n),!0).forEach(function(i){dS(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bf(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var MS=function(){return null},zS=function e(t,n){var i,r,o;n!==void 0&&(i=n.label,o=n.target,r=t.__emotion_forwardProp&&n.shouldForwardProp?function(h){return t.__emotion_forwardProp(h)&&n.shouldForwardProp(h)}:n.shouldForwardProp);var s=t.__emotion_real===t,l=s&&t.__emotion_base||t;typeof r!="function"&&s&&(r=t.__emotion_forwardProp);var a=r||Of(l),u=!a("as");return function(){var h=arguments,p=s&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(i!==void 0&&p.push("label:"+i+";"),h[0]==null||h[0].raw===void 0)p.push.apply(p,h);else{p.push(h[0][0]);for(var c=h.length,f=1;f<c;f++)p.push(h[f],h[0][f])}var v=FS(function(w,y,g){return le.createElement(LS.Consumer,null,function(m){var x=u&&w.as||l,C="",N=[],A=w;if(w.theme==null){A={};for(var L in w)A[L]=w[L];A.theme=m}typeof w.className=="string"?C=kS(y.registered,N,w.className):w.className!=null&&(C=w.className+" ");var z=AS(p.concat(N),y.registered,A);ES(y,z,typeof x=="string"),C+=y.key+"-"+z.name,o!==void 0&&(C+=" "+o);var q=u&&r===void 0?Of(x):a,Q={};for(var D in w)u&&D==="as"||q(D)&&(Q[D]=w[D]);Q.className=C,Q.ref=g||w.innerRef;var Z=le.createElement(x,Q),b=le.createElement(MS,null);return le.createElement(le.Fragment,null,b,Z)})});return v.displayName=i!==void 0?i:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",v.defaultProps=t.defaultProps,v.__emotion_real=v,v.__emotion_base=l,v.__emotion_styles=p,v.__emotion_forwardProp=r,Object.defineProperty(v,"toString",{value:function(){return"."+o}}),v.withComponent=function(w,y){return e(w,y!==void 0?_S({},n||{},{},y):n).apply(void 0,p)},v}},$S=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],Dh=zS.bind();$S.forEach(function(e){Dh[e]=Dh(e)});var DS=Object.create,Ms=Object.defineProperty,VS=Object.getOwnPropertyDescriptor,US=Object.getOwnPropertyNames,HS=Object.getPrototypeOf,WS=Object.prototype.hasOwnProperty,GS=(e,t,n)=>t in e?Ms(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,jS=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),XS=(e,t)=>{for(var n in t)Ms(e,n,{get:t[n],enumerable:!0})},Nw=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of US(t))!WS.call(e,r)&&r!==n&&Ms(e,r,{get:()=>t[r],enumerable:!(i=VS(t,r))||i.enumerable});return e},YS=(e,t,n)=>(n=e!=null?DS(HS(e)):{},Nw(!e||!e.__esModule?Ms(n,"default",{value:e,enumerable:!0}):n,e)),qS=e=>Nw(Ms({},"__esModule",{value:!0}),e),d=(e,t,n)=>GS(e,typeof t!="symbol"?t+"":t,n),KS=jS((e,t)=>{var n=-1,i=1,r=0;function o(b,R,k,M,H){if(b===R)return b?[[r,b]]:[];if(k!=null){var P=D(b,R,k);if(P)return P}var _=u(b,R),G=b.substring(0,_);b=b.substring(_),R=R.substring(_),_=p(b,R);var ee=b.substring(b.length-_);b=b.substring(0,b.length-_),R=R.substring(0,R.length-_);var I=s(b,R);return G&&I.unshift([r,G]),ee&&I.push([r,ee]),C(I,H),M&&f(I),I}function s(b,R){var k;if(!b)return[[i,R]];if(!R)return[[n,b]];var M=b.length>R.length?b:R,H=b.length>R.length?R:b,P=M.indexOf(H);if(P!==-1)return k=[[i,M.substring(0,P)],[r,H],[i,M.substring(P+H.length)]],b.length>R.length&&(k[0][0]=k[2][0]=n),k;if(H.length===1)return[[n,b],[i,R]];var _=c(b,R);if(_){var G=_[0],ee=_[1],I=_[2],T=_[3],B=_[4],Y=o(G,I),E=o(ee,T);return Y.concat([[r,B]],E)}return l(b,R)}function l(b,R){for(var k=b.length,M=R.length,H=Math.ceil((k+M)/2),P=H,_=2*H,G=new Array(_),ee=new Array(_),I=0;I<_;I++)G[I]=-1,ee[I]=-1;G[P+1]=0,ee[P+1]=0;for(var T=k-M,B=T%2!==0,Y=0,E=0,W=0,V=0,te=0;te<H;te++){for(var j=-te+Y;j<=te-E;j+=2){var re=P+j,U;j===-te||j!==te&&G[re-1]<G[re+1]?U=G[re+1]:U=G[re-1]+1;for(var ue=U-j;U<k&&ue<M&&b.charAt(U)===R.charAt(ue);)U++,ue++;if(G[re]=U,U>k)E+=2;else if(ue>M)Y+=2;else if(B){var ce=P+T-j;if(ce>=0&&ce<_&&ee[ce]!==-1){var ne=k-ee[ce];if(U>=ne)return a(b,R,U,ue)}}}for(var me=-te+W;me<=te-V;me+=2){var ce=P+me,ne;me===-te||me!==te&&ee[ce-1]<ee[ce+1]?ne=ee[ce+1]:ne=ee[ce-1]+1;for(var de=ne-me;ne<k&&de<M&&b.charAt(k-ne-1)===R.charAt(M-de-1);)ne++,de++;if(ee[ce]=ne,ne>k)V+=2;else if(de>M)W+=2;else if(!B){var re=P+T-me;if(re>=0&&re<_&&G[re]!==-1){var U=G[re],ue=P+U-re;if(ne=k-ne,U>=ne)return a(b,R,U,ue)}}}}return[[n,b],[i,R]]}function a(b,R,k,M){var H=b.substring(0,k),P=R.substring(0,M),_=b.substring(k),G=R.substring(M),ee=o(H,P),I=o(_,G);return ee.concat(I)}function u(b,R){if(!b||!R||b.charAt(0)!==R.charAt(0))return 0;for(var k=0,M=Math.min(b.length,R.length),H=M,P=0;k<H;)b.substring(P,H)==R.substring(P,H)?(k=H,P=k):M=H,H=Math.floor((M-k)/2+k);return N(b.charCodeAt(H-1))&&H--,H}function h(b,R){var k=b.length,M=R.length;if(k==0||M==0)return 0;k>M?b=b.substring(k-M):k<M&&(R=R.substring(0,k));var H=Math.min(k,M);if(b==R)return H;for(var P=0,_=1;;){var G=b.substring(H-_),ee=R.indexOf(G);if(ee==-1)return P;_+=ee,(ee==0||b.substring(H-_)==R.substring(0,_))&&(P=_,_++)}}function p(b,R){if(!b||!R||b.slice(-1)!==R.slice(-1))return 0;for(var k=0,M=Math.min(b.length,R.length),H=M,P=0;k<H;)b.substring(b.length-H,b.length-P)==R.substring(R.length-H,R.length-P)?(k=H,P=k):M=H,H=Math.floor((M-k)/2+k);return A(b.charCodeAt(b.length-H))&&H--,H}function c(b,R){var k=b.length>R.length?b:R,M=b.length>R.length?R:b;if(k.length<4||M.length*2<k.length)return null;function H(E,W,V){for(var te=E.substring(V,V+Math.floor(E.length/4)),j=-1,re="",U,ue,ce,ne;(j=W.indexOf(te,j+1))!==-1;){var me=u(E.substring(V),W.substring(j)),de=p(E.substring(0,V),W.substring(0,j));re.length<de+me&&(re=W.substring(j-de,j)+W.substring(j,j+me),U=E.substring(0,V-de),ue=E.substring(V+me),ce=W.substring(0,j-de),ne=W.substring(j+me))}return re.length*2>=E.length?[U,ue,ce,ne,re]:null}var P=H(k,M,Math.ceil(k.length/4)),_=H(k,M,Math.ceil(k.length/2)),G;if(!P&&!_)return null;_?P?G=P[4].length>_[4].length?P:_:G=_:G=P;var ee,I,T,B;b.length>R.length?(ee=G[0],I=G[1],T=G[2],B=G[3]):(T=G[0],B=G[1],ee=G[2],I=G[3]);var Y=G[4];return[ee,I,T,B,Y]}function f(b){for(var R=!1,k=[],M=0,H=null,P=0,_=0,G=0,ee=0,I=0;P<b.length;)b[P][0]==r?(k[M++]=P,_=ee,G=I,ee=0,I=0,H=b[P][1]):(b[P][0]==i?ee+=b[P][1].length:I+=b[P][1].length,H&&H.length<=Math.max(_,G)&&H.length<=Math.max(ee,I)&&(b.splice(k[M-1],0,[n,H]),b[k[M-1]+1][0]=i,M--,M--,P=M>0?k[M-1]:-1,_=0,G=0,ee=0,I=0,H=null,R=!0)),P++;for(R&&C(b),x(b),P=1;P<b.length;){if(b[P-1][0]==n&&b[P][0]==i){var T=b[P-1][1],B=b[P][1],Y=h(T,B),E=h(B,T);Y>=E?(Y>=T.length/2||Y>=B.length/2)&&(b.splice(P,0,[r,B.substring(0,Y)]),b[P-1][1]=T.substring(0,T.length-Y),b[P+1][1]=B.substring(Y),P++):(E>=T.length/2||E>=B.length/2)&&(b.splice(P,0,[r,T.substring(0,E)]),b[P-1][0]=i,b[P-1][1]=B.substring(0,B.length-E),b[P+1][0]=n,b[P+1][1]=T.substring(E),P++),P++}P++}}var v=/[^a-zA-Z0-9]/,w=/\s/,y=/[\r\n]/,g=/\n\r?\n$/,m=/^\r?\n\r?\n/;function x(b){function R(E,W){if(!E||!W)return 6;var V=E.charAt(E.length-1),te=W.charAt(0),j=V.match(v),re=te.match(v),U=j&&V.match(w),ue=re&&te.match(w),ce=U&&V.match(y),ne=ue&&te.match(y),me=ce&&E.match(g),de=ne&&W.match(m);return me||de?5:ce||ne?4:j&&!U&&ue?3:U||ue?2:j||re?1:0}for(var k=1;k<b.length-1;){if(b[k-1][0]==r&&b[k+1][0]==r){var M=b[k-1][1],H=b[k][1],P=b[k+1][1],_=p(M,H);if(_){var G=H.substring(H.length-_);M=M.substring(0,M.length-_),H=G+H.substring(0,H.length-_),P=G+P}for(var ee=M,I=H,T=P,B=R(M,H)+R(H,P);H.charAt(0)===P.charAt(0);){M+=H.charAt(0),H=H.substring(1)+P.charAt(0),P=P.substring(1);var Y=R(M,H)+R(H,P);Y>=B&&(B=Y,ee=M,I=H,T=P)}b[k-1][1]!=ee&&(ee?b[k-1][1]=ee:(b.splice(k-1,1),k--),b[k][1]=I,T?b[k+1][1]=T:(b.splice(k+1,1),k--))}k++}}function C(b,R){b.push([r,""]);for(var k=0,M=0,H=0,P="",_="",G;k<b.length;){if(k<b.length-1&&!b[k][1]){b.splice(k,1);continue}switch(b[k][0]){case i:H++,_+=b[k][1],k++;break;case n:M++,P+=b[k][1],k++;break;case r:var ee=k-H-M-1;if(R){if(ee>=0&&z(b[ee][1])){var I=b[ee][1].slice(-1);if(b[ee][1]=b[ee][1].slice(0,-1),P=I+P,_=I+_,!b[ee][1]){b.splice(ee,1),k--;var T=ee-1;b[T]&&b[T][0]===i&&(H++,_=b[T][1]+_,T--),b[T]&&b[T][0]===n&&(M++,P=b[T][1]+P,T--),ee=T}}if(L(b[k][1])){var I=b[k][1].charAt(0);b[k][1]=b[k][1].slice(1),P+=I,_+=I}}if(k<b.length-1&&!b[k][1]){b.splice(k,1);break}if(P.length>0||_.length>0){P.length>0&&_.length>0&&(G=u(_,P),G!==0&&(ee>=0?b[ee][1]+=_.substring(0,G):(b.splice(0,0,[r,_.substring(0,G)]),k++),_=_.substring(G),P=P.substring(G)),G=p(_,P),G!==0&&(b[k][1]=_.substring(_.length-G)+b[k][1],_=_.substring(0,_.length-G),P=P.substring(0,P.length-G)));var B=H+M;P.length===0&&_.length===0?(b.splice(k-B,B),k=k-B):P.length===0?(b.splice(k-B,B,[i,_]),k=k-B+1):_.length===0?(b.splice(k-B,B,[n,P]),k=k-B+1):(b.splice(k-B,B,[n,P],[i,_]),k=k-B+2)}k!==0&&b[k-1][0]===r?(b[k-1][1]+=b[k][1],b.splice(k,1)):k++,H=0,M=0,P="",_="";break}}b[b.length-1][1]===""&&b.pop();var Y=!1;for(k=1;k<b.length-1;)b[k-1][0]===r&&b[k+1][0]===r&&(b[k][1].substring(b[k][1].length-b[k-1][1].length)===b[k-1][1]?(b[k][1]=b[k-1][1]+b[k][1].substring(0,b[k][1].length-b[k-1][1].length),b[k+1][1]=b[k-1][1]+b[k+1][1],b.splice(k-1,1),Y=!0):b[k][1].substring(0,b[k+1][1].length)==b[k+1][1]&&(b[k-1][1]+=b[k+1][1],b[k][1]=b[k][1].substring(b[k+1][1].length)+b[k+1][1],b.splice(k+1,1),Y=!0)),k++;Y&&C(b,R)}function N(b){return b>=55296&&b<=56319}function A(b){return b>=56320&&b<=57343}function L(b){return A(b.charCodeAt(0))}function z(b){return N(b.charCodeAt(b.length-1))}function q(b){for(var R=[],k=0;k<b.length;k++)b[k][1].length>0&&R.push(b[k]);return R}function Q(b,R,k,M){return z(b)||L(M)?null:q([[r,b],[n,R],[i,k],[r,M]])}function D(b,R,k){var M=typeof k=="number"?{index:k,length:0}:k.oldRange,H=typeof k=="number"?null:k.newRange,P=b.length,_=R.length;if(M.length===0&&(H===null||H.length===0)){var G=M.index,ee=b.slice(0,G),I=b.slice(G),T=H?H.index:null;e:{var B=G+_-P;if(T!==null&&T!==B||B<0||B>_)break e;var Y=R.slice(0,B),E=R.slice(B);if(E!==I)break e;var W=Math.min(G,B),V=ee.slice(0,W),te=Y.slice(0,W);if(V!==te)break e;var j=ee.slice(W),re=Y.slice(W);return Q(V,j,re,I)}e:{if(T!==null&&T!==G)break e;var U=G,Y=R.slice(0,U),E=R.slice(U);if(Y!==ee)break e;var ue=Math.min(P-U,_-U),ce=I.slice(I.length-ue),ne=E.slice(E.length-ue);if(ce!==ne)break e;var j=I.slice(0,I.length-ue),re=E.slice(0,E.length-ue);return Q(ee,j,re,ce)}}if(M.length>0&&H&&H.length===0)e:{var V=b.slice(0,M.index),ce=b.slice(M.index+M.length),W=V.length,ue=ce.length;if(_<W+ue)break e;var te=R.slice(0,W),ne=R.slice(_-ue);if(V!==te||ce!==ne)break e;var j=b.slice(W,P-ue),re=R.slice(W,_-ue);return Q(V,j,re,ce)}return null}function Z(b,R,k,M){return o(b,R,k,M,!0)}Z.INSERT=i,Z.DELETE=n,Z.EQUAL=r,t.exports=Z}),Tw={};XS(Tw,{CoreViewer:()=>Rx,HOOKS:()=>Ga,Navigation:()=>Ax,PageProgression:()=>Fd,PageSide:()=>Aw,PageViewMode:()=>mI,Profiler:()=>Bw,ReadyState:()=>Lw,UserAgentBaseCss:()=>Py,UserAgentPageCss:()=>Ey,UserAgentTocCss:()=>Ny,UserAgentXml:()=>ky,ValidationTxt:()=>Cy,VivliostylePolyfillCss:()=>Ty,VivliostyleViewportCss:()=>Sy,VivliostyleViewportScreenCss:()=>by,ZoomType:()=>gI,getHooksForName:()=>Sn,isDebug:()=>Ss,pageProgressionOf:()=>Rw,plugin:()=>ZS,printHTML:()=>wI,profile:()=>nC,profiler:()=>Vt,registerHook:()=>hn,removeHook:()=>Ow,setDebug:()=>Iw});var dl=qS(Tw),Ss=!1;function Iw(e){Ss=e}var Fd=(e=>(e.LTR="ltr",e.RTL="rtl",e))(Fd||{});function Rw(e){switch(e){case"ltr":return"ltr";case"rtl":return"rtl";default:throw new Error(`unknown PageProgression: ${e}`)}}var Aw=(e=>(e.LEFT="left",e.RIGHT="right",e))(Aw||{}),Lw=(e=>(e.LOADING="loading",e.INTERACTIVE="interactive",e.COMPLETE="complete",e))(Lw||{}),Fw=(e=>(e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e))(Fw||{}),QS=class{constructor(e){this.opt_console=e,d(this,"listeners",{})}consoleDebug(e){this.opt_console?this.opt_console.debug?this.opt_console.debug(...e):this.opt_console.log(...e):console.debug(...e)}consoleInfo(e){this.opt_console?this.opt_console.info?this.opt_console.info(...e):this.opt_console.log(...e):console.info(...e)}consoleWarn(e){this.opt_console?this.opt_console.warn?this.opt_console.warn(...e):this.opt_console.log(...e):console.warn(...e)}consoleError(e){this.opt_console?this.opt_console.error?this.opt_console.error(...e):this.opt_console.log(...e):console.error(...e)}triggerListeners(e,t){let n=this.listeners[e];n&&n(t)}addListener(e,t){this.listeners[e]=t}debug(...e){let t=pl(arguments);this.consoleDebug(fl(t)),this.triggerListeners(1,t)}info(...e){let t=pl(arguments);this.consoleInfo(fl(t)),this.triggerListeners(2,t)}warn(...e){let t=pl(arguments);this.consoleWarn(fl(t)),this.triggerListeners(3,t)}error(...e){let t=pl(arguments);this.consoleError(fl(t)),this.triggerListeners(4,t)}};function pl(e){let t=Array.from(e),n=null;return t[0]instanceof Error&&(n=t.shift()),{error:n,messages:t}}function fl(e){let t=e.error,n=t&&(t.frameTrace||t.stack),i=[].concat(e.messages);return t&&(i.length>0&&(i=i.concat([`
`])),i=i.concat([t.toString()]),n&&(i=i.concat([`
`]).concat(n))),i}var se=new QS,Ga=(e=>(e.SIMPLE_PROPERTY="SIMPLE_PROPERTY",e.PREPROCESS_SINGLE_DOCUMENT="PREPROCESS_SINGLE_DOCUMENT",e.PREPROCESS_TEXT_CONTENT="PREPROCESS_TEXT_CONTENT",e.PREPROCESS_ELEMENT_STYLE="PREPROCESS_ELEMENT_STYLE",e.POLYFILLED_INHERITED_PROPS="POLYFILLED_INHERITED_PROPS",e.CONFIGURATION="CONFIGURATION",e.RESOLVE_TEXT_NODE_BREAKER="RESOLVE_TEXT_NODE_BREAKER",e.RESOLVE_FORMATTING_CONTEXT="RESOLVE_FORMATTING_CONTEXT",e.RESOLVE_LAYOUT_PROCESSOR="RESOLVE_LAYOUT_PROCESSOR",e.POST_LAYOUT_BLOCK="POST_LAYOUT_BLOCK",e))(Ga||{}),ga={};function hn(e,t,n){if(!Ga[e])se.warn(new Error(`Skipping unknown plugin hook '${e}'.`));else{let i=ga[e];i||(i=ga[e]=[]),n?i.unshift(t):i.push(t)}}function Ow(e,t){if(!Ga[e])se.warn(new Error(`Ignoring unknown plugin hook '${e}'.`));else{let n=ga[e];if(n){let i=n.indexOf(t);i>=0&&n.splice(i,1)}}}function Sn(e){return ga[e]||[]}var ZS={registerHook:hn,removeHook:Ow},Bw=class{constructor(e){this.performanceInstance=e,d(this,"timestamps",{}),d(this,"registerTiming"),d(this,"registerStartTiming"),d(this,"registerEndTiming"),this.registerTiming=lr,this.registerStartTiming=this.registerStartTiming=lr,this.registerEndTiming=this.registerEndTiming=lr}forceRegisterStartTiming(e,t){Au.call(this,e,"start",t)}forceRegisterEndTiming(e,t){Au.call(this,e,"end",t)}printTimings(){let e=this.timestamps,t="";Object.keys(e).forEach(n=>{let i=e[n],r=i.length;for(let o=0;o<r;o++){let s=i[o];t+=n,r>1&&(t+=`(${o})`),t+=` => start: ${s.start}, end: ${s.end}, duration: ${s.end-s.start}
`}}),se.info(t)}disable(){this.registerTiming=lr,this.registerStartTiming=this.registerStartTiming=lr,this.registerEndTiming=this.registerEndTiming=lr}enable(){this.registerTiming=Au,this.registerStartTiming=this.registerStartTiming=_f,this.registerEndTiming=this.registerEndTiming=JS}isEnabled(){return this.registerStartTiming===_f}};function lr(){}function Au(e,t,n){n||(n=this.performanceInstance.now());let i=this.timestamps[e];i||(i=this.timestamps[e]=[]);let r,o=i.length;for(let s=o-1;s>=0&&(r=i[s],!(r&&!r[t]));s--)r=null;r||(r={},i.push(r)),r[t]=n}function _f(e,t){this.registerTiming(e,"start",t)}function JS(e,t){this.registerTiming(e,"end",t)}var eC={now:Date.now},tC=window&&window.performance,Vt=new Bw(tC||eC);Vt.forceRegisterStartTiming("load_vivliostyle");var nC={profiler:{registerStartTiming:Vt.registerStartTiming,registerEndTiming:Vt.registerEndTiming,printTimings:Vt.printTimings,disable:Vt.disable,enable:Vt.enable}},Vh=new RegExp("^[\\s\\p{Zs}\\p{P}\\p{Mn}]*[\\p{L}\\p{N}]\\p{Mn}*(?:[\\s\\p{Zs}]*\\p{P}\\p{Mn}*)*","u"),Mn="data-adapt-eloff",iC={};function Od(e){return JSON.parse(e)}function Dn(e){let t=e.match(/^([^#]*)/);return t?t[1]:e}function rC(e){let t=e.match(/^([^#?]*)/);return t?t[1]:e}var qr=window.location.href;function Mf(e){qr=e}var tr=window.location.href;function zf(e){tr=e}function Ue(e,t){if(/^data:/i.test(t))return e||t;if(!t||e.match(/^\w{2,}:/))return e.toLowerCase().match("^javascript:")?"#":(e.match(/^\w{2,}:\/\/[^\/]+$/)&&(e=`${e}/`),e);t.match(/^\w{2,}:\/\/[^\/]+$/)&&(t=`${t}/`);let n;if(e.match(/^\/\//))return n=t.match(/^(\w{2,}:)\/\//),n?n[1]+e:e;if(e.match(/^\//))return n=t.match(/^(\w{2,}:\/\/[^\/]+)\//),n?n[1]+e:e;if(e.match(/^\.(\/|$)/)&&(e=e.substr(2)),t=rC(t),e.match(/^#/))return t+e;let i=t.lastIndexOf("/");if(i<0)return e;let r=t.substr(0,i+1)+e,o="";for(n=r.match(/^([^?#]*)([?#].*)$/),n&&(r=n[1],o=n[2]);i=r.indexOf("/../"),!(i<=0);){let s=r.lastIndexOf("/",i-1);if(s<=0)break;r=r.substr(0,s)+r.substr(i+3)}return r.replace(/\/(\.\/)+/g,"/")+o}function Cs(e){let t;return(t=/^(https?:)\/\/github\.com\/([^/]+\/[^/]+)\/(blob\/|tree\/|raw\/)?(.*)$/.exec(e))?e=`${t[1]}//raw.githubusercontent.com/${t[2]}/${t[3]?"":"master/"}${t[4]}`:(t=/^(https?:)\/\/www\.aozora\.gr\.jp\/(cards\/[^/]+\/files\/[^/.]+\.html)$/.exec(e))?e=`${t[1]}//raw.githubusercontent.com/aozorabunko/aozorabunko/master/${t[2]}`:(t=/^(https?:)\/\/gist\.github\.com\/([^/]+\/\w+)(\/|$)(raw(\/|$))?(.*)$/.exec(e))?e=`${t[1]}//gist.githubusercontent.com/${t[2]}/raw/${t[6]}`:(t=/^(https?:)\/\/gist\.github\.com\/([^/]+\/\w+)#file-(.*)-(\w+)$/.exec(e))?e=`${t[1]}//gist.githubusercontent.com/${t[2]}/raw/${t[3]}.${t[4]}`:(t=/^(https?:)\/\/(?:[^/.]+\.)?jsbin\.com\/(?!(?:blog|help)\b)(\w+)((\/\d+)?).*$/.exec(e))&&(e=`${t[1]}//output.jsbin.com/${t[2]}${t[3]}/`),e}function $f(e){return e==null?e:e.toString()}var oC=class{constructor(){d(this,"queue",[null])}length(){return this.queue.length-1}add(e){let t=this.queue.length;for(;t>1;){let n=Math.floor(t/2),i=this.queue[n];if(i.compare(e)>0){this.queue[t]=e;return}this.queue[t]=i,t=n}this.queue[1]=e}peek(){return this.queue[1]}remove(){let e=this.queue[1],t=this.queue.pop(),n=this.queue.length;if(n>1){let i=1;for(;;){let r=i*2;if(r>=n)break;if(this.queue[r].compare(t)>0)r+1<n&&this.queue[r+1].compare(this.queue[r])>0&&r++;else if(r+1<n&&this.queue[r+1].compare(t)>0)r++;else break;this.queue[i]=this.queue[r],i=r}this.queue[i]=t}return e}},_w=["","-webkit-","-moz-"],ur={};function Lu(e,t){return CSS.supports(e+t,"unset")}function sC(e){let t=ur[e];if(t||t===null)return t;switch(e){case"behavior":case"template":case"ua-list-item-count":case"x-first-pseudo":return ur[e]=null,null;case"text-combine-upright":if(Lu("-webkit-","text-combine")&&!Lu("","text-combine-upright"))return ur[e]=["-webkit-text-combine"],["-webkit-text-combine"];break}for(let n of _w)if(Lu(n,e))return t=[n+e],ur[e]=t,t;return se.warn("Property not supported by the browser: ",e),ur[e]=null,null}function O(e,t,n){let i=e==null?void 0:e.style;if(!i)return;if(t.startsWith("--")){i.setProperty(t,n||" ");return}let r=sC(t);if(r)for(let o of r){switch(o){case"-webkit-text-combine":switch(n){case"all":n="horizontal";break}break;case"text-combine-upright":switch(n){case"all":i.setProperty("text-indent","0");break}break}i.setProperty(o,n)}}function ai(e,t,n){try{let i=ur[t];return e.style.getPropertyValue(i?i[0]:t)}catch{}return n||""}function Uh(e){let t=e.getAttributeNS("http://www.w3.org/XML/1998/namespace","lang");return!t&&e.namespaceURI=="http://www.w3.org/1999/xhtml"&&(t=e.getAttribute("lang")),t}var Xn=class{constructor(){d(this,"list",[])}append(e){return this.list.push(e),this}clear(){this.list=[]}toString(){let e=this.list.join("");return this.list=[e],e}};function Mw(e){return`\\${e.charCodeAt(0).toString(16)} `}function yi(e){return e.replace(/[^-_a-zA-Z0-9\u0080-\uFFFF]/g,Mw)}function zs(e){return e.replace(/[\u0000-\u001F"\\]/g,Mw)}function Df(e){return e.replace(/[\s+&?=#\u007F-\uFFFF]+/g,encodeURIComponent)}function Vf(e){return!!e.match(/^[a-zA-Z\u009E\u009F\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u024F\u037B-\u037D\u0386\u0388-\u0482\u048A-\u0527]$/)}function lC(e,t){return t=typeof t=="string"?t:"\\u",t+(65536|e.charCodeAt(0)).toString(16).substr(1)}function zw(e,t){function n(i){return lC(i,t)}return e.replace(/[^-a-zA-Z0-9_]/g,n)}function ti(e){return zw(e)}function aC(e,t){return t=typeof t=="string"?t:"\\u",e.indexOf(t)===0?String.fromCharCode(parseInt(e.substring(t.length),16)):e}function uC(e,t){t=typeof t=="string"?t:"\\u";function n(r){return aC(r,t)}let i=new RegExp(`${ti(t)}[0-9a-fA-F]{4}`,"g");return e.replace(i,n)}function Ci(e,t){let n=0,i=e;for(;;){if(n==0||t(n-1),i==e||t(i),n==i)return n;let r=n+i>>1;t(r)?i=r:n=r+1}}function $w(e,t){return e-t}function Uf(e,t){let n={};for(let i of e){let r=t(i);r&&!n[r]&&(n[r]=i)}return n}function hC(e){let t={};for(let n=0;n<e.length;n++)t[e[n]]=!0;return t}function Fu(e,t){let n={};for(let i of e){let r=t(i);r&&(n[r]?n[r].push(i):n[r]=[i])}return n}function cC(e,t){let n={};for(let i in e)n[i]=t(e[i],i);return n}var Bd=class{constructor(){d(this,"listeners",{})}dispatchEvent(e){let t=this.listeners[e.type];if(t){e.target=this,e.currentTarget=this;for(let n=0;n<t.length;n++)t[n](e)}}addEventListener(e,t,n){if(n)return;let i=this.listeners[e];i?i.includes(t)||i.push(t):this.listeners[e]=[t]}removeEventListener(e,t,n){if(n)return;let i=this.listeners[e];if(i){let r=i.indexOf(t);r>=0&&i.splice(r,1)}}},Hi={audio:!0,canvas:!0,embed:!0,iframe:!0,img:!0,math:!0,object:!0,picture:!0,svg:!0,video:!0};function Dw(e){if(e.nodeType==1){let t=e.getAttribute("id");if(t)return t}return null}function dC(e){return`^${e}`}function Hf(e){return e.replace(/[\[\]\(\),=;^]/g,dC)}function pC(e){return e.substr(1)}function Hh(e){return e&&e.replace(/\^[\[\]\(\),=;^]/g,pC)}function fC(e){let t=[];do{let n=e.match(/^(\^,|[^,])*/),i=Hh(n[0]);if(e=e.substr(n[0].length+1),!e&&!t.length)return i;t.push(i)}while(e);return t}function Wf(e){let t={};for(;e;){let n=e.match(/^;([^;=]+)=(([^;]|\^;)*)/);if(!n)return t;t[n[1]]=fC(n[2]),e=e.substr(n[0].length)}return t}var Gf=class{appendTo(e){e.append("!")}applyTo(e){return!1}},jf=class{constructor(e,t,n){this.index=e,this.id=t,this.sideBias=n}appendTo(e){e.append("/"),e.append(this.index.toString()),(this.id||this.sideBias)&&(e.append("["),this.id&&e.append(this.id),this.sideBias&&(e.append(";s="),e.append(this.sideBias)),e.append("]"))}applyTo(e){if(e.node.nodeType!=1)throw new Error("E_CFI_NOT_ELEMENT");let t=e.node,n=t.children,i=n.length,r,o=Math.floor(this.index/2)-1;if(o<0||i==0)r=t.firstChild,e.node=r||t;else{if(r=n[Math.min(o,i-1)],this.index&1){let s=r.nextSibling;!s||s.nodeType==1?e.after=!0:r=s}e.node=r}if(this.id&&(e.after||this.id!=Dw(e.node))){let s=t.ownerDocument.getElementById(this.id);s?e.node=s:se.warn("E_CFI_ID_MISMATCH:",this.id)}return e.sideBias=this.sideBias,!0}},Xf=class{constructor(e,t,n,i){this.offset=e,this.textBefore=t,this.textAfter=n,this.sideBias=i}applyTo(e){if(this.offset>0&&!e.after){let t=this.offset,n=e.node;for(;;){let i=n.nodeType;if(i==1)break;let r=n.nextSibling;if(3<=i&&i<=5){let o=n.textContent.length;if(t<=o)break;if(!r){t=o;break}t-=o}if(!r){t=0;break}n=r}e.node=n,e.offset=t}return e.sideBias=this.sideBias,!0}appendTo(e){e.append(":"),e.append(this.offset.toString()),(this.textBefore||this.textAfter||this.sideBias)&&(e.append("["),(this.textBefore||this.textAfter)&&(this.textBefore&&e.append(Hf(this.textBefore)),e.append(","),this.textAfter&&e.append(Hf(this.textAfter))),this.sideBias&&(e.append(";s="),e.append(this.sideBias)),e.append("]"))}},Yf=class Vw{constructor(){d(this,"steps",null)}fromString(t){let n=t.match(/^#?epubcfi\((.*)\)$/);if(!n)throw new Error("E_CFI_NOT_CFI");let i=decodeURIComponent(n[1]),r=0,o=[];for(;;){let s;switch(i.charAt(r)){case"/":{if(r++,n=i.substr(r).match(/^(0|[1-9][0-9]*)(\[(.*?)(;([^\]]|\^\])*)?\])?/),!n)throw new Error("E_CFI_NUMBER_EXPECTED");r+=n[0].length;let l=parseInt(n[1],10),a=n[3];s=Wf(n[4]),o.push(new jf(l,a,$f(s.s)));break}case":":{if(r++,n=i.substr(r).match(/^(0|[1-9][0-9]*)(\[((([^\];,]|\^[\];,])*)(,(([^\];,]|\^[\];,])*))?)(;([^]]|\^\])*)?\])?/),!n)throw new Error("E_CFI_NUMBER_EXPECTED");r+=n[0].length;let l=parseInt(n[1],10),a=n[4];a&&(a=Hh(a));let u=n[7];u&&(u=Hh(u)),s=Wf(n[10]),o.push(new Xf(l,a,u,$f(s.s)));break}case"!":r++,o.push(new Gf);break;case"~":case"@":case"":this.steps=o;return;default:throw new Error("E_CFI_PARSE_ERROR")}}}navigate(t){let n={node:t.documentElement,offset:0,after:!1,sideBias:null,ref:null};for(let i=0;i<this.steps.length;i++)if(!this.steps[i].applyTo(n)){n.ref=new Vw,n.ref.steps=this.steps.slice(i+1);break}return n}trim(t,n){return t.replace(/\s+/g," ").match(n?/^[ -\uD7FF\uE000-\uFFFF]{0,8}/:/[ -\uD7FF\uE000-\uFFFF]{0,8}$/)[0].replace(/^\s/,"").replace(/\s$/,"")}prependPathFromNode(t,n,i,r){let o=[],s=t.parentNode,l="",a="";for(;t;){switch(t.nodeType){case 3:case 4:case 5:{let u=t.textContent,h=u.length;i?(n+=h,l||(l=u)):(n>h&&(n=h),i=!0,l=u.substr(0,n),a=u.substr(n)),t=t.previousSibling;continue}case 8:t=t.previousSibling;continue}break}for((n>0||l||a)&&(l=this.trim(l,!1),a=this.trim(a,!0),o.push(new Xf(n,l,a,r)),r=null);s&&!(!s||s.nodeType==9);){let u=i?null:Dw(t),h=i?1:0;for(;t;)t.nodeType==1&&(h+=2),t=t.previousSibling;o.push(new jf(h,u,r)),r=null,t=s,s=s.parentNode,i=!1}o.reverse(),this.steps?(o.push(new Gf),this.steps=o.concat(this.steps)):this.steps=o}toString(){if(!this.steps)return"";let t=new Xn;t.append("epubcfi(");for(let n=0;n<this.steps.length;n++)this.steps[n].appendTo(t);return t.append(")"),t.toString().replace(/%/g,"%25")}};function Uw(){return{fontFamily:"serif",lineHeight:1.25,margin:8,hyphenate:!1,columnWidth:25,horizontal:!1,nightMode:!1,spreadView:!1,pageBorder:1,enabledMediaTypes:{vivliostyle:!0,print:!0},defaultPaperSize:void 0}}function Hw(e){return{fontFamily:e.fontFamily,lineHeight:e.lineHeight,margin:e.margin,hyphenate:e.hyphenate,columnWidth:e.columnWidth,horizontal:e.horizontal,nightMode:e.nightMode,spreadView:e.spreadView,pageBorder:e.pageBorder,enabledMediaTypes:Object.assign({},e.enabledMediaTypes),defaultPaperSize:e.defaultPaperSize?Object.assign({},e.defaultPaperSize):void 0}}var gC=Uw(),qf={PENDING:{}};function Ww(e,t,n,i){let r=Math.min((e-0)/n,(t-0)/i);return`matrix(${r},0,0,${r},0,0)`}function Ou(e){return`"${zs(`${e}`)}"`}function mC(e){return yi(`${e}`)}function Wh(e,t){return e?`${yi(e)}.${yi(t)}`:yi(t)}var Gw=0,Gh=class{constructor(e,t){if(this.parent=e,this.resolver=t,d(this,"scopeKey"),d(this,"children",[]),d(this,"zero"),d(this,"one"),d(this,"_true"),d(this,"_false"),d(this,"values",{}),d(this,"funcs",{}),d(this,"builtIns",{}),this.scopeKey=`S${Gw++}`,this.zero=new nt(this,0),this.one=new nt(this,1),this._true=new nt(this,!0),this._false=new nt(this,!1),e&&e.children.push(this),!e){let n=this.builtIns;n.floor=Math.floor,n.ceil=Math.ceil,n.round=Math.round,n.sqrt=Math.sqrt,n.min=Math.min,n.max=Math.max,n.letterbox=Ww,n["css-string"]=Ou,n["css-name"]=mC,n.typeof=i=>typeof i,this.defineBuiltInName("page-width",function(){return this.pageWidth()}),this.defineBuiltInName("page-height",function(){return this.pageHeight()}),this.defineBuiltInName("pref-font-family",function(){return this.pref.fontFamily}),this.defineBuiltInName("pref-night-mode",function(){return this.pref.nightMode}),this.defineBuiltInName("pref-hyphenate",function(){return this.pref.hyphenate}),this.defineBuiltInName("pref-margin",function(){return this.pref.margin}),this.defineBuiltInName("pref-line-height",function(){return this.pref.lineHeight}),this.defineBuiltInName("pref-column-width",function(){return this.pref.columnWidth*this.fontSize}),this.defineBuiltInName("pref-horizontal",function(){return this.pref.horizontal}),this.defineBuiltInName("pref-spread-view",function(){return this.pref.spreadView}),this.defineBuiltInName("pub-title",function(){return Ou(this.pubTitle?this.pubTitle:"")}),this.defineBuiltInName("doc-title",function(){return Ou(this.docTitle?this.docTitle:"")})}}defineBuiltInName(e,t){this.values[e]=new st(this,t,e)}defineName(e,t){this.values[e]=t}defineFunc(e,t){this.funcs[e]=t}defineBuiltIn(e,t){this.builtIns[e]=t}};function vC(e){switch(e==null?void 0:e.toLowerCase()){case"px":case"in":case"pt":case"pc":case"cm":case"mm":case"q":return!0;default:return!1}}function jw(e){switch(e==null?void 0:e.toLowerCase()){case"vw":case"vh":case"vi":case"vb":case"vmin":case"vmax":case"pvw":case"pvh":case"pvi":case"pvb":case"pvmin":case"pvmax":return!0;default:return!1}}function wC(e){switch(e==null?void 0:e.toLowerCase()){case"em":case"ex":case"rem":case"lh":case"rlh":return!0;default:return!1}}function yC(e){switch(e==null?void 0:e.toLowerCase()){case"rem":case"rlh":return!0;default:return!1}}var Te={px:1,in:96,pt:4/3,pc:96/6,cm:96/2.54,mm:96/25.4,q:96/2.54/40,em:16,rem:16,ex:8,lh:20,rlh:20,dppx:1,dpi:1/96,dpcm:2.54/96};function Xw(e){switch(e){case"q":return!CSS.supports("font-size","1q");case"lh":return!CSS.supports("line-height","1lh");case"rem":case"rlh":return!0;default:return!1}}var jh=class{constructor(e,t,n,i){this.rootScope=e,this.viewportWidth=t,this.viewportHeight=n,d(this,"actualPageWidth",null),d(this,"pageWidth"),d(this,"actualPageHeight",null),d(this,"pageHeight"),d(this,"initialFontSize"),d(this,"rootFontSize",null),d(this,"isRelativeRootFontSize",null),d(this,"fontSize"),d(this,"rootLineHeight",null),d(this,"pref"),d(this,"scopes",{}),d(this,"pageAreaWidth",null),d(this,"pageAreaHeight",null),d(this,"pageVertical",null),d(this,"pubTitle",null),d(this,"docTitle",null),this.pageWidth=function(){return this.actualPageWidth?this.actualPageWidth:this.pref.spreadView?Math.floor(t/2)-this.pref.pageBorder:t},this.pageHeight=function(){return this.actualPageHeight?this.actualPageHeight:n},this.initialFontSize=i,this.fontSize=function(){return this.rootFontSize?this.rootFontSize:i},this.pref=gC}getScopeContext(e){let t=this.scopes[e.scopeKey];return t||(t={},this.scopes[e.scopeKey]=t),t}clearScope(e){this.scopes[e.scopeKey]={};for(let t=0;t<e.children.length;t++)this.clearScope(e.children[t])}queryUnitSize(e,t,n){if(jw(e)){let i=this.pageWidth()/100,r=this.pageHeight()/100,o=this.pageAreaWidth!=null?this.pageAreaWidth/100:i,s=this.pageAreaHeight!=null?this.pageAreaHeight/100:r,l=n??this.pageVertical;switch(e){case"vw":return o;case"vh":return s;case"vi":return l?s:o;case"vb":return l?o:s;case"vmin":return o<s?o:s;case"vmax":return o>s?o:s;case"pvw":return i;case"pvh":return r;case"pvi":return l?r:i;case"pvb":return l?i:r;case"pvmin":return i<r?i:r;case"pvmax":return i>r?i:r}}return e=="em"||e=="rem"?t?this.initialFontSize:this.fontSize():e=="ex"?Te.ex*(t?this.initialFontSize:this.fontSize())/Te.em:e=="lh"||e=="rlh"?this.rootLineHeight:Te[e]}evalName(e,t){do{let n=e.values[t];if(n||e.resolver&&(n=e.resolver.call(this,t,!1),n))return n;e=e.parent}while(e);throw new Error(`Name '${t}' is undefined`)}evalCall(e,t,n,i){do{let r=e.funcs[t];if(r||e.resolver&&(r=e.resolver.call(this,t,!0),r))return r;let o=e.builtIns[t];if(o){if(i)return e.zero;let s=Array(n.length);for(let l=0;l<n.length;l++)s[l]=n[l].evaluate(this);return new nt(e,o.apply(this,s))}e=e.parent}while(e);throw new Error(`Function '${t}' is undefined`)}evalMediaName(e,t){let n=e==="all"||!!this.pref.enabledMediaTypes[e];return t?!n:n}evalMediaTest(e,t){let n="",i=e.match(/^(min|max)-(.*)$/);i&&(n=i[1],e=i[2]);let r=null,o=null;switch(e){case"width":case"height":case"device-width":case"device-height":case"color":t&&(r=t.evaluate(this));break}switch(e){case"width":o=this.pageWidth();break;case"height":o=this.pageHeight();break;case"device-width":o=window.screen.availWidth;break;case"device-height":o=window.screen.availHeight;break;case"color":o=window.screen.pixelDepth;break}if(o!=null&&r!=null)switch(n){case"min":return o>=Number(r);case"max":return o<=Number(r);default:return o==r}else if(o!=null&&t==null)return o!==0;return!1}evalSupportsTest(e,t,n){return!1}queryVal(e,t){let n=e&&this.scopes[e.scopeKey];return n?n[t]:void 0}storeVal(e,t,n){this.getScopeContext(e)[t]=n}},pn=class{constructor(e){this.scope=e,d(this,"key"),this.scope=e,this.key=`_${Gw++}`}toString(){let e=new Xn;return this.appendTo(e,0),e.toString()}appendTo(e,t){throw new Error("F_ABSTRACT")}evaluateCore(e){throw new Error("F_ABSTRACT")}expand(e,t){return this}dependCore(e,t,n){return e===this}dependOuter(e,t,n){let i=n[this.key];if(i!=null)return i===qf.PENDING?!1:i;{n[this.key]=qf.PENDING;let r=this.dependCore(e,t,n);return n[this.key]=r,r}}depend(e,t){return this.dependOuter(e,t,{})}evaluate(e){let t=e.queryVal(this.scope,this.key);return typeof t<"u"||(t=this.evaluateCore(e),this.scope&&e.storeVal(this.scope,this.key,t)),t}isMediaName(){return!1}},Yw=class extends pn{constructor(e,t){super(e),this.val=t}getOp(){throw new Error("F_ABSTRACT")}evalPrefix(e){throw new Error("F_ABSTRACT")}evaluateCore(e){let t=this.val.evaluate(e);return this.evalPrefix(t)}dependCore(e,t,n){return e===this||this.val.dependOuter(e,t,n)}appendTo(e,t){10<t&&e.append("("),e.append(this.getOp()),this.val.appendTo(e,10),10<t&&e.append(")")}expand(e,t){let n=this.val.expand(e,t);return n===this.val?this:new this.constructor(this.scope,n)}},ja=class extends pn{constructor(e,t,n){super(e),this.lhs=t,this.rhs=n}getPriority(){throw new Error("F_ABSTRACT")}getOp(){throw new Error("F_ABSTRACT")}evalInfix(e,t){throw new Error("F_ABSTRACT")}evaluateCore(e){let t=this.lhs.evaluate(e),n=this.rhs.evaluate(e);return this.evalInfix(t,n)}dependCore(e,t,n){return e===this||this.lhs.dependOuter(e,t,n)||this.rhs.dependOuter(e,t,n)}appendTo(e,t){let n=this.getPriority();n<=t&&e.append("("),this.lhs.appendTo(e,n),e.append(this.getOp()),this.rhs.appendTo(e,n),n<=t&&e.append(")")}expand(e,t){let n=this.lhs.expand(e,t),i=this.rhs.expand(e,t);return n===this.lhs&&i===this.rhs?this:new this.constructor(this.scope,n,i)}},qw=class extends ja{constructor(e,t,n){super(e,t,n)}getPriority(){return 1}},io=class extends ja{constructor(e,t,n){super(e,t,n)}getPriority(){return 2}},Kw=class extends ja{constructor(e,t,n){super(e,t,n)}getPriority(){return 3}},_d=class extends ja{constructor(e,t,n){super(e,t,n)}getPriority(){return 4}},xi=class extends Yw{constructor(e,t){super(e,t)}getOp(){return"!"}evalPrefix(e){return!e}},xC=class extends xi{constructor(e,t){super(e,t)}getOp(){return"not "}},Pr=class extends Yw{constructor(e,t){super(e,t)}getOp(){return"-"}evalPrefix(e){return-e}},Md=class extends qw{constructor(e,t,n){super(e,t,n)}getOp(){return"&&"}evaluateCore(e){return this.lhs.evaluate(e)&&this.rhs.evaluate(e)}},bC=class extends Md{constructor(e,t,n){super(e,t,n)}getOp(){return" and "}},zd=class extends qw{constructor(e,t,n){super(e,t,n)}getOp(){return"||"}evaluateCore(e){return this.lhs.evaluate(e)||this.rhs.evaluate(e)}},SC=class extends zd{constructor(e,t,n){super(e,t,n)}getOp(){return", "}},CC=class extends zd{constructor(e,t,n){super(e,t,n)}getOp(){return" or "}},kC=class extends io{constructor(e,t,n){super(e,t,n)}getOp(){return"<"}evalInfix(e,t){return e<t}},EC=class extends io{constructor(e,t,n){super(e,t,n)}getOp(){return"<="}evalInfix(e,t){return e<=t}},PC=class extends io{constructor(e,t,n){super(e,t,n)}getOp(){return">"}evalInfix(e,t){return e>t}},Xh=class extends io{constructor(e,t,n){super(e,t,n)}getOp(){return">="}evalInfix(e,t){return e>=t}},$d=class extends io{constructor(e,t,n){super(e,t,n)}getOp(){return"=="}evalInfix(e,t){return e==t}},NC=class extends io{constructor(e,t,n){super(e,t,n)}getOp(){return"!="}evalInfix(e,t){return e!=t}},Qw=class extends Kw{constructor(e,t,n){super(e,t,n)}getOp(){return"+"}evalInfix(e,t){return e+t}},Zw=class extends Kw{constructor(e,t,n){super(e,t,n)}getOp(){return" - "}evalInfix(e,t){return e-t}},Dd=class extends _d{constructor(e,t,n){super(e,t,n)}getOp(){return"*"}evalInfix(e,t){return e*t}},Jw=class extends _d{constructor(e,t,n){super(e,t,n)}getOp(){return"/"}evalInfix(e,t){return e/t}},ey=class extends _d{constructor(e,t,n){super(e,t,n)}getOp(){return"%"}evalInfix(e,t){return e%t}},$s=class extends pn{constructor(e,t,n){var i;super(e),this.num=t,d(this,"unit"),this.unit=(i=n==null?void 0:n.toLowerCase())!=null?i:""}appendTo(e,t){e.append(this.num.toString()),e.append(yi(this.unit))}evaluateCore(e){return this.num*e.queryUnitSize(this.unit,!1)}},qe=class extends pn{constructor(e,t){super(e),this.qualifiedName=t}appendTo(e,t){e.append(this.qualifiedName)}evaluateCore(e){return e.evalName(this.scope,this.qualifiedName).evaluate(e)}dependCore(e,t,n){return e===this||t.evalName(this.scope,this.qualifiedName).dependOuter(e,t,n)}},Kf=class extends pn{constructor(e,t,n){super(e),this.not=t,this.name=n}appendTo(e,t){this.not&&e.append("not "),e.append(yi(this.name))}evaluateCore(e){return e.evalMediaName(this.name,this.not)}isMediaName(){return!0}},st=class extends pn{constructor(e,t,n){super(e),this.fn=t,this.str=n}appendTo(e,t){e.append(this.str)}evaluateCore(e){return this.fn.call(e)}};function TC(e,t){e.append("(");for(let n=0;n<t.length;n++)n&&e.append(","),t[n].appendTo(e,0);e.append(")")}function IC(e,t,n){let i=t;for(let r=0;r<t.length;r++){let o=t[r].expand(e,n);if(t!==i)i[r]=o;else if(o!==t[r]){i=Array(t.length);for(let s=0;s<r;s++)i[s]=t[s];i[r]=o}}return i}var Go=class ty extends pn{constructor(t,n,i){super(t),this.qualifiedName=n,this.params=i}appendTo(t,n){t.append(this.qualifiedName),TC(t,this.params)}evaluateCore(t){return t.evalCall(this.scope,this.qualifiedName,this.params,!1).expand(t,this.params).evaluate(t)}dependCore(t,n,i){if(t===this)return!0;for(let r=0;r<this.params.length;r++)if(this.params[r].dependOuter(t,n,i))return!0;return n.evalCall(this.scope,this.qualifiedName,this.params,!0).dependOuter(t,n,i)}expand(t,n){let i=IC(t,this.params,n);return i===this.params?this:new ty(this.scope,this.qualifiedName,i)}},RC=class ny extends pn{constructor(t,n,i,r){super(t),this.cond=n,this.ifTrue=i,this.ifFalse=r}appendTo(t,n){n>0&&t.append("("),this.cond.appendTo(t,0),t.append("?"),this.ifTrue.appendTo(t,0),t.append(":"),this.ifFalse.appendTo(t,0),n>0&&t.append(")")}evaluateCore(t){return this.cond.evaluate(t)?this.ifTrue.evaluate(t):this.ifFalse.evaluate(t)}dependCore(t,n,i){return t===this||this.cond.dependOuter(t,n,i)||this.ifTrue.dependOuter(t,n,i)||this.ifFalse.dependOuter(t,n,i)}expand(t,n){let i=this.cond.expand(t,n),r=this.ifTrue.expand(t,n),o=this.ifFalse.expand(t,n);return i===this.cond&&r===this.ifTrue&&o===this.ifFalse?this:new ny(this.scope,i,r,o)}},nt=class extends pn{constructor(e,t){super(e),this.val=t}appendTo(e,t){switch(typeof this.val){case"number":case"boolean":e.append(this.val.toString());break;case"string":e.append('"'),e.append(zs(this.val)),e.append('"');break;default:throw new Error("F_UNEXPECTED_STATE")}}evaluateCore(e){return this.val}},Qf=class iy extends pn{constructor(t,n,i){super(t),this.name=n,this.value=i}appendTo(t,n){t.append("("),t.append(zs(this.name.name)),t.append(":"),this.value.appendTo(t,0),t.append(")")}evaluateCore(t){return t.evalMediaTest(this.name.name,this.value)}dependCore(t,n,i){return t===this||this.value.dependOuter(t,n,i)}expand(t,n){let i=this.value.expand(t,n);return i===this.value?this:new iy(this.scope,this.name,i)}},AC=class extends pn{constructor(e,t,n,i){super(e),this.name=t,this.value=n,this.isFunc=i}appendTo(e,t){this.isFunc&&e.append(this.name),e.append("("),!this.isFunc&&this.name&&(e.append(this.name),e.append(":")),e.append(this.value),e.append(")")}evaluateCore(e){return e.evalSupportsTest(this.name,this.value,this.isFunc)}},ry=class extends pn{constructor(e,t){super(e),this.index=t}appendTo(e,t){e.append("$"),e.append(this.index.toString())}expand(e,t){let n=t[this.index];if(!n)throw new Error(`Parameter missing: ${this.index}`);return n}};function an(e,t,n){return t===e._false||t===e.zero||n==e._false||n==e.zero?e._false:t===e._true||t===e.one?n:n===e._true||n===e.one?t:new Md(e,t,n)}function pe(e,t,n){return t===e.zero?n:n===e.zero?t:new Qw(e,t,n)}function Se(e,t,n){return t===e.zero?new Pr(e,n):n===e.zero?t:new Zw(e,t,n)}function Bl(e,t,n){return t===e.zero||n===e.zero?e.zero:t===e.one?n:n===e.one?t:new Dd(e,t,n)}function Yh(e,t,n){return t===e.zero?e.zero:n===e.one?t:new Jw(e,t,n)}var Jn=class{visitValues(e){for(let t=0;t<e.length;t++)e[t].visit(this);return null}visitEmpty(e){return null}visitSlash(e){return null}visitStr(e){return null}visitIdent(e){return null}visitNumeric(e){return null}visitNum(e){return null}visitInt(e){return this.visitNum(e)}visitHexColor(e){return null}visitURL(e){return null}visitURange(e){return null}visitSpaceList(e){return this.visitValues(e.values),null}visitCommaList(e){return this.visitValues(e.values),null}visitFunc(e){return this.visitValues(e.values),null}visitExpr(e){return null}},ro=class extends Jn{constructor(){super(),d(this,"error",!1)}visitValues(e){let t=null;for(let n=0;n<e.length;n++){let i=e[n],r=i.visit(this);if(this.error)return[];if(t)t[n]=r;else if(i!==r){t=new Array(e.length);for(let o=0;o<n;o++)t[o]=e[o];t[n]=r}}return t||e}visitEmpty(e){return e}visitStr(e){return e}visitIdent(e){return e}visitSlash(e){return e}visitNumeric(e){return e}visitNum(e){return e}visitInt(e){return e}visitHexColor(e){return e}visitURL(e){return e}visitURange(e){return e}visitSpaceList(e){let t=this.visitValues(e.values);return this.error?ae:t===e.values?e:new Be(t)}visitCommaList(e){let t=this.visitValues(e.values);return this.error?ae:t===e.values?e:new Rt(t)}visitFunc(e){let t=this.visitValues(e.values);return this.error?ae:t===e.values?e:new oo(e.name,t)}visitExpr(e){return e}},vt=class{toString(){let e=new Xn;return this.appendTo(e,!0),e.toString()}stringValue(){let e=new Xn;return this.appendTo(e,!1),e.toString()}toExpr(e,t){return null}appendTo(e,t){e.append("[error]")}isExpr(){return!1}isNumeric(){return!1}isNum(){return!1}isIdent(){return!1}isSpaceList(){return!1}visit(e){return this}},oy=class sy extends vt{static get instance(){return this.empty||(this.empty=new sy),this.empty}constructor(){super()}toExpr(t,n){return new nt(t,"")}appendTo(t,n){}visit(t){return t.visitEmpty(this)}};d(oy,"empty");var LC=oy,ae=LC.instance,ly=class ay extends vt{static get instance(){return this.slash||(this.slash=new ay),this.slash}constructor(){super()}toExpr(t,n){return new nt(t,"/")}appendTo(t,n){t.append("/")}visit(t){return t.visitSlash(this)}};d(ly,"slash");var FC=ly,Xa=FC.instance,Je=class extends vt{constructor(e){super(),this.str=e}toExpr(e,t){return new nt(e,this.str)}appendTo(e,t){t?(e.append('"'),e.append(zs(this.str)),e.append('"')):e.append(this.str)}visit(e){return e.visitStr(this)}},qh={},Xt=class extends vt{constructor(e){if(super(),this.name=e,qh[e])throw new Error("E_INVALID_CALL");qh[e]=this}toExpr(e,t){return new nt(e,this.name)}appendTo(e,t){t?e.append(yi(this.name)):e.append(this.name)}visit(e){return e.visitIdent(this)}isIdent(){return!0}};function K(e){let t=qh[e];return t||(t=new Xt(e)),t}var $=class extends vt{constructor(e,t){var n;super(),this.num=e,d(this,"unit"),this.unit=(n=t==null?void 0:t.toLowerCase())!=null?n:""}toExpr(e,t){return this.num==0?e.zero:t&&this.unit=="%"?this.num==100?t:new Dd(e,t,new nt(e,this.num/100)):new $s(e,this.num,this.unit)}appendTo(e,t){e.append(this.num.toString()),e.append(this.unit)}visit(e){return e.visitNumeric(this)}isNumeric(){return!0}},Ai=class extends vt{constructor(e){super(),this.num=e}toExpr(e,t){return this.num==0?e.zero:this.num==1?e.one:new nt(e,this.num)}appendTo(e,t){e.append(this.num.toString())}visit(e){return e.visitNum(this)}isNum(){return!0}},nr=class extends Ai{constructor(e){super(e)}visit(e){return e.visitInt(this)}},uy=class extends vt{constructor(e){super(),this.hex=e}appendTo(e,t){e.append("#"),e.append(this.hex)}visit(e){return e.visitHexColor(this)}},wn=class extends vt{constructor(e){super(),this.url=e}appendTo(e,t){e.append('url("'),e.append(zs(this.url)),e.append('")')}visit(e){return e.visitURL(this)}},hy=class extends vt{constructor(e){super(),this.urangeText=e}appendTo(e,t){e.append(this.urangeText)}visit(e){return e.visitURange(this)}};function Vd(e,t,n,i){var r,o;let s=t.length;if(s>0){(r=t[0])==null||r.appendTo(e,i);for(let l=1;l<s;l++)e.append(n),(o=t[l])==null||o.appendTo(e,i)}}var Be=class extends vt{constructor(e){super(),this.values=e}appendTo(e,t){Vd(e,this.values," ",t)}visit(e){return e.visitSpaceList(this)}isSpaceList(){return!0}},Rt=class extends vt{constructor(e){super(),this.values=e}appendTo(e,t){Vd(e,this.values,",",t)}visit(e){return e.visitCommaList(this)}},oo=class extends vt{constructor(e,t){super(),this.name=e,this.values=t}appendTo(e,t){e.append(yi(this.name)),e.append("("),Vd(e,this.values,",",t),e.append(")")}visit(e){return e.visitFunc(this)}},ie=class extends vt{constructor(e){super(),this.expr=e}toExpr(){return this.expr}appendTo(e,t){this.expr instanceof nt||this.expr instanceof $s?this.expr.appendTo(e,0):(e.append("-epubx-expr("),this.expr.appendTo(e,0),e.append(")"))}visit(e){return e.visitExpr(this)}isExpr(){return!0}},yo=class extends vt{constructor(e){super(),this.text=e}appendTo(e,t){e.append(this.text||" ")}};function Pt(e,t){if(e){if(e.isNumeric()){let n=e;return t.queryUnitSize(n.unit,!1)*n.num}if(e.isNum())return e.num}return 0}function cy(e,t){return new $(Pt(e,t),"px")}var S={absolute:K("absolute"),all:K("all"),always:K("always"),anywhere:K("anywhere"),auto:K("auto"),avoid:K("avoid"),balance:K("balance"),balance_all:K("balance-all"),block:K("block"),block_end:K("block-end"),block_start:K("block-start"),both:K("both"),bottom:K("bottom"),border_box:K("border-box"),break_all:K("break-all"),break_word:K("break-word"),clip:K("clip"),crop:K("crop"),cross:K("cross"),column:K("column"),discard:K("discard"),exclusive:K("exclusive"),_false:K("false"),fixed:K("fixed"),flex:K("flex"),flow_root:K("flow-root"),footnote:K("footnote"),footer:K("footer"),grid:K("grid"),header:K("header"),hidden:K("hidden"),horizontal_tb:K("horizontal-tb"),inherit:K("inherit"),initial:K("initial"),inline:K("inline"),inline_block:K("inline-block"),inline_end:K("inline-end"),inline_start:K("inline-start"),inside:K("inside"),keep:K("keep"),landscape:K("landscape"),left:K("left"),line:K("line"),list_item:K("list-item"),ltr:K("ltr"),manual:K("manual"),max_content:K("max-content"),min_content:K("min-content"),none:K("none"),normal:K("normal"),oeb_page_foot:K("oeb-page-foot"),oeb_page_head:K("oeb-page-head"),outside:K("outside"),padding_box:K("padding-box"),page:K("page"),relative:K("relative"),revert:K("revert"),right:K("right"),same:K("same"),scale:K("scale"),snap_block:K("snap-block"),snap_inline:K("snap-inline"),solid:K("solid"),spread:K("spread"),_static:K("static"),rtl:K("rtl"),table:K("table"),table_caption:K("table-caption"),table_cell:K("table-cell"),table_footer_group:K("table-footer-group"),table_header_group:K("table-header-group"),table_row:K("table-row"),top:K("top"),transparent:K("transparent"),unset:K("unset"),vertical_lr:K("vertical-lr"),vertical_rl:K("vertical-rl"),visible:K("visible"),_true:K("true")},Zf=new $(100,"%"),Ds=new $(100,"pvw"),Vs=new $(100,"pvh"),Ie=new $(0,"px");new hy("U+0-10FFFF");var Jf={"font-size":1,"line-height":2,color:3};function ge(e){return e===S.inherit||e===S.initial||e===S.revert||e===S.unset}function eg(e,t){let n=Jf[e]||Number.MAX_VALUE,i=Jf[t]||Number.MAX_VALUE;return n-i}function Yn(e){return(e==null?void 0:e.length)>2&&e.startsWith("--")}var Qt=class{constructor(e,t,n,i){this.x1=e,this.y1=t,this.x2=n,this.y2=i}},ui=class{constructor(e,t){this.x=e,this.y=t}},Bu=class{constructor(e,t,n,i){this.left=e,this.top=t,this.right=n,this.bottom=i}},tg=class{constructor(e,t,n,i){this.low=e,this.high=t,this.winding=n,this.shapeId=i}},Vn=class{constructor(e,t,n,i){this.y1=e,this.y2=t,this.x1=n,this.x2=i,d(this,"left",null),d(this,"right",null)}};function OC(e,t){return e.low.y-t.low.y||e.low.x-t.low.x}var Ya=class dy{constructor(t){this.points=t}addSegments(t,n){let i=this.points,r=i.length,o=i[r-1];for(let s=0;s<r;s++){let l=i[s],a;o.y<l.y?a=new tg(o,l,1,n):a=new tg(l,o,-1,n),t.push(a),o=l}}withOffset(t,n){let i=[];for(let r of this.points)i.push(new ui(r.x+t,r.y+n));return new dy(i)}};function ng(e,t,n,i){let r=[];for(let o=0;o<20;o++){let s=o*2*Math.PI/20;r.push(new ui(e+n*Math.sin(s),t+i*Math.cos(s)))}return new Ya(r)}function Ud(e,t,n,i){return new Ya([new ui(e,t),new ui(n,t),new ui(n,i),new ui(e,i)])}var gl=class{constructor(e,t,n,i){this.x=e,this.winding=t,this.shapeId=n,this.lowOrHigh=i}};function ig(e,t){let n=e.low.x+(e.high.x-e.low.x)*(t-e.low.y)/(e.high.y-e.low.y);if(isNaN(n))throw new Error("Bad intersection");return n}function BC(e,t,n,i){let r,o,s,l;t.high.y<n&&se.warn("Error: inconsistent segment (1)"),t.low.y<=n?(r=ig(t,n),o=t.winding):(r=t.low.x,o=0),t.high.y>=i?(s=ig(t,i),l=t.winding):(s=t.high.x,l=0),r<s?(e.push(new gl(r,o,t.shapeId,-1)),e.push(new gl(s,l,t.shapeId,1))):(e.push(new gl(s,l,t.shapeId,-1)),e.push(new gl(r,o,t.shapeId,1)))}function _C(e,t,n){let i=t+n,r=Array(i),o=Array(i),s;for(s=0;s<=i;s++)r[s]=0,o[s]=0;let l=[],a=!1,u=e.length;for(let h=0;h<u;h++){let p=e[h];r[p.shapeId]+=p.winding,o[p.shapeId]+=p.lowOrHigh;let c=!1;for(s=0;s<t;s++)if(r[s]&&!o[s]){c=!0;break}if(c){for(s=t;s<=i;s++)if(r[s]||o[s]){c=!1;break}}a!=c&&(l.push(p.x),a=c)}return l}function MC(e,t){return t?Math.ceil(e/t)*t:e}function rg(e,t){return t?Math.floor(e/t)*t:e}function zC(e){return new ui(e.y,-e.x)}function ma(e){return new Qt(e.y1,-e.x2,e.y2,-e.x1)}function py(e){return new Qt(-e.y2,e.x1,-e.y1,e.x2)}function og(e){return new Ya(e.points.map(t=>zC(t)))}function $C(e,t,n,i,r,o){o&&(e=ma(e),t=t.map(m=>og(m)),n=n.map(m=>og(m)));let s=t.length,l=n?n.length:0,a=[],u=[],h,p,c;for(h=0;h<s;h++)t[h].addSegments(u,h);for(h=0;h<l;h++)n[h].addSegments(u,h+s);let f=u.length;u.sort(OC);let v=0;for(;u[v].shapeId>=s;)v++;let w=u[v].low.y;w>e.y1&&a.push(new Vn(e.y1,w,e.x2,e.x2));let y=0,g=[];for(;y<f&&(c=u[y]).low.y<w;)c.high.y>w&&g.push(c),y++;for(;y<f||g.length>0;){let m=e.y2,x=Math.min(MC(Math.ceil(w+i),r),e.y2);for(p=0;p<g.length&&m>x;p++)c=g[p],c.low.x==c.high.x?c.high.y<m&&(m=Math.max(rg(c.high.y,r),x)):c.low.x!=c.high.x&&(m=x);for(m>e.y2&&(m=e.y2);y<f&&(c=u[y]).low.y<m;){if(c.high.y<w){y++;continue}if(c.low.y<x)c.low.y==c.high.y&&c.low.y==w||(g.push(c),m=x),y++;else{let A=rg(c.low.y,r);A<m&&(m=A);break}}let C=[];for(p=0;p<g.length;p++)BC(C,g[p],w,m);C.sort((A,L)=>A.x-L.x||A.lowOrHigh-L.lowOrHigh);let N=_C(C,s,l);if(N.length==0)a.push(new Vn(w,m,e.x2,e.x2));else{let A=0,L=e.x1;for(p=0;p<N.length;p+=2){let z=Math.max(e.x1,N[p]),q=Math.min(e.x2,N[p+1])-z;q>A&&(A=q,L=z)}A==0?a.push(new Vn(w,m,e.x2,e.x2)):a.push(new Vn(w,m,Math.max(L,e.x1),Math.min(L+A,e.x2)))}if(m==e.y2)break;for(w=m,p=g.length-1;p>=0;p--)g[p].high.y<=m&&g.splice(p,1)}return fy(e,a),a}function fy(e,t){let n=t.length-1,i=new Vn(e.y2,e.y2,e.x1,e.x2);for(;n>=0;){let r=i;i=t[n],(i.y2-i.y1<1||i.x1==r.x1&&i.x2==r.x2)&&(r.y1=i.y1,t.splice(n,1),i=r),n--}}function gy(e,t){let n=0,i=e.length;for(;n<i;){let r=Math.floor((n+i)/2);t>=e[r].y2?n=r+1:i=r}return n}function DC(e,t){if(!e.length)return t;let n=t.y1,i,r;for(r=0;r<e.length&&(i=e[r],!(i.y2>t.y1&&i.x1-.1<=t.x1&&i.x2+.1>=t.x2));r++)n=Math.max(n,i.y2);let o=n;for(;r<e.length&&(i=e[r],!(i.y1>=t.y2||i.x1-.1>t.x1||i.x2+.1<t.x2));r++)o=i.y2;return r===e.length?o=t.y2:o=Math.min(o,t.y2),o<=n?null:new Qt(t.x1,n,t.x2,o)}function VC(e,t){if(!e.length)return t;let n=t.y2,i,r;for(r=e.length-1;r>=0&&(i=e[r],!(r===e.length-1&&i.y2<t.y2))&&!(i.y1<t.y2&&i.x1-.1<=t.x1&&i.x2+.1>=t.x2);r--)n=Math.min(n,i.y1);let o=Math.min(n,i.y2);for(;r>=0&&(i=e[r],!(i.y2<=t.y1||i.x1-.1>t.x1||i.x2+.1<t.x2));r--)o=i.y1;return o=Math.max(o,t.y1),n<=o?null:new Qt(t.x1,o,t.x2,n)}function UC(e,t,n,i){let r=n.y1,o=n.x2-n.x1,s=n.y2-n.y1,l=gy(t,r);for(;;){let a=r+s;if(a>e.y2)return!1;let u=e.x1,h=e.x2;for(let p=l;p<t.length&&t[p].y1<a;p++){let c=t[p];c.x1>u&&(u=c.x1),c.x2<h&&(h=c.x2)}if(u+o<=h||l>=t.length)return i=="left"?(n.x1=u,n.x2=u+o):(n.x1=h-o,n.x2=h),n.y2+=r-n.y1,n.y1=r,!0;r=t[l].y2,l++}}function HC(e,t,n,i,r){for(i||(i=[new Vn(n.y1,n.y2,n.x1,n.x2)]);i.length>0&&i[0].y2<=e.y1;)i.shift();if(i.length==0)return;i[0].y1<e.y1&&(i[0].y1=e.y1);let o,s=t.length==0?e.y1:t[t.length-1].y2;s<e.y2&&t.push(new Vn(s,e.y2,e.x1,e.x2));let l=gy(t,i[0].y1);for(let a of i){if(l==t.length)break;for(t[l].y1<a.y1&&(o=t[l],l++,t.splice(l,0,new Vn(a.y1,o.y2,o.x1,o.x2)),o.y2=a.y1);l<t.length&&(o=t[l++],o.y2>a.y2&&(t.splice(l,0,new Vn(a.y2,o.y2,o.x1,o.x2)),o.y2=a.y2),a.x1!=a.x2&&(r=="left"?o.x1=Math.min(a.x2,e.x2):o.x2=Math.max(a.x1,e.x1)),o.y2!=a.y2););}fy(e,t)}var WC=class extends Jn{constructor(){super(),d(this,"propSet",{})}visitIdent(e){return this.propSet[e.name]=!0,e}visitSpaceList(e){return this.visitValues(e.values),e}};function GC(e){if(e){let t=new WC;try{return e.visit(t),t.propSet}catch(n){se.warn(n,"toSet:")}}return{}}var jC=class extends Jn{constructor(e){super(),this.value=e}visitInt(e){return this.value=e.num,e}};function sg(e,t){if(e){let n=new jC(t);try{return e.visit(n),n.value}catch(i){se.warn(i,"toInt: ")}}return t}var XC=class extends Jn{constructor(){super(),d(this,"collect",!1),d(this,"coords",[]),d(this,"name",null)}visitNumeric(e){return this.collect&&this.coords.push(e),null}visitNum(e){return this.collect&&e.num==0&&this.coords.push(new $(0,"px")),null}visitSpaceList(e){return this.visitValues(e.values),null}visitFunc(e){return this.collect||(this.collect=!0,this.visitValues(e.values),this.collect=!1,this.name=e.name.toLowerCase()),null}getShape(e,t,n,i,r){if(this.coords.length>0){let o=[];switch(this.coords.forEach((s,l)=>{if(s.unit=="%"){let a=l%2==0?n:i;l==3&&this.name=="circle"&&(a=Math.sqrt((n*n+i*i)/2)),o.push(s.num*a/100)}else o.push(s.num*r.queryUnitSize(s.unit,!1))}),this.name){case"polygon":if(o.length%2==0){let s=[];for(let l=0;l<o.length;l+=2)s.push(new ui(e+o[l],t+o[l+1]));return new Ya(s)}break;case"rectangle":if(o.length==4)return Ud(e+o[0],t+o[1],e+o[0]+o[2],t+o[1]+o[3]);break;case"ellipse":if(o.length==4)return ng(e+o[0],t+o[1],o[2],o[3]);break;case"circle":if(o.length==3)return ng(e+o[0],t+o[1],o[2],o[2]);break}}return null}};function my(e,t,n,i,r,o){if(e){let s=new XC;try{return e.visit(s),s.getShape(t,n,i,r,o)}catch(l){se.warn(l,"toShape:")}}return Ud(t,n,t+i,n+r)}var YC=class extends Jn{constructor(e){super(),this.reset=e,d(this,"counters",{}),d(this,"name",null)}visitIdent(e){return this.name=e.toString(),this.reset?this.counters[this.name]=0:this.counters[this.name]=(this.counters[this.name]||0)+1,e}visitInt(e){return this.name&&(this.counters[this.name]+=e.num-(this.reset?0:1)),e}visitSpaceList(e){return this.visitValues(e.values),e}};function jo(e,t){let n=new YC(t);try{e.visit(n)}catch(i){se.warn(i,"toCounters:")}return n.counters}var qC=class extends ro{constructor(e,t){super(),this.baseUrl=e,this.transformer=t}visitURL(e){return new wn(this.transformer.transformURL(e.url,this.baseUrl))}};function _u(e){let t={};return Object.keys(e).forEach(n=>{t[n]=Array.from(e[n])}),t}var KC=class{constructor(e,t){this.targetId=e,this.resolved=t,d(this,"pageCounters",null),d(this,"spineIndex",-1),d(this,"pageIndex",-1)}equals(e){return this===e?!0:e?this.targetId===e.targetId&&this.resolved===e.resolved&&this.spineIndex===e.spineIndex&&this.pageIndex===e.pageIndex:!1}isResolved(){return this.resolved}resolve(){this.resolved=!0}unresolve(){this.resolved=!1}},QC=class{constructor(e,t){this.counterStore=e,this.baseURL=t}countersOfId(e,t){e=this.counterStore.documentURLTransformer.transformFragment(e,this.baseURL),this.counterStore.countersById[e]=t}getExprContentListener(){return this.counterStore.getExprContentListener()}},ZC=class{constructor(e,t,n,i){this.counterStore=e,this.baseURL=t,this.rootScope=n,this.pageScope=i,d(this,"styler",null),d(this,"namedStringValues",{}),d(this,"runningElements",{})}setStyler(e){this.styler=e}getFragment(e){let t=e.match(/^[^#]*#(.*)$/);return t?t[1]:null}getTransformedId(e){let t=this.counterStore.documentURLTransformer.transformURL(Ue(e,this.baseURL),this.baseURL);return t.charAt(0)==="#"&&(t=t.substring(1)),t}getPageCounterVal(e,t){let n=()=>{let o=this.counterStore.currentPageCounters[e];return o&&o.length?o[o.length-1]:null},i=new st(this.pageScope,()=>t(n()),`page-counter-${e}`),r=o=>t(o[o.length-1]);return this.counterStore.registerPageCounterExpr(e,r,i),i}getPageCountersVal(e,t){let n=()=>this.counterStore.currentPageCounters[e]||[],i=new st(this.pageScope,()=>t(n()),`page-counters-${e}`);return this.counterStore.registerPageCounterExpr(e,t,i),i}getTargetCounters(e,t,n){let i=this.counterStore.countersById[t];return!i&&n&&e&&(this.styler.styleUntilIdIsReached(e),i=this.counterStore.countersById[t]),i||null}getTargetPageCounters(e){return this.counterStore.currentPage.elementsById[e]?this.counterStore.currentPageCounters:this.counterStore.pageCountersById[e]||null}getTargetCounterVal(e,t,n){let i=this.getFragment(e),r=this.getTransformedId(e),o=this.getTargetCounters(i,r,!1);if(o&&o[t]){let l=o[t];return new nt(this.rootScope,n(l[l.length-1]||null))}let s=new st(this.pageScope,()=>{if(o=this.getTargetCounters(i,r,!0),o)if(o[t]){let l=o[t];return n(l[l.length-1]||null)}else{let l=this.getTargetPageCounters(r);if(l)if(this.counterStore.resolveReference(r),l[t]){let a=l[t];return n(a[a.length-1]||null)}else return n(0);else return this.counterStore.saveReferenceOfCurrentPage(r,!1),"??"}else return this.counterStore.saveReferenceOfCurrentPage(r,!1),"??"},`target-counter-${t}-of-${e}`);return this.counterStore.registerTargetCounterExpr(t,n,s,r),s}getTargetCountersVal(e,t,n){let i=this.getFragment(e),r=this.getTransformedId(e);return new st(this.pageScope,()=>{let o=this.getTargetPageCounters(r);if(o){this.counterStore.resolveReference(r);let s=o[t]||[],l=this.getTargetCounters(i,r,!0)[t]||[];return n(s.concat(l))}else return this.counterStore.saveReferenceOfCurrentPage(r,!1),"??"},`target-counters-${t}-of-${e}`)}getNamedStringVal(e,t){return new st(this.pageScope,()=>this.getRunningValue(this.namedStringValues,e,t),`named-string-${t}-${e}`)}getRunningElementVal(e,t){return new st(this.pageScope,()=>this.getRunningValue(this.runningElements,e,t),`running-element-${t}-${e}`)}getRunningValue(e,t,n){let i=e[t];if(!i)return"";let r=Object.keys(i).map(c=>parseInt(c,10)).sort($w),o=this.counterStore.currentPage,s=o.isBlankPage?o.offset-1:o.offset,l=o.isBlankPage?s:Math.max(s,...Array.from(o.container.querySelectorAll(`[${Mn}]`)).map(c=>parseInt(c.getAttribute(Mn),10))),a=-1,u=-1,h=-1,p=-1;for(let c=0;c<r.length;c++){let f=r[c],v=c>0?r[c-1]:-1,w=c<r.length-1?r[c+1]:-1;if(f>l)break;if(f>=s){if(a<0&&(a=f,p=-1),u<0)if(f===s)u=f;else{v<a&&(u=v);let y=o.container.querySelector(`[${Mn}="${f}"]`);if(!y)u<0&&(u=f);else{let g=o.container.querySelector(`[${Mn}="${s}"]`);if(g||(g=o.container.querySelector(`[${Mn}="0"]`)),g){for(let m=g;m;m=m.firstElementChild)if(m===y){u=f;break}}}}h=f}else(w>l||w<0)&&(a=u=h=p=f)}return i[{first:a,start:u,last:h,"first-except":p}[n]]||""}setNamedString(e,t,n){let i=this.namedStringValues[e]||(this.namedStringValues[e]={});i[n]=t}setRunningElement(e,t){let n=this.runningElements[e]||(this.runningElements[e]={});n[t]=String(t)}},JC=class{constructor(e){this.documentURLTransformer=e,d(this,"countersById",{}),d(this,"pageCountersById",{}),d(this,"currentPageCounters",{}),d(this,"previousPageCounters",{}),d(this,"currentPageCountersStack",[]),d(this,"pageIndicesById",{}),d(this,"currentPage",null),d(this,"newReferencesOfCurrentPage",[]),d(this,"referencesToSolve",[]),d(this,"referencesToSolveStack",[]),d(this,"unresolvedReferences",{}),d(this,"resolvedReferences",{}),d(this,"pagesCounterExprs",[]),d(this,"pageCounterExprs",[]),d(this,"targetCounterExprs",[]),this.currentPageCounters.page=[0]}createCounterListener(e){return new QC(this,e)}createCounterResolver(e,t,n){return new ZC(this,e,t,n)}setCurrentPage(e){this.currentPage=e}definePageCounter(e,t){this.currentPageCounters[e]?this.currentPageCounters[e].push(t):this.currentPageCounters[e]=[t]}forceSetPageCounter(e){let t=this.currentPageCounters.page;!t||!t.length?this.currentPageCounters.page=[e]:t[t.length-1]=e}updatePageCounters(e,t){this.previousPageCounters=_u(this.currentPageCounters);let n,i=e["counter-reset"];if(i){let s=i.evaluate(t);s&&(n=jo(s,!0))}if(n)for(let s in n)this.definePageCounter(s,n[s]);let r,o=e["counter-increment"];if(o){let s=o.evaluate(t);s&&(r=jo(s,!1))}r?"page"in r||(r.page=1):(r={},r.page=1);for(let s in r){this.currentPageCounters[s]||this.definePageCounter(s,0);let l=this.currentPageCounters[s];l[l.length-1]+=r[s]}}pushPageCounters(e){this.currentPageCountersStack.push(this.currentPageCounters),this.currentPageCounters=_u(e)}popPageCounters(){this.currentPageCounters=this.currentPageCountersStack.pop()}resolveReference(e){let t=this.unresolvedReferences[e],n=this.resolvedReferences[e];n||(n=this.resolvedReferences[e]=[]);let i=!1;for(let r=0;r<this.referencesToSolve.length;){let o=this.referencesToSolve[r];if(o.targetId===e){if(o.resolve(),this.referencesToSolve.splice(r,1),t){let s=t.indexOf(o);s>=0&&t.splice(s,1)}n.push(o),i=!0}else r++}i||this.saveReferenceOfCurrentPage(e,!0)}saveReferenceOfCurrentPage(e,t){if(!this.newReferencesOfCurrentPage.some(n=>n.targetId===e)){let n=new KC(e,t);this.newReferencesOfCurrentPage.push(n)}}finishPage(e,t){let n=Object.keys(this.currentPage.elementsById);if(n.length>0){let o=_u(this.currentPageCounters);n.forEach(s=>{this.pageCountersById[s]=o;let l=this.pageIndicesById[s];if(l&&l.pageIndex<t){let a=this.resolvedReferences[s];if(a){let u=this.unresolvedReferences[s];u||(u=this.unresolvedReferences[s]=[]);let h;for(;h=a.shift();)h.unresolve(),u.push(h)}}this.pageIndicesById[s]={spineIndex:e,pageIndex:t}})}let i=this.previousPageCounters,r;for(;r=this.newReferencesOfCurrentPage.shift();){r.pageCounters=i,r.spineIndex=e,r.pageIndex=t;let o;r.isResolved()?(o=this.resolvedReferences[r.targetId],o||(o=this.resolvedReferences[r.targetId]=[])):(o=this.unresolvedReferences[r.targetId],o||(o=this.unresolvedReferences[r.targetId]=[])),o.every(s=>!r.equals(s))&&o.push(r)}this.currentPage=null}getUnresolvedRefsToPage(e){let t=[];Object.keys(e.elementsById).forEach(r=>{let o=this.unresolvedReferences[r];o&&(t=t.concat(o))}),t.sort((r,o)=>r.spineIndex-o.spineIndex||r.pageIndex-o.pageIndex);let n=[],i=null;return t.forEach(r=>{!i||i.spineIndex!==r.spineIndex||i.pageIndex!==r.pageIndex?(i={spineIndex:r.spineIndex,pageIndex:r.pageIndex,pageCounters:r.pageCounters,refs:[r]},n.push(i)):i.refs.push(r)}),n}pushReferencesToSolve(e){this.referencesToSolveStack.push(this.referencesToSolve),this.referencesToSolve=e}popReferencesToSolve(){this.referencesToSolve=this.referencesToSolveStack.pop()}registerPageCounterExpr(e,t,n){e==="pages"?this.pagesCounterExprs.push({expr:n,format:t}):this.pageCounterExprs.push({expr:n,format:t})}registerTargetCounterExpr(e,t,n,i){this.targetCounterExprs.push({name:e,expr:n,format:t,transformedId:i})}getExprContentListener(){return this.exprContentListener.bind(this)}exprContentListener(e,t,n){if(e instanceof st){if(e.str=="viv-leader"){let o=n.createElementNS("http://www.w3.org/1999/xhtml","span");return o.textContent=t,o.setAttribute("data-viv-leader",e.key),o.setAttribute("data-viv-leader-value",t),o}else if(e.str.startsWith("running-element-")){let o=t&&n.querySelectorAll(`[${Mn}="${t}"]`);if(!o||o.length===0)return null;let s=o[o.length-1].cloneNode(!0);return this.fixPageCounterInRunningElement(s),s.style.position="",s.style.visibility="",s}else if(e.str.startsWith("target-counter-")){let o=n.createElementNS("http://www.w3.org/1999/xhtml","span");return o.textContent=t,o.setAttribute($u,e.key),o}}let i=this.pagesCounterExprs.findIndex(o=>o.expr===e)>=0,r=!i&&this.pageCounterExprs.findIndex(o=>o.expr===e)>=0;if(i||r){let o=n.createElementNS("http://www.w3.org/1999/xhtml","span");return o.textContent=t,o.setAttribute(i?Mu:zu,e.key),o}else return null}fixPageCounterInRunningElement(e){let t=e.querySelectorAll(`[${zu}]`);for(let i of t){let r=i.getAttribute(zu),o=this.pageCounterExprs.find(u=>u.expr.key===r),s=(o==null?void 0:o.expr).str,l=s==null?void 0:s.replace(/^page-counters?-/,""),a=this.currentPageCounters[l];a&&(i.textContent=o.format(a))}let n=e.querySelectorAll(`[${$u}]`);for(let i of n)i.setAttribute(lg,!0)}finishLastPage(e){let t=e.root.querySelectorAll(`[${Mu}]`),n=e.contentContainer.childElementCount;for(let r of t){let o=r.getAttribute(Mu),s=this.pagesCounterExprs.findIndex(l=>l.expr.key===o);r.textContent=this.pagesCounterExprs[s].format([n])}let i=e.root.querySelectorAll(`[${lg}]`);for(let r of i){let o=r.getAttribute($u),s=this.targetCounterExprs.find(l=>l.expr.key===o);if(s&&s.transformedId){let l=this.pageCountersById[s.transformedId];if(l){let a=l[s.name];a&&(r.textContent=s.format(a[a.length-1]))}}}}createLayoutConstraint(e){return new ek(this,e)}},Mu="data-vivliostyle-pages-counter",zu="data-vivliostyle-page-counter",$u="data-vivliostyle-target-counter",lg="data-vivliostyle-target-counter-in-running",ek=class{constructor(e,t){this.counterStore=e,this.pageIndex=t}allowLayout(e){if(!e||e.after)return!0;let t=e.viewNode;if(!t||t.nodeType!==1)return!0;let n=t.getAttribute("data-vivliostyle-id")||t.getAttribute("id")||t.getAttribute("name");if(!n||!this.counterStore.resolvedReferences[n]&&!this.counterStore.unresolvedReferences[n])return!0;let i=this.counterStore.pageIndicesById[n];return i?this.pageIndex>=i.pageIndex:!0}};function tk(e){if(e=e.substr(1),e.match(/^[^0-9a-fA-F\n\r]$/))return e;let t=parseInt(e,16);return isNaN(t)?"":t===0||t>=55296&&t<=57343||t>1114111?"":String.fromCodePoint(t)}function Oi(e){return e.replace(/\\([0-9a-fA-F]{1,6}(\r\n|[ \n\r\t\f])?|[^0-9a-fA-F\n\r])/g,tk)}var nk=class{constructor(){d(this,"type"),d(this,"precededBySpace",!1),d(this,"num",0),d(this,"text",""),d(this,"position",0),this.type=0}toString(){switch(this.type){case 10:return"(";case 11:return")";case 12:return"{";case 13:return"}";case 14:return"[";case 15:return"]";case 16:return",";case 17:return";";case 18:return":";case 19:return"/";case 21:return"%";case 22:return"?";case 23:return"+";case 24:return"-";case 25:return"||";case 26:return"&&";case 31:return"!";case 32:return"$";case 33:return"^";case 34:return"|";case 35:return"~";case 36:return"*";case 37:return">";case 38:return"<";case 39:return"=";case 41:return"!=";case 42:return"$=";case 43:return"^=";case 44:return"|=";case 45:return"~=";case 46:return"*=";case 47:return">=";case 48:return"<=";case 49:return"==";case 50:return"::";case 51:return"<!--";case 52:return"-->";case 3:return this.num.toString()+this.text;case 4:case 5:return this.num.toString();case 20:return"@"+this.text;case 7:return"#"+this.text;case 6:return this.text+"(";case 9:return"."+this.text;case 0:return"/*EOF*/";default:return this.text}}};function it(e,t){let n=Array(128),i;for(i=0;i<128;i++)n[i]=e;for(n[NaN]=e==35?35:72,i=0;i<t.length;i+=2)n[t[i]]=t[i+1];return n}var On=[72,72,72,72,72,72,72,72,72,1,1,72,1,1,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,1,4,34,6,7,8,9,33,10,11,12,13,14,15,16,17,2,2,2,2,2,2,2,2,2,2,18,19,20,21,22,23,24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25,29,26,30,3,72,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,27,31,28,32,72];On[NaN]=80;var Nn=[43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,52,43,43,43,43,39,43,43,39,39,39,39,39,39,39,39,39,39,43,43,43,43,43,43,43,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,43,44,43,43,39,43,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,43,43,43,43,43];Nn[NaN]=43;var ik=[72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,78,59,72,59,59,59,59,59,59,59,59,59,59,72,72,72,72,72,72,72,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,72,61,72,72,78,72,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,72,72,72,72,72];Nn[NaN]=43;var vy=[35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,57,59,35,58,58,58,58,58,58,58,58,58,58,35,35,35,35,35,35,35,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,35,61,35,35,60,35,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,35,35,35,35,35];vy[NaN]=35;var wy=[45,45,45,45,45,45,45,45,45,73,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,73,45,45,45,45,45,45,45,53,45,45,45,45,45,45,45,39,39,39,39,39,39,39,39,39,39,45,45,45,45,45,45,45,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,45,44,45,45,39,45,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,45,45,45,45,45];wy[NaN]=45;var Kh=[37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,41,37,37,37,37,37,37,37,37,42,37,39,39,39,39,39,39,39,39,39,39,37,37,37,37,37,37,37,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,37,37,37,37,40,37,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,37,37,37,37,37];Kh[NaN]=37;var Qh=[38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,41,38,38,38,38,38,38,38,38,38,38,39,39,39,39,39,39,39,39,39,39,38,38,38,38,38,38,38,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,38,38,38,38,40,38,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,38,38,38,38,38];Qh[NaN]=38;var Bi=it(35,[61,36]),rk=it(35,[58,77]),ok=it(35,[61,36,124,50]),sk=it(35,[38,51]),lk=it(35,[42,54]),ak=it(39,[42,55]),uk=it(54,[42,55,47,56]),hk=it(62,[62,82]),ck=it(35,[61,36,33,70]),dk=it(62,[45,71]),pk=it(63,[45,81]),Du=it(76,[10,72,13,72]),fk=it(39,[39,46,10,72,13,72,92,48]),gk=it(39,[34,46,10,72,13,72,92,49]),mk=it(39,[39,47,10,74,13,74,92,48]),vk=it(39,[34,47,10,74,13,74,92,49]),ag=it(64,[9,39,32,39,34,66,39,65,41,72,10,39,13,39]),wk=it(39,[41,67,9,79,10,79,13,79,32,79,92,75,40,72,91,72,93,72,123,72,125,72,NaN,67]),yk=it(39,[39,68,10,74,13,74,92,75,NaN,67]),xk=it(39,[34,68,10,74,13,74,92,75,NaN,67]),bk=it(72,[9,39,10,39,13,39,32,39,41,69]),Sk=15,kn=class{constructor(e,t){this.input=e,this.handler=t,d(this,"indexMask"),d(this,"buffer"),d(this,"tail",0),d(this,"curr",0),d(this,"position",0),this.indexMask=Sk,this.buffer=Array(this.indexMask+1);for(let n=0;n<=this.indexMask;n++)this.buffer[n]=new nk}token(){return this.tail==this.curr&&this.fillBuffer(),this.buffer[this.curr]}nthToken(e){return(this.tail-this.curr&this.indexMask)<=e&&this.fillBuffer(),this.buffer[this.curr+e&this.indexMask]}consume(){this.curr=this.curr+1&this.indexMask}fillBuffer(){let e=this.tail,t=this.curr,n=this.indexMask;if(e>=t?t+=n:t--,t==e)throw new Error("F_CSSTOK_INTERNAL");let i=On,r=this.input,o=this.position,s=this.buffer,l=0,a=0,u="",h=0,p=!1,c=s[e],f=-9;for(;;){let v=r.charCodeAt(o);switch(i[v]||i[65]){case 72:u=r.substring(a,o),isNaN(v)?l=0:l=54,i=On;break;case 1:o++,p=!0;continue;case 2:a=o++,i=Kh;continue;case 3:l=1,a=o++,i=Nn;continue;case 4:a=o++,l=31,i=Bi;continue;case 33:l=2,a=++o,i=fk;continue;case 34:l=2,a=++o,i=gk;continue;case 6:a=++o,l=7,i=Nn;continue;case 7:a=o++,l=32,i=Bi;continue;case 8:a=o++,l=21;break;case 9:a=o++,l=32,i=sk;continue;case 10:a=o++,l=10;break;case 11:a=o++,l=11;break;case 12:a=o++,l=36,i=Bi;continue;case 13:a=o++,l=23;break;case 14:a=o++,l=16;break;case 15:l=24,a=o++,i=vy;continue;case 16:a=o++,i=ik;continue;case 78:a=o++,l=9,i=Nn;continue;case 17:a=o++,l=19,i=lk;continue;case 18:a=o++,l=18,i=rk;continue;case 77:o++,l=50;break;case 19:a=o++,l=17;break;case 20:a=o++,l=38,i=ck;continue;case 21:a=o++,l=39,i=Bi;continue;case 22:a=o++,l=37,i=Bi;continue;case 23:a=o++,l=22;break;case 24:a=++o,l=20,i=Nn;continue;case 25:a=o++,l=14;break;case 26:a=o++,l=15;break;case 27:a=o++,l=12;break;case 28:a=o++,l=13;break;case 29:a=o++,f=a,l=1,i=Du;continue;case 30:a=o++,l=33,i=Bi;continue;case 31:a=o++,l=34,i=ok;continue;case 32:a=o++,l=35,i=Bi;continue;case 35:break;case 36:o++,l=l+41-31;break;case 37:l=5,h=parseInt(r.substring(a,o),10);break;case 38:l=4,h=parseFloat(r.substring(a,o));break;case 39:o++;continue;case 40:l=3,h=parseFloat(r.substring(a,o)),a=o++,i=Nn;continue;case 41:l=3,h=parseFloat(r.substring(a,o)),u="%",a=o++;break;case 42:o++,i=Qh;continue;case 43:if(u=Oi(r.substring(a,o)),l===27&&v===63||l===1&&u.toLowerCase()==="u"&&/^(\bu\+[?0-9a-f]+(-[?0-9a-f]+)?|,|\s+|\/\*([^*]|\*[^/])*\*\/)+[;}]/i.test(r.substring(o-1))){l=27,o++;continue}break;case 44:f=o++,i=Du;continue;case 45:u=Oi(r.substring(a,o));break;case 46:u=r.substring(a,o),o++;break;case 47:u=Oi(r.substring(a,o)),o++;break;case 48:f=o,o+=2,i=mk;continue;case 49:f=o,o+=2,i=vk;continue;case 50:o++,l=25;break;case 51:o++,l=26;break;case 52:if(u=r.substring(a,o),l==1){if(o++,u.toLowerCase()=="url"){i=ag;continue}l=6}break;case 53:if(u=Oi(r.substring(a,o)),l==1){if(o++,u.toLowerCase()=="url"){i=ag;continue}l=6}break;case 54:i=ak,o++;continue;case 55:i=uk,o++;continue;case 56:i=On,o++;continue;case 57:i=hk,o++,r[o]!==">"&&(l=1,i=Nn);continue;case 81:l=51,u=r.substring(a,++o),i=On;break;case 82:l=52,u=r.substring(a,++o),i=On;break;case 58:l=5,i=Kh,o++;continue;case 59:l=4,i=Qh,o++;continue;case 60:l=1,i=Nn,o++;continue;case 61:l=1,i=Du,f=o++;continue;case 62:o--;break;case 63:o-=2;break;case 64:a=o++,i=wk;continue;case 65:a=++o,i=yk;continue;case 66:a=++o,i=xk;continue;case 67:l=8,u=Oi(r.substring(a,o)),o++;break;case 69:o++;break;case 70:i=dk,o++;continue;case 71:i=pk,o++;continue;case 79:if(o-f<8&&r.substring(f+1,o+1).match(/^[0-9a-fA-F]{0,6}(\r\n|[\n\r])|[ \t]$/)){o++;continue}case 68:l=8,u=Oi(r.substring(a,o)),o++,i=bk;continue;case 74:if(o++,o-f<9&&r.substring(f+1,o).match(/^[0-9a-fA-F]{0,6}(\r\n|[\n\r])$/))continue;l=54,u="E_CSS_UNEXPECTED_NEWLINE",i=On;break;case 73:if(o-f<9&&r.substring(f+1,o+1).match(/^[0-9a-fA-F]{0,6}[ \t]$/)){o++,i=Nn;continue}u=Oi(r.substring(a,o));break;case 75:f=o++;continue;case 76:o++,i=wy;continue;default:if(i!==On){l=54,u="E_CSS_UNEXPECTED_STATE";break}a=o,l=0}if(c.type=l,c.precededBySpace=p,c.num=h,c.text=u,c.position=a,e++,e>=t)break;i=On,p=!1,c=s[e&n]}this.position=o,this.tail=e&n}},Ye=null,Zh=null;function Jh(){return Ye}function X(e){if(!Ye)throw new Error("E_TASK_NO_CONTEXT");Ye.name||(Ye.name=e);let t=Ye,n=new qa(t,t.top,e);return t.top=n,n.state=1,n}function Ck(e){return new Pk(new Ek)}function F(e){return new ec(e)}function Kr(e,t,n){let i=X(e);i.handler=n;try{t(i)}catch(r){i.task.raise(r,i)}return i.result()}function kk(e,t){return(Ye?Ye.getScheduler():Zh||Ck()).run(e,t)}var Ek=class{currentTime(){return new Date().valueOf()}setTimeout(e,t){return setTimeout(e,t)}clearTimeout(e){clearTimeout(e)}},Pk=class{constructor(e){this.timer=e,d(this,"timeout",1),d(this,"slice",25),d(this,"sliceOverTime",0),d(this,"queue"),d(this,"wakeupTime",null),d(this,"timeoutToken",null),d(this,"inTimeSlice",!1),d(this,"order",0),this.queue=new oC,Zh||(Zh=this)}setSlice(e){this.slice=e}setTimeout(e){this.timeout=e}isTimeSliceOver(){return this.timer.currentTime()>=this.sliceOverTime}arm(){if(this.inTimeSlice)return;let e=this.queue.peek().scheduledTime,t=this.timer.currentTime();if(this.timeoutToken!=null){if(t+this.timeout>this.wakeupTime)return;this.timer.clearTimeout(this.timeoutToken)}let n=e-t;n<=this.timeout&&(n=this.timeout),this.wakeupTime=t+n,this.timeoutToken=this.timer.setTimeout(()=>{this.timeoutToken=null,this.doTimeSlice()},n)}schedule(e,t){let n=e,i=this.timer.currentTime();n.order=this.order++,n.scheduledTime=i+(t||0),this.queue.add(n),this.arm()}doTimeSlice(){this.timeoutToken!=null&&(this.timer.clearTimeout(this.timeoutToken),this.timeoutToken=null),this.inTimeSlice=!0;try{let e=this.timer.currentTime();for(this.sliceOverTime=e+this.slice;this.queue.length();){let t=this.queue.peek();if(t.scheduledTime>e||(this.queue.remove(),t.canceled||t.resumeInternal(),e=this.timer.currentTime(),e>=this.sliceOverTime))break}}catch(e){se.error(e)}this.inTimeSlice=!1,this.queue.length()&&this.arm()}run(e,t){let n=new Nk(this,t||"");n.top=new qa(n,null,"bootstrap"),n.top.state=1,n.top.then(()=>{let r=()=>{n.running=!1;for(let o of n.callbacks)try{o()}catch(s){se.error(s)}};try{e().then(o=>{n.result=o,r()})}catch(o){n.raise(o),r()}});let i=Ye;return Ye=n,this.schedule(n.top.suspend("bootstrap")),Ye=i,n}},yy=class{constructor(e){this.task=e,d(this,"scheduledTime",0),d(this,"order",0),d(this,"result",null),d(this,"canceled",!1)}compare(e){let t=e;return t.scheduledTime-this.scheduledTime||t.order-this.order}getTask(){return this.task}schedule(e,t){this.result=e,this.task.scheduler.schedule(this,t)}resumeInternal(){let e=this.task;if(this.task=null,e&&e.continuation==this){e.continuation=null;let t=Ye;return Ye=e,e.top.finish(this.result),Ye=t,!0}return!1}cancel(){this.canceled=!0}},Nk=class{constructor(e,t){this.scheduler=e,this.name=t,d(this,"callbacks",[]),d(this,"exception",null),d(this,"running",!0),d(this,"result",null),d(this,"waitTarget",null),d(this,"top",null),d(this,"continuation",null)}getName(){return this.name}interrupt(e){if(this.raise(e||new Error("E_TASK_INTERRUPT")),this!==Ye&&this.continuation){this.continuation.cancel();let t=new yy(this);this.waitTarget="interrupt",this.continuation=t,this.scheduler.schedule(t)}}getScheduler(){return this.scheduler}isRunning(){return this.running}whenDone(e){this.callbacks.push(e)}join(){let e=X("Task.join");if(!this.running)e.finish(this.result);else{let t=e.suspend(this);this.whenDone(()=>{t.schedule(this.result)})}return e.result()}unwind(){for(;this.top&&!this.top.handler;)this.top=this.top.parent;if(this.top&&this.top.handler&&this.exception){let e=this.exception;this.exception=null,this.top.handler(this.top,e)}else this.exception&&se.error(this.exception,"Unhandled exception in task",this.name)}raise(e,t){if(this.fillStack(e),t){let n=this.top;for(;n&&n!=t;)n=n.parent;n==t&&(this.top=n)}this.exception=e,this.unwind()}fillStack(e){let t=e.frameTrace;if(!t){t=e.stack?`${e.stack}
	---- async ---
`:"";for(let n=this.top;n;n=n.parent)t+="	",t+=n.getName(),t+=`
`;e.frameTrace=t}}},ec=class xy{constructor(t){this.value=t}then(t){t(this.value)}thenAsync(t){return t(this.value)}thenReturn(t){return new xy(t)}thenFinish(t){t.finish(this.value)}isPending(){return!1}get(){return this.value}},Tk=class{constructor(e){this.frame=e}then(e){this.frame.then(e)}thenAsync(e){if(this.isPending()){let t=new qa(this.frame.task,this.frame.parent,"AsyncResult.thenAsync");return t.state=1,this.frame.parent=t,this.frame.then(n=>{e(n).then(i=>{t.finish(i)})}),t.result()}else return e(this.frame.res)}thenReturn(e){return this.isPending()?this.thenAsync(()=>new ec(e)):new ec(e)}thenFinish(e){this.isPending()?this.then(t=>{e.finish(t)}):e.finish(this.frame.res)}isPending(){return this.frame.state==1}get(){if(this.isPending())throw new Error("Result is pending");return this.frame.res}},qa=class{constructor(e,t,n){this.task=e,this.parent=t,this.name=n,d(this,"res",null),d(this,"state"),d(this,"callback",null),d(this,"handler",null),this.state=0}checkEnvironment(){if(!Ye)throw new Error("F_TASK_NO_CONTEXT");if(this!==Ye.top)throw new Error("F_TASK_NOT_TOP_FRAME")}result(){return new Tk(this)}finish(e){this.checkEnvironment(),Ye&&!Ye.exception&&(this.res=e),this.state=2;let t=this.parent;if(Ye&&(Ye.top=t),this.callback){try{this.callback(e)}catch(n){this.task.raise(n,t)}this.state=3}}getTask(){return this.task}getName(){return this.name}getScheduler(){return this.task.scheduler}then(e){switch(this.state){case 1:if(this.callback)throw new Error("F_TASK_FRAME_ALREADY_HAS_CALLBACK");this.callback=e;break;case 2:{let t=this.task,n=this.parent;try{e(this.res),this.state=3}catch(i){this.state=3,t.raise(i,n)}break}case 3:throw new Error("F_TASK_DEAD_FRAME");default:throw new Error(`F_TASK_UNEXPECTED_FRAME_STATE ${this.state}`)}}timeSlice(){let e=X("Frame.timeSlice");return e.getScheduler().isTimeSliceOver()?(se.debug("-- time slice --"),e.suspend().schedule(!0)):e.finish(!0),e.result()}sleep(e){let t=X("Frame.sleep");return t.suspend().schedule(!0,e),t.result()}loop(e){let t=X("Frame.loop"),n=i=>{try{for(;i;){let r=e();if(r.isPending()){r.then(n);return}else r.then(o=>{i=o})}t.finish(!0)}catch(r){t.task.raise(r,t)}};return n(!0),t.result()}loopWithFrame(e){let t=Ye;if(!t)throw new Error("E_TASK_NO_CONTEXT");return this.loop(()=>{let n;do{let i=new Ik(t,t.top);t.top=i,i.state=1,e(i),n=i.result()}while(!n.isPending()&&n.get());return n})}suspend(e){if(this.checkEnvironment(),this.task.continuation)throw new Error("E_TASK_ALREADY_SUSPENDED");let t=new yy(this.task);return this.task.continuation=t,Ye=null,this.task.waitTarget=e||null,t}},Ik=class extends qa{constructor(e,t){super(e,t,"loop")}continueLoop(){this.finish(!0)}breakLoop(){this.finish(!1)}},Us=class{constructor(e,t){this.fetch=e,d(this,"name"),d(this,"arrived",!1),d(this,"resource",null),d(this,"task",null),d(this,"piggybacks",[]),this.name=t}start(){this.task||(this.task=Jh().getScheduler().run(()=>{let e=X("Fetcher.run");return this.fetch().then(t=>{let n=this.piggybacks;if(this.arrived=!0,this.resource=t,this.task=null,this.piggybacks=[],n)for(let i=0;i<n.length;i++)try{n[i](t)}catch(r){se.error(r,"Error:")}e.finish(t)}),e.result()},this.name))}piggyback(e){this.arrived?e(this.resource):this.piggybacks.push(e)}get(){return this.arrived?F(this.resource):(this.start(),this.task.join())}hasArrived(){return this.arrived}},Ka=e=>{if(e.length==0)return F(!0);if(e.length==1)return e[0].get().thenReturn(!0);let t=X("waitForFetches"),n=0;return t.loop(()=>{for(;n<e.length;){let i=e[n++];if(!i.hasArrived())return i.get().thenReturn(!0)}return F(!1)}).then(()=>{t.finish(!0)}),t.result()},by=`
@media screen {
  [data-vivliostyle-viewer-viewport] {
    background: #aaaaaa;
  }

  [data-vivliostyle-page-container] {
    background: white;
    z-index: 0;
  }

  [data-vivliostyle-viewer-viewport] {
    box-sizing: border-box;
    display: flex;
    overflow: auto;
    position: relative;
  }

  [data-vivliostyle-outer-zoom-box] {
    margin: auto;
    overflow: hidden;
    flex: none;
  }

  [data-vivliostyle-viewer-viewport] [data-vivliostyle-spread-container] {
    display: flex;
    flex: none;
    justify-content: center;
    transform-origin: left top;
  }

  [data-vivliostyle-viewer-viewport][data-vivliostyle-page-progression="ltr"]
    [data-vivliostyle-spread-container] {
    flex-direction: row;
  }

  [data-vivliostyle-viewer-viewport][data-vivliostyle-page-progression="rtl"]
    [data-vivliostyle-spread-container] {
    flex-direction: row-reverse;
  }

  [data-vivliostyle-viewer-viewport] [data-vivliostyle-page-container] {
    margin: 0 auto;
    flex: none;
    transform-origin: center top;
  }

  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view="true"]
    [data-vivliostyle-page-container][data-vivliostyle-page-side="left"] {
    margin-right: 1px;
    transform-origin: right top;
  }

  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view="true"]
    [data-vivliostyle-page-container][data-vivliostyle-page-side="right"] {
    margin-left: 1px;
    transform-origin: left top;
  }

  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view="true"]
    [data-vivliostyle-page-container][data-vivliostyle-unpaired-page="true"] {
    margin-left: auto;
    margin-right: auto;
    transform-origin: center top;
  }
}
`,Sy=`
[data-vivliostyle-layout-box] {
  position: absolute;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  z-index: -1;
  transform-origin: left top;
}

[data-vivliostyle-debug] [data-vivliostyle-layout-box] {
  right: auto;
  bottom: auto;
  overflow: visible;
  z-index: auto;
}

[data-vivliostyle-spread-container] {
  transform: scale(var(--viv-outputScale,1));
  transform-origin: left top;
}

/* Emulate high pixel ratio using zoom & transform:scale() */
@supports (zoom: 8) {
  [data-vivliostyle-layout-box] {
    zoom: calc(var(--viv-outputPixelRatio,1) / var(--viv-devicePixelRatio,1));
    transform: scale(calc(var(--viv-devicePixelRatio,1) / var(--viv-outputPixelRatio,1)));
  }
  [data-vivliostyle-spread-container] {
    zoom: calc(var(--viv-outputPixelRatio,1) / var(--viv-devicePixelRatio,1));
    transform: scale(calc(var(--viv-outputScale,1) * var(--viv-devicePixelRatio,1) / var(--viv-outputPixelRatio,1)));
  }
  /* Workaround for Chromium's default border etc. widths not zoomed but scaled down */
  [data-vivliostyle-spread-container] :where([style*=border],[style*=outline],[style*=rule]) {
    border-width: medium;
    outline-width: medium;
    column-rule-width: medium;
  }
  [data-vivliostyle-spread-container] ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  [data-vivliostyle-spread-container] ::-webkit-scrollbar-track {
    background-color: #f4f4f4;
  }
  [data-vivliostyle-spread-container] ::-webkit-scrollbar-thumb {
    border-radius: 4px;
    background: #c7c7c7;
  }
  [data-vivliostyle-spread-container] ::-webkit-scrollbar-thumb:hover {
    background: #7d7d7d;
  }
}

[data-vivliostyle-page-container] {
  position: relative;
}

[data-vivliostyle-bleed-box] {
  position: relative;
  overflow: hidden;
  background-origin: content-box !important;
}

[data-vivliostyle-page-box] ~ [data-vivliostyle-page-box] {
  display: none;
}

[data-vivliostyle-toc-box] {
  position: absolute;
  left: 3px;
  top: 3px;
  overflow: scroll;
  overflow-x: hidden;
  background: rgba(248, 248, 248, 0.9);
  border-radius: 2px;
  box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4);
}

@media print {
  [data-vivliostyle-toc-box] {
    display: none;
  }

  [data-vivliostyle-outer-zoom-box],
  [data-vivliostyle-spread-container] {
    width: 100% !important;
    height: 100% !important;
  }

  [data-vivliostyle-spread-container] {
    --viv-outputScale: 1 !important;
    --viv-devicePixelRatio: 1 !important;
    zoom: normal !important;
    transform: none !important;
    print-color-adjust: exact;
  }

  @supports (zoom: 8) {
    [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {
      zoom: var(--viv-outputPixelRatio,1);
      transform: scale(calc(1 / var(--viv-outputPixelRatio,1)));
      transform-origin: left top;
    }
  }

  [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {
    display: block !important;
    max-height: 100vh;
  }

  [data-vivliostyle-spread-container] [data-vivliostyle-page-container]:not(:last-child) {
    break-after: page;
  }

  /* Gecko-only hack, see https://bugzilla.mozilla.org/show_bug.cgi?id=267029#c17 */
  @-moz-document url-prefix()  {
    [data-vivliostyle-spread-container] [data-vivliostyle-page-container]:nth-last-child(n + 2) {
      top: -1px;
      margin-top: 1px;
      margin-bottom: -1px;
    }
    /* Workaround Gecko problem on page break */
    [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {
      break-after: auto !important;
      height: 100% !important;
    }
  }
}
`,Cy=`
/*
 * Copyright 2013 Google, Inc.
 * Copyright 2015 Daishinsha Inc.
 * Copyright 2019 Vivliostyle Foundation
 *
 * CSS property validation.
 */
NUM = POS_NUM | ZERO | NEGATIVE;
NNEG_NUM = POS_NUM | ZERO;
INT = POS_INT | ZERO | NEGATIVE;
NNEG_INT = POS_INT | ZERO;
PERCENTAGE = POS_PERCENTAGE | ZERO | NEGATIVE;
STRICT_PERCENTAGE = POS_PERCENTAGE | ZERO_PERCENTAGE | NEGATIVE;
NNEG_PERCENTAGE = POS_PERCENTAGE | ZERO;
LENGTH = POS_LENGTH | ZERO | NEGATIVE;
NNEG_LENGTH = POS_LENGTH | ZERO;
PLENGTH = LENGTH | PERCENTAGE;
PPLENGTH = POS_LENGTH | ZERO | POS_PERCENTAGE;
ALENGTH = LENGTH | auto;
APLENGTH = PLENGTH | auto;
PAPLENGTH = PPLENGTH | auto;
ANGLE = POS_ANGLE | ZERO | NEGATIVE;
LENGTH_OR_NUM = LENGTH | NUM;
ANGLE_OR_NUM = ANGLE | NUM;
MIN_MAX_FIT_CONTENT = min-content | max-content | fit-content;
BG_POSITION_TERM = PLENGTH | left | center | right | top | bottom;
URI_OR_NONE = URI | none;
IMAGE = URI | IMAGE_FUNCTION | none;
background-attachment = COMMA( [scroll | fixed | local]+ );
background-color = COLOR;
background-image = COMMA( IMAGE+ );
background-position = COMMA( SPACE(BG_POSITION_TERM{1,4})+ ); /* relaxed */
background-repeat = COMMA( [repeat | repeat-x | repeat-y | no-repeat]+ );
border-collapse = collapse | separate;
BORDER_SIDE_COLOR = COLOR;
BORDER_SIDE_STYLE = none | hidden | dotted | dashed | solid | double | groove | ridge | inset | outset;
BORDER_SIDE_WIDTH = thin: 1px | medium: 3px | thick: 5px | NNEG_LENGTH;
border-spacing = LENGTH LENGTH?;
border-top-color = BORDER_SIDE_COLOR;
border-right-color = BORDER_SIDE_COLOR;
border-bottom-color = BORDER_SIDE_COLOR;
border-left-color = BORDER_SIDE_COLOR;
border-top-style = BORDER_SIDE_STYLE;
border-right-style = BORDER_SIDE_STYLE;
border-bottom-style = BORDER_SIDE_STYLE;
border-left-style = BORDER_SIDE_STYLE;
border-top-width = BORDER_SIDE_WIDTH;
border-right-width = BORDER_SIDE_WIDTH;
border-bottom-width = BORDER_SIDE_WIDTH;
border-left-width = BORDER_SIDE_WIDTH;
BORDER_RADIUS = PLENGTH{1,2};
border-top-left-radius = BORDER_RADIUS;
border-top-right-radius = BORDER_RADIUS;
border-bottom-right-radius = BORDER_RADIUS;
border-bottom-left-radius = BORDER_RADIUS;
border-image-source = IMAGE;
border-image-slice = [NUM | PERCENTAGE]{1,4} || fill; /* relaxed */
border-image-width = [NUM | PLENGTH | auto]{1,4};
border-image-outset = [NUM | LENGTH]{1,4};
border-image-repeat = [ stretch | repeat | round | space ]{1,2};
bottom = APLENGTH;
caption-side = top | bottom;
clear = none | left | right | top | bottom | inline-start | inline-end | block-start | block-end | inside | outside | both | all | same;
clip = rect(ALENGTH{4}) | rect(SPACE(ALENGTH{4})) | auto;
color = COLOR;
LIST_STYLE_TYPE = IDENT;
TYPE_OR_UNIT_IN_ATTR = string | color | url | integer | number | length | angle | time | frequency;
ATTR = attr(SPACE(IDENT TYPE_OR_UNIT_IN_ATTR?) [ STRING | IDENT | COLOR | INT | NUM | PLENGTH | ANGLE | POS_TIME | FREQUENCY]?);
CONTENT_LIST = [ STRING | URI | counter(IDENT LIST_STYLE_TYPE?) |
    counters(IDENT STRING LIST_STYLE_TYPE?) | ATTR |
    target-counter([ STRING | URI ] IDENT LIST_STYLE_TYPE?) |
    target-counter(ATTR IDENT LIST_STYLE_TYPE?) |
    target-counters([ STRING | URI ] IDENT STRING LIST_STYLE_TYPE?) |
    target-counters(ATTR IDENT STRING LIST_STYLE_TYPE?) |
    leader([ dotted | solid | space ] | STRING ) |
    open-quote | close-quote | no-open-quote | no-close-quote |
    content([ text | before | after | first-letter ]?) |
    string(IDENT [first | start | last | first-except]?) |
    element(IDENT [first | start | last | first-except]?) ]+;
CONTENT = normal | none | CONTENT_LIST;
content = CONTENT;
COUNTER = [ IDENT INT? ]+ | none;
counter-increment = COUNTER;
counter-reset = COUNTER;
counter-set = COUNTER;
cursor = COMMA(URI* [ auto | crosshair | default | pointer | move | e-resize | ne-resize | nw-resize |
    n-resize | se-resize | sw-resize | s-resize | w-resize | text | wait | help | progress ]);
direction = ltr | rtl;
display = inline | block | list-item | inline-block | table | inline-table | table-row-group |
    table-header-group | table-footer-group | table-row | table-column-group | table-column |
    table-cell | table-caption | none | oeb-page-head | oeb-page-foot | flex | inline-flex |
    ruby | ruby-base | ruby-text | ruby-base-container | ruby-text-container | run-in | compact | marker |
    flow-root | grid | inline-grid | contents;
empty-cells = show | hide;
FAMILY = SPACE(IDENT+) | STRING;
FAMILY_LIST = COMMA( FAMILY+ );
font-family = FAMILY_LIST;
font-size = xx-small | x-small | small | medium | large | x-large | xx-large | larger | smaller | PPLENGTH;
font-style = normal | italic | oblique;
font-weight = normal | bold | bolder | lighter | POS_NUM;
height = PAPLENGTH | MIN_MAX_FIT_CONTENT;
left = APLENGTH;
letter-spacing = normal | LENGTH_OR_NUM;
line-height = normal | POS_NUM | PPLENGTH;
list-style-image = IMAGE;
list-style-position = inside | outside;
list-style-type = LIST_STYLE_TYPE;
margin-right = APLENGTH;
margin-left = APLENGTH;
margin-top = APLENGTH;
margin-bottom = APLENGTH;
NPLENGTH = none | PLENGTH;
max-height = NPLENGTH | MIN_MAX_FIT_CONTENT;
max-width = NPLENGTH | MIN_MAX_FIT_CONTENT;
min-height = APLENGTH | MIN_MAX_FIT_CONTENT;
min-width = APLENGTH | MIN_MAX_FIT_CONTENT;
orphans = POS_INT;
outline-offset = LENGTH;
outline-color = COLOR | invert;
outline-style = BORDER_SIDE_STYLE;
outline-width = BORDER_SIDE_WIDTH;
overflow = visible | hidden | scroll | auto | clip;
padding-right = PPLENGTH;
padding-left = PPLENGTH;
padding-top = PPLENGTH;
padding-bottom = PPLENGTH;
PAGE_BREAK = auto | always | avoid | left | right | recto | verso;
page-break-after = PAGE_BREAK;
page-break-before = PAGE_BREAK;
page-break-inside = avoid | auto;
position = static | relative | absolute | fixed | running(IDENT);
quotes = [STRING STRING]+ | none | auto;
right = APLENGTH;
table-layout = auto | fixed;
text-align = left | right | center | justify | start | end | match-parent | inside | outside;
text-indent = PLENGTH;
text-transform = capitalize | uppercase | lowercase | none;
top = APLENGTH;
vertical-align = baseline | sub | super | top | text-top | middle | bottom | text-bottom | PLENGTH;
visibility = visible | hidden | collapse;
white-space = normal | pre | nowrap | pre-wrap | pre-line | break-spaces;
widows = POS_INT;
width = PAPLENGTH | MIN_MAX_FIT_CONTENT;
word-spacing = normal | LENGTH_OR_NUM;
z-index = auto | INT;

[epub,moz,webkit]hyphens = auto | manual | none;
[webkit]hyphenate-character = auto | STRING;

/* css-logical */
margin-block-start = APLENGTH;
margin-block-end = APLENGTH;
margin-inline-start = APLENGTH;
margin-inline-end = APLENGTH;
padding-block-start = APLENGTH;
padding-block-end = APLENGTH;
padding-inline-start = APLENGTH;
padding-inline-end = APLENGTH;
border-block-start-color = BORDER_SIDE_COLOR;
border-block-end-color = BORDER_SIDE_COLOR;
border-inline-start-color = BORDER_SIDE_COLOR;
border-inline-end-color = BORDER_SIDE_COLOR;
border-block-start-style = BORDER_SIDE_STYLE;
border-block-end-style = BORDER_SIDE_STYLE;
border-inline-start-style = BORDER_SIDE_STYLE;
border-inline-end-style = BORDER_SIDE_STYLE;
border-block-start-width = BORDER_SIDE_WIDTH;
border-block-end-width = BORDER_SIDE_WIDTH;
border-inline-start-width = BORDER_SIDE_WIDTH;
border-inline-end-width = BORDER_SIDE_WIDTH;
block-start = APLENGTH;
block-end = APLENGTH;
inline-start = APLENGTH;
inline-end = APLENGTH;
block-size = PAPLENGTH | MIN_MAX_FIT_CONTENT;
inline-size = PAPLENGTH | MIN_MAX_FIT_CONTENT;
max-block-size = NPLENGTH | MIN_MAX_FIT_CONTENT;
max-inline-size = NPLENGTH | MIN_MAX_FIT_CONTENT;
min-block-size = APLENGTH | MIN_MAX_FIT_CONTENT;
min-inline-size = APLENGTH | MIN_MAX_FIT_CONTENT;

margin-inside = auto | APLENGTH;
margin-outside = auto | APLENGTH;
padding-inside = PPLENGTH;
padding-outside = PPLENGTH;
border-inside-color = BORDER_SIDE_COLOR;
border-outside-color = BORDER_SIDE_COLOR;
border-inside-style = BORDER_SIDE_STYLE;
border-outside-style = BORDER_SIDE_STYLE;
border-inside-width = BORDER_SIDE_WIDTH;
border-outside-width = BORDER_SIDE_WIDTH;
inside = APLENGTH;
outside = APLENGTH;

SHAPE = auto | rectangle( PLENGTH{4} ) |  ellipse( PLENGTH{4} ) |  circle( PLENGTH{3} ) |
    polygon( SPACE(PLENGTH+)+ );
[epubx]shape-inside = SHAPE;
[epubx,webkit]shape-outside = SHAPE;
[epubx]wrap-flow = auto | both | start | end | maximum | clear | around /* epub al */;

TRANSFORM_FUNCTION = matrix(NUM{6}) | translate(PLENGTH{1,2}) | translateX(PLENGTH) | translateY(PLENGTH) |
 scale(NUM{1,2}) | scaleX(NUM) | scaleY(NUM) | rotate(ANGLE) | skewX(ANGLE) | skewY(ANGLE);
[epub]transform = none | TRANSFORM_FUNCTION+;
[epub]transform-origin = [[[ top | bottom | left | right] PLENGTH?] | center | PLENGTH]{1,2}; /* relaxed */

BOX = border-box | padding-box | content-box;
SHADOW = SPACE(inset || LENGTH{2,4} || COLOR); /* relaxed */
[webkit]background-size = COMMA( SPACE( [PLENGTH | auto ]{1,2} | cover | contain)+ );
[webkit]background-origin = COMMA( BOX+ );
[webkit]background-clip = COMMA( BOX+ );
[webkit]box-shadow = none | COMMA( SHADOW+ );
text-shadow = none |  COMMA( SHADOW+ );
[webkit]box-decoration-break = slice | clone;
FILTER_FUNCTION = blur(LENGTH) | brightness(NUM | PERCENTAGE) | contrast(NUM | PERCENTAGE) | drop-shadow(SPACE(LENGTH{2,3} COLOR?))
                | grayscale(NUM | PERCENTAGE) | hue-rotate(ANGLE) | invert(NUM | PERCENTAGE) | opacity(NUM | PERCENTAGE)
                | saturate(NUM | PERCENTAGE) | sepia(NUM | PERCENTAGE);
FILTER_FUNCTION_LIST = FILTER_FUNCTION+;
[webkit]filter = none | FILTER_FUNCTION_LIST;

opacity = NUM;

[moz,webkit]column-width = LENGTH | auto;
[moz,webkit]column-count = INT | auto;
[moz,webkit]column-gap = LENGTH | normal;
[moz,webkit]column-rule-color = COLOR;
[moz,webkit]column-rule-style = BORDER_SIDE_STYLE;
[moz,webkit]column-rule-width = BORDER_SIDE_WIDTH;
BREAK = auto | avoid | avoid-page | page | left | right | recto | verso | avoid-column | column | avoid-region | region;
break-before = BREAK;
break-after = BREAK;
break-inside = auto | avoid | avoid-page | avoid-column | avoid-region;
[webkit]column-span = none | auto | all;
[moz]column-fill = auto | balance | balance-all;
margin-break = auto | keep | discard;

src = COMMA([SPACE(URI format(STRING+)?) | local(FAMILY)]+); /* for font-face */

[epubx,webkit]flow-from = IDENT;
[epubx,webkit]flow-into = IDENT;
[epubx]flow-linger = INT | none;
[epubx]flow-priority = INT;
[epubx]flow-options = none | [ exclusive || last || static ];
[epubx]page = INT | auto | IDENT; /* page: IDENT is for CSS Paged Media */
[epubx]min-page-width = LENGTH;
[epubx]min-page-height = LENGTH;
[epubx]required = true | false;
[epubx]enabled = true | false;
[epubx]conflicting-partitions = COMMA(IDENT+);
[epubx]required-partitions = COMMA(IDENT+);
[epubx]snap-height = LENGTH | none;
[epubx]snap-width = LENGTH | none;
[epubx]flow-consume = all | some;
[epubx]utilization = NUM;
[epubx]text-zoom = font-size | scale;

[adapt]template = URI_OR_NONE | footnote;
[adapt]behavior = IDENT;

/* CSS Fonts */
COMMON_LIG_VALUES        = [ common-ligatures | no-common-ligatures ];
DISCRETIONARY_LIG_VALUES = [ discretionary-ligatures | no-discretionary-ligatures ];
HISTORICAL_LIG_VALUES    = [ historical-ligatures | no-historical-ligatures ];
CONTEXTUAL_ALT_VALUES    = [ contextual | no-contextual ];
font-variant-ligatures = normal | none | [ COMMON_LIG_VALUES || DISCRETIONARY_LIG_VALUES || HISTORICAL_LIG_VALUES || CONTEXTUAL_ALT_VALUES ];
font-variant-caps = normal | small-caps | all-small-caps | petite-caps | all-petite-caps | unicase | titling-caps;
NUMERIC_FIGURE_VALUES   = [ lining-nums | oldstyle-nums ];
NUMERIC_SPACING_VALUES  = [ proportional-nums | tabular-nums ];
NUMERIC_FRACTION_VALUES = [ diagonal-fractions | stacked-fractions ];
font-variant-numeric = normal | [ NUMERIC_FIGURE_VALUES || NUMERIC_SPACING_VALUES || NUMERIC_FRACTION_VALUES || ordinal || slashed-zero ];
EAST_ASIAN_VARIANT_VALUES = [ jis78 | jis83 | jis90 | jis04 | simplified | traditional ];
EAST_ASIAN_WIDTH_VALUES   = [ full-width | proportional-width ];
font-variant-east-asian = normal | [ EAST_ASIAN_VARIANT_VALUES || EAST_ASIAN_WIDTH_VALUES || ruby ];
font-variant_css2 = normal | small-caps; /* for font shorthand */
font-size-adjust = none | NNEG_NUM;
[webkit]font-kerning = auto | normal | none;
font-feature-settings = COMMA( normal | SPACE( STRING [ on | off | INT ]? )+ );
FONT_STRETCH_CSS3_VALUES = normal | wider | narrower | ultra-condensed | extra-condensed | condensed | semi-condensed | semi-expanded | expanded | extra-expanded | ultra-expanded;
font-stretch = FONT_STRETCH_CSS3_VALUES | PERCENTAGE;
font-stretch_css3 = FONT_STRETCH_CSS3_VALUES; /* for font shorthand */
font-display = [ auto | block | swap | fallback | optional ];
unicode-range = COMMA( URANGE+ );

/* CSS Images */
image-resolution = RESOLUTION;
object-fit = fill | contain | cover | none | scale-down;
object-position = COMMA( SPACE(BG_POSITION_TERM{1,4})+ ); /* relaxed */

/* CSS Paged Media */
PAGE_SIZE = a10 | a9 | a8 | a7 | a6 | a5 | a4 | a3 | a2 | a1 | a0
          | b10 | b9 | b8 | b7 | b6 | b5 | b4 | b3 | b2 | b1 | b0
          | c10 | c9 | c8 | c7 | c6 | c5 | c4 | c3 | c2 | c1 | c0
          | jis-b10 | jis-b9 | jis-b8 | jis-b7 | jis-b6 | jis-b5 | jis-b4 | jis-b3 | jis-b2 | jis-b1 | jis-b0
          | letter | legal | ledger;
bleed = auto | LENGTH;
marks = none | [ crop || cross ];
size = POS_LENGTH{1,2} | auto | [ PAGE_SIZE || [ portrait | landscape ] ];
crop-offset = auto | LENGTH;
crop-marks-line-color = auto | COLOR;

/* CSS Page Floats */
float-reference = inline | column | region | page;
float = none | footnote | [ block-start || block-end || inline-start || inline-end || snap-block || snap-inline || left || right || top || bottom || inside || outside ];
float-min-wrap-block = PPLENGTH;

/* CSS Ruby */
ruby-align = start | center | space-between | space-around;
ruby-position = over | under | inter-character;

/* CSS Size Adjust */
[moz,webkit]text-size-adjust = auto | none | POS_PERCENTAGE;

/* CSS Text */
[webkit]line-break = auto | loose | normal | strict | anywhere;
overflow-wrap = normal | break-word | anywhere;
[moz]tab-size = NNEG_INT | NNEG_LENGTH;
[moz]text-align-last = auto | start | end | left | right | center | justify | inside | outside;
text-justify = auto | none | inter-word | inter-character;
word-break = normal | keep-all | break-all | break-word;
text-spacing-trim = auto | normal | space-all | trim-both | trim-auto |
    [[ trim-start | space-start | space-first ] ||
     [ trim-end | space-end | allow-end ] ||
     [ trim-adjacent | space-adjacent ]];
text-autospace = normal | auto | no-autospace |
    [[ ideograph-alpha || ideograph-numeric || punctuation ] || [ insert | replace ]];
hanging-punctuation = none | [ first || [ force-end | allow-end ] || last ];

/* CSS Text Decoration */
[webkit]text-decoration-color = COLOR;
[webkit]text-decoration-line = none | [ underline || overline || line-through || blink ];
[webkit]text-decoration-skip = none | [ objects || spaces || ink || edges || box-decoration ];
[webkit]text-decoration-style = solid | double | dotted | dashed | wavy;
[webkit]text-decoration-thickness = from-font | APLENGTH;
[epub,webkit]text-emphasis-color = COLOR;
[webkit]text-emphasis-position = [ over | under ] [ right | left ];
[epub,webkit]text-emphasis-style = none | [[ filled | open ] || [ dot | circle | double-circle | triangle | sesame ]] | STRING;
[webkit]text-underline-position = auto | [ under || [ left | right ]];

/* CSS Transforms */
[webkit]backface-visibility = visible | hidden;

/* CSS UI */
[moz,webkit]box-sizing = content-box | padding-box | border-box;
text-overflow = [clip | ellipsis | STRING]{1,2};

/* CSS Writing Modes */
[epub,webkit]text-combine = none | horizontal;
text-combine-upright = none | all; /* relaxed */
[epub,webkit]text-orientation = mixed | upright | sideways-right | sideways-left | sideways | use-glyph-orientation /* the following values are kept for backward-compatibility */ | vertical-right | rotate-right | rotate-left | rotate-normal | auto;
unicode-bidi = normal | embed | isolate | bidi-override | isolate-override | plaintext;
[epub,webkit]writing-mode = horizontal-tb | vertical-rl | lr-tb | rl-tb | tb-rl | lr | rl | tb;

/* CSS Flex box */
FLEX_BASIS = content | PAPLENGTH;
flex-direction = row | row-reverse | column | column-reverse;
flex-wrap = nowrap | wrap | wrap-reverse;
order = INT;
flex-grow = NNEG_NUM;
flex-shrink = NNEG_NUM;
flex-basis = FLEX_BASIS;
flex = none | [ [ NNEG_NUM NNEG_NUM? ] || FLEX_BASIS ];
justify-content = flex-start | flex-end | center | space-between | space-around;
align-items = flex-start | flex-end | center | baseline | stretch;
align-self = auto | flex-start | flex-end | center | baseline | stretch;
align-content = flex-start | flex-end | center | space-between | space-around | stretch;

/* Pointer Events */
touch-action = auto | none | [ pan-x || pan-y ] | manipulation;

/* SVG 2 */
OPACITY_VALUE = NUM | PERCENTAGE;
DASH_ARRAY = COMMA( SPACE( [ LENGTH | PERCENTAGE | NUM ]+ )+ );
PAINT = none | child | child(INT) | COLOR | SPACE( URI [none | COLOR]? ) | context-fill | context-stroke;
color-interpolation = auto | sRGB | linearRGB;
color-rendering = auto | optimizeSpeed | optimizeQuality;
fill = PAINT;
fill-opacity = OPACITY_VALUE;
fill-rule = nonzero | evenodd;
glyph-orientation-vertical = auto | NUM | ANGLE;
image-rendering = auto | optimizeSpeed | optimizeQuality | crisp-edges | pixelated;
marker-start = none | URI;
marker-mid = none | URI;
marker-end = none | URI;
pointer-events = bounding-box | visiblePainted | visibleFill | visibleStroke | visible | painted | fill | stroke | all | none;
paint-order = normal | [ fill || stroke || markers ];
shape-rendering = auto | optimizeSpeed | crispEdges | geometricPrecision;
stop-color = COLOR;
stop-opacity = OPACITY_VALUE;
stroke = PAINT;
stroke-dasharray = none | DASH_ARRAY;
stroke-dashoffset = PERCENTAGE | LENGTH_OR_NUM;
stroke-linecap = butt | round | square;
stroke-linejoin = miter | round | bevel;
stroke-miterlimit = NUM;
stroke-opacity = OPACITY_VALUE;
stroke-width = PERCENTAGE | LENGTH_OR_NUM;
text-anchor = start | middle | end;
text-rendering = auto | optimizeSpeed | optimizeLegibility | geometricPrecision;
vector-effect = none | SPACE( [ non-scaling-stroke | non-scaling-size | non-rotation | fixed-position ]+ [ viewport | screen ]? );

/* SVG 1.1 */
alignment-baseline = auto | baseline | before-edge | text-before-edge | middle | central | after-edge | text-after-edge | ideographic | alphabetic | hanging | mathematical;
baseline-shift = baseline | sub | super | PERCENTAGE | LENGTH_OR_NUM;
dominant-baseline = auto | use-script | no-change | reset-size | ideographic | alphabetic | hanging | mathematical | central | middle | text-after-edge | text-before-edge;
mask = none | URI;

/* css-masking-1 */
SHAPE_RADIUS = PLENGTH | closest-side | farthest-side;
FILL_RULE = nonzero | evenodd;
SHAPE_BOX = BOX | margin-box;
GEOMETRY_BOX = SHAPE_BOX | fill-box | stroke-box | view-box;
BASIC_SHAPE =
    inset( SPACE( PLENGTH{1,4} [ round PLENGTH{1,4} [ SLASH PLENGTH{1,4} ]? ]? ) )
  | circle(  SPACE( [SHAPE_RADIUS]?    [at BG_POSITION_TERM{1,4}]? ) )
  | ellipse( SPACE( SHAPE_RADIUS{2}? [at BG_POSITION_TERM{1,4}]? ) )
  | polygon( FILL_RULE? COMMA( SPACE( PLENGTH{2} )+ )+ );
[webkit]clip-path = none | URI | [ BASIC_SHAPE || GEOMETRY_BOX ];
clip-rule = nonzero | evenodd;

/* filters */
flood-color = COLOR;
flood-opacity = OPACITY_VALUE;
lighting-color = COLOR;

/* compositing-1 */
BLEND_MODE = normal | multiply | screen | overlay | darken | lighten | color-dodge | color-burn | hard-light | soft-light | difference | exclusion | hue | saturation | color | luminosity;
mix-blend-mode = BLEND_MODE;
isolation = auto | isolate;
background-blend-mode = COMMA( BLEND_MODE+ );

/* CSS GCPM */
string-set = COMMA( SPACE( IDENT CONTENT_LIST )+ | none );
footnote-policy = auto | line;

/* CSS Repeated Headers and Footers */
[viv]repeat-on-break = auto | none | header | footer;

/* Compatibility */
[webkit]text-fill-color = COLOR;
[webkit]text-stroke-color = COLOR;
[webkit]text-stroke-width = BORDER_SIDE_WIDTH;

DEFAULTS

background-attachment: scroll;
background-color: transparent;
background-image: none;
background-repeat: repeat;
background-position: 0% 0%;
background-clip: border-box;
background-origin: padding-box;
background-size: auto;
border-top-color: currentColor;
border-right-color: currentColor;
border-bottom-color: currentColor;
border-left-color: currentColor;
border-top-style: none;
border-right-style: none;
border-bottom-style: none;
border-left-style: none;
border-top-width: 3px;
border-right-width: 3px;
border-bottom-width: 3px;
border-left-width: 3px;
border-top-left-radius: 0;
border-top-right-radius: 0;
border-bottom-right-radius: 0;
border-bottom-left-radius: 0;
border-image-source: none;
border-image-slice: 100%;
border-image-width: 1;
border-image-outset: 0;
border-image-repeat: stretch;
column-count: auto;
column-gap: normal;
column-width: auto;
column-rule-color: currentColor;
column-rule-style: none;
column-rule-width: 3px;
column-fill: balance;
outline-color: currentColor;
outline-style: none;
outline-width: 3px;
flex-direction: row;
flex-wrap: nowrap;
font-family: serif;
font-style: normal;
font-size: medium;
font-size-adjust: none;
font-kerning: auto;
font-feature-settings: normal;
font-variant-ligatures: normal;
font-variant-caps: normal;
font-variant-numeric: normal;
font-variant-east-asian: normal;
font-weight: normal;
font-stretch: normal;
line-height: normal;
list-style-image: none;
list-style-position: outside;
list-style-type: disc;
margin-bottom: auto;
margin-left: auto;
margin-right: auto;
margin-top: auto;
padding-bottom: auto;
padding-left: auto;
padding-right: auto;
padding-top: auto;
text-autospace: normal;
text-emphasis-color: currentColor;
text-emphasis-style: none;
text-spacing-trim: normal;
text-stroke-color: currentColor;
text-stroke-width: 0;
marker-start: none;
marker-mid: none;
marker-end: none;

/* css-logical */
border-block-start-color: currentColor;
border-block-end-color: currentColor;
border-inline-start-color: currentColor;
border-inline-end-color: currentColor;
border-inside-color: currentColor;
border-outside-color: currentColor;
border-block-start-style: none;
border-block-end-style: none;
border-inline-start-style: none;
border-inline-end-style: none;
border-inside-style: none;
border-outside-style: none;
border-block-start-width: 3px;
border-block-end-width: 3px;
border-inline-start-width: 3px;
border-inline-end-width: 3px;
border-inside-width: 3px;
border-outside-width: 3px;

SHORTHANDS

all = ALL;
background = COMMA background-image [background-position [ / background-size ]] background-repeat
     background-attachment [background-origin background-clip] background-color; /* background-color is a special case, see the code */
border-top = border-top-width border-top-style border-top-color;
border-right = border-right-width border-right-style border-right-color;
border-bottom = border-bottom-width border-bottom-style border-bottom-color;
border-left = border-left-width border-left-style border-left-color;
border-inside = border-inside-width border-inside-style border-inside-color;
border-outside = border-outside-width border-outside-style border-outside-color;
border-width = INSETS border-top-width border-right-width border-bottom-width border-left-width;
border-style = INSETS border-top-style border-right-style border-bottom-style border-left-style;
border-color = INSETS border-top-color border-right-color border-bottom-color border-left-color;
border = border-width border-style border-color;
border-image = border-image-source border-image-slice [ / border-image-width [ / border-image-outset ] ]
     border-image-repeat;
border-radius = INSETS_SLASH border-top-left-radius border-top-right-radius
     border-bottom-right-radius border-bottom-left-radius;
[moz,webkit]columns = column-width column-count;
[moz,webkit]column-rule = column-rule-width column-rule-style column-rule-color;
flex-flow = flex-direction flex-wrap;
oeb-column-number = column-count;
outline = outline-width outline-style outline-color;
list-style = list-style-position list-style-type list-style-image;
margin = INSETS margin-top margin-right margin-bottom margin-left;
padding = INSETS padding-top padding-right padding-bottom padding-left;
font = FONT font-style font-variant_css2 font-weight font-stretch_css3 /* font-size line-height font-family are special-cased */;
font-variant = font-variant-ligatures font-variant-caps font-variant-numeric font-variant-east-asian;
[epub,webkit]text-emphasis = text-emphasis-style text-emphasis-color;
marker = INSETS marker-start marker-mid marker-end;
[webkit]text-stroke = text-stroke-width text-stroke-color;
text-decoration = text-decoration-line text-decoration-color text-decoration-style text-decoration-thickness;
text-spacing = TEXT_SPACING text-autospace text-spacing-trim;

/* css-logical */
margin-block = INSETS margin-block-start margin-block-end;
margin-inline = INSETS margin-inline-start margin-inline-end;
padding-block = INSETS padding-block-start padding-block-end;
padding-inline = INSETS padding-inline-start padding-inline-end;
border-block-width = INSETS border-block-start-width border-block-end-width;
border-block-style = INSETS border-block-start-style border-block-end-style;
border-block-color = INSETS border-block-start-color border-block-end-color;
border-inline-width = INSETS border-inline-start-width border-inline-end-width;
border-inline-style = INSETS border-inline-start-style border-inline-end-style;
border-inline-color = INSETS border-inline-start-color border-inline-end-color;
border-block = border-block-width border-block-style border-block-color;
border-inline = border-inline-width border-inline-style border-inline-color;
border-block-start = border-block-start-width border-block-start-style border-block-start-color;
border-block-end = border-block-end-width border-block-end-style border-block-end-color;
border-inline-start = border-inline-start-width border-inline-start-style border-inline-start-color;
border-inline-end = border-inline-end-width border-inline-end-style border-inline-end-color;
inset-block-start = block-start;
inset-block-end = block-end;
inset-inline-start = inline-start;
inset-inline-end = inline-end;
inset-inside = inside;
inset-outside = outside;
inset-block = INSETS block-start block-end;
inset-inline = INSETS inline-start inline-end;
inset = INSETS top right bottom left;

/* old names  */
word-wrap = overflow-wrap;
[adapt,webkit]margin-before = margin-block-start;
[adapt,webkit]margin-after = margin-block-end;
[adapt,webkit]margin-start = margin-inline-start;
[adapt,webkit]margin-end = margin-inline-end;
[adapt,webkit]padding-before = padding-block-start;
[adapt,webkit]padding-after = padding-block-end;
[adapt,webkit]padding-start = padding-inline-start;
[adapt,webkit]padding-end = padding-inline-end;
[adapt,webkit]border-before-color = border-block-start-color;
[adapt,webkit]border-after-color = border-block-end-color;
[adapt,webkit]border-start-color = border-inline-start-color;
[adapt,webkit]border-end-color = border-inline-end-color;
[adapt,webkit]border-before-style = border-block-start-style;
[adapt,webkit]border-after-style = border-block-end-style;
[adapt,webkit]border-start-style = border-inline-start-style;
[adapt,webkit]border-end-style = border-inline-end-style;
[adapt,webkit]border-before-width = border-block-start-width;
[adapt,webkit]border-after-width = border-block-end-width;
[adapt,webkit]border-start-width = border-inline-start-width;
[adapt,webkit]border-end-width = border-inline-end-width;
[adapt,webkit]before = block-start;
[adapt,webkit]after = block-end;
[adapt,webkit]start = inline-start;
[adapt,webkit]end = inline-end;

`,ky=`
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:s="http://www.pyroxy.com/ns/shadow">
<head>
<style><![CDATA[

.-vivliostyle-footnote-content {
  float: footnote;
}

.-vivliostyle-table-cell-container {
  display: block;
}

]]></style>
</head>
<body>

<s:template id="footnote"><s:content/><s:include class="-vivliostyle-footnote-content"/></s:template>

<s:template id="table-cell"><div data-vivliostyle-flow-root="true" class="-vivliostyle-table-cell-container"><s:content/></div></s:template>

</body>
</html>`,Ey=`
@namespace "http://www.w3.org/1999/xhtml";

:root {
  hyphens: -epubx-expr(pref-hyphenate? "auto": "manual");
}
:root[data-vivliostyle-epub-spine-properties~="page-spread-left"] {
  break-before: left;
}
:root[data-vivliostyle-epub-spine-properties~="page-spread-right"] {
  break-before: right;
}

@-adapt-footnote-area {
  display: block;
  margin-block-start: 0.5em;
  margin-block-end: 0.5em;
}

@-adapt-footnote-area ::before {
  display: block;
  border-block-start-width: 1px;
  border-block-start-style: solid;
  border-block-start-color: black;
  margin-block-end: 0.4em;
  margin-inline-start: 0;
  margin-inline-end: 60%;
}

/* default page master */
@-epubx-page-master :background-host {
  @-epubx-partition :layout-host {
    -epubx-flow-from: body;
    top: -epubx-expr(header.margin-bottom-edge);
    bottom: -epubx-expr(page-height - footer.margin-top-edge);
    left: 0px;
    right: 0px;
    column-width: 25em;
  }
  @-epubx-partition footer :oeb-page-foot {
    writing-mode: horizontal-tb;
    -epubx-flow-from: oeb-page-foot;
    bottom: 0px;
    left: 0px;
    right: 0px;
  }
  @-epubx-partition header :oeb-page-head {
    writing-mode: horizontal-tb;
    -epubx-flow-from: oeb-page-head;
    top: 0px;
    left: 0px;
    right: 0px;
  }
}

@page {
  @top-left-corner {
    text-align: right;
    vertical-align: middle;
  }
  @top-left {
    text-align: left;
    vertical-align: middle;
  }
  @top-center {
    text-align: center;
    vertical-align: middle;
  }
  @top-right {
    text-align: right;
    vertical-align: middle;
  }
  @top-right-corner {
    text-align: left;
    vertical-align: middle;
  }
  @left-top {
    text-align: center;
    vertical-align: top;
  }
  @left-middle {
    text-align: center;
    vertical-align: middle;
  }
  @left-bottom {
    text-align: center;
    vertical-align: bottom;
  }
  @right-top {
    text-align: center;
    vertical-align: top;
  }
  @right-middle {
    text-align: center;
    vertical-align: middle;
  }
  @right-bottom {
    text-align: center;
    vertical-align: bottom;
  }
  @bottom-left-corner {
    text-align: right;
    vertical-align: middle;
  }
  @bottom-left {
    text-align: left;
    vertical-align: middle;
  }
  @bottom-center {
    text-align: center;
    vertical-align: middle;
  }
  @bottom-right {
    text-align: right;
    vertical-align: middle;
  }
  @bottom-right-corner {
    text-align: left;
    vertical-align: middle;
  }
}

@media print {
  @page {
    margin: 10%;
  }
}
`,Py=`
@namespace "http://www.w3.org/1999/xhtml";
@namespace m "http://www.w3.org/1998/Math/MathML";
@namespace epub "http://www.idpf.org/2007/ops";

html,
address,
blockquote,
body,
dd,
div,
dl,
dt,
fieldset,
form,
frame,
frameset,
h1,
h2,
h3,
h4,
h5,
h6,
noframes,
ol,
p,
ul,
center,
dir,
hr,
menu,
pre,
details,
dialog,
legend,
listing,
optgroup,
option,
plaintext,
search,
xmp,
article,
section,
nav,
aside,
hgroup,
footer,
header,
figure,
figcaption,
main {
  display: block;
}
li {
  display: list-item;
}
head {
  display: none !important;
}
table {
  display: table;
}
tr {
  display: table-row;
}
thead {
  display: table-header-group;
  break-after: avoid;
}
tbody {
  display: table-row-group;
}
tfoot {
  display: table-footer-group;
  break-before: avoid;
}
col {
  display: table-column;
}
colgroup {
  display: table-column-group;
}
td,
th {
  display: table-cell;
}
caption {
  display: table-caption;
  text-align: center;
}
th {
  font-weight: bolder;
  text-align: center;
}
*[hidden],
link,
style,
script {
  display: none;
}
h1 {
  font-size: 2em;
  margin-block: 0.67em;
}
h2 {
  font-size: 1.5em;
  margin-block: 0.83em;
}
h3 {
  font-size: 1.17em;
  margin-block: 1em;
}
h4 {
  font-size: 1em;
  margin-block: 1.33em;
}
h5 {
  font-size: 0.83em;
  margin-block: 1.67em;
}
h6 {
  font-size: 0.67em;
  margin-block: 2.33em;
}
h1,
h2,
h3,
h4,
h5,
h6 {
  font-weight: bold;
  break-after: avoid;
}
p,
blockquote,
figure,
ul,
ol,
dl,
dir,
menu {
  margin-block: 1em;
}
b,
strong {
  font-weight: bolder;
}
blockquote,
figure {
  margin-inline: 40px;
}
i,
cite,
dfn,
em,
var,
address {
  font-style: italic;
}
pre,
tt,
code,
kbd,
samp {
  font-family: monospace;
  text-spacing: none;
  hanging-punctuation: none;
}
listing,
plaintext,
xmp,
pre {
  white-space: pre;
}
pre[wrap] {
  white-space: pre-wrap;
}
button,
textarea,
input,
select {
  display: inline-block;
}
big {
  font-size: 1.17em;
}
small,
sub,
sup {
  font-size: 0.83em;
}
sub {
  vertical-align: sub;
}
sup {
  vertical-align: super;
}
table {
  box-sizing: border-box;
  border-spacing: 2px;
  border-collapse: separate;
  text-indent: initial;
}
thead,
tbody,
tfoot,
table > tr {
  vertical-align: middle;
}
tr,
td,
th {
  vertical-align: inherit;
}
s,
strike,
del {
  text-decoration: line-through;
}
hr {
  border-style: inset;
  border-width: 1px;
  margin-block: 0.5em;
}
hr[color],
hr[noshade] {
  border-style: solid;
}
ol,
ul,
dir,
menu {
  padding-inline-start: 40px;
}
dd {
  margin-inline-start: 40px;
}
ol ul,
ul ol,
ul ul,
ol ol {
  margin-block: 0;
}
u,
ins {
  text-decoration: underline;
}
center {
  text-align: center;
}
q::before {
  content: open-quote;
}
q::after {
  content: close-quote;
}

ruby {
  display: ruby;
}
rp {
  display: none;
}
rbc {
  display: ruby-base-container;
}
rtc {
  display: ruby-text-container;
}
rb {
  display: ruby-base;
  white-space: nowrap;
}
rt {
  display: ruby-text;
}
rtc,
rt {
  text-emphasis: none;
  white-space: nowrap;
  line-height: 1;
}
rtc,
rt {
  font-size: 50%;
}
rtc:lang(zh-TW),
rt:lang(zh-TW) {
  font-size: 30%;
}
rtc > rt,
rtc > rt:lang(zh-TW) {
  font-size: 100%;
}

/* Bidi settings */
bdo[dir="ltr"] {
  direction: ltr;
  unicode-bidi: bidi-override;
}
bdo[dir="rtl"] {
  direction: rtl;
  unicode-bidi: bidi-override;
}
*[dir="ltr"] {
  direction: ltr;
  unicode-bidi: isolate;
}
*[dir="rtl"] {
  direction: rtl;
  unicode-bidi: isolate;
}

/* MathML */
m|math[display="block"] {
  display: block;
  display: block math;
}

/*------------------ epub-specific ---------------------*/

a[epub|type="noteref"],
a[epub\\:type="noteref"] {
  font-size: 0.75em;
  vertical-align: super;
  line-height: 0.01;
}

a[epub|type="noteref"]:href-epub-type(footnote, aside),
a[epub\\:type="noteref"]:href-epub-type(footnote, aside) {
  -adapt-template: footnote;
  text-decoration: none;
}

aside[epub|type="footnote"],
aside[epub\\:type="footnote"] {
  display: none;
}

aside[epub|type="footnote"]:footnote-content,
aside[epub\\:type="footnote"]:footnote-content {
  display: block;
  margin: 0.25em;
  font-size: 1.2em;
  line-height: 1.2;
}

epub|trigger {
  display: none;
}

epub|switch {
  display: inline;
}

epub|default {
  display: inline;
}

epub|case {
  display: none;
}

epub|case[required-namespace::supported] {
  display: inline;
}

epub|case[required-namespace::supported] ~ epub|case {
  display: none;
}

epub|case[required-namespace::supported] ~ epub|default {
  display: none;
}
`,Ny=`
@namespace "http://www.w3.org/1999/xhtml";

*:not([data-vivliostyle-role=doc-toc],
  [data-vivliostyle-role=doc-toc] *,
  :has([data-vivliostyle-role=doc-toc]),
  :is(h1,h2,h3,h4,h5,h6):has(+:not(nav)[data-vivliostyle-role=doc-toc])) {
  display: none;
}

[hidden] {
  display: revert;
}

[data-vivliostyle-role=doc-toc] li a {
  -adapt-behavior: toc-node-anchor;
}

[data-vivliostyle-role=doc-toc] li {
  -adapt-behavior: toc-node;
}

[data-vivliostyle-role=doc-toc] li > :not(ul,ol):first-child {
  -adapt-behavior: toc-node-first-child;
}

[data-vivliostyle-role=doc-toc] :is(ol,ul),
[data-vivliostyle-role=doc-toc]:is(ol,ul) {
  -adapt-behavior: toc-container;
}
`,Ty=`
[data-viv-margin-discard~="block-start"] {
  margin-block-start: 0 !important;
}
[data-viv-margin-discard~="block-end"] {
  margin-block-end: 0 !important;
}
[data-viv-margin-discard~="inline-start"] {
  margin-inline-start: 0 !important;
}
[data-viv-margin-discard~="inline-end"] {
  margin-inline-end: 0 !important;
}

[data-viv-box-break~="inline-start"]:not([data-viv-box-break~="clone"]) {
  margin-inline-start: 0 !important;
  padding-inline-start: 0 !important;
  border-inline-start-width: 0 !important;
  border-start-start-radius: 0 !important;
  border-end-start-radius: 0 !important;
}
[data-viv-box-break~="inline-end"]:not([data-viv-box-break~="clone"]) {
  margin-inline-end: 0 !important;
  padding-inline-end: 0 !important;
  border-inline-end-width: 0 !important;
  border-start-end-radius: 0 !important;
  border-end-end-radius: 0 !important;
}
[data-viv-box-break~="block-start"]:not([data-viv-box-break~="clone"]):not(table[style*="border-collapse: collapse"]:has(>thead)) {
  margin-block-start: 0 !important;
  padding-block-start: 0 !important;
  border-block-start-width: 0 !important;
  border-start-start-radius: 0 !important;
  border-start-end-radius: 0 !important;
}
[data-viv-box-break~="block-end"]:not([data-viv-box-break~="clone"]):not(table[style*="border-collapse: collapse"]:has(>tfoot)) {
  margin-block-end: 0 !important;
  padding-block-end: 0 !important;
  border-block-end-width: 0 !important;
  border-end-start-radius: 0 !important;
  border-end-end-radius: 0 !important;
}
[data-viv-box-break~="block-start"][data-viv-box-break~="text-start"] {
  text-indent: 0 !important;
}
[data-viv-box-break~="block-end"][data-viv-box-break~="text-end"][data-viv-box-break~="justify"] {
  text-align-last: justify !important;
}
[data-viv-box-break~="block-end"][data-viv-box-break~="text-end"][data-viv-box-break~="justify"] > * {
  text-align-last: auto;
}
[data-viv-box-break~="block-end"][data-viv-box-break~="text-end"]:not([data-viv-box-break~="justify"]) {
  text-align-last: auto !important;
}

span.viv-anonymous-block {
  display: block;
}

[data-vivliostyle-page-container] {
  text-spacing-trim: space-all;
  text-autospace: no-autospace;
}
viv-ts-open.viv-ts-auto > viv-ts-inner,
viv-ts-open.viv-ts-trim > viv-ts-inner {
  margin-inline-start: -0.5em;
}
viv-ts-close.viv-ts-auto > viv-ts-inner,
viv-ts-close.viv-ts-trim > viv-ts-inner {
  letter-spacing: -0.5em;
}
viv-ts-close.viv-hang-end > viv-ts-inner,
viv-ts-close.viv-hang-last > viv-ts-inner {
  letter-spacing: -1em;
}
viv-ts-open.viv-ts-auto::before,
viv-ts-close.viv-ts-auto::after,
viv-ts-close.viv-hang-end::after {
  content: " ";
  font-family: Courier, monospace;
  word-spacing: normal;
  letter-spacing: -0.11em;
  line-height: 0;
  text-orientation: mixed;
  visibility: hidden;
}
viv-ts-close.viv-hang-end:not(.viv-hang-hw)::after {
  letter-spacing: 0.4em;
}
viv-ts-close.viv-hang-hw > viv-ts-inner {
  letter-spacing: -0.5em;
}
viv-ts-open.viv-hang-first > viv-ts-inner {
  display: inline-block;
  line-height: 1;
  inline-size: 1em;
  text-indent: 0;
  text-align: end;
  text-align-last: end;
  margin-inline-start: -1em;
}
viv-ts-thin-sp::after {
  content: " ";
  font-family: Times, serif;
  word-spacing: normal;
  letter-spacing: -0.125em;
  line-height: 0;
  text-orientation: mixed;
  visibility: hidden;
}
[style*=text-decoration] :is(viv-ts-thin-sp, viv-ts-close.viv-ts-auto)::after {
  visibility: visible;
}

span[data-viv-leader] {
  text-combine-upright: none;
  text-orientation: mixed;
  white-space: pre;
}
`;function Qa(e,t,n){let i=X("fetchFromURL"),r={method:n||"GET",mode:"cors"},o=i.suspend(),s={status:0,statusText:"",url:e,contentType:null,responseText:null,responseXML:null,responseBlob:null};return fetch(e,r).then(l=>{var a;return s.status=l.status,s.url=l.url,s.statusText=l.statusText,s.contentType=(a=l.headers.get("Content-Type"))==null?void 0:a.replace(/;.*$/,"").toLowerCase(),l.ok?t==="blob"?l.blob():t==="arraybuffer"?l.arrayBuffer():t==="json"?l.json():/\/aozorabunko\/[^/]+\/cards\/[^/]+\/files\/[^/.]+\.html$/.test(e)?(s.contentType="text/html",l.arrayBuffer().then(u=>new TextDecoder("Shift_JIS").decode(u))):(/^data:,(<|%3c)/i.test(e)&&(s.contentType="text/html"),l.text()):l.text()}).then(l=>{t==="blob"&&l instanceof Blob?s.responseBlob=l:t==="arraybuffer"&&l instanceof ArrayBuffer?s.responseBlob=Iy([l]):t==="json"?s.responseText=JSON.stringify(l):typeof l=="string"&&(s.responseText=l),o.schedule(s)}).catch(l=>{se.warn(l,`Error fetching ${e}`),o.schedule(s)}),i.result()}function Iy(e,t){let n="application/octet-stream";return new Blob(e,{type:n})}function Rk(e){let t=X("readBlob"),n=new FileReader,i=t.suspend(n);return n.addEventListener("load",()=>{i.schedule(n.result)},!1),n.readAsArrayBuffer(e),t.result()}function Ak(e){return URL.createObjectURL(e)}var Hd=class{constructor(e,t){this.parser=e,this.type=t,d(this,"resources",{}),d(this,"fetchers",{})}load(e,t,n){e=Dn(e);let i=this.resources[e];return typeof i<"u"?F(i):this.fetch(e,t,n).get()}fetchInner(e,t,n){let i=X("fetch"),r=e.endsWith("?viv-toc-box");r&&(e=e.replace("?viv-toc-box",""));let o=Ue("user-agent.xml",tr),s=!r&&e===o;return s&&(e=`data:application/xml,${encodeURIComponent(ky)}`),Qa(e,this.type).then(l=>{if(l.status>=400&&t)throw new Error((n||`Failed to fetch required resource: ${e}`)+` (${l.status}${l.statusText?" "+l.statusText:""})`);r?(e+="?viv-toc-box",l.url+="?viv-toc-box"):s&&(l.url=e=o),this.parser(l,this).then(a=>{delete this.fetchers[e],this.resources[e]=a,i.finish(a)})}),i.result()}fetch(e,t,n){if(e=Dn(e),this.resources[e])return null;let i=this.fetchers[e];return i||(i=new Us(()=>this.fetchInner(e,t,n),`Fetch ${e}`),this.fetchers[e]=i,i.start()),i}get(e){return this.resources[Dn(e)]}delete(e){delete this.resources[Dn(e)]}};function Lk(e,t){let n=e.responseText;return F(n?Od(n):null)}function Fk(){return new Hd(Lk,"text")}function hr(e,t,n){let i=new Us(()=>{let r=X("loadElement"),o=r.suspend(e),s=!1,l=a=>{s||(s=!0,o.schedule(a?a.type:"timeout"))};return e.addEventListener("load",l,!1),e.addEventListener("error",l,!1),e.addEventListener("abort",l,!1),e.namespaceURI=="http://www.w3.org/2000/svg"?(t&&e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t),setTimeout(l,300)):e.localName==="script"?setTimeout(l,3e3):t&&(e.src=t,n&&(e.alt=n)),r.result()},`loadElement ${t||e.localName}`);return i.start(),i}var ug=0,Ok=16777216,Ry=33554432,Ay=50331648,Ly=67108864,Bk=83886080,_k=100663296,Wd=class{constructor(e){this.scope=e,d(this,"flavor"),this.flavor="Author"}getCurrentToken(){return null}getScope(){return this.scope}error(e,t){}startStylesheet(e){this.flavor=e}tagSelector(e,t){}classSelector(e){}pseudoclassSelector(e,t){}pseudoelementSelector(e,t){}idSelector(e){}attributeSelector(e,t,n,i){}descendantSelector(){}childSelector(){}adjacentSiblingSelector(){}followingSiblingSelector(){}nextSelector(){}startSelectorRule(){}startFontFaceRule(){}startFootnoteRule(e){}startViewportRule(){}startDefineRule(){}startRegionRule(){}startPageRule(){}startPageMarginBoxRule(e){}startWhenRule(e){}startMediaRule(e){this.startWhenRule(e)}startFlowRule(e){}startPageTemplateRule(){}startPageMasterRule(e,t,n){}startPartitionRule(e,t,n){}startPartitionGroupRule(e,t,n){}startRuleBody(){}property(e,t,n){}endRule(){}startFuncWithSelector(e){}endFuncWithSelector(){}pushSelectorText(e){}getImportantSpecificity(){switch(this.flavor){case"UA":return ug;case"User":return _k;default:return Bk}}getBaseSpecificity(){switch(this.flavor){case"UA":return ug;case"User":return Ok;default:return Ry}}},Mk=class extends Wd{constructor(){super(null),d(this,"stack",[]),d(this,"tokenizer",null),d(this,"slave",null)}pushHandler(e){this.stack.push(this.slave),this.slave=e}popHandler(){this.slave=this.stack.pop()}getCurrentToken(){return this.tokenizer?this.tokenizer.token():null}getScope(){return this.slave.getScope()}error(e,t){this.slave.error(e,t)}errorMsg(e,t){var n;se.warn(e,(n=t==null?void 0:t.toString())!=null?n:"")}startStylesheet(e){super.startStylesheet(e),this.stack.length>0&&(this.slave=this.stack[0],this.stack=[]),this.slave.startStylesheet(e)}tagSelector(e,t){this.slave.tagSelector(e,t)}classSelector(e){this.slave.classSelector(e)}pseudoclassSelector(e,t){this.slave.pseudoclassSelector(e,t)}pseudoelementSelector(e,t){this.slave.pseudoelementSelector(e,t)}idSelector(e){this.slave.idSelector(e)}attributeSelector(e,t,n,i){this.slave.attributeSelector(e,t,n,i)}descendantSelector(){this.slave.descendantSelector()}childSelector(){this.slave.childSelector()}adjacentSiblingSelector(){this.slave.adjacentSiblingSelector()}followingSiblingSelector(){this.slave.followingSiblingSelector()}nextSelector(){this.slave.nextSelector()}startSelectorRule(){this.slave.startSelectorRule()}startFontFaceRule(){this.slave.startFontFaceRule()}startFootnoteRule(e){this.slave.startFootnoteRule(e)}startViewportRule(){this.slave.startViewportRule()}startDefineRule(){this.slave.startDefineRule()}startRegionRule(){this.slave.startRegionRule()}startPageRule(){this.slave.startPageRule()}startPageMarginBoxRule(e){this.slave.startPageMarginBoxRule(e)}startWhenRule(e){this.slave.startWhenRule(e)}startFlowRule(e){this.slave.startFlowRule(e)}startPageTemplateRule(){this.slave.startPageTemplateRule()}startPageMasterRule(e,t,n){this.slave.startPageMasterRule(e,t,n)}startPartitionRule(e,t,n){this.slave.startPartitionRule(e,t,n)}startPartitionGroupRule(e,t,n){this.slave.startPartitionGroupRule(e,t,n)}startRuleBody(){this.slave.startRuleBody()}property(e,t,n){this.slave.property(e,t,n)}endRule(){this.slave.endRule()}startFuncWithSelector(e){this.slave.startFuncWithSelector(e)}endFuncWithSelector(){this.slave.endFuncWithSelector()}pushSelectorText(e){this.slave.pushSelectorText(e)}},hg=class extends Wd{constructor(e,t,n){super(e),this.owner=t,this.topLevel=n,d(this,"depth",0),t&&(this.flavor=t.flavor)}getCurrentToken(){var e;return(e=this.owner)==null?void 0:e.getCurrentToken()}error(e,t){var n;(n=this.owner)==null||n.errorMsg(e,t)}startRuleBody(){this.depth++}endRule(){--this.depth==0&&!this.topLevel&&this.owner.popHandler()}},Hs=class extends hg{constructor(e,t,n){super(e,t,n)}report(e){this.error(e,this.getCurrentToken())}reportAndSkip(e){this.report(e),this.owner.pushHandler(new hg(this.scope,this.owner,!1))}startSelectorRule(){this.reportAndSkip("E_CSS_UNEXPECTED_SELECTOR")}startFontFaceRule(){this.reportAndSkip("E_CSS_UNEXPECTED_FONT_FACE")}startFootnoteRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_FOOTNOTE")}startViewportRule(){this.reportAndSkip("E_CSS_UNEXPECTED_VIEWPORT")}startDefineRule(){this.reportAndSkip("E_CSS_UNEXPECTED_DEFINE")}startRegionRule(){this.reportAndSkip("E_CSS_UNEXPECTED_REGION")}startPageRule(){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE")}startWhenRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_WHEN")}startFlowRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_FLOW")}startPageTemplateRule(){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE_TEMPLATE")}startPageMasterRule(e,t,n){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE_MASTER")}startPartitionRule(e,t,n){this.reportAndSkip("E_CSS_UNEXPECTED_PARTITION")}startPartitionGroupRule(e,t,n){this.reportAndSkip("E_CSS_UNEXPECTED_PARTITION_GROUP")}startFuncWithSelector(e){this.reportAndSkip("E_CSS_UNEXPECTED_SELECTOR_FUNC")}endFuncWithSelector(){this.reportAndSkip("E_CSS_UNEXPECTED_END_SELECTOR_FUNC")}property(e,t,n){this.error("E_CSS_UNEXPECTED_PROPERTY",this.getCurrentToken())}},De=[],va=[],Pe=[],$e=[],rn=[],$t=[],ze=[],et=[],ke=[],ot=[],Nt=[],rt=[],Me=[],cr=55,dr=56,ml=57;De[1]=28,De[36]=29,De[7]=29,De[9]=29,De[14]=29,De[18]=29,De[50]=29,De[20]=30,De[13]=27,De[0]=200,va[1]=46,va[0]=200,$t[1]=2,$t[36]=4,$t[7]=6,$t[9]=8,$t[14]=10,$t[18]=14,$t[50]=42,Pe[37]=11,Pe[23]=12,Pe[35]=56,Pe[1]=1,Pe[36]=3,Pe[7]=5,Pe[9]=7,Pe[14]=9,Pe[12]=13,Pe[18]=55,Pe[50]=58,Pe[16]=41,$e[37]=11,$e[23]=12,$e[35]=56,$e[1]=1,$e[36]=3,$e[7]=5,$e[9]=7,$e[14]=9,$e[18]=55,rn[1]=2,rn[36]=4,rn[7]=6,rn[9]=8,rn[18]=14,rn[50]=42,rn[14]=10,rn[12]=13,ze[1]=15,ze[7]=16,ze[4]=17,ze[5]=18,ze[3]=19,ze[2]=20,ze[8]=21,ze[27]=57,ze[16]=22,ze[19]=23,ze[6]=24,ze[11]=25,ze[17]=26,ze[13]=48,ze[31]=47,ze[23]=54,ze[0]=44,et[1]=31,et[4]=32,et[5]=32,et[3]=33,et[2]=34,et[10]=40,et[6]=38,et[31]=36,et[24]=36,et[32]=35,ke[1]=45,ke[16]=37,ke[37]=37,ke[38]=37,ke[47]=37,ke[48]=37,ke[39]=37,ke[49]=37,ke[41]=37,ke[26]=37,ke[25]=37,ke[23]=37,ke[24]=37,ke[19]=37,ke[21]=37,ke[36]=37,ke[18]=37,ke[22]=37,ke[11]=39,ke[12]=43,ke[17]=49,ot[0]=200,ot[12]=50,ot[13]=51,ot[14]=50,ot[15]=51,ot[10]=50,ot[11]=51,ot[17]=53,Nt[0]=200,Nt[12]=50,Nt[13]=52,Nt[14]=50,Nt[15]=51,Nt[10]=50,Nt[11]=51,Nt[17]=53,rt[0]=200,rt[12]=50,rt[13]=51,rt[14]=50,rt[15]=51,rt[10]=50,rt[11]=51,Me[11]=0,Me[16]=0,Me[22]=1,Me[18]=1,Me[26]=2,Me[25]=2,Me[38]=3,Me[37]=3,Me[48]=3,Me[47]=3,Me[39]=3,Me[49]=3,Me[41]=3,Me[23]=4,Me[24]=4,Me[36]=5,Me[19]=5,Me[21]=5,Me[0]=6,Me[cr]=2,Me[dr]=2;var Ws=class{constructor(e,t,n,i){this.actions=e,this.tokenizer=t,this.handler=n,this.baseURL=i,d(this,"valStack",[]),d(this,"namespacePrefixToURI",{}),d(this,"defaultNamespaceURI",null),d(this,"propName",null),d(this,"propImportant",!1),d(this,"exprContext"),d(this,"result",null),d(this,"importReady",!1),d(this,"importURL",null),d(this,"importCondition",null),d(this,"errorBrackets",[]),d(this,"ruleStack",[]),d(this,"regionRule",!1),d(this,"pageRule",!1),d(this,"inStyleDeclaration",!1),this.exprContext=2}extractVals(e,t){let n=[],i=this.valStack;for(;t<i.length&&(n.push(i[t++]),t!==i.length);){if(i[t++]!==e)throw new Error("Unexpected state");t===i.length&&n.push(ae)}return n}valStackReduce(e,t){let n=this.valStack,i=n.length,r=0,o;do if(o=n[--i],e===")"&&o instanceof yo){if(o.text===")")r++;else if(o.text==="("){if(r===0)return null;r--}}while(typeof o<"u"&&typeof o!="string");let s=n.length-(i+1);if(s>1&&n.splice(i+1,s,new Be(n.slice(i+1,n.length))),e==",")return null;i++;do o=n[--i];while(typeof o<"u"&&(typeof o!="string"||o==","));if(s=n.length-(i+1),o=="("){e!=")"&&t.type!==0&&(this.handler.error("E_CSS_MISMATCHED_C_PAR",t),this.actions=Nt);let a=new oo(n[i-1],this.extractVals(",",i+1));if(n.splice(i-1,s+2,a),a.name==="var"){let u=a.values[0]instanceof Xt&&a.values[0].name;(!Yn(u)||u===this.propName)&&(this.handler.error(`E_CSS_INVALID_VAR ${a.toString()}`,t),this.actions=Nt)}return a}if(e!=";"||i>=0)return this.handler.error("E_CSS_UNEXPECTED_VAL_END",t),this.actions=Nt,null;if(s>1)return new Rt(this.extractVals(",",i+1));let l=n[0];return l instanceof vt?l:l?new yo(l.toString()):ae}exprError(e,t){this.actions=this.propName?Nt:ot,se.warn(e,t.toString())}exprStackReduce(e,t){let n=this.valStack,i=this.handler,r=n.pop(),o;for(;;){let s=n.pop();if(e==11){let l=[r];for(;s==16;)l.unshift(n.pop()),s=n.pop();if(typeof s=="string"){if(s=="{"){for(;l.length>=2;){let a=l.shift(),u=l.shift(),h=new SC(i.getScope(),a,u);l.unshift(h)}return n.push(new ie(l[0])),!0}else if(s=="("){let a=n.pop(),u=n.pop();r=new Go(i.getScope(),Wh(u,a),l),e=0;continue}}if(s==10){r.isMediaName()&&(r=new Qf(i.getScope(),r,null)),e=0;continue}}else if(typeof s=="string"){n.push(s);break}if(s<0)if(s==-31)r=new xi(i.getScope(),r);else if(s==-24)r=new Pr(i.getScope(),r);else if(s==-ml)r=new xC(i.getScope(),r);else return this.exprError("F_UNEXPECTED_STATE",t),!1;else{if(Me[e]>Me[s]){n.push(s);break}switch(o=n.pop(),s){case 26:r=new Md(i.getScope(),o,r);break;case cr:r=new bC(i.getScope(),o,r);break;case dr:r=new CC(i.getScope(),o,r);break;case 25:r=new zd(i.getScope(),o,r);break;case 38:r=new kC(i.getScope(),o,r);break;case 37:r=new PC(i.getScope(),o,r);break;case 48:r=new EC(i.getScope(),o,r);break;case 47:r=new Xh(i.getScope(),o,r);break;case 39:case 49:r=new $d(i.getScope(),o,r);break;case 41:r=new NC(i.getScope(),o,r);break;case 23:r=new Qw(i.getScope(),o,r);break;case 24:r=new Zw(i.getScope(),o,r);break;case 36:r=new Dd(i.getScope(),o,r);break;case 19:r=new Jw(i.getScope(),o,r);break;case 21:r=new ey(i.getScope(),o,r);break;case 18:if(n.length>1)switch(n[n.length-1]){case 22:n.pop(),r=new RC(i.getScope(),n.pop(),o,r);break;case 10:if(o.isMediaName())r=new Qf(i.getScope(),o,r);else return this.exprError("E_CSS_MEDIA_TEST",t),!1;break}else return this.exprError("E_CSS_EXPR_COND",t),!1;break;case 22:if(e!=18)return this.exprError("E_CSS_EXPR_COND",t),!1;case 10:return n.push(o),n.push(s),n.push(r),!1;default:return this.exprError("F_UNEXPECTED_STATE",t),!1}}}return n.push(r),!1}readSupportsTest(e){let t=e.type===6,n=this.tokenizer,i,r;if(t)r=e.text,i=e.position+r.length+1;else if(e.type===10){let h=n.nthToken(1),p=n.nthToken(2);if(h.type===1&&p.type===18)n.consume(),n.consume(),r=h.text,i=p.position+1;else{if(h.type===10||h.type===6||h.type===1&&h.text.toLowerCase()==="not"&&(p.type===10||p.type===6))return null;i=e.position+1}}else return null;let o=0,s,l=0;for(;o>=0;)switch(n.consume(),s=n.token(),s.type){case 11:o--;break;case 10:case 6:o++;break;case 16:o===0&&l++;break;case 0:return this.exprError("E_CSS_UNEXPECTED_EOF",s),null}n.consume();let a=s.position,u=t&&r==="selector"&&l>0?"":n.input.substring(i,a).trim();return new AC(this.handler.getScope(),r,u,t)}readPseudoParams(){let e=[];for(;;){let t=this.tokenizer.token();switch(t.type){case 1:e.push(t.text);break;case 23:e.push("+");break;case 4:case 5:e.push(t.num);break;default:return e}this.tokenizer.consume()}}readNthPseudoParams(){let e=!1,t=this.tokenizer.token();if(t.type===23)e=!0,this.tokenizer.consume(),t=this.tokenizer.token();else if(t.type===1&&(t.text==="even"||t.text==="odd"))return this.tokenizer.consume(),[2,t.text==="odd"?1:0];switch(t.type){case 3:if(e&&t.num<0)return null;case 1:if(e&&t.text.charAt(0)==="-")return null;if(t.text==="n"||t.text==="-n"){if(e&&t.precededBySpace)return null;let n=t.text==="-n"?-1:1;t.type===3&&(n=t.num);let i=0;this.tokenizer.consume(),t=this.tokenizer.token();let r=t.type===24,o=t.type===23||r;if(o&&(this.tokenizer.consume(),t=this.tokenizer.token()),t.type===5){if(i=t.num,1/i===-1/0){if(i=0,o)return null}else if(i<0){if(o)return null}else if(i>=0&&!o)return null;this.tokenizer.consume()}else if(o)return null;return[n,r&&i>0?-i:i]}else if(t.text==="n-"||t.text==="-n-"){if(e&&t.precededBySpace)return null;let n=t.text==="-n-"?-1:1;if(t.type===3&&(n=t.num),this.tokenizer.consume(),t=this.tokenizer.token(),t.type===5)return t.num<0||1/t.num===-1/0?null:(this.tokenizer.consume(),[n,t.num])}else{let n=t.text.match(/^n(-[0-9]+)$/);if(n)return e&&t.precededBySpace?null:(this.tokenizer.consume(),[t.type===3?t.num:1,parseInt(n[1],10)]);if(n=t.text.match(/^-n(-[0-9]+)$/),n)return this.tokenizer.consume(),[-1,parseInt(n[1],10)]}return null;case 5:return e&&(t.precededBySpace||t.num<0)?null:(this.tokenizer.consume(),[0,t.num])}return null}makeCondition(e,t){let n=this.handler.getScope();if(!n)return null;if(t=t||n._true,e){let i=e.split(/\s+/);for(let r of i)switch(r){case"vertical":t=an(n,t,new xi(n,new qe(n,"pref-horizontal")));break;case"horizontal":t=an(n,t,new qe(n,"pref-horizontal"));break;case"day":t=an(n,t,new xi(n,new qe(n,"pref-night-mode")));break;case"night":t=an(n,t,new qe(n,"pref-night-mode"));break;default:t=n._false}}return t===n._true?null:new ie(t)}isInsidePropertyOnlyRule(){switch(this.ruleStack[this.ruleStack.length-1]){case"[selector]":case"font-face":case"-epubx-flow":case"-epubx-viewport":case"-epubx-define":case"-adapt-footnote-area":return!0}return!1}runParser(e,t,n,i,r,o){let s=this.handler,l=this.tokenizer,a=this.valStack,u,h,p,c,f,v,w,y=null;for(n&&(this.inStyleDeclaration=!0),i&&(this.exprContext=2,this.valStack.push("{"));e>0;--e){if(u=l.token(),r&&y===null&&(y=u.position-1,l.input[y]==="("&&y++),this.actions===ze&&this.errorBrackets.length>0&&(u.type===this.errorBrackets[this.errorBrackets.length-1]||u.type===17||u.type===31)){if(u.type===this.errorBrackets[this.errorBrackets.length-1]&&(this.errorBrackets.pop(),u.type===11&&this.valStackReduce(")",u))){l.consume();continue}a.push(new yo(u.toString())),l.consume();continue}switch(this.actions[u.type]){case 28:if(!this.inStyleDeclaration||l.nthToken(1).type!=18){this.isInsidePropertyOnlyRule()?(s.error("E_CSS_COLON_EXPECTED",l.nthToken(1)),this.actions=Nt):(this.actions=$t,s.startSelectorRule());continue}this.propName=u.text,this.propImportant=!1,l.consume(),l.consume(),this.actions=ze,a.splice(0,a.length);continue;case 46:if(l.nthToken(1).type!=18){this.actions=Nt,s.error("E_CSS_COLON_EXPECTED",l.nthToken(1));continue}this.propName=u.text,this.propImportant=!1,l.consume(),l.consume(),this.actions=ze,a.splice(0,a.length);continue;case 29:this.actions=$t,s.startSelectorRule();continue;case 1:if(!u.precededBySpace){this.actions=rt,s.error("E_CSS_SPACE_EXPECTED",u);continue}s.descendantSelector();case 2:if(l.nthToken(1).type==34)if(l.consume(),l.consume(),p=this.namespacePrefixToURI[u.text],p!=null)switch(u=l.token(),u.type){case 1:s.tagSelector(p,u.text),r?this.actions=$e:this.actions=Pe,l.consume();break;case 36:s.tagSelector(p,null),r?this.actions=$e:this.actions=Pe,l.consume();break;default:this.actions=ot,s.error("E_CSS_NAMESPACE",u)}else this.actions=ot,s.error("E_CSS_UNDECLARED_PREFIX",u);else s.tagSelector(this.defaultNamespaceURI,u.text),r?this.actions=$e:this.actions=Pe,l.consume();continue;case 3:if(!u.precededBySpace){this.actions=rt,s.error("E_CSS_SPACE_EXPECTED",u);continue}s.descendantSelector();case 4:if(l.nthToken(1).type==34)switch(l.consume(),l.consume(),u=l.token(),u.type){case 1:s.tagSelector(null,u.text),r?this.actions=$e:this.actions=Pe,l.consume();break;case 36:s.tagSelector(null,null),r?this.actions=$e:this.actions=Pe,l.consume();break;default:this.actions=ot,s.error("E_CSS_NAMESPACE",u)}else s.tagSelector(this.defaultNamespaceURI,null),r?this.actions=$e:this.actions=Pe,l.consume();continue;case 5:u.precededBySpace&&s.descendantSelector();case 6:if(!u.text){s.error("E_CSS_SYNTAX",u),l.consume();continue}s.idSelector(u.text),r?this.actions=$e:this.actions=Pe,l.consume();continue;case 7:u.precededBySpace&&s.descendantSelector();case 8:s.classSelector(u.text),r?this.actions=$e:this.actions=Pe,l.consume();continue;case 55:u.precededBySpace&&s.descendantSelector();case 14:l.consume(),u=l.token();e:switch(u.type){case 1:s.pseudoclassSelector(u.text,null),l.consume(),r?this.actions=$e:this.actions=Pe;continue;case 6:switch(c=u.text,l.consume(),c){case"is":case"not":case"where":case"has":this.actions=$t,s.startFuncWithSelector(c),this.runParser(Number.POSITIVE_INFINITY,!1,!1,!1,!0,c==="has")?this.actions=Pe:this.actions=rt;continue;case"lang":case"href-epub-type":if(u=l.token(),u.type===1){w=[u.text],l.consume(),c==="href-epub-type"&&l.token().type===16&&(l.consume(),u=l.token(),u.type===1&&(w.push(u.text),l.consume()));break}else break e;case"nth-child":case"nth-of-type":case"nth-last-child":case"nth-last-of-type":case"nth":if(w=this.readNthPseudoParams(),w)break;break e;default:w=this.readPseudoParams()}if(u=l.token(),u.type==11){s.pseudoclassSelector(c,w),l.consume(),r?this.actions=$e:this.actions=Pe;continue}break}s.error("E_CSS_PSEUDOCLASS_SYNTAX",u),this.actions=ot;continue;case 58:u.precededBySpace&&s.descendantSelector();case 42:switch(l.consume(),u=l.token(),u.type){case 1:s.pseudoelementSelector(u.text,null),r?this.actions=$e:this.actions=Pe,l.consume();continue;case 6:if(c=u.text,l.consume(),c=="nth-fragment"){if(w=this.readNthPseudoParams(),w===null)break}else w=this.readPseudoParams();if(u=l.token(),u.type==11){s.pseudoelementSelector(c,w),r?this.actions=$e:this.actions=Pe,l.consume();continue}break}s.error("E_CSS_PSEUDOELEM_SYNTAX",u),this.actions=ot;continue;case 9:u.precededBySpace&&s.descendantSelector();case 10:if(l.consume(),u=l.token(),u.type==1)c=u.text,l.consume();else if(u.type==36)c=null,l.consume();else if(u.type==34)c="";else{this.actions=rt,s.error("E_CSS_ATTR",u),l.consume();continue}if(u=l.token(),u.type==34){if(p=c&&this.namespacePrefixToURI[c],p===void 0){this.actions=rt,s.error("E_CSS_UNDECLARED_PREFIX",u),l.consume();continue}if(l.consume(),u=l.token(),u.type!=1){this.actions=rt,s.error("E_CSS_ATTR_NAME_EXPECTED",u);continue}c=u.text,l.consume(),u=l.token()}else p="";switch(u.type){case 39:case 45:case 44:case 43:case 42:case 46:case 50:f=u.type,l.consume(),u=l.token();break;case 15:s.attributeSelector(p,c,0,null),r?this.actions=$e:this.actions=Pe,l.consume();continue;default:this.actions=rt,s.error("E_CSS_ATTR_OP_EXPECTED",u);continue}switch(u.type){case 1:case 2:s.attributeSelector(p,c,f,u.text),l.consume(),u=l.token();break;default:this.actions=rt,s.error("E_CSS_ATTR_VAL_EXPECTED",u);continue}if(u.type!=15){this.actions=rt,s.error("E_CSS_ATTR",u);continue}r?this.actions=$e:this.actions=Pe,l.consume();continue;case 11:s.childSelector(),this.actions=rn,l.consume();continue;case 12:s.adjacentSiblingSelector(),this.actions=rn,l.consume();continue;case 56:s.followingSiblingSelector(),this.actions=rn,l.consume();continue;case 13:this.regionRule?(this.ruleStack.push("-epubx-region"),this.regionRule=!1):this.pageRule?(this.ruleStack.push("page"),this.pageRule=!1,this.inStyleDeclaration=!0):(this.ruleStack.push("[selector]"),this.inStyleDeclaration=!0),s.startRuleBody(),this.actions=De,l.consume();continue;case 41:s.nextSelector(),this.actions=$t,l.consume();continue;case 15:a.push(K(u.text)),l.consume();continue;case 16:f=parseInt(u.text,16),a.push(new uy(u.text)),l.consume();continue;case 17:a.push(new Ai(u.num)),l.consume();continue;case 18:a.push(new nr(u.num)),l.consume();continue;case 19:a.push(new $(u.num,u.text)),l.consume();continue;case 20:a.push(new Je(u.text)),l.consume();continue;case 21:a.push(new wn(Ue(u.text,this.baseURL))),l.consume();continue;case 57:a.push(new hy(u.text)),l.consume();continue;case 22:this.valStackReduce(",",u),a.push(","),l.consume();continue;case 23:a.push(Xa),l.consume();continue;case 24:c=u.text.toLowerCase(),c=="-epubx-expr"||c=="env"?(this.actions=et,this.exprContext=0,a.push("{")):(a.push(c),a.push("("),this.errorBrackets.length>0&&this.errorBrackets.push(11)),l.consume();continue;case 25:this.valStackReduce(")",u),l.consume();continue;case 47:if(l.consume(),u=l.token(),h=l.nthToken(1),u.type==1&&u.text.toLowerCase()=="important"&&(h.type==17||h.type==0||h.type==13)){l.consume(),this.propImportant=!0;continue}this.exprError("E_CSS_SYNTAX",u);continue;case 54:switch(h=l.nthToken(1),h.type){case 4:case 3:case 5:if(!h.precededBySpace){l.consume();continue}}a.push(new yo("+")),l.consume();continue;case 26:l.consume();case 48:v=this.valStackReduce(";",u),v&&this.propName&&s.property(this.propName,v,this.propImportant),this.actions=n?va:De;continue;case 44:for(l.consume();a.length>0;){let g=a.length;if(v=this.valStackReduce(";",u),!v||a.length===g)break}return t?(this.result=v,!0):(this.propName&&v&&s.property(this.propName,v,this.propImportant),!0);case 31:if(h=l.nthToken(1),h.type==9)l.nthToken(2).type==10&&!l.nthToken(2).precededBySpace?(a.push(u.text,h.text,"("),l.consume()):(a.push(new qe(s.getScope(),Wh(u.text,h.text))),this.actions=ke),l.consume();else{if(this.exprContext==2||this.exprContext==3)u.text.toLowerCase()=="not"?(l.consume(),a.push(new Kf(s.getScope(),!0,h.text))):(u.text.toLowerCase()=="only"&&(l.consume(),u=h),a.push(new Kf(s.getScope(),!1,u.text)));else if(this.exprContext===4&&u.text.toLowerCase()==="not"&&a[a.length-1]!==cr&&a[a.length-1]!==dr&&(h.type===10||h.type===6)){a.push(-ml),l.consume();continue}else a.push(new qe(s.getScope(),u.text));this.actions=ke}l.consume();continue;case 38:if(this.exprContext===4){a.push(this.readSupportsTest(u)),this.actions=ke;continue}a.push(null,u.text,"("),l.consume();continue;case 32:a.push(new nt(s.getScope(),u.num)),l.consume(),this.actions=ke;continue;case 33:c=u.text,c=="%"&&(this.propName&&this.propName.match(/height|^(top|bottom)$/)?c="vh":c="vw"),a.push(new $s(s.getScope(),u.num,c)),l.consume(),this.actions=ke;continue;case 34:a.push(new nt(s.getScope(),u.text)),l.consume(),this.actions=ke;continue;case 35:l.consume(),u=l.token(),u.type!=5||u.precededBySpace?this.exprError("E_CSS_SYNTAX",u):(a.push(new ry(s.getScope(),u.num)),l.consume(),this.actions=ke);continue;case 36:a.push(-u.type),l.consume();continue;case 37:this.actions=et,this.exprStackReduce(u.type,u),a.push(u.type),l.consume();continue;case 45:u.text.toLowerCase()==="and"&&a[a.length-2]!==dr&&a[a.length-2]!==-ml?(this.actions=et,this.exprStackReduce(cr,u),a.push(cr),l.consume()):u.text.toLowerCase()==="or"&&a[a.length-2]!==cr&&a[a.length-2]!==-ml?(this.actions=et,this.exprStackReduce(dr,u),a.push(dr),l.consume()):this.exprError("E_CSS_SYNTAX",u);continue;case 39:this.exprStackReduce(u.type,u)&&(this.actions=ze),l.consume();continue;case 43:this.exprStackReduce(11,u)&&(this.propName||this.exprContext==3?this.exprError("E_CSS_UNEXPECTED_BRC",u):(this.exprContext==1?s.startWhenRule(a.pop()):s.startMediaRule(a.pop()),this.ruleStack.push("media"),s.startRuleBody(),this.actions=De)),l.consume();continue;case 49:if(this.exprStackReduce(11,u))return this.propName||this.exprContext!=3?(this.exprError("E_CSS_UNEXPECTED_SEMICOL",u),this.actions=De,l.consume(),!1):(this.importCondition=a.pop(),this.importReady=!0,this.actions=De,l.consume(),!1);l.consume();continue;case 40:if(this.exprContext===4){let g=this.readSupportsTest(u);if(g){a.push(g),this.actions=ke;continue}}a.push(u.type),l.consume();continue;case 27:if(this.actions=De,l.consume(),s.endRule(),this.inStyleDeclaration=!1,this.ruleStack.length)switch(this.ruleStack.pop(),this.ruleStack[this.ruleStack.length-1]){case"page":case"-epubx-page-master":case"-epubx-partition-group":this.inStyleDeclaration=!0}continue;case 30:switch(c=u.text.toLowerCase(),c){case"import":if(l.consume(),u=l.token(),u.type==2||u.type==8){if(this.importURL=u.text,l.consume(),u=l.token(),u.type==17||u.type==0)return this.importReady=!0,l.consume(),!1;this.propName=null,this.exprContext=3,this.actions=et,a.push("{");continue}s.error("E_CSS_IMPORT_SYNTAX",u),this.actions=ot;continue;case"namespace":switch(l.consume(),u=l.token(),u.type){case 1:if(c=u.text,l.consume(),u=l.token(),(u.type==2||u.type==8)&&l.nthToken(1).type==17){this.namespacePrefixToURI[c]=u.text,l.consume(),l.consume();continue}break;case 2:case 8:if(l.nthToken(1).type==17){this.defaultNamespaceURI=u.text,l.consume(),l.consume();continue}break}s.error("E_CSS_NAMESPACE_SYNTAX",u),this.actions=ot;continue;case"charset":if(l.consume(),u=l.token(),u.type==2&&l.nthToken(1).type==17){c=u.text.toLowerCase(),c!="utf-8"&&c!="utf-16"&&s.error(`E_CSS_UNEXPECTED_CHARSET ${c}`,u),l.consume(),l.consume();continue}s.error("E_CSS_CHARSET_SYNTAX",u),this.actions=ot;continue;case"font-face":case"-epubx-page-template":case"-epubx-define":case"-epubx-viewport":if(l.nthToken(1).type==12){switch(l.consume(),l.consume(),c){case"font-face":s.startFontFaceRule(),this.inStyleDeclaration=!0;break;case"-epubx-page-template":s.startPageTemplateRule();break;case"-epubx-define":s.startDefineRule(),this.inStyleDeclaration=!0;break;case"-epubx-viewport":s.startViewportRule(),this.inStyleDeclaration=!0;break}this.ruleStack.push(c),s.startRuleBody();continue}break;case"-adapt-footnote-area":switch(l.consume(),u=l.token(),u.type){case 12:l.consume(),s.startFootnoteRule(null),this.ruleStack.push(c),s.startRuleBody(),this.inStyleDeclaration=!0;continue;case 50:if(l.consume(),u=l.token(),u.type==1&&l.nthToken(1).type==12){c=u.text,l.consume(),l.consume(),s.startFootnoteRule(c),this.ruleStack.push("-adapt-footnote-area"),s.startRuleBody(),this.inStyleDeclaration=!0;continue}break}break;case"-epubx-region":l.consume(),s.startRegionRule(),this.regionRule=!0,this.actions=$t;continue;case"page":l.consume(),s.startPageRule(),this.pageRule=!0,this.actions=rn;continue;case"top-left-corner":case"top-left":case"top-center":case"top-right":case"top-right-corner":case"right-top":case"right-middle":case"right-bottom":case"bottom-right-corner":case"bottom-right":case"bottom-center":case"bottom-left":case"bottom-left-corner":case"left-bottom":case"left-middle":case"left-top":if(l.consume(),u=l.token(),u.type==12){l.consume(),s.startPageMarginBoxRule(c),this.ruleStack.push(c),s.startRuleBody(),this.inStyleDeclaration=!0;continue}break;case"-epubx-when":l.consume(),this.propName=null,this.exprContext=1,this.actions=et,a.push("{");continue;case"media":l.consume(),this.propName=null,this.exprContext=2,this.actions=et,a.push("{");continue;case"supports":l.consume(),this.propName=null,this.exprContext=4,this.actions=et,a.push("{");continue;case"-epubx-flow":if(l.nthToken(1).type==1&&l.nthToken(2).type==12){s.startFlowRule(l.nthToken(1).text),l.consume(),l.consume(),l.consume(),this.ruleStack.push(c),s.startRuleBody(),this.inStyleDeclaration=!0;continue}break;case"-epubx-page-master":case"-epubx-partition":case"-epubx-partition-group":{l.consume(),u=l.token();let g=null,m=null,x=[];for(u.type==1&&(g=u.text,l.consume(),u=l.token()),u.type==18&&l.nthToken(1).type==1&&(m=l.nthToken(1).text,l.consume(),l.consume(),u=l.token());u.type==6&&u.text.toLowerCase()=="class"&&l.nthToken(1).type==1&&l.nthToken(2).type==11;)x.push(l.nthToken(1).text),l.consume(),l.consume(),l.consume(),u=l.token();if(u.type==12){switch(l.consume(),c){case"-epubx-page-master":s.startPageMasterRule(g,m,x);break;case"-epubx-partition":s.startPartitionRule(g,m,x);break;case"-epubx-partition-group":s.startPartitionGroupRule(g,m,x);break}this.ruleStack.push(c),s.startRuleBody(),this.inStyleDeclaration=!0;continue}break}case"":s.error(`E_CSS_UNEXPECTED_AT${c}`,u),this.actions=rt;continue;default:s.error(`E_CSS_AT_UNKNOWN ${c}`,u),this.actions=ot;continue}s.error(`E_CSS_AT_SYNTAX ${c}`,u),this.actions=ot;continue;case 50:this.errorBrackets.push(u.type+1),l.consume();continue;case 52:if(this.errorBrackets.length==0){this.actions=De;continue}case 51:if(r&&this.errorBrackets.length==0&&u.type==11)return l.consume(),s.endFuncWithSelector(),!0;this.errorBrackets.length>0&&this.errorBrackets[this.errorBrackets.length-1]==u.type&&this.errorBrackets.pop(),this.errorBrackets.length==0&&u.type==13&&(this.actions=De),l.consume();continue;case 53:this.errorBrackets.length==0&&(this.actions=De),l.consume();continue;case 200:return!0;default:if(i)return this.exprStackReduce(11,u)?(this.result=a.pop(),!0):!1;if(r){switch(u.type){case 16:case 11:if(this.actions===$t)s.error("E_CSS_SYNTAX",u);else{let g=l.input.substring(y,u.position);s.pushSelectorText(g),y=u.position+1}if(u.type===16){s.nextSelector(),this.actions=$t,l.consume();continue}else return s.endFuncWithSelector(),l.consume(),!0;case 37:case 23:case 35:if(o){this.actions=Pe;continue}break;case 12:case 14:case 10:this.errorBrackets.push(u.type+1);break}s.error("E_CSS_SYNTAX",u),l.consume(),this.actions=rt;continue}if(this.actions!==ot&&this.actions!==rt&&this.actions!==Nt){if(u.type==54)s.error("E_CSS_SYNTAX",u);else if(this.actions===ze){switch(u.type){case 10:case 12:case 14:this.errorBrackets.push(u.type+1);break}a.push(new yo(u.toString())),l.consume();continue}else if(u.type===12&&this.actions==et&&a.length>0){s.startMediaRule(a.pop()),this.ruleStack.push("media"),s.startRuleBody(),this.actions=De,l.consume();continue}else{if(u.type===17&&this.actions==et)return this.actions=De,l.consume(),!1;s.error("E_CSS_SYNTAX",u)}this.isInsidePropertyOnlyRule()?this.actions=Nt:this.actions=rt;continue}l.consume();continue}}return!1}},Fy=class extends Wd{constructor(e){super(null),this.scope=e}error(e,t){se.warn(e,t.toString())}getScope(){return this.scope}};function zk(e,t,n,i,r){let o=X("parseStylesheet"),s=new Ws(De,e,t,n),l=null;return r&&(l=Dk(new kn(r,t),t,n)),l=s.makeCondition(i,l&&l.toExpr()),l&&(t.startMediaRule(l),t.startRuleBody()),o.loop(()=>{for(;!s.runParser(100,!1,!1,!1,!1);){if(s.importReady){let u=Ue(s.importURL,n);s.importCondition&&(t.startMediaRule(s.importCondition),t.startRuleBody());let h=X("parseStylesheet.import");return Oy(u,t,null,null).then(()=>{s.importCondition&&t.endRule(),s.importReady=!1,s.importURL=null,s.importCondition=null,h.finish(!0)}),h.result()}let a=o.timeSlice();if(a.isPending)return a}return F(!1)}).then(()=>{l&&t.endRule(),o.finish(!0)}),o.result()}function Gd(e,t,n,i,r){return Kr("parseStylesheetFromText",o=>{let s=new kn(e,t);zk(s,t,n,i,r).thenFinish(o)},(o,s)=>{se.warn(s,`Failed to parse stylesheet text: ${e}`),o.finish(!1)})}function Oy(e,t,n,i){return Kr("parseStylesheetFromURL",r=>{Qa(e).then(o=>{o.responseText?Gd(o.responseText,t,e,n,i).then(s=>{s||se.warn(`Failed to parse stylesheet from ${e}`),r.finish(!0)}):r.finish(!0)})},(r,o)=>{se.warn(o,"Exception while fetching and parsing:",e),r.finish(!0)})}function so(e,t,n){let i=new Ws(ze,t,new Fy(e),n);return i.runParser(Number.POSITIVE_INFINITY,!0,!1,!1,!1),i.result}function $k(e,t,n){new Ws(va,e,t,n).runParser(Number.POSITIVE_INFINITY,!1,!0,!1,!1)}function Dk(e,t,n){let i=new Ws(et,e,t,n);return i.runParser(Number.POSITIVE_INFINITY,!1,!1,!0,!1),i.result}var Vk={"z-index":!0,"column-count":!0,"flow-linger":!0,opacity:!0,page:!0,"flow-priority":!0,utilization:!0};function Uk(e){return!!Vk[e]}function Hk(e,t,n){let i=t.evaluate(e);switch(typeof i){case"number":return Uk(n)?i==Math.round(i)?new nr(i):new Ai(i):new $(i,"px");case"string":return i?so(t.scope,new kn(i,null),""):ae;case"boolean":return i?S._true:S._false;case"undefined":return ae}throw new Error("E_UNEXPECTED")}function By(e,t){let n={};return Object.keys(e).forEach(i=>{let r=n[i]={},o=e[i];Object.keys(o).forEach(s=>{r[s]=o[s].map(l=>{let a=t?l.logical:l.physical,u=t?l.physical:l.logical;return{regexp:new RegExp(`(-?)${a}(-?)`),to:`$1${u}$2`}})})}),n}function _y(e,t,n,i){let r=i[t];if(!r)throw new Error(`unknown writing-mode: ${t}`);let o=r[n||"ltr"];if(!o)throw new Error(`unknown direction: ${n}`);for(let s of o){let l=e.replace(s.regexp,s.to);if(l!==e)return l}return e}var My={"horizontal-tb":{ltr:[{logical:"inline-start",physical:"left"},{logical:"inline-end",physical:"right"},{logical:"block-start",physical:"top"},{logical:"block-end",physical:"bottom"},{logical:"inline-size",physical:"width"},{logical:"block-size",physical:"height"}],rtl:[{logical:"inline-start",physical:"right"},{logical:"inline-end",physical:"left"},{logical:"block-start",physical:"top"},{logical:"block-end",physical:"bottom"},{logical:"inline-size",physical:"width"},{logical:"block-size",physical:"height"}]},"vertical-rl":{ltr:[{logical:"inline-start",physical:"top"},{logical:"inline-end",physical:"bottom"},{logical:"block-start",physical:"right"},{logical:"block-end",physical:"left"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}],rtl:[{logical:"inline-start",physical:"bottom"},{logical:"inline-end",physical:"top"},{logical:"block-start",physical:"right"},{logical:"block-end",physical:"left"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}]},"vertical-lr":{ltr:[{logical:"inline-start",physical:"top"},{logical:"inline-end",physical:"bottom"},{logical:"block-start",physical:"left"},{logical:"block-end",physical:"right"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}],rtl:[{logical:"inline-start",physical:"bottom"},{logical:"inline-end",physical:"top"},{logical:"block-start",physical:"left"},{logical:"block-end",physical:"right"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}]}},Wk=By(My,!0);function zy(e,t,n){return _y(e,t,n||null,Wk)}var Gk=By(My,!1);function $y(e,t,n){return _y(e,t,n||null,Gk)}var jk={"horizontal-tb":[{logical:"line-left",physical:"left"},{logical:"line-right",physical:"right"},{logical:"over",physical:"top"},{logical:"under",physical:"bottom"}],"vertical-rl":[{logical:"line-left",physical:"top"},{logical:"line-right",physical:"bottom"},{logical:"over",physical:"right"},{logical:"under",physical:"left"}],"vertical-lr":[{logical:"line-left",physical:"top"},{logical:"line-right",physical:"bottom"},{logical:"over",physical:"right"},{logical:"under",physical:"left"}]};function Xk(e,t){let n=jk[t];if(!n)throw new Error(`unknown writing-mode: ${t}`);for(let i=0;i<n.length;i++)if(n[i].physical===e)return n[i].logical;return e}function jd(e,t,n){var i;let r=t,o={width:r.style.width,height:r.style.height};function s(c){return e.getElementComputedStyle(t).getPropertyValue(c)}let l=s("writing-mode")!=="horizontal-tb",a=l?"height":"width",u=l?"width":"height";function h(c,f){r.style[c]=f;let v=s(c);return r.style[c]=o[c],v}let p={};for(let c of n){let f;switch(c){case"max-content inline size":f=h(a,"max-content");break;case"min-content inline size":f=h(a,"min-content");break;case"fit-content inline size":f=h(a,"fit-content");break;case"max-content block size":f=h(u,"max-content");break;case"min-content block size":f=h(u,"min-content");break;case"fit-content block size":f=h(u,"fit-content");break;case"max-content width":f=h("width","max-content");break;case"max-content height":f=h("height","max-content");break;case"min-content width":f=h("width","min-content");break;case"min-content height":f=h("height","min-content");break;case"fit-content width":f=h("width","fit-content");break;case"fit-content height":f=h("height","fit-content");break}f==="0px"&&t.childNodes.length===1&&((i=t.firstElementChild)==null?void 0:i.localName)==="img"&&!t.firstElementChild.complete&&(f="1px"),p[c]=parseFloat(f)}return p}function To(e){var t,n;return((t=e==null?void 0:e.style)==null?void 0:t["box-decoration-break"])==="clone"||((n=e==null?void 0:e.style)==null?void 0:n["-webkit-box-decoration-break"])==="clone"}function Dy(e){let t=e.getAttribute("data-viv-box-break");return t?t.split(" "):[]}function Vy(e,t){e.setAttribute("data-viv-box-break",t.join(" "))}function Yt(e,t){let n=Dy(e);n.includes(t)||(n.push(t),Vy(e,n))}function Yk(e){let t=e.getAttribute("data-viv-margin-discard");return t?t.split(" "):[]}function qk(e,t){e.setAttribute("data-viv-margin-discard",t.join(" "))}function Vu(e,t){let n=Yk(e);n.includes(t)||(n.push(t),qk(e,n))}function Kk(e){let t=e.name,n=e.value;switch(t){case"page-break-before":case"page-break-after":case"page-break-inside":return{name:t.replace(/^page-/,""),value:n===S.always?S.page:n,important:e.important};default:return e}}var tc={page:!0,left:!0,right:!0,recto:!0,verso:!0,column:!0,region:!0};function Ft(e){return!!tc[e]}var Qk={left:!0,right:!0,recto:!0,verso:!0};function ks(e){return!!Qk[e]}var Zk={avoid:!0,"avoid-page":!0,"avoid-column":!0,"avoid-region":!0};function wa(e){return!!Zk[e]}function Tt(e,t){if(e)if(t){if(ks(t))return t;if(ks(e))return e;{let n=Ft(e),i=Ft(t);if(n&&i)switch(t){case"column":return e;case"region":return e==="column"?t:e;default:return t}else return i?t:n?e:wa(t)?t:wa(e)?e:t}}else return e;else return t}function cg(e){return Ft(e)?e:"auto"}hn("SIMPLE_PROPERTY",Kk);var Xo=YS(KS());function Jk(e,t){return(0,Xo.default)(e,t,0)}function dg(e){return e.reduce((t,n)=>n[0]===Xo.default.DELETE?t:t+n[1],"")}function eE(e,t){return Uy(e,t,1)}function tE(e,t){return Uy(e,t,-1)}function Uy(e,t,n){let i=0,r=0;return e.some(o=>{for(let s=0;s<o[1].length;s++){switch(o[0]*n){case Xo.default.INSERT:i++;break;case Xo.default.DELETE:i--,r++;break;case Xo.default.EQUAL:r++;break}if(r>t)return!0}return!1}),Math.max(Math.min(t,r-1)+i,0)}var nc;(e=>{function t(n){return n&&n.formattingContextType==="Block"}e.isInstanceOfBlockFormattingContext=t})(nc||(nc={}));var zr;(e=>{(t=>(t.INLINE="inline",t.COLUMN="column",t.REGION="region",t.PAGE="page"))(e.FloatReference||(e.FloatReference={}))})(zr||(zr={}));var ya;(e=>{function t(n){return n&&n.flagmentLayoutConstraintType=="AfterIfContinue"}e.isInstanceOfAfterIfContinuesLayoutConstraint=t})(ya||(ya={}));var Xi;(e=>{function t(i){return i?i.formattingContextType==="RepetitiveElementsOwner"||ki.isInstanceOfTableFormattingContext(i):!1}e.isInstanceOfRepetitiveElementsOwnerFormattingContext=t;function n(i){return i?i.flagmentLayoutConstraintType==="RepetitiveElementsOwner"||ki.isInstanceOfTableRowLayoutConstraint(i):!1}e.isInstanceOfRepetitiveElementsOwnerLayoutConstraint=n})(Xi||(Xi={}));var ki;(e=>{function t(i){return i&&i.formattingContextType==="Table"}e.isInstanceOfTableFormattingContext=t;function n(i){return i&&i.flagmentLayoutConstraintType==="TableRow"}e.isInstanceOfTableRowLayoutConstraint=n})(ki||(ki={}));var qn;(e=>{(t=>(t[t.IGNORE=0]="IGNORE",t[t.NEWLINE=1]="NEWLINE",t[t.PRESERVE=2]="PRESERVE"))(e.Whitespace||(e.Whitespace={})),(t=>(t[t.NONE=0]="NONE",t[t.CONTENT=1]="CONTENT",t[t.ROOTLESS=2]="ROOTLESS",t[t.ROOTED=3]="ROOTED"))(e.ShadowType||(e.ShadowType={}))})(qn||(qn={}));var nE={transform:!0,"transform-origin":!0},iE={top:!0,bottom:!0,left:!0,right:!0},Xd=class{constructor(e,t,n){this.target=e,this.name=t,this.value=n}},rE={show:function(e){e.style.visibility="visible"},hide:function(e){e.style.visibility="hidden"},play:function(e){e.currentTime=0,e.play()},pause:function(e){e.pause()},resume:function(e){e.play()},mute:function(e){e.muted=!0},unmute:function(e){e.muted=!1}};function oE(e,t){let n=rE[t];return n?()=>{for(let i=0;i<e.length;i++)try{n(e[i])}catch{}}:null}var ic=class Io extends Bd{constructor(t,n){super(),this.container=t,this.bleedBox=n,d(this,"pageAreaElement",null),d(this,"delayedItems",[]),d(this,"hrefHandler"),d(this,"elementsById",{}),d(this,"dimensions",{width:0,height:0}),d(this,"isFirstPage",!1),d(this,"isLastPage",!1),d(this,"isBlankPage",!1),d(this,"isAutoPageWidth",!0),d(this,"isAutoPageHeight",!0),d(this,"spineIndex",0),d(this,"position",null),d(this,"offset",-1),d(this,"side",null),d(this,"fetchers",[]),d(this,"marginBoxes",{top:{},bottom:{},left:{},right:{}}),d(this,"pageType",null),this.hrefHandler=i=>{let r=i.currentTarget,o=r.getAttribute("href")||r.getAttributeNS("http://www.w3.org/1999/xlink","href");if(o){let s={type:"hyperlink",target:null,currentTarget:null,anchorElement:r,href:o,preventDefault(){i.preventDefault()}};this.dispatchEvent(s)}}}setAutoPageWidth(t){this.isAutoPageWidth=t,t?this.container.setAttribute(Io.AUTO_PAGE_WIDTH_ATTRIBUTE,"true"):this.container.removeAttribute(Io.AUTO_PAGE_WIDTH_ATTRIBUTE)}setAutoPageHeight(t){this.isAutoPageHeight=t,t?this.container.setAttribute(Io.AUTO_PAGE_HEIGHT_ATTRIBUTE,"true"):this.container.removeAttribute(Io.AUTO_PAGE_HEIGHT_ATTRIBUTE)}registerElementWithId(t,n){let i=this.elementsById[n];i?i.push(t):this.elementsById[n]=[t]}finish(t,n){Object.keys(this.elementsById).forEach(o=>{let s=this.elementsById[o];for(let l=0;l<s.length;)this.container.contains(s[l])?l++:s.splice(l,1);s.length===0&&delete this.elementsById[o]});let i=this.delayedItems;for(let o=0;o<i.length;o++){let s=i[o];s.target===this.container&&s.name==="transform"&&!this.isAutoPageWidth&&!this.isAutoPageHeight||O(s.target,s.name,s.value.toString())}let r=n.getElementClientRect(this.container);this.dimensions.width=r.width,this.dimensions.height=r.height;for(let o=0;o<t.length;o++){let s=t[o],l=this.elementsById[s.ref],a=this.elementsById[s.observer];if(l&&a){let u=oE(l,s.action);if(u)for(let h=0;h<a.length;h++)a[h].addEventListener(s.event,u,!1)}}}};d(ic,"AUTO_PAGE_WIDTH_ATTRIBUTE","data-vivliostyle-auto-page-width"),d(ic,"AUTO_PAGE_HEIGHT_ATTRIBUTE","data-vivliostyle-auto-page-height");var Hy=ic,Qr="data-adapt-spec",Ot=qn.Whitespace;function Wy(e){switch(e){case"normal":case"nowrap":return Ot.IGNORE;case"pre-line":return Ot.NEWLINE;case"pre":case"pre-wrap":case"break-spaces":return Ot.PRESERVE;default:return null}}function lt(e,t){if(!e)return!0;if(e.nodeType==1)return!1;let n=e.textContent;switch(t){case Ot.PRESERVE:return n.length==0;case Ot.NEWLINE:return!!n.match(/^[ \t]*$/);case Ot.IGNORE:default:return!!n.match(/^[ \t\r\n\f]*$/)}}var sE=class{constructor(e,t){this.flowName=e,this.parentFlowName=t,d(this,"forcedBreakOffsets",[]),d(this,"formattingContext",null)}},lE=class{constructor(e,t,n,i,r,o,s,l,a){this.flowName=e,this.element=t,this.startOffset=n,this.priority=i,this.linger=r,this.exclusive=o,this.repeated=s,this.last=l,this.breakBefore=a,d(this,"startPage",-1)}isBetter(e){return this.exclusive?!e.exclusive||this.priority>e.priority?!0:this.last:!1}};function aE(e,t){return e.top-t.top}function uE(e,t){return t.right-e.right}function Gy(e,t){var n,i;return e===t?!0:!e||!t?!1:(e.node===t.node||!!e.shadowContext&&!!t.shadowContext&&e.shadowType===qn.ShadowType.ROOTLESS&&t.shadowType===qn.ShadowType.ROOTLESS&&((n=e.node)==null?void 0:n.outerHTML)===((i=t.node)==null?void 0:i.outerHTML))&&e.shadowType===t.shadowType&&oc(e.shadowContext,t.shadowContext)&&oc(e.nodeShadow,t.nodeShadow)&&Gy(e.shadowSibling,t.shadowSibling)}function Ei(e,t){if(e===t)return!0;if(!e||!t||e.offsetInNode!==t.offsetInNode||e.after!==t.after||e.steps.length!==t.steps.length)return!1;for(let n=0;n<e.steps.length;n++)if(!Gy(e.steps[n],t.steps[n]))return!1;return!0}function hE(e){return{steps:[{node:e,shadowType:nn.NONE,shadowContext:null,nodeShadow:null,shadowSibling:null,formattingContext:null,fragmentIndex:0}],offsetInNode:0,after:!1,preprocessedTextContent:null}}function xa(e,t){return{steps:[{node:e.sourceNode,shadowType:nn.NONE,shadowContext:e.shadowContext,nodeShadow:null,shadowSibling:null,formattingContext:null,fragmentIndex:t??e.fragmentIndex}],offsetInNode:0,after:!1,preprocessedTextContent:e.preprocessedTextContent}}function ba(e,t){let n=new Ro(e.node,t,0);return n.shadowType=e.shadowType,n.shadowContext=e.shadowContext,n.nodeShadow=e.nodeShadow,n.shadowSibling=e.shadowSibling?ba(e.shadowSibling,t.copy()):null,n.formattingContext=e.formattingContext,n.fragmentIndex=e.fragmentIndex+1,n}var nn=qn.ShadowType,rc=class{constructor(e,t,n,i,r,o,s){this.owner=e,this.root=t,this.xmldoc=n,this.parentShadow=i,this.type=o,this.styler=s,d(this,"subShadow",null),r&&(r.subShadow=this)}equals(e){return e?this.owner===e.owner&&this.xmldoc===e.xmldoc&&this.type===e.type&&oc(this.parentShadow,e.parentShadow):!1}};function oc(e,t){return e===t||!!e&&!!t&&e.equals(t)}var cE=class{constructor(e,t){this.outer=e,this.count=t}},Ro=class jy{constructor(t,n,i){this.sourceNode=t,this.parent=n,this.boxOffset=i,d(this,"offsetInNode",0),d(this,"after",!1),d(this,"shadowType"),d(this,"shadowContext"),d(this,"nodeShadow",null),d(this,"shadowSibling",null),d(this,"shared",!1),d(this,"inline",!0),d(this,"overflow",!1),d(this,"breakPenalty"),d(this,"display",null),d(this,"floatReference"),d(this,"floatSide",null),d(this,"clearSide",null),d(this,"floatMinWrapBlock",null),d(this,"columnSpan",null),d(this,"verticalAlign","baseline"),d(this,"captionSide","top"),d(this,"inlineBorderSpacing",0),d(this,"blockBorderSpacing",0),d(this,"flexContainer",!1),d(this,"whitespace"),d(this,"hyphenateCharacter"),d(this,"breakWord"),d(this,"establishesBFC",!1),d(this,"containingBlockForAbsolute",!1),d(this,"breakBefore",null),d(this,"breakAfter",null),d(this,"viewNode",null),d(this,"clearSpacer",null),d(this,"inheritedProps"),d(this,"vertical"),d(this,"direction"),d(this,"firstPseudo"),d(this,"lang",null),d(this,"preprocessedTextContent",null),d(this,"formattingContext"),d(this,"repeatOnBreak",null),d(this,"pluginProps",{}),d(this,"fragmentIndex",1),d(this,"afterIfContinues",null),d(this,"footnotePolicy",null),d(this,"pageType"),this.shadowType=nn.NONE,this.shadowContext=n?n.shadowContext:null,this.breakPenalty=n?n.breakPenalty:0,this.floatReference=zr.FloatReference.INLINE,this.whitespace=n?n.whitespace:Ot.IGNORE,this.hyphenateCharacter=n?n.hyphenateCharacter:null,this.breakWord=n?n.breakWord:!1,this.inheritedProps=n?n.inheritedProps:{},this.vertical=n?n.vertical:!1,this.direction=n?n.direction:"ltr",this.firstPseudo=n?n.firstPseudo:null,this.formattingContext=n?n.formattingContext:null,this.pageType=n?n.pageType:null}resetView(){this.inline=!0,this.breakPenalty=this.parent?this.parent.breakPenalty:0,this.viewNode=null,this.clearSpacer=null,this.offsetInNode=0,this.after=!1,this.display=null,this.floatReference=zr.FloatReference.INLINE,this.floatSide=null,this.clearSide=null,this.floatMinWrapBlock=null,this.columnSpan=null,this.verticalAlign="baseline",this.flexContainer=!1,this.whitespace=this.parent?this.parent.whitespace:Ot.IGNORE,this.hyphenateCharacter=this.parent?this.parent.hyphenateCharacter:null,this.breakWord=this.parent?this.parent.breakWord:!1,this.breakBefore=null,this.breakAfter=null,this.nodeShadow=null,this.establishesBFC=!1,this.containingBlockForAbsolute=!1,this.vertical=this.parent?this.parent.vertical:!1,this.nodeShadow=null,this.preprocessedTextContent=null,this.formattingContext=this.parent?this.parent.formattingContext:null,this.repeatOnBreak=null,this.pluginProps={},this.fragmentIndex=1,this.afterIfContinues=null,this.footnotePolicy=null}cloneItem(){let t=new jy(this.sourceNode,this.parent,this.boxOffset);return t.offsetInNode=this.offsetInNode,t.after=this.after,t.nodeShadow=this.nodeShadow,t.shadowType=this.shadowType,t.shadowContext=this.shadowContext,t.shadowSibling=this.shadowSibling,t.inline=this.inline,t.breakPenalty=this.breakPenalty,t.display=this.display,t.floatReference=this.floatReference,t.floatSide=this.floatSide,t.clearSide=this.clearSide,t.floatMinWrapBlock=this.floatMinWrapBlock,t.columnSpan=this.columnSpan,t.verticalAlign=this.verticalAlign,t.captionSide=this.captionSide,t.inlineBorderSpacing=this.inlineBorderSpacing,t.blockBorderSpacing=this.blockBorderSpacing,t.establishesBFC=this.establishesBFC,t.containingBlockForAbsolute=this.containingBlockForAbsolute,t.flexContainer=this.flexContainer,t.whitespace=this.whitespace,t.hyphenateCharacter=this.hyphenateCharacter,t.breakWord=this.breakWord,t.breakBefore=this.breakBefore,t.breakAfter=this.breakAfter,t.viewNode=this.viewNode,t.clearSpacer=this.clearSpacer,t.firstPseudo=this.firstPseudo,t.vertical=this.vertical,t.overflow=this.overflow,t.preprocessedTextContent=this.preprocessedTextContent,t.formattingContext=this.formattingContext,t.repeatOnBreak=this.repeatOnBreak,t.pluginProps=Object.create(this.pluginProps),t.fragmentIndex=this.fragmentIndex,t.afterIfContinues=this.afterIfContinues,t.footnotePolicy=this.footnotePolicy,t}modify(){return this.shared?this.cloneItem():this}copy(){let t=this;do{if(t.shared)break;t.shared=!0,t=t.parent}while(t);return this}clone(){let t=this.cloneItem(),n=t,i;for(;(i=n.parent)!=null;)i=i.cloneItem(),n.parent=i,n=i;return t}toNodePositionStep(){return{node:this.sourceNode,shadowType:this.shadowType,shadowContext:this.shadowContext,nodeShadow:this.nodeShadow,shadowSibling:this.shadowSibling?this.shadowSibling.toNodePositionStep():null,formattingContext:this.formattingContext,fragmentIndex:this.fragmentIndex}}toNodePosition(){var t,n,i;let r=this,o=[];r.shadowType===qn.ShadowType.ROOTLESS&&(r.floatReference!==zr.FloatReference.INLINE||r.floatSide==="footnote")&&(i=(n=(t=r.shadowContext)==null?void 0:t.styler)==null?void 0:n.style)!=null&&i._pseudos&&(r=r.parent);do(!r.firstPseudo||!r.parent||r.parent.firstPseudo===r.firstPseudo)&&o.push(r.toNodePositionStep()),r=r.parent;while(r);let s=this.preprocessedTextContent?tE(this.preprocessedTextContent,this.offsetInNode):this.offsetInNode;return{steps:o,offsetInNode:s,after:this.after,preprocessedTextContent:this.preprocessedTextContent}}isInsideBFC(){let t=this.parent;for(;t;){if(t.establishesBFC)return!0;t=t.parent}return!1}getContainingBlockForAbsolute(){let t=this.parent;for(;t;){if(t.containingBlockForAbsolute)return t;t=t.parent}return null}belongsTo(t){return this.formattingContext===t&&!!this.parent&&this.parent.formattingContext===t}},Pi=class Xy{constructor(t){this.primary=t,d(this,"floats",null)}clone(){let t=new Xy(this.primary);if(this.floats){t.floats=[];for(let n=0;n<this.floats.length;++n)t.floats[n]=this.floats[n]}return t}isSamePosition(t){if(!t)return!1;if(this===t)return!0;if(!Ei(this.primary,t.primary))return!1;if(this.floats){if(!t.floats||this.floats.length!==t.floats.length)return!1;for(let n=0;n<this.floats.length;n++)if(!Ei(this.floats[n],t.floats[n]))return!1}else if(t.floats)return!1;return!0}},dE=class Yy{constructor(t,n){this.chunkPosition=t,this.flowChunk=n}clone(){return new Yy(this.chunkPosition.clone(),this.flowChunk)}isSamePosition(t){return!!t&&(this===t||this.chunkPosition.isSamePosition(t.chunkPosition))}},pE=class qy{constructor(){d(this,"positions",[]),d(this,"startBreakType",null),d(this,"breakAfter",null)}clone(){let t=new qy,n=this.positions,i=t.positions;for(let r=0;r<n.length;r++)i[r]=n[r].clone();return t.startBreakType=this.startBreakType,t.breakAfter=this.breakAfter,t}isSamePosition(t){if(this===t)return!0;if(!t||this.positions.length!==t.positions.length)return!1;for(let n=0;n<this.positions.length;n++)if(!this.positions[n].isSamePosition(t.positions[n]))return!1;return!0}hasContent(t){return this.positions.length>0&&this.positions[0].flowChunk.startOffset<=t}},fE=class Ky{constructor(){d(this,"page",0),d(this,"flows",{}),d(this,"flowPositions",{}),d(this,"isBlankPage",!1),d(this,"highestSeenOffset",0),d(this,"highestSeenNode"),d(this,"lookupPositionOffset")}clone(){let t=new Ky;t.page=this.page,t.isBlankPage=this.isBlankPage,t.highestSeenNode=this.highestSeenNode,t.highestSeenOffset=this.highestSeenOffset,t.lookupPositionOffset=this.lookupPositionOffset,t.flows=this.flows;for(let n in this.flowPositions)t.flowPositions[n]=this.flowPositions[n].clone();return t}isSamePosition(t){if(this===t)return!0;if(!t||this.page!==t.page)return!1;let n=Object.keys(this.flowPositions),i=Object.keys(t.flowPositions);if(n.length!==i.length)return!1;for(let r of n)if(!this.flowPositions[r].isSamePosition(t.flowPositions[r]))return!1;return!0}hasContent(t,n){let i=this.flowPositions[t];return i?i.hasContent(n):!1}startSideOfFlow(t){var n;let i=(n=this.flowPositions[t])==null?void 0:n.startBreakType;return i&&ks(i)?i:"any"}firstFlowChunkOfFlow(t){let n=this.flowPositions[t];if(!n)return null;let i=n.positions[0];return i?i.flowChunk:null}},Qy=class{constructor(e){this.element=e,d(this,"left",0),d(this,"top",0),d(this,"marginLeft",0),d(this,"marginRight",0),d(this,"marginTop",0),d(this,"marginBottom",0),d(this,"borderLeft",0),d(this,"borderRight",0),d(this,"borderTop",0),d(this,"borderBottom",0),d(this,"paddingLeft",0),d(this,"paddingRight",0),d(this,"paddingTop",0),d(this,"paddingBottom",0),d(this,"width",0),d(this,"height",0),d(this,"originX",0),d(this,"originY",0),d(this,"exclusions",null),d(this,"innerShape",null),d(this,"computedBlockSize",0),d(this,"snapWidth",0),d(this,"snapHeight",0),d(this,"snapOffsetX",0),d(this,"snapOffsetY",0),d(this,"vertical",!1),d(this,"rtl",!1),d(this,"borderBoxSizing",!1)}getInsetTop(){return this.marginTop+(this.borderBoxSizing?0:this.borderTop+this.paddingTop)}getInsetBottom(){return this.marginBottom+(this.borderBoxSizing?0:this.borderBottom+this.paddingBottom)}getInsetLeft(){return this.marginLeft+(this.borderBoxSizing?0:this.borderLeft+this.paddingLeft)}getInsetRight(){return this.marginRight+(this.borderBoxSizing?0:this.borderRight+this.paddingRight)}getInsetBefore(){return this.vertical?this.getInsetRight():this.getInsetTop()}getInsetAfter(){return this.vertical?this.getInsetLeft():this.getInsetBottom()}getInsetStart(){return this.vertical?this.getInsetTop():this.getInsetLeft()}getInsetEnd(){return this.vertical?this.getInsetBottom():this.getInsetRight()}getBeforeEdge(e){return this.vertical?e.right:e.top}getAfterEdge(e){return this.vertical?e.left:e.bottom}getStartEdge(e){return this.vertical?this.rtl?e.bottom:e.top:this.rtl?e.right:e.left}getEndEdge(e){return this.vertical?this.rtl?e.top:e.bottom:this.rtl?e.left:e.right}getInlineSize(e){return this.vertical?e.bottom-e.top:e.right-e.left}getBoxSize(e){return this.vertical?e.right-e.left:e.bottom-e.top}getBoxDir(){return this.vertical?-1:1}getInlineDir(){return this.rtl?-1:1}copyFrom(e){this.element=e.element,this.left=e.left,this.top=e.top,this.marginLeft=e.marginLeft,this.marginRight=e.marginRight,this.marginTop=e.marginTop,this.marginBottom=e.marginBottom,this.borderLeft=e.borderLeft,this.borderRight=e.borderRight,this.borderTop=e.borderTop,this.borderBottom=e.borderBottom,this.paddingLeft=e.paddingLeft,this.paddingRight=e.paddingRight,this.paddingTop=e.paddingTop,this.paddingBottom=e.paddingBottom,this.width=e.width,this.height=e.height,this.originX=e.originX,this.originY=e.originY,this.innerShape=e.innerShape,this.exclusions=e.exclusions,this.computedBlockSize=e.computedBlockSize,this.snapWidth=e.snapWidth,this.snapHeight=e.snapHeight,this.vertical=e.vertical,this.rtl=e.rtl,this.borderBoxSizing=e.borderBoxSizing}setVerticalPosition(e,t){this.top=e,this.height=t,O(this.element,"top",`${e}px`),O(this.element,"height",`${t}px`)}setHorizontalPosition(e,t){this.left=e,this.width=t,O(this.element,"left",`${e}px`),O(this.element,"width",`${t}px`)}setBlockPosition(e,t){if(this.vertical){let n=t+this.marginLeft+this.marginRight+(this.borderBoxSizing?0:this.paddingLeft+this.paddingRight+this.borderLeft+this.borderRight);this.setHorizontalPosition(e+n*this.getBoxDir(),t)}else this.setVerticalPosition(e,t)}setInlinePosition(e,t){if(this.vertical)if(this.rtl){let n=t+this.marginTop+this.marginBottom+(this.borderBoxSizing?0:this.paddingTop+this.paddingBottom+this.borderTop+this.borderBottom);this.setVerticalPosition(e+n*this.getInlineDir(),t)}else this.setVerticalPosition(e,t);else if(this.rtl){let n=t+this.marginLeft+this.marginRight+(this.borderBoxSizing?0:this.paddingLeft+this.paddingRight+this.borderLeft+this.borderRight);this.setHorizontalPosition(e+n*this.getInlineDir(),t)}else this.setHorizontalPosition(e,t)}clear(){let e=this.element,t;for(;t=e.lastChild;)e.removeChild(t)}getInnerShape(){let e=this.getInnerRect();return this.innerShape?this.innerShape.withOffset(e.x1,e.y1):Ud(e.x1,e.y1,e.x2,e.y2)}getInnerRect(){let e=this.originX+this.left+this.getInsetLeft(),t=this.originY+this.top+this.getInsetTop();return new Qt(e,t,e+this.width,t+this.height)}getPaddingRect(){let e=this.originX+this.left+this.marginLeft+this.borderLeft,t=this.originY+this.top+this.marginTop+this.borderTop,n=this.paddingLeft+this.width+this.paddingRight,i=this.paddingTop+this.height+this.paddingBottom;return new Qt(e,t,e+n,t+i)}getOuterShape(e,t){let n=this.getOuterRect();return my(e,n.x1,n.y1,n.x2-n.x1,n.y2-n.y1,t)}getOuterRect(){let e=this.originX+this.left,t=this.originY+this.top,n=this.getInsetLeft()+this.width+this.getInsetRight(),i=this.getInsetTop()+this.height+this.getInsetBottom();return new Qt(e,t,e+n,t+i)}},Sa=class extends Jn{constructor(e,t,n,i){super(),this.elem=e,this.context=t,this.rootContentValue=n,this.exprContentListener=i}visitStrInner(e,t){var n;if(!t){if(((n=this.elem.lastChild)==null?void 0:n.nodeType)===3){this.elem.lastChild.textContent+=e;return}t=this.elem.ownerDocument.createTextNode(e)}this.elem.appendChild(t)}visitStr(e){return this.visitStrInner(e.str),null}visitURL(e){if(this.rootContentValue.url)this.elem.setAttribute("src",e.url);else{let t=this.elem.ownerDocument.createElementNS("http://www.w3.org/1999/xhtml","img");t.setAttribute("src",e.url),this.elem.appendChild(t)}return null}visitSpaceList(e){return this.visitValues(e.values),null}visitExpr(e){let t=e.toExpr(),n=t.evaluate(this.context);if(typeof n=="string"){t instanceof qe&&(n=so(t.scope,new kn(n,null),"").stringValue()),this.elem.ownerDocument;let i=this.exprContentListener(t,n,this.elem.ownerDocument);!i&&n&&t instanceof st&&t.str.startsWith("running-element-")&&(n=""),this.visitStrInner(n,i)}return null}};function Ni(e){return e!=null&&e!==ae&&e!==S.normal&&e!==S.none&&!ge(e)}var Ke=zr.FloatReference;function gE(e){switch(e){case"inline":return Ke.INLINE;case"column":return Ke.COLUMN;case"region":return Ke.REGION;case"page":return Ke.PAGE;default:throw new Error(`Unknown float-reference: ${e}`)}}function $r(e){switch(e){case Ke.INLINE:return!1;case Ke.COLUMN:case Ke.REGION:case Ke.PAGE:return!0;default:throw new Error(`Unknown float-reference: ${e}`)}}function pg(e,t,n,i){let r=t?"vertical-rl":"horizontal-tb";if((e==="top"||e==="bottom")&&(e=$y(e,r,n)),e==="block-start"&&(e="inline-start"),e==="block-end"&&(e="inline-end"),e==="inline-start"||e==="inline-end"){let o=zy(e,r,n),s=Xk(o,r);s==="line-left"?e="left":s==="line-right"&&(e="right")}else e==="inside"?e=i==="left"?"right":"left":e==="outside"&&(e=i==="left"?"left":"right");return e!=="left"&&e!=="right"&&(se.warn(`Invalid float value: ${e}. Fallback to left.`),e="left"),e}var Zy=class{constructor(e,t,n,i,r,o){this.nodePosition=e,this.floatReference=t,this.floatSide=n,this.clearSide=i,this.flowName=r,this.floatMinWrapBlock=o,d(this,"order",null),d(this,"id",null)}getOrder(){if(this.order===null)throw new Error("The page float is not yet added");return this.order}getId(){if(!this.id)throw new Error("The page float is not yet added");return this.id}isAllowedOnContext(e){return e.isAnchorAlreadyAppeared(this.getId())}isAllowedToPrecede(e){return!1}},mE=class{constructor(){d(this,"floats",[]),d(this,"nextPageFloatIndex",0)}nextOrder(){return this.nextPageFloatIndex++}createPageFloatId(e){return`pf${e}`}addPageFloat(e){if(this.floats.findIndex(t=>Ei(t.nodePosition,e.nodePosition))>=0)throw new Error("A page float with the same source node is already registered");{let t=e.order=this.nextOrder();e.id=this.createPageFloatId(t),this.floats.push(e)}}findPageFloatByNodePosition(e){let t=this.floats.findIndex(n=>Ei(n.nodePosition,e));return t>=0?this.floats[t]:null}findPageFloatById(e){let t=this.floats.findIndex(n=>n.id===e);return t>=0?this.floats[t]:null}},Jy=class{constructor(e,t,n,i,r){this.floatReference=e,this.floatSide=t,this.continuations=n,this.area=i,this.continues=r}hasFloat(e){return this.continuations.some(t=>t.float===e)}findNotAllowedFloat(e){for(let t=this.continuations.length-1;t>=0;t--){let n=this.continuations[t].float;if(!n.isAllowedOnContext(e))return n}return null}getOuterShape(){return this.area.getOuterShape(null,null)}getOuterRect(){return this.area.getOuterRect()}getOrder(){let e=this.continuations.map(t=>t.float);return Math.min.apply(null,e.map(t=>t.getOrder()))}shouldBeStashedBefore(e){return this.getOrder()<e.getOrder()}addContinuations(e){e.forEach(t=>{this.continuations.push(t)})}getFlowName(){let e=this.continuations[0].float.flowName;return this.continuations.every(t=>t.float.flowName===e),e}},fg=class{constructor(e,t){this.float=e,this.nodePosition=t}equals(e){return e?this===e?!0:this.float===e.float&&Ei(this.nodePosition,e.nodePosition):!1}},Ao=class{constructor(e,t,n,i,r,o,s){this.parent=e,this.floatReference=t,this.container=n,this.flowName=i,this.generatingNodePosition=r,d(this,"children",[]),d(this,"writingMode"),d(this,"direction"),d(this,"invalidated",!1),d(this,"floatStore"),d(this,"forbiddenFloats",[]),d(this,"floatFragments",[]),d(this,"stashedFloatFragments",[]),d(this,"floatAnchors",{}),d(this,"floatsDeferredToNext",[]),d(this,"floatsDeferredFromPrevious"),d(this,"layoutConstraints",[]),d(this,"locked",!1),e&&e.children.push(this),this.writingMode=o||e&&e.writingMode||S.horizontal_tb,this.direction=s||e&&e.direction||S.ltr,this.floatStore=e?e.floatStore:new mE;let l=this.getPreviousSibling();this.floatsDeferredFromPrevious=l?[].concat(l.floatsDeferredToNext):[]}getParent(e){if(!this.parent)throw new Error(`No PageFloatLayoutContext for ${e}`);return this.parent}getPreviousSiblingOf(e,t,n,i){let r=this.children.indexOf(e);r<0&&(r=this.children.length);for(let o=r-1;o>=0;o--){let s=this.children[o];if(s.floatReference===t&&s.flowName===n&&Ei(s.generatingNodePosition,i)||(s=s.getPreviousSiblingOf(null,t,n,i),s))return s}return null}getPreviousSibling(){let e=this,t=this.parent,n;for(;t;){if(n=t.getPreviousSiblingOf(e,this.floatReference,this.flowName,this.generatingNodePosition),n)return n;e=t,t=t.parent}return null}getContainer(e){return!e||e===this.floatReference?this.container:this.getParent(e).getContainer(e)}setContainer(e){this.container=e,this.reattachFloatFragments()}addPageFloat(e){this.floatStore.addPageFloat(e)}getPageFloatLayoutContext(e){return e===this.floatReference?this:this.getParent(e).getPageFloatLayoutContext(e)}findPageFloatByNodePosition(e){return this.floatStore.findPageFloatByNodePosition(e)}forbid(e){let t=e.getId(),n=e.floatReference;n===this.floatReference?this.forbiddenFloats.includes(t)||(this.forbiddenFloats.push(t),new Zr().findByFloat(e).forbid(e,this)):this.getParent(n).forbid(e)}isForbidden(e){let t=e.getId(),n=e.floatReference;return n===this.floatReference?this.forbiddenFloats.includes(t):this.getParent(n).isForbidden(e)}addPageFloatFragment(e,t){let n=e.floatReference;n!==this.floatReference?this.getParent(n).addPageFloatFragment(e,t):this.floatFragments.includes(e)||(this.floatFragments.push(e),this.floatFragments.sort((i,r)=>i.getOrder()-r.getOrder())),t||this.invalidate()}removePageFloatFragment(e,t){let n=e.floatReference;if(n!==this.floatReference)this.getParent(n).removePageFloatFragment(e,t);else{let i=this.floatFragments.indexOf(e);if(i>=0){let r=this.floatFragments.splice(i,1)[0],o=r.area&&r.area.element;o&&o.parentNode&&o.parentNode.removeChild(o),t||this.invalidate()}}}findPageFloatFragment(e){if(e.floatReference!==this.floatReference)return this.getParent(e.floatReference).findPageFloatFragment(e);let t=this.floatFragments.findIndex(n=>n.hasFloat(e));return t>=0?this.floatFragments[t]:null}hasFloatFragments(e){return this.floatFragments.length>0&&(!e||this.floatFragments.some(e))?!0:this.parent?this.parent.hasFloatFragments(e):!1}hasContinuingFloatFragmentsInFlow(e){return this.hasFloatFragments(t=>t.continues&&t.getFlowName()===e)}registerPageFloatAnchor(e,t){this.floatAnchors[e.getId()]=t}collectPageFloatAnchors(){let e=Object.assign({},this.floatAnchors);return this.children.reduce((t,n)=>Object.assign(t,n.collectPageFloatAnchors()),e)}isAnchorAlreadyAppeared(e){if(this.getDeferredPageFloatContinuations().some(n=>n.float.getId()===e))return!0;let t=this.collectPageFloatAnchors()[e];return t&&this.container&&this.container.element?this.container.element.contains(t):!1}deferPageFloat(e){let t=e.float;if(t.floatReference===this.floatReference){let n=this.floatsDeferredToNext.findIndex(i=>i.float===t);n>=0?this.floatsDeferredToNext.splice(n,1,e):this.floatsDeferredToNext.push(e)}else this.getParent(t.floatReference).deferPageFloat(e)}hasPrecedingFloatsDeferredToNext(e,t){if(!t&&e.floatReference!==this.floatReference)return this.getParent(e.floatReference).hasPrecedingFloatsDeferredToNext(e,!1);let n=e.getOrder();return this.floatsDeferredToNext.some(i=>i.float.getOrder()<n&&!e.isAllowedToPrecede(i.float))?!0:this.parent?this.parent.hasPrecedingFloatsDeferredToNext(e,!0):!1}getLastFollowingFloatInFragments(e){let t=e.getOrder(),n=null;if(this.floatFragments.forEach(i=>{i.continuations.forEach(r=>{let o=r.float,s=o.getOrder();s>t&&(!n||s>n.getOrder())&&(n=o)})}),this.parent){let i=this.parent.getLastFollowingFloatInFragments(e);i&&(!n||i.getOrder()>n.getOrder())&&(n=i)}return n}getDeferredPageFloatContinuations(e){e=e||this.flowName;let t=this.floatsDeferredFromPrevious.filter(n=>!e||n.float.flowName===e);return this.parent&&(t=this.parent.getDeferredPageFloatContinuations(e).concat(t)),t.sort((n,i)=>n.float.getOrder()-i.float.getOrder())}getPageFloatContinuationsDeferredToNext(e){e=e||this.flowName;let t=this.floatsDeferredToNext.filter(n=>!e||n.float.flowName===e);return this.parent?this.parent.getPageFloatContinuationsDeferredToNext(e).concat(t):t}getFloatsDeferredToNextInChildContexts(){let e=[],t=[];for(let n=this.children.length-1;n>=0;n--){let i=this.children[n];t.includes(i.flowName)||(t.push(i.flowName),e=e.concat(i.floatsDeferredToNext.map(r=>r.float)),e=e.concat(i.getFloatsDeferredToNextInChildContexts()))}return e}checkAndForbidNotAllowedFloat(){if(this.checkAndForbidFloatFollowingDeferredFloat())return!0;for(let e=this.floatFragments.length-1;e>=0;e--){let t=this.floatFragments[e],n=t.findNotAllowedFloat(this);if(n)return this.locked?this.invalidate():(this.removePageFloatFragment(t),this.forbid(n),this.removeEndFloatFragments(t.floatSide)),!0}return this.floatReference===Ke.REGION&&this.parent.locked?this.parent.checkAndForbidNotAllowedFloat():!1}checkAndForbidFloatFollowingDeferredFloat(){let e=this.getFloatsDeferredToNextInChildContexts(),t=this.floatFragments.reduce((n,i)=>n.concat(i.continuations.map(r=>r.float)),[]);t.sort((n,i)=>i.getOrder()-n.getOrder());for(let n of t){let i=n.getOrder();if(e.some(r=>!n.isAllowedToPrecede(r)&&i>r.getOrder())){if(this.locked)this.invalidate();else{this.forbid(n);let r=this.findPageFloatFragment(n);this.removePageFloatFragment(r)}return!0}}return!1}finish(){if(!this.checkAndForbidNotAllowedFloat()){for(let e=this.floatsDeferredToNext.length-1;e>=0;e--)if(!this.floatsDeferredToNext[e].float.isAllowedOnContext(this)){if(this.locked){this.invalidate();return}this.floatsDeferredToNext.splice(e,1)}this.floatsDeferredFromPrevious.forEach(e=>{this.floatsDeferredToNext.findIndex(t=>e.equals(t))>=0||this.floatFragments.some(t=>t.hasFloat(e.float))||this.floatsDeferredToNext.push(e)})}}hasSameContainerAs(e){return!!this.container&&!!e.container&&this.container.element===e.container.element}invalidate(){this.invalidated=!0,!this.locked&&(this.container&&(this.children.forEach(e=>{this.hasSameContainerAs(e)&&e.floatFragments.forEach(t=>{let n=t.area.element;n&&n.parentNode&&n.parentNode.removeChild(n)})}),this.container.clear()),this.children.forEach(e=>{e.layoutConstraints.splice(0)}),this.children.splice(0),Object.keys(this.floatAnchors).forEach(e=>{delete this.floatAnchors[e]}))}detachChildren(){let e=this.children.splice(0);return e.forEach(t=>{t.floatFragments.forEach(n=>{let i=n.area.element;i&&i.parentNode&&i.parentNode.removeChild(i)})}),e}attachChildren(e){e.forEach(t=>{this.children.push(t),t.reattachFloatFragments()})}isInvalidated(){return this.invalidated||!!this.parent&&this.parent.isInvalidated()}validate(){this.invalidated=!1}toLogical(e){let t=this.writingMode.toString(),n=this.direction.toString();if(e==="inside"||e==="outside"){let i=!!this.container.element.closest("[data-vivliostyle-page-side='left']");e=e==="inside"?i?"right":"left":i?"left":"right"}return $y(e,t,n)}toPhysical(e){let t=this.writingMode.toString(),n=this.direction.toString();return zy(e,t,n)}toLogicalFloatSides(e){let t=e.split(" "),n=[];for(let s of t){let l=this.toLogical(s);n.includes(l)||n.push(l)}let i=[],r=!1,o=!1;for(let s=0;s<n.length;s++){let l=n[s];l.includes("block")?r||(n.slice(s+1).some(a=>a.includes("block"))?(i.push("snap-block"),r=!0):i.push(l)):l.includes("inline")&&(o||(n.slice(s+1).some(a=>a.includes("inline"))?(i.push("snap-inline"),o=!0):i.push(l)))}return i}removeEndFloatFragments(e){let t=this.toLogicalFloatSides(e)[0];if(t==="block-end"||t==="inline-end"){let n=0;for(;n<this.floatFragments.length;){let i=this.floatFragments[n];this.toLogicalFloatSides(i.floatSide)[0]===t?this.removePageFloatFragment(i):n++}}}stashEndFloatFragments(e){let t=e.floatReference;if(t!==this.floatReference){this.getParent(t).stashEndFloatFragments(e);return}let n=this.toLogicalFloatSides(e.floatSide)[0];if(n==="block-end"||n==="snap-block"||n==="inline-end"||n==="snap-inline"){let i=0;for(;i<this.floatFragments.length;){let r=this.floatFragments[i],o=this.toLogicalFloatSides(r.floatSide)[0];(o===n||n==="snap-block"&&o==="block-end"||n==="snap-inline"&&o==="inline-end")&&r.shouldBeStashedBefore(e)?(this.stashedFloatFragments.push(r),this.floatFragments.splice(i,1)):i++}}}restoreStashedFragments(e){if(e!==this.floatReference){this.getParent(e).restoreStashedFragments(e);return}this.stashedFloatFragments.forEach(t=>{this.addPageFloatFragment(t,!0)}),this.stashedFloatFragments.splice(0)}discardStashedFragments(e){if(e!==this.floatReference){this.getParent(e).discardStashedFragments(e);return}this.stashedFloatFragments.splice(0)}getStashedFloatFragments(e){return e===this.floatReference?this.stashedFloatFragments.concat().sort((t,n)=>n.getOrder()-t.getOrder()):this.getParent(e).getStashedFloatFragments(e)}getLimitValue(e,t,n,i){this.container;let r=this.toLogical(e),o=this.toPhysical(e),s=this.getLimitValueInner(r,t,n,i);if(this.parent&&this.parent.container){let l=this.parent.getLimitValue(o,t,n,i);switch(o){case"top":return Math.max(s,l);case"left":return Math.max(s,l);case"bottom":return Math.min(s,l);case"right":return Math.min(s,l)}}return s}getLimitValueInner(e,t,n,i){this.container;let r=this.getLimitValuesInner(t,n,i);switch(e){case"block-start":return this.container.vertical?r.right:r.top;case"block-end":return this.container.vertical?r.left:r.bottom;case"inline-start":return this.container.vertical?this.container.rtl?r.bottom:r.top:this.container.rtl?r.right:r.left;case"inline-end":return this.container.vertical?this.container.rtl?r.top:r.bottom:this.container.rtl?r.left:r.right;default:throw new Error(`Unknown logical side: ${e}`)}}getLimitValuesInner(e,t,n){this.container;let i=this.container.originX,r=this.container.originY,o=this.container.getPaddingRect(),s={top:o.y1-r,left:o.x1-i,bottom:o.y2-r,right:o.x2-i,floatMinWrapBlockStart:0,floatMinWrapBlockEnd:0};function l(u,h,p){return u.unit==="%"?p*u.num/100:e.convertLengthToPx(u,h,t)}let a=this.floatFragments;return a.length>0&&(s=a.reduce((u,h)=>{if(n&&!n(h,this))return u;let p=this.toLogicalFloatSides(h.floatSide)[0],c=h.area,f=h.continuations[0].float.floatMinWrapBlock,v=u.top,w=u.left,y=u.bottom,g=u.right,m=u.floatMinWrapBlockStart,x=u.floatMinWrapBlockEnd;switch(p){case"inline-start":c.vertical?v=Math.max(v,c.top+c.height):w=Math.max(w,c.left+c.width);break;case"block-start":c.vertical?(f&&c.left<g&&(m=l(f,c.rootViewNodes[0],o.x2-o.x1)),g=Math.min(g,c.left)):(f&&c.top+c.height>v&&(m=l(f,c.rootViewNodes[0],o.y2-o.y1)),v=Math.max(v,c.top+c.height));break;case"inline-end":c.vertical?y=Math.min(y,c.top):g=Math.min(g,c.left);break;case"block-end":c.vertical?(f&&c.left+c.width>w&&(x=l(f,c.rootViewNodes[0],o.x2-o.x1)),w=Math.max(w,c.left+c.width)):(f&&c.top<y&&(x=l(f,c.rootViewNodes[0],o.y2-o.y1)),y=Math.min(y,c.top));break;default:throw new Error(`Unknown logical float side: ${p}`)}return{top:v,left:w,bottom:y,right:g,floatMinWrapBlockStart:m,floatMinWrapBlockEnd:x}},s)),s.left+=i,s.right+=i,s.top+=r,s.bottom+=r,s}setFloatAreaDimensions(e,t,n,i,r,o,s){if(t!==this.floatReference)return this.getParent(t).setFloatAreaDimensions(e,t,n,i,r,o,s);let l=this.toLogicalFloatSides(n);if(l[0]==="snap-block"){if(!s["block-start"]&&!s["block-end"])return null}else if(l[0]==="snap-inline"){if(!s["inline-start"]&&!s["inline-end"])return null}else if(!s[l[0]])return null;e.clientLayout;let a=this.getLimitValue("block-start",e.layoutContext,e.clientLayout),u=this.getLimitValue("block-end",e.layoutContext,e.clientLayout),h=this.getLimitValue("inline-start",e.layoutContext,e.clientLayout),p=this.getLimitValue("inline-end",e.layoutContext,e.clientLayout),c=e.vertical?e.originX:e.originY,f=e.vertical?e.originY:e.originX;a=e.vertical?Math.min(a,e.left+e.getInsetLeft()+e.width+e.getInsetRight()+c):Math.max(a,e.top+c),u=e.vertical?Math.max(u,e.left+c):Math.min(u,e.top+e.getInsetTop()+e.height+e.getInsetBottom()+c);function v(x,C){let N=x(e.bands,C);return N?(e.vertical&&(N=py(N)),a=e.vertical?Math.min(a,N.x2):Math.max(a,N.y1),u=e.vertical?Math.max(u,N.x1):Math.min(u,N.y2),!0):o}let w,y,g,m;if(r){let x=e.vertical?ma(new Qt(u,h,a,p)):new Qt(h,a,p,u);if((l[0]==="block-start"||l[0]==="snap-block"||l[0]==="inline-start"||l[0]==="snap-inline")&&!v(DC,x)||(l[0]==="block-end"||l[0]==="snap-block"||l[0]==="inline-end"||l[0]==="snap-inline")&&!v(VC,x)||(g=(u-a)*e.getBoxDir(),w=g-e.getInsetBefore()-e.getInsetAfter(),m=(p-h)*e.getInlineDir(),y=m-e.getInsetStart()-e.getInsetEnd(),!o&&(w<=0||y<=0)))return null}else{w=e.computedBlockSize,g=w+e.getInsetBefore()+e.getInsetAfter();let x=(u-a)*e.getBoxDir();if(l[0]==="snap-block"){if(i===null)l[0]="block-start";else{let N=this.container.getPaddingRect(),A=this.container.getBoxDir()*(i-(this.container.vertical?N.x2:N.y1)),L=this.container.getBoxDir()*((this.container.vertical?N.x1:N.y2)-i-g);A<=L?l[0]="block-start":l[0]="block-end"}if(!s[l[0]])if(s["block-end"])l[0]="block-end";else return null}else if(l[0]==="snap-inline")if(i===null)l[0]="inline-start";else if(s["inline-start"])l[0]="inline-start";else if(s["inline-end"])l[0]="inline-end";else return null;if(!o&&x<g)return null;l[0]==="inline-start"||l[0]==="inline-end"||l[1]?y=jd(e.clientLayout,e.element,["fit-content inline size"])["fit-content inline size"]:e.adjustContentRelativeSize?y=e.getContentInlineSize():y=e.vertical?e.height:e.width,m=y+e.getInsetStart()+e.getInsetEnd();let C=(p-h)*e.getInlineDir();if(!o&&C<m)return null}return a-=c,u-=c,h-=f,p-=f,l.some(x=>x==="inline-start"||x==="snap-inline")||l.length===1&&(l[0]==="block-start"||l[0]==="snap-block")?e.setInlinePosition(h,y):(l.some(x=>x==="inline-end")||l.length===1&&l[0]==="block-end")&&e.setInlinePosition(p-m*e.getInlineDir(),y),l.some(x=>x==="block-start"||x==="snap-block")||l.length===1&&(l[0]==="inline-start"||l[0]==="snap-inline")?e.setBlockPosition(a,w):(l.some(x=>x==="block-end")||l.length===1&&l[0]==="inline-end")&&e.setBlockPosition(u-g*e.getBoxDir(),w),l.join(" ")}getFloatFragmentExclusions(){let e=this.floatFragments.map(t=>t.getOuterShape());return this.parent?this.parent.getFloatFragmentExclusions().concat(e):e}reattachFloatFragments(){let e=this.container.element&&this.container.element.parentNode;e&&this.floatFragments.forEach(t=>{e.appendChild(t.area.element)})}getMaxReachedAfterEdge(){let e=this.getContainer().vertical;return this.floatFragments.reduce((t,n)=>{let i=n.getOuterRect();return e?Math.min(t,i.x1):Math.max(t,i.y2)},e?1/0:0)}getBlockStartEdgeOfBlockEndFloats(){let e=this.getContainer().vertical;return this.floatFragments.filter(t=>t.floatSide==="block-end").reduce((t,n)=>{let i=n.getOuterRect();return e?Math.max(t,i.x2):Math.min(t,i.y1)},e?0:1/0)}getPageFloatClearEdge(e,t){function n(a){return u=>a.isAnchorAlreadyAppeared(u.float.getId())}function i(a,u){return a.continuations.some(n(u))}let r=t.getPaddingRect(),o=t.vertical?r.x1:r.y2,s=this;for(;s;){if(s.floatsDeferredToNext.some(n(s)))return o;s=s.parent}t.clientLayout;let l=this.getLimitValue("block-start",t.layoutContext,t.clientLayout,i);return this.getLimitValue("block-end",t.layoutContext,t.clientLayout,i)*t.getBoxDir()<o*t.getBoxDir()?o:l}getPageFloatPlacementCondition(e,t,n){if(e.floatReference!==this.floatReference)return this.getParent(e.floatReference).getPageFloatPlacementCondition(e,t,n);let i={"block-start":!0,"block-end":!0,"inline-start":!0,"inline-end":!0};if(!n)return i;let r=this.toLogicalFloatSides(t)[0],o=this.toLogical(n),s;o==="all"?s=["block-start","block-end","inline-start","inline-end"]:o==="both"?s=["inline-start","inline-end"]:o==="same"?r==="snap-block"?s=["block-start","block-end"]:s=[r]:s=[o];let l=e.getOrder();function a(p){return c=>c.floatSide===p&&c.getOrder()<l}function u(p,c){return p.children.some(f=>f.floatFragments.some(a(c))||u(f,c))}function h(p,c){let f=p.parent;return!!f&&(f.floatFragments.some(a(c))||h(f,c))}return s.forEach(p=>{switch(p){case"block-start":case"inline-start":i[p]=!u(this,p);break;case"block-end":case"inline-end":i[p]=!h(this,p);break;default:throw new Error(`Unexpected side: ${p}`)}}),i}getLayoutConstraints(){return(this.parent?this.parent.getLayoutConstraints():[]).concat(this.layoutConstraints)}addLayoutConstraint(e,t){t===this.floatReference?this.layoutConstraints.push(e):this.getParent(t).addLayoutConstraint(e,t)}isColumnFullWithPageFloats(e){let t=e.layoutContext,n=e.clientLayout,i=this,r=null;for(;i&&i.container;){let s=i.getLimitValuesInner(t,n);r?e.vertical?(s.right<r.right&&(r.right=s.right,r.floatMinWrapBlockStart=s.floatMinWrapBlockStart),s.left>r.left&&(r.left=s.left,r.floatMinWrapBlockEnd=s.floatMinWrapBlockEnd)):(s.top>r.top&&(r.top=s.top,r.floatMinWrapBlockStart=s.floatMinWrapBlockStart),s.bottom<r.bottom&&(r.bottom=s.bottom,r.floatMinWrapBlockEnd=s.floatMinWrapBlockEnd)):r=s,i=i.parent}let o=Math.max(r.floatMinWrapBlockStart,r.floatMinWrapBlockEnd);return(e.vertical?r.right-r.left:r.bottom-r.top)<=o}getMaxBlockSizeOfPageFloats(){let e=this.getContainer().vertical;return this.floatFragments.length?Math.max.apply(null,this.floatFragments.map(t=>{let n=t.area;return e?n.width:n.height})):0}lock(){this.locked=!0}unlock(){this.locked=!1}isLocked(){return this.locked}},xo=[],Zr=class{static register(e){xo.push(e)}findByNodeContext(e){for(let t=xo.length-1;t>=0;t--){let n=xo[t];if(n.appliesToNodeContext(e))return n}throw new Error(`No PageFloatLayoutStrategy found for ${e}`)}findByFloat(e){for(let t=xo.length-1;t>=0;t--){let n=xo[t];if(n.appliesToFloat(e))return n}throw new Error(`No PageFloatLayoutStrategy found for ${e}`)}},vE=class{appliesToNodeContext(e){return $r(e.floatReference)}appliesToFloat(e){return!0}createPageFloat(e,t,n){let i=e.floatReference;e.floatSide;let r=e.floatSide,o=e.toNodePosition();return n.resolveFloatReferenceFromColumnSpan(i,e.columnSpan,e).thenAsync(s=>{i=s,t.flowName;let l=new Zy(o,i,r,e.clearSide,t.flowName,e.floatMinWrapBlock);return t.addPageFloat(l),F(l)})}createPageFloatFragment(e,t,n,i){let r=e[0].float;return new Jy(r.floatReference,t,e,n,i)}findPageFloatFragment(e,t){return t.findPageFloatFragment(e)}adjustPageFloatArea(e,t,n){}forbid(e,t){}};Zr.register(new vE);var wE=Jy,sc=class e0 extends Zy{constructor(t,n,i,r,o){super(t,n,"block-end",null,i,o),this.footnotePolicy=r}isAllowedToPrecede(t){return!(t instanceof e0)}},gg=class extends wE{constructor(e,t,n,i){super(e,"block-end",t,n,i)}getOrder(){return 1/0}shouldBeStashedBefore(e){return e instanceof sc?!0:this.getOrder()<e.getOrder()}},yE=class{constructor(e){this.footnote=e}allowLayout(e){let t=e.toNodePosition();return!Ei(t,this.footnote.nodePosition)}},xE=class{appliesToNodeContext(e){return e.floatSide==="footnote"}appliesToFloat(e){return e instanceof sc}createPageFloat(e,t,n){let i=Ke.REGION,r=t.getPageFloatLayoutContext(i);t.getPageFloatLayoutContext(Ke.PAGE).hasSameContainerAs(r)&&(i=Ke.PAGE);let o=e.toNodePosition();t.flowName;let s=new sc(o,i,t.flowName,e.footnotePolicy,e.floatMinWrapBlock);return t.addPageFloat(s),F(s)}createPageFloatFragment(e,t,n,i){let r=e[0].float;return new gg(r.floatReference,e,n,i)}findPageFloatFragment(e,t){let n=t.getPageFloatLayoutContext(e.floatReference).floatFragments.filter(i=>i instanceof gg);return n.length<=1,n[0]||null}adjustPageFloatArea(e,t,n){e.isFootnote=!0,e.adjustContentRelativeSize=!1;let i=e.element;e.vertical=n.layoutContext.applyFootnoteStyle(t.vertical,n.layoutContext.nodeContext&&n.layoutContext.nodeContext.direction==="rtl",i),e.convertPercentageSizesToPx(i),n.setComputedInsets(i,e),n.setComputedWidthAndHeight(i,e)}forbid(e,t){let n=e;switch(n.footnotePolicy){case S.line:{let i=new yE(n);t.addLayoutConstraint(i,n.floatReference);break}}}};Zr.register(new xE);var bE="data-vivliostyle-flow-root";function SE(e){return e.getAttribute(bE)==="true"}function mg(e){let t=(e==null?void 0:e.toString())||"block",n;switch(t){case"inline-flex":n="flex";break;case"inline-grid":n="grid";break;case"inline-table":n="table";break;case"inline":case"table-row-group":case"table-column":case"table-column-group":case"table-header-group":case"table-footer-group":case"table-row":case"table-cell":case"table-caption":case"inline-block":n="block";break;default:n=t}return K(n)}function Yd(e){return e===S.absolute||e===S.fixed}function lc(e){return e instanceof oo&&e.name==="running"}function t0(e,t,n,i){return e===S.none||(Yd(t)?(n=S.none,e=mg(e)):(n&&n!==S.none&&!ge(n)||i)&&(e=mg(e))),{display:e,position:t,float:n}}function n0(e,t,n,i){return t0(e,t,n,i).display===S.block}function Wi(e){switch(e.toString()){case"inline":case"inline-block":case"inline-list-item":case"inline-flex":case"inline-grid":case"ruby":case"inline-table":return!0;default:return!1}}function i0(e){switch(e.toString()){case"ruby-base":case"ruby-text":case"ruby-base-container":case"ruby-text-container":return!0;default:return!1}}function CE(e,t,n,i,r,o,s){return r=r||o||S.horizontal_tb,!!s||!!n&&n!==S.none&&!ge(n)||Yd(t)||e===S.inline_block||e===S.table_cell||e===S.table_caption||e==S.flex||e==S.grid||e==S.flow_root||(e===S.block||e===S.list_item)&&!!i&&i!==S.visible&&i!==S.clip&&!ge(i)||!!o&&r!==o}function kE(e){return e===S.relative||e===S.absolute||e===S.fixed}function pr(e,t,n,i){let r=e.viewNode;if(!r)return NaN;let o=r.nodeType===1?r:r.parentElement;if(o&&o.namespaceURI==="http://www.w3.org/1999/xhtml"){let s=o.style;if(s&&Wi(s.display)&&/^([\d\.]|super|(text-)?top)/.test(s.verticalAlign))return NaN}if(r===o){if(e.after||!e.inline){if(e.after&&!e.inline&&o.querySelector("ruby")){let l=o.parentNode,a=o.nextSibling;l.removeChild(o),l.insertBefore(o,a)}let s=t.getElementClientRect(o);if(s.left===0&&s.top===0&&s.right===0&&s.bottom===0)return NaN;if(s.right>=s.left&&s.bottom>=s.top)return e.after?i?s.left:s.bottom:i?s.right:s.top}return NaN}else{let s=NaN,l=r.ownerDocument.createRange(),a=r.textContent.length;if(!a)return NaN;e.after&&(n+=a),n>=a&&(n=a-1),l.setStart(r,n),l.setEnd(r,n+1);let u=t.getRangeClientRects(l);return u=u.filter(h=>h.right>h.left&&h.bottom>h.top),u.length?(i?s=Math.min.apply(null,u.map(h=>h.left)):s=Math.max.apply(null,u.map(h=>h.bottom)),s):NaN}}function ac(e,t,n){let i=t.clientLayout.getElementClientRect(e),r=t.getComputedMargin(e);return n?i.width+r.left+r.right:i.height+r.top+r.bottom}function Nr(e){for(;e;){if(e.parentNode===e.ownerDocument)return!1;e=e.parentNode}return!0}function r0(e,t){var n;if(e)for(let i=e.lastChild,r=i;i!==t;i=r)r=i.previousSibling,!(i.nodeType===1&&i.hasAttribute("data-vivliostyle-float-box-moved")&&((n=t.style)==null?void 0:n.display)==="inline")&&e.removeChild(i)}function qd(e){return!!e.getAttribute(Qr)}function Lo(e){var t;if((e==null?void 0:e.nodeType)!==1)return!1;let n=e;if(qd(n))return!0;let i=(t=n.style)==null?void 0:t.position;return i==="absolute"||i==="fixed"}function Tr(e){let t=e==null?void 0:e.viewNode;return(t==null?void 0:t.nodeType)===1&&qd(t)}function EE(e){return e!=="inline"&&(Wi(e)||i0(e))}function vg(e){var t;for(let n=e.parent;n;n=n.parent)if((n.display!=="inline"||n.vertical!==((t=n.parent)==null?void 0:t.vertical))&&Wi(n.display))return n;return null}var Kd=class{calculateOffset(e){return Dr(this.getNodeContext(),e.collectElementsOffset())}breakPositionChosen(e){}getNodeContext(){return null}};function Dr(e,t){return{current:t.reduce((n,i)=>n+i.calculateOffset(e),0),minimum:t.reduce((n,i)=>n+i.calculateMinimumOffset(e),0)}}var Gs=class extends Kd{constructor(e,t,n,i){super(),this.position=e,this.breakOnEdge=t,this.overflows=n,this.computedBlockSize=i,d(this,"overflowIfRepetitiveElementsDropped"),d(this,"isEdgeUpdated",!1),d(this,"edge",0),this.overflowIfRepetitiveElementsDropped=n}findAcceptableBreak(e,t){return this.updateOverflows(e),t<this.getMinBreakPenalty()?null:e.findEdgeBreakPosition(this)}getMinBreakPenalty(){if(!this.isEdgeUpdated)throw new Error("EdgeBreakPosition.prototype.updateEdge not called");let e=this.isFirstContentOfRepetitiveElementsOwner()&&!this.overflowIfRepetitiveElementsDropped;return(wa(this.breakOnEdge)?1:0)+(this.overflows&&!e?3:0)+(this.position.parent?this.position.parent.breakPenalty:0)}updateEdge(e){var t;let n=e.calculateClonedPaddingBorder(this.position);if(this.edge=pr(this.position,e.clientLayout,0,e.vertical)+n,!this.position.after&&!this.position.inline){let i=e.parseComputedLength(e.clientLayout.getElementComputedStyle(this.position.viewNode).marginBlockStart);this.edge-=(e.vertical?-1:1)*i}else if(this.position.after&&((t=this.position.shadowContext)==null?void 0:t.root.id)==="table-cell"){let i=e.element.parentElement,r=i==null?void 0:i.closest("table, [style*='display: table;']");if(r){let o=r.style.borderCollapse==="collapse",s=0,l=0;for(let a=i;a;a=a.parentElement){let u=e.clientLayout.getElementComputedStyle(a);if((a===i||a===r&&!o)&&(s+=e.parseComputedLength(u.paddingBlockEnd)),a===r&&!o&&(s+=e.parseComputedLength(u.borderSpacing.replace(/^\S+ (\S+)$/,"$1"))),o?l=Math.max(l,e.parseComputedLength(u.borderBlockEndWidth)):(a===i||a===r)&&(l+=e.parseComputedLength(u.borderBlockEndWidth)),a===r)break}this.edge+=(e.vertical?-1:1)*(s+l)}}this.isEdgeUpdated=!0}updateOverflows(e){this.isEdgeUpdated||this.updateEdge(e);let t=this.edge,n=this.calculateOffset(e);this.overflowIfRepetitiveElementsDropped=e.isOverflown(t+(e.vertical?-1:1)*n.minimum),this.overflows=this.position.overflow=e.isOverflown(t+(e.vertical?-1:1)*n.current)}getNodeContext(){return this.position}isFirstContentOfRepetitiveElementsOwner(){let e=this.getNodeContext();if(!e||!e.parent)return!1;let{formattingContext:t}=e.parent;if(!Xi.isInstanceOfRepetitiveElementsOwnerFormattingContext(t))return!1;let n=t.getRepetitiveElements();return n?n.isFirstContentNode(e):!1}},bo=class{find(e){let t=Sn("RESOLVE_LAYOUT_PROCESSOR");for(let n=0;n<t.length;n++){let i=t[n](e);if(i)return i}throw new Error(`No processor found for a formatting context: ${e.getName()}`)}},Ir=class{layout(e,t,n){return t.isFloatNodeContext(e)?t.layoutFloatOrFootnote(e):t.isBreakable(e)?t.layoutBreakableBlock(e):t.layoutUnbreakable(e)}createEdgeBreakPosition(e,t,n,i){return new Gs(e.copy(),t,n,i)}startNonInlineElementNode(e){return!1}afterNonInlineElementNode(e,t){return!1}clearOverflownViewNodes(e,t,n,i){var r;if(!n.viewNode||!n.viewNode.parentNode||n.shadowType===qn.ShadowType.ROOTLESS&&Tr(n))return;let o=n.viewNode;((r=o.parentElement)==null?void 0:r.localName)==="viv-ts-inner"&&(o=o.parentElement.parentElement);let s=o.parentNode;r0(s,o),i&&s.removeChild(o)}finishBreak(e,t,n,i){let r=n||t.viewNode!=null&&t.viewNode.nodeType==1&&!t.after;return e.clearOverflownViewNodes(t,r),i&&e.layoutContext.processFragmentedBlockEdge(t),F(!0)}},Qd=class{constructor(e){this.parent=e,d(this,"formattingContextType","Block")}getName(){return"Block formatting context (BlockFormattingContext)"}isFirstTime(e,t){return t}getParent(){return this.parent}saveState(){}restoreState(e){}},Zd=new Ir,PE=nc.isInstanceOfBlockFormattingContext;hn("RESOLVE_FORMATTING_CONTEXT",(e,t,n,i,r,o)=>{let s=e.parent;return!s&&e.formattingContext||s&&e.formattingContext!==s.formattingContext?null:e.establishesBFC||!e.formattingContext&&n0(n,i,r,o)?new Qd(s?s.formattingContext:null):null});hn("RESOLVE_LAYOUT_PROCESSOR",e=>e instanceof Qd?Zd:null);var Jd=class{constructor(){d(this,"initialBreakPositions",null),d(this,"initialStateOfFormattingContext",null),d(this,"initialPosition"),d(this,"initialFragmentLayoutConstraints")}layout(e,t){return this.prepareLayout(e,t),this.tryLayout(e,t)}tryLayout(e,t){let n=X("AbstractLayoutRetryer.tryLayout");this.saveState(e,t);let i=this.resolveLayoutMode(e);return i.doLayout(e,t).then(r=>{let o=i.accept(r,t);o=i.postLayout(r,this.initialPosition,t,o),o?n.finish(r):(this.initialPosition,this.clearNodes(this.initialPosition),this.restoreState(e,t),this.tryLayout(this.initialPosition,t).thenFinish(n))}),n.result()}prepareLayout(e,t){}clearNodes(e){let t=e.viewNode||e.parent.viewNode,n;for(;n=t.lastChild;)t.removeChild(n);let i;for(;i=t.nextSibling;)i.parentNode.removeChild(i)}saveState(e,t){this.initialPosition=e.copy(),this.initialBreakPositions=[].concat(t.breakPositions),this.initialFragmentLayoutConstraints=[].concat(t.fragmentLayoutConstraints),e.formattingContext&&(this.initialStateOfFormattingContext=e.formattingContext.saveState())}restoreState(e,t){t.breakPositions=this.initialBreakPositions,t.fragmentLayoutConstraints=this.initialFragmentLayoutConstraints,e.formattingContext&&e.formattingContext.restoreState(this.initialStateOfFormattingContext)}},NE=class{initialState(e){return{nodeContext:e,atUnforcedBreak:!1,break:!1}}startNonDisplayableNode(e){}afterNonDisplayableNode(e){}startIgnoredTextNode(e){}afterIgnoredTextNode(e){}startNonElementNode(e){}afterNonElementNode(e){}startInlineElementNode(e){}afterInlineElementNode(e){}startNonInlineElementNode(e){}afterNonInlineElementNode(e){}finish(e){}},uc=class{constructor(e,t){this.strategy=e,this.layoutContext=t}iterate(e){let t=this.strategy,n=t.initialState(e),i=X("LayoutIterator");return i.loopWithFrame(r=>{let o;for(;n.nodeContext;){n.nodeContext.viewNode?n.nodeContext.viewNode.nodeType!==1?lt(n.nodeContext.viewNode,n.nodeContext.whitespace)?n.nodeContext.after?o=t.afterIgnoredTextNode(n):o=t.startIgnoredTextNode(n):n.nodeContext.after?o=t.afterNonElementNode(n):o=t.startNonElementNode(n):n.nodeContext.inline?n.nodeContext.after?o=t.afterInlineElementNode(n):o=t.startInlineElementNode(n):n.nodeContext.after?o=t.afterNonInlineElementNode(n):o=t.startNonInlineElementNode(n):n.nodeContext.after?o=t.afterNonDisplayableNode(n):o=t.startNonDisplayableNode(n);let s=(o&&o.isPending()?o:F(!0)).thenAsync(()=>n.break?F(null):this.layoutContext.nextInTree(n.nodeContext,n.atUnforcedBreak));if(s.isPending()){s.then(l=>{n.break?r.breakLoop():(n.nodeContext=l,r.continueLoop())});return}else if(n.break){r.breakLoop();return}else n.nodeContext=s.get()}t.finish(n),r.breakLoop()}).then(()=>{i.finish(n.nodeContext)}),i.result()}},Yo=class extends NE{constructor(e){super(),this.leadingEdge=e}startNonInlineBox(e){}endEmptyNonInlineBox(e){}endNonInlineBox(e){}initialState(e){return{nodeContext:e,atUnforcedBreak:!!this.leadingEdge&&e.after,break:!1,leadingEdge:this.leadingEdge,breakAtTheEdge:null,onStartEdges:!1,leadingEdgeContexts:[],lastAfterNodeContext:null}}processForcedBreak(e,t){let n=!e.leadingEdge&&Ft(e.breakAtTheEdge);if(n){let i=e.nodeContext=e.leadingEdgeContexts[0]||e.nodeContext;i.viewNode.parentNode.removeChild(i.viewNode),t.pageBreakType=e.breakAtTheEdge}return n}saveEdgeAndProcessOverflow(e,t){let n=t.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!0,e.breakAtTheEdge);return n&&(e.nodeContext=(e.lastAfterNodeContext||e.nodeContext).modify(),e.nodeContext.overflow=!0),n}processLayoutConstraint(e,t,n){let i=e.nodeContext,r=!t.allowLayout(i);return r&&(n.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!1,e.breakAtTheEdge),i=e.nodeContext=i.modify(),i.overflow=!0),r}startNonElementNode(e){e.onStartEdges=!1}startNonInlineElementNode(e){return e.leadingEdgeContexts.push(e.nodeContext.copy()),e.breakAtTheEdge=Tt(e.breakAtTheEdge,e.nodeContext.breakBefore),e.onStartEdges=!0,this.startNonInlineBox(e)}afterNonInlineElementNode(e){let t,n;return e.onStartEdges?(t=this.endEmptyNonInlineBox(e),n=t&&t.isPending()?t:F(!0),n=n.thenAsync(()=>(e.break||(e.leadingEdgeContexts=[],e.leadingEdge=!1,e.atUnforcedBreak=!1,e.breakAtTheEdge=null),F(!0)))):(t=this.endNonInlineBox(e),n=t&&t.isPending()?t:F(!0)),n.thenAsync(()=>(e.break||(e.onStartEdges=!1,e.lastAfterNodeContext=e.nodeContext.copy(),e.breakAtTheEdge=Tt(e.breakAtTheEdge,e.nodeContext.breakAfter)),F(!0)))}},hc=[];function TE(){hc=[]}function o0(e,t,n){return e-=n,t===0?e===0:e%t===0&&e/t>=0}var IE=class{constructor(e){this.matchers=e}matches(){return this.matchers.some(e=>e.matches())}},RE=class{constructor(e){this.matchers=e}matches(){return this.matchers.every(e=>e.matches())}},s0=class _l{constructor(t,n,i){this.elementOffset=t,this.a=n,this.b=i}static registerFragmentIndex(t,n,i){let r=_l.fragmentIndices;(!r[t]||r[t].priority<=i)&&(r[t]={fragmentIndex:n,priority:i})}static clearFragmentIndices(){_l.fragmentIndices={}}matches(){let t=_l.fragmentIndices[this.elementOffset];return t!=null&&t.fragmentIndex!=null&&o0(t.fragmentIndex,this.a,this.b)}};d(s0,"fragmentIndices",{});var Za=s0,vl=class{static buildViewConditionMatcher(e,t){let n=t.split("_");return n[0]=="NFS"?new Za(e,parseInt(n[1],10),parseInt(n[2],10)):null}static buildAllMatcher(e){return new RE(e)}static buildAnyMatcher(e){return new IE(e)}},l0={"border-collapse":!0,"border-spacing":!0,"caption-side":!0,"clip-rule":!0,color:!0,"color-interpolation":!0,"color-rendering":!0,cursor:!0,direction:!0,"empty-cells":!0,fill:!0,"fill-opacity":!0,"fill-rule":!0,"font-kerning":!0,"font-size":!0,"font-size-adjust":!0,"font-family":!0,"font-feature-settings":!0,"font-style":!0,"font-stretch":!0,"font-variant-ligatures":!0,"font-variant-caps":!0,"font-variant-numeric":!0,"font-variant-east-asian":!0,"font-weight":!0,"glyph-orientation-vertical":!0,"hanging-punctuation":!0,hyphens:!0,"hyphenate-character":!0,"hyphenate-limit-chars":!0,"hyphenate-limit-last":!0,"image-rendering":!0,"image-resolution":!0,"letter-spacing":!0,"line-break":!0,"line-height":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,marker:!0,"marker-end":!0,"marker-mid":!0,"marker-start":!0,orphans:!0,"overflow-wrap":!0,"paint-order":!0,"pointer-events":!0,quotes:!0,"ruby-align":!0,"ruby-position":!0,"shape-rendering":!0,stroke:!0,"stroke-dasharray":!0,"stroke-dashoffset":!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-miterlimit":!0,"stroke-opacity":!0,"stroke-width":!0,"tab-size":!0,"text-align":!0,"text-align-last":!0,"text-anchor":!0,"text-autospace":!0,"text-decoration-skip":!0,"text-decoration-skip-ink":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-fill-color":!0,"text-combine-upright":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-rendering":!0,"text-shadow":!0,"text-size-adjust":!0,"text-spacing-trim":!0,"text-stroke-color":!0,"text-stroke-width":!0,"text-transform":!0,"text-underline-offset":!0,"text-underline-position":!0,"text-wrap":!0,"text-wrap-mode":!0,"text-wrap-style":!0,visibility:!0,"white-space":!0,widows:!0,"word-break":!0,"word-spacing":!0,"writing-mode":!0},AE=["image-resolution","orphans","widows"];function LE(){return Sn("POLYFILLED_INHERITED_PROPS").reduce((e,t)=>e.concat(t()),[].concat(AE))}var FE={"http://www.idpf.org/2007/ops":!0,"http://www.w3.org/1999/xhtml":!0,"http://www.w3.org/2000/svg":!0,"http://www.w3.org/1998/Math/MathML":!0},cc=["margin-%","padding-%","border-%-width","border-%-style","border-%-color","%"],OE=["max-%","min-%","%"],wg=(()=>{let e=["left","right","top","bottom"],t={width:!0,height:!0,"max-width":!0,"max-height":!0,"min-width":!0,"min-height":!0};for(let n=0;n<cc.length;n++)for(let i=0;i<e.length;i++){let r=cc[n].replace("%",e[i]);t[r]=!0}return t})();function lo(e,t){let n={};for(let i of cc)for(let r in e){let o=i.replace("%",r),s=i.replace("%",e[r]);n[o]=s,n[s]=o}for(let i of OE)for(let r in t){let o=i.replace("%",r),s=i.replace("%",t[r]);n[o]=s,n[s]=o}return n}var a0=lo({"block-start":"right","block-end":"left","inline-start":"top","inline-end":"bottom"},{"block-size":"width","inline-size":"height"}),u0=lo({"block-start":"top","block-end":"bottom","inline-start":"left","inline-end":"right"},{"block-size":"height","inline-size":"width"}),BE=lo({"block-start":"right","block-end":"left","inline-start":"bottom","inline-end":"top"},{"block-size":"width","inline-size":"height"}),_E=lo({"block-start":"top","block-end":"bottom","inline-start":"right","inline-end":"left"},{"block-size":"height","inline-size":"width"}),ME=lo({inside:"right",outside:"left"},{}),zE=lo({inside:"left",outside:"right"},{}),fe=class dc{constructor(t,n){this.value=t,this.priority=n}getBaseValue(){return this}filterValue(t){let n=this.value.visit(t);return n===this.value?this:new dc(n,this.priority)}increaseSpecificity(t){return t==0?this:new dc(this.value,this.priority+t)}evaluate(t,n,i,r){return n&&Yn(n)?this.value:ka(t,this.value,n,i,r)}isEnabled(t){return!0}},pc=class fc extends fe{constructor(t,n,i){super(t,n),this.condition=i}getBaseValue(){return new fe(this.value,this.priority)}filterValue(t){let n=this.value.visit(t);return n===this.value?this:new fc(n,this.priority,this.condition)}increaseSpecificity(t){return t==0?this:new fc(this.value,this.priority+t,this.condition)}isEnabled(t){try{return!!this.condition.evaluate(t)}catch(n){se.warn(n)}return!1}};function gc(e,t,n){return(!t||n.priority>=t.priority)&&n.isEnabled(e)?n.getBaseValue():t}function Kn(e,t,n,i){if(e)if(!n)delete e[t];else{let r=e[t];(!r||n.priority>=r.priority)&&(i?n.isEnabled(i)&&(e[t]=n.getBaseValue()):e[t]=n)}}var h0={"region-id":!0,"fragment-selector-id":!0};function $E(e){return!!h0[e]}function mc(e){return e.charAt(0)==="_"&&e!=="_viewConditionalStyles"}function Vr(e){return e.charAt(0)!=="_"&&!h0[e]}function qo(e){return!!l0[e]||Yn(e)}function pt(e,t){return e[t]}function Yi(e,t,n){n?e[t]=n:delete e[t]}function yn(e,t){return e[t]}function Ja(e,t){let n=e[t];return n||(n={},e[t]=n),n}var c0=e=>{let t=e._viewConditionalStyles;return t||(t=[],e._viewConditionalStyles=t),t};function d0(e,t){return e[t]}function p0(e,t){let n=e[t];return n||(n=[],e[t]=n),n}function Ca(e,t,n,i,r,o,s){var l,a;if([{id:r,styleKey:"_pseudos"},{id:o,styleKey:"_regions"}].forEach(u=>{if(u.id){let h=Ja(t,u.styleKey);t=h[u.id],t||(t={},h[u.id]=t)}}),s){let u=c0(t);t={},u.push({styles:t,matcher:s})}for(let u in n)if(!mc(u))if($E(u)){let h=d0(n,u),p=p0(t,u);Array.prototype.push.apply(p,h)}else{let h=pt(n,u);if(!h.isEnabled(e))continue;let p=h.increaseSpecificity(i);Kn(t,u,p,e);let c=(a=(l=e.style)==null?void 0:l.validatorSet.shorthands[u])==null?void 0:a.propList;if(c)for(let f of c){let v=new fe(ae,p.priority);Kn(t,f,v,e)}}}function DE(e,t){let n={};for(let i=0;i<t.length;i++)Ca(e,n,t[i],0,null,null,null);return n}function f0(e,t){if(e.length>0){e.sort((i,r)=>r.getPriority()-i.getPriority());let n=null;for(let i=e.length-1;i>=0;i--)n=e[i],n.chained=t,t=n;return n}return t}var VE=class extends ro{constructor(e,t){super(),this.props=e,this.context=t,d(this,"propName","")}setPropName(e){this.propName=e}getFontSize(){let e=pt(this.props,"font-size");if(!e.value.isNumeric())return Te.em;let t=e.value;if(!vC(t.unit))throw new Error("Unexpected state");return t.num*Te[t.unit]}visitNumeric(e){return this.context,this.propName==="font-size"?g0(e,this.getFontSize(),this.context):e.unit==="em"||e.unit==="ex"||e.unit==="rem"||e.unit==="lh"||e.unit==="rlh"?ep(e,this.getFontSize(),this.context):e}visitExpr(e){return this.propName=="font-size"?ka(this.context,e,this.propName).visit(this):e}};function ep(e,t,n){let i=e.unit,r=e.num;if(i==="em"||i==="ex"){let o=Te[i]/Te.em;return new $(r*o*t,"px")}else return i==="rem"?new $(r*n.fontSize(),"px"):i==="rlh"?new $(r*n.rootLineHeight,"px"):e}function g0(e,t,n){e=ep(e,t,n);let i=e.unit,r=e.num;return i==="px"?e:i==="%"?new $(r/100*t,"px"):new $(r*n.queryUnitSize(i,!1),"px")}var ao=class{apply(e){}mergeWith(e){return new UE([this,e])}clone(){return this}},wl=class extends ao{constructor(e){super(),this.conditionItem=e}apply(e){e.pushConditionItem(this.conditionItem.fresh(e))}},UE=class m0 extends ao{constructor(t){super(),this.list=t}apply(t){for(let n=0;n<this.list.length;n++)this.list[n].apply(t)}mergeWith(t){return this.list.push(t),this}clone(){return new m0([].concat(this.list))}},tp=class extends ao{constructor(e,t,n,i,r){super(),this.style=e,this.specificity=t,this.pseudoelement=n,this.regionId=i,this.viewConditionId=r}apply(e){Ca(e.context,e.currentStyle,this.style,this.specificity,this.pseudoelement,this.regionId,e.buildViewConditionMatcher(this.viewConditionId))}},Ne=class extends ao{constructor(){super(),d(this,"chained",null)}apply(e){this.chained.apply(e)}getPriority(){return 0}makePrimary(e){return!1}},HE=class extends Ne{constructor(e){super(),this.className=e}apply(e){e.currentClassNames.includes(this.className)&&this.chained.apply(e)}getPriority(){return 10}makePrimary(e){return this.chained&&e.insertInTable(e.classes,this.className,this.chained),!0}},WE=class extends Ne{constructor(e){super(),this.id=e}apply(e){(e.currentId==this.id||e.currentXmlId==this.id)&&this.chained.apply(e)}getPriority(){return 11}makePrimary(e){return this.chained&&e.insertInTable(e.ids,this.id,this.chained),!0}},yg=class extends Ne{constructor(e){super(),this.localName=e}apply(e){e.currentLocalName==this.localName&&this.chained.apply(e)}getPriority(){return 8}makePrimary(e){return this.chained&&e.insertInTable(e.tags,this.localName,this.chained),!0}},GE=class extends Ne{constructor(e,t){super(),this.ns=e,this.localName=t}apply(e){e.currentLocalName==this.localName&&e.currentNamespace==this.ns&&this.chained.apply(e)}getPriority(){return 8}makePrimary(e){if(this.chained){let t=e.nsPrefix[this.ns];t||(t=`ns${e.nsCount++}:`,e.nsPrefix[this.ns]=t);let n=t+this.localName;e.insertInTable(e.nstags,n,this.chained)}return!0}},jE=class extends Ne{constructor(e,t){super(),this.epubTypePatt=e,this.targetLocalName=t}apply(e){let t=e.currentElement;if(t instanceof HTMLAnchorElement&&t.hash&&t.href==t.baseURI.replace(/#.*$/,"")+t.hash){let n=t.hash.substring(1),i=t.ownerDocument.getElementById(n);if(i&&(!this.targetLocalName||i.localName==this.targetLocalName)){let r=i.getAttributeNS("http://www.idpf.org/2007/ops","type")||i.getAttribute("epub:type");r&&r.match(this.epubTypePatt)&&this.chained.apply(e)}}}},XE=class extends Ne{constructor(e){super(),this.ns=e}apply(e){e.currentNamespace==this.ns&&this.chained.apply(e)}};function eu(e,t,n,i){if(!e)return!1;if(t!==null)return i(e,t,n);for(let r of e.getAttributeNames())if((r===n||r.endsWith(`:${n}`))&&i(e,r===n?"":e.lookupNamespaceURI(r.split(":")[0]),n))return!0;return!1}var xg=class extends Ne{constructor(e,t){super(),this.ns=e,this.name=t}apply(e){eu(e.currentElement,this.ns,this.name,(t,n,i)=>t.hasAttributeNS(n,i))&&this.chained.apply(e)}},YE=class extends Ne{constructor(e,t,n){super(),this.ns=e,this.name=t,this.value=n}apply(e){eu(e.currentElement,this.ns,this.name,(t,n,i)=>t.getAttributeNS(n,i)==this.value)&&this.chained.apply(e)}getPriority(){return this.name=="type"&&this.ns=="http://www.idpf.org/2007/ops"?9:0}makePrimary(e){return this.name=="type"&&this.ns=="http://www.idpf.org/2007/ops"?(this.chained&&e.insertInTable(e.epubtypes,this.value,this.chained),!0):!1}},qE=class extends Ne{constructor(e,t){super(),this.ns=e,this.name=t}apply(e){eu(e.currentElement,this.ns,this.name,(t,n,i)=>!!FE[t.getAttributeNS(n,i)])&&this.chained.apply(e)}getPriority(){return 0}makePrimary(e){return!1}},So=class extends Ne{constructor(e,t,n){super(),this.ns=e,this.name=t,this.regexp=n}apply(e){eu(e.currentElement,this.ns,this.name,(t,n,i)=>{var r;return!!((r=t.getAttributeNS(n,i))!=null&&r.match(this.regexp))})&&this.chained.apply(e)}},KE=class extends Ne{constructor(e){super(),this.langRegExp=e}apply(e){e.lang.match(this.langRegExp)&&this.chained.apply(e)}},bg=class extends Ne{constructor(){super()}apply(e){e.isFirst&&this.chained.apply(e)}getPriority(){return 6}},QE=class extends Ne{constructor(){super()}apply(e){e.isRoot&&this.chained.apply(e)}getPriority(){return 12}},js=class extends Ne{constructor(e,t){super(),this.a=e,this.b=t}matchANPlusB(e){return o0(e,this.a,this.b)}},ZE=class extends js{constructor(e,t){super(e,t)}apply(e){this.matchANPlusB(e.currentSiblingOrder)&&this.chained.apply(e)}getPriority(){return 5}},vc=class extends js{constructor(e,t){super(e,t)}apply(e){let t=e.currentSiblingTypeCounts[e.currentNamespace][e.currentLocalName];this.matchANPlusB(t)&&this.chained.apply(e)}getPriority(){return 5}},wc=class extends js{constructor(e,t){super(e,t)}apply(e){let t=e.currentFollowingSiblingOrder;t===null&&(t=e.currentFollowingSiblingOrder=e.currentElement.parentNode.childElementCount-e.currentSiblingOrder+1),this.matchANPlusB(t)&&this.chained.apply(e)}getPriority(){return 4}},yc=class extends js{constructor(e,t){super(e,t)}apply(e){let t=e.currentFollowingSiblingTypeCounts;if(!t[e.currentNamespace]){let n=e.currentElement;do{let i=n.namespaceURI,r=n.localName,o=t[i];o||(o=t[i]={}),o[r]=(o[r]||0)+1}while(n=n.nextElementSibling)}this.matchANPlusB(t[e.currentNamespace][e.currentLocalName])&&this.chained.apply(e)}getPriority(){return 4}},JE=class extends Ne{constructor(){super()}apply(e){let t=e.currentElement.firstChild;for(;t;){switch(t.nodeType){case Node.ELEMENT_NODE:return;case Node.TEXT_NODE:if(t.length>0)return}t=t.nextSibling}this.chained.apply(e)}getPriority(){return 4}},eP=class extends Ne{constructor(){super()}apply(e){e.currentElement.disabled===!1&&this.chained.apply(e)}getPriority(){return 5}},tP=class extends Ne{constructor(){super()}apply(e){e.currentElement.disabled===!0&&this.chained.apply(e)}getPriority(){return 5}},nP=class extends Ne{constructor(){super()}apply(e){let t=e.currentElement;(t.selected===!0||t.checked===!0)&&this.chained.apply(e)}getPriority(){return 5}},kt=class extends Ne{constructor(e){super(),this.condition=e}apply(e){if(e.conditions[this.condition])try{e.dependentConditions.push(this.condition),this.chained.apply(e)}finally{e.dependentConditions.pop()}}getPriority(){return 5}},iP=class v0 extends ao{constructor(){super(),d(this,"applied",!1)}apply(t){this.applied=!0}clone(){let t=new v0;return t.applied=this.applied,t}},np=class extends Ne{constructor(e){super(),d(this,"checkAppliedAction"),d(this,"firstActions",[]),this.checkAppliedAction=new iP;for(let t of e)this.firstActions.push(f0(t,this.checkAppliedAction))}apply(e){for(let t of this.firstActions)if(t.apply(e),this.checkAppliedAction.applied)break;this.checkAppliedAction.applied===this.positive()&&this.chained.apply(e),this.checkAppliedAction.applied=!1}getPriority(){return Math.max(...this.firstActions.map(e=>e instanceof Ne?e.getPriority():0))}positive(){return!0}relational(){return!1}},rP=class extends np{positive(){return!1}},oP=class extends np{constructor(e){super([]),this.selectorTexts=e}apply(e){for(let t of this.selectorTexts){let n,i;/^\s*[+~]/.test(t)?(i=e.currentElement.parentNode,n=`:scope > :nth-child(${Array.from(i.children).indexOf(e.currentElement)+1}) ${t}`):(i=e.currentElement,n=`:scope ${t}`);try{if(i.querySelector(n)){this.checkAppliedAction.apply(e);break}}catch{}}this.checkAppliedAction.applied&&this.chained.apply(e),this.checkAppliedAction.applied=!1}relational(){return!0}},tu=class{constructor(e,t,n){this.condition=e,this.viewConditionId=t,this.viewCondition=n}increment(e){e.increment(this.condition,this.viewCondition)}decrement(e){e.decrement(this.condition,this.viewCondition)}buildViewConditionMatcher(e){return e.buildViewConditionMatcher(this.viewConditionId)}},sP=class w0 extends tu{constructor(t,n,i){super(t,n,i)}fresh(t){return new w0(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(t,n){return n==0&&this.increment(t),!1}pop(t,n){return n==0?(this.decrement(t),!0):!1}},lP=class y0 extends tu{constructor(t,n,i){super(t,n,i)}fresh(t){return new y0(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(t,n){return n==0?this.increment(t):n==1&&this.decrement(t),!1}pop(t,n){return n==0?(this.decrement(t),!0):(n==1&&this.increment(t),!1)}},aP=class x0 extends tu{constructor(t,n,i){super(t,n,i),d(this,"fired",!1)}fresh(t){return new x0(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(t,n){return this.fired?(this.decrement(t),!0):!1}pop(t,n){return this.fired?(this.decrement(t),!0):(n==0&&(this.fired=!0,this.increment(t)),!1)}},uP=class b0 extends tu{constructor(t,n,i){super(t,n,i),d(this,"fired",!1)}fresh(t){return new b0(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(t,n){return this.fired&&(n==-1?this.increment(t):n==0&&this.decrement(t)),!1}pop(t,n){if(this.fired){if(n==-1)return this.decrement(t),!0;n==0&&this.increment(t)}else n==0&&(this.fired=!0,this.increment(t));return!1}},hP=class{constructor(e,t){this.afterprop=e,this.element=t}fresh(e){return this}push(e,t){return!1}pop(e,t){return t==0?(e.processPseudoelementProps(this.afterprop,this.element),!0):!1}},cP=class{constructor(e){this.lang=e}fresh(e){return this}push(e,t){return!1}pop(e,t){return t==0?(e.lang=this.lang,!0):!1}},dP=class{constructor(e){this.oldQuotes=e}fresh(e){return this}push(e,t){return!1}pop(e,t){return t==0?(e.quotes=this.oldQuotes,!0):!1}},pP=class extends ro{constructor(e){super(),this.element=e}createValueFromString(e,t){switch(t){case"url":return e?new wn(e):new wn("about:invalid");case"string":default:return e?new Je(e):new Je("")}}visitFunc(e){if(e.name!=="attr")return super.visitFunc(e);let t="string",n=null,i=null;if(e.values[0]instanceof Be){let r=e.values[0].values;r.length>=2&&(t=r[1].stringValue()),n=r[0].stringValue()}else n=e.values[0].stringValue();return e.values.length>1?i=this.createValueFromString(e.values[1].stringValue(),t):i=this.createValueFromString(null,t),this.element&&this.element.hasAttribute(n)?this.createValueFromString(this.element.getAttribute(n),t):i}};function Ko(e){if(Ni(e)){if(e instanceof Je)return e.stringValue();if(e instanceof Be)return e.values.map(t=>Ko(t)).join("")}return""}var xc=class extends ro{constructor(e,t,n){super(),this.cascade=e,this.element=t,this.counterResolver=n}visitIdent(e){let t=this.cascade,n=t.quotes,i=Math.floor(n.length/2)-1;switch(e.name){case"open-quote":{let r=n[2*Math.min(i,t.quoteDepth)];return t.quoteDepth++,r}case"close-quote":return t.quoteDepth>0&&t.quoteDepth--,n[2*Math.min(i,t.quoteDepth)+1];case"no-open-quote":return t.quoteDepth++,new Je("");case"no-close-quote":return t.quoteDepth>0&&t.quoteDepth--,new Je("")}return e}format(e,t){let n=!1,i=!1,r;(r=t.match(/^upper-(.*)/))!=null?(n=!0,t=r[1]):(r=t.match(/^lower-(.*)/))!=null&&(i=!0,t=r[1]);let o="";return Sg[t]?o=gP(Sg[t],e):Cg[t]?o=vP(Cg[t],e):kg[t]!=null?o=kg[t]:t=="decimal-leading-zero"?(o=`${e}`,o.length==1&&(o=`0${o}`)):t=="cjk-ideographic"||t=="trad-chinese-informal"?o=yP(e,wP):o=`${e}`,n?o.toUpperCase():i?o.toLowerCase():o}visitFuncCounter(e){let t=e[0].toString(),n=e.length>1?e[1].stringValue():"decimal",i=this.cascade.counters[t];if(i&&i.length){let r=i&&i.length&&i[i.length-1]||0;return new Je(this.format(r,n))}else{let r=new ie(this.counterResolver.getPageCounterVal(t,o=>this.format(o||0,n)));return new Be([r])}}visitFuncCounters(e){let t=e[0].toString(),n=e[1].stringValue(),i=e.length>2?e[2].stringValue():"decimal",r=this.cascade.counters[t],o=new Xn;if(r&&r.length)for(let l=0;l<r.length;l++)l>0&&o.append(n),o.append(this.format(r[l],i));let s=new ie(this.counterResolver.getPageCountersVal(t,l=>{let a=[];if(l.length)for(let h=0;h<l.length;h++)a.push(this.format(l[h],i));let u=o.toString();return u.length&&a.push(u),a.length?a.join(n):this.format(0,i)}));return new Be([s])}visitFuncTargetCounter(e){let t=e[0],n;t instanceof wn?n=t.url:n=t.stringValue();let i=e[1].toString(),r=e.length>2?e[2].stringValue():"decimal",o=new ie(this.counterResolver.getTargetCounterVal(n,i,s=>this.format(s||0,r)));return new Be([o])}visitFuncTargetCounters(e){let t=e[0],n;t instanceof wn?n=t.url:n=t.stringValue();let i=e[1].toString(),r=e[2].stringValue(),o=e.length>3?e[3].stringValue():"decimal",s=new ie(this.counterResolver.getTargetCountersVal(n,i,l=>{let a=l.map(u=>this.format(u,o));return a.length?a.join(r):this.format(0,o)}));return new Be([s])}visitFuncString(e){let t=e.length>0?e[0].stringValue():"",n=e.length>1?e[1].stringValue():"first";return new ie(this.counterResolver.getNamedStringVal(t,n))}visitFuncElement(e){let t=e.length>0?e[0].stringValue():"",n=e.length>1?e[1].stringValue():"first";return new ie(this.counterResolver.getRunningElementVal(t,n))}visitFuncContent(e){var t,n,i,r,o,s;let l=e.length>0?e[0].stringValue():"text",a="";switch(l){case"text":a=this.element.textContent;break;case"before":case"after":{let u=yn(this.cascade.currentStyle,"_pseudos"),h=(n=(t=u==null?void 0:u[l])==null?void 0:t.content)==null?void 0:n.value;a=Ko(h)}break;case"first-letter":{let u=yn(this.cascade.currentStyle,"_pseudos"),h=(Ko((r=(i=u==null?void 0:u.before)==null?void 0:i.content)==null?void 0:r.value)||this.element.textContent||Ko((s=(o=u==null?void 0:u.after)==null?void 0:o.content)==null?void 0:s.value)).match(Vh);a=h?h[0]:""}break}return new Je(a)}visitFuncLeader(e){let t="";if(e[0]instanceof Xt)switch(e[0].stringValue()){case"dotted":t=".";break;case"solid":t="_";break;case"space":t=" ";break}else e[0]instanceof Je&&(t=e[0].stringValue());return t.length==0?new Je(""):new ie(new st(null,()=>t,"viv-leader"))}visitFunc(e){switch(e.name){case"counter":if(e.values.length<=2)return this.visitFuncCounter(e.values);break;case"counters":if(e.values.length<=3)return this.visitFuncCounters(e.values);break;case"target-counter":if(e.values.length<=3)return this.visitFuncTargetCounter(e.values);break;case"target-counters":if(e.values.length<=4)return this.visitFuncTargetCounters(e.values);break;case"string":if(e.values.length<=2)return this.visitFuncString(e.values);break;case"element":if(e.values.length<=2)return this.visitFuncElement(e.values);break;case"content":if(e.values.length<=1)return this.visitFuncContent(e.values);break;case"leader":if(e.values.length<=1)return this.visitFuncLeader(e.values);break}return e}},fP=(e,t,n)=>{let i=t.filter(r=>r.after&&r.viewNode.nodeType===1&&r.viewNode.getAttribute("data-viv-leader"));for(let r of i){let o=function(L){if(w==="rtl"){let z="";h.textContent=(L.startsWith(z)?"":z)+L+(L.endsWith(z)?"":z)}else h.textContent=L},s=function(){let L=n.clientLayout.getElementClientRect(p);return g.left>L.left||g.right<L.right||g.top>L.top||g.bottom<L.bottom},l=function(){let L,z;if(o(f),s())L=1,z=f.length/c.length;else{L=f.length/c.length,z=L;for(let q=0;q<16;q++){let Q=f;for(let D=0;D<1<<q;D++)Q+=c;if(o(Q),s()){z+=1<<q;break}}}for(let q=0;q<16;q++){let Q="",D=Math.floor((L+z)/2);for(let Z=0;Z<D;Z++)Q+=c;if(o(Q),s())z=D;else{if(L==D)return;L=D}}o(c)},a=function(L){let z=0,q=p.parentElement;for(;q&&q!==u.viewNode;)z+=n.getComputedInsets(q)[L],q=q.parentElement;return z},u=r.parent;for(;u&&u.inline;)u=u.parent;let h=r.viewNode,p=h.parentElement,c=h.getAttribute("data-viv-leader-value"),f=h.textContent||c,{writingMode:v,direction:w,marginInlineEnd:y}=n.clientLayout.getElementComputedStyle(p);h.style.marginInlineStart="1px",o(c),p.style.display="inline-block",p.style.textIndent="0";let g=n.clientLayout.getElementClientRect(u.viewNode),m=n.clientLayout.getElementClientRect(p),x=n.parseComputedLength(y);v==="vertical-rl"||v==="vertical-lr"?(w==="rtl"?g.top+=x:g.bottom-=x,g.left=m.left,g.right=m.right,g.top=Math.min(m.top,g.top),g.bottom=Math.max(m.bottom,g.bottom)):(w==="rtl"?g.left+=x:g.right-=x,g.top=m.top,g.bottom=m.bottom,g.left=Math.min(m.left,g.left),g.right=Math.max(m.right,g.right)),l();let C=n.clientLayout.getElementClientRect(p);w=="rtl"?p.style.float="left":p.style.float="right";let N=n.clientLayout.getElementClientRect(p),A=0;w=="rtl"?v=="vertical-rl"||v=="vertical-lr"?A=C.top-N.top-a("top"):A=C.left-N.left-a("left"):v=="vertical-rl"||v=="vertical-lr"?A=N.bottom-C.bottom-a("bottom"):A=N.right-C.right-a("right"),A=Math.max(0,A-.1),p.style.float="",h.style.marginInlineStart=`${A}px`}};hn("POST_LAYOUT_BLOCK",fP);var Sg={roman:[4999,1e3,"M",900,"CM",500,"D",400,"CD",100,"C",90,"XC",50,"L",40,"XL",10,"X",9,"IX",5,"V",4,"IV",1,"I"],armenian:[9999,9e3,"",8e3,"",7e3,"",6e3,"",5e3,"",4e3,"",3e3,"",2e3,"",1e3,"",900,"",800,"",700,"",600,"",500,"",400,"",300,"",200,"",100,"",90,"",80,"",70,"",60,"",50,"",40,"",30,"",20,"",10,"",9,"",8,"",7,"",6,"",5,"",4,"",3,"",2,"",1,""],georgian:[19999,1e4,"",9e3,"",8e3,"",7e3,"",6e3,"",5e3,"",4e3,"",3e3,"",2e3,"",1e3,"",900,"",800,"",700,"",600,"",500,"",400,"",300,"",200,"",100,"",90,"",80,"",70,"",60,"",50,"",40,"",30,"",20,"",10,"",9,"",8,"",7,"",6,"",5,"",4,"",3,"",2,"",1,""],hebrew:[999,400,"",300,"",200,"",100,"",90,"",80,"",70,"",60,"",50,"",40,"",30,"",20,"",19,"",18,"",17,"",16,"",15,"",10,"",9,"",8,"",7,"",6,"",5,"",4,"",3,"",2,"",1,""]},Cg={latin:"a-z",alpha:"a-z",greek:"--",russian:"---"},kg={square:"",disc:"",circle:"",none:""};function gP(e,t){let n=e[0];if(t>n||t<=0||t!=Math.round(t))return"";let i="";for(let r=1;r<e.length;r+=2){let o=e[r],s=Math.floor(t/o);if(s>20)return"";for(t-=s*o;s>0;)i+=e[r+1],s--}return i}function mP(e){let t=[],n=0;for(;n<e.length;)if(e.substr(n+1,1)=="-"){let i=e.charCodeAt(n),r=e.charCodeAt(n+2);n+=3;for(let o=i;o<=r;o++)t.push(String.fromCharCode(o))}else t.push(e.substr(n++,1));return t}function vP(e,t){if(t<=0||t!=Math.round(t))return"";let n=mP(e),i="";do{t--;let r=t%n.length;i=n[r]+i,t=(t-r)/n.length}while(t>0);return i}var wP={formal:!1,digits:"",markers:"",negative:""};function yP(e,t){if(e>9999||e<-9999)return`${e}`;if(e==0)return t.digits.charAt(0);let n=new Xn;if(e<0&&(n.append(t.negative),e=-e),e<10)n.append(t.digits.charAt(e));else if(e<=19)n.append(t.markers.charAt(0)),e!=0&&n.append(t.digits.charAt(e-10));else{let i=Math.floor(e/1e3);i&&(n.append(t.digits.charAt(i)),n.append(t.markers.charAt(2)));let r=Math.floor(e/100)%10;r&&(n.append(t.digits.charAt(r)),n.append(t.markers.charAt(1)));let o=Math.floor(e/10)%10;o&&(n.append(t.digits.charAt(o)),n.append(t.markers.charAt(0)));let s=e%10;s&&n.append(t.digits.charAt(s))}return n.toString()}var ip=1/1048576;function ar(e,t){for(let n in e)t[n]=e[n].clone()}var xP=class S0{constructor(){d(this,"nsCount",0),d(this,"nsPrefix",{}),d(this,"tags",{}),d(this,"nstags",{}),d(this,"epubtypes",{}),d(this,"classes",{}),d(this,"ids",{}),d(this,"pagetypes",{}),d(this,"order",0)}clone(){let t=new S0;t.nsCount=this.nsCount;for(let n in this.nsPrefix)t.nsPrefix[n]=this.nsPrefix[n];return ar(this.tags,t.tags),ar(this.nstags,t.nstags),ar(this.epubtypes,t.epubtypes),ar(this.classes,t.classes),ar(this.ids,t.ids),ar(this.pagetypes,t.pagetypes),t.order=this.order,t}insertInTable(t,n,i){let r=t[n];r&&(i=r.mergeWith(i)),t[n]=i}createInstance(t,n,i,r){return new bP(this,t,n,i,r)}nextOrder(){return this.order+=ip}},bP=class{constructor(e,t,n,i,r){this.context=t,this.counterListener=n,this.counterResolver=i,d(this,"code"),d(this,"stack",[[],[]]),d(this,"conditions",{}),d(this,"currentElement",null),d(this,"currentElementOffset",null),d(this,"currentStyle",null),d(this,"currentClassNames",null),d(this,"currentLocalName",""),d(this,"currentNamespace",""),d(this,"currentId",""),d(this,"currentXmlId",""),d(this,"currentNSTag",""),d(this,"currentEpubTypes",null),d(this,"currentPageType",null),d(this,"previousPageType",null),d(this,"firstPageType",null),d(this,"isFirst",!0),d(this,"isRoot",!0),d(this,"counters",{}),d(this,"counterScoping",[{}]),d(this,"quotes"),d(this,"quoteDepth",0),d(this,"lang",""),d(this,"siblingOrderStack",[0]),d(this,"currentSiblingOrder",0),d(this,"siblingTypeCountsStack",[{}]),d(this,"currentSiblingTypeCounts"),d(this,"currentFollowingSiblingOrder",null),d(this,"followingSiblingOrderStack"),d(this,"followingSiblingTypeCountsStack",[{}]),d(this,"currentFollowingSiblingTypeCounts"),d(this,"viewConditions",{}),d(this,"dependentConditions",[]),d(this,"elementStack"),this.code=e,this.quotes=[new Je(""),new Je(""),new Je(""),new Je("")],this.currentSiblingTypeCounts=this.siblingTypeCountsStack[0],this.followingSiblingOrderStack=[this.currentFollowingSiblingOrder],this.currentFollowingSiblingTypeCounts=this.siblingTypeCountsStack[0]}pushConditionItem(e){this.stack[this.stack.length-1].push(e)}increment(e,t){this.conditions[e]=(this.conditions[e]||0)+1,t&&(this.viewConditions[e]?this.viewConditions[e].push(t):this.viewConditions[e]=[t])}decrement(e,t){this.conditions[e]--,this.viewConditions[e]&&(this.viewConditions[e]=this.viewConditions[e].filter(n=>n!==t),this.viewConditions[e].length===0&&delete this.viewConditions[e])}buildViewConditionMatcher(e){let t=null;e&&(this.currentElementOffset,t=vl.buildViewConditionMatcher(this.currentElementOffset,e));let n=this.dependentConditions.map(i=>{let r=this.viewConditions[i];return r&&r.length>0?r.length===1?r[0]:vl.buildAnyMatcher([].concat(r)):null}).filter(i=>i);return n.length<=0?t:t===null?n.length===1?n[0]:vl.buildAllMatcher(n):vl.buildAllMatcher([t].concat(n))}applyAction(e,t){let n=e[t];n&&n.apply(this)}pushRule(e,t,n){this.currentElement=null,this.currentElementOffset=null,this.currentStyle=n,this.currentNamespace="",this.currentLocalName="",this.currentId="",this.currentXmlId="",this.currentClassNames=e,this.currentNSTag="",this.currentEpubTypes=Uu,this.currentPageType=t,this.applyActions()}defineCounter(e,t){let n=this.counterScoping[this.counterScoping.length-1];n||(n={},this.counterScoping[this.counterScoping.length-1]=n),this.counters[e]?(n[e]&&this.counters[e].pop(),this.counters[e].push(t)):this.counters[e]=[t],n[e]=!0}pushCounters(e){var t,n,i,r,o,s,l;let a=S.inline,u=e.display;if(u&&(a=u.evaluate(this.context)),a===S.none){this.currentElement.setAttribute("data-viv-display-none","true"),this.counterScoping.push(null);return}else if(this.currentElement.closest("[data-viv-display-none]")){this.counterScoping.push(null);return}let h=S.inline,p=e.float;p&&(h=p.evaluate(this.context));let c=null,f=null,v=null,w=e["counter-reset"];if(w){let m=w.evaluate(this.context);m&&(c=jo(m,!0))}let y=e["counter-set"];if(y){let m=y.evaluate(this.context);m&&(v=jo(m,!1))}let g=e["counter-increment"];if(g){let m=g.evaluate(this.context);m&&(f=jo(m,!1))}if((this.currentLocalName=="ol"||this.currentLocalName=="ul")&&this.currentNamespace=="http://www.w3.org/1999/xhtml"&&(c||(c={}),c["list-item"]=((n=(t=this.currentElement)==null?void 0:t.start)!=null?n:1)-1),a===S.list_item&&(f||(f={}),f["list-item"]=(i=f["list-item"])!=null?i:1,/^\s*[-+]?\d/.test((o=(r=this.currentElement)==null?void 0:r.getAttribute("value"))!=null?o:"")&&(v||(v={}),v["list-item"]=this.currentElement.value)),((s=this.currentElement)==null?void 0:s.parentNode.nodeType)===Node.DOCUMENT_NODE&&(c||(c={}),c.footnote===void 0&&(c.footnote=0)),h===S.footnote&&(f||(f={}),f.footnote===void 0)){let m=(l=this.currentStyle["counter-increment"])==null?void 0:l.value;(!m||!(m===S.footnote||m instanceof Be&&m.values.includes(S.footnote)))&&(f.footnote=1)}if(c)for(let m in c)this.defineCounter(m,c[m]);if(f)for(let m in f){this.counters[m]||this.defineCounter(m,0);let x=this.counters[m];x[x.length-1]+=f[m]}if(v)for(let m in v)if(!this.counters[m])this.defineCounter(m,v[m]);else{let x=this.counters[m];x[x.length-1]=v[m]}if(a===S.list_item){let m=this.counters["list-item"],x=m[m.length-1];e["ua-list-item-count"]=new fe(new Ai(x),0)}this.counterScoping.push(null)}popCounters(){let e=this.counterScoping.pop();if(e)for(let t in e){let n=this.counters[t];n&&(n.length==1?delete this.counters[t]:n.pop())}}setNamedStrings(e){let t=e["string-set"];if(!t)return;t=t.filterValue(new xc(this,this.currentElement,this.counterResolver));let n=t.value instanceof Rt?t.value.values:[t.value];for(let i of n)if(i instanceof Be){let r=i.values[0].stringValue(),o=i.values.slice(1).map(s=>Ko(s)).join("");this.counterResolver.setNamedString(r,o,this.currentElementOffset)}delete e["string-set"]}setRunningElement(e){let t=e.position;if((t==null?void 0:t.value)instanceof oo&&t.value.name==="running"){let n=t.value.values[0].stringValue();this.counterResolver.setRunningElement(n,this.currentElementOffset)}}processPseudoelementProps(e,t){this.pushCounters(e);let n=e.content;n&&(e.content=n.filterValue(new xc(this,t,this.counterResolver))),this.popCounters()}pushElement(e,t,n,i){var r,o;this.currentPageType=null,this.currentElement=t,this.currentElementOffset=i,this.currentStyle=n,this.currentNamespace=t.namespaceURI,this.currentLocalName=t.localName;let s=this.code.nsPrefix[this.currentNamespace];s?this.currentNSTag=s+this.currentLocalName:this.currentNSTag="",this.currentId=t.getAttribute("id"),this.currentXmlId=t.getAttributeNS("http://www.w3.org/XML/1998/namespace","id");let l=t.getAttribute("class");l?this.currentClassNames=l.split(/\s+/):this.currentClassNames=Uu;let a=t.getAttributeNS("http://www.idpf.org/2007/ops","type");a?this.currentEpubTypes=a.split(/\s+/):this.currentEpubTypes=Uu;let u=Uh(t);u&&(this.stack[this.stack.length-1].push(new cP(this.lang)),this.lang=u.toLowerCase());let h=this.isRoot,p=this.siblingOrderStack;this.currentSiblingOrder=++p[p.length-1],p.push(0);let c=this.siblingTypeCountsStack,f=this.currentSiblingTypeCounts=c[c.length-1],v=f[this.currentNamespace];v||(v=f[this.currentNamespace]={}),v[this.currentLocalName]=(v[this.currentLocalName]||0)+1,c.push({});let w=this.followingSiblingOrderStack;w[w.length-1]!==null?this.currentFollowingSiblingOrder=--w[w.length-1]:this.currentFollowingSiblingOrder=null,w.push(null);let y=this.followingSiblingTypeCountsStack,g=this.currentFollowingSiblingTypeCounts=y[y.length-1];g&&g[this.currentNamespace]&&g[this.currentNamespace][this.currentLocalName]--,y.push({}),this.applyActions(),this.applyVarFilter([this.currentStyle],e,t),this.applyCalcFilter(this.currentStyle,this.context),this.applyAttrFilter(t);let m=n.quotes,x=null;if(m){let A=m.evaluate(this.context);A&&(x=new dP(this.quotes),A===S.none?this.quotes=[new Je(""),new Je("")]:A===S.auto||A===S.initial?this.quotes=[new Je(""),new Je(""),new Je(""),new Je("")]:A instanceof Be&&(this.quotes=A.values))}this.pushCounters(this.currentStyle);let C=this.currentId||this.currentXmlId||t.getAttribute("name")||"";if(h||C){let A={};Object.keys(this.counters).forEach(L=>{A[L]=Array.from(this.counters[L])}),this.counterListener.countersOfId(C,A)}let N=yn(this.currentStyle,"_pseudos");if(N){let A=!0;for(let L of SP){L||(A=!1);let z=N[L];z&&((L==="before"||L==="after")&&!Ni((r=z.content)==null?void 0:r.value)||(L==="footnote-call"||L==="footnote-marker")&&((o=pt(this.currentStyle,"float"))==null?void 0:o.value)!==S.footnote?delete N[L]:A?this.processPseudoelementProps(z,t):this.stack[this.stack.length-2].push(new hP(z,t)))}}this.setNamedStrings(this.currentStyle),this.setRunningElement(this.currentStyle),x&&this.stack[this.stack.length-2].push(x)}applyAttrFilterInner(e,t){for(let n in t)Vr(n)&&!Yn(n)&&(t[n]=t[n].filterValue(e))}applyAttrFilter(e){let t=new pP(e),n=this.currentStyle,i=yn(n,"_pseudos");for(let r in i)this.applyAttrFilterInner(t,i[r]);this.applyAttrFilterInner(t,n)}applyVarFilter(e,t,n){var i,r,o;let s=e[0],l=new AP(e,t,n),a=32,u={};for(let h in s)if(mc(h)){let p=yn(s,h);for(let c in p)this.applyVarFilter([p[c],...e],t,n)}else if(Vr(h)){let p=pt(s,h),c=p.value;for(let f=0;;f++){if(f>=a){c=ae;break}let v=c.visit(l);if(l.error){c=ae,l.error=!1;break}if(v===c)break;c=v}if(c!==p.value){let f=t.validatorSet,v=(i=f==null?void 0:f.shorthands[h])==null?void 0:i.clone();if(v)if(ge(c)){for(let w of v.propList){let y=new fe(c,p.priority),g=pt(s,w);Yi(u,w,gc(this.context,g,y))}delete s[h]}else{let w=so(t.scope,new kn(c.toString(),null),"");if(w&&(w.visit(v),!v.error)){for(let y of v.propList){let g=new fe((o=(r=v.values[y])!=null?r:f.defaultValues[y])!=null?o:S.initial,p.priority),m=pt(s,y);Yi(u,y,gc(this.context,m,g))}delete s[h]}}else s[h]=new fe(c,p.priority)}if(u[h]){let f=pt(s,h);f&&f.value!==ae&&Kn(u,h,f,this.context)}}for(let h in u)s[h]=u[h]}applyCalcFilter(e,t){let n=new R0(t);for(let i in e)if(mc(i)){let r=yn(e,i);for(let o in r)this.applyCalcFilter(r[o],t)}else if(Vr(i)&&!Yn(i)){let r=pt(e,i),o=r.value.visit(n);o!==r.value&&(e[i]=new fe(o,r.priority))}}applyActions(){let e;for(e=0;e<this.currentClassNames.length;e++)this.applyAction(this.code.classes,this.currentClassNames[e]);for(e=0;e<this.currentEpubTypes.length;e++)this.applyAction(this.code.epubtypes,this.currentEpubTypes[e]);this.applyAction(this.code.ids,this.currentId),this.applyAction(this.code.tags,this.currentLocalName),this.currentLocalName!=""&&this.applyAction(this.code.tags,"*"),this.applyAction(this.code.nstags,this.currentNSTag),this.currentPageType!==null&&(this.applyAction(this.code.pagetypes,this.currentPageType),this.applyAction(this.code.pagetypes,"*")),this.stack.push([]);for(let t=1;t>=-1;--t){let n=this.stack[this.stack.length-t-2];for(e=0;e<n.length;)n[e].push(this,t)?n.splice(e,1):e++}this.isFirst=!0,this.isRoot=!1}pop(){for(let e=1;e>=-1;--e){let t=this.stack[this.stack.length-e-2],n=0;for(;n<t.length;)t[n].pop(this,e)?t.splice(n,1):n++}this.stack.pop(),this.isFirst=!1}popRule(){this.pop()}popElement(e){this.siblingOrderStack.pop(),this.siblingTypeCountsStack.pop(),this.followingSiblingOrderStack.pop(),this.followingSiblingTypeCountsStack.pop(),this.pop(),this.popCounters()}},Uu=[],SP=["before","transclusion-before","footnote-call","footnote-marker","inner","first-letter","first-line","","transclusion-after","after"],bc=null;function CP(e){bc=e}var Es=class extends Hs{constructor(e,t,n,i,r,o,s){super(e,t,s),this.condition=n,this.regionId=r,this.validatorSet=o,d(this,"chain",null),d(this,"specificity",0),d(this,"elementStyle",null),d(this,"conditionCount",0),d(this,"pseudoelement",null),d(this,"footnoteContent",!1),d(this,"cascade"),d(this,"state"),d(this,"viewConditionId",null),d(this,"insideSelectorRule"),d(this,"invalid",!1),this.cascade=i?i.cascade:bc?bc.clone():new xP,this.state=0}insertNonPrimary(e){this.cascade.insertInTable(this.cascade.tags,"*",e)}processChain(e){let t=f0(this.chain,e);t!==e&&t.makePrimary(this.cascade)||this.insertNonPrimary(t)}isInsideSelectorRule(e){return this.state!=0?(this.reportAndSkip(e),!0):!1}tagSelector(e,t){!t&&!e||(t&&(this.specificity+=1),t&&e?this.chain.push(new GE(e,t.toLowerCase())):t?this.chain.push(new yg(t.toLowerCase())):this.chain.push(new XE(e)))}invalidSelector(e){se.warn(e),this.chain.push(new kt("")),this.setInvalid()}setInvalid(){this.invalid=!0;for(let e=this;e instanceof Ps;e=e.parent)e.parent.invalid=!0}classSelector(e){if(this.pseudoelement){this.invalidSelector(`::${this.pseudoelement} followed by .${e}`);return}this.specificity+=256,this.chain.push(new HE(e))}pseudoclassSelector(e,t){if(this.pseudoelement){this.invalidSelector(`::${this.pseudoelement} followed by :${e}`);return}switch(e.toLowerCase()){case"enabled":this.chain.push(new eP);break;case"disabled":this.chain.push(new tP);break;case"checked":this.chain.push(new nP);break;case"root":case"scope":this.chain.push(new QE);break;case"link":this.chain.push(new yg("a")),this.chain.push(new xg("","href"));break;case"-adapt-href-epub-type":case"href-epub-type":if(t&&t.length>=1&&typeof t[0]=="string"){let n=t[0],i=new RegExp(`(^|\\s)${ti(n)}($|\\s)`),r=t[1];this.chain.push(new jE(i,r))}else this.chain.push(new kt(""));break;case"-adapt-footnote-content":case"footnote-content":this.footnoteContent=!0;break;case"visited":case"active":case"hover":case"focus":this.chain.push(new kt(""));break;case"lang":if(t&&t.length==1&&typeof t[0]=="string"){let n=t[0];this.chain.push(new KE(new RegExp(`^${ti(n.toLowerCase())}($|-)`)))}else this.chain.push(new kt(""));break;case"nth-child":case"nth-last-child":case"nth-of-type":case"nth-last-of-type":{let n=kP[e.toLowerCase()];t&&t.length==2?this.chain.push(new n(t[0],t[1])):this.chain.push(new kt(""));break}case"first-child":this.chain.push(new bg);break;case"last-child":this.chain.push(new wc(0,1));break;case"first-of-type":this.chain.push(new vc(0,1));break;case"last-of-type":this.chain.push(new yc(0,1));break;case"only-child":this.chain.push(new bg),this.chain.push(new wc(0,1));break;case"only-of-type":this.chain.push(new vc(0,1)),this.chain.push(new yc(0,1));break;case"empty":this.chain.push(new JE);break;case"before":case"after":case"first-line":case"first-letter":this.pseudoelementSelector(e,t);return;default:this.invalidSelector(`Unknown pseudo-class :${e}`);return}this.specificity+=256}pseudoelementSelector(e,t){switch(e){case"before":case"after":case"first-line":case"first-letter":case"footnote-call":case"footnote-marker":case"inner":case"after-if-continues":if(!this.pseudoelement)this.pseudoelement=e;else{this.invalidSelector(`Double pseudo-element ::${this.pseudoelement}::${e}`);return}break;case"first-n-lines":if(t&&t.length==1&&typeof t[0]=="number"){let n=Math.round(t[0]);if(n>0&&n==t[0]){if(!this.pseudoelement)this.pseudoelement=`first-${n}-lines`;else{this.invalidSelector(`Double pseudo-element ::${this.pseudoelement}::${e}`);return}break}}this.chain.push(new kt(""));break;case"nth-fragment":t&&t.length==2?this.viewConditionId=`NFS_${t[0]}_${t[1]}`:this.chain.push(new kt(""));break;default:this.invalidSelector(`Unknown pseudo-element ::${e}`);return}this.specificity+=1}idSelector(e){this.specificity+=65536,this.chain.push(new WE(e))}attributeSelector(e,t,n,i){this.specificity+=256,t=t.toLowerCase(),i=i||"";let r;switch(n){case 0:r=new xg(e,t);break;case 39:r=new YE(e,t,i);break;case 45:!i||i.match(/\s/)?r=new kt(""):r=new So(e,t,new RegExp(`(^|\\s)${ti(i)}($|\\s)`));break;case 44:r=new So(e,t,new RegExp(`^${ti(i)}($|-)`));break;case 43:i?r=new So(e,t,new RegExp(`^${ti(i)}`)):r=new kt("");break;case 42:i?r=new So(e,t,new RegExp(`${ti(i)}$`)):r=new kt("");break;case 46:i?r=new So(e,t,new RegExp(ti(i))):r=new kt("");break;case 50:if(i=="supported")r=new qE(e,t);else{this.invalidSelector(`Unsupported :: attr selector op: ${i}`);return}break;default:this.invalidSelector(`Unsupported attr selector: ${n}`);return}this.chain.push(r)}descendantSelector(){let e=`d${yl++}`;this.processChain(new wl(new sP(e,this.viewConditionId,null))),this.chain=[new kt(e)],this.viewConditionId=null}childSelector(){let e=`c${yl++}`;this.processChain(new wl(new lP(e,this.viewConditionId,null))),this.chain=[new kt(e)],this.viewConditionId=null}adjacentSiblingSelector(){let e=`a${yl++}`;this.processChain(new wl(new aP(e,this.viewConditionId,null))),this.chain=[new kt(e)],this.viewConditionId=null}followingSiblingSelector(){let e=`f${yl++}`;this.processChain(new wl(new uP(e,this.viewConditionId,null))),this.chain=[new kt(e)],this.viewConditionId=null}nextSelector(){this.finishChain(),this.pseudoelement=null,this.footnoteContent=!1,this.specificity=0,this.chain=[]}startSelectorRule(){this.isInsideSelectorRule("E_CSS_UNEXPECTED_SELECTOR")||(this.state=1,this.elementStyle={},this.pseudoelement=null,this.specificity=0,this.footnoteContent=!1,this.chain=[],this.invalid=!1)}error(e,t){super.error(e,t),this.state==1&&(this.state=0),this.setInvalid()}startStylesheet(e){super.startStylesheet(e),this.state=0}startRuleBody(){this.finishChain(),super.startRuleBody(),this.state==1&&(this.state=0)}endRule(){super.endRule(),this.insideSelectorRule=0}finishChain(){this.chain&&(this.processChain(this.makeApplyRuleAction(this.specificity)),this.chain=null,this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0)}makeApplyRuleAction(e){let t=this.regionId;return this.footnoteContent&&(t?t="xxx-bogus-xxx":t="footnote"),new tp(this.elementStyle,e,this.pseudoelement,t,this.viewConditionId)}special(e,t){let n;this.condition?n=new pc(t,0,this.condition):n=new fe(t,0),p0(this.elementStyle,e).push(n)}property(e,t,n){this.validatorSet.validatePropertyAndHandleShorthand(e,t,n,this)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}simpleProperty(e,t,n){e=="display"&&(t===S.oeb_page_head||t===S.oeb_page_foot)&&(this.simpleProperty("flow-options",new Be([S.exclusive,S._static]),n),this.simpleProperty("flow-into",t,n),t=S.block),Sn("SIMPLE_PROPERTY").forEach(o=>{let s=o({name:e,value:t,important:n});e=s.name,t=s.value,n=s.important});let i=(n?this.getImportantSpecificity():this.getBaseSpecificity())+this.cascade.nextOrder(),r=this.condition?new pc(t,i,this.condition):new fe(t,i);Kn(this.elementStyle,e,r)}finish(){return this.cascade}startFuncWithSelector(e){let t;switch(e){case"is":t=new Ps(this);break;case"not":t=new EP(this);break;case"where":t=new PP(this);break;case"has":t=new NP(this);break}t&&(t.startSelectorRule(),this.owner.pushHandler(t))}},kP={"nth-child":ZE,"nth-of-type":vc,"nth-last-child":wc,"nth-last-of-type":yc},yl=0,Ps=class C0 extends Es{constructor(t){super(t.scope,t.owner,t.condition,t,t.regionId,t.validatorSet,!1),this.parent=t,d(this,"parentChain"),d(this,"chains",[]),d(this,"maxSpecificity",0),d(this,"selectorTexts",[]),this.parentChain=t.chain}nextSelector(){this.chain&&this.chains.push(this.chain),this.maxSpecificity=Math.max(this.maxSpecificity,this.specificity),this.chain=[],this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0}endFuncWithSelector(){this.chain&&this.chains.push(this.chain),this.chains.length>0?(this.maxSpecificity=Math.max(this.maxSpecificity,this.specificity),this.parentChain.push(this.relational()?new oP(this.selectorTexts):this.positive()?new np(this.chains):new rP(this.chains)),this.increasingSpecificity()&&(this.parent.specificity+=this.maxSpecificity)):this.parentChain.push(new kt("")),this.owner.popHandler()}startRuleBody(){this.reportAndSkip("E_CSS_UNEXPECTED_RULE_BODY")}error(t,n){super.error(t,n),this.chain=null,this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0;let i=!1;for(let r=this;r instanceof C0;r=r.parent)if(r.forgiving()){i=!0;break}i||this.owner.popHandler()}pushSelectorText(t){this.chain&&this.relational()&&this.selectorTexts.push(t)}positive(){return!0}increasingSpecificity(){return!0}forgiving(){return!0}relational(){return!1}},EP=class extends Ps{positive(){return!1}forgiving(){return!1}},PP=class extends Ps{increasingSpecificity(){return!1}},NP=class extends Ps{relational(){return!0}},TP=class extends Hs{constructor(e,t){super(e,t,!1)}property(e,t,n){if(this.scope.values[e])this.error(`E_CSS_NAME_REDEFINED ${e}`,this.getCurrentToken());else{let i=e.match(/height|^(top|bottom)$/)?"vh":"vw",r=new $s(this.scope,100,i);this.scope.defineName(e,t.toExpr(this.scope,r))}}},xl=class extends Hs{constructor(e,t,n,i,r,o){super(e,t,!1),this.condition=n,this.elementStyle=i,this.validatorSet=r,this.ruleType=o,d(this,"order"),this.order=0}property(e,t,n){n?se.warn("E_IMPORTANT_NOT_ALLOWED"):this.validatorSet.validatePropertyAndHandleShorthand(e,t,n,this)}invalidPropertyValue(e,t){se.warn("E_INVALID_PROPERTY_VALUE",`${e}:`,t.toString())}unknownProperty(e,t){se.warn("E_INVALID_PROPERTY",`${e}:`,t.toString())}simpleProperty(e,t,n){let i=n?this.getImportantSpecificity():this.getBaseSpecificity();i+=this.order,this.order+=ip;let r=this.condition?new pc(t,i,this.condition):new fe(t,i);Kn(this.elementStyle,e,r)}},IP=class extends Fy{constructor(e,t){super(e),this.validatorSet=t,d(this,"elementStyle",{}),d(this,"order",0)}property(e,t,n){this.validatorSet.validatePropertyAndHandleShorthand(e,t,n,this)}invalidPropertyValue(e,t){se.warn("E_INVALID_PROPERTY_VALUE",`${e}:`,t.toString())}unknownProperty(e,t){se.warn("E_INVALID_PROPERTY",`${e}:`,t.toString())}simpleProperty(e,t,n){let i=n?Ly:Ay;i+=this.order,this.order+=ip;let r=new fe(t,i);Kn(this.elementStyle,e,r)}};function k0(e,t){let n=c0(e);n&&n.forEach(i=>{i.matcher.matches()&&t(i.styles)})}function Sc(e,t,n){k0(n,i=>{Qo(e,i,t)})}function RP(e,t,n,i){let r=new IP(e,t),o=new kn(i,r);try{$k(o,r,n)}catch(s){se.warn(s,"Style attribute parse error:")}return r.elementStyle}function E0(e,t,n){let i=e["writing-mode"];if(i){let r=i.evaluate(t,"writing-mode");if(r&&r!==S.inherit&&r!==S.revert&&r!==S.unset)return r===S.vertical_rl}return n}function P0(e,t,n){let i=e.direction;if(i){let r=i.evaluate(t,"direction");if(r&&r!==S.inherit&&r!==S.revert&&r!==S.unset)return r===S.rtl}return n}function N0(e,t,n,i,r){let o={};for(let s in e)Vr(s)&&(o[s]=pt(e,s));return Sc(o,t,e),T0(e,n,i,(s,l)=>{Qo(o,l,t),Sc(o,t,l)}),o}function T0(e,t,n,i){let r=yn(e,"_regions");if((t||n)&&r){if(n){let o=["footnote"];t?t=t.concat(o):t=o}for(let o of t){let s=r[o];s&&i(o,s)}}}function Qo(e,t,n){for(let i in t)if(Vr(i)){let r=pt(t,i),o=e[i];e[i]=gc(n,o,r)}}var I0=(e,t,n,i,r,o)=>{var s,l;let a=n?i?BE:a0:i?_E:u0,u=r?ME:zE;for(let h in e){let p=e[h];if(!p)continue;let c=(s=a[h])!=null?s:a[u[h]],f=(l=u[h])!=null?l:u[a[h]],v=c??f,w;if(v){let y=e[v];if(y&&y.priority>p.priority||c&&f&&c!==f&&(v=f,y=e[v],y&&y.priority>p.priority))continue;w=wg[c]?c:wg[f]?f:h}else w=h,h.startsWith("text-align")&&(p.value===S.inside||p.value===S.outside)&&(p=new fe(r===(p.value===S.inside)?S.right:S.left,p.priority));t[w]=o(h,p)}},AP=class extends ro{constructor(e,t,n){super(),this.elementStyles=e,this.styler=t,this.element=n}getVarValue(e){var t,n,i,r,o;let s=(t=this.element)!=null?t:this.styler.root;if((n=this.elementStyles)!=null&&n.length){for(let l of this.elementStyles){let a=(i=l[e])==null?void 0:i.value;if(a)return a}this.element&&(s=this.element.parentElement)}for(;s;s=s.parentElement){let l=(o=(r=this.styler.getStyle(s,!1))==null?void 0:r[e])==null?void 0:o.value;if(l)return l}return null}visitFunc(e){if(e.name!=="var")return super.visitFunc(e);let t=e.values[0]instanceof Xt&&e.values[0].name;return!t||!Yn(t)?(this.error=!0,ae):this.getVarValue(t)||(e.values.length<2?(this.error=!0,ae):e.values.length===2?e.values[1]:new Rt(e.values.slice(1)))}},R0=class extends ro{constructor(e,t,n,i){super(),this.context=e,this.resolveViewportUnit=t,this.percentRef=n,this.vertical=i}visitFunc(e){let t=super.visitFunc(e);if(e.name!=="calc")return t;let n=t.toString().replace(/^calc\b/,"-epubx-expr");if(/\d(%|em|ex|cap|ch|ic|lh|p?v[whbi]|p?vmin|p?vmax)\W|\Wvar\(\s*--/i.test(n))return t;let i=so(this.context.rootScope,new kn(n,null),"");if(i instanceof ie)try{let r=i.expr.evaluate(this.context);typeof r=="number"&&!isNaN(r)&&(/\d(px|in|pt|pc|cm|mm|q|rem|rlh)\W/i.test(n)?t=new $(r,"px"):/\d[a-z]/i.test(n)||(t=new Ai(r)))}catch(r){se.warn(r)}return t}visitNumeric(e){return this.resolveViewportUnit&&(jw(e.unit)||yC(e.unit))?new $(e.num*this.context.queryUnitSize(e.unit,!1,this.vertical),"px"):typeof this.percentRef=="number"&&e.unit==="%"?new $(e.num*this.percentRef/100,"px"):e}};function ka(e,t,n,i,r){try{if(t instanceof ie)return t.expr instanceof st&&(t.expr.str.startsWith("named-string-")||t.expr.str.startsWith("running-element-"))?t:Hk(e,t.expr,n);if(t instanceof $||t instanceof oo||t instanceof Be||t instanceof Rt)return t.visit(new R0(e,!0,i,r))}catch(o){return se.warn(o),ae}return t}var Eg={first:!1,forceEnd:!1,allowEnd:!1,last:!1};function Pg(e){let t=e instanceof vt?e:typeof e=="string"?K(e):S.none;if(t===S.none)return Eg;let n=t instanceof Be?t.values:[t],i=Object.create(Eg);for(let r of n)if(r instanceof Xt)switch(r.name){case"first":i.first=!0;break;case"force-end":i.forceEnd=!0,i.allowEnd=!1;break;case"allow-end":i.forceEnd=!1,i.allowEnd=!0;break;case"last":i.last=!0;break}return i}function Ng(e){return!e.first&&!e.last&&!e.forceEnd&&!e.allowEnd}var LP={trimStart:!1,spaceFirst:!1,trimEnd:!1,allowEnd:!1,trimAdjacent:!1},Tg={trimStart:!1,spaceFirst:!1,trimEnd:!1,allowEnd:!0,trimAdjacent:!0},Ig={trimStart:!0,spaceFirst:!1,trimEnd:!0,allowEnd:!1,trimAdjacent:!0};function Rg(e){let t=e instanceof vt?e:typeof e=="string"?K(e):S.normal;if(t===S.normal)return Tg;if(t===S.auto)return Ig;let n=t instanceof Be?t.values:[t],i=Object.create(Tg);for(let r of n)if(r instanceof Xt)switch(r.name){case"trim-both":case"trim-auto":return Ig;case"space-all":return LP;case"trim-start":i.trimStart=!0,i.spaceFirst=!1;break;case"space-start":i.trimStart=!1,i.spaceFirst=!1;break;case"space-first":i.trimStart=!1,i.spaceFirst=!0;break;case"trim-end":i.trimEnd=!0,i.allowEnd=!1;break;case"space-end":i.trimEnd=!1,i.allowEnd=!1;break;case"allow-end":i.trimEnd=!1,i.allowEnd=!0;break;case"trim-adjacent":i.trimAdjacent=!0;break;case"space-adjacent":i.trimAdjacent=!1;break}return i}var Hu={ideographAlpha:!1,ideographNumeric:!1},FP={ideographAlpha:!0,ideographNumeric:!0};function Ag(e){let t=e instanceof vt?e:typeof e=="string"?K(e):S.normal;if(t===S.normal||t===S.auto)return FP;if(t===S.none)return Hu;let n=t instanceof Be?t.values:[t],i=Object.create(Hu);for(let r of n)if(r instanceof Xt)switch(r.name){case"no-autospace":return Hu;case"ideograph-alpha":i.ideographAlpha=!0;break;case"ideograph-numeric":i.ideographNumeric=!0;break}return i}function Lg(e,t){return!e.ideographAlpha&&!e.ideographNumeric&&!t.trimStart&&!t.spaceFirst&&!t.trimEnd&&!t.allowEnd&&!t.trimAdjacent}function Fg(e){return e?(e=e.toLowerCase(),/^zh\b.*-(hant|tw|hk)\b/.test(e)?"zh-hant":/^zh\b/.test(e)?"zh-hans":/^ja\b/.test(e)?"ja":/^ko\b/.test(e)?"ko":e):null}var OP=class{getPolyfilledInheritedProps(){return["hanging-punctuation","text-autospace","text-spacing-trim"]}preprocessSingleDocument(e){e.body&&this.preprocessForTextSpacing(e.body)}preprocessForTextSpacing(e){var t;let n=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT);for(let i=n.nextNode();i;i=n.nextNode()){if(i.parentElement.namespaceURI!=="http://www.w3.org/1999/xhtml"||((t=i.parentElement.dataset)==null?void 0:t.mathTypeset)==="true")continue;let r=i.textContent.replace(new RegExp("(?![()\\[\\]{}])[\\p{Ps}\\p{Pe}\\p{Pf}\\p{Pi}\\u3000]\\p{M}*(?=\\P{M})|.(?=(?![()\\[\\]{}])[\\p{Ps}\\p{Pe}\\p{Pf}\\p{Pi}\\u3000])|(?!\\p{P})[\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF]\\p{M}*(?=(?![\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF\\uFF01-\\uFF60])[\\p{L}\\p{Nd}])|(?![\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF\\uFF01-\\uFF60])[\\p{L}\\p{Nd}]\\p{M}*(?=(?!\\p{P})[\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF])","gsu"),"$&\0").split("\0");if(r.length>1){let o=r.length-1;for(let s=0;s<o;s++)i.parentNode.insertBefore(document.createTextNode(r[s]),i);i.textContent=r[o]}}}processGeneratedContent(e,t,n,i,r,o){r=Fg(r);let s=Ag(t),l=Rg(n),a=Pg(i);if(Ng(a)&&Lg(s,l))return;this.preprocessForTextSpacing(e);let u=e.style.whiteSpace;(o?e.offsetHeight:e.offsetWidth)===0&&(e.style.whiteSpace="pre");let h=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT),p=null,c=null;for(let f=h.nextNode();f;f=c){c=h.nextNode();let v=!p,w=!p||/\n$/.test(p.textContent),y=!c||/^\n/.test(c.textContent),g=!c;this.processTextSpacing(f,v||w,v,w,y,g,p,c,s,l,a,r,o),p=f}e.style.whiteSpace=u}postLayoutBlock(e,t){var n,i,r,o,s,l,a;let u=!e||e.fragmentIndex===1&&c(),h=u||f();function p(w){var y;if((w==null?void 0:w.nodeType)!==1)return!1;let g=w;if(g.hasAttribute(Qr))return!0;let{position:m,float:x}=(y=g.style)!=null?y:{};return m==="absolute"||m==="fixed"||x&&x!=="none"}function c(){let w=t[0];for(let y=w;;y=y.parent)if(!y||!y.inline){if((y==null?void 0:y.fragmentIndex)!==1)return!1;break}if(!w.inline)return!0;for(let y=w.viewNode.previousSibling;y;y=y.previousSibling)if(!lt(y,w.whitespace)&&!p(y))return!1;return!0}function f(){var w,y;let g=t[0],m;for(;g&&g.inline&&(m=(w=g.viewNode)==null?void 0:w.previousSibling,!(m&&(m.nodeType===3&&/^[ \t\r\n\f]*$/.test(m.textContent)&&g.whitespace!==Ot.PRESERVE&&(m=m.previousSibling),m)));)g=g.parent;for(;m;){if(m.nodeType===1){if(m.localName==="br")return!0;let x=(y=m.style)==null?void 0:y.display;if(x&&x!=="inline")return!/^(inline|ruby)\b/.test(x)}else if(m.nodeType===3){if(g.whitespace===Ot.PRESERVE){if(/\n$/.test(m.textContent))return!0}else if(g.whitespace===Ot.NEWLINE&&/\n[ \t\r\n\f]*$/.test(m.textContent))return!0}m=m.lastChild}return!1}let v=-1;for(let w=0;w<t.length;w++){let y=t[w];if(!y.after&&y.inline&&!y.display&&y.parent&&y.viewNode.parentNode&&y.viewNode.nodeType===Node.TEXT_NODE&&!lt(y.viewNode,y.whitespace)){let g=function(R){var k,M,H;if(((k=R.viewNode)==null?void 0:k.nodeType)===1)return R.viewNode.localName==="br";if(((M=R.viewNode)==null?void 0:M.nodeType)===3){if(R.whitespace===Ot.PRESERVE){if(/\n$/.test(R.viewNode.textContent))return!0}else if(R.whitespace===Ot.NEWLINE&&/\n[ \t\r\n\f]*$/.test(R.viewNode.textContent))return!0;if(((H=R.viewNode.previousElementSibling)==null?void 0:H.localName)==="br")return lt(R.viewNode,R.whitespace)}return!1},m=function(R){var k,M,H;if(((k=R.viewNode)==null?void 0:k.nodeType)===1)return R.viewNode.localName==="br";if(((M=R.viewNode)==null?void 0:M.nodeType)===3){if(R.whitespace===Ot.PRESERVE){if(/^\n/.test(R.viewNode.textContent))return!0}else if(R.whitespace===Ot.NEWLINE&&/^[ \t\r\n\f]*\n/.test(R.viewNode.textContent))return!0;if(((H=R.viewNode.nextElementSibling)==null?void 0:H.localName)==="br")return lt(R.viewNode,R.whitespace)}return!1},x=Fg((o=(i=(n=y.lang)!=null?n:y.parent.lang)!=null?i:e==null?void 0:e.lang)!=null?o:(r=e==null?void 0:e.parent)==null?void 0:r.lang),C=Ag(y.inheritedProps["text-autospace"]),N=Rg(y.inheritedProps["text-spacing-trim"]),A=Pg(y.inheritedProps["hanging-punctuation"]);if(Ng(A)&&Lg(C,N)||/\b(flex|grid)\b/.test(y.parent.display))continue;v<0&&(v=w);let L=null,z=null,q=w===v,Q=w===v&&u,D=w===v&&h,Z=!1,b=!1;for(let R=w-1;R>=0;R--){let k=t[R];if(g(k)){D=!0;break}if(!k.display&&k.viewNode.nodeType===Node.TEXT_NODE&&k.viewNode.textContent.length>0){L=k.viewNode;break}if(k.display&&!/^(inline|ruby)\b/.test(k.display)||((s=k.viewNode)==null?void 0:s.nodeType)===1&&(k.viewNode.localName==="br"||Hi[k.viewNode.localName]))break;R===0&&(q=!0,u&&(Q=!0,D=!0))}for(let R=w+1;R<t.length;R++){let k=t[R];if(m(k)){Z=!0;break}if(k.viewNode!==y.viewNode&&!k.display&&k.viewNode.nodeType===Node.TEXT_NODE&&k.viewNode.textContent.length>0){z=k.viewNode;break}if(k.display&&!/^(inline|ruby)\b/.test(k.display)||((l=k.viewNode)==null?void 0:l.nodeType)===1&&(k.viewNode.localName==="br"||Hi[k.viewNode.localName])){R===t.length-1&&p(k.viewNode)&&(b=!0);break}if(R===t.length-1){Z=!0,b=!0;for(let M=k.viewNode.nextSibling;M;M=M.nextSibling)if(!p(M)){b=!1;break}}}if(((a=y.parent)==null?void 0:a.display)==="inline-block"){if(!Q){let R=y.parent.viewNode.firstChild;for(;lt(R,y.whitespace);)R=R.nextSibling;y.viewNode===R&&(Q=!0)}if(!b){let R=y.parent.viewNode.lastChild;for(;lt(R,y.whitespace);)R=R.previousSibling;y.viewNode===R&&(b=!0)}}this.processTextSpacing(y.viewNode,q,Q,D,Z,b,L,z,C,N,A,x,y.vertical)}}}processTextSpacing(e,t,n,i,r,o,s,l,a,u,h,p,c){let f=e.textContent,v=e.ownerDocument,w,y,g;function m(){if(t)return!0;if(!s)return!1;w||(w=v.createRange(),w.selectNode(e));let D=w.getClientRects()[0];y||(y=v.createRange(),y.selectNode(s));let Z=y.getClientRects(),b=Z[Z.length-1];return!D||!b?!1:c?D.top<b.top+b.height-D.width||D.left+D.width<b.left+D.width/10||D.left>b.left+b.width-D.width/10:D.left<b.left+b.width-D.height||D.top>b.top+b.height-D.height/10||D.top+D.height<b.top+D.height/10}function x(){if(!l)return!1;w||(w=v.createRange(),w.selectNode(e));let D=w.getClientRects()[0];g||(g=v.createRange(),g.selectNode(l));let Z=g.getClientRects()[0];return!D||!Z?!1:c?D.top+D.height>Z.top+D.width||D.left>Z.left+Z.width-D.width/10||D.left+D.width<Z.left+D.width/10:D.left+D.width>Z.left+D.height||D.top+D.height<Z.top+D.height/10||D.top>Z.top+Z.height-D.height/10}let C=!1,N=!1,A=!1,L=!1,z;if(n&&h.first&&new RegExp(`^[\\p{Ps}\\p{Pf}\\p{Pi}'"\\u3000]\\p{M}*$`,"u").test(f)?(z="viv-ts-open",C=!0,N=!0):o&&h.last&&new RegExp(`^[\\p{Pe}\\p{Pf}\\p{Pi}'"]\\p{M}*$`,"u").test(f)?(z="viv-ts-close",C=!0,A=!0):(h.forceEnd||h.allowEnd)&&new RegExp("^[]\\p{M}*$","u").test(f)?(z="viv-ts-close",C=!0,L=!0):(u.trimStart||u.spaceFirst||u.trimAdjacent)&&new RegExp("^[]\\p{M}*$","u").test(f)?(z="viv-ts-open",C=!0):(u.trimEnd||u.allowEnd||u.trimAdjacent)&&(new RegExp("^[]\\p{M}*$","u").test(f)||p==="zh-hans"&&new RegExp("^[]\\p{M}*$","u").test(f)||p!=="zh-hant"&&new RegExp("^[]\\p{M}*$","u").test(f))&&(z="viv-ts-close",C=!0),C){let D=function(M){let H=parseFloat(v.defaultView.getComputedStyle(M).fontSize)*.7;return(c?M.offsetHeight:M.offsetWidth)>H},Z=function(){return c?b.offsetLeft:b.offsetTop};if(e.parentElement.localName==="viv-ts-inner")return;let b=v.createElement(z),R=v.createElement("viv-ts-inner");b.appendChild(R),e.parentNode.insertBefore(b,e),R.appendChild(e);let k=D(R);if(k||N||A||L){if(z==="viv-ts-open"){if(N)b.className="viv-hang-first";else if(n||i)u.trimStart?b.className="viv-ts-trim":b.className="viv-ts-space";else if(!(u.trimStart||u.spaceFirst)&&m())b.className="viv-ts-space";else if(u.trimAdjacent&&s&&new RegExp("[\\p{Ps}\\p{Pi}\\p{Pe}\\p{Pf}\\u00B7\\u2027\\u30FB\\u3000]\\p{M}*$","u").test(s.textContent)&&(!new RegExp("[\\p{Pe}\\p{Pf}]\\p{M}*$","u").test(s.textContent)||s.parentElement.localName==="viv-ts-inner"&&D(s.parentElement)))b.className="viv-ts-trim";else if((u.trimStart||u.spaceFirst)&&m()){let M=Z();b.className="viv-ts-auto",M===Z()&&!m()&&(b.className="viv-ts-trim")}}else if(z==="viv-ts-close"){if(A)b.className=k?"viv-hang-last":"viv-hang-last viv-hang-hw";else if(o||r){let M=Z();L?(b.className=k?h.allowEnd&&u.allowEnd?"viv-ts-auto":"viv-hang-end":"viv-hang-end viv-hang-hw",h.allowEnd&&M===Z()&&(u.trimEnd?b.className="viv-ts-trim":u.allowEnd?(b.className="viv-hang-end",M===Z()&&(b.className="")):b.className="viv-ts-space")):u.trimEnd?b.className="viv-ts-trim":u.allowEnd?(b.className="viv-ts-auto",M===Z()&&(b.className="")):b.className="viv-ts-space"}else if(l&&/^[\p{Pe}\p{Pf}\u00B7\u2027\u30FB\u3000]/u.test(l.textContent))k&&u.trimAdjacent&&(b.className="viv-ts-trim");else if(L){let M=x(),H=M&&h.allowEnd;H||(b.className=k?"viv-hang-end":"viv-hang-end viv-hang-hw"),k?H&&u.trimEnd?b.className="viv-ts-auto":!H&&!x()?b.className="":!M&&h.allowEnd&&(u.trimEnd?(b.className="viv-ts-auto",x()||(b.className="viv-hang-end")):(b.className="viv-ts-space",x()||(u.allowEnd?(b.className="viv-ts-auto",x()||(b.className="viv-hang-end")):b.className="viv-hang-end"))):!M&&!x()&&(b.className="")}else if(u.trimEnd||u.allowEnd)if(x())u.allowEnd?b.className="viv-ts-space":b.className="viv-ts-auto";else{let M=Z();b.className="viv-ts-auto",M===Z()&&(b.className="")}}}}function q(D){var Z;let b=(Z=D==null?void 0:D.ownerDocument.defaultView)==null?void 0:Z.getComputedStyle(D);return!!b&&(b.textOrientation==="upright"||b.textCombineUpright==="all"||b["-webkit-text-combine"]==="horizontal")}function Q(D,Z){if(D.nodeType===1){let k=v.defaultView.getComputedStyle(D);if(parseFloat(k.marginInlineEnd)||parseFloat(k.borderInlineEndWidth)||parseFloat(k.paddingInlineEnd))return!0}let b=D.parentElement;if(b&&!b.contains(Z))return Q(b,Z);if(Z.nodeType===1){let k=v.defaultView.getComputedStyle(Z);if(parseFloat(k.marginInlineStart)||parseFloat(k.borderInlineStartWidth)||parseFloat(k.paddingInlineStart))return!0}let R=Z.parentElement;return R&&!R.contains(D)?Q(D,R):!1}(a.ideographAlpha||a.ideographNumeric)&&(s&&new RegExp("^(?!\\p{P})[\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF]","u").test(f)&&(a.ideographAlpha&&new RegExp("(?![\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF\\uFF01-\\uFF60])\\p{L}\\p{M}*$","u").test(s.textContent)||a.ideographNumeric&&new RegExp("(?![\\uFF01-\\uFF60])\\p{Nd}\\p{M}*$","u").test(s.textContent))&&!(c&&q(s.parentElement))&&!Q(s,e)&&e.parentNode.insertBefore(v.createElement("viv-ts-thin-sp"),e),l&&new RegExp("(?!\\p{P})[\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF]\\p{M}*$","u").test(f)&&(a.ideographAlpha&&new RegExp("^(?![\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF\\uFF01-\\uFF60])\\p{L}","u").test(l.textContent)||a.ideographNumeric&&new RegExp("^(?![\\uFF01-\\uFF60])\\p{Nd}","u").test(l.textContent))&&!(c&&q(l.parentElement))&&!Q(e,l)&&e.parentNode.insertBefore(v.createElement("viv-ts-thin-sp"),e.nextSibling))}registerHooks(){hn("POLYFILLED_INHERITED_PROPS",this.getPolyfilledInheritedProps.bind(this)),hn("PREPROCESS_SINGLE_DOCUMENT",this.preprocessSingleDocument.bind(this)),hn("POST_LAYOUT_BLOCK",this.postLayoutBlock.bind(this),!0)}},rp=new OP;rp.registerHooks();function BP(e){rp.preprocessForTextSpacing(e)}function _P(e,t,n,i,r,o){rp.processGeneratedContent(e,t,n,i,r,o)}var Ml=new DOMParser().parseFromString('<root xmlns="http://www.pyroxy.com/ns/shadow"/>',"text/xml"),MP=["footnote-marker","first-5-lines","first-4-lines","first-3-lines","first-2-lines","first-line","first-letter","before","","after"],op="data-adapt-pseudo";function Rr(e){return e.getAttribute(op)||""}function Cc(e,t){e.setAttribute(op,t)}var Og=class{constructor(e,t,n,i,r){this.element=e,this.style=t,this.styler=n,this.context=i,this.exprContentListener=r,d(this,"contentProcessed",{})}getStyle(e,t){let n=Rr(e);this.styler&&n&&n.match(/after$/)&&(this.style=this.styler.getStyle(this.element,!0),this.styler=null);let i=yn(this.style,"_pseudos")[n]||{};if(n.match(/^first-/)&&!i["x-first-pseudo"]){let r=1,o;n=="first-letter"?r=0:(o=n.match(/^first-([0-9]+)-lines$/))!=null&&(r=o[1]-0),i["x-first-pseudo"]=new fe(new nr(r),0)}return i}processContent(e,t,n){let i=Rr(e);if(!this.contentProcessed[i]){this.contentProcessed[i]=!0;let r=t.content;r&&Ni(r)&&(r.visit(new Sa(e,this.context,r,this.exprContentListener)),BP(e))}}};ya.isInstanceOfAfterIfContinuesLayoutConstraint;var zP=Za.registerFragmentIndex;Za.clearFragmentIndices;var $P=class{constructor(e,t){this.sourceNode=e,this.styler=t}createElement(e,t){let n=t.viewNode.ownerDocument.createElement("div"),i=new sp(e,n,t),r=i.getColumn().pageBreakType;return i.getColumn().pageBreakType=null,i.layout(this.createNodePositionForPseudoElement(),!0).thenAsync(()=>{this.styler.contentProcessed["after-if-continues"]=!1,i.getColumn().pageBreakType=r;let o=n.firstChild;return O(o,"display","block"),F(o)})}createNodePositionForPseudoElement(){let e=Ml.createElementNS("http://www.w3.org/1999/xhtml","div");Cc(e,"after-if-continues");let t=this.createShadowContext(e),n={steps:[{node:e,shadowType:t.type,shadowContext:t,nodeShadow:null,shadowSibling:null}],offsetInNode:0,after:!1,preprocessedTextContent:null};return new Pi(n)}createShadowContext(e){return new rc(this.sourceNode,e,null,null,null,qn.ShadowType.ROOTED,this.styler)}},DP=class A0{constructor(t,n,i){this.nodeContext=t,this.afterIfContinues=n,this.pseudoElementHeight=i,d(this,"flagmentLayoutConstraintType","AfterIfContinue")}allowLayout(t,n,i){return!(n&&!t||t&&t.overflow)}nextCandidate(t){return!1}postLayout(t,n,i,r){}finishBreak(t,n){return this.getRepetitiveElements().affectTo(t)?this.afterIfContinues.createElement(n,this.nodeContext).thenAsync(i=>(this.nodeContext.viewNode.appendChild(i),F(!0))):F(!0)}getRepetitiveElements(){return new VP(this.nodeContext,this.pseudoElementHeight)}equalsTo(t){return t instanceof A0?this.afterIfContinues==t.afterIfContinues:!1}getPriorityOfFinishBreak(){return 9}},VP=class{constructor(e,t){this.nodeContext=e,this.pseudoElementHeight=t}calculateOffset(e){return this.affectTo(e)?this.pseudoElementHeight:0}calculateMinimumOffset(e){return this.calculateOffset(e)}affectTo(e){if(!e)return!1;let t=e.shadowContext?e.shadowContext.owner:e.sourceNode;if(t===this.nodeContext.sourceNode)return!!e.after;for(let n=t.parentNode;n;n=n.parentNode)if(n===this.nodeContext.sourceNode)return!0;return!1}};function L0(e,t){if(!e||!e.afterIfContinues||e.after||t.isFloatNodeContext(e))return F(e);let n=e.afterIfContinues;return n.createElement(t,e).thenAsync(i=>{let r=HP(e,t,i);return t.fragmentLayoutConstraints.push(new DP(e,n,r)),F(e)})}function F0(e,t){return e.thenAsync(n=>L0(n,t))}function UP(e,t){let n=X("processAfterIfContinuesOfAncestors"),i=e;return n.loop(()=>{if(i!==null){let r=L0(i,t);return i=i.parent,r.thenReturn(!0)}else return F(!1)}).then(()=>{n.finish(!0)}),n.result()}function HP(e,t,n){let i=e.viewNode;i.appendChild(n);let r=ac(n,t,e.vertical);return i.removeChild(n),r}var WP=class{constructor(e){this.constraints=e}allowLayout(e){return this.constraints.every(t=>t.allowLayout(e))}},zl=class extends Kd{constructor(e,t){super(),this.checkPoints=e,this.penalty=t,d(this,"alreadyEvaluated",!1),d(this,"breakNodeContext",null)}findAcceptableBreak(e,t){return t<this.getMinBreakPenalty()?null:(this.alreadyEvaluated||(this.breakNodeContext=e.findBoxBreakPosition(this,t>0),this.alreadyEvaluated=!!this.breakNodeContext||t>0||!!e.pseudoParent),this.breakNodeContext)}getMinBreakPenalty(){return this.penalty}getNodeContext(){return this.alreadyEvaluated?this.breakNodeContext:this.checkPoints[this.checkPoints.length-1]}},Ea=class extends Qy{constructor(e,t,n,i,r){super(e),this.layoutContext=t,this.clientLayout=n,this.layoutConstraint=i,this.pageFloatLayoutContext=r,d(this,"last"),d(this,"viewDocument"),d(this,"flowRootFormattingContext",null),d(this,"isFloat",!1),d(this,"isFootnote",!1),d(this,"startEdge",0),d(this,"endEdge",0),d(this,"beforeEdge",0),d(this,"afterEdge",0),d(this,"footnoteEdge",0),d(this,"box",null),d(this,"chunkPositions",null),d(this,"bands",null),d(this,"overflown",!1),d(this,"breakPositions",null),d(this,"pageBreakType",null),d(this,"forceNonfitting",!0),d(this,"leftFloatEdge",0),d(this,"rightFloatEdge",0),d(this,"bottommostFloatTop",0),d(this,"stopAtOverflow",!0),d(this,"lastAfterPosition",null),d(this,"fragmentLayoutConstraints",[]),d(this,"pseudoParent",null),d(this,"nodeContextOverflowingDueToRepetitiveElements",null),d(this,"blockDistanceToBlockEndFloats",NaN),d(this,"breakAtTheEdgeBeforeFloat",null),this.last=e.lastChild,this.viewDocument=e.ownerDocument,r.setContainer(this)}getTopEdge(){return this.vertical?this.rtl?this.endEdge:this.startEdge:this.beforeEdge}getBottomEdge(){return this.vertical?this.rtl?this.startEdge:this.endEdge:this.afterEdge}getLeftEdge(){return this.vertical?this.afterEdge:this.rtl?this.endEdge:this.startEdge}getRightEdge(){return this.vertical?this.beforeEdge:this.rtl?this.startEdge:this.endEdge}isFloatNodeContext(e){return!!e.floatSide&&(!this.isFloat||!!e.parent)}stopByOverflow(e){return this.stopAtOverflow&&!!e&&e.overflow}isOverflown(e){return this.vertical?e<this.footnoteEdge:e>this.footnoteEdge}getExclusions(){let e=this.pageFloatLayoutContext.getFloatFragmentExclusions();return this.exclusions.concat(e)}openAllViews(e){let t=X("openAllViews"),n=e.steps;this.layoutContext.setViewRoot(this.element,this.isFootnote);let i=n.length-1,r=null;return t.loop(()=>{for(;i>=0;){let o=r,s=n[i];if(r=ba(s,o),i===n.length-1&&!r.formattingContext&&(r.formattingContext=this.flowRootFormattingContext),i==0&&(r.offsetInNode=this.calculateOffsetInNodeForNodeContext(e),r.after=e.after,r.preprocessedTextContent=e.preprocessedTextContent,r.after))break;let l=this.layoutContext.setCurrent(r,i==0&&r.offsetInNode==0);if(i--,l.isPending())return l}return F(!1)}).then(()=>{t.finish(r)}),t.result()}calculateOffsetInNodeForNodeContext(e){return e.preprocessedTextContent?eE(e.preprocessedTextContent,e.offsetInNode):e.offsetInNode}maybePeelOff(e,t){var n,i;if(e.firstPseudo&&e.inline&&!e.after&&e.firstPseudo.count==0&&e.viewNode.nodeType!=1){let r=e.viewNode.textContent,o=r.match(Vh),s=o?o[0].length:0;if(!o&&((n=e.sourceNode)==null?void 0:n.nodeType)===3&&((i=e.sourceNode.nextSibling)==null?void 0:i.nodeType)===3&&r===e.sourceNode.textContent){let l=r+e.sourceNode.nextSibling.textContent,a=l.match(Vh);if(a){let u=a[0];s=u.length,e.sourceNode.textContent=u,e.viewNode.textContent=u,e.sourceNode.nextSibling.textContent=l.substr(s)}}return this.layoutContext.peelOff(e,s)}return F(e)}buildViewToNextBlockEdge(e,t){let n=!1,i=X("buildViewToNextBlockEdge");return i.loopWithFrame(r=>{var o;e.viewNode&&!Tr(e)&&((o=e.viewNode.parentElement)==null?void 0:o.namespaceURI)==="http://www.w3.org/1999/xhtml"&&t.push(e.copy()),this.maybePeelOff(e,0).then(s=>{let l=s;l!==e&&(e=l,Tr(e)||t.push(e.copy())),this.nextInTree(e).then(a=>{if(e=a,!e){r.breakLoop();return}(n||!this.layoutConstraint.allowLayout(e))&&(n=!0,e=e.modify(),e.overflow=!0),this.isFloatNodeContext(e)&&($r(e.floatReference)||e.floatSide==="footnote")?this.layoutFloatOrFootnote(e).then(u=>{if(e=u,this.pageFloatLayoutContext.isInvalidated()&&(e=null),!e){r.breakLoop();return}r.continueLoop()}):e.inline?r.continueLoop():r.breakLoop()})})}).then(()=>{i.finish(e)}),i.result()}nextInTree(e,t){let n=this.layoutContext.nextInTree(e,t);return F0(n,this)}buildDeepElementView(e){if(!e.viewNode)return F(e);let t=[],n=e.sourceNode,i=X("buildDeepElementView");return i.loopWithFrame(r=>{e.viewNode&&e.inline&&!Tr(e)?t.push(e.copy()):(t.length>0&&this.postLayoutBlock(e,t),t=[]),this.maybePeelOff(e,0).then(o=>{let s=o;if(s!==e){let l=s;for(;l&&l.sourceNode!=n;)l=l.parent;if(l==null){e=s,r.breakLoop();return}Tr(s)||t.push(s.copy())}this.nextInTree(s).then(l=>{e=l,!e||e.sourceNode==n?r.breakLoop():this.layoutConstraint.allowLayout(e)?r.continueLoop():(e=e.modify(),e.overflow=!0,this.stopAtOverflow?r.breakLoop():r.continueLoop())})})}).then(()=>{t.length>0&&this.postLayoutBlock(e,t),i.finish(e)}),i.result()}createFloat(e,t,n,i){let r=this.viewDocument.createElement("div");return this.vertical?(i>=this.height&&(i-=.1),i<1&&(i=0),O(r,"height",`${n}px`),O(r,"width",`${i}px`)):(n>=this.width&&(n-=.1),n<1&&(n=0),O(r,"width",`${n}px`),O(r,"height",`${i}px`)),O(r,"float",t),O(r,"clear",t),this.element.insertBefore(r,e),r}killFloats(){let e=this.element.firstChild;for(;e;){let t=e.nextSibling;if(e.nodeType==1){let n=e,i=n.style.cssFloat;if(i=="left"||i=="right"||i==="none")this.element.removeChild(n);else break}e=t}}createFloats(){let e=this.element.firstChild,t=this.bands,n=this.vertical?this.getTopEdge():this.getLeftEdge(),i=this.vertical?this.getBottomEdge():this.getRightEdge(),r=null;for(let o of t){let s=o.y2-o.y1;o.left=this.createFloat(e,"left",o.x1-n,s),o.right=this.createFloat(e,"right",i-o.x2,s),o.x1<i&&o.x2>n?r=o:r||O(o.right,"float","none")}if(r){let o=t[t.length-1],s=this.vertical?-this.getLeftEdge():this.getBottomEdge();r!==o&&o.y2>=s&&(this.footnoteEdge=this.vertical?-r.y2:r.y2)}}calculateEdge(e,t,n,i){let r;if(e&&Nr(e.viewNode))return NaN;if(e&&e.after&&!e.inline&&(r=pr(e,this.clientLayout,0,this.vertical),!isNaN(r)))return r;e=t[n];let o=i-e.boxOffset;for(;;){if(r=pr(e,this.clientLayout,o,this.vertical),!isNaN(r))return r;if(o>0){o--;continue}if(n--,n<0)return this.beforeEdge;e=t[n],e.viewNode.nodeType!=1&&(o=e.viewNode.textContent.length)}}parseComputedLength(e){let t=e.match(/^(-?[0-9]*(\.[0-9]*)?)px$/);return t?this.clientLayout.adjustLengthValue(parseFloat(t[0])):0}getComputedMargin(e){let t=this.clientLayout.getElementComputedStyle(e),n=new Bu(0,0,0,0);return t&&(n.left=this.parseComputedLength(t.marginLeft),n.top=this.parseComputedLength(t.marginTop),n.right=this.parseComputedLength(t.marginRight),n.bottom=this.parseComputedLength(t.marginBottom)),n}getComputedPaddingBorder(e){let t=this.clientLayout.getElementComputedStyle(e),n=new Bu(0,0,0,0);return t&&(n.left=this.parseComputedLength(t.borderLeftWidth)+this.parseComputedLength(t.paddingLeft),n.top=this.parseComputedLength(t.borderTopWidth)+this.parseComputedLength(t.paddingTop),n.right=this.parseComputedLength(t.borderRightWidth)+this.parseComputedLength(t.paddingRight),n.bottom=this.parseComputedLength(t.borderBottomWidth)+this.parseComputedLength(t.paddingBottom)),n}getComputedInsets(e){let t=this.clientLayout.getElementComputedStyle(e),n=new Bu(0,0,0,0);if(t){if(t.boxSizing=="border-box")return this.getComputedMargin(e);n.left=this.parseComputedLength(t.marginLeft)+this.parseComputedLength(t.borderLeftWidth)+this.parseComputedLength(t.paddingLeft),n.top=this.parseComputedLength(t.marginTop)+this.parseComputedLength(t.borderTopWidth)+this.parseComputedLength(t.paddingTop),n.right=this.parseComputedLength(t.marginRight)+this.parseComputedLength(t.borderRightWidth)+this.parseComputedLength(t.paddingRight),n.bottom=this.parseComputedLength(t.marginBottom)+this.parseComputedLength(t.borderBottomWidth)+this.parseComputedLength(t.paddingBottom)}return n}setComputedInsets(e,t){let n=this.clientLayout.getElementComputedStyle(e);n&&(t.marginLeft=this.parseComputedLength(n.marginLeft),t.borderLeft=this.parseComputedLength(n.borderLeftWidth),t.paddingLeft=this.parseComputedLength(n.paddingLeft),t.marginTop=this.parseComputedLength(n.marginTop),t.borderTop=this.parseComputedLength(n.borderTopWidth),t.paddingTop=this.parseComputedLength(n.paddingTop),t.marginRight=this.parseComputedLength(n.marginRight),t.borderRight=this.parseComputedLength(n.borderRightWidth),t.paddingRight=this.parseComputedLength(n.paddingRight),t.marginBottom=this.parseComputedLength(n.marginBottom),t.borderBottom=this.parseComputedLength(n.borderBottomWidth),t.paddingBottom=this.parseComputedLength(n.paddingBottom))}setComputedWidthAndHeight(e,t){let n=this.clientLayout.getElementComputedStyle(e);n&&(t.width=this.parseComputedLength(n.width),t.height=this.parseComputedLength(n.height))}layoutUnbreakable(e){return this.buildDeepElementView(e)}layoutFloat(e){let t=X("layoutFloat"),n=e.viewNode,i=pg(e.floatSide,e.vertical,e.direction,this.layoutContext.page.side);return O(n,"float","none"),O(n,"display","inline-block"),O(n,"vertical-align","top"),this.buildDeepElementView(e).then(r=>{let o=this.clientLayout.getElementClientRect(n),s=this.getComputedMargin(n),l=new Qt(o.left-s.left,o.top-s.top,o.right+s.right,o.bottom+s.bottom),a=this.rtl?this.endEdge:this.startEdge,u=this.rtl?this.startEdge:this.endEdge,h=e.parent;for(;h&&h.inline;)h=h.parent;if(h){let x=h.viewNode.ownerDocument.createElement("div");x.style.left="0px",x.style.top="0px",this.vertical?(x.style.bottom="0px",x.style.width="1px"):(x.style.right="0px",x.style.height="1px"),h.viewNode.appendChild(x);let C=this.clientLayout.getElementClientRect(x);a=Math.max(this.rtl?this.getEndEdge(C):this.getStartEdge(C),a),u=Math.min(this.rtl?this.getStartEdge(C):this.getEndEdge(C),u),h.viewNode.removeChild(x);let N=this.vertical?l.y2-l.y1:l.x2-l.x1;i=="left"?u=Math.max(u,a+N):a=Math.min(a,u-N),h!==e.parent&&!e.firstPseudo&&(h.viewNode.appendChild(n),n.setAttribute("data-vivliostyle-float-box-moved","true"))}let p=new Qt(a,this.getBoxDir()*this.beforeEdge,u,this.getBoxDir()*this.afterEdge),c=l;this.vertical&&(c=ma(l));let f=this.getBoxDir();if(c.y1<this.bottommostFloatTop*f){let x=c.y2-c.y1;c.y1=this.bottommostFloatTop*f,c.y2=c.y1+x}UC(p,this.bands,c,i),this.vertical&&(l=py(c));let v=this.getComputedInsets(n);O(n,"width",`${l.x2-l.x1-v.left-v.right}px`),O(n,"height",`${l.y2-l.y1-v.top-v.bottom}px`),O(n,"position","absolute"),e.display,O(n,"display",e.display);let w,y=null;if(h&&(h.containingBlockForAbsolute?y=h:y=h.getContainingBlockForAbsolute()),y){let x=y.viewNode.ownerDocument.createElement("div");x.style.position="absolute",y.vertical?x.style.right="0":x.style.left="0",x.style.top="0",y.viewNode.appendChild(x),w=this.clientLayout.getElementClientRect(x),y.viewNode.removeChild(x)}else w={left:this.getLeftEdge()-this.paddingLeft,right:this.getRightEdge()+this.paddingRight,top:this.getTopEdge()-this.paddingTop};(y?y.vertical:this.vertical)?O(n,"right",`${w.right-l.x2}px`):O(n,"left",`${l.x1-w.left}px`),O(n,"top",`${l.y1-w.top}px`),e.clearSpacer&&(e.clearSpacer.parentNode.removeChild(e.clearSpacer),e.clearSpacer=null);let g=this.vertical?l.x1:l.y2,m=this.vertical?l.x2:l.y1;!this.isOverflown(g)||this.breakPositions.length==0?(this.killFloats(),p=new Qt(this.getLeftEdge(),this.getTopEdge(),this.getRightEdge(),this.getBottomEdge()),this.vertical&&(p=ma(p)),HC(p,this.bands,c,null,i),this.createFloats(),i=="left"?this.leftFloatEdge=g:this.rightFloatEdge=g,this.bottommostFloatTop=m,this.updateMaxReachedAfterEdge(g),t.finish(r)):(e=e.modify(),e.overflow=!0,t.finish(e))}),t.result()}setupFloatArea(e,t,n,i,r,o){let s=this.pageFloatLayoutContext,l=s.getContainer(t),a=e.element;l.element.parentNode.appendChild(a),e.isFloat=!0,e.originX=l.originX,e.originY=l.originY,e.vertical=l.vertical,e.rtl=l.rtl,e.marginLeft=e.marginRight=e.marginTop=e.marginBottom=0,e.borderLeft=e.borderRight=e.borderTop=e.borderBottom=0,e.paddingLeft=e.paddingRight=e.paddingTop=e.paddingBottom=0,e.exclusions=(l.exclusions||[]).concat(),e.forceNonfitting=!s.hasFloatFragments(),e.innerShape=null;let u=l.getPaddingRect();e.setHorizontalPosition(u.x1-l.originX,u.x2-u.x1),e.setVerticalPosition(u.y1-l.originY,u.y2-u.y1),r.adjustPageFloatArea(e,l,this),e.init();let h=!!s.setFloatAreaDimensions(e,t,n,i,!0,!s.hasFloatFragments(),o);return h?(e.killFloats(),e.init()):l.element.parentNode.removeChild(a),h}createPageFloatArea(e,t,n,i,r){let o=this.element.ownerDocument.createElement("div");O(o,"position","absolute");let s=this.pageFloatLayoutContext.getPageFloatLayoutContext(e.floatReference),l=new Ao(null,Ke.COLUMN,null,this.pageFloatLayoutContext.flowName,e.nodePosition,null,null),a=s.getContainer(),u=new XP(t,o,this.layoutContext.clone(),this.clientLayout,this.layoutConstraint,l,a);return l.setContainer(u),this.setupFloatArea(u,e.floatReference,t,n,i,r)?u:null}layoutSinglePageFloatFragment(e,t,n,i,r,o,s){let l=this.pageFloatLayoutContext;e=(s?s.continuations:[]).concat(e);let a=e[0].float,u=l.getPageFloatPlacementCondition(a,t,n),h=this.createPageFloatArea(a,t,o,r,u),p={floatArea:h,pageFloatFragment:null,newPosition:null};if(!h)return F(p);let c=X("layoutSinglePageFloatFragment"),f=!1,v=0;return c.loopWithFrame(w=>{if(v>=e.length){w.breakLoop();return}let y=e[v],g=new Pi(y.nodePosition);h.layout(g,!0).then(m=>{p.newPosition=m,!m||i?(v++,w.continueLoop()):(f=!0,w.breakLoop())})}).then(()=>{if(!f){let w=l.setFloatAreaDimensions(h,a.floatReference,t,o,!1,i,u);if(!w)f=!0;else{let y=r.createPageFloatFragment(e,w,h,!!p.newPosition);l.addPageFloatFragment(y,!0),p.pageFloatFragment=y}}c.finish(p)}),c.result()}layoutPageFloatInner(e,t,n,i){let r=this.pageFloatLayoutContext,o=e.float;r.stashEndFloatFragments(o);function s(a,u){u?r.removePageFloatFragment(u,!0):a&&a.element.parentNode.removeChild(a.element),r.restoreStashedFragments(o.floatReference),r.deferPageFloat(e)}let l=X("layoutPageFloatInner");return this.layoutSinglePageFloatFragment([e],o.floatSide,o.clearSide,!r.hasFloatFragments(),t,n,i).then(a=>{let u=a.floatArea,h=a.pageFloatFragment,p=a.newPosition;h?this.layoutStashedPageFloats(o.floatReference,[i]).then(c=>{if(c){if(r.addPageFloatFragment(h),r.discardStashedFragments(o.floatReference),p){let f=new fg(o,p.primary);r.deferPageFloat(f)}l.finish(!0)}else s(u,h),l.finish(!1)}):(s(u,h),l.finish(!1))}),l.result()}layoutStashedPageFloats(e,t){let n=this.pageFloatLayoutContext,i=n.getStashedFloatFragments(e),r=[],o=[],s=!1,l=X("layoutStashedPageFloats"),a=0;return l.loopWithFrame(u=>{if(a>=i.length){u.breakLoop();return}let h=i[a];if(t.includes(h)){a++,u.continueLoop();return}let p=new Zr().findByFloat(h.continuations[0].float);this.layoutSinglePageFloatFragment(h.continuations,h.floatSide,null,!1,p,null).then(c=>{let f=c.floatArea;f&&r.push(f);let v=c.pageFloatFragment;v?(o.push(v),a++,u.continueLoop()):(s=!0,u.breakLoop())})}).then(()=>{s?(o.forEach(u=>{n.removePageFloatFragment(u,!0)}),r.forEach(u=>{let h=u.element;h&&h.parentNode&&h.parentNode.removeChild(h)})):i.forEach(u=>{let h=u.area.element;h&&h.parentNode&&h.parentNode.removeChild(h)}),l.finish(!s)}),l.result()}setFloatAnchorViewNode(e){let t=e.viewNode.parentNode,n=t.ownerDocument.createElement("span");n.setAttribute(Qr,"1"),e.floatSide==="footnote"&&this.layoutContext.applyPseudoelementStyle(e,"footnote-call",n),t.appendChild(n),t.removeChild(e.viewNode);let i=e.modify();return i.after=!0,i.viewNode=n,i}resolveFloatReferenceFromColumnSpan(e,t,n){let i=X("resolveFloatReferenceFromColumnSpan"),r=this.pageFloatLayoutContext,o=r.getPageFloatLayoutContext(Ke.REGION);return r.getContainer().width<o.getContainer().width&&e===Ke.COLUMN?t===S.auto?this.buildDeepElementView(n.copy()).then(s=>{let l=s.viewNode,a=jd(this.clientLayout,l,["min-content inline size"])["min-content inline size"],u=this.getComputedMargin(l);this.vertical?a+=u.top+u.bottom:a+=u.left+u.right,a>this.width?i.finish(Ke.REGION):i.finish(e)}):t===S.all?i.finish(Ke.REGION):i.finish(e):i.finish(e),i.result()}layoutPageFloat(e){let t=this.pageFloatLayoutContext,n=new Zr().findByNodeContext(e),i,r=t.findPageFloatByNodePosition(e.toNodePosition());return r?i=F(r):i=n.createPageFloat(e,t,this),i.thenAsync(o=>{let s=xa(e,0),l=this.setFloatAnchorViewNode(e),a=n.findPageFloatFragment(o,t),u=new fg(o,s);if(a&&a.hasFloat(o))return t.registerPageFloatAnchor(o,l.viewNode),F(l);if(t.isForbidden(o)||t.hasPrecedingFloatsDeferredToNext(o))return t.deferPageFloat(u),t.registerPageFloatAnchor(o,l.viewNode),F(l);if(this.nodeContextOverflowingDueToRepetitiveElements)return F(null);{let h=pr(l,this.clientLayout,0,this.vertical);return this.isOverflown(h)?F(l):this.layoutPageFloatInner(u,n,h,a).thenAsync(p=>p?F(null):(t.registerPageFloatAnchor(o,l.viewNode),F(l)))}})}processLineStyling(e,t,n){let i=X("processLineStyling"),r=n.concat([]);n.splice(0,n.length);let o=0,s=e.firstPseudo;return s.count==0&&(s=s.outer),i.loopWithFrame(l=>{if(!s){l.breakLoop();return}let a=this.findLinePositions(r),u=s.count-o;if(a.length<=u){l.breakLoop();return}let h=this.findAcceptableBreakInside(r,a[u-1],!0);if(h==null){l.breakLoop();return}this.finishBreak(h,!1,!1).then(()=>{o+=u,this.layoutContext.peelOff(h,0).then(p=>{e=p,s=e.firstPseudo,r=[],this.buildViewToNextBlockEdge(e,r).then(c=>{t=c,l.continueLoop()})})})}).then(()=>{Array.prototype.push.apply(n,r),i.finish(t)}),i.result()}isLoneImage(e){return e.length!=2&&this.breakPositions.length>0?!1:e[0].sourceNode==e[1].sourceNode&&Hi[e[0].sourceNode.localName]}getTrailingMarginEdgeAdjustment(e){let t=0,n=0;for(let i=e.length-1;i>=0;i--){let r=e[i];if(!r.after||!r.viewNode||r.viewNode.nodeType!=1)break;let o=this.getComputedMargin(r.viewNode),s=this.vertical?-o.left:o.bottom;s>0?t=Math.max(t,s):n=Math.min(n,s)}return t+n}layoutBreakableBlock(e){let t=X("layoutBreakableBlock"),n=[];return this.buildViewToNextBlockEdge(e,n).then(i=>{let r=n.length-1;if(r<0){t.finish(i);return}this.postLayoutBlock(i,n);let o=this.calculateEdge(i,n,r,n[r].boxOffset),s=!1;if(!i||!Nr(i.viewNode)){let a=Dr(i,this.collectElementsOffset());s=this.isOverflown(o+(this.vertical?-1:1)*a.minimum),this.isOverflown(o+(this.vertical?-1:1)*a.current)&&!this.nodeContextOverflowingDueToRepetitiveElements&&(this.nodeContextOverflowingDueToRepetitiveElements=i)}i==null&&(o+=this.getTrailingMarginEdgeAdjustment(n)),this.updateMaxReachedAfterEdge(o);let l;e.firstPseudo?l=this.processLineStyling(e,i,n):l=F(i),l.then(a=>{n.length>0&&(this.saveBoxBreakPosition(n),s&&!this.isLoneImage(n)&&a&&(a=a.modify(),a.overflow=!0)),t.finish(a)})}),t.result()}postLayoutBlock(e,t){Sn("POST_LAYOUT_BLOCK").forEach(n=>{n(e,t,this)})}findEndOfLine(e,t,n){let i=this.vertical?e-1:e+1,r=0,o=t[0].boxOffset,s=r,l=t.length-1,a=t[l].boxOffset,u;for(;o<a;){u=o+Math.ceil((a-o)/2),s=r;let h=l;for(;s<h;){let c=s+Math.ceil((h-s)/2);t[c].boxOffset>u?h=c-1:s=c}let p=this.calculateEdge(null,t,s,u);if(this.vertical?p<=i:p>=i){for(a=u-1;t[s].boxOffset==u;)s--;l=s}else n&&this.updateMaxReachedAfterEdge(p),o=u,r=s}return{nodeContext:t[s],index:o,checkPointIndex:s}}findAcceptableBreakInside(e,t,n){var i,r,o;let s=this.findEndOfLine(t,e,!0),l=s.nodeContext;if(s.checkPointIndex===0&&s.index===l.boxOffset)return null;let a=l.viewNode;if(a.nodeType!=1&&((i=a.parentElement)==null?void 0:i.localName)!=="viv-ts-inner"){let u=a;l=this.resolveTextNodeBreaker(l).breakTextNode(u,l,s.index,e,s.checkPointIndex,n)}else{let u=vg(l);if(u){if(((r=this.breakPositions)==null?void 0:r[0])instanceof zl&&u!=null&&u.viewNode.contains(this.breakPositions[0].checkPoints[0].viewNode))return null;for(l=u;!l.after&&l.inline&&l.parent;){let h=(o=l.viewNode)==null?void 0:o.previousSibling;for(;h&&(lt(h,l.parent.whitespace)||Lo(h));)h=h.previousSibling;if(h)break;l=l.parent}}}return this.clearOverflownViewNodes(l,!1),l}resolveTextNodeBreaker(e){return Sn("RESOLVE_TEXT_NODE_BREAKER").reduce((t,n)=>n(e)||t,Pa.instance)}getRangeBoxes(e,t){let n=[],i=e.ownerDocument.createRange(),r=!1,o=e,s=null,l=!1,a=!0;for(;a;){let u=!0;do{let h=null;o==t&&(t.nodeType===1?a=!(!t.firstChild||r):a=!1);let p=o.nodeType===1?o:null;p?r?r=!1:qd(p)?u=!l:!p.firstChild||Hi[p.localName]||/^r(uby|[bt]c?)$/.test(p.localName)||EE(this.clientLayout.getElementComputedStyle(p).display)?(u=!l,u?(p.localName==="ruby"&&o.firstChild&&(o=o.firstChild),i.setStartBefore(o),l=!0,s=o):/^r(uby|tc?)$/.test(p.localName)||(s=o),o.contains(t)&&(a=!1)):h=o.firstChild:(l||(o.parentNode==null?a=!1:(i.setStartBefore(o),l=!0)),s=o),h||(h=o.nextSibling,h||(r=!0,h=o.parentNode)),o=h}while(u&&a);if(l){i.setEndAfter(s);let h=this.clientLayout.getRangeClientRects(i);for(let p=0;p<h.length;p++)n.push(h[p]);l=!1}}return n}findLinePositions(e){let t=[],n=this.getRangeBoxes(e[0].viewNode,e[e.length-1].viewNode);n.sort(this.vertical?uE:aE);let i=0,r=0,o=0,s=0,l=0,a=this.getBoxDir();for(;;){if(l<n.length){let u=n[l],h=1;if(s>0){let p=Math.max(this.getBoxSize(u),1);a*this.getBeforeEdge(u)<a*i?h=a*(this.getAfterEdge(u)-i)/p:a*this.getAfterEdge(u)>a*r?h=a*(r-this.getBeforeEdge(u))/p:h=1}if(s==0||h>=.6||h>=.2&&this.getStartEdge(u)>=o-1){o=this.getEndEdge(u),this.vertical?(i=s==0?u.right:Math.max(i,u.right),r=s==0?u.left:Math.min(r,u.left)):(i=s==0?u.top:Math.min(i,u.top),r=s==0?u.bottom:Math.max(r,u.bottom)),s++,l++;continue}}if(s>0&&(t.push(r),s=0),l>=n.length)break}return t.sort($w),this.vertical&&t.reverse(),t}calculateClonedPaddingBorder(e){let t=0;for(let n=e;n;n=n.parent)if(!n.inline&&To(n.viewNode)){let i=this.getComputedPaddingBorder(n.viewNode);t+=n.vertical?-i.left:i.bottom,n.display==="table"&&(t+=(n.vertical?-1:1)*n.blockBorderSpacing)}return t}getOffsetByRepetitiveElements(e){let t;return e?t=e.calculateOffset(this):t=Dr(null,this.collectElementsOffset()),t.current}findBoxBreakPosition(e,t){let n=this.element.parentNode,i=this.element.nextSibling;n.removeChild(this.element),n.insertBefore(this.element,i);let r=e.checkPoints,o=r[0];for(;o.parent&&o.inline;)o=o.parent;let s,l;t?(s=1,l=1):(s=Math.max((o.inheritedProps.widows||2)-0,1),l=Math.max((o.inheritedProps.orphans||2)-0,1));let a=this.calculateClonedPaddingBorder(o),u=this.findLinePositions(r),h=this.footnoteEdge-a,p=this.getBoxDir(),c=this.getOffsetByRepetitiveElements(e);h-=p*c;let f=this.findFirstOverflowingEdgeAndCheckPoint(r);isNaN(f.edge)&&(f.edge=p*(1/0));let v=Ci(u.length,m=>{let x=u[m];return this.vertical?x<h||x<=f.edge:x>h||x>=f.edge}),w=v<=0;w&&(v=Ci(u.length,m=>this.vertical?u[m]<h:u[m]>h));let y=r[r.length-1].viewNode;if((y==null?void 0:y.parentElement.localName)==="viv-ts-inner"&&(y=y.parentElement.parentElement),(v===u.length&&y.nextSibling||v>=u.length-1&&y.parentElement.querySelector(".MJXc-display"))&&(s=0),v=Math.min(u.length-s,v),v<l)return null;h=u[v-1];let g;if(w?g=f.checkPoint:g=this.findAcceptableBreakInside(e.checkPoints,h,t),g){let m=this.getAfterEdgeOfBlockContainer(g);!isNaN(m)&&p*(h-m)>0&&(h=m),this.computedBlockSize=p*(h-this.beforeEdge)+c}return g}getAfterEdgeOfBlockContainer(e){let t=e;do t=t.parent;while(t&&t.inline);return t?(t=t.copy().modify(),t.after=!0,pr(t,this.clientLayout,0,this.vertical)):NaN}findFirstOverflowingEdgeAndCheckPoint(e){let t=e.findIndex(i=>i.overflow);if(t<0)return{edge:NaN,checkPoint:null};let n=e[t];return{edge:this.calculateEdge(null,e,t,n.boxOffset),checkPoint:n}}findEdgeBreakPosition(e){return this.computedBlockSize=e.computedBlockSize+this.getOffsetByRepetitiveElements(e),e.position}finishBreak(e,t,n){e.formattingContext;let i=new bo().find(e.formattingContext).finishBreak(this,e,t,n);return i||(i=Zd.finishBreak(this,e,t,n)),i}findAcceptableBreakPosition(){let e=null,t=null,n=0,i=0;do{n=i,i=Number.MAX_VALUE;for(let r=this.breakPositions.length-1;r>=0&&!t;--r){e=this.breakPositions[r],t=e.findAcceptableBreak(this,n);let o=e.getMinBreakPenalty();o>n&&(i=Math.min(i,o))}}while(i>n&&!t&&this.forceNonfitting);return{breakPosition:t?e:null,nodeContext:t}}doFinishBreak(e,t,n,i){if(this.pageFloatLayoutContext.isInvalidated()||this.pageBreakType||!t)return F(e);let r=X("doFinishBreak"),o=!1;if(!e){if(this.forceNonfitting)return se.warn("Could not find any page breaks?!!"),this.skipTailEdges(t).then(s=>{s?(s=s.modify(),s.overflow=!1,this.finishBreak(s,o,!0).then(()=>{r.finish(s)})):r.finish(s)}),r.result();e=n,o=!0,this.computedBlockSize=i}return this.finishBreak(e,o,!0).then(()=>{r.finish(e)}),r.result()}isBreakable(e){for(let t=e;t;t=t.parent)if(Lo(t.viewNode))return!1;if(e.after)return!0;switch(e.sourceNode.namespaceURI){case"http://www.w3.org/2000/svg":return!1}return!e.flexContainer}zeroIndent(e){let t=e.toString();return t==""||t=="auto"||!!t.match(/^0+(.0*)?[^0-9]/)}checkOverflowAndSaveEdge(e,t){if(!e)return!1;for(let o=e;o;o=o.parent)if(Lo(o.viewNode))return!1;if(Nr(e.viewNode))return!1;let n=pr(e,this.clientLayout,0,this.vertical),i=Dr(e,this.collectElementsOffset()),r=this.isOverflown(n+(this.vertical?-1:1)*i.minimum);if(this.isOverflown(n+(this.vertical?-1:1)*i.current)&&!this.nodeContextOverflowingDueToRepetitiveElements)this.nodeContextOverflowingDueToRepetitiveElements=e;else if(t){let o=n+this.getTrailingMarginEdgeAdjustment(t),s=this.footnoteEdge-this.getBoxDir()*i.current;n=this.vertical?Math.min(n,Math.max(o,s)):Math.max(n,Math.min(o,s))}return this.updateMaxReachedAfterEdge(n),r}checkOverflowAndSaveEdgeAndBreakPosition(e,t,n,i){if(!e||Nr(e.viewNode))return!1;let r=this.checkOverflowAndSaveEdge(e,t);return(n||!r)&&this.saveEdgeBreakPosition(e,i,r),r}applyClearance(e){if(!e.viewNode.parentNode)return!1;let t=this.getComputedMargin(e.viewNode),n=e.viewNode.ownerDocument.createElement("div");this.vertical?(n.style.bottom="0px",n.style.width="1px",n.style.marginRight=`${t.right}px`):(n.style.right="0px",n.style.height="1px",n.style.marginTop=`${t.top}px`),e.viewNode.parentNode.insertBefore(n,e.viewNode);let i=this.clientLayout.getElementClientRect(n),r=this.getBeforeEdge(i),o=this.getBoxDir(),s=e.clearSide,l=-this.getBoxDir()*(1/0);switch(s==="all"&&(l=this.pageFloatLayoutContext.getPageFloatClearEdge(s,this)),/^(top|bottom|inside|outside|(block|inline)-(start|end))$/.test(s)?pg(s,e.vertical,e.direction,this.layoutContext.page.side):s){case"left":l=o*Math.max(l*o,this.leftFloatEdge*o);break;case"right":l=o*Math.max(l*o,this.rightFloatEdge*o);break;default:l=o*Math.max(l*o,Math.max(this.rightFloatEdge*o,this.leftFloatEdge*o))}if(r*o>=l*o)return e.viewNode.parentNode.removeChild(n),!1;{let a=Math.max(1,(l-r)*o);this.vertical?n.style.width=`${a}px`:n.style.height=`${a}px`,i=this.clientLayout.getElementClientRect(n);let u=this.getAfterEdge(i);if(!e.floatSide)if(this.vertical){let h=u+t.right-l;h>0==t.right>=0&&(h+=t.right),n.style.marginLeft=`${h}px`}else{let h=l-(u+t.top);h>0==t.top>=0&&(h+=t.top),n.style.marginBottom=`${h}px`}return e.clearSpacer=n,!0}}isBFC(e){return!!(PE(e)||Xi.isInstanceOfRepetitiveElementsOwnerFormattingContext(e))}skipEdges(e,t,n){var i;let r=e.after?(i=e.parent)==null?void 0:i.formattingContext:e.formattingContext;if(r&&!this.isBFC(r))return F(e);let o=X("skipEdges"),s=!n&&t&&e&&e.after,l=n,a=null,u=[],h=[],p=!1;function c(){return!!n||!t&&Ft(l)&&!f()}function f(){var w;if(!a||e.floatSide)return!1;for(let y=a;y!=null&&y.parent;y=y.parent){let g=y.after?y.viewNode:(w=y.viewNode)==null?void 0:w.previousSibling;for(;g&&(lt(g,y.parent.whitespace)||Lo(g));)g=g.previousSibling;if(g)return!1}return!0}let v=()=>{e=u[0]||e,e.viewNode.parentNode.removeChild(e.viewNode),this.pageBreakType=l};return o.loopWithFrame(w=>{for(var y;e;){e.formattingContext;let g=new bo().find(e.formattingContext);do{if(!e.viewNode)break;if(e.inline&&e.viewNode.nodeType!=1){if(lt(e.viewNode,e.whitespace))break;if(!e.after){c()?v():this.checkOverflowAndSaveEdgeAndBreakPosition(a,null,!0,l)?(e=(this.stopAtOverflow&&a||e).modify(),e.overflow=!0):(e=e.modify(),e.breakBefore=l),w.breakLoop();return}}if(!e.after){if(e.floatSide&&(this.breakAtTheEdgeBeforeFloat=wa(l)?l:null),g&&g.startNonInlineElementNode(e))break;if(e.clearSide&&this.applyClearance(e)&&t&&this.breakPositions.length===0&&this.saveEdgeBreakPosition(e.copy(),l,!1),!e.inline&&!e.repeatOnBreak&&(a?vg(a):this.breakPositions[this.breakPositions.length-1]instanceof zl)&&this.saveEdgeBreakPosition(e.copy(),l,!1),!this.isBFC(e.formattingContext)||Xi.isInstanceOfRepetitiveElementsOwnerFormattingContext(e.formattingContext)||this.isFloatNodeContext(e)||e.flexContainer||!e.nodeShadow&&!e.sourceNode.firstElementChild&&lt(e.sourceNode.firstChild,e.whitespace)){u.push(e.copy()),l=Tt(l,e.breakBefore),c()?v():(this.checkOverflowAndSaveEdgeAndBreakPosition(a,null,!0,l)||!this.layoutConstraint.allowLayout(e))&&(e=(this.stopAtOverflow&&a||e).modify(),e.overflow=!0),w.breakLoop();return}}if(e.viewNode.nodeType!=1)break;let x=e.viewNode.style;if(e.after){e.floatSide&&(l=l??this.breakAtTheEdgeBeforeFloat,this.breakAtTheEdgeBeforeFloat=null);let C=e.sourceNode;if(C.localName==="svg"||C.localName==="math"||C.getAttribute("data-math-typeset")==="true"){p=!1,a=e.copy(),h.push(a),l=Tt(null,e.breakAfter),this.checkOverflowAndSaveEdgeAndBreakPosition(a,null,!this.stopAtOverflow,l);break}if(e.inline||g&&g.afterNonInlineElementNode(e,this.stopAtOverflow))break;if(p){if(c()){v(),w.breakLoop();return}u=[],t=!1,s=!1,l=null}p=!1,a=e.copy(),h.push(a),l=Tt(l,e.breakAfter),x&&!(this.zeroIndent(x.paddingBottom)&&this.zeroIndent(x.borderBottomWidth))&&(h=[a])}else{if(u.push(e.copy()),l=Tt(l,e.breakBefore),(e.pageType!=((y=e.parent)==null?void 0:y.pageType)||!Ft(l))&&!this.layoutConstraint.allowLayout(e)&&(this.checkOverflowAndSaveEdgeAndBreakPosition(a,null,!this.stopAtOverflow,l),e=e.modify(),e.overflow=!0,this.stopAtOverflow)){w.breakLoop();return}let C=e.viewNode.localName;if(Hi[C]){c()?v():this.checkOverflowAndSaveEdgeAndBreakPosition(a,null,!0,l)&&(e=(this.stopAtOverflow&&a||e).modify(),e.overflow=!0),w.breakLoop();return}x&&!(this.zeroIndent(x.paddingTop)&&this.zeroIndent(x.borderTopWidth))&&(s=!1,h=[]),p=!0}}while(!1);let m=this.nextInTree(e,s);if(m.isPending()){m.then(x=>{e=x,w.continueLoop()});return}else e=m.get()}this.checkOverflowAndSaveEdgeAndBreakPosition(a,h,!this.stopAtOverflow,l)?a&&this.stopAtOverflow&&(e=a.modify(),e.overflow=!0):Ft(l)&&(this.pageBreakType=l),w.breakLoop()}).then(()=>{a&&(this.lastAfterPosition=a.toNodePosition()),o.finish(e)}),o.result()}skipTailEdges(e){let t=e.copy(),n=X("skipEdges"),i=null,r=!1;return n.loopWithFrame(o=>{for(;e;){do{if(!e.viewNode)break;if(e.inline&&e.viewNode.nodeType!=1){if(lt(e.viewNode,e.whitespace))break;if(!e.after){Ft(i)&&(this.pageBreakType=i),o.breakLoop();return}}if(!e.after&&(this.isFloatNodeContext(e)||e.flexContainer)){i=Tt(i,e.breakBefore),Ft(i)&&(this.pageBreakType=i),o.breakLoop();return}if(e.viewNode.nodeType!=1)break;let l=e.viewNode.style;if(e.after){if(r){if(Ft(i)){this.pageBreakType=i,o.breakLoop();return}i=null}r=!1,i=Tt(i,e.breakAfter)}else{i=Tt(i,e.breakBefore);let a=e.viewNode.localName;if(Hi[a]){Ft(i)&&(this.pageBreakType=i),o.breakLoop();return}if(l&&!(this.zeroIndent(l.paddingTop)&&this.zeroIndent(l.borderTopWidth))){o.breakLoop();return}}r=!0}while(!1);let s=this.layoutContext.nextInTree(e);if(s.isPending()){s.then(l=>{e=l,o.continueLoop()});return}else e=s.get()}t=null,o.breakLoop()}).then(()=>{n.finish(t)}),n.result()}layoutFloatOrFootnote(e){return $r(e.floatReference)||e.floatSide==="footnote"?this.layoutPageFloat(e):this.layoutFloat(e)}layoutNext(e,t,n){let i=X("layoutNext");return this.skipEdges(e,t,n||null).then(r=>{if(e=r,!e||this.pageBreakType||this.stopByOverflow(e))i.finish(e);else{let o=e.formattingContext;new bo().find(o).layout(e,this,t).thenFinish(i)}}),i.result()}clearOverflownViewNodes(e,t){if(e)for(let n=e.parent;e;e=n,n=n?n.parent:null){let i=(n||e).formattingContext;new bo().find(i).clearOverflownViewNodes(this,n,e,t),t=!1}}initGeom(){let e=this.element.ownerDocument.createElement("div");e.style.position="absolute",e.style.top=`${this.paddingTop}px`,e.style.right=`${this.paddingRight}px`,e.style.bottom=`${this.paddingBottom}px`,e.style.left=`${this.paddingLeft}px`,this.element.appendChild(e);let t=this.clientLayout.getElementClientRect(e);this.element.removeChild(e);let n=this.originX+this.left+this.getInsetLeft(),i=this.originY+this.top+this.getInsetTop();this.box=new Qt(n,i,n+this.width,i+this.height),this.startEdge=t?this.vertical?this.rtl?t.bottom:t.top:this.rtl?t.right:t.left:0,this.endEdge=t?this.vertical?this.rtl?t.top:t.bottom:this.rtl?t.left:t.right:0,this.beforeEdge=t?this.vertical?t.right:t.top:0,this.afterEdge=t?this.vertical?t.left:t.bottom:0,this.leftFloatEdge=this.beforeEdge,this.rightFloatEdge=this.beforeEdge,this.bottommostFloatTop=this.beforeEdge,this.footnoteEdge=this.afterEdge,this.bands=$C(this.box,[this.getInnerShape()],this.getExclusions(),8,this.snapHeight,this.vertical),this.createFloats()}init(){this.chunkPositions=[],O(this.element,"width",`${this.width}px`),O(this.element,"height",`${this.height}px`),this.initGeom(),this.computedBlockSize=0,this.overflown=!1,this.pageBreakType=null,this.lastAfterPosition=null}saveEdgeBreakPosition(e,t,n){e.formattingContext;let i=e.copy(),r=new bo().find(e.formattingContext),o=this.calculateClonedPaddingBorder(i),s=r.createEdgeBreakPosition(i,t,n,this.computedBlockSize+o);this.breakPositions.push(s)}saveBoxBreakPosition(e){let t=e[0].breakPenalty;if(t){let i=e[0];for(;i.parent&&i.inline;)i=i.parent;t=i.breakPenalty}let n=new zl(e,t);this.breakPositions.push(n)}updateMaxReachedAfterEdge(e){if(!isNaN(e)){let t=this.getBoxDir()*(e-this.beforeEdge);this.computedBlockSize=Math.max(t,this.computedBlockSize)}}layout(e,t,n){if(this.chunkPositions.push(e),e.primary.after&&(this.lastAfterPosition=e.primary),this.stopAtOverflow&&this.overflown)return F(e);if(this.isFullWithPageFloats())return e.primary.after&&e.primary.steps.length===1?F(null):F(e);let i=X("layout");return this.openAllViews(e.primary).then(r=>{let o=null;if(r.viewNode)o=r.copy();else{let l=a=>{a.nodeContext.viewNode&&(o=a.nodeContext,this.layoutContext.removeEventListener("nextInTree",l))};this.layoutContext.addEventListener("nextInTree",l)}let s=new GP(t,n);s.layout(r,this).then(l=>{this.doFinishBreak(l,s.context.overflownNodeContext,o,s.initialComputedBlockSize).then(a=>{let u=null;this.pseudoParent?u=F(null):u=this.doFinishBreakOfFragmentLayoutConstraints(a),u.then(()=>{if(this.pageFloatLayoutContext.isInvalidated()){i.finish(null);return}if(!a)i.finish(null);else{this.overflown=!0;let h=new Pi(a.toNodePosition());i.finish(h)}})})})}),i.result()}isFullWithPageFloats(){return this.pageFloatLayoutContext.isColumnFullWithPageFloats(this)}getMaxBlockSizeOfPageFloats(){return this.pageFloatLayoutContext.getMaxBlockSizeOfPageFloats()}doFinishBreakOfFragmentLayoutConstraints(e){let t=X("doFinishBreakOfFragmentLayoutConstraints"),n=[].concat(this.fragmentLayoutConstraints);n.sort((r,o)=>r.getPriorityOfFinishBreak()-o.getPriorityOfFinishBreak());let i=0;return t.loop(()=>i<n.length?n[i++].finishBreak(e,this).thenReturn(!0):F(!1)).then(()=>{t.finish(!0)}),t.result()}doLayout(e,t,n){let i=X("doLayout"),r=null;return this.breakPositions=[],this.nodeContextOverflowingDueToRepetitiveElements=null,i.loopWithFrame(o=>{for(;e;){let s=!0;if(this.layoutNext(e,t,n||null).then(l=>{if(t=!1,n=null,this.nodeContextOverflowingDueToRepetitiveElements&&this.stopAtOverflow?(this.pageBreakType=null,e=this.nodeContextOverflowingDueToRepetitiveElements,e.overflow=!0):e=l,this.pageFloatLayoutContext.isInvalidated())o.breakLoop();else if(this.pageBreakType)o.breakLoop();else if(e&&this.stopByOverflow(e)){r=e;let a=this.findAcceptableBreakPosition();e=a.nodeContext,a.breakPosition&&a.breakPosition.breakPositionChosen(this),o.breakLoop()}else s?s=!1:o.continueLoop()}),s){s=!1;return}}this.computedBlockSize+=this.getOffsetByRepetitiveElements(),o.breakLoop()}).then(()=>{i.finish({nodeContext:e,overflownNodeContext:r})}),i.result()}redoLayout(){let e=this.chunkPositions,t=this.element.lastChild;for(;t!=this.last;){let s=t.previousSibling;this.element===t.parentNode&&this.layoutContext.isPseudoelement(t)||this.element.removeChild(t),t=s}this.killFloats(),this.init();let n=X("redoLayout"),i=0,r=null,o=!0;return n.loopWithFrame(s=>{if(i<e.length){let l=e[i++];this.layout(l,o).then(a=>{o=!1,a?(r=a,s.breakLoop()):s.continueLoop()});return}s.breakLoop()}).then(()=>{n.finish(r)}),n.result()}saveDistanceToBlockEndFloats(){let e=this.pageFloatLayoutContext.getBlockStartEdgeOfBlockEndFloats();e>0&&isFinite(e)&&(this.blockDistanceToBlockEndFloats=this.getBoxDir()*(e-this.beforeEdge-this.computedBlockSize))}collectElementsOffset(){let e=[];for(let t=this;t;t=t.pseudoParent)t.fragmentLayoutConstraints.forEach(n=>{if(Xi.isInstanceOfRepetitiveElementsOwnerLayoutConstraint(n)){let i=n.getRepetitiveElements();e.push(i)}if(ya.isInstanceOfAfterIfContinuesLayoutConstraint(n)){let i=n.getRepetitiveElements();e.push(i)}ki.isInstanceOfTableRowLayoutConstraint(n)&&n.getElementsOffsetsForTableCell(this).forEach(i=>{e.push(i)})});return e}},sp=class{constructor(e,t,n){d(this,"startNodeContexts",[]),d(this,"column"),this.column=Object.create(e),this.column.element=t,this.column.layoutContext=e.layoutContext.clone(),this.column.stopAtOverflow=!1,this.column.flowRootFormattingContext=n.formattingContext,this.column.pseudoParent=e;let i=this.column.calculateClonedPaddingBorder(n);this.column.footnoteEdge=this.column.footnoteEdge-i;let r=this;this.column.openAllViews=function(o){return Ea.prototype.openAllViews.call(this,o).thenAsync(s=>(r.startNodeContexts.push(s.copy()),F(s)))}}layout(e,t){return this.column.layout(e,t)}findAcceptableBreakPosition(e){let t=this.column.findAcceptableBreakPosition();if(e){let n=this.startNodeContexts[0].copy(),i=new Gs(n,null,n.overflow,0);if(i.findAcceptableBreak(this.column,0),!t.nodeContext)return{breakPosition:i,nodeContext:n}}return t}finishBreak(e,t,n){return this.column.finishBreak(e,t,n)}doFinishBreakOfFragmentLayoutConstraints(e){this.column.doFinishBreakOfFragmentLayoutConstraints(e)}isStartNodeContext(e){let t=this.startNodeContexts[0];return t.viewNode===e.viewNode&&t.after===e.after&&t.offsetInNode===e.offsetInNode}isLastAfterNodeContext(e){return Ei(e.toNodePosition(),this.column.lastAfterPosition)}getColumnElement(){return this.column.element}getColumn(){return this.column}},Pa=class{breakTextNode(e,t,n,i,r,o){if(t.after)t.offsetInNode=e.length;else{let s=n-t.boxOffset,l=e.data;l.charCodeAt(s)==173?s=this.breakAfterSoftHyphen(e,l,s,t):s=this.breakAfterOtherCharacter(e,l,s,t),s>0&&(t=this.updateNodeContext(t,s,e))}return t}breakAfterSoftHyphen(e,t,n,i){let r=new RegExp("[\\u0620\\u0626\\u0628\\u062A-\\u062E\\u0633-\\u0647\\u0649\\u064A\\u066E\\u066F\\u0678-\\u0687\\u069A-\\u06BF\\u06C1\\u06C2\\u06CC\\u06CE\\u06D0\\u06D1\\u06FA-\\u06FC\\u06FF\\u0712-\\u0714\\u071A-\\u071D\\u071F-\\u0727\\u0729\\u072B\\u072D\\u072E\\u074E-\\u0758\\u075C-\\u076A\\u076D-\\u0770\\u0772\\u0775-\\u0777\\u077A-\\u077F\\u07CA-\\u07EA\\u07FA\\u0841-\\u0845\\u0848\\u084A-\\u0853\\u0855\\u0860\\u0862-\\u0865\\u0868\\u0883-\\u0886\\u0889-\\u088D\\u08A0-\\u08A9\\u08AF\\u08B0\\u08B3-\\u08B8\\u08BA-\\u08C8\\u1807\\u180A\\u1820-\\u1878\\u1887-\\u18A8\\u18AA\\u200D\\uA840-\\uA871\\u{10AC0}-\\u{10AC4}\\u{10AD3}-\\u{10AD6}\\u{10AD8}-\\u{10ADC}\\u{10ADE}-\\u{10AE0}\\u{10AEB}-\\u{10AEE}\\u{10B80}\\u{10B82}\\u{10B86}-\\u{10B88}\\u{10B8A}\\u{10B8B}\\u{10B8D}\\u{10B90}\\u{10BAD}\\u{10BAE}\\u{10D01}-\\u{10D21}\\u{10D23}\\u{10EC3}\\u{10EC4}\\u{10F30}-\\u{10F32}\\u{10F34}-\\u{10F44}\\u{10F51}-\\u{10F53}\\u{10F70}-\\u{10F73}\\u{10F76}-\\u{10F81}\\u{10FB0}\\u{10FB2}\\u{10FB3}\\u{10FB8}\\u{10FBB}\\u{10FBC}\\u{10FBE}\\u{10FBF}\\u{10FC1}\\u{10FC4}\\u{10FCA}\\u{1E900}-\\u{1E943}]\\p{Mn}*$","u").test(t.slice(0,n))?"":"";if(e.replaceData(n,t.length-n,i.breakWord?"":r+Bg(i)),r){let o=i.preprocessedTextContent[0][1];i.preprocessedTextContent[0][1]=o.slice(0,n+1)+r+o.slice(n+1)}return n+1}breakAfterOtherCharacter(e,t,n,i){let r=t.charAt(n);n++;let o=t.charAt(n);return e.replaceData(n,t.length-n,!i.breakWord&&Vf(r)&&Vf(o)?Bg(i):""),n}updateNodeContext(e,t,n){return e=e.modify(),e.offsetInNode+=t,e.breakBefore=null,e}};d(Pa,"instance");Pa.instance=new Pa;function Bg(e){return e.hyphenateCharacter||e.parent&&e.parent.hyphenateCharacter||"-"}var GP=class extends Jd{constructor(e,t){super(),this.leadingEdge=e,d(this,"breakAfter"),d(this,"initialPageBreakType",null),d(this,"initialComputedBlockSize",0),d(this,"initialOverflown",!1),d(this,"context",{overflownNodeContext:null}),this.breakAfter=t||null}resolveLayoutMode(e){return new jP(this.leadingEdge,this.breakAfter,this.context)}prepareLayout(e,t){t.fragmentLayoutConstraints=[],t.pseudoParent||TE()}clearNodes(e){super.clearNodes(e);let t=e;for(;t;){let n=t.viewNode;n&&r0(n.parentNode,n),t=t.parent}}saveState(e,t){super.saveState(e,t),this.initialPageBreakType=t.pageBreakType,this.initialComputedBlockSize=t.computedBlockSize,this.initialOverflown=t.overflown}restoreState(e,t){super.restoreState(e,t),t.pageBreakType=this.initialPageBreakType,t.computedBlockSize=this.initialComputedBlockSize,t.overflown=this.initialOverflown}},jP=class{constructor(e,t,n){this.leadingEdge=e,this.breakAfter=t,this.context=n}doLayout(e,t){let n=X("DefaultLayoutMode.doLayout");return UP(e,t).then(()=>{t.doLayout(e,this.leadingEdge,this.breakAfter).then(i=>{this.context.overflownNodeContext=i.overflownNodeContext,n.finish(i.nodeContext)})}),n.result()}accept(e,t){return t.pageFloatLayoutContext.isInvalidated()||t.pageBreakType||t.fragmentLayoutConstraints.length<=0?!0:t.fragmentLayoutConstraints.every(n=>n.allowLayout(e,this.context.overflownNodeContext,t))}postLayout(e,t,n,i){return i||(i=!n.fragmentLayoutConstraints.some(r=>r.nextCandidate(e))),n.fragmentLayoutConstraints.forEach(r=>{r.postLayout(i,e,t,n)}),i}},XP=class extends Ea{constructor(e,t,n,i,r,o,s){super(t,n,i,r,o),this.floatSide=e,this.parentContainer=s,d(this,"rootViewNodes",[]),d(this,"floatMargins",[]),d(this,"adjustContentRelativeSize",!0)}openAllViews(e){return super.openAllViews(e).thenAsync(t=>(t&&this.fixFloatSizeAndPosition(t),F(t)))}convertPercentageSizesToPx(e){let t=this.parentContainer.getPaddingRect(),n=t.x2-t.x1,i=t.y2-t.y1;function r(o,s){o.forEach(l=>{let a=ai(e,l);if(a&&a.charAt(a.length-1)==="%"){let u=parseFloat(a),h=s*u/100;O(e,l,`${h}px`)}})}r(["width","max-width","min-width"],n),r(["height","max-height","min-height"],i),r(["margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left"],this.vertical?i:n),["margin-top","margin-right","margin-bottom","margin-left"].forEach(o=>{ai(e,o)==="auto"&&O(e,o,"0")})}fixFloatSizeAndPosition(e){for(;e.parent;)e=e.parent;e.viewNode.nodeType;let t=e.viewNode;if(this.rootViewNodes.push(t),this.adjustContentRelativeSize&&this.convertPercentageSizesToPx(t),this.floatMargins.push(this.getComputedMargin(t)),this.adjustContentRelativeSize){let n=this.floatSide;if(this.parentContainer.vertical){if(n==="block-end"||n==="left"){let i=ai(t,"height");i!==""&&i!=="auto"&&O(t,"margin-top","auto")}}else if(n==="block-end"||n==="bottom"){let i=ai(t,"width");i!==""&&i!=="auto"&&O(t,"margin-left","auto")}}}getContentInlineSize(){return Math.max.apply(null,this.rootViewNodes.map((e,t)=>{let n=this.clientLayout.getElementClientRect(e),i=this.floatMargins[t];return this.vertical?i.top+n.height+i.bottom:i.left+n.width+i.right}))}},Jr=class{constructor(e,t){this.parent=e,this.rootSourceNode=t,d(this,"formattingContextType","RepetitiveElementsOwner"),d(this,"isRoot",!1),d(this,"repetitiveElements",null)}getName(){return"Repetitive elements owner formatting context (RepetitiveElementsOwnerFormattingContext)"}isFirstTime(e,t){return t}getParent(){return this.parent}getRepetitiveElements(){return this.repetitiveElements}getRootViewNode(e){let t=this.getRootNodeContext(e);return t?t.viewNode:null}getRootNodeContext(e){do if(!e.belongsTo(this)&&e.sourceNode===this.rootSourceNode)return e;while(e=e.parent);return null}initializeRepetitiveElements(e){this.repetitiveElements||hc.some(t=>t.root===this.rootSourceNode?(this.repetitiveElements=t.elements,!0):!1)||(this.repetitiveElements=new YP(e,this.rootSourceNode),hc.push({root:this.rootSourceNode,elements:this.repetitiveElements}))}saveState(){}restoreState(e){}},YP=class{constructor(e,t){this.vertical=e,this.ownerSourceNode=t,d(this,"headerSourceNode",null),d(this,"footerSourceNode",null),d(this,"headerViewNode",null),d(this,"footerViewNode",null),d(this,"headerNodePosition",null),d(this,"footerNodePosition",null),d(this,"headerHeight",0),d(this,"footerHeight",0),d(this,"isSkipHeader",!1),d(this,"isSkipFooter",!1),d(this,"enableSkippingFooter",!0),d(this,"enableSkippingHeader",!0),d(this,"doneInitialLayout",!1),d(this,"firstContentSourceNode",null),d(this,"lastContentSourceNode",null),d(this,"affectedNodeCache",[]),d(this,"afterLastContentNodeCache",[]),d(this,"allowInsert",!1),d(this,"allowInsertRepeatitiveElements")}setHeaderNodeContext(e){this.headerNodePosition||(this.headerNodePosition=xa(e,0),this.headerSourceNode=e.sourceNode,this.headerViewNode=e.viewNode)}setFooterNodeContext(e){this.footerNodePosition||(this.footerNodePosition=xa(e,0),this.footerSourceNode=e.sourceNode,this.footerViewNode=e.viewNode)}updateHeight(e){this.headerViewNode&&(this.headerHeight=ac(this.headerViewNode,e,this.vertical),this.headerViewNode=null),this.footerViewNode&&(this.footerHeight=ac(this.footerViewNode,e,this.vertical),this.footerViewNode=null)}prepareLayoutFragment(){this.isSkipHeader=this.isSkipFooter=!1,this.enableSkippingFooter=!0,this.enableSkippingHeader=!0}appendHeaderToFragment(e,t,n){return!this.headerNodePosition||this.isSkipHeader?F(!0):this.appendElementToFragment(this.headerNodePosition,e,t,n)}appendFooterToFragment(e,t,n){return!this.footerNodePosition||this.isSkipFooter?F(!0):this.appendElementToFragment(this.footerNodePosition,e,t,n)}appendElementToFragment(e,t,n,i){let r=t.viewNode.ownerDocument,o=t.viewNode,s=r.createElement("div");o.appendChild(s);let l=new sp(i,s,t),a=l.getColumn().pageBreakType;return l.getColumn().pageBreakType=null,this.allowInsertRepeatitiveElements=!0,l.layout(new Pi(e),!0).thenAsync(()=>(this.allowInsertRepeatitiveElements=!1,o.removeChild(s),this.moveChildren(s,o,n),l.getColumn().pageBreakType=a,F(!0)))}moveChildren(e,t,n){if(t)for(;e.firstChild;){let i=e.firstChild;e.removeChild(i),i.setAttribute(Qr,"1"),n?t.insertBefore(i,n):t.appendChild(i)}}calculateOffset(e){let t=0;return e&&!this.affectTo(e)||((!this.isSkipFooter||e&&this.isAfterLastContent(e))&&(t+=this.footerHeight),this.isSkipHeader||(t+=this.headerHeight)),t}calculateMinimumOffset(e){let t=0;return e&&!this.affectTo(e)||(!this.enableSkippingFooter&&e&&this.isAfterLastContent(e)&&(t+=this.footerHeight),this.enableSkippingHeader||(t+=this.headerHeight)),t}isAfterLastContent(e){return this.findResultFromCache(e,this.afterLastContentNodeCache,t=>this.isAfterNodeContextOf(this.lastContentSourceNode,e,!1))}affectTo(e){return this.findResultFromCache(e,this.affectedNodeCache,t=>this.isAfterNodeContextOf(this.ownerSourceNode,e,!0))}findResultFromCache(e,t,n){let i=t.filter(r=>r.nodeContext.sourceNode===e.sourceNode&&r.nodeContext.after===e.after);if(i.length>0)return i[0].result;{let r=n(e);return t.push({nodeContext:e,result:r}),r}}isAfterNodeContextOf(e,t,n){let i=[];for(let r=e;r;r=r.parentNode){if(t.sourceNode===r)return t.after;i.push(r)}for(let r=t.sourceNode;r;r=r.parentNode){let o=i.indexOf(r);if(o>=0)return n?o===0:!1;for(let s=r;s;s=s.previousElementSibling)if(i.includes(s))return!0}return t.after}isFirstContentNode(e){return e&&this.firstContentSourceNode===e.sourceNode}isEnableToUpdateState(){return!!(!this.isSkipFooter&&this.enableSkippingFooter&&this.footerNodePosition||!this.isSkipHeader&&this.enableSkippingHeader&&this.headerNodePosition)}updateState(){!this.isSkipFooter&&this.enableSkippingFooter&&this.footerNodePosition?this.isSkipFooter=!0:!this.isSkipHeader&&this.enableSkippingHeader&&this.headerNodePosition&&(this.isSkipHeader=!0)}preventSkippingHeader(){this.isSkipHeader=!1,this.enableSkippingHeader=!1}preventSkippingFooter(){this.isSkipFooter=!1,this.enableSkippingFooter=!1}isHeaderRegistered(){return!!this.headerNodePosition}isFooterRegistered(){return!!this.footerNodePosition}isHeaderSourceNode(e){return this.headerSourceNode===e}isFooterSourceNode(e){return this.footerSourceNode===e}},O0=class{constructor(e){this.formattingContext=e}accept(e,t){return!!e}postLayout(e,t,n,i){let r=this.formattingContext.getRepetitiveElements();return r&&(n.clientLayout,r.doneInitialLayout||(r.updateHeight(n),r.doneInitialLayout=!0)),i}},B0=class{constructor(e){this.formattingContext=e}accept(e,t){return!0}postLayout(e,t,n,i){return i}},qP=class extends O0{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return this.processor.doInitialLayout(e,t)}accept(e,t){return!1}},KP=class extends B0{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return!e.belongsTo(this.formattingContext)&&!e.after&&t.fragmentLayoutConstraints.unshift(new lp(e)),this.processor.doLayout(e,t)}},lp=class _0{constructor(t){d(this,"flagmentLayoutConstraintType","RepetitiveElementsOwner"),d(this,"nodeContext");let n=t.formattingContext;this.nodeContext=n.getRootNodeContext(t)}allowLayout(t,n,i){let r=this.getRepetitiveElements();return!r||Nr(this.nodeContext.viewNode)||!r.isEnableToUpdateState()?!0:!(n&&!t||t&&t.overflow)}nextCandidate(t){let n=this.getRepetitiveElements();return n&&n.isEnableToUpdateState()?(n.updateState(),!0):!1}postLayout(t,n,i,r){let o=this.getRepetitiveElements();o&&t&&r.stopAtOverflow&&(n==null||o.isAfterLastContent(n))&&o.preventSkippingFooter()}finishBreak(t,n){let i=this.nodeContext.formattingContext,r=this.getRepetitiveElements();if(!r)return F(!0);let o=this.nodeContext;return tN(i,o,n).thenAsync(()=>nN(i,o,n).thenAsync(()=>(r.prepareLayoutFragment(),F(!0))))}getRepetitiveElements(){return this.nodeContext.formattingContext.getRepetitiveElements()}equalsTo(t){return t instanceof _0?this.nodeContext.formattingContext===t.nodeContext.formattingContext:!1}getPriorityOfFinishBreak(){return 10}},QP=class extends Jd{constructor(e,t){super(),this.formattingContext=e,this.processor=t}resolveLayoutMode(e){let t=this.formattingContext.getRepetitiveElements();return!e.belongsTo(this.formattingContext)&&!t.doneInitialLayout?new qP(this.formattingContext,this.processor):(!e.belongsTo(this.formattingContext)&&!e.after&&t&&t.preventSkippingHeader(),new KP(this.formattingContext,this.processor))}},ZP=class extends Yo{constructor(e,t){super(),this.formattingContext=e,this.column=t}startNonInlineElementNode(e){let t=this.formattingContext,n=e.nodeContext,i=t.getRepetitiveElements();if(n.parent&&t.rootSourceNode===n.parent.sourceNode){switch(n.repeatOnBreak){case"header":if(i.isHeaderRegistered())n.repeatOnBreak="none";else return i.setHeaderNodeContext(n),F(!0);break;case"footer":if(i.isFooterRegistered())n.repeatOnBreak="none";else return i.setFooterNodeContext(n),F(!0);break}i.firstContentSourceNode||(i.firstContentSourceNode=n.sourceNode)}return Yo.prototype.startNonInlineElementNode.call(this,e)}afterNonInlineElementNode(e){let t=this.formattingContext,n=e.nodeContext;return n.sourceNode===t.rootSourceNode&&(t.getRepetitiveElements().lastContentSourceNode=e.lastAfterNodeContext&&e.lastAfterNodeContext.sourceNode,e.break=!0),n.repeatOnBreak==="header"||n.repeatOnBreak==="footer"?F(!0):Yo.prototype.afterNonInlineElementNode.call(this,e)}},JP=class extends Ir{layout(e,t,n){if(t.isFloatNodeContext(e))return t.layoutFloatOrFootnote(e);let i=e.formattingContext;return i.getRootViewNode(e)?(n&&M0(e.parent,t),e.belongsTo(i)?Ir.prototype.layout.call(this,e,t,n):new QP(i,this).layout(e,t)):t.buildDeepElementView(e)}startNonInlineElementNode(e){let t=iN(e).getRepetitiveElements();return t&&!t.allowInsertRepeatitiveElements&&(t.isHeaderSourceNode(e.sourceNode)||t.isFooterSourceNode(e.sourceNode))&&e.viewNode.parentNode.removeChild(e.viewNode),!1}doInitialLayout(e,t){e.formattingContext;let n=X("BlockLayoutProcessor.doInitialLayout");return this.layoutEntireBlock(e,t).thenFinish(n),n.result()}layoutEntireBlock(e,t){let n=e.formattingContext,i=new ZP(n,t);return new uc(i,t.layoutContext).iterate(e)}doLayout(e,t){let n=e.formattingContext,i=X("doLayout"),r=t.layoutContext.nextInTree(e,!1);return F0(r,t).then(o=>{let s=o;i.loopWithFrame(l=>{for(;s;){let a=!0;if(t.layoutNext(s,!1).then(u=>{s=u,t.pageFloatLayoutContext.isInvalidated()||t.pageBreakType||s&&t.stopByOverflow(s)||s&&s.after&&s.sourceNode==n.rootSourceNode?l.breakLoop():a?a=!1:l.continueLoop()}),a){a=!1;return}}l.breakLoop()}).then(()=>{i.finish(s)})}),i.result()}finishBreak(e,t,n,i){return Ir.prototype.finishBreak.call(this,e,t,n,i)}clearOverflownViewNodes(e,t,n,i){Ir.prototype.clearOverflownViewNodes(e,t,n,i)}};function eN(e,t){for(let n=e;n;n=n.parent){let i=n.formattingContext;i&&i instanceof Jr&&!n.belongsTo(i)&&t(i,n)}}function M0(e,t){e&&eN(e.after?e.parent:e,(n,i)=>{ki.isInstanceOfTableFormattingContext(n)||t.fragmentLayoutConstraints.push(new lp(i))})}function tN(e,t,n){let i=e.getRepetitiveElements();if(i){let r=e.getRootNodeContext(t);if(r.viewNode){let o=r.viewNode.firstChild;return i.appendHeaderToFragment(r,o,n)}}return F(!0)}function nN(e,t,n){let i=e.getRepetitiveElements();if(i&&!i.isSkipFooter){let r=e.getRootNodeContext(t);if(r.viewNode)return i.appendFooterToFragment(r,null,n)}return F(!0)}function iN(e){let t=e.formattingContext;return!t||!(t instanceof Jr)?null:t}var rN=new JP;hn("RESOLVE_LAYOUT_PROCESSOR",e=>e instanceof Jr&&!ki.isInstanceOfTableFormattingContext(e)?rN:null);var z0=class{constructor(e,t){this.rowIndex=e,this.sourceNode=t,d(this,"cells",[])}addCell(e){this.cells.push(e)}getMinimumHeight(){return Math.min.apply(null,this.cells.map(e=>e.height))}},oN=class{constructor(e,t,n){this.rowIndex=e,this.columnIndex=t,d(this,"viewElement"),d(this,"colSpan"),d(this,"rowSpan"),d(this,"height",0),d(this,"anchorSlot",null),this.viewElement=n,this.colSpan=n.colSpan||1,this.rowSpan=n.rowSpan||1}setHeight(e){this.height=e}setAnchorSlot(e){this.anchorSlot=e}},sN=class{constructor(e,t,n){this.rowIndex=e,this.columnIndex=t,this.cell=n}},lN=class{constructor(e,t,n){this.column=e,this.cellNodeContext=n,d(this,"pseudoColumn"),d(this,"empty",!1),this.pseudoColumn=new sp(e,t,n)}findAcceptableBreakPosition(){let e=this.cellNodeContext.viewNode,{verticalAlign:t,alignContent:n}=e.style;t!=="top"&&t!=="baseline"&&O(e,"vertical-align","top"),n&&n!=="normal"&&O(e,"align-content","normal");let i=this.pseudoColumn.findAcceptableBreakPosition(!0);return O(e,"vertical-align",t),n&&n!=="normal"&&O(e,"align-content",n),i}},aN=class{constructor(e,t){this.viewNode=e,this.side=t}},uN=class extends Gs{constructor(e,t,n,i){super(e,t,n,i),d(this,"formattingContext"),d(this,"acceptableCellBreakPositions",null),d(this,"rowIndex",null),this.formattingContext=e.formattingContext}findAcceptableBreak(e,t){let n=super.findAcceptableBreak(e,t);return t<this.getMinBreakPenalty()?null:this.getAcceptableCellBreakPositions().every(i=>!!i.nodeContext)?n:null}getMinBreakPenalty(){let e=super.getMinBreakPenalty();this.getAcceptableCellBreakPositions().forEach(n=>{e+=n.breakPosition.getMinBreakPenalty()});let t=this.getCellFragments();return e+=Math.max(0,...t.map(n=>n.cellNodeContext.breakPenalty)),e}getAcceptableCellBreakPositions(){if(!this.acceptableCellBreakPositions){this.formattingContext;let e=this.getCellFragments();this.acceptableCellBreakPositions=e.map(t=>t.findAcceptableBreakPosition())}return this.acceptableCellBreakPositions}getRowIndex(){return this.rowIndex!=null?this.rowIndex:this.rowIndex=this.formattingContext.findRowIndexBySourceNode(this.position.sourceNode)}getCellFragments(){return this.formattingContext.getRowSpanningCellsOverflowingTheRow(this.getRowIndex()).map(this.formattingContext.getCellFragmentOfCell,this.formattingContext)}},hN=class extends Kd{constructor(e,t,n){super(),this.rowIndex=e,this.beforeNodeContext=t,this.formattingContext=n,d(this,"acceptableCellBreakPositions",null)}findAcceptableBreak(e,t){if(this!==e.breakPositions[0]&&t<this.getMinBreakPenalty())return null;let n=this.getCellFragments(),i=this.getAcceptableCellBreakPositions(),r=i.every(o=>!!o.nodeContext)&&i.some((o,s)=>{let l=n[s].pseudoColumn,a=o.nodeContext;return!l.isStartNodeContext(a)&&!l.isLastAfterNodeContext(a)});return this.beforeNodeContext.overflow=i.some(o=>o.nodeContext&&o.nodeContext.overflow),r?this.beforeNodeContext:null}getMinBreakPenalty(){this.formattingContext.getRowByIndex(this.rowIndex);let e=this.beforeNodeContext.breakPenalty,t=this.getAcceptableCellBreakPositions(),n=this.getCellFragments();e+=Math.max(0,...n.map(r=>r.cellNodeContext.breakPenalty));let i=t.some((r,o)=>r.breakPosition instanceof zl&&n[o].cellNodeContext.sourceNode.rowSpan>1);return t.forEach((r,o)=>{let s=r.breakPosition.getMinBreakPenalty();i&&r.breakPosition instanceof Gs&&r.breakPosition.overflows&&s>=3&&(n[o].column.checkOverflowAndSaveEdge(r.nodeContext,null)||(s-=3)),e+=s}),e}getAcceptableCellBreakPositions(){if(!this.acceptableCellBreakPositions){let e=this.getCellFragments();this.acceptableCellBreakPositions=e.map(t=>t.findAcceptableBreakPosition())}return this.acceptableCellBreakPositions}getCellFragments(){return this.formattingContext.getCellsFallingOnRow(this.rowIndex).map(this.formattingContext.getCellFragmentOfCell,this.formattingContext)}},Zo=class extends Jr{constructor(e,t){super(e,t),this.tableSourceNode=t,d(this,"formattingContextType","Table"),d(this,"vertical",!1),d(this,"columnCount",-1),d(this,"tableWidth",0),d(this,"captions",[]),d(this,"colGroups",null),d(this,"colWidths",null),d(this,"inlineBorderSpacing",0),d(this,"rows",[]),d(this,"slots",[]),d(this,"cellFragments",[]),d(this,"lastRowViewNode",null),d(this,"cellBreakPositions",[]),d(this,"repetitiveElements",null)}getName(){return"Table formatting context (Table.TableFormattingContext)"}isFirstTime(e,t){if(!t)return t;switch(e.display){case"table-row":return this.cellBreakPositions.length===0;case"table-cell":return!this.cellBreakPositions.some(n=>n.cellNodePosition.steps[0].node===e.sourceNode);default:return t}}getParent(){return this.parent}finishFragment(){this.cellFragments=[]}addRow(e,t){this.rows[e]=t}getRowSlots(e){let t=this.slots[e];return t||(t=this.slots[e]=[]),t}addCell(e,t){let n=this.rows[e];n||(this.addRow(e,new z0(e,null)),n=this.rows[e]),n.addCell(t);let i=e+t.rowSpan,r=this.getRowSlots(e),o=0;for(;r[o];)o++;for(;e<i;e++){r=this.getRowSlots(e);for(let s=o;s<o+t.colSpan;s++){let l=r[s]=new sN(e,s,t);t.anchorSlot||t.setAnchorSlot(l)}}}getRowByIndex(e){return this.rows[e]}findRowIndexBySourceNode(e){return this.rows.findIndex(t=>e===t.sourceNode)}addCellFragment(e,t,n){let i=this.cellFragments[e];i||(i=this.cellFragments[e]=[]),i[t]=n}getCellsFallingOnRow(e){return this.getRowSlots(e).reduce((t,n)=>n.cell!==t[t.length-1]?t.concat(n.cell):t,[])}getRowSpanningCellsOverflowingTheRow(e){return this.getCellsFallingOnRow(e).filter(t=>t.rowIndex+t.rowSpan-1>e)}getCellFragmentOfCell(e){return this.cellFragments[e.rowIndex]&&this.cellFragments[e.rowIndex][e.columnIndex]}getColumnCount(){return this.columnCount<0&&(this.columnCount=Math.max.apply(null,this.rows.map(e=>e.cells.reduce((t,n)=>t+n.colSpan,0)))),this.columnCount}updateCellSizes(e){this.rows.forEach(t=>{t.cells.forEach(n=>{let i=e.getElementClientRect(n.viewElement);n.viewElement=null,n.setHeight(this.vertical?i.width:i.height)})})}findCellFromColumn(e){if(!e)return null;let t=null,n=0,i=0;e:for(n=0;n<this.cellFragments.length;n++)if(this.cellFragments[n]){for(i=0;i<this.cellFragments[n].length;i++)if(this.cellFragments[n][i]&&e===this.cellFragments[n][i].pseudoColumn.getColumn()){t=this.rows[n].cells[i];break e}}if(!t)return null;for(;n<this.slots.length;n++)for(;i<this.slots[n].length;i++){let r=this.slots[n][i];if(r.cell===t)return{rowIndex:r.rowIndex,columnIndex:r.columnIndex}}return null}collectElementsOffsetOfUpperCells(e){let t=[];return this.slots.reduce((n,i,r)=>{if(r>=e.rowIndex)return n;let o=i[e.columnIndex]&&this.getCellFragmentOfCell(i[e.columnIndex].cell);return!o||t.includes(o)||(this.collectElementsOffsetFromColumn(o.pseudoColumn.getColumn(),n),t.push(o)),n},[])}collectElementsOffsetOfHighestColumn(){let e=[];return this.rows.forEach(t=>{t.cells.forEach((n,i)=>{e[i]||(e[i]={collected:[],elements:[]});let r=e[i],o=this.getCellFragmentOfCell(n);!o||r.collected.includes(o)||(this.collectElementsOffsetFromColumn(o.pseudoColumn.getColumn(),r.elements),r.collected.push(o))})}),[new cN(e.map(t=>t.elements))]}collectElementsOffsetFromColumn(e,t){e.fragmentLayoutConstraints.forEach(n=>{if(Xi.isInstanceOfRepetitiveElementsOwnerLayoutConstraint(n)){let i=n.getRepetitiveElements();t.push(i)}ki.isInstanceOfTableRowLayoutConstraint(n)&&n.getElementsOffsetsForTableCell(null).forEach(i=>{t.push(i)})})}saveState(){return[].concat(this.cellBreakPositions)}restoreState(e){this.cellBreakPositions=e}},cN=class{constructor(e){this.repeatitiveElementsInColumns=e}calculateOffset(e){return this.calculateMaxOffsetOfColumn(e,t=>t.current)}calculateMinimumOffset(e){return this.calculateMaxOffsetOfColumn(e,t=>t.minimum)}calculateMaxOffsetOfColumn(e,t){let n=0;return this.repeatitiveElementsInColumns.forEach(i=>{let r=Dr(e,i);n=Math.max(n,t(r))}),n}};function dN(e){return e==="table-row-group"||e==="table-header-group"||e==="table-footer-group"}function pN(e){return e==="table"||e==="inline-table"}function _g(e){return dN(e)||pN(e)}function $0(e,t,n){let i=e.nodeContext,r=i.display,o=i.parent?i.parent.display:null,s=!1;if(o==="inline-table"&&!(i.formattingContext instanceof Zo)){for(let l=i.parent;l;l=l.parent)if(l.formattingContext instanceof Zo){s=l.formattingContext===t;break}}return s||r==="table-row"&&!_g(o)||r==="table-cell"&&o!=="table-row"&&!_g(o)||i.formattingContext instanceof Zo&&i.formattingContext!==t?n.buildDeepElementView(i).thenAsync(l=>(e.nodeContext=l,F(!0))):null}var fN=class extends Yo{constructor(e,t){super(),this.formattingContext=e,this.column=t,d(this,"rowIndex",-1),d(this,"columnIndex",0),d(this,"inRow",!1),d(this,"checkPoints",[]),d(this,"inHeaderOrFooter",!1)}startNonInlineElementNode(e){let t=this.formattingContext,n=$0(e,t,this.column);if(n)return n;this.postLayoutBlockContents(e);let i=e.nodeContext,r=i.display,o=t.getRepetitiveElements();switch(r){case"table":t.inlineBorderSpacing=i.inlineBorderSpacing;break;case"table-caption":{let s=new aN(i.viewNode,i.captionSide);t.captions.push(s);break}case"table-header-group":return o.isHeaderRegistered()||(this.inHeaderOrFooter=!0,o.setHeaderNodeContext(i)),F(!0);case"table-footer-group":return o.isFooterRegistered()||(this.inHeaderOrFooter=!0,o.setFooterNodeContext(i)),F(!0);case"table-row":this.inHeaderOrFooter||(this.inRow=!0,this.rowIndex++,i.sourceNode,this.columnIndex=0,t.addRow(this.rowIndex,new z0(this.rowIndex,i.sourceNode)),o.firstContentSourceNode||(o.firstContentSourceNode=i.sourceNode));break}return super.startNonInlineElementNode(e)}afterNonInlineElementNode(e){let t=this.formattingContext,n=e.nodeContext,i=n.display,r=this.column.clientLayout;if(this.postLayoutBlockContents(e),n.sourceNode===t.tableSourceNode){let o=r.getElementComputedStyle(t.getRootViewNode(n));t.tableWidth=parseFloat(o[t.vertical?"height":"width"]),t.getRepetitiveElements().lastContentSourceNode=e.lastAfterNodeContext&&e.lastAfterNodeContext.sourceNode,e.break=!0}else switch(i){case"table-header-group":case"table-footer-group":if(this.inHeaderOrFooter)return this.inHeaderOrFooter=!1,F(!0);break;case"table-row":this.inHeaderOrFooter||(t.lastRowViewNode=n.viewNode,this.inRow=!1);break;case"table-cell":if(!this.inHeaderOrFooter){this.inRow||(this.rowIndex++,this.columnIndex=0,this.inRow=!0);let o=n.viewNode;t.addCell(this.rowIndex,new oN(this.rowIndex,this.columnIndex,o)),this.columnIndex++}break}return super.afterNonInlineElementNode(e)}startNonElementNode(e){this.registerCheckPoint(e)}afterNonElementNode(e){this.registerCheckPoint(e)}startInlineElementNode(e){this.registerCheckPoint(e)}afterInlineElementNode(e){this.registerCheckPoint(e)}registerCheckPoint(e){let t=e.nodeContext;t&&t.viewNode&&!Tr(t)&&this.checkPoints.push(t.clone())}postLayoutBlockContents(e){this.checkPoints.length>0&&this.column.postLayoutBlock(e.nodeContext,this.checkPoints),this.checkPoints=[]}},D0=class V0 extends Yo{constructor(t,n){super(!0),this.formattingContext=t,this.column=n,d(this,"inRow",!1),d(this,"currentRowIndex",-1),d(this,"currentColumnIndex",0),d(this,"originalStopAtOverflow"),d(this,"inHeader"),d(this,"inFooter"),this.originalStopAtOverflow=n.stopAtOverflow,n.stopAtOverflow=!1}resetColumn(){this.column.stopAtOverflow=this.originalStopAtOverflow}getColSpanningCellWidth(t){let n=this.formattingContext.colWidths,i=0;for(let r=0;r<t.colSpan;r++)i+=n[t.anchorSlot.columnIndex+r];return i+=this.formattingContext.inlineBorderSpacing*(t.colSpan-1),i}layoutCell(t,n,i){let r=t.rowIndex,o=t.columnIndex,s=t.colSpan,l=n.viewNode;n.verticalAlign,s>1&&(O(l,"box-sizing","border-box"),O(l,this.formattingContext.vertical?"height":"width",`${this.getColSpanningCellWidth(t)}px`));let a=l.ownerDocument.createElement("div");l.appendChild(a);let u=new lN(this.column,a,n);return this.formattingContext.addCellFragment(r,o,u),i.primary.steps.length===1&&i.primary.after&&(u.empty=!0),u.pseudoColumn.layout(i,!0).thenReturn(!0)}hasBrokenCellAtSlot(t){let n=this.formattingContext.cellBreakPositions[0];return n?n.cell.anchorSlot.columnIndex===t:!1}extractRowSpanningCellBreakPositions(){let t=this.formattingContext.cellBreakPositions;if(t.length===0)return[];let n=[],i=0;do{let r=t[i],o=r.cell.rowIndex;if(o<this.currentRowIndex){let s=n[o];s||(s=n[o]=[]),s.push(r),t.splice(i,1)}else i++}while(i<t.length);return n}layoutRowSpanningCellsFromPreviousFragment(t){let n=this.formattingContext,i=this.extractRowSpanningCellBreakPositions(),r=i.reduce(p=>p+1,0);if(r===0)return F(!0);let o=this.column.layoutContext,s=t.nodeContext;s.viewNode.parentNode.removeChild(s.viewNode);let l=X("layoutRowSpanningCellsFromPreviousFragment"),a=F(!0),u=0,h=[];return i.forEach(p=>{a=a.thenAsync(()=>{let c=ba(p[0].cellNodePosition.steps[1],s.parent);return o.setCurrent(c,!1).thenAsync(()=>{let f=F(!0),v=0;function w(y){for(;v<y;){if(!h.includes(v)){let g=c.viewNode.ownerDocument.createElement("td");O(g,"padding","0"),c.viewNode.appendChild(g)}v++}}return p.forEach(y=>{f=f.thenAsync(()=>{let g=y.cell;w(g.anchorSlot.columnIndex);let m=y.cellNodePosition,x=ba(m.steps[0],c);return x.offsetInNode=m.offsetInNode,x.after=m.after,x.fragmentIndex=m.steps[0].fragmentIndex+1,o.setCurrent(x,!1).thenAsync(()=>{let C=y.breakChunkPosition;for(let N=0;N<g.colSpan;N++)h.push(v+N);return v+=g.colSpan,this.layoutCell(g,x,C).thenAsync(()=>(x.viewNode.rowSpan=g.rowIndex+g.rowSpan-this.currentRowIndex+r-u,F(!0)))})})}),f.thenAsync(()=>(w(n.getColumnCount()),u++,F(!0)))})})}),a.then(()=>{o.setCurrent(s,!0,t.atUnforcedBreak).then(()=>{l.finish(!0)})}),l.result()}startTableRow(t){if(this.inHeader||this.inFooter)return F(!0);let n=t.nodeContext,i=this.formattingContext;return this.currentRowIndex<0?(n.sourceNode,this.currentRowIndex=i.findRowIndexBySourceNode(n.sourceNode)):this.currentRowIndex++,this.currentColumnIndex=0,this.inRow=!0,this.layoutRowSpanningCellsFromPreviousFragment(t).thenAsync(()=>(this.registerCellFragmentIndex(),this.column.checkOverflowAndSaveEdgeAndBreakPosition(t.lastAfterNodeContext,null,!0,t.breakAtTheEdge)&&i.getRowSpanningCellsOverflowingTheRow(this.currentRowIndex-1).length===0&&(this.resetColumn(),n.overflow=!0,t.break=!0),F(!0)))}registerCellFragmentIndex(){this.formattingContext.getRowByIndex(this.currentRowIndex).cells.forEach(t=>{let n=this.formattingContext.cellBreakPositions[t.columnIndex];if(n&&n.cell.anchorSlot.columnIndex==t.anchorSlot.columnIndex){let i=n.cellNodePosition.steps[0],r=this.column.layoutContext.xmldoc.getElementOffset(i.node);zP(r,i.fragmentIndex+1,1)}})}startTableCell(t){if(this.inHeader||this.inFooter)return F(!0);let n=t.nodeContext;this.inRow||(this.currentRowIndex<0?this.currentRowIndex=0:this.currentRowIndex++,this.currentColumnIndex=0,this.inRow=!0);let i=this.formattingContext.getRowByIndex(this.currentRowIndex).cells[this.currentColumnIndex];if(!i)return t.break=!0,F(!0);let r=n.copy().modify();r.after=!0,t.nodeContext=r;let o=X("startTableCell"),s;if(this.hasBrokenCellAtSlot(i.anchorSlot.columnIndex)){let l=this.formattingContext.cellBreakPositions.shift();n.fragmentIndex=l.cellNodePosition.steps[0].fragmentIndex+1,s=F(l.breakChunkPosition)}else s=this.column.nextInTree(n,t.atUnforcedBreak).thenAsync(l=>{l.viewNode&&n.viewNode.removeChild(l.viewNode);let a=xa(l,0);return F(new Pi(a))});return s.then(l=>{this.layoutCell(i,n,l).then(()=>{this.afterNonInlineElementNode(t),this.currentColumnIndex++,o.finish(!0)})}),o.result()}startNonInlineBox(t){let n=$0(t,this.formattingContext,this.column);if(n)return n;let i=t.nodeContext,r=this.formattingContext.getRepetitiveElements(),o=i.display;return o==="table-header-group"&&r&&r.isHeaderSourceNode(i.sourceNode)?(this.inHeader=!0,F(!0)):o==="table-footer-group"&&r&&r.isFooterSourceNode(i.sourceNode)?(this.inFooter=!0,F(!0)):o==="table-row"?this.startTableRow(t):o==="table-cell"?this.startTableCell(t):F(!0)}endNonInlineBox(t){let n=t.nodeContext;if(n.display==="table-row"&&(this.inRow=!1,!this.inHeader&&!this.inFooter)){let i=n.copy().modify();i.after=!1;let r=new hN(this.currentRowIndex,i,this.formattingContext);this.column.breakPositions.push(r)}return F(!0)}afterNonInlineElementNode(t){let n=t.nodeContext,i=this.formattingContext.getRepetitiveElements(),r=n.display;if(r==="table-header-group"?i&&!i.allowInsertRepeatitiveElements&&i.isHeaderSourceNode(n.sourceNode)?(this.inHeader=!1,n.viewNode.parentNode.removeChild(n.viewNode)):O(n.viewNode,"display","table-row-group"):r==="table-footer-group"&&(i&&!i.allowInsertRepeatitiveElements&&i.isFooterSourceNode(n.sourceNode)?(this.inFooter=!1,n.viewNode.parentNode.removeChild(n.viewNode)):O(n.viewNode,"display","table-row-group")),r&&V0.ignoreList[r])n.viewNode.parentNode.removeChild(n.viewNode);else if(n.sourceNode===this.formattingContext.tableSourceNode)n.overflow=this.column.checkOverflowAndSaveEdge(n,null),this.resetColumn(),t.break=!0;else return super.afterNonInlineElementNode(t);return F(!0)}};d(D0,"ignoreList",{"table-caption":!0,"table-column-group":!0,"table-column":!0});var gN=D0,Ns=[];function mN(e){let t=Ns.findIndex(i=>i.root===e),n=Ns[t];return n?n.tableLayoutOption:null}function vN(e){let t=Ns.findIndex(n=>n.root===e);t>=0&&Ns.splice(t,1)}var U0=class{layoutEntireTable(e,t){let n=e.formattingContext,i=new fN(n,t);return new uc(i,t.layoutContext).iterate(e)}getColumnWidths(e,t,n,i){let r=e.ownerDocument,o=r.createElement("tr"),s=[];for(let a=0;a<t;a++){let u=r.createElement("td");o.appendChild(u),s.push(u)}e.parentNode.insertBefore(o,e.nextSibling);let l=s.map(a=>{let u=i.getElementClientRect(a),h=n?u.height:u.width;return Math.ceil(h)});return e.parentNode.removeChild(o),l}getColGroupElements(e){let t=[],n=e.firstElementChild;for(;n;)n.localName==="colgroup"&&t.push(n),n=n.nextElementSibling;return t}normalizeAndGetColElements(e){let t=[];return e.forEach(n=>{let i=n.span;n.removeAttribute("span");let r=n.firstElementChild;for(;r;){if(r.localName==="col"){let o=r.span;for(r.removeAttribute("span"),i-=o;o-- >1;){let s=r.cloneNode(!0);n.insertBefore(s,r),t.push(s)}t.push(r)}r=r.nextElementSibling}for(;i-- >0;)r=n.ownerDocument.createElement("col"),n.appendChild(r),t.push(r)}),t}addMissingColElements(e,t,n,i){if(e.length<n){let r=i.ownerDocument.createElement("colgroup");t.push(r);for(let o=e.length;o<n;o++){let s=i.ownerDocument.createElement("col");r.appendChild(s),e.push(s)}}}normalizeColGroups(e,t,n){let i=e.vertical,r=e.lastRowViewNode;if(!r)return;e.lastRowViewNode=null;let o=r.ownerDocument.createDocumentFragment(),s=e.getColumnCount();if(!(s>0)){e.colGroups=o;return}let l=e.colWidths=this.getColumnWidths(r,s,i,n.clientLayout),a=this.getColGroupElements(t),u=this.normalizeAndGetColElements(a);this.addMissingColElements(u,a,s,t),u.forEach((h,p)=>{O(h,i?"height":"width",`${l[p]}px`)}),a.forEach(h=>{o.appendChild(h.cloneNode(!0))}),e.colGroups=o}doInitialLayout(e,t){let n=e.formattingContext;n.vertical=e.vertical,n.initializeRepetitiveElements(e.vertical),e.sourceNode;let i=mN(e.sourceNode);vN(e.sourceNode);let r=X("TableLayoutProcessor.doInitialLayout"),o=e.copy();return this.layoutEntireTable(e,t).then(s=>{let l=s.viewNode,a=t.clientLayout.getElementClientRect(l),u=t.vertical?a.left:a.bottom;if(u+=(t.vertical?-1:1)*Dr(e,t.collectElementsOffset()).current,!t.isOverflown(u)&&(!i||!i.calculateBreakPositionsInside)){t.breakPositions.push(new bN(o)),r.finish(s);return}this.normalizeColGroups(n,l,t),n.updateCellSizes(t.clientLayout),r.finish(null)}),r.result()}addCaptions(e,t,n){let i=e.captions;i.forEach((r,o)=>{r&&(t.insertBefore(r.viewNode,n),r.side==="top"&&(i[o]=null))})}addColGroups(e,t,n){e.colGroups&&this.getColGroupElements(t).length===0&&(t.insertBefore(e.colGroups.cloneNode(!0),n),O(t,"table-layout","fixed"),O(t,e.vertical?"height":"width",`${e.tableWidth}px`))}removeColGroups(e,t){if(e.colGroups&&t){let n=this.getColGroupElements(t);n&&n.forEach(i=>{t.removeChild(i)})}}doLayout(e,t){let n=e.formattingContext,i=n.getRootViewNode(e),r=i.firstChild;this.addCaptions(n,i,r),this.addColGroups(n,i,r);let o=new gN(n,t),s=new uc(o,t.layoutContext),l=X("TableFormattingContext.doLayout");return s.iterate(e).thenFinish(l),l.result()}layout(e,t,n){let i=e.formattingContext;return i.getRootViewNode(e)?(n&&M0(e.parent,t),new yN(i,this).layout(e,t)):t.buildDeepElementView(e)}createEdgeBreakPosition(e,t,n,i){return new uN(e,t,n,i)}startNonInlineElementNode(e){return!1}afterNonInlineElementNode(e,t){return Wu(e),!1}finishBreak(e,t,n,i){let r=t.formattingContext;if(t.display==="table-row"){t.sourceNode;let o=r.findRowIndexBySourceNode(t.sourceNode);r.cellBreakPositions=[];let s;if(t.after?s=r.getRowSpanningCellsOverflowingTheRow(o):s=r.getCellsFallingOnRow(o),s.length){let l=X("TableLayoutProcessor.finishBreak"),a=0;return l.loopWithFrame(u=>{if(a===s.length){u.breakLoop();return}let h=s[a++],p=r.getCellFragmentOfCell(h),c=p.findAcceptableBreakPosition().nodeContext,f=p.cellNodeContext,v=f.toNodePosition(),w=new Pi(c.toNodePosition());r.cellBreakPositions.push({cellNodePosition:v,breakChunkPosition:w,cell:h});let y=f.viewNode;p.column.layoutContext.processFragmentedBlockEdge(p.cellNodeContext),o<h.rowIndex+h.rowSpan-1&&(y.rowSpan=o-h.rowIndex+1),p.empty?u.continueLoop():p.pseudoColumn.finishBreak(c,!1,!0).then(()=>{wN(p,r,c),u.continueLoop()})}).then(()=>{e.clearOverflownViewNodes(t,!1),e.layoutContext.processFragmentedBlockEdge(t),Wu(t),r.finishFragment(),l.finish(!0)}),l.result()}}return Wu(t),r.finishFragment(),Zd.finishBreak(e,t,n,i)}clearOverflownViewNodes(e,t,n,i){Ir.prototype.clearOverflownViewNodes(e,t,n,i)}};function wN(e,t,n){let i=t.getRepetitiveElements();if(!i||!(i.isHeaderRegistered()||i.isFooterRegistered()))return;let r=t.vertical,o=e.column,s=e.pseudoColumn.getColumnElement(),l=e.cellNodeContext.viewNode,a=o.clientLayout.getElementClientRect(l),u=o.getComputedPaddingBorder(l);if(r){let h=a.right-o.footnoteEdge-i.calculateOffset(n)-u.right;O(s,"max-width",`${h}px`)}else{let h=o.footnoteEdge-i.calculateOffset(n)-a.top-u.top;O(s,"max-height",`${h}px`)}}function Wu(e){let t=e.display==="table-row"?e.viewNode.parentElement:e.display==="table"?e.viewNode.querySelector("tbody"):null;if(!t)return;let n;try{n=t.querySelectorAll(":scope>tr:has(>:empty):not(:has(>:not([rowspan]:not([rowspan='1']),:empty)))")}catch{return}if(n.length===0)return;let i=Array.from(n).reduce((p,c)=>{let f=c.getBoundingClientRect(),v=e.vertical?f.width:f.height;return p+v},0),r=n[n.length-1],o=Array.from(t.children).indexOf(r),s=Array.from(r.children).reduce((p,c)=>{let f=c.rowSpan;return f>1&&o+f<t.childElementCount?Math.max(p,f):p},0),l=s?t.children[o+s-1]:t.lastElementChild;if(l!=t.lastElementChild&&l.querySelector(":scope>*>div>div")){for(let p=l;p&&p!==t.lastElementChild;p=p.nextElementSibling)if(p.querySelector(":scope>[rowspan]:not([rowspan='1'])")){l=p;break}}let a=l.getBoundingClientRect(),u=e.vertical?a.width:a.height,h=i+u;O(l,e.vertical?"width":"height",`${h}px`)}var yN=class extends Jd{constructor(e,t){super(),this.tableFormattingContext=e,this.processor=t}resolveLayoutMode(e){let t=this.tableFormattingContext.getRepetitiveElements();return!t||!t.doneInitialLayout?new xN(this.tableFormattingContext,this.processor):(e.sourceNode===this.tableFormattingContext.tableSourceNode&&!e.after&&t&&t.preventSkippingHeader(),new CN(this.tableFormattingContext,this.processor))}clearNodes(e){super.clearNodes(e);let t=this.tableFormattingContext.getRootViewNode(e);this.processor.removeColGroups(this.tableFormattingContext,t)}restoreState(e,t){super.restoreState(e,t),this.tableFormattingContext.finishFragment()}},xN=class extends O0{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return this.processor.doInitialLayout(e,t)}},bN=class extends Gs{constructor(e){super(e,null,e.overflow,0)}getMinBreakPenalty(){if(!this.isEdgeUpdated)throw new Error("EdgeBreakPosition.prototype.updateEdge not called");return(this.overflows?3:0)+(this.position.parent?this.position.parent.breakPenalty:0)}breakPositionChosen(e){e.fragmentLayoutConstraints.push(new SN(this.position.sourceNode))}},SN=class H0{constructor(t){this.tableRootNode=t,d(this,"flagmentLayoutConstraintType","EntireTable")}allowLayout(t,n,i){return t.overflow,!1}nextCandidate(t){return!0}postLayout(t,n,i,r){n.sourceNode,Ns.push({root:n.sourceNode,tableLayoutOption:{calculateBreakPositionsInside:!0}})}finishBreak(t,n){return F(!0)}equalsTo(t){return t instanceof H0&&t.tableRootNode===this.tableRootNode}getPriorityOfFinishBreak(){return 0}},CN=class extends B0{constructor(e,t){super(e),this.processor=t}doLayout(e,t){let n=this.formattingContext.getRepetitiveElements();if(n&&!n.isAfterLastContent(e)){let i=new kN(e);t.fragmentLayoutConstraints.some(r=>i.equalsTo(r))||t.fragmentLayoutConstraints.unshift(i)}return this.processor.doLayout(e,t)}},kN=class W0 extends lp{constructor(t){super(t),d(this,"flagmentLayoutConstraintType","TableRow"),d(this,"cellFragmentLayoutConstraints",[])}allowLayout(t,n,i){let r=this.getRepetitiveElements();return!r||i.pseudoParent||Nr(this.nodeContext.viewNode)||!r.isEnableToUpdateState()?!0:!(n&&!t||t&&t.overflow)}nextCandidate(t){let n=this.nodeContext.formattingContext;return this.collectCellFragmentLayoutConstraints(t,n).some(i=>i.constraints.some(r=>r.nextCandidate(t)))?!0:super.nextCandidate(t)}postLayout(t,n,i,r){let o=this.nodeContext.formattingContext;if(this.cellFragmentLayoutConstraints=this.collectCellFragmentLayoutConstraints(n,o),this.cellFragmentLayoutConstraints.forEach(s=>{s.constraints.forEach(l=>{l.postLayout(t,s.breakPosition,i,r)})}),!t){let s=o.getRootViewNode(this.nodeContext);new U0().removeColGroups(o,s),this.removeDummyRowNodes(i)}super.postLayout(t,n,i,r)}finishBreak(t,n){this.nodeContext.formattingContext;let i=X("finishBreak"),r=this.cellFragmentLayoutConstraints.reduce((s,l)=>s.concat(l.constraints.map(a=>({constraint:a,breakPosition:l.breakPosition}))),[]),o=0;return i.loop(()=>{if(o<r.length){let s=r[o++];return s.constraint.finishBreak(s.breakPosition,n).thenReturn(!0)}else return F(!1)}).then(()=>{i.finish(!0)}),i.result().thenAsync(()=>super.finishBreak(t,n))}removeDummyRowNodes(t){if(!(!t||t.display!=="table-row"||!t.viewNode))for(;t.viewNode.previousElementSibling;){let n=t.viewNode.previousElementSibling;n.parentNode&&n.parentNode.removeChild(n)}}collectCellFragmentLayoutConstraints(t,n){return this.getCellFragemnts(t,n).map(i=>({constraints:i.fragment.pseudoColumn.getColumn().fragmentLayoutConstraints,breakPosition:i.breakPosition}))}getCellFragemnts(t,n){let i=Number.MAX_VALUE;t&&t.display==="table-row"&&(t.sourceNode,i=n.findRowIndexBySourceNode(t.sourceNode)+1),i=Math.min(n.cellFragments.length,i);let r=[];for(let o=0;o<i;o++)n.cellFragments[o]&&n.cellFragments[o].forEach(s=>{s&&r.push({fragment:s,breakPosition:s.findAcceptableBreakPosition().nodeContext})});return r}getElementsOffsetsForTableCell(t){let n=this.nodeContext.formattingContext,i=n.findCellFromColumn(t);return i?n.collectElementsOffsetOfUpperCells(i):n.collectElementsOffsetOfHighestColumn()}equalsTo(t){return t instanceof W0?this.nodeContext.formattingContext===t.nodeContext.formattingContext:!1}},EN=new U0;function PN(e,t,n,i,r,o){if(!t)return null;if(n===S.table){let s=e.parent;return new Zo(s?s.formattingContext:null,e.sourceNode)}return null}function NN(e){return e instanceof Zo?EN:null}hn("RESOLVE_FORMATTING_CONTEXT",PN);hn("RESOLVE_LAYOUT_PROCESSOR",NN);function Mg(e){return e.reduce((t,n)=>t+n,0)/e.length}function TN(e){let t=Mg(e);return Mg(e.map(n=>{let i=n-t;return i*i}))}var IN=class{constructor(e,t){this.layoutResult=e,this.penalty=t}};function Ts(e){return e.vertical?e.width:e.height}function Is(e,t){e.vertical?e.width=t:e.height=t}var G0=class{constructor(e,t,n){this.layoutContainer=e,this.columnGenerator=t,this.regionPageFloatLayoutContext=n,d(this,"originalContainerBlockSize"),this.originalContainerBlockSize=Ts(e)}balanceColumns(e){let t=X("ColumnBalancer#balanceColumns");this.preBalance(e),this.savePageFloatLayoutContexts(e),this.layoutContainer.clear();let n=[this.createTrialResult(e)];return t.loopWithFrame(i=>{if(!this.hasNextCandidate(n)){i.breakLoop();return}this.updateCondition(n),this.columnGenerator().then(r=>{if(this.savePageFloatLayoutContexts(r),this.layoutContainer.clear(),!r){i.breakLoop();return}n.push(this.createTrialResult(r)),i.continueLoop()})}).then(()=>{let i=n.reduce((r,o)=>o.penalty<r.penalty?o:r,n[0]);this.restoreContents(i.layoutResult),this.postBalance(),t.finish(i.layoutResult)}),t.result()}createTrialResult(e){let t=this.calculatePenalty(e);return new IN(e,t)}preBalance(e){}postBalance(){Is(this.layoutContainer,this.originalContainerBlockSize)}savePageFloatLayoutContexts(e){let t=this.regionPageFloatLayoutContext.detachChildren();e&&(e.columnPageFloatLayoutContexts=t)}restoreContents(e){let t=this.layoutContainer.element;e.columns.forEach(n=>{t.appendChild(n.element)}),e.columnPageFloatLayoutContexts,this.regionPageFloatLayoutContext.attachChildren(e.columnPageFloatLayoutContexts)}},kc=1;function j0(e){let t=e[e.length-1];if(t.penalty===0)return!1;let n=e[e.length-2];if(n&&t.penalty>=n.penalty)return!1;let i=t.layoutResult.columns,r=Math.max.apply(null,i.map(s=>s.computedBlockSize)),o=Math.max.apply(null,i.map(s=>s.getMaxBlockSizeOfPageFloats()));return r>o+kc}function X0(e,t){var n;let i=e[e.length-1].layoutResult.columns,r=Math.max.apply(null,i.map(o=>isNaN(o.blockDistanceToBlockEndFloats)?o.computedBlockSize:o.computedBlockSize-o.blockDistanceToBlockEndFloats+kc))-kc;if(r<Ts(t)?Is(t,r):Is(t,Ts(t)-1),t.vertical){let o=parseFloat((n=t.element.style)==null?void 0:n.width);t.originX=o-t.width}}var RN=class extends G0{constructor(e,t,n,i){super(n,e,t),this.columnCount=i,d(this,"originalPosition",null),d(this,"foundUpperBound",!1)}preBalance(e){let t=e.columns.reduce((n,i)=>n+i.computedBlockSize,0);Is(this.layoutContainer,t/this.columnCount),this.originalPosition=e.position}checkPosition(e){return this.originalPosition?this.originalPosition.isSamePosition(e):e===null}calculatePenalty(e){if(!this.checkPosition(e.position))return 1/0;let t=e.columns;return zg(t)?1/0:Math.max.apply(null,t.map(n=>n.computedBlockSize))}hasNextCandidate(e){if(e.length===1)return!0;if(this.foundUpperBound)return j0(e);{let t=e[e.length-1];return this.checkPosition(t.layoutResult.position)&&!zg(t.layoutResult.columns)?(this.foundUpperBound=!0,!0):Ts(this.layoutContainer)<this.originalContainerBlockSize}}updateCondition(e){if(this.foundUpperBound)X0(e,this.layoutContainer);else{let t=Math.min(this.originalContainerBlockSize,Ts(this.layoutContainer)+this.originalContainerBlockSize*.1);Is(this.layoutContainer,t)}}};function zg(e){if(e.length<=1)return!1;let t=e[e.length-1].computedBlockSize,n=e.slice(0,e.length-1),i=6;return n.every(r=>t>r.computedBlockSize+i)}var AN=class extends G0{constructor(e,t,n){super(n,e,t)}calculatePenalty(e){if(e.columns.every(n=>n.computedBlockSize===0))return 1/0;let t=e.columns.filter(n=>!n.pageBreakType).map(n=>n.computedBlockSize);return TN(t)}hasNextCandidate(e){return j0(e)}updateCondition(e){X0(e,this.layoutContainer)}};function LN(e,t,n,i,r,o,s){if(t===S.auto)return null;{let l=s.positions.length===0,a=o[o.length-1],u=!!(a&&a.pageBreakType);return l||u?new RN(n,i,r,e):t===S.balance_all?new AN(n,i,r):null}}var Gu=class{constructor(e,t,n){d(this,"endStuckFixed"),d(this,"endFixed"),d(this,"endSlipped"),this.endStuckFixed=e,this.endFixed=t,this.endSlipped=n}},FN=class{constructor(){d(this,"map",[])}getMaxFixed(){return this.map.length==0?0:this.map[this.map.length-1].endFixed}getMaxSlipped(){return this.map.length==0?0:this.map[this.map.length-1].endSlipped}addStuckRange(e){if(this.map.length==0)this.map.push(new Gu(e,e,e));else{let t=this.map[this.map.length-1],n=t.endSlipped+e-t.endFixed;t.endFixed==t.endStuckFixed?(t.endFixed=e,t.endStuckFixed=e,t.endSlipped=n):this.map.push(new Gu(e,e,n))}}addSlippedRange(e){this.map.length==0?this.map.push(new Gu(e,0,0)):this.map[this.map.length-1].endFixed=e}slippedByFixed(e){let t=Ci(this.map.length,i=>e<=this.map[i].endFixed),n=this.map[t];return n.endSlipped-Math.max(0,n.endStuckFixed-e)}fixedBySlipped(e){let t=Ci(this.map.length,i=>e<=this.map[i].endSlipped),n=this.map[t];return n.endStuckFixed-(n.endSlipped-e)}},ON=class Ec{constructor(t,n,i,r,o,s,l,a){if(this.context=t,this.style=n,this.offset=i,this.isRoot=r,this.flowChunk=o,this.atBlockStart=s,this.atFlowStart=l,this.isParentBoxDisplayed=a,d(this,"flowName"),d(this,"isBlockValue",null),d(this,"hasBoxValue",null),d(this,"styleValues",{}),d(this,"beforeBox",null),d(this,"afterBox",null),d(this,"breakBefore",null),this.flowName=o.flowName,this.hasBox()){let u=n._pseudos;if(u&&u.before){let h=new Ec(t,u.before,i,!1,o,this.isBlock(),l,!0),p=h.styleValue("content");Ni(p)&&(this.beforeBox=h,this.breakBefore=h.breakBefore)}}this.breakBefore=Tt(this.getBreakValue("before"),this.breakBefore),this.atFlowStart&&Ft(this.breakBefore)&&(o.breakBefore=Tt(o.breakBefore,this.breakBefore))}buildAfterPseudoElementBox(t,n,i){if(this.hasBox()){let r=this.style._pseudos;if(r&&r.after){let o=new Ec(this.context,r.after,t,!1,this.flowChunk,n,i,!0),s=o.styleValue("content");Ni(s)&&(this.afterBox=o)}}}styleValue(t,n){if(!(t in this.styleValues)){let i=this.style[t];this.styleValues[t]=i?i.evaluate(this.context,t):n||null}return this.styleValues[t]}displayValue(){return this.styleValue("display",S.inline)}isBlock(){if(this.isBlockValue===null){let t=this.displayValue(),n=this.styleValue("position"),i=this.styleValue("float");this.isBlockValue=n0(t,n,i,this.isRoot)}return this.isBlockValue}hasBox(){return this.hasBoxValue===null&&(this.hasBoxValue=this.isParentBoxDisplayed&&this.displayValue()!==S.none&&!lc(this.styleValue("position"))),this.hasBoxValue}getBreakValue(t){let n=null;if(this.isBlock()){let i=this.styleValue(`break-${t}`);i&&(n=i.toString())}return n}},BN=class{constructor(e){this.context=e,d(this,"stack",[]),d(this,"atBlockStart",!0),d(this,"atFlowStart",!0),d(this,"atStartStack",[])}empty(){return this.stack.length===0}lastBox(){return this.stack[this.stack.length-1]}lastFlowName(){let e=this.lastBox();return e?e.flowChunk.flowName:null}isCurrentBoxDisplayed(){return this.stack.every(e=>e.displayValue()!==S.none)}push(e,t,n,i){let r=this.lastBox();i&&r&&i.flowName!==r.flowName&&this.atStartStack.push({atBlockStart:this.atBlockStart,atFlowStart:this.atFlowStart});let o=i||r.flowChunk,s=this.atFlowStart||!!i,l=this.isCurrentBoxDisplayed(),a=new ON(this.context,e,t,n,o,s||this.atBlockStart,s,l);return this.stack.push(a),this.atBlockStart=a.hasBox()?!a.beforeBox&&a.isBlock():this.atBlockStart,this.atFlowStart=a.hasBox()?!a.beforeBox&&s:this.atFlowStart,a}encounteredTextNode(e){let t=this.lastBox();if((e.nodeType===Node.TEXT_NODE||e.nodeType===Node.CDATA_SECTION_NODE)&&(this.atBlockStart||this.atFlowStart)&&t.hasBox()){let n=t.styleValue("white-space",S.normal).toString(),i=Wy(n);i&&!lt(e,i)&&(this.atBlockStart=!1,this.atFlowStart=!1)}}pop(e){let t=this.stack.pop();if(t.buildAfterPseudoElementBox(e,this.atBlockStart,this.atFlowStart),this.atFlowStart&&t.afterBox){let i=t.afterBox.getBreakValue("before");t.flowChunk.breakBefore=Tt(t.flowChunk.breakBefore,i)}let n=this.lastBox();if(n)if(n.flowName===t.flowName)t.hasBox()&&(this.atBlockStart=this.atFlowStart=!1);else{let i=this.atStartStack.pop();this.atBlockStart=i.atBlockStart,this.atFlowStart=i.atFlowStart}return t}nearestBlockStartOffset(e){if(!e.atBlockStart)return e.offset;let t=this.stack.length-1,n=this.stack[t];for(n===e&&(t--,n=this.stack[t]);t>=0;){if(n.flowName!==e.flowName)return e.offset;if(!n.atBlockStart||n.isRoot)return n.offset;e=n,n=this.stack[--t]}throw new Error("No block start offset found!")}},$g=class{constructor(e,t,n,i,r,o,s,l){this.xmldoc=e,this.scope=n,this.context=i,this.primaryFlows=r,this.validatorSet=o,this.counterListener=s,d(this,"root"),d(this,"cascadeHolder"),d(this,"last"),d(this,"rootStyle",{}),d(this,"styleMap",{}),d(this,"flows",{}),d(this,"flowChunks",[]),d(this,"flowListener",null),d(this,"flowToReach",null),d(this,"idToReach",null),d(this,"cascade"),d(this,"offsetMap"),d(this,"primary",!0),d(this,"primaryStack",[]),d(this,"rootBackgroundAssigned",!1),d(this,"rootLayoutAssigned",!1),d(this,"lastOffset"),d(this,"breakBeforeValues",{}),d(this,"boxStack"),d(this,"bodyReached",!0),this.root=e.root,this.cascadeHolder=t,this.last=this.root,this.cascade=t.createInstance(i,s,l,e.lang),this.offsetMap=new FN;let a=e.getElementOffset(this.root);this.lastOffset=a,this.boxStack=new BN(i),this.offsetMap.addStuckRange(a);let u=this.getAttrStyle(this.root);switch(this.cascade.pushElement(this,this.root,u,a),this.postprocessTopStyle(u,!1),this.root.namespaceURI){case"http://www.w3.org/1999/xhtml":this.bodyReached=!1;break}this.primaryStack.push(!0),this.styleMap={},this.styleMap[`e${a}`]=u,this.lastOffset++,this.replayFlowElementsFromOffset(-1)}hasProp(e,t,n){let i=e[n];return i&&i.evaluate(this.context)!==t[n]}transferPropsToRoot(e,t){for(let n in t){let i=e[n];if(i)this.rootStyle[n]=i,delete e[n];else{let r=t[n];r&&(this.rootStyle[n]=new fe(r,Ry))}}}postprocessTopStyle(e,t){var n;if(t)for(let i of["writing-mode","direction"])e[i]&&!(t&&this.rootStyle[i])&&(this.rootStyle[i]=e[i]);else for(let i in e)qo(i)&&(this.rootStyle[i]=e[i]);if(!this.rootBackgroundAssigned){let i=this.hasProp(e,this.validatorSet.backgroundProps,"background-color")?e["background-color"].evaluate(this.context):null,r=this.hasProp(e,this.validatorSet.backgroundProps,"background-image")?e["background-image"].evaluate(this.context):null;(i&&!ge(i)||r&&!ge(r))&&(this.transferPropsToRoot(e,this.validatorSet.backgroundProps),this.rootBackgroundAssigned=!0)}if(!this.rootLayoutAssigned){for(let i=0;i<Dg.length;i++)if(this.hasProp(e,this.validatorSet.layoutProps,Dg[i])){this.transferPropsToRoot(e,this.validatorSet.layoutProps),this.rootLayoutAssigned=!0;break}}if(!t){let i=e["font-size"],r=!0;if(i&&!ge(i.value)){let l=i.evaluate(this.context);if(l instanceof $){let a=l.num;switch(l.unit){case"em":case"rem":a*=this.context.initialFontSize;break;case"ex":a*=this.context.initialFontSize*Te.ex/Te.em;break;case"%":a*=this.context.initialFontSize/100;break;case"lh":case"rlh":a*=this.context.initialFontSize*Te.lh/Te.em;break;default:{let u=Te[l.unit];u&&(a*=u),r=!1}}this.context.rootFontSize=a,this.context.isRelativeRootFontSize=r}}let o=(n=this.context.rootFontSize)!=null?n:this.context.initialFontSize,s=e["line-height"];if(s&&!ge(s.value)){let l=s.evaluate(this.context);if(l instanceof Ai)this.context.rootLineHeight=l.num*o;else if(l instanceof $){let a=l.num;switch(l.unit){case"em":case"rem":a*=o;break;case"ex":a*=o*Te.ex/Te.em;break;case"%":a*=o/100;break;case"lh":case"rlh":a*=this.context.initialFontSize*Te.lh/Te.em;break;default:{let u=Te[l.unit];u&&(a*=u)}}this.context.rootLineHeight=a}}else this.context.rootLineHeight=this.context.fontSize()*Te.lh/Te.em}}getTopContainerStyle(){let e=0;for(;!this.bodyReached&&(e+=5e3,this.styleUntil(e,0)!=Number.POSITIVE_INFINITY););return this.rootStyle}getAttrStyle(e){if(e.style instanceof CSSStyleDeclaration){let t=e.getAttribute("style");if(t)return RP(this.scope,this.validatorSet,this.xmldoc.url,t)}return{}}getReachedOffset(){return this.lastOffset}replayFlowElementsFromOffset(e){if(e>=this.lastOffset)return;let t=this.context,n=this.xmldoc.getElementOffset(this.root);if(e<n){let o=this.getStyle(this.root,!1),s=pt(o,"flow-into"),l=s?s.evaluate(t,"flow-into").toString():"body",a=this.encounteredFlowElement(l,o,this.root,n);this.boxStack.empty()&&this.boxStack.push(o,n,!0,a)}let i=this.xmldoc.getNodeByOffset(e),r=this.xmldoc.getNodeOffset(i,0,!1);if(!(r>=this.lastOffset))for(;;){if(i.nodeType!=1)r+=i.textContent.length;else{let s=i,l=this.getStyle(s,!1),a=l["flow-into"];if(a){let u=a.evaluate(t,"flow-into").toString();this.encounteredFlowElement(u,l,s,r)}r++}if(r>=this.lastOffset)break;let o=i.firstChild;if(o==null){for(;o=i.nextSibling,!o;)if(i=i.parentNode,i===this.root)return}i=o}}resetFlowChunkStream(e){this.flowListener=e;for(let t=0;t<this.flowChunks.length;t++)this.flowListener.encounteredFlowChunk(this.flowChunks[t],this.flows[this.flowChunks[t].flowName])}styleUntilFlowIsReached(e){this.flowToReach=e;let t=0;for(;!(this.flowToReach==null||(t+=5e3,this.styleUntil(t,0)==Number.POSITIVE_INFINITY)););}styleUntilIdIsReached(e){if(!e)return;this.idToReach=e;let t=0;for(;!(!this.idToReach||(t+=5e3,this.styleUntil(t,0)===Number.POSITIVE_INFINITY)););this.idToReach=null}encounteredFlowElement(e,t,n,i){let r=0,o=Number.POSITIVE_INFINITY,s=!1,l=!1,a=!1,u=t["flow-options"];if(u){let w=GC(u.evaluate(this.context,"flow-options"));s=!!w.exclusive,l=!!w.static,a=!!w.last}let h=t["flow-linger"];h&&(o=sg(h.evaluate(this.context,"flow-linger"),Number.POSITIVE_INFINITY));let p=t["flow-priority"];p&&(r=sg(p.evaluate(this.context,"flow-priority"),0));let c=this.breakBeforeValues[i]||null,f=this.flows[e];if(!f){let w=this.boxStack.lastFlowName();f=this.flows[e]=new sE(e,w)}let v=new lE(e,n,i,r,o,s,l,a,c);return this.flowChunks.push(v),this.flowToReach==e&&(this.flowToReach=null),this.flowListener&&this.flowListener.encounteredFlowChunk(v,f),v}registerForcedBreakOffset(e,t,n){if(Ft(e)){let r=this.flows[n].forcedBreakOffsets;(r.length===0||r[r.length-1]<t)&&r.push(t)}let i=this.breakBeforeValues[t];this.breakBeforeValues[t]=Tt(i,e)}styleUntil(e,t){let n=-1,i;if(e<=this.lastOffset&&(i=this.offsetMap.slippedByFixed(e),n=i+t,n<this.offsetMap.getMaxSlipped()))return this.offsetMap.fixedBySlipped(n);if(this.last==null)return Number.POSITIVE_INFINITY;let r=this.context;for(;;){let o=this.last.firstChild;if(o==null)for(;;){if(this.last.nodeType==1){this.cascade.popElement(this.last),this.primary=this.primaryStack.pop();let s=this.boxStack.pop(this.lastOffset),l=null;if(s.afterBox){let a=s.afterBox.getBreakValue("before");this.registerForcedBreakOffset(a,s.afterBox.atBlockStart?this.boxStack.nearestBlockStartOffset(s):s.afterBox.offset,s.flowName),l=s.afterBox.getBreakValue("after")}l=Tt(l,s.getBreakValue("after")),this.registerForcedBreakOffset(l,this.lastOffset,s.flowName)}if(o=this.last.nextSibling,o)break;if(this.last=this.last.parentNode,this.last===this.root)return this.last=null,e<this.lastOffset&&(n<0&&(i=this.offsetMap.slippedByFixed(e),n=i+t),n<=this.offsetMap.getMaxSlipped())?this.offsetMap.fixedBySlipped(n):Number.POSITIVE_INFINITY}if(this.last=o,this.last.nodeType!=1)this.lastOffset+=this.last.textContent.length,this.boxStack.encounteredTextNode(this.last),this.primary?this.offsetMap.addStuckRange(this.lastOffset):this.offsetMap.addSlippedRange(this.lastOffset);else{let s=this.last,l=this.getAttrStyle(s);this.primaryStack.push(this.primary),this.cascade.pushElement(this,s,l,this.lastOffset);let a=s.getAttribute("id")||s.getAttributeNS("http://www.w3.org/XML/1998/namespace","id");a&&a===this.idToReach&&(this.idToReach=null),!this.bodyReached&&s.localName=="body"&&s.parentNode==this.root&&(this.postprocessTopStyle(l,!0),this.bodyReached=!0);let u,h=l["flow-into"];if(h){let c=h.evaluate(r,"flow-into").toString(),f=this.encounteredFlowElement(c,l,s,this.lastOffset);this.primary=!!this.primaryFlows[c],u=this.boxStack.push(l,this.lastOffset,s===this.root,f)}else u=this.boxStack.push(l,this.lastOffset,s===this.root),s===this.xmldoc.body&&(u.breakBefore=Tt(u.flowChunk.breakBefore,u.breakBefore));let p=this.boxStack.nearestBlockStartOffset(u);if(p===0){let c=l.page,f=c&&!ge(c.value)&&c.value.toString();f&&f.toLowerCase()!=="auto"&&(this.cascade.firstPageType=f)}if(this.registerForcedBreakOffset(u.breakBefore,p,u.flowName),u.beforeBox){let c=u.beforeBox.getBreakValue("after");this.registerForcedBreakOffset(c,u.beforeBox.atBlockStart?p:u.offset,u.flowName)}if(this.primary&&u.displayValue()===S.none&&(this.primary=!1),this.styleMap[`e${this.lastOffset}`]=l,this.lastOffset++,this.primary?this.offsetMap.addStuckRange(this.lastOffset):this.offsetMap.addSlippedRange(this.lastOffset),this.bodyReached&&p===0)continue;if(e<this.lastOffset&&(n<0&&(i=this.offsetMap.slippedByFixed(e),n=i+t),n<=this.offsetMap.getMaxSlipped()))return this.offsetMap.fixedBySlipped(n)}}}getStyle(e,t){let n=this.xmldoc.getElementOffset(e),i=`e${n}`;return t&&(n=this.xmldoc.getNodeOffset(e,0,!0)),this.lastOffset<=n&&this.styleUntil(n,0),this.styleMap[i]}processContent(e,t,n){}},Dg=["column-count","column-width","column-fill"],Ar=class{constructor(e){this.validator=e,d(this,"success",null),d(this,"failure",null),d(this,"code",0)}isSpecial(){return this.code!=0}markAsStartGroup(){this.code=-1}isStartGroup(){return this.code==-1}markAsEndGroup(){this.code=-2}isEndGroup(){return this.code==-2}markAsStartAlternate(e){this.code=2*e+1}isStartAlternate(){return this.code>0&&this.code%2!=0}markAsEndAlternate(e){this.code=2*e+2}isEndAlternate(){return this.code>0&&this.code%2==0}getAlternate(){return Math.floor((this.code-1)/2)}},_i=class{constructor(e,t){this.where=e,this.success=t,d(this,"what",-1)}},Co=class Y0{constructor(){d(this,"nodes",[]),d(this,"connections",[]),d(this,"match",[]),d(this,"nomatch",[]),d(this,"error",[]),d(this,"emptyHead",!0)}connect(t,n){for(let i=0;i<t.length;i++)this.connections[t[i]].what=n;t.splice(0,t.length)}clone(){let t=new Y0;for(let n=0;n<this.nodes.length;n++){let i=this.nodes[n],r=new Ar(i.validator);r.code=i.code,t.nodes.push(r)}for(let n=0;n<this.connections.length;n++){let i=this.connections[n],r=new _i(i.where,i.success);r.what=i.what,t.connections.push(r)}return t.match.push(...this.match),t.nomatch.push(...this.nomatch),t.error.push(...this.error),t}addSpecialToArr(t,n,i){let r=this.nodes.length,o=new Ar(Vg);i>=0?n?o.markAsStartAlternate(i):o.markAsEndAlternate(i):n?o.markAsStartGroup():o.markAsEndGroup(),this.nodes.push(o),this.connect(t,r);let s=new _i(r,!0),l=new _i(r,!1);t.push(this.connections.length),this.connections.push(l),t.push(this.connections.length),this.connections.push(s)}endSpecialGroup(){let t=[this.match,this.nomatch,this.error];for(let n=0;n<t.length;n++)this.addSpecialToArr(t[n],!1,-1)}startSpecialGroup(){if(this.nodes.length)throw new Error("invalid call");this.addSpecialToArr(this.match,!0,-1)}endClause(t){this.addSpecialToArr(this.match,!1,t)}startClause(t){if(this.nodes.length)throw new Error("invalid call");let n=new Ar(Vg);n.markAsStartAlternate(t),this.nodes.push(n);let i=new _i(0,!0),r=new _i(0,!1);this.nomatch.push(this.connections.length),this.connections.push(r),this.match.push(this.connections.length),this.connections.push(i)}addPrimitive(t){let n=this.nodes.length;this.nodes.push(new Ar(t));let i=new _i(n,!0),r=new _i(n,!1);this.connect(this.match,n),this.emptyHead?(this.nomatch.push(this.connections.length),this.emptyHead=!1):this.error.push(this.connections.length),this.connections.push(r),this.match.push(this.connections.length),this.connections.push(i)}isSimple(){return this.nodes.length==1&&!this.nodes[0].isSpecial()}isPrimitive(){return this.isSimple()&&this.nodes[0].validator instanceof Ge}addGroup(t,n){if(t.nodes.length==0)return;let i=this.nodes.length;if(n==4&&i==1&&t.isPrimitive()&&this.isPrimitive()){this.nodes[0].validator=this.nodes[0].validator.combine(t.nodes[0].validator);return}for(let o=0;o<t.nodes.length;o++)this.nodes.push(t.nodes[o]);n==4?(this.emptyHead=!0,this.connect(this.nomatch,i)):this.connect(this.match,i);let r=this.connections.length;for(let o=0;o<t.connections.length;o++){let s=t.connections[o];s.where+=i,s.what>=0&&(s.what+=i),this.connections.push(s)}for(let o=0;o<t.match.length;o++)this.match.push(t.match[o]+r);if(n==3&&this.connect(this.match,i),n==2||n==3)for(let o=0;o<t.nomatch.length;o++)this.match.push(t.nomatch[o]+r);else if(this.emptyHead){for(let o=0;o<t.nomatch.length;o++)this.nomatch.push(t.nomatch[o]+r);this.emptyHead=t.emptyHead}else for(let o=0;o<t.nomatch.length;o++)this.error.push(t.nomatch[o]+r);for(let o=0;o<t.error.length;o++)this.error.push(t.error[o]+r);t.nodes=null,t.connections=null}finish(t,n){let i=this.nodes.length;this.nodes.push(t),this.nodes.push(n),this.connect(this.match,i),this.connect(this.nomatch,i+1),this.connect(this.error,i+1);for(let r of this.connections)r.success?this.nodes[r.where].success=this.nodes[r.what]:this.nodes[r.where].failure=this.nodes[r.what];for(let r=0;r<i;r++)if(this.nodes[r].failure==null||this.nodes[r].success==null)throw new Error("Invalid validator state");return this.nodes[0]}},_N=1,q0=2,K0=4,$i=8,$l=16,Pc=32,Dl=64,Q0=128,Fo=256,Oo=512,Nc=1024,Z0=2048,J0=4096,ex=8192,tx=class extends Jn{constructor(){super()}validateForShorthand(e,t){let n=e[t].visit(this);return n?[n]:null}},Ge=class nx extends tx{constructor(t,n,i){super(),this.allowed=t,this.idents=n,this.units=i}visitEmpty(t){return this.allowed&_N?t:null}visitSlash(t){return this.allowed&Z0?t:null}visitStr(t){return this.allowed&q0?t:null}visitIdent(t){return this.idents[t.name.toLowerCase()]||(this.allowed&K0||this.allowed&Dl&&CSS.supports("color",t.name)?t:null)}visitNumeric(t){return t.num==0&&!(this.allowed&Oo)?t.unit=="%"&&this.allowed&Nc?t:null:t.num<0&&!(this.allowed&Fo)?null:this.units[t.unit]?t:null}visitNum(t){return t.num==0?this.allowed&Oo?t:null:t.num<=0&&!(this.allowed&Fo)?null:this.allowed&$l?t:null}visitInt(t){return t.num==0?this.allowed&Oo?t:null:t.num<=0&&!(this.allowed&Fo)?null:this.allowed&(Pc|$l)?t:this.idents[`${t.num}`]||null}visitHexColor(t){return this.allowed&Dl&&/^([0-9A-F]{3,4}|([0-9A-F]{2}){3,4})$/i.test(t.hex)?t:null}visitURL(t){return this.allowed&Q0?t:null}visitURange(t){return this.allowed&J0?t:null}visitSpaceList(t){return null}visitCommaList(t){return null}visitFunc(t){return this.allowed&Dl&&CSS.supports("color",t.toString())||this.allowed&ex&&CSS.supports("background-image",t.toString())||t.name==="calc"&&this.allowed&($i|$l|Pc|Fo|Oo|Nc)?t:null}visitExpr(t){return this.allowed&2046?t:null}combine(t){let n={},i={};for(let r in this.idents)n[r]=this.idents[r];for(let r in t.idents)n[r]=t.idents[r];for(let r in this.units)i[r]=this.units[r];for(let r in t.units)i[r]=t.units[r];return new nx(this.allowed|t.allowed,n,i)}},ye={},Vg=new Ge(0,ye,ye),ap=class extends tx{constructor(e){super(),d(this,"successTerminal"),d(this,"failureTerminal"),d(this,"first"),this.successTerminal=new Ar(null),this.failureTerminal=new Ar(null),this.first=e.finish(this.successTerminal,this.failureTerminal)}validateList(e,t,n){let i=t?[]:e,r=this.first,o=n,s=null,l=null;for(;r!==this.successTerminal&&r!==this.failureTerminal;){if(o>=e.length){r=r.failure;continue}let a=e[o],u=a;if(r.isSpecial()){let h=!0;r.isStartGroup()?(s?s.push(l):s=[l],l=[]):r.isEndGroup()?s.length>0?l=s.pop():l=null:r.isEndAlternate()?l[r.getAlternate()]="taken":h=l[r.getAlternate()]==null,r=h?r.success:r.failure}else{if(o==0&&!t&&r.validator instanceof Jo&&this instanceof Jo){if(u=new Be(e).visit(r.validator),u){o=e.length,r=r.success;continue}}else if(o==0&&!t&&r.validator instanceof up&&this instanceof Jo){if(u=new Rt(e).visit(r.validator),u){o=e.length,r=r.success;continue}}else u=a.visit(r.validator);if(!u){r=r.failure;continue}if(u!==a&&e===i){i=[];for(let h=0;h<o;h++)i[h]=e[h]}e!==i&&(i[o-n]=u),o++,r=r.success}}return r===this.successTerminal&&(t?i.length>0:o==e.length)?i:null}validateSingle(e){let t=null,n=this.first;for(;n!==this.successTerminal&&n!==this.failureTerminal;){if(!e){n=n.failure;continue}if(n.isSpecial()){n=n.success;continue}if(t=e.visit(n.validator),!t){n=n.failure;continue}e=null,n=n.success}return n===this.successTerminal?t:null}visitEmpty(e){return this.validateSingle(e)}visitSlash(e){return this.validateSingle(e)}visitStr(e){return this.validateSingle(e)}visitIdent(e){return this.validateSingle(e)}visitNumeric(e){return this.validateSingle(e)}visitNum(e){return this.validateSingle(e)}visitInt(e){return this.validateSingle(e)}visitHexColor(e){return this.validateSingle(e)}visitURL(e){return this.validateSingle(e)}visitURange(e){return this.validateSingle(e)}visitSpaceList(e){return null}visitCommaList(e){return null}visitFunc(e){return this.validateSingle(e)}visitExpr(e){return null}},Jo=class extends ap{constructor(e){super(e)}visitSpaceList(e){let t=this.validateList(e.values,!1,0);return t===e.values?e:t?new Be(t):null}visitCommaList(e){let t=this.first,n=!1;for(;t;){if(t.validator instanceof up){n=!0;break}t=t.failure}if(n){let i=this.validateList(e.values,!1,0);return i===e.values?e:i?new Rt(i):null}return null}validateForShorthand(e,t){return this.validateList(e,!0,t)}},up=class extends ap{constructor(e){super(e)}visitSpaceList(e){return this.validateSingle(e)}visitCommaList(e){let t=this.validateList(e.values,!1,0);return t===e.values?e:t?new Rt(t):null}validateForShorthand(e,t){let n=this.first,i;for(;n!==this.failureTerminal;){if(i=n.validator.validateForShorthand(e,t),i)return i;n=n.failure}return null}},MN=class extends ap{constructor(e,t){super(t),this.name=e}validateSingle(e){return null}visitFunc(e){if(e.name.toLowerCase()!=this.name)return null;let t=this.validateList(e.values,!1,0);return t===e.values?e:t?new oo(e.name,t):null}},ix=class{tryParse(e,t,n){return t}success(e,t){}},rx=class extends ix{constructor(e,t){super(),this.name=t,d(this,"validator"),this.validator=e.validators[this.name]}tryParse(e,t,n){if(n.values[this.name])return t;let i=this.validator.validateForShorthand(e,t);if(i){let r=i.length,o=r>1?new Be(i):i[0];return this.success(o,n),t+r}return t}success(e,t){t.values[this.name]=e}},zN=class extends rx{constructor(e,t){super(e,t[0]),this.names=t}success(e,t){for(let n=0;n<this.names.length;n++)t.values[this.names[n]]=e}},$N=class extends ix{constructor(e,t){super(),this.nodes=e,this.slash=t}tryParse(e,t,n){let i=t;if(this.slash)if(e[t]==Xa){if(++t==e.length)return i}else return i;let r=this.nodes[0].tryParse(e,t,n);if(r==t)return i;t=r;for(let o=1;o<this.nodes.length&&t<e.length&&(r=this.nodes[o].tryParse(e,t,n),r!=t);o++)t=r;return t}},hp=class extends Jn{constructor(){super(...arguments),d(this,"syntax",null),d(this,"propList",null),d(this,"error",!1),d(this,"values",{}),d(this,"validatorSet",null)}setOwner(e){this.validatorSet=e}syntaxNodeForProperty(e){return new rx(this.validatorSet,e)}clone(){let e=new this.constructor;return e.syntax=this.syntax,e.propList=this.propList,e.validatorSet=this.validatorSet,e}init(e,t){this.syntax=e,this.propList=t}finish(e,t){var n,i;if(!this.error){for(let r of this.propList)t.simpleProperty(r,(i=(n=this.values[r])!=null?n:this.validatorSet.defaultValues[r])!=null?i:S.initial,e);return!0}return!1}propagateDefaultingValue(e,t,n){for(let i of this.propList)n.simpleProperty(i,e,t)}validateList(e){return this.error=!0,0}validateSingle(e){return this.validateList([e]),null}visitEmpty(e){return this.validateSingle(e)}visitStr(e){return this.validateSingle(e)}visitIdent(e){return this.validateSingle(e)}visitNumeric(e){return this.validateSingle(e)}visitNum(e){return this.validateSingle(e)}visitInt(e){return this.validateSingle(e)}visitHexColor(e){return this.validateSingle(e)}visitURL(e){return this.validateSingle(e)}visitSpaceList(e){return this.validateList(e.values),null}visitCommaList(e){return this.error=!0,null}visitFunc(e){return this.validateSingle(e)}visitExpr(e){return this.validateSingle(e)}},uo=class extends hp{constructor(){super()}validateList(e){let t=0,n=0;for(;t<e.length;){let i=this.syntax[n].tryParse(e,t,this);if(i>t){t=i,n=0;continue}if(++n==this.syntax.length){this.error=!0;break}}return t}},ox=class extends hp{constructor(){super()}validateList(e){if(e.length>this.syntax.length||e.length==0)return this.error=!0,0;for(let t=0;t<this.syntax.length;t++){let n=t;for(;n>=e.length;)n=n==1?0:n-2;if(this.syntax[t].tryParse(e,n,this)!=n+1)return this.error=!0,0}return e.length}createSyntaxNode(){return new zN(this.validatorSet,this.propList)}},DN=class extends hp{constructor(){super()}validateList(e){let t=e.length;for(let n=0;n<e.length;n++)if(e[n]===Xa){t=n;break}if(t>this.syntax.length||e.length==0)return this.error=!0,0;for(let n=0;n<this.syntax.length;n++){let i=n;for(;i>=t;)i=i==1?0:i-2;let r;if(t+1<e.length)for(r=t+n+1;r>=e.length;)r=r-(r==t+2?1:2);else r=i;let o=[e[i],e[r]];if(this.syntax[n].tryParse(o,0,this)!=2)return this.error=!0,0}return e.length}},VN=class extends uo{constructor(){super()}mergeIn(e,t){var n,i;for(let r of this.propList){let o=(i=(n=t[r])!=null?n:this.validatorSet.defaultValues[r])!=null?i:S.initial,s=e[r];s||(s=[],e[r]=s),s.push(o)}}visitCommaList(e){let t={};for(let n=0;n<e.values.length;n++)if(this.values={},e.values[n]instanceof Rt?this.error=!0:(e.values[n].visit(this),this.mergeIn(t,this.values),this.values["background-color"]&&n!=e.values.length-1&&(this.error=!0)),this.error)return null;this.values={};for(let n in t)n=="background-color"?this.values[n]=t[n].pop():this.values[n]=new Rt(t[n]);return null}},UN=class extends uo{constructor(){super()}init(e,t){super.init(e,t),this.propList.push("font-family","line-height","font-size","font-stretch","font-variant-ligatures","font-variant-caps","font-variant-numeric","font-variant-east-asian")}validateList(e){let t=super.validateList(e),n=this.values["font-variant_css2"];n&&(delete this.values["font-variant_css2"],this.values["font-variant-caps"]=n);let i=this.values["font-stretch_css3"];if(i&&(delete this.values["font-stretch_css3"],this.values["font-stretch"]=i),t+2>e.length)return this.error=!0,t;this.error=!1;let r=this.validatorSet.validators;if(!e[t].visit(r["font-size"]))return this.error=!0,t;if(this.values["font-size"]=e[t++],e[t]===Xa){if(t++,t+2>e.length)return this.error=!0,t;if(!e[t].visit(r["line-height"]))return this.error=!0,t;this.values["line-height"]=e[t++]}let o=t==e.length-1?e[t]:new Be(e.slice(t,e.length));return o.visit(r["font-family"])?(this.values["font-family"]=o,e.length):(this.error=!0,t)}visitCommaList(e){if(e.values[0].visit(this),this.error)return null;let t=[this.values["font-family"]];for(let i=1;i<e.values.length;i++)t.push(e.values[i]);let n=new Rt(t);return n.visit(this.validatorSet.validators["font-family"])?this.values["font-family"]=n:this.error=!0,null}visitIdent(e){let t=this.validatorSet.systemFonts[e.name];if(t)for(let n in t)this.values[n]=t[n];else this.error=!0;return null}},HN=class extends uo{validateList(e){if(e.length===1&&e[0]instanceof Xt)switch(e[0].name.toLowerCase()){case"normal":e=[this.validatorSet.defaultValues["text-autospace"],this.validatorSet.defaultValues["text-spacing-trim"]];break;case"auto":e=[S.auto,S.auto];break;case"none":e=[K("no-autospace"),K("space-all")];break}return super.validateList(e)}},WN=["unicode-bidi","direction","margin-block-start","margin-block-end","margin-inline-start","margin-inline-end","padding-block-start","padding-block-end","padding-inline-start","padding-inline-end","border-block-start-color","border-block-end-color","border-inline-start-color","border-inline-end-color","border-block-start-style","border-block-end-style","border-inline-start-style","border-inline-end-style","border-block-start-width","border-block-end-width","border-inline-start-width","border-inline-end-width","block-start","block-end","inline-start","inline-end","block-size","inline-size","max-block-size","max-inline-size","min-block-size","min-inline-size","behavior","bleed","conflicting-partitions","crop-offset","crop-marks-line-color","enabled","flow-consume","flow-from","flow-into","flow-linger","flow-options","flow-priority","font-display","font-size-adjust","font-stretch_css3","font-variant_css2","glyph-orientation-vertical","marks","min-page-height","min-page-width","repeat-on-break","required","required-partitions","ruby-align","shape-inside","snap-height","snap-width","template","text-decoration-skip","text-justify","text-zoom","unicode-range","utilization","wrap-flow"],GN=class extends uo{constructor(){super()}init(e,t){super.init(e,t);for(let n in this.validatorSet.validators)WN.includes(n)||this.propList.push(n)}validateList(e){return this.error=!0,0}},Ug={SIMPLE:uo,INSETS:ox,INSETS_SLASH:DN,COMMA:VN,FONT:UN,TEXT_SPACING:HN,ALL:GN},jN=class{constructor(){d(this,"validators",{}),d(this,"prefixes",{}),d(this,"defaultValues",{}),d(this,"namedValidators",{}),d(this,"systemFonts",{}),d(this,"shorthands",{}),d(this,"layoutProps",{}),d(this,"backgroundProps",{})}addReplacement(e,t){let n;if(t.type==3)n=new $(t.num,t.text);else if(t.type==7)n=new uy(t.text);else if(t.type==1)n=K(t.text);else throw new Error("unexpected replacement");if(e.isPrimitive()){let i=e.nodes[0].validator.idents;for(let r in i)i[r]=n;return e}throw new Error("unexpected replacement")}newGroup(e,t){let n=new Co;if(e=="||"){for(let r=0;r<t.length;r++){let o=new Co;o.startClause(r),o.addGroup(t[r],1),o.endClause(r),n.addGroup(o,r==0?1:4)}let i=new Co;return i.startSpecialGroup(),i.addGroup(n,3),i.endSpecialGroup(),i}else{let i;switch(e){case" ":i=1;break;case"|":case"||":i=4;break;default:throw new Error("unexpected op")}for(let r=0;r<t.length;r++)n.addGroup(t[r],r==0?1:i);return n}}addCounts(e,t,n){let i=new Co;for(let r=0;r<t;r++)i.addGroup(e.clone(),1);if(n==Number.POSITIVE_INFINITY)i.addGroup(e,3);else for(let r=t;r<n;r++)i.addGroup(e.clone(),2);return i}primitive(e){let t=new Co;return t.addPrimitive(e),t}newFunc(e,t){let n;switch(e){case"COMMA":n=new up(t);break;case"SPACE":n=new Jo(t);break;default:n=new MN(e.toLowerCase(),t);break}return this.primitive(n)}initBuiltInValidators(){this.namedValidators.COLOR=this.primitive(new Ge(Dl,ye,ye)),this.namedValidators.IMAGE_FUNCTION=this.primitive(new Ge(ex,ye,ye)),this.namedValidators.POS_INT=this.primitive(new Ge(Pc,ye,ye)),this.namedValidators.POS_NUM=this.primitive(new Ge($l,ye,ye)),this.namedValidators.POS_PERCENTAGE=this.primitive(new Ge($i,ye,{"%":ae})),this.namedValidators.NEGATIVE=this.primitive(new Ge(Fo,ye,ye)),this.namedValidators.ZERO=this.primitive(new Ge(Oo,ye,ye)),this.namedValidators.ZERO_PERCENTAGE=this.primitive(new Ge(Nc,ye,ye)),this.namedValidators.POS_LENGTH=this.primitive(new Ge($i,ye,{em:ae,ex:ae,ch:ae,rem:ae,lh:ae,rlh:ae,vw:ae,vh:ae,vi:ae,vb:ae,vmin:ae,vmax:ae,pvw:ae,pvh:ae,pvi:ae,pvb:ae,pvmin:ae,pvmax:ae,cm:ae,mm:ae,in:ae,px:ae,pt:ae,pc:ae,q:ae})),this.namedValidators.POS_ANGLE=this.primitive(new Ge($i,ye,{deg:ae,grad:ae,rad:ae,turn:ae})),this.namedValidators.POS_TIME=this.primitive(new Ge($i,ye,{s:ae,ms:ae})),this.namedValidators.FREQUENCY=this.primitive(new Ge($i,ye,{Hz:ae,kHz:ae})),this.namedValidators.RESOLUTION=this.primitive(new Ge($i,ye,{dpi:ae,dpcm:ae,dppx:ae})),this.namedValidators.URI=this.primitive(new Ge(Q0,ye,ye)),this.namedValidators.URANGE=this.primitive(new Ge(J0,ye,ye)),this.namedValidators.IDENT=this.primitive(new Ge(K0,ye,ye)),this.namedValidators.STRING=this.primitive(new Ge(q0,ye,ye)),this.namedValidators.SLASH=this.primitive(new Ge(Z0,ye,ye));let e={"font-family":K("sans-serif")};this.systemFonts.caption=e,this.systemFonts.icon=e,this.systemFonts.menu=e,this.systemFonts["message-box"]=e,this.systemFonts["small-caption"]=e,this.systemFonts["status-bar"]=e}isBuiltIn(e){return!!e.match(/^[A-Z_0-9]+$/)}readNameAndPrefixes(e,t){let n=e.token();if(n.type==0)return null;let i={"":!0};if(n.type==14){do{if(e.consume(),n=e.token(),n.type!=1)throw new Error("Prefix name expected");i[n.text]=!0,e.consume(),n=e.token()}while(n.type==16);if(n.type!=15)throw new Error("']' expected");e.consume(),n=e.token()}if(n.type!=1)throw new Error("Property name expected");if(t==2?n.text=="SHORTHANDS":n.text=="DEFAULTS")return e.consume(),null;let r=n.text;if(e.consume(),t!=2){if(e.token().type!=39)throw new Error("'=' expected");this.isBuiltIn(r)||(this.prefixes[r]=i)}else if(e.token().type!=18)throw new Error("':' expected");return r}parseValidators(e){for(;;){let t=this.readNameAndPrefixes(e,1);if(!t)return;let n=[],i=[],r="",o,s=!0,l=()=>{if(n.length==0)throw new Error("No values");return n.length==1?n[0]:this.newGroup(r,n)},a=h=>{if(s)throw new Error(`'${h}': unexpected`);if(r&&r!=h)throw new Error(`mixed operators: '${h}' and '${r}'`);r=h,s=!0},u=null;for(;!u;){e.consume();let h=e.token();switch(h.type){case 1:if(s||a(" "),this.isBuiltIn(h.text)){let p=this.namedValidators[h.text];if(!p)throw new Error(`'${h.text}' unexpected`);n.push(p.clone())}else{let p={};p[h.text.toLowerCase()]=K(h.text),n.push(this.primitive(new Ge(0,p,ye)))}s=!1;break;case 5:{let p={};p[`${h.num}`]=new nr(h.num),n.push(this.primitive(new Ge(0,p,ye))),s=!1;break}case 34:a("|");break;case 25:a("||");break;case 14:s||a(" "),i.push({vals:n,op:r,b:"["}),r="",n=[],s=!0;break;case 6:s||a(" "),i.push({vals:n,op:r,b:"(",fn:h.text}),r="",n=[],s=!0;break;case 15:{o=l();let p=i.pop();if(p.b!="[")throw new Error("']' unexpected");n=p.vals,n.push(o),r=p.op,s=!1;break}case 11:{o=l();let p=i.pop();if(p.b!="(")throw new Error("')' unexpected");n=p.vals,n.push(this.newFunc(p.fn,o)),r=p.op,s=!1;break}case 18:if(s)throw new Error("':' unexpected");e.consume(),n.push(this.addReplacement(n.pop(),e.token()));break;case 22:if(s)throw new Error("'?' unexpected");n.push(this.addCounts(n.pop(),0,1));break;case 36:if(s)throw new Error("'*' unexpected");n.push(this.addCounts(n.pop(),0,Number.POSITIVE_INFINITY));break;case 23:if(s)throw new Error("'+' unexpected");n.push(this.addCounts(n.pop(),1,Number.POSITIVE_INFINITY));break;case 12:{if(e.consume(),h=e.token(),h.type!=5)throw new Error("<int> expected");let p=h.num,c=p;if(e.consume(),h=e.token(),h.type==16){if(e.consume(),h=e.token(),h.type!=5)throw new Error("<int> expected");c=h.num,e.consume(),h=e.token()}if(h.type!=13)throw new Error("'}' expected");n.push(this.addCounts(n.pop(),p,c));break}case 17:if(u=l(),i.length>0)throw new Error(`unclosed '${i.pop().b}'`);break;default:throw new Error("unexpected token")}}e.consume(),this.isBuiltIn(t)?this.namedValidators[t]=u:u.isSimple()?this.validators[t]=u.nodes[0].validator:this.validators[t]=new Jo(u)}}parseDefaults(e){for(;;){let t=this.readNameAndPrefixes(e,2);if(!t)return;let n=[];for(;;){e.consume();let i=e.token();if(i.type==17){e.consume();break}switch(i.type){case 1:n.push(K(i.text));break;case 4:n.push(new Ai(i.num));break;case 5:n.push(new nr(i.num));break;case 3:n.push(new $(i.num,i.text));break;default:throw new Error("unexpected token")}}this.defaultValues[t]=n.length>1?new Be(n):n[0]}}parseShorthands(e){for(;;){let t=this.readNameAndPrefixes(e,3);if(!t)return;let n=e.nthToken(1),i;n.type==1&&Ug[n.text]?(i=new Ug[n.text],e.consume()):i=new uo,i.setOwner(this);let r=!1,o=[],s=!1,l=[],a=[];for(;!r;)switch(e.consume(),n=e.token(),n.type){case 1:if(this.validators[n.text])o.push(i.syntaxNodeForProperty(n.text)),n.text.includes("_")||a.push(n.text);else if(this.shorthands[n.text]instanceof ox){let u=this.shorthands[n.text];o.push(u.createSyntaxNode()),a.push(...u.propList)}else throw new Error(`'${n.text}' is neither a simple property nor an inset shorthand`);break;case 19:if(o.length>0||s)throw new Error("unexpected slash");s=!0;break;case 14:l.push({slash:s,syntax:o}),o=[],s=!1;break;case 15:{let u=new $N(o,s),h=l.pop();o=h.syntax,s=h.slash,o.push(u);break}case 17:r=!0,e.consume();break;default:throw new Error("unexpected token")}i.init(o,a),this.shorthands[t]=i}}parse(e){let t=new kn(e,null);this.parseValidators(t),this.parseDefaults(t),this.parseShorthands(t),this.backgroundProps=this.makePropSet(["background"]),this.layoutProps=this.makePropSet(["margin","border","padding","columns","column-gap","column-rule","column-fill"])}makePropSet(e){var t;let n={};for(let i of e){let r=this.shorthands[i],o=r?r.propList:[i];for(let s of o)n[s]=(t=this.defaultValues[s])!=null?t:S.initial}return n}validatePropertyAndHandleShorthand(e,t,n,i){if(Yn(e)||i.ruleType==="font-face"||YN(t)){i.simpleProperty(e,t,n);return}let r="",o=e;e=e.toLowerCase();let s=e.match(/^-([a-z]+)-([-a-z0-9]+)$/);s&&(r=s[1],e=s[2]);let l=this.prefixes[e];if(!l||!l[r]){CSS.supports(o,t.toString())?i.simpleProperty(o,t,n):r&&!_w.includes(`-${r}-`)||i.unknownProperty(o,t);return}let a=this.validators[e];if(a){let u=ge(t)||t.isExpr()?t:t.visit(a);u?i.simpleProperty(e,u,n):!r&&CSS.supports(e,t.toString())?i.simpleProperty(e,t,n):i.invalidPropertyValue(o,t)}else{let u=this.shorthands[e].clone();ge(t)?u.propagateDefaultingValue(t,n,i):(t.visit(u),u.finish(n,i)||i.invalidPropertyValue(o,t))}}};function sx(){let e=new jN;return e.initBuiltInValidators(),e.parse(Cy),e}var XN=class extends Jn{constructor(){super(...arguments),d(this,"varFound",!1)}visitFunc(e){return e.name==="var"?this.varFound=!0:this.varFound||this.visitValues(e.values),null}};function YN(e){let t=new XN;return e.visit(t),t.varFound}`${new Date().valueOf()}`;function cp(e){return Object.keys(e).filter(t=>!["src","font-family","font-display"].includes(t)).sort()}function qN(e){let t=new Xn;for(let n of cp(e))t.append(`${n}:${e[n].toString()};`);return t.toString()}function KN(e,t){let n={};for(let i in e)n[i]=pt(e,i).evaluate(t,i);return n}var lx=class{constructor(e){this.properties=e,d(this,"fontTraitKey"),d(this,"src"),d(this,"blobURLs",[]),d(this,"blobs",[]),d(this,"family"),this.fontTraitKey=qN(this.properties),this.src=this.properties.src?this.properties.src.toString():null;let t=this.properties["font-family"];this.family=t?t.stringValue():null}traitsEqual(e){return this.fontTraitKey==e.fontTraitKey}makeAtRule(e,t){let n=new Xn;n.append(`@font-face {
  font-family: `),n.append(this.family),n.append(`;
  `);for(let i of cp(this.properties))n.append(i),n.append(": "),this.properties[i].appendTo(n,!0),n.append(`;
  `);if(t){n.append('src: url("');let i=Ak(t);n.append(i),this.blobURLs.push(i),this.blobs.push(t),n.append('")')}else n.append("src: "),n.append(e);return n.append(`;
}
`),n.toString()}},QN=class{constructor(e){this.deobfuscator=e,d(this,"familyMap",{})}registerFamily(e,t){let n=e.family,i=this.familyMap[n],r=t.family;if(i){if(i!=r)throw new Error(`E_FONT_FAMILY_INCONSISTENT ${e.family}`)}else this.familyMap[n]=r}filterFontFamily(e){if(e instanceof Rt){let t=e.values,n=[];for(let i of t){let r=this.familyMap[i.stringValue()];r&&n.push(K(r)),n.push(i)}return new Rt(n)}else{let t=this.familyMap[e.stringValue()];return t?new Rt([K(t),e]):e}}},ZN=class{constructor(e,t,n){this.head=e,this.body=t,d(this,"srcURLMap",{}),d(this,"familyPrefix"),d(this,"familyCounter",0),this.familyPrefix=n||"Fnt_"}getViewFontFamily(e,t){let n=e.family,i=t.familyMap[n];return i||(i=this.familyPrefix+ ++this.familyCounter,t.familyMap[n]=i,i)}initFont(e,t,n){let i=X("initFont"),r=e.src,o={};for(let u of cp(e.properties))o[u]=e.properties[u];let s=this.getViewFontFamily(e,n);o["font-family"]=K(s);let l=new lx(o),a=this.head.ownerDocument.createElement("style");return a.textContent=l.makeAtRule(r,t),this.head.appendChild(a),se.debug("Load font:",r),i.finish(l),i.result()}loadFont(e,t){let n=e.src,i=e.family+";"+n,r=this.srcURLMap[i];return r?r.piggyback(o=>{let s=o;s.traitsEqual(e)?(t.registerFamily(e,s),se.debug("Found already-loaded font:",n)):se.warn("E_FONT_FACE_INCOMPATIBLE",e.src)}):(r=new Us(()=>{let o=X("loadFont"),s=n.replace(/^url\("([^"]+)"\).*$/,"$1"),l=t.deobfuscator?t.deobfuscator(s):null;return l?Qa(s,"blob").then(a=>{if(!a.responseBlob){o.finish(null);return}l(a.responseBlob).then(u=>{this.initFont(e,u,t).thenFinish(o)})}):this.initFont(e,null,t).thenFinish(o),o.result()},`loadFont ${n}`),this.srcURLMap[i]=r,r.start()),r}findOrLoadFonts(e,t){let n=[];for(let i of e){if(!i.src||!i.family){se.warn("E_FONT_FACE_INVALID");continue}n.push(this.loadFont(i,t))}return Ka(n).thenAsync(()=>this.waitFontLoading())}waitFontLoading(){let e=this.head.ownerDocument.fonts,t=0;if(e.forEach(i=>{i.status==="unloaded"&&(t++,i.load().catch(r=>{}))}),t===0)return F(!0);let n=X("waitFontLoading");return n.loop(()=>n.sleep(20).thenAsync(()=>e.status==="loading"?F(!0):F(!1))).thenFinish(n),n.result()}},JN=1,nu=class{constructor(e,t,n,i,r){this.name=t,this.pseudoName=n,this.classes=i,this.parent=r,d(this,"specified",{}),d(this,"children",[]),d(this,"pageMaster",null),d(this,"index",0),d(this,"key"),d(this,"_scope"),this._scope=e,this.key=`p${JN++}`,r&&(this.index=r.children.length,r.children.push(this))}get scope(){return this._scope}createInstance(e){throw new Error("E_UNEXPECTED_CALL")}clone(e){throw new Error("E_UNEXPECTED_CALL")}copySpecified(e){let t=this.specified,n=e.specified;for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}cloneChildren(e){for(let t=0;t<this.children.length;t++)this.children[t].clone({parent:e})}},eT=class extends nu{constructor(e){super(e,null,null,[],null),this.specified.width=new fe(Ds,0),this.specified.height=new fe(Vs,0)}},Hg=class extends Gh{constructor(e,t){super(e,i),this.pageMaster=t;let n=this;function i(r,o){let s=r.match(/^([^.]+)\.([^.]+)$/);if(s){let l=n.pageMaster.keyMap[s[1]];if(l){let a=this.lookupInstance(l);if(a)return o?a.resolveFunc(s[2]):a.resolveName(s[2])}}return null}}},ax=class ux extends nu{constructor(t,n,i,r,o,s,l){super(t,n,i,r,o),this.condition=s,this.specificity=l,d(this,"keyMap",{}),t instanceof Hg||(this._scope=new Hg(t,this)),this.pageMaster=this,this.specified.width=new fe(Ds,0),this.specified.height=new fe(Vs,0),this.specified["wrap-flow"]=new fe(S.auto,0),this.specified.position=new fe(S.relative,0),this.specified.overflow=new fe(S.visible,0)}createInstance(t){return new pp(t,this)}clone(t){let n=new ux(this.scope,this.name,t.pseudoName||this.pseudoName,this.classes,this.parent,this.condition,this.specificity);return this.copySpecified(n),this.cloneChildren(n),n}resetScope(){this.scope.pageMaster=this}},hx=class cx extends nu{constructor(t,n,i,r,o){super(t,n,i,r,o),this.pageMaster=o.pageMaster,n&&(this.pageMaster.keyMap[n]=this.key),this.specified["wrap-flow"]=new fe(S.auto,0)}createInstance(t){return new rT(t,this)}clone(t){let n=new cx(t.parent.scope,this.name,this.pseudoName,this.classes,t.parent);return this.copySpecified(n),this.cloneChildren(n),n}},Xs=class dx extends nu{constructor(t,n,i,r,o){super(t,n,i,r,o),this.pageMaster=o.pageMaster,n&&(this.pageMaster.keyMap[n]=this.key)}createInstance(t){return new Ys(t,this)}clone(t){let n=new dx(t.parent.scope,this.name,this.pseudoName,this.classes,t.parent);return this.copySpecified(n),this.cloneChildren(n),n}};function tT(e,t,n){return!t||ge(t)?new nt(e,n):t.toExpr(e,e.zero)}function Ce(e,t,n){return!t||t===S.auto||ge(t)?null:t.toExpr(e,n)}function nT(e,t,n){return!t||t===S.normal||ge(t)?null:t.toExpr(e,n)}function Ut(e,t,n){return!t||t===S.auto||ge(t)?e.zero:t.toExpr(e,n)}function Wg(e,t,n){return!t||ge(t)?e.zero:t===S.auto?null:t.toExpr(e,n)}function Rn(e,t,n,i){return!t||n===S.none||ge(t)?e.zero:t.toExpr(e,i)}function px(e,t,n){return!t||ge(t)?n:t===S._true?e._true:t===S._false?e._false:t.toExpr(e,e.zero)}var iu=class{constructor(e,t){this.parentInstance=e,this.pageBox=t,d(this,"cascaded",{}),d(this,"style",{}),d(this,"autoWidth",null),d(this,"autoHeight",null),d(this,"children",[]),d(this,"isAutoWidth",!1),d(this,"isAutoHeight",!1),d(this,"isTopDependentOnAutoHeight",!1),d(this,"isRightDependentOnAutoWidth",!1),d(this,"calculatedWidth",0),d(this,"calculatedHeight",0),d(this,"pageMasterInstance",null),d(this,"namedValues",{}),d(this,"namedFuncs",{}),d(this,"vertical",!1),d(this,"rtl",!1),d(this,"suppressEmptyBoxGeneration",!1),d(this,"borderBoxSizing",!1),e&&e.children.push(this)}reset(){this.calculatedWidth=0,this.calculatedHeight=0}addNamedValues(e,t){let n=this.resolveName(e),i=this.resolveName(t);if(!n||!i)throw new Error("E_INTERNAL");return pe(this.pageBox.scope,n,i)}resolveName(e){let t=this.namedValues[e];if(t)return t;let n=this.style[e];switch(n&&(t=n.toExpr(this.pageBox.scope,this.pageBox.scope.zero)),e){case"margin-left-edge":t=this.resolveName("left");break;case"margin-top-edge":t=this.resolveName("top");break;case"margin-right-edge":t=this.addNamedValues("border-right-edge","margin-right");break;case"margin-bottom-edge":t=this.addNamedValues("border-bottom-edge","margin-bottom");break;case"border-left-edge":t=this.addNamedValues("margin-left-edge","margin-left");break;case"border-top-edge":t=this.addNamedValues("margin-top-edge","margin-top");break;case"border-right-edge":t=this.addNamedValues("padding-right-edge","border-right-width");break;case"border-bottom-edge":t=this.addNamedValues("padding-bottom-edge","border-bottom-width");break;case"padding-left-edge":t=this.addNamedValues("border-left-edge","border-left-width");break;case"padding-top-edge":t=this.addNamedValues("border-top-edge","border-top-width");break;case"padding-right-edge":t=this.addNamedValues("right-edge","padding-right");break;case"padding-bottom-edge":t=this.addNamedValues("bottom-edge","padding-bottom");break;case"left-edge":t=this.addNamedValues("padding-left-edge","padding-left");break;case"top-edge":t=this.addNamedValues("padding-top-edge","padding-top");break;case"right-edge":t=this.addNamedValues("left-edge","width");break;case"bottom-edge":t=this.addNamedValues("top-edge","height");break}if(!t){let i;if(e=="extent")i=this.vertical?"width":"height";else if(e=="measure")i=this.vertical?"height":"width";else{let r=this.vertical?a0:u0;i=e;for(let o in r)i=i.replace(o,r[o])}i!=e&&(t=this.resolveName(i))}return t&&(this.namedValues[e]=t),t}resolveFunc(e){let t=this.namedFuncs[e];if(t)return t;switch(e){case"columns":{let n=this.pageBox.scope,i=new ry(n,0),r=this.resolveName("column-count"),o=this.resolveName("column-width"),s=this.resolveName("column-gap");t=Se(n,Bl(n,new Go(n,"min",[i,r]),pe(n,o,s)),s);break}}return t&&(this.namedFuncs[e]=t),t}initEnabled(){let e=this.pageBox.scope,t=this.style,n=px(e,t.enabled,e._true),i=Ce(e,t.page,e.zero);if(i){let s=new qe(e,"page-number");n=an(e,n,new $d(e,i,s))}let r=Ce(e,t["min-page-width"],e.zero);r&&(n=an(e,n,new Xh(e,new qe(e,"page-width"),r)));let o=Ce(e,t["min-page-height"],e.zero);o&&(n=an(e,n,new Xh(e,new qe(e,"page-height"),o))),n=this.boxSpecificEnabled(n),t.enabled=new ie(n)}boxSpecificEnabled(e){return e}initHorizontal(){let e=this.pageBox.scope,t=this.style,n=this.parentInstance?this.parentInstance.style.width.toExpr(e,null):null,i=Ce(e,t.left,n),r=Ce(e,t["margin-left"],n),o=Rn(e,t["border-left-width"],t["border-left-style"],n),s=Ut(e,t["padding-left"],n),l=Ce(e,t.width,n),a=Ce(e,t["max-width"],n),u=Ut(e,t["padding-right"],n),h=Rn(e,t["border-right-width"],t["border-right-style"],n),p=Ce(e,t["margin-right"],n),c=Ce(e,t.right,n),f=pe(e,o,s),v=pe(e,o,u);if(i&&c&&l){let g=Se(e,n,pe(e,l,pe(e,pe(e,i,f),v)));r?p?c=Se(e,g,p):p=Se(e,g,pe(e,c,r)):(g=Se(e,g,c),p?r=Se(e,g,p):(r=Bl(e,g,new nt(e,.5)),p=r))}else{r||(r=e.zero),p||(p=e.zero),!i&&!c&&!l&&(i=e.zero),!i&&!l?(l=this.autoWidth,this.isAutoWidth=!0):!i&&!c?i=e.zero:!l&&!c&&(l=this.autoWidth,this.isAutoWidth=!0);let g=Se(e,n,pe(e,pe(e,r,f),pe(e,p,v)));this.isAutoWidth&&(a||(a=Se(e,g,i||c)),!this.vertical&&(Ce(e,t["column-width"],null)||Ce(e,t["column-count"],null))&&(l=a,this.isAutoWidth=!1)),i?l?c||(c=Se(e,g,pe(e,i,l))):l=Se(e,g,pe(e,i,c)):i=Se(e,g,pe(e,c,l))}let w=t["snap-width"]||(this.parentInstance?this.parentInstance.style["snap-width"]:null),y=Ut(e,w,n);t.left=new ie(i),t["margin-left"]=new ie(r),t["border-left-width"]=new ie(o),t["padding-left"]=new ie(s),t.width=new ie(l),t["max-width"]=new ie(a||l),t["padding-right"]=new ie(u),t["border-right-width"]=new ie(h),t["margin-right"]=new ie(p),t.right=new ie(c),t["snap-width"]=new ie(y)}initVertical(){let e=this.pageBox.scope,t=this.style,n=this.parentInstance?this.parentInstance.style.width.toExpr(e,null):null,i=this.parentInstance?this.parentInstance.style.height.toExpr(e,null):null,r=Ce(e,t.top,i),o=Ce(e,t["margin-top"],n),s=Rn(e,t["border-top-width"],t["border-top-style"],n),l=Ut(e,t["padding-top"],n),a=Ce(e,t.height,i),u=Ce(e,t["max-height"],i),h=Ut(e,t["padding-bottom"],n),p=Rn(e,t["border-bottom-width"],t["border-bottom-style"],n),c=Ce(e,t["margin-bottom"],n),f=Ce(e,t.bottom,i),v=pe(e,s,l),w=pe(e,p,h);if(r&&f&&a){let m=Se(e,i,pe(e,a,pe(e,pe(e,r,v),w)));o?c?f=Se(e,m,o):c=Se(e,m,pe(e,f,o)):(m=Se(e,m,f),c?o=Se(e,m,c):(o=Bl(e,m,new nt(e,.5)),c=o))}else{o||(o=e.zero),c||(c=e.zero),!r&&!f&&!a&&(r=e.zero),!r&&!a?(a=this.autoHeight,this.isAutoHeight=!0):!r&&!f?r=e.zero:!a&&!f&&(a=this.autoHeight,this.isAutoHeight=!0);let m=Se(e,i,pe(e,pe(e,o,v),pe(e,c,w)));this.isAutoHeight&&(u||(u=Se(e,m,r||f)),this.vertical&&(Ce(e,t["column-width"],null)||Ce(e,t["column-count"],null))&&(a=u,this.isAutoHeight=!1)),r?a?f||(f=Se(e,m,pe(e,r,a))):a=Se(e,m,pe(e,f,r)):r=Se(e,m,pe(e,f,a))}let y=t["snap-height"]||(this.parentInstance?this.parentInstance.style["snap-height"]:null),g=Ut(e,y,n);t.top=new ie(r),t["margin-top"]=new ie(o),t["border-top-width"]=new ie(s),t["padding-top"]=new ie(l),t.height=new ie(a),t["max-height"]=new ie(u||a),t["padding-bottom"]=new ie(h),t["border-bottom-width"]=new ie(p),t["margin-bottom"]=new ie(c),t.bottom=new ie(f),t["snap-height"]=new ie(g)}initColumns(){let e=this.pageBox.scope,t=this.style,n=Ce(e,t[this.vertical?"height":"width"],null),i=Ce(e,t["column-width"],n),r=Ce(e,t["column-count"],null),o=nT(e,t["column-gap"],null);o||(o=new $s(e,1,"em")),i&&!r&&(r=new Go(e,"floor",[Yh(e,pe(e,n,o),pe(e,i,o))]),r=new Go(e,"max",[e.one,r])),r||(r=e.one),i=Se(e,Yh(e,pe(e,n,o),r),o),t["column-width"]=new ie(i),t["column-count"]=new ie(r),t["column-gap"]=new ie(o)}depends(e,t,n){return this.style[e].toExpr(this.pageBox.scope,null).depend(t,n)}init(e){var t;e.registerInstance(this.pageBox.key,this);let n=this.pageBox.scope,i=this.style,r=this.parentInstance?this.parentInstance.getActiveRegions(e):null,o=N0(this.cascaded,e,r,!1);this.vertical=E0(o,e,this.parentInstance?this.parentInstance.vertical:!1),this.rtl=P0(o,e,this.parentInstance?this.parentInstance.rtl:!1),this.borderBoxSizing=((t=o["box-sizing"])==null?void 0:t.value)===S.border_box;let s=!!(e instanceof wp&&e.currentLayoutPosition&&new qe(n,"left-page").evaluate(e));I0(o,i,this.vertical,this.rtl,s,(l,a)=>a.value),this.autoWidth=new st(n,()=>this.calculatedWidth,"autoWidth"),this.autoHeight=new st(n,()=>this.calculatedHeight,"autoHeight"),this.initHorizontal(),this.initVertical(),this.initColumns(),this.initEnabled()}getProp(e,t){var n,i;let r=this.style[t];return!r&&qo(t)&&(t==="font-size"&&e.isRelativeRootFontSize&&e.rootFontSize?r=new $(e.rootFontSize,"px"):r=(i=((n=e.styler)==null?void 0:n.rootStyle)[t])==null?void 0:i.value),r&&(r=ka(e,r,t)),r}getPropAsNumber(e,t){var n,i;let r=this.style[t];if(r){let o=/\b(height|top|bottom)\b/.test(t)?(n=e.pageAreaHeight)!=null?n:e.pageHeight():(i=e.pageAreaWidth)!=null?i:e.pageWidth();r=ka(e,r,t,o)}return Pt(r,e)}getSpecial(e,t){let n=d0(this.cascaded,t);if(n){let i=[];for(let r=0;r<n.length;r++){let o=n[r].evaluate(e,"");o&&o!==ae&&i.push(o)}if(i.length)return i}return null}getActiveRegions(e){let t=this.getSpecial(e,"region-id");if(t){let n=[];for(let i=0;i<t.length;i++)n[i]=t[i].toString();return n}return null}propagateProperty(e,t,n,i){this.propagatePropertyToElement(e,t.element,n,i)}propagatePropertyToElement(e,t,n,i){let r=this.getProp(e,n);r&&(r.isNumeric()&&Xw(r.unit)&&(r=cy(r,e)),n==="font-family"&&(r=i.filterFontFamily(r)),(n.startsWith("background")||n==="z-index")&&t.parentElement.hasAttribute("data-vivliostyle-bleed-box")&&(t=t.parentElement),O(t,n,r.toString()))}propagateDelayedProperty(e,t,n,i){let r=this.getProp(e,n);r&&i.push(new Xd(t.element,n,r))}assignLeftPosition(e,t){let n=this.getPropAsNumber(e,"left"),i=this.getPropAsNumber(e,"margin-left"),r=this.getPropAsNumber(e,"padding-left"),o=this.getPropAsNumber(e,"border-left-width"),s=this.getPropAsNumber(e,"width");t.setHorizontalPosition(n,s),O(t.element,"margin-left",`${i}px`),O(t.element,"padding-left",`${r}px`),O(t.element,"border-left-width",`${o}px`),t.marginLeft=i,t.borderLeft=o,t.paddingLeft=r}assignRightPosition(e,t){let n=this.getPropAsNumber(e,"right"),i=this.getPropAsNumber(e,"snap-height"),r=this.getPropAsNumber(e,"margin-right"),o=this.getPropAsNumber(e,"padding-right"),s=this.getPropAsNumber(e,"border-right-width");if(O(t.element,"margin-right",`${r}px`),O(t.element,"padding-right",`${o}px`),O(t.element,"border-right-width",`${s}px`),t.marginRight=r,t.borderRight=s,this.vertical&&i>0){let l=n+t.getInsetRight(),a=l-Math.floor(l/i)*i;a>0&&(t.snapOffsetX=i-a,o+=t.snapOffsetX)}t.paddingRight=o,t.snapWidth=i}assignTopPosition(e,t){let n=this.getPropAsNumber(e,"snap-height"),i=this.getPropAsNumber(e,"top"),r=this.getPropAsNumber(e,"margin-top"),o=this.getPropAsNumber(e,"padding-top"),s=this.getPropAsNumber(e,"border-top-width");if(t.top=i,t.marginTop=r,t.borderTop=s,t.snapHeight=n,!this.vertical&&n>0){let l=i+t.getInsetTop(),a=l-Math.floor(l/n)*n;a>0&&(t.snapOffsetY=n-a,o+=t.snapOffsetY)}t.paddingTop=o,O(t.element,"top",`${i}px`),O(t.element,"margin-top",`${r}px`),O(t.element,"padding-top",`${o}px`),O(t.element,"border-top-width",`${s}px`)}assignBottomPosition(e,t){let n=this.getPropAsNumber(e,"margin-bottom"),i=this.getPropAsNumber(e,"padding-bottom"),r=this.getPropAsNumber(e,"border-bottom-width"),o=this.getPropAsNumber(e,"height")-t.snapOffsetY;O(t.element,"height",`${o}px`),O(t.element,"margin-bottom",`${n}px`),O(t.element,"padding-bottom",`${i}px`),O(t.element,"border-bottom-width",`${r}px`),t.height=o-t.snapOffsetY,t.marginBottom=n,t.borderBottom=r,t.paddingBottom=i}assignBeforePosition(e,t){this.vertical?this.assignRightPosition(e,t):this.assignTopPosition(e,t)}assignAfterPosition(e,t){this.vertical?this.assignLeftPosition(e,t):this.assignBottomPosition(e,t)}assignStartEndPosition(e,t){this.vertical?(this.assignTopPosition(e,t),this.assignBottomPosition(e,t)):(this.assignRightPosition(e,t),this.assignLeftPosition(e,t))}sizeWithMaxHeight(e,t){O(t.element,"border-top-width","0px");let n=this.getPropAsNumber(e,"max-height");this.isTopDependentOnAutoHeight?t.setVerticalPosition(0,n):(this.assignTopPosition(e,t),n-=t.snapOffsetY,t.height=n,O(t.element,"height",`${n}px`))}sizeWithMaxWidth(e,t){O(t.element,"border-left-width","0px");let n=this.getPropAsNumber(e,"max-width");if(this.isRightDependentOnAutoWidth)t.setHorizontalPosition(0,n);else{this.assignRightPosition(e,t),n-=t.snapOffsetX,t.width=n;let i=this.getPropAsNumber(e,"right");O(t.element,"right",`${i}px`),O(t.element,"width",`${n}px`)}}prepareContainer(e,t,n,i,r){(!this.parentInstance||this.vertical!=this.parentInstance.vertical)&&O(t.element,"writing-mode",this.vertical?"vertical-rl":"horizontal-tb"),(!this.parentInstance||this.rtl!=this.parentInstance.rtl)&&O(t.element,"direction",this.rtl?"rtl":"ltr"),(this.vertical?this.isAutoWidth:this.isAutoHeight)?this.vertical?this.sizeWithMaxWidth(e,t):this.sizeWithMaxHeight(e,t):(this.assignBeforePosition(e,t),this.assignAfterPosition(e,t)),(this.vertical?this.isAutoHeight:this.isAutoWidth)?this.vertical?this.sizeWithMaxHeight(e,t):this.sizeWithMaxWidth(e,t):this.assignStartEndPosition(e,t);for(let o=0;o<Gg.length;o++)this.propagateProperty(e,t,Gg[o],i)}transferContentProps(e,t,n,i){for(let r=0;r<Xg.length;r++)this.propagateProperty(e,t,Xg[r],i);if(this.style["text-overflow"]){let r=t.element.firstElementChild;O(r,"text-overflow","inherit"),O(r,"overflow","inherit")}}transferSingleUriContentProps(e,t,n){let i=()=>{var o,s;let l=(s=(o=this.cascaded.width)!=null?o:this.cascaded[this.vertical?"block-size":"inline-size"])==null?void 0:s.value;return!!l&&l!==S.auto&&!ge(l)},r=()=>{var o,s;let l=(s=(o=this.cascaded.height)!=null?o:this.cascaded[this.vertical?"inline-size":"block-size"])==null?void 0:s.value;return!!l&&l!==S.auto&&!ge(l)};for(let o=0;o<Yg.length;o++){let s=Yg[o];if(s==="width"||s==="height"){if(s==="width"&&!i()||s==="height"&&!r())continue;O(t,s,"100%");continue}this.propagatePropertyToElement(e,t,s,n)}}finishContainer(e,t,n,i,r,o,s){this.vertical?this.calculatedWidth=t.computedBlockSize+t.snapOffsetX:this.calculatedHeight=t.computedBlockSize+t.snapOffsetY;let l=(this.vertical||!i)&&this.isAutoHeight,a=(!this.vertical||!i)&&this.isAutoWidth,u=null;if((a||l)&&(a&&O(t.element,"width","auto"),l&&O(t.element,"height","auto"),u=o.getElementClientRect(i?i.element:t.element),a&&(this.calculatedWidth=Math.ceil(u.right-u.left-t.paddingLeft-t.borderLeft-t.paddingRight-t.borderRight),this.vertical&&(this.calculatedWidth+=t.snapOffsetX)),l&&(this.calculatedHeight=u.bottom-u.top-t.paddingTop-t.borderTop-t.paddingBottom-t.borderBottom,this.vertical||(this.calculatedHeight+=t.snapOffsetY))),(this.vertical?this.isAutoHeight:this.isAutoWidth)&&this.assignStartEndPosition(e,t),(this.vertical?this.isAutoWidth:this.isAutoHeight)&&((this.vertical?this.isRightDependentOnAutoWidth:this.isTopDependentOnAutoHeight)&&this.assignBeforePosition(e,t),this.assignAfterPosition(e,t)),r>1){let h=this.getPropAsNumber(e,"column-rule-width"),p=this.getProp(e,"column-rule-style"),c=this.getProp(e,"column-rule-color");if(h>0&&p&&p!=S.none&&c!=S.transparent){let f=this.getPropAsNumber(e,"column-gap"),v=this.vertical?t.height:t.width,w=this.vertical?"border-top":"border-left";for(let y=1;y<r;y++){let g=this.vertical?(v+f)*y/r-f/2+t.paddingTop-h/2:(v+f)*y/r-f/2+t.paddingLeft-h/2,m=this.vertical?t.width+t.paddingLeft+t.paddingRight:t.height+t.paddingTop+t.paddingBottom,x=t.element.ownerDocument.createElement("div");O(x,"position","absolute"),O(x,this.vertical?"left":"top","0px"),O(x,this.vertical?"top":"left",`${g}px`),O(x,this.vertical?"height":"width","0px"),O(x,this.vertical?"width":"height",`${m}px`),O(x,w,`${h}px ${p.toString()}${c?` ${c.toString()}`:""}`),t.element.insertBefore(x,t.element.firstChild)}}}for(let h=0;h<jg.length;h++)this.propagateProperty(e,t,jg[h],s);for(let h=0;h<qg.length;h++)this.propagateDelayedProperty(e,t,qg[h],n.delayedItems)}applyCascadeAndInit(e,t){let n=this.cascaded,i=this.pageBox.specified;for(let o in i)this instanceof ts&&this.pageBox.pseudoName=="vivliostyle-page-rule-master"&&(o==="writing-mode"||o==="direction")||Vr(o)&&Yi(n,o,pt(i,o));if(this.pageBox.pseudoName==dp)for(let o in t)(o.match(/^background-/)||o=="writing-mode")&&(n[o]=t[o]);if(this.pageBox.pseudoName=="layout-host")for(let o in t)!o.match(/^background-/)&&o!="writing-mode"&&(n[o]=t[o]);e.pushRule(this.pageBox.classes,null,n);let r=n.content;r&&(n.content=r.filterValue(new xc(e,null,e.counterResolver))),this.init(e.context);for(let o of this.pageBox.children)o.createInstance(this).applyCascadeAndInit(e,t);e.popRule()}resolveAutoSizing(e){this.isAutoWidth&&(this.isRightDependentOnAutoWidth=this.depends("right",this.autoWidth,e)||this.depends("margin-right",this.autoWidth,e)||this.depends("border-right-width",this.autoWidth,e)||this.depends("padding-right",this.autoWidth,e)),this.isAutoHeight&&(this.isTopDependentOnAutoHeight=this.depends("top",this.autoHeight,e)||this.depends("margin-top",this.autoHeight,e)||this.depends("border-top-width",this.autoHeight,e)||this.depends("padding-top",this.autoHeight,e));for(let t of this.children)t.resolveAutoSizing(e)}},Gg=["border-left-style","border-right-style","border-top-style","border-bottom-style","border-left-color","border-right-color","border-top-color","border-bottom-color","box-sizing","outline-style","outline-color","outline-width","overflow","visibility"],jg=["border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius","border-start-start-radius","border-start-end-radius","border-end-start-radius","border-end-end-radius","border-image-source","border-image-slice","border-image-width","border-image-outset","border-image-repeat","background-attachment","background-color","background-image","background-repeat","background-position","background-clip","background-origin","background-size","box-shadow","opacity","z-index","background-blend-mode","isolation","mix-blend-mode","filter"],Xg=["color","font-family","font-size","font-style","font-weight","line-height","letter-spacing","text-align","text-align-last","text-decoration","text-indent","text-transform","white-space","text-wrap","text-wrap-mode","text-wrap-style","word-spacing","font-feature-settings","font-kerning","font-size-adjust","font-variant-ligatures","font-variant-caps","font-variant-numeric","font-variant-east-asian","font-stretch","text-combine-upright","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-skip-ink","text-decoration-style","text-decoration-thickness","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-fill-color","text-orientation","text-shadow","text-stroke-color","text-stroke-width","text-underline-offset","text-underline-position","text-overflow"],Yg=["width","height","image-resolution","object-fit","object-position"],qg=["transform","transform-origin"],dp="background-host",iT=class extends iu{constructor(e){super(null,e)}applyCascadeAndInit(e,t){super.applyCascadeAndInit(e,t),this.children.sort((n,i)=>i.pageBox.specificity-n.pageBox.specificity||n.pageBox.index-i.pageBox.index)}},pp=class extends iu{constructor(e,t){super(e,t),this.pageMasterInstance=this}boxSpecificEnabled(e){let t=this.pageBox.pageMaster;return t.condition&&(e=an(t.scope,e,t.condition)),e}adjustPageLayout(e,t,n){}},rT=class extends iu{constructor(e,t){super(e,t),this.pageMasterInstance=e.pageMasterInstance}},Ys=class extends iu{constructor(e,t){super(e,t),this.pageMasterInstance=e.pageMasterInstance}processPartitionList(e,t,n){let i=null;if(t instanceof Xt&&(i=[t]),t instanceof Rt&&(i=t.values),i){let r=this.pageBox.scope;for(let o=0;o<i.length;o++)if(i[o]instanceof Xt){let s=Wh(i[o].name,"enabled"),l=new qe(r,s);n&&(l=new xi(r,l)),e=an(r,e,l)}}return e}boxSpecificEnabled(e){let t=this.pageBox.scope,n=this.style,i=px(t,n.required,t._false)!==t._false;if(i||this.isAutoHeight){let r=tT(t,n["flow-from"],"body"),o=new Go(t,"has-content",[r]);e=an(t,e,o)}if(e=this.processPartitionList(e,n["required-partitions"],!1),e=this.processPartitionList(e,n["conflicting-partitions"],!0),i){let r=this.pageMasterInstance.style.enabled,o=r?r.toExpr(t,null):t._true;o=an(t,o,e),this.pageMasterInstance.style.enabled=new ie(o)}return e}prepareContainer(e,t,n,i,r){var o;this.pageBox.pageMaster instanceof wx||(O(t.element,"overflow","hidden"),t.element.setAttribute("data-vivliostyle-page-partition",(o=this.pageBox.name)!=null?o:"")),super.prepareContainer(e,t,n,i,r)}},fp=class extends Hs{constructor(e,t,n,i){super(e,t,!1),this.target=n,this.validatorSet=i}property(e,t,n){this.validatorSet.validatePropertyAndHandleShorthand(e,t,n,this)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}simpleProperty(e,t,n){this.target.specified[e]=new fe(t,n?Ay:Ly)}},fx=class extends fp{constructor(e,t,n,i){super(e,t,n,i)}},oT=class gx extends fp{constructor(t,n,i,r){super(t,n,i,r),i.specified.width=new fe(Zf,0),i.specified.height=new fe(Zf,0)}startPartitionRule(t,n,i){let r=new Xs(this.scope,t,n,i,this.target),o=new fx(this.scope,this.owner,r,this.validatorSet);this.owner.pushHandler(o)}startPartitionGroupRule(t,n,i){let r=new hx(this.scope,t,n,i,this.target),o=new gx(this.scope,this.owner,r,this.validatorSet);this.owner.pushHandler(o)}},sT=class extends fp{constructor(e,t,n,i){super(e,t,n,i)}startPartitionRule(e,t,n){let i=new Xs(this.scope,e,t,n,this.target),r=new fx(this.scope,this.owner,i,this.validatorSet);this.owner.pushHandler(r)}startPartitionGroupRule(e,t,n){let i=new hx(this.scope,e,t,n,this.target),r=new oT(this.scope,this.owner,i,this.validatorSet);this.owner.pushHandler(r)}};function mx(e){var t,n;let i=(t=e["writing-mode"])==null?void 0:t.value,r=(n=e.direction)==null?void 0:n.value;return i===S.vertical_lr||i!==S.vertical_rl&&r!==S.rtl?"ltr":"rtl"}var lT={a10:{width:new $(26,"mm"),height:new $(37,"mm")},a9:{width:new $(37,"mm"),height:new $(52,"mm")},a8:{width:new $(52,"mm"),height:new $(74,"mm")},a7:{width:new $(74,"mm"),height:new $(105,"mm")},a6:{width:new $(105,"mm"),height:new $(148,"mm")},a5:{width:new $(148,"mm"),height:new $(210,"mm")},a4:{width:new $(210,"mm"),height:new $(297,"mm")},a3:{width:new $(297,"mm"),height:new $(420,"mm")},a2:{width:new $(420,"mm"),height:new $(594,"mm")},a1:{width:new $(594,"mm"),height:new $(841,"mm")},a0:{width:new $(841,"mm"),height:new $(1189,"mm")},b10:{width:new $(31,"mm"),height:new $(44,"mm")},b9:{width:new $(44,"mm"),height:new $(62,"mm")},b8:{width:new $(62,"mm"),height:new $(88,"mm")},b7:{width:new $(88,"mm"),height:new $(125,"mm")},b6:{width:new $(125,"mm"),height:new $(176,"mm")},b5:{width:new $(176,"mm"),height:new $(250,"mm")},b4:{width:new $(250,"mm"),height:new $(353,"mm")},b3:{width:new $(353,"mm"),height:new $(500,"mm")},b2:{width:new $(500,"mm"),height:new $(707,"mm")},b1:{width:new $(707,"mm"),height:new $(1e3,"mm")},b0:{width:new $(1e3,"mm"),height:new $(1414,"mm")},c10:{width:new $(28,"mm"),height:new $(40,"mm")},c9:{width:new $(40,"mm"),height:new $(57,"mm")},c8:{width:new $(57,"mm"),height:new $(81,"mm")},c7:{width:new $(81,"mm"),height:new $(114,"mm")},c6:{width:new $(114,"mm"),height:new $(162,"mm")},c5:{width:new $(162,"mm"),height:new $(229,"mm")},c4:{width:new $(229,"mm"),height:new $(324,"mm")},c3:{width:new $(324,"mm"),height:new $(458,"mm")},c2:{width:new $(458,"mm"),height:new $(648,"mm")},c1:{width:new $(648,"mm"),height:new $(917,"mm")},c0:{width:new $(917,"mm"),height:new $(1297,"mm")},"jis-b10":{width:new $(32,"mm"),height:new $(45,"mm")},"jis-b9":{width:new $(45,"mm"),height:new $(64,"mm")},"jis-b8":{width:new $(64,"mm"),height:new $(91,"mm")},"jis-b7":{width:new $(91,"mm"),height:new $(128,"mm")},"jis-b6":{width:new $(128,"mm"),height:new $(182,"mm")},"jis-b5":{width:new $(182,"mm"),height:new $(257,"mm")},"jis-b4":{width:new $(257,"mm"),height:new $(364,"mm")},"jis-b3":{width:new $(364,"mm"),height:new $(515,"mm")},"jis-b2":{width:new $(515,"mm"),height:new $(728,"mm")},"jis-b1":{width:new $(728,"mm"),height:new $(1030,"mm")},"jis-b0":{width:new $(1030,"mm"),height:new $(1456,"mm")},letter:{width:new $(8.5,"in"),height:new $(11,"in")},legal:{width:new $(8.5,"in"),height:new $(14,"in")},ledger:{width:new $(11,"in"),height:new $(17,"in")}},aT=new $(.24,"pt");new $(3,"mm");var uT=new $(10,"mm"),hT=new $(13,"mm");function Na(e){let t={width:Ds,height:Vs,bleed:Ie,bleedOffset:Ie,cropOffset:Ie},n=e.size;if(!(!n||n.value===S.auto)){let u=n.value,h,p;if(u.isSpaceList()?(h=u.values[0],p=u.values[1]):(h=u,p=null),h.isNumeric())t.width=h,t.height=p||h;else{let c=h.name&&lT[h.name.toLowerCase()];c&&(p&&p===S.landscape?(t.width=c.height,t.height=c.width):(t.width=c.width,t.height=c.height))}}let i=e.marks,r=e.bleed,o=i&&!ge(i.value)?i.value:S.none,s=r&&!ge(r.value)?r.value:S.auto;if(s===S.auto){if(o!==S.none){let u=!1;o.isSpaceList()?u=o.values.some(h=>h===S.crop):u=o===S.crop,u&&(t.bleed=new $(6,"pt"))}}else s.isNumeric()&&(t.bleed=s);let l=e["crop-offset"],a=l&&!ge(l.value)?l.value:S.auto;return a===S.auto?o!==S.none&&(t.bleedOffset=hT):a.isNumeric()&&(t.cropOffset=a),t}function Kg(e,t){let n={},i=Math.max(0,e.bleed.num)*t.queryUnitSize(e.bleed.unit,!1),r=!e.cropOffset.num&&e.bleedOffset.num?e.bleedOffset.num*t.queryUnitSize(e.bleedOffset.unit,!1):Math.max(0,e.cropOffset.num*t.queryUnitSize(e.cropOffset.unit,!1)-i),o=i+r,s=e.width;s===Ds?t.pref.defaultPaperSize?n.pageWidth=t.pref.defaultPaperSize.width*t.queryUnitSize("px",!1):n.pageWidth=(t.pref.spreadView?Math.floor(t.viewportWidth/2)-t.pref.pageBorder:t.viewportWidth)-o*2:n.pageWidth=s.num*t.queryUnitSize(s.unit,!1);let l=e.height;return l===Vs?t.pref.defaultPaperSize?n.pageHeight=t.pref.defaultPaperSize.height*t.queryUnitSize("px",!1):n.pageHeight=t.viewportHeight-o*2:n.pageHeight=l.num*t.queryUnitSize(l.unit,!1),n.bleed=i,n.bleedOffset=r,n.cropOffset=o,n}function vx(e,t,n){let i=e.createElementNS("http://www.w3.org/2000/svg","svg");return i.setAttribute("width",t),i.setAttribute("height",n),i.style.position="absolute",i}function es(e,t,n,i){i=i||"polyline";let r=e.createElementNS("http://www.w3.org/2000/svg",i);return r.setAttribute("stroke",n===S.auto?"#010101":n.toString()),r.setAttribute("stroke-width",t),r.setAttribute("fill","none"),r}var Tc=(e=>(e.TOP_LEFT="top left",e.TOP_RIGHT="top right",e.BOTTOM_LEFT="bottom left",e.BOTTOM_RIGHT="bottom right",e))(Tc||{});function cT(e,t,n,i,r,o,s){let l=r;l<=o+2*Te.mm&&(l=o+r/2);let a=Math.max(r,l),u=o+a+n/2,h=vx(e,u,u),p=[[0,o+r],[r,o+r],[r,o+r-l]],c=p.map(w=>[w[1],w[0]]);(t==="top right"||t==="bottom right")&&(p=p.map(w=>[o+a-w[0],w[1]]),c=c.map(w=>[o+a-w[0],w[1]])),(t==="bottom left"||t==="bottom right")&&(p=p.map(w=>[w[0],o+a-w[1]]),c=c.map(w=>[w[0],o+a-w[1]]));let f=es(e,n,i);f.setAttribute("points",p.map(w=>w.join(",")).join(" ")),h.appendChild(f);let v=es(e,n,i);return v.setAttribute("points",c.map(w=>w.join(",")).join(" ")),h.appendChild(v),t.split(" ").forEach(w=>{h.style[w]=`${s}px`}),h}var Rs=(e=>(e.TOP="top",e.BOTTOM="bottom",e.LEFT="left",e.RIGHT="right",e))(Rs||{});function dT(e,t,n,i,r,o){let s=r*2,l,a;t==="top"||t==="bottom"?(l=s,a=r):(l=r,a=s);let u=vx(e,l,a),h=es(e,n,i);h.setAttribute("points",`0,${a/2} ${l},${a/2}`),u.appendChild(h);let p=es(e,n,i);p.setAttribute("points",`${l/2},0 ${l/2},${a}`),u.appendChild(p);let c=es(e,n,i,"circle");c.setAttribute("cx",l/2),c.setAttribute("cy",a/2),c.setAttribute("r",r/4),u.appendChild(c);let f;switch(t){case"top":f="bottom";break;case"bottom":f="top";break;case"left":f="right";break;case"right":f="left";break}return Object.keys(Rs).forEach(v=>{let w=Rs[v];w===t?u.style[w]=`${o}px`:w!==f&&(u.style[w]="0",u.style[`margin-${w}`]="auto")}),u}function pT(e,t,n,i){let r=!1,o=!1,s=e.marks;if(s){let w=s.value;w instanceof Be?w.values.forEach(y=>{y===S.crop?r=!0:y===S.cross&&(o=!0)}):w===S.crop?r=!0:w===S.cross&&(o=!0)}let l=t.bleed;if(!r&&!o)return;let a=n.container,u=a.ownerDocument,h=Pt(aT,i),p=Math.max(0,t.bleedOffset-Pt(uT,i)),c=t.bleedOffset-p,f=e["crop-marks-line-color"],v=f&&!ge(f.value)?f.value:S.auto;r&&Object.keys(Tc).forEach(w=>{let y=Tc[w],g=cT(u,y,h,v,c,l,p);a.appendChild(g)}),o&&Object.keys(Rs).forEach(w=>{let y=Rs[w],g=dT(u,y,h,v,c,p);a.appendChild(g)})}var Ic=(()=>{let e=["left","right","top","bottom","before","after","start","end","block-start","block-end","inline-start","inline-end","inside","outside"],t={width:!0,height:!0,"block-size":!0,"inline-size":!0,margin:!0,padding:!0,border:!0,outline:!0,"outline-width":!0,"outline-style":!0,"outline-color":!0,"border-radius":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-bottom-right-radius":!0,"border-bottom-left-radius":!0,"border-start-start-radius":!0,"border-start-end-radius":!0,"border-end-start-radius":!0,"border-end-end-radius":!0,"box-shadow":!0,"box-sizing":!0};return e.forEach(n=>{t[`margin-${n}`]=!0,t[`padding-${n}`]=!0,t[`border-${n}-width`]=!0,t[`border-${n}-style`]=!0,t[`border-${n}-color`]=!0}),t})(),gp={"top-left-corner":{order:1,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:null},"top-left":{order:2,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"start"},"top-center":{order:3,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"center"},"top-right":{order:4,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"end"},"top-right-corner":{order:5,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:null},"right-top":{order:6,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:"start"},"right-middle":{order:7,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:"center"},"right-bottom":{order:8,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:"end"},"bottom-right-corner":{order:9,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:null},"bottom-right":{order:10,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"end"},"bottom-center":{order:11,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"center"},"bottom-left":{order:12,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"start"},"bottom-left-corner":{order:13,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:null},"left-bottom":{order:14,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:"end"},"left-middle":{order:15,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:"center"},"left-top":{order:16,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:"start"}},fT=(()=>{let e=gp;return Object.keys(e).sort((t,n)=>e[t].order-e[n].order)})(),mp="vivliostyle-page-rule-master",As="_marginBoxes",wx=class extends ax{constructor(e,t,n){super(e,null,mp,[],t,null,0),d(this,"pageMarginBoxes",{});let i=Na(n);new gT(this.scope,this,n,i),this.createPageMarginBoxes(n),this.applySpecified(n,i)}createPageMarginBoxes(e){let t=e[As];t&&fT.forEach(n=>{t[n]&&(this.pageMarginBoxes[n]=new vT(this.scope,this,n,e))})}applySpecified(e,t){this.specified.position=new fe(S.relative,0),this.specified.width=new fe(t.width,0),this.specified.height=new fe(t.height,0);for(let n in e)!Ic[n]&&n!=="background-clip"&&(this.specified[n]=e[n])}createInstance(e){return new ts(e,this)}},gT=class extends Xs{constructor(e,t,n,i){super(e,null,null,[],t),this.pageSize=i,new mT(this.scope,this),this.applySpecified(n)}applySpecified(e){this.specified["wrap-flow"]=new fe(S.auto,0),this.specified["z-index"]=new fe(new nr(0),0),this.specified.position=new fe(S.absolute,0),this.specified.overflow=new fe(S.visible,0);for(let t in Ic)Ic.hasOwnProperty(t)&&(this.specified[t]=e[t])}createInstance(e){return new yT(e,this)}},mT=class extends Xs{constructor(e,t){super(e,null,null,[],t),this.specified["flow-from"]=new fe(K("body"),0)}createInstance(e){return new yx(e,this)}},vT=class extends Xs{constructor(e,t,n,i){super(e,null,null,[],t),this.marginBoxName=n,this.applySpecified(i)}applySpecified(e){let t=e[As][this.marginBoxName];for(let n in e){let i=e[n],r=t[n];(l0[n]||r&&r.value===S.inherit)&&(this.specified[n]=i)}for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let i=t[n];i&&i.value!==ae&&i.value!==S.inherit&&i.value!==S.unset&&i.value!==S.revert&&(this.specified[n]=i)}}createInstance(e){return new xT(e,this)}},ts=class extends pp{constructor(e,t){super(e,t),d(this,"pageAreaDimension",null),d(this,"pageMarginBoxInstances",{})}applyCascadeAndInit(e,t){let n=this.cascaded;for(let i in t)if(Object.prototype.hasOwnProperty.call(t,i))switch(i){case"writing-mode":case"direction":n[i]=t[i]}super.applyCascadeAndInit(e,t)}initHorizontal(){let e=this.style;e.left=Ie,e["margin-left"]=Ie,e["border-left-width"]=Ie,e["padding-left"]=Ie,e["padding-right"]=Ie,e["border-right-width"]=Ie,e["margin-right"]=Ie,e.right=Ie}initVertical(){let e=this.style;e.top=Ie,e["margin-top"]=Ie,e["border-top-width"]=Ie,e["padding-top"]=Ie,e["padding-bottom"]=Ie,e["border-bottom-width"]=Ie,e["margin-bottom"]=Ie,e.bottom=Ie}setPageAreaDimension(e){this.pageAreaDimension=e;let t=this.style;t.width=new ie(e.borderBoxWidth),t.height=new ie(e.borderBoxHeight),t["padding-left"]=new ie(e.marginLeft),t["padding-right"]=new ie(e.marginRight),t["padding-top"]=new ie(e.marginTop),t["padding-bottom"]=new ie(e.marginBottom)}adjustPageLayout(e,t,n){let i=t.marginBoxes,r={start:this.pageAreaDimension.marginLeft,end:this.pageAreaDimension.marginRight,extent:this.pageAreaDimension.borderBoxWidth},o={start:this.pageAreaDimension.marginTop,end:this.pageAreaDimension.marginBottom,extent:this.pageAreaDimension.borderBoxHeight};this.sizeMarginBoxesAlongVariableDimension(i.top,!0,r,e,n),this.sizeMarginBoxesAlongVariableDimension(i.bottom,!0,r,e,n),this.sizeMarginBoxesAlongVariableDimension(i.left,!1,o,e,n),this.sizeMarginBoxesAlongVariableDimension(i.right,!1,o,e,n)}sizeMarginBoxesAlongVariableDimension(e,t,n,i,r){let o="start",s="center",l="end",a=this.pageBox.scope,u={},h={},p={};for(let x in e){let C=gp[x];if(C){let N=e[x],A=this.pageMarginBoxInstances[x],L=new Vl(N,A.style,t,a,r);u[C.positionAlongVariableDimension]=N,h[C.positionAlongVariableDimension]=A,p[C.positionAlongVariableDimension]=L}}let c={start:n.start.evaluate(i),end:n.end.evaluate(i),extent:n.extent.evaluate(i)},f=this.getSizesOfMarginBoxesAlongVariableDimension(p,c.extent),v=!1,w={};Object.keys(u).forEach(x=>{let C=x,N=Ce(a,h[C].style[t?"max-width":"max-height"],n.extent);if(N){let A=N.evaluate(i);if(f[C]>A){let L=p[C]=new Qg(u[C],h[C].style,t,a,r,A);w[C]=L.getOuterSize(),v=!0}}}),v&&(f=this.getSizesOfMarginBoxesAlongVariableDimension(p,c.extent),v=!1,[o,s,l].forEach(x=>{var C;f[x]=(C=w[x])!=null?C:f[x]}));let y={};Object.keys(u).forEach(x=>{let C=x,N=Ce(a,h[C].style[t?"min-width":"min-height"],n.extent);if(N){let A=N.evaluate(i);if(f[C]<A){let L=p[C]=new Qg(u[C],h[C].style,t,a,r,A);y[C]=L.getOuterSize(),v=!0}}}),v&&(f=this.getSizesOfMarginBoxesAlongVariableDimension(p,c.extent),[o,s,l].forEach(x=>{f[x]=y[x]||f[x]}));let g=c.start+c.extent,m=c.start+(c.start+c.extent);[o,s,l].forEach(x=>{let C=f[x];if(C!=null){let N=u[x],A=0;switch(x){case o:A=t?N.left:N.top;break;case s:A=(m-C)/2;break;case l:A=g-C;break}t?N.setHorizontalPosition(A,C-N.getInsetLeft()-N.getInsetRight()):N.setVerticalPosition(A,C-N.getInsetTop()-N.getInsetBottom())}})}getSizesOfMarginBoxesAlongVariableDimension(e,t){var n;let i=e.start,r=e.center,o=e.end,s={};if(r){let l=[i,o],a=new wT(l),u=this.distributeAutoMarginBoxSizes(r,a,t);u.xSize!=null&&(s.center=u.xSize);let h=(n=u.xSize)!=null?n:r.getOuterSize(),p=Math.max((t-h)/2,0);i&&(s.start=i.hasAutoSize()?p:i.getOuterSize()),o&&(s.end=o.hasAutoSize()?p:o.getOuterSize())}else{let l=this.distributeAutoMarginBoxSizes(i,o,t);l.xSize!=null&&(s.start=l.xSize),l.ySize!=null&&(s.end=l.ySize)}return s}distributeAutoMarginBoxSizes(e,t,n){let i={xSize:null,ySize:null};if(e instanceof Vl&&e.minMaxFitContent&&(i.xSize=e.getOuterSize()),t instanceof Vl&&t.minMaxFitContent&&(i.ySize=t.getOuterSize()),e&&t)if(e.hasAutoSize()&&t.hasAutoSize()){let r=e.getOuterMaxContentSize(),o=t.getOuterMaxContentSize();if(r>0&&o>0){let s=r+o;if(s<n)i.xSize=n*r/s;else{let l=e.getOuterMinContentSize(),a=t.getOuterMinContentSize(),u=l+a;u<n?i.xSize=l+(n-u)*(r-l)/(s-u):u>0&&(i.xSize=n*l/u)}i.xSize>0&&(i.ySize=n-i.xSize)}else r>0?i.xSize=n:o>0&&(i.ySize=n)}else e.hasAutoSize()?i.xSize=Math.max(n-t.getOuterSize(),0):t.hasAutoSize()&&(i.ySize=Math.max(n-e.getOuterSize(),0));else e?e.hasAutoSize()&&(i.xSize=n):t&&t.hasAutoSize()&&(i.ySize=n);return i}prepareContainer(e,t,n,i,r){t.element.setAttribute("data-vivliostyle-page-box",!0),super.prepareContainer(e,t,n,i,r)}},Vl=class{constructor(e,t,n,i,r){this.container=e,this.isHorizontal=n,this.clientLayout=r,d(this,"hasAutoSize_"),d(this,"size",null),d(this,"minMaxFitContent",null);let o=t[n?"width":"height"];if(this.hasAutoSize_=!o||o===S.auto||ge(o),this.minMaxFitContent=o instanceof Xt&&(o.name==="min-content"||o.name==="max-content"||o.name==="fit-content")?o.name:null,this.minMaxFitContent){let s=this.getSize();if(this.isHorizontal){let l=s[this.minMaxFitContent==="min-content"?"min-content width":this.minMaxFitContent==="max-content"?"max-content width":"fit-content width"];this.container.setHorizontalPosition(this.container.left,l)}else{let l=s[this.minMaxFitContent==="min-content"?"min-content height":this.minMaxFitContent==="max-content"?"max-content height":"fit-content height"];this.container.setVerticalPosition(this.container.top,l)}}}hasAutoSize(){return this.hasAutoSize_}getSize(){if(!this.size){let e=this.isHorizontal?["max-content width","min-content width","fit-content width"]:["max-content height","min-content height","fit-content height"];this.size=jd(this.clientLayout,this.container.element,e)}return this.size}getOuterMaxContentSize(){let e=this.getSize();return this.isHorizontal?this.container.getInsetLeft()+e["max-content width"]+this.container.getInsetRight():this.container.getInsetTop()+e["max-content height"]+this.container.getInsetBottom()}getOuterMinContentSize(){let e=this.getSize();return this.isHorizontal?this.container.getInsetLeft()+e["min-content width"]+this.container.getInsetRight():this.container.getInsetTop()+e["min-content height"]+this.container.getInsetBottom()}getOuterSize(){return this.isHorizontal?this.container.getInsetLeft()+this.container.width+this.container.getInsetRight():this.container.getInsetTop()+this.container.height+this.container.getInsetBottom()}},wT=class{constructor(e){this.params=e}hasAutoSize(){return this.params.some(e=>{var t;return(t=e==null?void 0:e.hasAutoSize())!=null?t:!1})}getOuterMaxContentSize(){let e=this.params.map(t=>{var n;return(n=t==null?void 0:t.getOuterMaxContentSize())!=null?n:0});return Math.max.apply(null,e)*e.length}getOuterMinContentSize(){let e=this.params.map(t=>{var n;return(n=t==null?void 0:t.getOuterMinContentSize())!=null?n:0});return Math.max.apply(null,e)*e.length}getOuterSize(){let e=this.params.map(t=>{var n;return(n=t==null?void 0:t.getOuterSize())!=null?n:0});return Math.max.apply(null,e)*e.length}},Qg=class extends Vl{constructor(e,t,n,i,r,o){super(e,t,n,i,r),d(this,"fixedSize"),this.fixedSize=o}hasAutoSize(){return!1}getOuterMaxContentSize(){return this.getOuterSize()}getOuterMinContentSize(){return this.getOuterSize()}getOuterSize(){return this.isHorizontal?this.container.getInsetLeft()+this.fixedSize+this.container.getInsetRight():this.container.getInsetTop()+this.fixedSize+this.container.getInsetBottom()}},yT=class extends Ys{constructor(e,t){super(e,t),d(this,"borderBoxWidth",null),d(this,"borderBoxHeight",null),d(this,"contentBoxWidth",null),d(this,"contentBoxHeight",null),d(this,"marginTop",null),d(this,"marginRight",null),d(this,"marginBottom",null),d(this,"marginLeft",null)}applyCascadeAndInit(e,t){for(let n in t)n.match(/^background-/)&&(this.cascaded[n]=t[n]);super.applyCascadeAndInit(e,t),this.parentInstance.setPageAreaDimension({borderBoxWidth:this.borderBoxWidth,borderBoxHeight:this.borderBoxHeight,marginTop:this.marginTop,marginRight:this.marginRight,marginBottom:this.marginBottom,marginLeft:this.marginLeft})}initHorizontal(){let e=this.resolvePageBoxDimensions({start:"left",end:"right",extent:"width"});this.borderBoxWidth=e.borderBoxExtent,this.contentBoxWidth=e.contentBoxExtent,this.marginLeft=e.marginStart,this.marginRight=e.marginEnd}initVertical(){let e=this.resolvePageBoxDimensions({start:"top",end:"bottom",extent:"height"});this.borderBoxHeight=e.borderBoxExtent,this.contentBoxHeight=e.contentBoxExtent,this.marginTop=e.marginStart,this.marginBottom=e.marginEnd}resolvePageBoxDimensions(e){let t=this.style,n=this.pageBox.pageSize,i=this.pageBox.scope,r=e.start,o=e.end,s=e.extent,l=n[s].toExpr(i,null),a=Ce(i,t[s],l),u=Ce(i,t[`margin-${r}`],l),h=Ce(i,t[`margin-${o}`],l),p=Ut(i,t[`padding-${r}`],l),c=Ut(i,t[`padding-${o}`],l),f=Rn(i,t[`border-${r}-width`],t[`border-${r}-style`],l),v=Rn(i,t[`border-${o}-width`],t[`border-${o}-style`],l),w=pe(i,pe(i,f,p),pe(i,v,c)),y,g,m;return a?(this.borderBoxSizing?(g=a,m=Se(i,g,w)):(m=a,g=pe(i,m,w)),y=Se(i,l,g),!u&&!h?(u=Bl(i,y,new nt(i,.5)),h=u):u?h=Se(i,y,u):u=Se(i,y,h)):(u||(u=i.zero),h||(h=i.zero),y=pe(i,u,h),g=Se(i,l,y),m=Se(i,g,w),a=this.borderBoxSizing?g:m),t[r]=new ie(u),t[o]=new ie(h),t[`margin-${r}`]=Ie,t[`margin-${o}`]=Ie,t[`border-${r}-width`]=new ie(f),t[`border-${o}-width`]=new ie(v),t[`padding-${r}`]=new ie(p),t[`padding-${o}`]=new ie(c),t[s]=new ie(a),t[`max-${s}`]=new ie(a),{borderBoxExtent:g,contentBoxExtent:m,marginStart:u,marginEnd:h}}prepareContainer(e,t,n,i,r){t.element.setAttribute("data-vivliostyle-page-area-container",!0),super.prepareContainer(e,t,n,i,r),O(t.element,"position","relative"),O(t.element,"inset",""),O(t.element,"display","flow-root")}},yx=class extends Ys{constructor(e,t){super(e,t)}applyCascadeAndInit(e,t){for(let n in t)n.match(/^column.*$/)&&(this.cascaded[n]=t[n]);super.applyCascadeAndInit(e,{})}initHorizontal(){let e=this.style,t=this.parentInstance.style,n=this.pageBox.scope;e.left=t["padding-left"],e.width=new ie(this.parentInstance.contentBoxWidth),e["margin-left"]=new ie(new Pr(n,t.left.toExpr(n,null))),e["margin-right"]=new ie(new Pr(n,t.right.toExpr(n,null))),e["border-left-width"]=t.left,e["border-right-width"]=t.right,e["border-left-style"]=S.solid,e["border-right-style"]=S.solid,e["border-left-color"]=S.transparent,e["border-right-color"]=S.transparent}initVertical(){let e=this.style,t=this.parentInstance.style,n=this.pageBox.scope;e.top=t["padding-top"],e.height=new ie(this.parentInstance.contentBoxHeight),e["margin-top"]=new ie(new Pr(n,t.top.toExpr(n,null))),e["margin-bottom"]=new ie(new Pr(n,t.bottom.toExpr(n,null))),e["border-top-width"]=t.top,e["border-bottom-width"]=t.bottom,e["border-top-style"]=S.solid,e["border-bottom-style"]=S.solid,e["border-top-color"]=S.transparent,e["border-bottom-color"]=S.transparent}prepareContainer(e,t,n,i,r){t.element.setAttribute("data-vivliostyle-page-area",!0),n.pageAreaElement=t.element,super.prepareContainer(e,t,n,i,r),e.pageAreaWidth=parseFloat(n.pageAreaElement.style.width),e.pageAreaHeight=parseFloat(n.pageAreaElement.style.height),O(t.element,"position","relative"),O(t.element,"inset",""),O(t.element,"display","flow-root")}},xT=class extends Ys{constructor(e,t){super(e,t),d(this,"boxInfo"),d(this,"suppressEmptyBoxGeneration",!0);let n=t.marginBoxName;this.boxInfo=gp[n];let i=e;i.pageMarginBoxInstances[n]=this}prepareContainer(e,t,n,i,r){t.element.setAttribute("data-vivliostyle-page-margin-box",this.pageBox.marginBoxName),this.applyVerticalAlign(e,t.element),super.prepareContainer(e,t,n,i,r)}applyVerticalAlign(e,t){O(t,"display","flex"),O(t,"flex-flow",this.vertical?this.rtl?"row-reverse":"row":"column");let n=this.getProp(e,"vertical-align"),i=null;n===K("middle")?i="center":n===K("top")?i="flex-start":n===K("bottom")&&(i="flex-end"),i&&O(t,"justify-content",i);let r=this.getProp(e,"content");if(this.vertical||r instanceof wn||r instanceof ie&&r.expr instanceof st&&r.expr.str.startsWith("running-element-")){let o="center";(this.boxInfo.isInTopRow||this.boxInfo.isInBottomRow)&&(this.boxInfo.isInLeftColumn||this.boxInfo.positionAlongVariableDimension==="end"?o=this.vertical||this.rtl?"start":"end":(this.boxInfo.isInRightColumn||this.boxInfo.positionAlongVariableDimension==="start")&&(o=this.vertical||this.rtl?"end":"start")),O(t,"align-items",o)}}positionAlongVariableDimension(e,t){let n=this.style,i=this.pageBox.scope,r=e.start,o=e.end,s=e.extent,l=r==="left",a=l?t.borderBoxWidth:t.borderBoxHeight,u=Ce(i,n[s],a),h=l?t.marginLeft:t.marginTop;if(this.boxInfo.positionAlongVariableDimension==="start")n[r]=new ie(h);else if(u){let p=Ut(i,n[`margin-${r}`],a),c=Ut(i,n[`margin-${o}`],a),f=Ut(i,n[`padding-${r}`],a),v=Ut(i,n[`padding-${o}`],a),w=Rn(i,n[`border-${r}-width`],n[`border-${r}-style`],a),y=Rn(i,n[`border-${o}-width`],n[`border-${o}-style`],a),g=pe(i,u,pe(i,this.borderBoxSizing?i.zero:pe(i,pe(i,f,v),pe(i,w,y)),pe(i,p,c)));switch(this.boxInfo.positionAlongVariableDimension){case"center":n[r]=new ie(pe(i,h,Yh(i,Se(i,a,g),new nt(i,2))));break;case"end":n[r]=new ie(Se(i,pe(i,h,a),g));break}}}positionAndSizeAlongFixedDimension(e,t){let n=this.style,i=this.pageBox.scope,r=this.borderBoxSizing,o=e.inside,s=e.outside,l=e.extent,a=t[`margin${s.charAt(0).toUpperCase()}${s.substring(1)}`],u=Wg(i,n[`margin-${o}`],a),h=Wg(i,n[`margin-${s}`],a),p=Ut(i,n[`padding-${o}`],a),c=Ut(i,n[`padding-${s}`],a),f=Rn(i,n[`border-${o}-width`],n[`border-${o}-style`],a),v=Rn(i,n[`border-${s}-width`],n[`border-${s}-style`],a),w=Ce(i,n[l],a),y=null;function g(m){if(y)return y;y={extent:w?w.evaluate(m):null,marginInside:u?u.evaluate(m):null,marginOutside:h?h.evaluate(m):null};let x=a.evaluate(m),C=0;return r||[f,p,c,v].forEach(N=>{N&&(C+=N.evaluate(m))}),(y.marginInside===null||y.marginOutside===null)&&C+y.extent+y.marginInside+y.marginOutside>x&&(y.marginInside===null&&(y.marginInside=0),y.marginOutside===null&&(y.marginOutside=0)),y.extent!==null&&y.marginInside!==null&&y.marginOutside!==null&&(y.marginOutside=null),y.extent===null?(y.extent=x-C-y.marginInside-y.marginOutside,y.marginInside===null&&(y.marginInside=0),y.marginOutside===null&&(y.marginOutside=0)):typeof y.extent=="number"&&(y.marginInside===null&&typeof y.marginOutside=="number"?y.marginInside=x-C-y.extent-y.marginOutside:typeof y.marginInside=="number"&&y.marginOutside===null?y.marginOutside=x-C-y.extent-y.marginInside:y.marginInside=y.marginOutside=(x-C-y.extent)/2),y}n[l]=new ie(new st(i,function(){let m=g(this).extent;return m===null?"auto":m},l)),n[`margin-${o}`]=new ie(new st(i,function(){let m=g(this).marginInside;return m===null?"auto":m},`margin-${o}`)),n[`margin-${s}`]=new ie(new st(i,function(){let m=g(this).marginOutside;return m===null?"auto":m},`margin-${s}`)),o==="left"?n.left=new ie(pe(i,t.marginLeft,t.borderBoxWidth)):o==="top"&&(n.top=new ie(pe(i,t.marginTop,t.borderBoxHeight)))}initHorizontal(){let e=this.parentInstance.pageAreaDimension;this.boxInfo.isInLeftColumn?this.positionAndSizeAlongFixedDimension({inside:"right",outside:"left",extent:"width"},e):this.boxInfo.isInRightColumn?this.positionAndSizeAlongFixedDimension({inside:"left",outside:"right",extent:"width"},e):this.positionAlongVariableDimension({start:"left",end:"right",extent:"width"},e)}initVertical(){let e=this.parentInstance.pageAreaDimension;this.boxInfo.isInTopRow?this.positionAndSizeAlongFixedDimension({inside:"bottom",outside:"top",extent:"height"},e):this.boxInfo.isInBottomRow?this.positionAndSizeAlongFixedDimension({inside:"top",outside:"bottom",extent:"height"},e):this.positionAlongVariableDimension({start:"top",end:"bottom",extent:"height"},e)}finishContainer(e,t,n,i,r,o,s){super.finishContainer(e,t,n,i,r,o,s);let l=n.marginBoxes,a=this.pageBox.marginBoxName,u=this.boxInfo;!u.isInLeftColumn&&!u.isInRightColumn?u.isInTopRow?l.top[a]=t:u.isInBottomRow&&(l.bottom[a]=t):!u.isInTopRow&&!u.isInBottomRow&&(u.isInLeftColumn?l.left[a]=t:u.isInRightColumn&&(l.right[a]=t));let h=this.parentInstance.pageAreaDimension,p=this.getProp(e,"width"),c=p instanceof Xt&&(p.name==="min-content"||p.name==="max-content"||p.name==="fit-content")?p.name:null,f=this.getPropAsNumber(e,"min-width"),v=this.getPropAsNumber(e,"max-width");if(c||f||v){c&&O(t.element,"width",c),f&&O(t.element,"min-width",`${f}px`),v&&O(t.element,"max-width",`${v}px`);let x=this.getProp(e,"margin-left"),C=this.getProp(e,"margin-right");if(u.isInLeftColumn){let N=h.borderBoxWidth.evaluate(e)+h.marginRight.evaluate(e);O(t.element,"right",`${N}px`),(x===S.auto||C!==S.auto)&&O(t.element,"margin-left","auto"),C===S.auto&&O(t.element,"margin-right","auto")}else u.isInRightColumn&&(O(t.element,"right","0"),(C===S.auto||x!==S.auto)&&O(t.element,"margin-right","auto"),x===S.auto&&O(t.element,"margin-left","auto"))}let w=this.getProp(e,"height"),y=w instanceof Xt&&(w.name==="min-content"||w.name==="max-content"||w.name==="fit-content")?w.name:null,g=this.getPropAsNumber(e,"min-height"),m=this.getPropAsNumber(e,"max-height");if(y||g||m){y&&O(t.element,"height",y),g&&O(t.element,"min-height",`${g}px`),m&&O(t.element,"max-height",`${m}px`);let x=this.getProp(e,"margin-top"),C=this.getProp(e,"margin-bottom");if(u.isInTopRow){let N=h.borderBoxHeight.evaluate(e)+h.marginBottom.evaluate(e);O(t.element,"bottom",`${N}px`),(x===S.auto||C!==S.auto)&&O(t.element,"margin-top","auto"),C===S.auto&&O(t.element,"margin-bottom","auto")}else u.isInBottomRow&&(O(t.element,"bottom","0"),(C===S.auto||x!==S.auto)&&O(t.element,"margin-bottom","auto"),x===S.auto&&O(t.element,"margin-top","auto"))}}},bT=class{constructor(e,t,n,i,r){this.cascadeInstance=e,this.pageScope=t,this.rootPageBoxInstance=n,this.context=i,this.docElementStyle=r,d(this,"pageMasterCache",{}),this.definePageProgression()}definePageProgression(){let e=this.pageScope,t=this.context,n=t.isVersoFirstPage,i=new qe(e,"page-number"),r=new $d(e,new ey(e,i,new nt(e,2)),n?e.one:e.zero);e.defineName("recto-page",new xi(e,r)),e.defineName("verso-page",r),(t.pageProgression||mx(this.docElementStyle))==="ltr"?(e.defineName("left-page",r),e.defineName("right-page",new xi(e,r))):(e.defineName("left-page",new xi(e,r)),e.defineName("right-page",r))}getCascadedPageStyle(e){let t={};return this.cascadeInstance.pushRule([],e,t),this.cascadeInstance.popRule(),t}getPageRulePageMaster(e,t){let n=e.pageBox;if(Object.keys(t).length===0)return n.resetScope(),e;let i=this.makeCacheKey(t,n),r=this.pageMasterCache[i];return r||(n.pseudoName===dp?r=this.generatePageRuleMaster(t):r=this.generateCascadedPageMaster(t,n),this.pageMasterCache[i]=r),r.pageBox.resetScope(),r}makeCacheKey(e,t){var n;let i=this.makeCascadeValueObjectKey(e),r=((n=this.context.currentLayoutPosition)==null?void 0:n.page)%2;return`${t.key}^${i}^${r}`}makeCascadeValueObjectKey(e){let t=[];for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let i=e[n],r;i instanceof fe?r=`${i.value}`:r=this.makeCascadeValueObjectKey(i),t.push(n+r+(i.priority||""))}return t.sort().join("^")}generatePageRuleMaster(e){let t=new wx(this.pageScope,this.rootPageBoxInstance.pageBox,e).createInstance(this.rootPageBoxInstance);return t.applyCascadeAndInit(this.cascadeInstance,this.docElementStyle),t.resolveAutoSizing(this.context),t}generateCascadedPageMaster(e,t){let n=t.clone({pseudoName:mp}),i=n.specified,r=e.size;if(r&&!ge(r.value)){let s=Na(e),l=r.priority;Kn(i,"width",new fe(s.width,l),this.context),Kn(i,"height",new fe(s.height,l),this.context)}["counter-reset","counter-increment"].forEach(s=>{i[s]&&(e[s]=i[s])});let o=n.createInstance(this.rootPageBoxInstance);return o.applyCascadeAndInit(this.cascadeInstance,this.docElementStyle),o.resolveAutoSizing(this.context),o}},ST=class extends Ne{constructor(e){super(),this.pageType=e}apply(e){e.currentPageType===this.pageType&&this.chained.apply(e)}getPriority(){return 3}makePrimary(e){return this.chained&&e.insertInTable(e.pagetypes,this.pageType,this.chained),!0}},CT=class extends Ne{constructor(e){super(),this.scope=e}apply(e){new qe(this.scope,"page-number").evaluate(e.context)===1&&this.chained.apply(e)}getPriority(){return 2}},kT=class extends Ne{constructor(e){super(),this.scope=e}apply(e){new qe(this.scope,"blank-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 2}},ET=class extends Ne{constructor(e){super(),this.scope=e}apply(e){new qe(this.scope,"left-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},PT=class extends Ne{constructor(e){super(),this.scope=e}apply(e){new qe(this.scope,"right-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},NT=class extends Ne{constructor(e){super(),this.scope=e}apply(e){new qe(this.scope,"recto-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},TT=class extends Ne{constructor(e){super(),this.scope=e}apply(e){new qe(this.scope,"verso-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},IT=class extends js{constructor(e,t,n){super(t,n),this.scope=e,this.a=t,this.b=n}apply(e){let t=e.context,n=t.layoutPositionAtPageStart.page;t.blankPageAtStart&&n--,n&&this.matchANPlusB(n)&&this.chained.apply(e)}getPriority(){return 2}},RT=class extends tp{constructor(e,t){super(e,t,null,null,null)}apply(e){AT(e.context,e.currentStyle,this.style,this.specificity)}};function AT(e,t,n,i,r){Ca(e,t,n,i,null,null,null);let o=n[As];if(o){let s=Ja(t,As);for(let l in o)if(o.hasOwnProperty(l)){let a=s[l];a||(a={},s[l]=a),Ca(e,a,o[l],i,null,null,null)}}}var LT=class extends Es{constructor(e,t,n,i,r){super(e,t,n==null?void 0:n.condition,n,null,i,!1),this.pageProps=r,d(this,"currentPageSelectors",[]),d(this,"currentNamedPageSelector",""),d(this,"currentPseudoPageClassSelectors",[])}startPageRule(){this.startSelectorRule()}tagSelector(e,t){this.currentNamedPageSelector=t,t&&(this.chain.push(new ST(t)),this.specificity+=65536)}pseudoclassSelector(e,t){if(e=e.toLowerCase(),t)switch(e){case"nth":{let[n,i]=t;this.currentPseudoPageClassSelectors.push(`:${e}(${n}n${i<0?i:"+"+i})`),this.chain.push(new IT(this.scope,n,i)),this.specificity+=256}break;default:this.reportAndSkip(`E_INVALID_PAGE_SELECTOR :${e}(${t.join("")})`);break}else switch(this.currentPseudoPageClassSelectors.push(`:${e}`),e){case"first":this.chain.push(new CT(this.scope)),this.specificity+=256;break;case"blank":this.chain.push(new kT(this.scope)),this.specificity+=256;break;case"left":this.chain.push(new ET(this.scope)),this.specificity+=1;break;case"right":this.chain.push(new PT(this.scope)),this.specificity+=1;break;case"recto":this.chain.push(new NT(this.scope)),this.specificity+=1;break;case"verso":this.chain.push(new TT(this.scope)),this.specificity+=1;break;default:this.reportAndSkip(`E_INVALID_PAGE_SELECTOR :${e}`);break}}finishSelector(){let e;!this.currentNamedPageSelector&&!this.currentPseudoPageClassSelectors.length?e=null:e=[this.currentNamedPageSelector].concat(this.currentPseudoPageClassSelectors.sort()),this.currentPageSelectors.push({selectors:e,specificity:this.specificity}),this.currentNamedPageSelector="",this.currentPseudoPageClassSelectors=[]}nextSelector(){this.finishSelector(),super.nextSelector()}startRuleBody(){this.finishSelector(),super.startRuleBody()}simpleProperty(e,t,n){if((e==="bleed"||e==="marks")&&!this.currentPageSelectors.some(o=>o.selectors===null))return;super.simpleProperty(e,t,n);let i=pt(this.elementStyle,e),r=this.pageProps;if(e==="bleed"||e==="marks")r[""]||(r[""]={}),Object.keys(r).forEach(o=>{Yi(r[o],e,i)});else if(e==="size"){let o=r[""];this.currentPageSelectors.forEach(s=>{let l=new fe(i.value,i.priority+s.specificity),a=s.selectors?s.selectors.join(""):"",u=r[a];u?Kn(u,e,l):(u=r[a]={},Yi(u,e,l),o&&["bleed","marks"].forEach(h=>{o[h]&&Yi(u,h,o[h])}))})}}insertNonPrimary(e){this.cascade.insertInTable(this.cascade.pagetypes,"*",e)}makeApplyRuleAction(e){return new RT(this.elementStyle,e)}startPageMarginBoxRule(e){let t=Ja(this.elementStyle,As),n=t[e];n||(n={},t[e]=n);let i=new FT(this.scope,this.owner,this.validatorSet,n);this.owner.pushHandler(i)}},FT=class extends Hs{constructor(e,t,n,i){super(e,t,!1),this.validatorSet=n,this.boxStyle=i}property(e,t,n){this.validatorSet.validatePropertyAndHandleShorthand(e,t,n,this)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}simpleProperty(e,t,n){let i=n?this.getImportantSpecificity():this.getBaseSpecificity(),r=new fe(t,i);Yi(this.boxStyle,e,r)}},Qn=!0;function OT(e){Qn=e}var qi=[];function Zg(e,t){return e===t||(e.src||t.src?e.src===t.src:e.textContent===t.textContent)}function xx(e){let t=Array.from(e.querySelectorAll("body > :not(script):not(link):not(style) ~ script"));return Array.from(e.querySelectorAll("head > script, body > script")).filter(n=>!t.includes(n))}function vp(e,t,n){var i,r;if(!Qn||!(n!=null&&n.inHead)&&!(n!=null&&n.atEnd)&&xx(e.ownerDocument).includes(e))return F(!1);let o=e.textContent,s=e.src,l=e.type==="module",a=(l||s)&&e.async,u=l&&!a||s&&e.defer,h=!(n!=null&&n.atEnd)&&((n==null?void 0:n.forceDefer)||u||a);if(bx(t)||(t.onload=null),h)return qi.some(c=>Zg(c,e))||qi.push(e),F(!0);if(s.includes("/mathjax")){let c=t.document.head.querySelector("script[src*='MathJax.js']:not([data-vivliostyle-scripting])");if(c){if(s.includes("/mathjax@3"))t.document.head.removeChild(c),(r=(i=t.MathJax)==null?void 0:i.version)!=null&&r.startsWith("2.")&&delete t.MathJax;else if(s.includes("/MathJax.js"))return F(!0)}}for(let c of t.document.head.getElementsByTagName("script"))c.hasAttribute("data-vivliostyle-scripting")&&Zg(c,e)&&t.document.head.removeChild(c);let p=t.document.createElement("script");p.textContent=o,s&&(p.src=s),p.async=a,p.defer=u,p.setAttribute("data-vivliostyle-scripting","true");for(let c of e.attributes)["src","async","defer"].includes(c.name)||p.setAttribute(c.name,c.value);if(se.debug("script:",s),s){let c=hr(p);return t.document.head.appendChild(p),Ka([c])}else return t.document.head.appendChild(p),F(!0)}function BT(e,t){var n;let i={},r=s=>{var l;let a=(l=s["font-family"])==null?void 0:l.value;if(a)if(a.values)for(let h of a.values)i[h.stringValue()]=!0;else i[a.stringValue()]=!0;let u=s._marginBoxes;if(u)for(let h of Object.values(u))r(h)},o=s=>{if(s instanceof tp)r(s.style);else if(s instanceof ao||Array.isArray(s))for(let l of Object.values(s))o(l)};for(let s of Object.values(t.cascade.code))for(let l of Object.values(s??{}))o(l);for(let s of e.querySelectorAll("[style]"))(n=s.style)!=null&&n.fontFamily&&(i[s.style.fontFamily]=!0);return Object.keys(i).join(",")}function _T(e,t,n){var i;let r=(i=t.document.querySelector("[data-vivliostyle-textcontent]"))!=null?i:t.document.createElement("div");return r.style.position="fixed",r.style.fontSize="0",r.setAttribute("data-vivliostyle-textcontent","true"),r.setAttribute("aria-hidden","true"),r.style.fontFamily=BT(e,n),r.textContent=e.documentElement.textContent,t.document.body.appendChild(r),r}function MT(e,t,n){if(!Qn)return F(!1);let i=xx(e);if(i.length===0)return F(!1);let r=i.some(h=>!(h.async||h.defer||h.type==="module")),o=r?_T(e,t,n):null,s=t.document.fonts,l=t.$,a=!1,u=X("loadScripts");return u.loop(()=>{if(i.length===0)return r?u.sleep(20).thenAsync(()=>{var p,c;return s.status==="loading"||t.document.documentElement.classList.contains("wf-loading")||(p=t.FontJSON)!=null&&p.Font&&(c=t.ret)!=null&&c.readyState&&t.ret.readyState<4?F(!0):F(!1)}):F(!1);let h=i.shift();return vp(h,t,{inHead:!0,forceDefer:a}).thenAsync(()=>(!a&&t.$!==l&&(qi.push(h),a=!0),i.length===0&&r&&(se.debug("dispatchEvent: DOMContentLoaded (document)"),t.document.dispatchEvent(new Event("DOMContentLoaded"))),F(!0)))}).then(()=>{o&&o.remove(),u.finish(!0)}),u.result()}function zT(e){if(!Qn)return F(!1);let t=X("loadScripts");return t.loop(()=>qi.length===0?F(!1):vp(qi.shift(),e,{atEnd:!0}).thenReturn(qi.length>0)).then(()=>{se.debug("dispatchEvent: DOMContentLoaded (window)"),e.dispatchEvent(new Event("DOMContentLoaded")),se.debug("dispatchEvent: load (window)"),e.dispatchEvent(new Event("load")),t.finish(!0)}),t.result()}function bx(e){return Qn?qi.length>0||!!e.document.head.querySelector("script[data-vivliostyle-scripting]"):!1}var $T=(e,t,n)=>e.replace(/[uU][rR][lL]\(\s*"((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^"\r\n])+)"/gm,(i,r)=>`url("${n.transformURL(r,t)}"`).replace(/[uU][rR][lL]\(\s*'((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^'\r\n])+)'/gm,(i,r)=>`url('${n.transformURL(r,t)}'`).replace(/[uU][rR][lL]\(\s*((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^"'\r\n\)\s])+)/gm,(i,r)=>`url(${n.transformURL(r,t)}`),DT={};function VT(e){e.addEventListener("load",()=>{e.contentWindow.navigator.epubReadingSystem={name:"adapt",version:"0.1",layoutStyle:"paginated",hasFeature:function(t,n){switch(t){case"mouse-events":return!0}return!1}}},!1)}var Sx=class Rc extends Bd{constructor(t,n,i,r,o,s,l,a,u,h,p,c,f){super(),this.flowName=t,this.context=n,this.viewport=i,this.styler=r,this.regionIds=o,this.xmldoc=s,this.docFaces=l,this.footnoteStyle=a,this.stylerProducer=u,this.page=h,this.customRenderer=p,this.fallbackMap=c,this.documentURLTransformer=f,d(this,"document"),d(this,"exprContentListener"),d(this,"nodeContext",null),d(this,"viewRoot",null),d(this,"isFootnote",!1),d(this,"sourceNode",null),d(this,"offsetInNode",0),d(this,"viewNode",null),this.document=i.document,this.exprContentListener=r.counterListener.getExprContentListener()}clone(){return new Rc(this.flowName,this.context,this.viewport,this.styler,this.regionIds,this.xmldoc,this.docFaces,this.footnoteStyle,this.stylerProducer,this.page,this.customRenderer,this.fallbackMap,this.documentURLTransformer)}createPseudoelementShadow(t,n,i,r,o,s,l,a){let u=this.getPseudoMap(i,this.regionIds,this.isFootnote,this.nodeContext,s);if(!u)return a;let h=[],p=Ml.createElementNS("http://www.pyroxy.com/ns/shadow","root"),c=p;for(let v of MP){let w;if(v){if(!u[v]||v=="footnote-marker"&&!(n&&this.isFootnote))continue;if(v.match(/^first-/)){let y=r.display;if(!y||y===S.inline)continue;let g=t.firstElementChild;if(g&&lt(g.previousSibling)){let m=o.getStyle(g,!1);if(m){let x=pt(m,"display");if(x!=null&&x.value&&x.value!==S.inline)continue}}}if(v==="before"||v==="after"){let y=u[v].content;if(!y||!Ni(y.value))continue}h.push(v),w=Ml.createElementNS("http://www.w3.org/1999/xhtml","span"),Cc(w,v)}else w=Ml.createElementNS("http://www.pyroxy.com/ns/shadow","content");c.appendChild(w),v.match(/^first-/)&&(c=w)}if(!h.length)return a;let f=new Og(t,i,o,s,this.exprContentListener);return new rc(t,p,null,l,a,nn.ROOTLESS,f)}getPseudoMap(t,n,i,r,o){let s=yn(t,"_pseudos");if(!s)return null;let l={};for(let a in s){let u=l[a]={};Qo(u,s[a],o),Sc(u,o,s[a]),T0(s[a],n,i,(h,p)=>{Qo(u,p,o),k0(p,c=>{Qo(u,c,o)})})}return l}createRefShadow(t,n,i,r,o){let s=X("createRefShadow");return this.xmldoc.store.load(t).then(l=>{let a=l;if(a){let u=a.getElement(t);if(u){let h=this.stylerProducer.getStylerForDoc(a);o=new rc(i,u,a,r,o,n,h)}}s.finish(o)}),s.result()}createShadows(t,n,i,r,o,s,l){let a=X("createShadows"),u=null,h=r.template,p;if(h instanceof wn||h===S.footnote){let c=h instanceof wn?h.url:Ue("user-agent.xml#footnote",tr);p=this.createRefShadow(c,nn.ROOTLESS,t,l,u)}else p=F(u);return p.then(c=>{let f=null;if(t.namespaceURI=="http://www.pyroxy.com/ns/shadow"&&t.localName=="include"){let w=t.getAttribute("href"),y=null;w?y=l?l.xmldoc:this.xmldoc:l&&(l.owner.namespaceURI=="http://www.w3.org/1999/xhtml"?w=l.owner.getAttribute("href"):w=l.owner.getAttributeNS("http://www.w3.org/1999/xlink","href"),y=l.parentShadow?l.parentShadow.xmldoc:this.xmldoc),w&&(w=Ue(w,y.url),f=this.createRefShadow(w,nn.ROOTED,t,l,c))}f==null&&(f=F(c));let v=null;f.then(w=>{if(r.display===S.table_cell){let y=Ue("user-agent.xml#table-cell",tr);v=this.createRefShadow(y,nn.ROOTLESS,t,l,w)}else v=F(w);v.then(y=>{y=this.createPseudoelementShadow(t,n,i,r,o,s,l,y),a.finish(y)})})}),a.result()}setViewRoot(t,n){this.viewRoot=t,this.isFootnote=n}computeStyle(t,n,i,r){var o;let s=this.context,l=N0(i,s,this.regionIds,this.isFootnote,this.nodeContext),a=!((o=this.nodeContext)!=null&&o.parent);a&&(!l["writing-mode"]&&this.styler.rootStyle["writing-mode"]&&(l["writing-mode"]=this.styler.rootStyle["writing-mode"]),!l.direction&&this.styler.rootStyle.direction&&(l.direction=this.styler.rootStyle.direction));let u=t;t=E0(l,s,t);let h=!a&&t!==u;n=P0(l,s,n);let p=(g,m)=>{let x;h&&(t?/^(min-|max-)?(height|inline-size)$/.test(g)&&(x=s.pageAreaHeight):/^(min-|max-)?(width|inline-size)$/.test(g)&&(x=s.pageAreaWidth));let C=m.evaluate(s,g,x,t);return g=="font-family"&&(C=this.docFaces.filterFontFamily(C)),C},c=!!new qe(s.style.pageScope,"left-page").evaluate(s);if(I0(l,r,t,n,c,p),h){let g=r[t?"height":"width"];(!g||g===S.auto)&&(r[t?"height":"width"]=S.max_content)}if(lc(r.position))return r.position=S.fixed,r.visibility=S.hidden,t;let f=r.position,v=r.float,w=r.display||(this.sourceNode.namespaceURI==="http://www.w3.org/1999/xhtml"?S.inline:void 0),y=t0(w,f,v,this.sourceNode===this.xmldoc.root);return["display","position","float"].forEach(g=>{y[g]&&(r[g]=y[g])}),t}inheritFromSourceParent(t){let n=this.nodeContext.sourceNode,i=[],r=null,o=this.nodeContext.shadowContext,s=-1;for(;n&&n.nodeType==1;){let p=o&&o.root==n;if(!p||o.type==nn.ROOTLESS){let c=(o?o.styler:this.styler).getStyle(n,!1);i.push(c),r=r||Uh(n)}p?(n=o.owner,o=o.parentShadow):(n=n.parentNode,s++)}let l=s===0,a=this.context.queryUnitSize("em",l),u={"font-size":new fe(new $(a,"px"),0)},h=new VE(u,this.context);for(let p=i.length-1;p>=0;--p){let c=i[p],f=[];for(let y in c)qo(y)&&f.push(y);f.sort(eg);let v,w;for(let y of f){h.setPropName(y);let g=pt(c,y),m=g;ge(g.value)||(y==="font-size"&&p===i.length-1&&this.context.isRelativeRootFontSize&&this.context.rootFontSize?m=new fe(new $(this.context.rootFontSize,"px"),g.priority):y==="line-height"&&p===i.length-1&&this.context.rootLineHeight&&g.value instanceof $&&(g.value.unit==="lh"||g.value.unit==="rlh")?m=new fe(new $(this.context.rootLineHeight,"px"),g.priority):p===0&&g.value instanceof $&&g.value.unit==="lh"?m=new fe(new $(g.value.num*this.getLineHeightUnitSize(y,v,w),"px"),g.priority):Yn(y)||(m=g.filterValue(h)),y==="font-size"?v=m.value:y==="line-height"&&(w=m.value),u[y]=m)}}for(let p in t)qo(p)||(u[p]=t[p]);return{lang:r,elementStyle:u}}resolveURL(t){return t=Ue(t,this.xmldoc.url),this.fallbackMap[t]||t}inheritLangAttribute(){this.nodeContext.lang=Uh(this.nodeContext.sourceNode)||this.nodeContext.parent&&this.nodeContext.parent.lang||this.nodeContext.lang}transferPolyfilledInheritedProps(t){let n=LE().filter(i=>t[i]);if(n.length){let i=this.nodeContext.inheritedProps;if(this.nodeContext.parent){i=this.nodeContext.inheritedProps={};for(let r in this.nodeContext.parent.inheritedProps)i[r]=this.nodeContext.parent.inheritedProps[r]}n.forEach(r=>{let o=t[r];if(o){if(ge(o))o===S.initial&&(i[r]=void 0);else if(o instanceof nr)i[r]=o.num;else if(o instanceof Xt)i[r]=o.name;else if(o instanceof $){let s=o;switch(s.unit){case"dpi":case"dpcm":case"dppx":i[r]=s.num*Te[s.unit];break;default:i[r]=o}}else i[r]=o;["widows","orphans"].includes(r)||delete t[r]}})}}resolveFormattingContext(t,n,i,r,o,s){let l=Sn("RESOLVE_FORMATTING_CONTEXT");for(let a=0;a<l.length;a++){let u=l[a](t,n,i,r,o,s);if(u){t.formattingContext=u;return}}}createElementView(t,n){var i,r,o,s;let l=!0,a=X("createElementView"),u=this.sourceNode,h=this.nodeContext.shadowContext?this.nodeContext.shadowContext.styler:this.styler,p=h.getStyle(u,!1);if(!this.nodeContext.shadowContext){let C=this.xmldoc.getElementOffset(u);Za.registerFragmentIndex(C,this.nodeContext.fragmentIndex,0)}let c={};if(!this.nodeContext.parent){let C=this.inheritFromSourceParent(p);p=C.elementStyle,this.nodeContext.lang=C.lang}let f=p.position,v=p.float,w=p["float-reference"],y=v&&!ge(v.value)&&v.value!==S.none&&w&&!ge(w.value)?gE(w.value.toString()):null;if(this.nodeContext.parent&&(lc(f==null?void 0:f.value)||y&&$r(y))){let C=this.inheritFromSourceParent(p);p=C.elementStyle,this.nodeContext.lang=C.lang}this.nodeContext.vertical=this.computeStyle(this.nodeContext.vertical,this.nodeContext.direction==="rtl",p,c),y&&$r(y)&&c.display===S.block&&(c.display=S.flow_root),h.processContent(u,c,(r=this.nodeContext.viewNode)!=null?r:(i=this.nodeContext.parent)==null?void 0:i.viewNode),this.transferPolyfilledInheritedProps(c),this.inheritLangAttribute(),c.direction&&(this.nodeContext.direction=c.direction.toString());let g=c["flow-into"];if(g&&g.toString()!=this.flowName)return a.finish(!1),a.result();if(Qn&&u.localName==="script"&&u.namespaceURI==="http://www.w3.org/1999/xhtml")return vp(u,this.viewport.window).thenFinish(a),a.result();let m=c.display;if(ge(m)&&(m===S.initial||m===S.unset?m=S.inline:m===S.inherit?m=((o=this.nodeContext.parent)==null?void 0:o.display)&&K((s=this.nodeContext.parent)==null?void 0:s.display):m=null),m===S.none)return a.finish(!1),a.result();let x=this.nodeContext.parent==null;return this.nodeContext.flexContainer=m===S.flex,this.createShadows(u,x,p,c,h,this.context,this.nodeContext.shadowContext).then(C=>{var N,A;this.nodeContext.nodeShadow=C;let L=c.position,z=c.float,q=c.clear,Q=this.nodeContext.vertical?S.vertical_rl:S.horizontal_tb,D=this.nodeContext.parent?this.nodeContext.parent.vertical?S.vertical_rl:S.horizontal_tb:Q,Z=SE(u);this.nodeContext.establishesBFC=CE(m,L,z,c.overflow,Q,D,Z),this.nodeContext.containingBlockForAbsolute=kE(L),this.nodeContext.isInsideBFC()&&z!==S.footnote&&!(y&&$r(y))&&(z=null,q=null);let b=z instanceof Be||z===S.left||z===S.right||z===S.top||z===S.bottom||z===S.inline_start||z===S.inline_end||z===S.block_start||z===S.block_end||z===S.snap_block||z===S.snap_inline||z===S.inside||z===S.outside||z===S.footnote;z&&(delete c.float,z===S.footnote&&(this.isFootnote?(b=!1,c.display=S.block):c.display=S.inline)),q&&(q===S.inherit&&this.nodeContext.parent&&this.nodeContext.parent.clearSide&&(q=K(this.nodeContext.parent.clearSide)),(q===S.left||q===S.right||q===S.top||q===S.bottom||q===S.inline_start||q===S.inline_end||q===S.block_start||q===S.block_end||q===S.inside||q===S.outside||q===S.both||q===S.all||q===S.same)&&(delete c.clear,c.display&&c.display!=S.inline&&(this.nodeContext.clearSide=q.toString())));let R=m===S.list_item&&c["ua-list-item-count"],k=c["break-inside"];(b||k&&!ge(k)&&k!==S.auto)&&this.nodeContext.breakPenalty++,m&&m!==S.inline&&Wi(m)&&this.nodeContext.breakPenalty++,this.nodeContext.inline=!b&&!m||Wi(m)||i0(m),this.nodeContext.display=m?m.toString():"inline",this.nodeContext.floatSide=b?z.toString():null,this.nodeContext.floatReference=y||Ke.INLINE;let M=c["float-min-wrap-block"];this.nodeContext.floatMinWrapBlock=M&&!ge(M)?M:null;let H=this.isInsideNonRootMultiColumn(),P=c["column-span"];if(this.nodeContext.columnSpan=!H&&P&&!ge(P)?P:null,!this.nodeContext.inline){let U=c["break-after"];U&&!ge(U)&&!(H&&U===S.column)&&(this.nodeContext.breakAfter=U.toString(),tc[this.nodeContext.breakAfter]&&delete c["break-after"]);let ue=c["break-before"];ue&&!ge(ue)&&!(H&&ue===S.column)&&(this.nodeContext.fragmentIndex===1&&(this.nodeContext.breakBefore=ue.toString()),tc[this.nodeContext.breakBefore]&&delete c["break-before"]);let ce=c.page,ne=ce&&!ge(ce)&&ce.toString();!ne&&!this.nodeContext.parent&&(this.nodeContext.shadowContext||m===S.table_header_group||m===S.table_footer_group)&&(ne=this.styler.cascade.currentPageType),!ne||ne.toLowerCase()==="auto"?ne=this.nodeContext.pageType:this.nodeContext.pageType=ne,this.styler.cascade.currentPageType!==ne&&!(!ne&&c.position===S.fixed)&&(this.nodeContext.fragmentIndex===1&&!ks(this.nodeContext.breakBefore)&&(this.nodeContext.breakBefore="page"),ne!==this.styler.cascade.previousPageType&&(this.styler.cascade.previousPageType=this.styler.cascade.currentPageType),this.styler.cascade.currentPageType=ne)}this.nodeContext.verticalAlign=c["vertical-align"]&&c["vertical-align"].toString()||"baseline",this.nodeContext.captionSide=c["caption-side"]&&c["caption-side"].toString()||"top";let _=c["border-collapse"];if(!_||_===K("separate")){let U=c["border-spacing"],ue,ce;U&&(U instanceof Be?(ue=U.values[0],ce=U.values[1]):ue=ce=U,ue.isNumeric()&&(this.nodeContext.inlineBorderSpacing=Pt(ue,this.context)),ce.isNumeric()&&(this.nodeContext.blockBorderSpacing=Pt(ce,this.context)))}let G=c["footnote-policy"];this.nodeContext.footnotePolicy=G&&!ge(G)?G:null;let ee=c["x-first-pseudo"];if(ee){let U=this.nodeContext.parent?this.nodeContext.parent.firstPseudo:null;this.nodeContext.firstPseudo=new cE(U,ee.num)}this.nodeContext.inline||this.processAfterIfcontinues(u,p,h,this.context);let I=c["white-space"];if(I){let U=Wy(I.toString());U!==null&&(this.nodeContext.whitespace=U)}let T=c["hyphenate-character"];T&&T instanceof Je&&(this.nodeContext.hyphenateCharacter=T.str);let B=c["word-break"],Y=c["line-break"],E=c["overflow-wrap"];(B===S.break_all||Y===S.anywhere||E===S.break_word||E===S.anywhere)&&(this.nodeContext.breakWord=!0),this.resolveFormattingContext(this.nodeContext,t,m,L,z,x),this.nodeContext.parent&&this.nodeContext.parent.formattingContext&&(t=this.nodeContext.parent.formattingContext.isFirstTime(this.nodeContext,t)),this.nodeContext.inline||(this.nodeContext.repeatOnBreak=this.processRepeatOnBreak(c),this.findAndProcessRepeatingElements(u,h));let W=!1,V=[],te=u.namespaceURI,j=u.localName;if(te=="http://www.w3.org/1999/xhtml"?(j=="html"||j=="body"||j=="script"||j=="link"||j=="meta"?j="div":j=="vide_"?j="video":j=="audi_"?j="audio":j=="object"&&(W=!!this.customRenderer),u.getAttribute(op)&&(A=(N=p.content)==null?void 0:N.value)!=null&&A.url&&(j="img")):te=="http://www.idpf.org/2007/ops"?(j="span",te="http://www.w3.org/1999/xhtml"):te=="http://www.pyroxy.com/ns/shadow"?(te="http://www.w3.org/1999/xhtml",j=this.nodeContext.inline?"span":"div"):W=!!this.customRenderer,R)t?j="li":(j="div",m=S.block,c.display=m);else if(j=="body"||j=="li")j="div";else if(j=="q")j="span";else if(j=="a"){let U=c["hyperlink-processing"];U&&U.toString()!="normal"&&(j="span")}c.behavior&&c.behavior.toString()!="none"&&this.customRenderer&&(W=!0),u.dataset&&u.getAttribute("data-math-typeset")==="true"&&(W=!0);let re;if(W){let U=this.nodeContext.parent?this.nodeContext.parent.viewNode:null;re=this.customRenderer(u,U,c)}else re=F(null);re.then(U=>{if(U)W&&(l=U.getAttribute("data-adapt-process-children")=="true");else if(c.display===S.none){a.finish(!1);return}else U=this.createElement(te,j);j=="a"&&U.addEventListener("click",this.page.hrefHandler,!1),U.localName=="iframe"&&U.namespaceURI=="http://www.w3.org/1999/xhtml"&&VT(U);let ue=this.nodeContext.inheritedProps["image-resolution"],ce=[],ne=c.width,me=c.height,de=u.getAttribute("width"),ut=u.getAttribute("height"),Fn=ne===S.auto||!ne&&!de,Qe=me===S.auto||!me&&!ut,Li=u.attributes,Fi=Li.length,bt=null,he=null;for(let ht=0;ht<Fi;ht++){let zt=Li[ht],_e=zt.namespaceURI,xe=zt.localName,Ze=zt.nodeValue;if(_e){if(_e=="http://www.w3.org/2000/xmlns/")continue;_e=="http://www.w3.org/1999/xlink"&&xe=="href"&&(Ze=this.documentURLTransformer.transformURL(this.resolveURL(Ze),this.xmldoc.url))}else{if(!Qn&&xe.match(/^on/)||xe=="style")continue;if((xe=="id"||xe=="name")&&t){let ct=this.documentURLTransformer.transformFragment(Ze,this.xmldoc.url);U.setAttribute(xe,Ze),U.setAttribute("data-vivliostyle-id",ct);let or=U.ownerDocument.createElement("a");or.setAttribute(xe,ct),or.setAttribute(Qr,"1"),U.appendChild(or),this.page.registerElementWithId(U,ct);continue}if(xe=="src"||xe=="href"||xe=="poster")Ze=this.resolveURL(Ze),xe==="href"&&(Ze=this.documentURLTransformer.transformURL(Ze,this.xmldoc.url));else if(xe=="srcset")Ze=Ze.split(",").map(ct=>this.resolveURL(ct.trim())).join(",");else if(xe==="data"&&W&&j==="object"&&U.hasAttribute("data"))continue;if(xe==="poster"&&j==="video"&&te==="http://www.w3.org/1999/xhtml"&&Fn&&Qe){let ct=new Image,or=hr(ct,Ze);V.push(or),ce.push({image:ct,element:U,fetcher:or})}}if(te=="http://www.w3.org/2000/svg"&&/^[A-Z\-]+$/.test(xe)&&(xe=xe.toLowerCase()),this.isSVGUrlAttribute(xe)&&(Ze=$T(Ze,this.xmldoc.url,this.documentURLTransformer)),_e){let ct=DT[_e];ct&&(xe=`${ct}:${xe}`)}if(xe=="src"&&!_e&&(j=="img"||j=="input")&&te=="http://www.w3.org/1999/xhtml")bt=Ze;else if(xe=="alt"&&!_e&&j=="img"&&te=="http://www.w3.org/1999/xhtml")he=Ze;else if(xe=="href"&&j=="image"&&te=="http://www.w3.org/2000/svg"&&_e=="http://www.w3.org/1999/xlink")this.page.fetchers.push(hr(U,Ze));else if(_e)U.setAttributeNS(_e,xe,Ze);else try{U.setAttribute(xe,Ze)}catch(ct){se.warn(ct)}}if(bt){let ht=j==="input"?new Image:U,zt=hr(ht,bt,he);ht!==U&&(U.src=bt);let _e=()=>{var xe,Ze;if(c.position===S.fixed)return!0;for(let ct=(xe=this.nodeContext.parent)==null?void 0:xe.viewNode;ct&&ct!==this.viewRoot;ct=ct.parentElement)if(((Ze=ct.style)==null?void 0:Ze.position)==="fixed")return!0;return!1};!Fn&&!Qe&&!(()=>{let xe=this.nodeContext.vertical?ne:me;return xe instanceof $&&xe.unit==="%"})()&&!_e()?this.page.fetchers.push(zt):(Fn&&Qe&&ue&&ue!==1&&ce.push({image:ht,element:U,fetcher:zt}),V.push(zt))}delete c.content;let Ae=c["list-style-image"];if(Ae&&Ae instanceof wn){let ht=Ae.url;V.push(hr(new Image,ht))}if(this.preprocessElementStyle(c),this.applyComputedStyles(U,c),this.nodeContext.inline)t||(Yt(U,"inline-start"),To(U)&&Yt(U,"clone"));else if(t){if(!Yd(c.position)){let ht=c["margin-break"],zt=this.getBreakTypeAt(this.nodeContext),_e=zt!==null,xe=zt==="auto";(ht===S.discard&&_e||ht!==S.keep&&xe&&!this.nodeContext.floatSide)&&Vu(U,"block-start")}}else{let ht=this.nodeContext.vertical?"width":"height";ai(U,ht)&&O(U,ht,this.nodeContext.display==="table-row"?"0.01px":""),Yt(U,"block-start"),To(U)&&Yt(U,"clone"),Vu(U,"block-start")}R&&U.setAttribute("value",c["ua-list-item-count"].stringValue()),this.viewNode=U,V.length?Ka(V).then(()=>{ue>0&&this.modifyElemDimensionWithImageResolution(ce,ue,c,this.nodeContext.vertical),a.finish(l)}):a.timeSlice().then(()=>{a.finish(l)})})}),a.result()}isInsideNonRootMultiColumn(){var t;for(let n=(t=this.nodeContext.parent)==null?void 0:t.viewNode;n;n=n.parentNode){let i=n.nodeType===1?n.style:null;if(!i)break;if(!isNaN(parseFloat(i.columnCount))||!isNaN(parseFloat(i.columnWidth)))return!0;if(i.position==="absolute")break}return!1}getBreakTypeAt(t){var n,i,r,o,s;if(this.isInsideTable(t))return null;for(let a=t;a&&!a.after;a=a.parent){if(Ft(a.breakBefore))return a.breakBefore;if(a.fragmentIndex===1&&!a.parent)return a.sourceNode===a.sourceNode.ownerDocument.documentElement?"page":null;if((n=a.parent)!=null&&n.floatSide)return null;let u=(i=a.parent)==null?void 0:i.viewNode;if(u){let h=this.viewport.window.getComputedStyle(u),p=parseFloat(h.paddingBlockStart),c=parseFloat(h.borderBlockStartWidth);if(p||c)return null;let f=u==null?void 0:u.firstChild;for(;f&&(lt(f,a.parent.whitespace)||!a.floatSide&&Lo(f));)f=f.nextSibling;if(f&&f!==a.viewNode)return null}}let l=(s=(o=(r=this.context)==null?void 0:r.currentLayoutPosition)==null?void 0:o.flowPositions[this.flowName])==null?void 0:s.startBreakType;return Ft(l)?l:"auto"}isInsideTable(t){for(let n=t;n&&!n.after;n=n.parent)if(n.display&&n.display.startsWith("table"))return!0;return!1}processAfterIfcontinues(t,n,i,r){let o=this.getPseudoMap(n,this.regionIds,this.isFootnote,this.nodeContext,r);if(o&&o["after-if-continues"]&&o["after-if-continues"].content){let s=new Og(t,n,i,r,this.exprContentListener);this.nodeContext.afterIfContinues=new $P(t,s)}}isSVGUrlAttribute(t){return Rc.SVG_URL_ATTRIBUTES.includes(t.toLowerCase())}modifyElemDimensionWithImageResolution(t,n,i,r){t.forEach(o=>{if(o.fetcher.get().get()==="load"){let s=o.image,l=s.width/n,a=s.height/n,u=o.element;if(l>0&&a>0){if(i["box-sizing"]===S.border_box&&(i["border-left-style"]!==S.none&&(l+=Pt(i["border-left-width"],this.context)),i["border-right-style"]!==S.none&&(l+=Pt(i["border-right-width"],this.context)),i["border-top-style"]!==S.none&&(a+=Pt(i["border-top-width"],this.context)),i["border-bottom-style"]!==S.none&&(a+=Pt(i["border-bottom-width"],this.context))),n>1){let h=i["max-width"]||S.none,p=i["max-height"]||S.none;if(h===S.none&&p===S.none)O(u,"max-width",`${l}px`);else if(h!==S.none&&p===S.none)O(u,"width",`${l}px`);else if(h===S.none&&p!==S.none)O(u,"height",`${a}px`);else{h.isNumeric(),p.isNumeric();let c=h,f=p;c.unit!=="%"?O(u,"max-width",`${Math.min(l,Pt(c,this.context))}px`):f.unit!=="%"?O(u,"max-height",`${Math.min(a,Pt(f,this.context))}px`):r?O(u,"height",`${a}px`):O(u,"width",`${l}px`)}}else if(n<1){let h=i["min-width"]||Ie,p=i["min-height"]||Ie;h.isNumeric(),h.isNumeric();let c=h,f=p;c.num===0&&f.num===0?O(u,"min-width",`${l}px`):c.num!==0&&f.num===0?O(u,"width",`${l}px`):c.num===0&&f.num!==0?O(u,"height",`${a}px`):c.unit!=="%"?O(u,"min-width",`${Math.max(l,Pt(c,this.context))}px`):f.unit!=="%"?O(u,"min-height",`${Math.max(a,Pt(f,this.context))}px`):r?O(u,"height",`${a}px`):O(u,"width",`${l}px`)}}}})}preprocessElementStyle(t){Sn("PREPROCESS_ELEMENT_STYLE").forEach(n=>{n(this.nodeContext,t)})}findAndProcessRepeatingElements(t,n){for(let i=t.firstChild;i;i=i.nextSibling){if(i.nodeType!==1)continue;let r={},o=n.getStyle(i,!1);if(this.computeStyle(this.nodeContext.vertical,this.nodeContext.direction==="rtl",o,r),!this.processRepeatOnBreak(r))continue;if(this.nodeContext.formattingContext instanceof Jr&&!this.nodeContext.belongsTo(this.nodeContext.formattingContext))return;let s=this.nodeContext.parent,l=s&&s.formattingContext;this.nodeContext.formattingContext=new Jr(l,this.nodeContext.sourceNode),this.nodeContext.formattingContext.initializeRepetitiveElements(this.nodeContext.vertical);return}}processRepeatOnBreak(t){let n=t["repeat-on-break"];return n!==S.none&&((n===S.auto||ge(n))&&(t.display===S.table_header_group?n=S.header:t.display===S.table_footer_group?n=S.footer:n=S.none),n&&n!==S.none)?n.toString():null}createTextNodeView(){let t=X("createTextNodeView");return this.preprocessTextContent().then(()=>{let n=this.offsetInNode||0,i=dg(this.nodeContext.preprocessedTextContent).substr(n);this.viewNode=document.createTextNode(i),t.finish(!0)}),t.result()}preprocessTextContent(){if(this.nodeContext.preprocessedTextContent!=null)return F(!0);let t,n=t=this.sourceNode.textContent,i=X("preprocessTextContent"),r=Sn("PREPROCESS_TEXT_CONTENT"),o=0;return i.loop(()=>o>=r.length?F(!1):r[o++](this.nodeContext,n).thenAsync(s=>(n=s,F(!0)))).then(()=>{this.nodeContext.preprocessedTextContent=Jk(t,n),i.finish(!0)}),i.result()}createNodeView(t,n){let i=X("createNodeView"),r,o=!0;return this.sourceNode.nodeType==1?r=this.createElementView(t,n):this.sourceNode.nodeType==8?(this.viewNode=null,r=F(!0)):r=this.createTextNodeView(),r.then(s=>{var l,a;if(o=s,this.nodeContext.viewNode=this.viewNode,this.viewNode){let u=(c,f)=>(c==null?void 0:c.nodeType)===1&&Rr(c)===f,h=this.nodeContext.parent,p=h?u(this.viewNode,"after")&&u(h.viewNode,"first-letter")&&(l=h.viewNode)!=null&&l.hasChildNodes()?h.parent.viewNode:h.viewNode:this.viewRoot;if(p&&(this.nodeContext.inline&&!(this.viewNode.nodeType===3&&lt(this.viewNode))&&!p.hasChildNodes()&&Dy(p).includes("block-start")&&Yt(p,"text-start"),p.appendChild(this.viewNode),this.viewNode.nodeType===1&&this.viewNode.hasAttribute("data-vivliostyle-id"))){let c=this.viewNode,f=c.querySelector(":scope > a:empty[id^='viv-id-']");if(f&&(c.closest("[style*='position: absolute']")||/(table|flex|grid|ruby)/.test(c.style.display))){let v=f.getAttribute("id");f.ownerDocument.querySelectorAll(`a[id="${v}"]`).forEach(y=>{var g;(g=y.parentElement)==null||g.removeChild(y)});let w=p.closest("[data-vivliostyle-bleed-box]");(a=w==null?void 0:w.parentElement)==null||a.insertBefore(f,w)}}}i.finish(o)}),i.result()}setCurrent(t,n,i){return this.nodeContext=t,t?(this.sourceNode=t.sourceNode,this.offsetInNode=t.offsetInNode):(this.sourceNode=null,this.offsetInNode=-1),this.viewNode=null,this.nodeContext?this.createNodeView(n,!!i):F(!0)}processShadowContent(t){if(t.shadowContext==null||t.sourceNode.localName!="content"||t.sourceNode.namespaceURI!="http://www.pyroxy.com/ns/shadow")return t;let n=t.boxOffset,i=t.shadowContext,r=t.parent,o,s,l=i.subShadow||i.parentShadow;i.subShadow?(o=i.root,s=i.type,s==nn.ROOTLESS&&(o=o.firstChild)):(o=i.owner.firstChild,s=nn.ROOTLESS);let a=t.sourceNode.nextSibling;if(a?(t.sourceNode=a,t.resetView()):t.shadowSibling?t=t.shadowSibling:o?t=null:(t=t.parent.modify(),t.after=!0),o){let u=new Ro(o,r,n);return u.shadowContext=l,u.shadowType=s,u.shadowSibling=t,u}return t.boxOffset=n,t}nextPositionInTree(t){let n=t.boxOffset+1;if(t.after){if(!t.parent)return null;if(t.shadowType!=nn.ROOTED){let i=t.sourceNode.nextSibling;if(i)return t=t.modify(),t.boxOffset=n,t.sourceNode=i,t.resetView(),this.processShadowContent(t)}return t.shadowSibling?(t=t.shadowSibling.modify(),t.boxOffset=n,t):(t=t.parent.modify(),t.boxOffset=n,t.after=!0,t)}else{if(t.nodeShadow){let r=t.nodeShadow.root;if(t.nodeShadow.type==nn.ROOTLESS&&(r=r.firstChild),r){let o=new Ro(r,t,n);return o.shadowContext=t.nodeShadow,o.shadowType=t.nodeShadow.type,this.processShadowContent(o)}}let i=t.sourceNode.firstChild;if(i)return this.processShadowContent(new Ro(i,t,n));if(t.sourceNode.nodeType!=1){let r=dg(t.preprocessedTextContent);n+=r.length-1-t.offsetInNode}return t=t.modify(),t.boxOffset=n,t.after=!0,t}}isTransclusion(t,n,i){let r=pt(n,"hyperlink-processing");if(!r)return!1;let o=r.evaluate(this.context,"hyperlink-processing");return o?o.toString()==i:!1}nextInTree(t,n){let i=this.nextPositionInTree(t);if(!i||i.after)return F(i);let r=X("nextInTree");return this.setCurrent(i,!0,n).then(o=>{(!i.viewNode||!o)&&(i=i.modify(),i.after=!0,i.viewNode||(i.inline=!0)),this.dispatchEvent({type:"nextInTree",nodeContext:i}),r.finish(i)}),r.result()}addImageFetchers(t){if(t instanceof Rt){let n=t.values;for(let i=0;i<n.length;i++)this.addImageFetchers(n[i])}else if(t instanceof wn){let n=t.url;this.page.fetchers.push(hr(new Image,n))}}applyComputedStyles(t,n){var i,r,o;let s=n["background-image"];s&&this.addImageFetchers(s);let l=n.position===S.relative,a=((i=this.nodeContext)==null?void 0:i.parent)===null&&((r=this.sourceNode)==null?void 0:r.parentElement)===null&&!!((o=this.viewRoot)!=null&&o.parentElement),u=Object.keys(n);u.sort(eg);let h,p;for(let c of u){if(HT[c])continue;let f=n[c];if(!(!f||f===ae&&!Yn(c))){if(f=f.visit(new qC(this.xmldoc.url,this.documentURLTransformer)),f instanceof $&&Xw(f.unit)&&(f.unit==="lh"?f=new $(f.num*this.getLineHeightUnitSize(c,h,p),"px"):f=cy(f,this.context)),c==="font-size"?h=f:c==="line-height"&&(p=f),nE[c]||l&&iE[c]){this.page.delayedItems.push(new Xd(t,c,f));continue}a&&this.page.pageAreaElement&&qo(c)?O(this.page.pageAreaElement.parentElement.parentElement,c,f.toString()):O(t,c,f.toString())}}}getLineHeightUnitSize(t,n,i){var r,o,s,l;let a=Te.lh/Te.em,u=((o=(r=this.nodeContext.parent)==null?void 0:r.viewNode)==null?void 0:o.nodeType)===1?this.viewport.window.getComputedStyle(this.nodeContext.parent.viewNode):null,h=u?parseFloat(u.fontSize):this.context.fontSize(),p=u?u.lineHeight==="normal"?h*a:parseFloat(u.lineHeight):this.context.rootLineHeight;if(t==="line-height"||t==="font-size")return p;let c=null;if(i){if(i instanceof Ai||i instanceof $&&(i.unit==="em"||i.unit==="%"))c=i instanceof $&&i.unit==="%"?i.num/100:i.num;else if(i instanceof $)return i.num*this.context.queryUnitSize(i.unit,!1)}else for(let f=(s=this.nodeContext.parent)==null?void 0:s.viewNode;;f=f.parentNode){if(!f||f.nodeType!==1){c=a;break}let v=(l=f==null?void 0:f.style)==null?void 0:l.lineHeight;if(v){/^[0-9.]+$/.test(v)&&(c=parseFloat(v)),v==="normal"&&(c=a);break}}return c!==null?n instanceof $?c*g0(n,h,this.context).num:c*h:p}applyPseudoelementStyle(t,n,i){if(t.after)return;let r=this.sourceNode,o=(t.shadowContext?t.shadowContext.styler:this.styler).getStyle(r,!1),s=yn(o,"_pseudos");if(!s||(o=s[n],!o))return;let l={};t.vertical=this.computeStyle(t.vertical,t.direction==="rtl",o,l);let a=l.content;Ni(a)&&(a.visit(new Sa(i,this.context,a,this.exprContentListener)),delete l.content),this.applyComputedStyles(i,l)}peelOff(t,n){let i=X("peelOff"),r=t.firstPseudo,o=t.offsetInNode,s=t.after;if(n>0){let p=t.viewNode.textContent;t.viewNode.textContent=p.substr(0,n),o+=n}else if(!s&&t.viewNode&&o==0){let p=t.viewNode.parentNode;p&&p.removeChild(t.viewNode)}let l=t.boxOffset+n,a=[];for(;t.firstPseudo===r;)a.push(t),t=t.parent;let u=a.pop(),h=u.shadowSibling;return i.loop(()=>{for(;a.length>0;){u=a.pop(),t=new Ro(u.sourceNode,t,l),a.length==0&&(t.offsetInNode=o,t.after=s),t.shadowType=u.shadowType,t.shadowContext=u.shadowContext,t.nodeShadow=u.nodeShadow,t.shadowSibling=u.shadowSibling?u.shadowSibling:h,h=null;let p=this.setCurrent(t,!1);if(p.isPending())return p}return F(!1)}).then(()=>{i.finish(t)}),i.result()}createElement(t,n){return t=="http://www.w3.org/1999/xhtml"?this.document.createElement(n):this.document.createElementNS(t,n)}applyFootnoteStyle(t,n,i){let r={},o=yn(this.footnoteStyle,"_pseudos");if(t=this.computeStyle(t,n,this.footnoteStyle,r),o&&o.before){let s={},l=this.createElement("http://www.w3.org/1999/xhtml","span");Cc(l,"before"),i.appendChild(l),this.computeStyle(t,n,o.before,s),delete s.content,this.applyComputedStyles(l,s)}return delete r.content,this.applyComputedStyles(i,r),t}processFragmentedBlockEdge(t){var n,i,r;let o=!t.inline&&t.after?t.parent:t,s=!1;if(t.inline&&t.after&&!t.shadowContext&&((n=t.sourceNode.nextSibling)==null?void 0:n.nodeType)===1){let a=t.sourceNode.nextSibling,u=(i=pt(this.styler.getStyle(a,!1),"display"))==null?void 0:i.value.toString();s=u&&!Wi(u)||a.getAttribute("data-math-typeset")==="true"&&/^\s*(\$\$|\\\[)/.test(a.textContent)}let l=0;for(let a=o;a;a=a.parent){if(((r=a.viewNode)==null?void 0:r.nodeType)!==1)continue;let u=a.viewNode;if(u.style)if(a.inline){if(Yt(u,"inline-end"),To(u)){let h=a.vertical?u.offsetWidth:u.offsetHeight;Yt(u,"clone"),(a.vertical?u.offsetWidth:u.offsetHeight)>h&&this.fixClonedBoxDecorationOverflow(u)}}else{let h=this.nodeContext.vertical?"width":"height";if(ai(u,h)&&O(u,h,""),Yt(u,"block-end"),!l++&&a!==o){let{textAlign:p}=this.viewport.window.getComputedStyle(u);if(p==="justify"&&!s){let c=this.createChildAnonymousBlockIfNeeded(u);c?c!==u?Vy(c,["block-start","text-start","block-end","text-end","justify"]):(Yt(u,"text-end"),Yt(u,"justify")):Yt(u,"text-end")}else Yt(u,"text-end")}To(u)&&Yt(u,"clone"),Vu(u,"block-end")}}}fixClonedBoxDecorationOverflow(t){let n=this.viewport.window.getComputedStyle(t),i=parseFloat(n.paddingInlineEnd),r=parseFloat(n.borderInlineEndWidth),o=-(i+r);isNaN(o)||(t.style.marginInlineEnd=`${o}px`)}createChildAnonymousBlockIfNeeded(t){let n=o=>{let{display:s,position:l,float:a}=this.viewport.window.getComputedStyle(o);if(o.localName==="ruby"||Hi[o.localName])return!1;if(o.localName==="br")return!0;if((s==="inline"||s==="contents")&&o.hasChildNodes()){let u=o.lastElementChild;if(u&&(!u.nextSibling||u.nextSibling===o.lastChild&&lt(u.nextSibling))){let h=n(u);if(h||h===null)return h}for(let h=u==null?void 0:u.previousElementSibling;h;h=h.previousElementSibling){let p=n(h);if(p||p===null)return null}return!1}if(s==="none"||l==="absolute"||l==="fixed"||a&&a!=="none"||o.hasAttribute(Qr)){let u=o.previousElementSibling;return u&&(u.nextSibling===o||u.nextSibling===o.previousSibling&&lt(u.nextSibling))?n(u):!1}return!(!s||Wi(s))},i=null;for(let o=t.lastElementChild;o;o=o.previousElementSibling){let s=n(o);if(s){i=o;break}if(s===null)return null}if(!i)return t;if(i===t.lastElementChild&&(!i.nextSibling||i.nextSibling===t.lastChild&&lt(i.nextSibling)))return null;let r=t.ownerDocument.createElement("span");r.className="viv-anonymous-block";for(let o=i.nextSibling,s=null;o;o=s)s=o.nextSibling,r.appendChild(o);return t.appendChild(r),r}convertLengthToPx(t,n,i){let r=t.num,o=t.unit;if(wC(o)){let s=n;for(;s&&s.nodeType!==1;)s=s.parentNode;let l=parseFloat(i.getElementComputedStyle(s)["font-size"]);return this.context,ep(t,l,this.context).num}else{let s=this.context.queryUnitSize(o,!1);return s?r*s:t}}isSameNodePositionStep(t,n){if(t.shadowContext){if(!n.shadowContext)return!1;let i=t.node.nodeType===1?t.node:t.node.parentElement,r=n.node.nodeType===1?n.node:n.node.parentElement;return t.shadowContext.owner===n.shadowContext.owner&&Rr(i)===Rr(r)}else return t.node===n.node}isSameNodePosition(t,n){return t.offsetInNode===n.offsetInNode&&t.after==n.after&&t.steps.length===n.steps.length&&t.steps.every((i,r)=>{let o=n.steps[r];return this.isSameNodePositionStep(i,o)})}isPseudoelement(t){return!!Rr(t)}};d(Sx,"SVG_URL_ATTRIBUTES",["color-profile","clip-path","cursor","filter","marker","marker-start","marker-end","marker-mid","fill","stroke","mask"]);var UT=Sx,HT={"float-min-wrap-block":!0,"float-reference":!0,"flow-into":!0,"flow-linger":!0,"flow-options":!0,"flow-priority":!0,"footnote-policy":!0,"margin-break":!0,page:!0},Ul=null,WT=class{constructor(e){d(this,"layoutBox"),d(this,"window"),d(this,"scaleRatio"),this.layoutBox=e.layoutBox,this.window=e.window,this.scaleRatio=e.scaleRatio}scaleRect(e){return Ul?{left:e.left*this.scaleRatio,top:e.top*this.scaleRatio,right:e.right*this.scaleRatio,bottom:e.bottom*this.scaleRatio,width:e.width*this.scaleRatio,height:e.height*this.scaleRatio}:e}subtractOffsets(e,t){let n=t.left,i=t.top;return{left:e.left-n,top:e.top-i,right:e.right-n,bottom:e.bottom-i,width:e.width,height:e.height}}getRangeClientRects(e){let t=e.getClientRects(),n=this.layoutBox.getBoundingClientRect();return Array.from(t).map(i=>this.scaleRect(this.subtractOffsets(i,n)))}getElementClientRect(e){let t=e.getBoundingClientRect();if(t.left===0&&t.top===0&&t.right===0&&t.bottom===0)return t;let n=this.layoutBox.getBoundingClientRect();return this.scaleRect(this.subtractOffsets(t,n))}getElementComputedStyle(e){return this.window.getComputedStyle(e,null)}adjustLengthValue(e){let t=64*(this.scaleRatio||1);return Math.floor(e*t)/t}},Ta=class{constructor(e,t,n,i,r,o){this.window=e,this.fontSize=t,this.pixelRatio=n,d(this,"document"),d(this,"root"),d(this,"outerZoomBox"),d(this,"contentContainer"),d(this,"layoutBox"),d(this,"width"),d(this,"height"),d(this,"scaleRatio",1),this.document=e.document,this.root=i||this.document.body;let s=this.root.firstElementChild;s||(s=this.document.createElement("div"),s.setAttribute("data-vivliostyle-outer-zoom-box","true"),this.root.appendChild(s));let l=s.firstElementChild;l||(l=this.document.createElement("div"),l.setAttribute("data-vivliostyle-spread-container","true"),s.appendChild(l)),n>0&&CSS.supports("zoom","8")&&(O(this.root,"--viv-outputPixelRatio",`${n}`),O(this.root,"--viv-devicePixelRatio",`${e.devicePixelRatio}`),this.scaleRatio=n/e.devicePixelRatio,Ul===null&&(Ul=!("currentCSSZoom"in l)),Ul&&O(this.root,"--viv-scaleRectRatio",`${this.scaleRatio}`));let a=s.nextElementSibling;a||(a=this.document.createElement("div"),a.setAttribute("data-vivliostyle-layout-box","true"),this.root.appendChild(a)),this.outerZoomBox=s,this.contentContainer=l,this.layoutBox=a,this.width=r||parseFloat(e.getComputedStyle(this.root).width)||this.root.offsetWidth||e.innerWidth,this.height=o||parseFloat(e.getComputedStyle(this.root).height)||this.root.offsetHeight||e.innerHeight;let u={width:794,height:1056},h=!e.outerWidth&&!e.outerHeight||/Headless/.test(navigator.userAgent)||navigator.webdriver&&e.innerWidth===800&&e.innerHeight===600;(!this.width||!r&&h)&&(this.width=u.width),(!this.height||!o&&h)&&(this.height=u.height)}resetZoom(){O(this.outerZoomBox,"width",""),O(this.outerZoomBox,"height",""),O(this.contentContainer,"width",""),O(this.contentContainer,"height",""),O(this.contentContainer,"transform","")}zoom(e,t,n){O(this.root,"--viv-outputScale",`${n}`),O(this.outerZoomBox,"width",`${e*n}px`),O(this.outerZoomBox,"height",`${t*n}px`),O(this.contentContainer,"width",`${e}px`),O(this.contentContainer,"height",`${t}px`)}clear(){let e=this.root;for(;e.lastChild;)e.removeChild(e.lastChild)}},Cx=class{constructor(e,t,n){this.store=e,this.url=t,this.document=n,d(this,"lang",null),d(this,"totalOffset",-1),d(this,"root"),d(this,"body"),d(this,"head"),d(this,"last"),d(this,"lastOffset",1),d(this,"idMap"),this.root=n.documentElement;let i=null,r=null;if(this.root.namespaceURI=="http://www.w3.org/1999/xhtml"){for(let o=this.root.firstChild;o;o=o.nextSibling){if(o.nodeType!=1)continue;let s=o;if(s.namespaceURI=="http://www.w3.org/1999/xhtml")switch(s.localName){case"head":r=s;break;case"body":i=s;break}}this.lang=this.root.getAttribute("lang")}this.body=i,this.head=r,this.last=this.root,this.last.setAttribute(Mn,"0")}doc(){return new Ex([this.document])}getElementOffset(e){let t=e.getAttribute(Mn);if(t)return parseInt(t,10);let n=this.lastOffset,i=this.last;for(;i!=e;){let r=i.firstChild;if(!r){for(;r=i.nextSibling,!r;)if(i=i.parentNode,i==null)throw new Error("Internal error")}i=r,r.nodeType==1?(r.setAttribute(Mn,n.toString()),++n):n+=r.textContent.length}return this.lastOffset=n,this.last=e,n-1}getNodeOffset(e,t,n){let i=0,r=e,o=null;if(r.nodeType==1){if(!n)return this.getElementOffset(r)}else{if(i=t,o=r.previousSibling,!o)return r=r.parentNode,i+=1,this.getElementOffset(r)+i;r=o}for(;;){for(;r.lastChild;)r=r.lastChild;if(r.nodeType==1)break;if(i+=r.textContent.length,o=r.previousSibling,!o){r=r.parentNode;break}r=o}return i+=1,this.getElementOffset(r)+i}getTotalOffset(){return this.totalOffset<0&&(this.totalOffset=this.getNodeOffset(this.root,0,!0)),this.totalOffset}getNodeByOffset(e){let t,n=this.root;for(;;){if(t=this.getElementOffset(n),t>=e)return n;let l=n.children;if(!l)break;let a=Ci(l.length,u=>{let h=l[u];return this.getElementOffset(h)>e});if(a==0)break;n=l[a-1]}let i=t+1,r=n,o=r.firstChild||r.nextSibling,s=null;for(;;){if(o){if(o.nodeType==1||(r=o,s=r,i+=o.textContent.length,i>e&&!/^\s*$/.test(o.textContent)))break}else if(r=r.parentNode,!r)break;o=r.nextSibling}return o&&s&&/^\s*$/.test(s.textContent)&&(s=o),s||n}buildIdMap(e){let t=e.getAttribute("id");t&&!this.idMap[t]&&(this.idMap[t]=e);let n=e.getAttributeNS("http://www.w3.org/XML/1998/namespace","id");n&&!this.idMap[n]&&(this.idMap[n]=e);for(let i=e.firstElementChild;i;i=i.nextElementSibling)this.buildIdMap(i)}getElement(e){let t=e.match(/([^#]*)#(.+)$/);if(!t||t[1]&&t[1]!=this.url)return null;let n=t[2],i=this.document.getElementById(n);return!i&&this.document.getElementsByName&&(i=this.document.getElementsByName(n)[0]),i||(this.idMap||(this.idMap={},this.buildIdMap(this.document.documentElement)),i=this.idMap[n]),i}},Ac=(e=>(e.TEXT_HTML="text/html",e.TEXT_XML="text/xml",e.APPLICATION_XML="application/xml",e.APPLICATION_XHTML_XML="application/xhtml+xml",e.IMAGE_SVG_XML="image/svg+xml",e))(Ac||{});function bl(e,t,n){let i=n||new DOMParser,r;try{r=i.parseFromString(e,t)}catch{}if(r){let o=r.documentElement,s="parsererror";if(o.localName===s)return null;for(let l=o.firstElementChild;l;l=l.nextElementSibling)if(l.localName===s)return null}else return null;return r}function GT(e){let t=e.contentType;if(t){let i=Object.keys(Ac);for(let r=0;r<i.length;r++)if(Ac[i[r]]===t)return t;if(t.match(/\+xml$/))return"application/xml"}let n=e.url.match(/\.([^./]+)$/);if(n)switch(n[1]){case"html":case"htm":return"text/html";case"xhtml":case"xht":return"application/xhtml+xml";case"svg":case"svgz":return"image/svg+xml";case"opf":case"xml":return"application/xml"}return null}function kx(e,t){let n=e.responseXML;if(!n){let r=new DOMParser,o=e.responseText;if(o){let s=GT(e);if(n=bl(o,s||"application/xml",r),n&&!s){let l=n.documentElement;l.localName.toLowerCase()==="html"&&!l.namespaceURI?n=bl(o,"text/html",r):l.localName.toLowerCase()==="svg"&&n.contentType!=="image/svg+xml"&&(n=bl(o,"image/svg+xml",r))}n||(n=bl(o,"text/html",r))}}let i=n?new Cx(t,e.url,n):null;return F(i)}function jT(){return new Hd(kx,"document")}var XT=class Lc{constructor(t){this.fn=t}check(t){return this.fn(t)}withAttribute(t,n){return new Lc(i=>this.check(i)&&i.nodeType==1&&i.getAttribute(t)==n)}withChild(t,n){return new Lc(i=>{if(!this.check(i))return!1;let r=new Ex([i]);return r=r.child(t),n&&(r=r.predicate(n)),r.size()>0})}},Jg=new XT(e=>!0),Ex=class Fc{constructor(t){this.nodes=t}asArray(){return this.nodes}size(){return this.nodes.length}predicate(t){let n=[];for(let i of this.nodes)t.check(i)&&n.push(i);return new Fc(n)}forEachNode(t){let n=[],i=r=>{n.push(r)};for(let r=0;r<this.nodes.length;r++)t(this.nodes[r],i);return new Fc(n)}forEach(t){let n=[];for(let i=0;i<this.nodes.length;i++)n.push(t(this.nodes[i]));return n}forEachNonNull(t){let n=[];for(let i=0;i<this.nodes.length;i++){let r=t(this.nodes[i]);r!=null&&n.push(r)}return n}child(t){return this.forEachNode((n,i)=>{for(let r=n.firstChild;r;r=r.nextSibling)r.nodeType==1&&r.localName==t&&i(r)})}childElements(){return this.forEachNode((t,n)=>{for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType==1&&n(i)})}attribute(t){return this.forEachNonNull(n=>n.nodeType==1?n.getAttribute(t):null)}textContent(){return this.forEach(t=>t.textContent)}},YT=new Us(()=>{let e=X("uaStylesheetBase"),t=sx(),n=Ue("user-agent-base.css",tr),i=new Es(null,null,null,null,null,t,!0);return i.startStylesheet("UA"),CP(i.cascade),Gd(Py,i,n,null,null).thenFinish(e),e.result()},"uaStylesheetBaseFetcher");function qT(){return YT.get()}var KT=class{constructor(e,t,n,i,r,o,s,l,a,u){this.store=e,this.rootScope=t,this.pageScope=n,this.cascade=i,this.rootBox=r,this.fontFaces=o,this.footnoteProps=s,this.flowProps=l,this.viewportProps=a,this.pageProps=u,d(this,"fontDeobfuscator"),d(this,"validatorSet"),this.fontDeobfuscator=e.fontDeobfuscator,this.validatorSet=e.validatorSet,this.pageScope.defineBuiltIn("has-content",function(h){h=h;let p=this,c=p.currentLayoutPosition,f=c.firstFlowChunkOfFlow(h);return p.matchPageSide(c.startSideOfFlow(h))&&c.hasContent(h,p.lookupOffset)&&!!f&&!p.flowChunkIsAfterParentFlowForcedBreak(f)}),this.pageScope.defineName("page-number",new st(this.pageScope,function(){let h=this;return h.pageNumberOffset+h.currentLayoutPosition.page},"page-number")),this.pageScope.defineName("blank-page",new st(this.pageScope,function(){let h=this.currentLayoutPosition;return h==null?void 0:h.isBlankPage},"blank-page"))}sizeViewport(e,t,n,i){if(this.viewportProps.length){let r=new jh(this.rootScope,e,t,n),o=DE(r,this.viewportProps),s=o.width,l=o.height,a=o["text-zoom"],u=1;if(s&&l||a){let h=Te.em;if((a?a.evaluate(r,"text-zoom"):null)===S.scale&&(u=h/n,n=h,e*=u,t*=u),s&&l){let p=Pt(s.evaluate(r,"width"),r),c=Pt(l.evaluate(r,"height"),r);if(p>0&&c>0)return{width:i&&i.spreadView?(p+i.pageBorder)*2:p,height:c,fontSize:n}}}}return{width:e,height:t,fontSize:n}}},wp=class extends jh{constructor(e,t,n,i,r,o,s,l,a,u,h,p,c){super(e.rootScope,i.width,i.height,i.fontSize),this.style=e,this.xmldoc=t,this.viewport=i,this.clientLayout=r,this.fontMapper=o,this.customRenderer=s,this.fallbackMap=l,this.pageNumberOffset=a,this.documentURLTransformer=u,this.counterStore=h,d(this,"lang"),d(this,"primaryFlows",{body:!0}),d(this,"rootPageBoxInstance",null),d(this,"styler",null),d(this,"stylerMap",null),d(this,"currentLayoutPosition",null),d(this,"layoutPositionAtPageStart",null),d(this,"lookupOffset",0),d(this,"faces"),d(this,"pageBoxInstances",{}),d(this,"pageManager",null),d(this,"rootPageFloatLayoutContext"),d(this,"pageBreaks",{}),d(this,"pageProgression",null),d(this,"isVersoFirstPage",!1),d(this,"blankPageAtStart",!1),d(this,"pageSheetSize",{}),d(this,"pageSheetHeight",0),d(this,"pageSheetWidth",0),this.lang=t.lang||n,this.faces=new QN(this.style.fontDeobfuscator),this.rootPageFloatLayoutContext=new Ao(null,null,null,null,null,null,null),this.pageProgression=p||null,this.isVersoFirstPage=!!c;for(let f in e.flowProps){let v=e.flowProps[f],w=pt(v,"flow-consume");w&&(w.evaluate(this,"flow-consume")==S.all?this.primaryFlows[f]=!0:delete this.primaryFlows[f])}}init(){let e=X("StyleInstance.init"),t=this.counterStore.createCounterListener(this.xmldoc.url),n=this.counterStore.createCounterResolver(this.xmldoc.url,this.style.rootScope,this.style.pageScope);this.styler=new $g(this.xmldoc,this.style.cascade,this.style.rootScope,this,this.primaryFlows,this.style.validatorSet,t,n),n.setStyler(this.styler),this.styler.resetFlowChunkStream(this),this.stylerMap={},this.stylerMap[this.xmldoc.url]=this.styler;let i=this.styler.getTopContainerStyle();this.pageProgression||(this.pageProgression=mx(i)),this.matchStartPageSide(this.styler.breakBeforeValues[0])||(this.pageNumberOffset===0?this.isVersoFirstPage=!0:this.blankPageAtStart=!0);let r=this.style.rootBox;this.rootPageBoxInstance=new iT(r);let o=this.style.cascade.createInstance(this,t,n,this.lang);this.styler.cascade.currentPageType=this.styler.cascade.firstPageType,this.rootPageBoxInstance.applyCascadeAndInit(o,i),this.rootPageBoxInstance.resolveAutoSizing(this),this.pageManager=new bT(o,this.style.pageScope,this.rootPageBoxInstance,this,i);let s=[];for(let a of this.style.fontFaces){if(a.condition&&!a.condition.evaluate(this))continue;let u=KN(a.properties,this),h=new lx(u);s.push(h)}this.fontMapper.findOrLoadFonts(s,this.faces).then(()=>{MT(this.xmldoc.document,this.viewport.window,this.styler).thenFinish(e)});let l=this.style.pageProps;return l[""]||(l[""]={}),Object.keys(l).forEach(a=>{let u=l[a];this.styler.cascade.applyVarFilter([u],this.styler,null),this.styler.cascade.applyCalcFilter(u,this.styler.context);let h=Kg(Na(u),this);this.pageSheetSize[a]={width:h.pageWidth+h.cropOffset*2,height:h.pageHeight+h.cropOffset*2}}),e.result()}matchStartPageSide(e){let t=this.pageNumberOffset%2==(this.isVersoFirstPage?1:0),n=this.pageProgression=="ltr";switch(e){case"left":return t!==n;case"right":return t===n;case"recto":return t;case"verso":return!t;default:return!0}}getStylerForDoc(e){let t=this.stylerMap[e.url];if(!t){let n=this.style.store.getStyleForDoc(e),i=new jh(n.rootScope,this.pageWidth(),this.pageHeight(),this.initialFontSize),r=this.counterStore.createCounterListener(e.url),o=this.counterStore.createCounterResolver(e.url,n.rootScope,n.pageScope);t=new $g(e,n.cascade,n.rootScope,i,this.primaryFlows,n.validatorSet,r,o),this.stylerMap[e.url]=t}return t}registerInstance(e,t){this.pageBoxInstances[e]=t}lookupInstance(e){return this.pageBoxInstances[e]}encounteredFlowChunk(e,t){let n=this.currentLayoutPosition;if(n){n.flows[e.flowName]?t=n.flows[e.flowName]:n.flows[e.flowName]=t;let i=n.flowPositions[e.flowName];i||(i=new pE,n.flowPositions[e.flowName]=i);let r=hE(e.element),o=new Pi(r),s=new dE(o,e);i.positions.push(s)}}evalSupportsTest(e,t,n){if(n)return e==="selector"?this.evalSupportsSelector(t):!1;if(!e)return!1;let i=!0;class r{unknownProperty(a,u){i=!1}invalidPropertyValue(a,u){i=!1}simpleProperty(a,u,h){}}let o=new r,s=so(this.style.rootScope,new kn(t,null),"");return s?(this.xmldoc.store.validatorSet.validatePropertyAndHandleShorthand(e,s,!1,o),i):!1}evalSupportsSelector(e){let t=new Px(null),n=new kn(e+"{}",t);return new Ws(De,n,t,"").runParser(Number.POSITIVE_INFINITY,!1,!1,!1,!1)?!t.cascadeParserHandler.invalid:!1}getConsumedOffset(e){let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.positions.length;n++){let i=e.positions[n].chunkPosition.primary,r=i.steps[0].node,o=i.offsetInNode,s=i.after,l=0;for(;r.ownerDocument!=this.xmldoc.document;)l++,r=i.steps[l].node,s=!1,o=0;let a=this.xmldoc.getNodeOffset(r,o,s);a<t&&(t=a)}return t}getPosition(e,t){if(!e)return 0;let n=Number.POSITIVE_INFINITY;for(let i in this.primaryFlows){let r=e.flowPositions[i];if(!t&&(!r||r.positions.length==0)&&this.currentLayoutPosition&&(this.styler.styleUntilFlowIsReached(i),r=this.currentLayoutPosition.flowPositions[i],e!=this.currentLayoutPosition&&r&&(r=r.clone(),e.flowPositions[i]=r)),r){let o=this.getConsumedOffset(r);o<n&&(n=o)}}return n}dumpLocation(e){se.debug("Location - page",this.currentLayoutPosition.page),se.debug("  current:",e),se.debug("  lookup:",this.lookupOffset);for(let t in this.currentLayoutPosition.flowPositions){let n=this.currentLayoutPosition.flowPositions[t];for(let i of n.positions)se.debug("  Chunk",`${t}:`,i.flowChunk.startOffset)}}matchPageSide(e){switch(e){case"left":case"right":case"recto":case"verso":return new qe(this.style.pageScope,`${e}-page`).evaluate(this);default:return!0}}updateStartSide(e){for(let t in e.flowPositions){let n=e.flowPositions[t];if(n&&n.positions.length>0){let i=n.positions[0].flowChunk;if(this.getConsumedOffset(n)===i.startOffset){let r=n.positions[0].flowChunk.breakBefore,o=n.startBreakType;n.startBreakType=cg(Tt(o,r))}}}}selectPageMaster(e){let t=this.currentLayoutPosition,n=this.getPosition(t);if(n==Number.POSITIVE_INFINITY)return null;let i=this.rootPageBoxInstance.children,r;for(let o=0;o<i.length;o++){if(r=i[o],r.pageBox.pseudoName===mp)continue;let s=1;r.pageBox.pseudoName===dp&&!(this.actualPageWidth&&this.actualPageHeight)&&(s=1/0);let l=r.getProp(this,"utilization");l&&l.isNum()&&(s=l.num);let a=this.queryUnitSize("em",!1),u=this.pageWidth()*this.pageHeight(),h=Math.ceil(s*u/(a*a)),p=this.styler.cascade.currentPageType;this.lookupOffset=this.styler.styleUntil(n,h),this.styler.cascade.currentPageType=p,this.updateStartSide(t),this.layoutPositionAtPageStart=t.clone(),this.initLingering(),this.clearScope(this.style.pageScope);let c=r.getProp(this,"enabled");if(!c||c===S._true){if(t.page===1&&this.blankPageAtStart){r.style={};let f=e.size;e={},f&&(e.size=f)}return this.pageManager.getPageRulePageMaster(r,e)}}throw new Error("No enabled page masters")}flowChunkIsAfterParentFlowForcedBreak(e){let t=this.layoutPositionAtPageStart.flows,n=t[e.flowName].parentFlowName;if(n){let i=e.startOffset,r=t[n].forcedBreakOffsets;if(!r.length||i<r[0])return!1;let o=Ci(r.length,u=>r[u]>i)-1,s=r[o],l=this.layoutPositionAtPageStart.flowPositions[n],a=this.getConsumedOffset(l);return s<a?!1:a<s?!0:!this.matchPageSide(l.startBreakType)}return!1}setFormattingContextToColumn(e,t){let n=this.currentLayoutPosition.flows[t];n.formattingContext||(n.formattingContext=new Qd(null)),e.flowRootFormattingContext=n.formattingContext}layoutDeferredPageFloats(e){let t=e.pageFloatLayoutContext,n=t.getDeferredPageFloatContinuations(),i=l=>{if(l.floatReference!==Ke.PAGE)return!1;let a=this.layoutPositionAtPageStart.flowPositions.body,u=a&&this.getConsumedOffset(a),h=this.xmldoc.getNodeOffset(l.nodePosition.steps[0].node,0,!1);return h!=null&&u!=null&&h>u},r=X("layoutDeferredPageFloats"),o=!1,s=0;return r.loopWithFrame(l=>{if(s===n.length){l.breakLoop();return}let a=n[s++],u=a.float;if(i(u)){l.breakLoop();return}let h=new Zr().findByFloat(u),p=h.findPageFloatFragment(u,t);if(p&&p.hasFloat(u)){l.continueLoop();return}else if(t.isForbidden(u)||t.hasPrecedingFloatsDeferredToNext(u)){t.deferPageFloat(a),l.breakLoop();return}e.layoutPageFloatInner(a,h,null,p).then(c=>{if(!c){l.breakLoop();return}let f=t.parent.isInvalidated();if(f){l.breakLoop();return}else t.isInvalidated()&&!f&&(o=!0,t.validate());l.continueLoop()})}).then(()=>{o&&t.invalidate(),r.finish(!0)}),r.result()}getLastAfterPositionIfDeferredFloatsExists(e,t){if(e.pageFloatLayoutContext.getPageFloatContinuationsDeferredToNext().length>0)if(e.lastAfterPosition){let n;return t?(n=t.clone(),n.primary=e.lastAfterPosition):n=new Pi(e.lastAfterPosition),n}else return null;else return null}layoutColumn(e,t){let n=this.currentLayoutPosition.flowPositions[t];if(!n||!this.matchPageSide(n.startBreakType))return F(!0);this.setFormattingContextToColumn(e,t),e.init(),this.primaryFlows[t]&&e.bands.length>0&&(e.forceNonfitting=!1);let i=X("layoutColumn");return this.layoutDeferredPageFloats(e).then(()=>{if(e.pageFloatLayoutContext.isInvalidated()){i.finish(!0);return}let r=[],o=[],s=!0;i.loopWithFrame(l=>{if(e.pageFloatLayoutContext.hasContinuingFloatFragmentsInFlow(t)){l.breakLoop();return}for(;n.positions.length-o.length>0;){let a=0;for(;o.includes(a);)a++;let u=n.positions[a];if(u.flowChunk.startOffset>this.lookupOffset||this.flowChunkIsAfterParentFlowForcedBreak(u.flowChunk))break;for(let c=a+1;c<n.positions.length;c++){if(o.includes(c))continue;let f=n.positions[c];if(f.flowChunk.startOffset>this.lookupOffset||this.flowChunkIsAfterParentFlowForcedBreak(f.flowChunk))break;f.flowChunk.isBetter(u.flowChunk)&&(u=f,a=c)}let h=u.flowChunk,p=!0;if(e.layout(u.chunkPosition,s,n.breakAfter).then(c=>{if(e.pageFloatLayoutContext.isInvalidated()){l.breakLoop();return}if(s=!1,u.flowChunk.repeated&&(c===null||h.exclusive)&&r.push(a),h.exclusive){o.push(a),l.breakLoop();return}else{let f=!!c||!!e.pageBreakType,v=this.getLastAfterPositionIfDeferredFloatsExists(e,c);if(e.pageBreakType&&v?(u.chunkPosition=v,n.breakAfter=e.pageBreakType,e.pageBreakType=null):(o.push(a),(c||v)&&(u.chunkPosition=c||v,r.push(a)),n.startBreakType=cg(e.pageBreakType)),f){l.breakLoop();return}}e.forceNonfitting=!1,p?p=!1:l.continueLoop()}),p){p=!1;return}}l.breakLoop()}).then(()=>{if(!e.pageFloatLayoutContext.isInvalidated()){n.positions=n.positions.filter((a,u)=>r.includes(u)||!o.includes(u)),n.breakAfter==="column"&&(n.breakAfter=null),e.saveDistanceToBlockEndFloats();let l=e.pageFloatLayoutContext.getMaxReachedAfterEdge();e.updateMaxReachedAfterEdge(l)}i.finish(!0)})}),i.result()}createLayoutConstraint(e){let t=this.currentLayoutPosition.page-1,n=this.counterStore.createLayoutConstraint(t);return new WP([n].concat(e.getLayoutConstraints()))}createAndLayoutColumn(e,t,n,i,r,o,s,l,a,u,h,p,c,f){let v=e.vertical?e.isAutoWidth&&e.isRightDependentOnAutoWidth:e.isAutoHeight&&e.isTopDependentOnAutoHeight,w=r.element,y=new Ao(l,Ke.COLUMN,null,s,null,null,null),g=this.currentLayoutPosition.clone(),m=X("createAndLayoutColumn"),x;return m.loopWithFrame(C=>{let N=this.createLayoutConstraint(y);if(a>1){let A=this.viewport.document.createElement("div");if(O(A,"position","absolute"),w.appendChild(A),x=new Ea(A,c,this.clientLayout,N,y),x.forceNonfitting=f,x.vertical=r.vertical,x.rtl=r.rtl,x.snapHeight=r.snapHeight,x.snapWidth=r.snapWidth,r.vertical){let L=(r.rtl?a-o-1:o)*(h+u)+r.paddingTop,z=parseFloat(w.style.width);x.setHorizontalPosition(r.paddingLeft+z-r.width,r.width),x.setVerticalPosition(L,h)}else{let L=(r.rtl?a-o-1:o)*(h+u)+r.paddingLeft;x.setVerticalPosition(r.paddingTop,r.height),x.setHorizontalPosition(L,h)}x.originX=t,x.originY=n}else x=new Ea(w,c,this.clientLayout,N,y),x.copyFrom(r);x.exclusions=v?[]:i.concat(),x.innerShape=p,y.setContainer(x),(x.vertical?x.height:x.width)>=0?this.layoutColumn(x,s).then(()=>{y.isInvalidated()||y.finish(),x.pageFloatLayoutContext.isInvalidated()&&!l.isInvalidated()?(x.pageFloatLayoutContext.validate(),this.currentLayoutPosition=g.clone(),x.element!==w&&w.removeChild(x.element),C.continueLoop()):C.breakLoop()}):(y.finish(),C.breakLoop())}).then(()=>{m.finish(x)}),m.result()}setPagePageFloatLayoutContextContainer(e,t,n){(t instanceof yx||t instanceof pp&&!(t instanceof ts))&&e.setContainer(n)}getRegionPageFloatLayoutContext(e,t,n,i){let r=t.getProp(this,"writing-mode")||null,o=t.getProp(this,"direction")||null;return new Ao(e,Ke.REGION,n,i,null,r,o)}layoutFlowColumnsWithBalancing(e,t,n,i,r,o,s,l,a){let u=this.currentLayoutPosition.clone(),h=this.getRegionPageFloatLayoutContext(o,t,s,l),p=!0,c=()=>(this.currentLayoutPosition=u.clone(),this.layoutFlowColumns(e,t,n,i,r,o,h,s,l,a,p).thenAsync(f=>F(f?{columns:f,position:this.currentLayoutPosition}:null)));return c().thenAsync(f=>{if(!f)return F(null);if(a<=1)return F(f.columns);let v=t.getProp(this,"column-fill")||S.balance,w=this.currentLayoutPosition.flowPositions[l],y=LN(a,v,c,h,s,f.columns,w);return y?(p=!1,o.lock(),h.lock(),y.balanceColumns(f).thenAsync(g=>(o.unlock(),o.validate(),h.unlock(),this.currentLayoutPosition=g.position,F(g.columns)))):F(f.columns)})}layoutFlowColumns(e,t,n,i,r,o,s,l,a,u,h){let p=X("layoutFlowColumns"),c=this.currentLayoutPosition.clone(),f=t.getPropAsNumber(this,"column-gap"),v=u>1?t.getPropAsNumber(this,"column-width"):l.vertical?l.height:l.width,w=t.getActiveRegions(this),y=t.getProp(this,"shape-inside"),g=my(y,0,0,l.width,l.height,this),m=new UT(a,this,this.viewport,this.styler,w,this.xmldoc,this.faces,this.style.footnoteProps,this,e,this.customRenderer,this.fallbackMap,this.documentURLTransformer),x=0,C=null,N=[];return p.loopWithFrame(A=>{this.createAndLayoutColumn(t,n,i,r,l,x++,a,s,u,f,v,g,m,h).then(L=>{if(o.isInvalidated()){N=null,A.breakLoop();return}if((L.pageBreakType&&L.pageBreakType!=="column"||x===u)&&!s.isInvalidated()&&s.finish(),s.isInvalidated()){x=0,this.currentLayoutPosition=c.clone(),s.validate(),s.isLocked()?(N=null,A.breakLoop()):A.continueLoop();return}C=L,N[x-1]=C,C.pageBreakType&&C.pageBreakType!="column"&&(x=u,C.pageBreakType!="region"&&(this.pageBreaks[a]=!0)),x<u?A.continueLoop():A.breakLoop()})}).then(()=>{p.finish(N)}),p.result()}layoutContainer(e,t,n,i,r,o,s){t.reset();let l=t.getProp(this,"enabled");if(l&&l!==S._true)return F(!0);let a=X("layoutContainer"),u=t.getProp(this,"wrap-flow")===S.auto,h=t.getProp(this,"flow-from"),p=this.viewport.document.createElement("div"),c=t.getProp(this,"position");O(p,"position",c?c.name:"absolute");let f=t instanceof ts;t instanceof Ys?n.appendChild(p):n.insertBefore(p,n.firstChild);let v=new Qy(p);v.vertical=t.vertical,v.rtl=t.rtl,v.borderBoxSizing=t.borderBoxSizing,v.exclusions=o,t.prepareContainer(this,v,e,this.faces,this.clientLayout),t instanceof ts&&(v.width<=0||v.height<=0)&&se.warn("Negative or zero page area size"),v.originX=i,v.originY=r,i+=v.left+v.marginLeft+v.borderLeft,r+=v.top+v.marginTop+v.borderTop,this.setPagePageFloatLayoutContextContainer(s,t,v);let w,y=!1;if(!h||!h.isIdent()){let g=t.getProp(this,"content");if(g instanceof ie&&g.expr instanceof st&&g.expr.str.startsWith("running-element-"))g.visit(new Sa(p,this,g,this.counterStore.getExprContentListener()));else if(g&&Ni(g)){let m="span";g.url&&(m="img");let x=this.viewport.document.createElement(m);g.visit(new Sa(x,this,g,this.counterStore.getExprContentListener())),p.appendChild(x),m=="img"&&t.transferSingleUriContentProps(this,x,this.faces),t.transferContentProps(this,v,e,this.faces),m=="span"&&_P(x,t.getProp(this,"text-autospace"),t.getProp(this,"text-spacing-trim"),t.getProp(this,"hanging-punctuation"),this.lang,t.vertical)}else t.suppressEmptyBoxGeneration&&(n.removeChild(p),y=!0);y||t.finishContainer(this,v,e,null,1,this.clientLayout,this.faces),w=F(!0)}else if(this.pageBreaks[h.toString()])s.isInvalidated()||t.finishContainer(this,v,e,null,1,this.clientLayout,this.faces),w=F(!0);else{let g=X("layoutContainer.inner"),m=h.toString(),x=t.getPropAsNumber(this,"column-count");this.layoutFlowColumnsWithBalancing(e,t,i,r,o,s,v,m,x).then(C=>{if(!s.isInvalidated()){let N=C[0];N.element===p&&(v=N),v.computedBlockSize=Math.max.apply(null,C.map(L=>L.computedBlockSize)),t.finishContainer(this,v,e,N,x,this.clientLayout,this.faces);let A=this.currentLayoutPosition.flowPositions[m];A&&A.breakAfter==="region"&&(A.breakAfter=null)}g.finish(!0)}),w=g.result()}return w.then(()=>{if(s.isInvalidated()){a.finish(!0);return}if(!t.isAutoHeight||Math.floor(v.computedBlockSize)>0){if(!y&&!u){let m=t.getProp(this,"shape-outside"),x=v.getOuterShape(m,this);o.push(x)}}else if(t.children.length==0){n.removeChild(p),a.finish(!0);return}let g=f?0:t.children.length-1;a.loop(()=>{for(;g>=0&&g<t.children.length;){let m=t.children[f?g++:g--],x=this.layoutContainer(e,m,p,i,r,o,s);if(x.isPending())return x.thenAsync(()=>F(!s.isInvalidated()));if(s.isInvalidated())break}return F(!1)}).then(()=>{a.finish(!0)})}),a.result()}processLinger(){let e=this.currentLayoutPosition.page;for(let t in this.currentLayoutPosition.flowPositions){let n=this.currentLayoutPosition.flowPositions[t];for(let i=n.positions.length-1;i>=0;i--){let r=n.positions[i];r.flowChunk.startPage>=0&&r.flowChunk.startPage+r.flowChunk.linger-1<=e&&n.positions.splice(i,1)}}}initLingering(){let e=this.currentLayoutPosition.page;for(let t in this.currentLayoutPosition.flowPositions){let n=this.currentLayoutPosition.flowPositions[t];for(let i=n.positions.length-1;i>=0;i--){let r=n.positions[i];r.flowChunk.startPage<0&&r.flowChunk.startOffset<this.lookupOffset&&(r.flowChunk.startPage=e)}}}noMorePrimaryFlows(e){for(let t in this.primaryFlows){let n=e.flowPositions[t];if(n&&n.positions.length>0)return!1}return!0}layoutNextPage(e,t){var n;let i=e.container===e.bleedBox;this.pageBreaks={},t?(this.currentLayoutPosition=t.clone(),this.styler.replayFlowElementsFromOffset(t.highestSeenOffset)):(this.currentLayoutPosition=new fE,this.styler.replayFlowElementsFromOffset(-1)),this.lang&&e.bleedBox.setAttribute("lang",this.lang),t=this.currentLayoutPosition;let r=1e4;if(t.page>r)throw new Error(`Too many pages generated (over ${r} pages)`);let o=t.startSideOfFlow("body");t.isBlankPage=ks(o)&&this.matchPageSide(o),e.isBlankPage=t.isBlankPage,t.page++,e.pageType==null&&(e.pageType=(n=e.isBlankPage?this.styler.cascade.previousPageType:this.styler.cascade.currentPageType)!=null?n:"",this.styler.cascade.previousPageType=this.styler.cascade.currentPageType),this.clearScope(this.style.pageScope),this.layoutPositionAtPageStart=t.clone();let s=i?{}:this.pageManager.getCascadedPageStyle(e.pageType);if(this.styler.cascade.applyVarFilter([s],this.styler,null),this.styler.cascade.applyCalcFilter(s,this.styler.context),!i){let f=new qe(this.style.pageScope,"left-page");e.side=f.evaluate(this)?"left":"right",e.container.setAttribute("data-vivliostyle-page-side",e.side)}let l=this.selectPageMaster(s);if(!l)return F(null);let a=0;if(!i){e.setAutoPageWidth(l.pageBox.specified.width.value===Ds),e.setAutoPageHeight(l.pageBox.specified.height.value===Vs),this.counterStore.setCurrentPage(e),this.counterStore.updatePageCounters(s,this);let f=Kg(Na(s),this);this.setPageSizeAndBleed(f,e),pT(s,f,e,this),a=f.bleedOffset+f.bleed}let u=!i&&l.getProp(this,"writing-mode")||S.horizontal_tb;this.pageVertical=u!=S.horizontal_tb;let h=l.getProp(this,"direction")||S.ltr,p=new Ao(this.rootPageFloatLayoutContext,Ke.PAGE,null,null,null,u,h),c=X("layoutNextPage");return c.loopWithFrame(f=>{this.layoutContainer(e,l,e.bleedBox,a,a,[],p).then(()=>{p.isInvalidated()||p.finish(),p.isInvalidated()?(this.currentLayoutPosition=this.layoutPositionAtPageStart.clone(),p.validate(),f.continueLoop()):f.breakLoop()})}).then(()=>{l.adjustPageLayout(this,e,this.clientLayout),i||(this.processLinger(),t=this.currentLayoutPosition,Object.keys(t.flowPositions).forEach(v=>{let w=t.flowPositions[v],y=w.breakAfter;y&&(y==="page"||!this.matchPageSide(y))&&(w.breakAfter=null)})),this.currentLayoutPosition=this.layoutPositionAtPageStart=null,t.highestSeenOffset=this.styler.getReachedOffset();let f=this.style.store.getTriggersForDoc(this.xmldoc);e.finish(f,this.clientLayout),this.noMorePrimaryFlows(t)&&(t=null),c.finish(t)}),c.result()}setPageSizeAndBleed(e,t){this.actualPageWidth=e.pageWidth,this.actualPageHeight=e.pageHeight,this.pageSheetWidth=e.pageWidth+e.cropOffset*2,this.pageSheetHeight=e.pageHeight+e.cropOffset*2,t.container.style.width=`${this.pageSheetWidth}px`,t.container.style.height=`${this.pageSheetHeight}px`,t.bleedBox.style.left=`${e.bleedOffset}px`,t.bleedBox.style.width=`${e.pageWidth}px`,t.bleedBox.style.top=`${e.bleedOffset}px`,t.bleedBox.style.height=`${e.pageHeight}px`,t.bleedBox.style.padding=`${e.bleed}px`}},QT=class Oc extends Es{constructor(t,n,i,r){super(t.rootScope,t,n,i,r,t.validatorSet,!i),this.masterHandler=t,d(this,"insideRegion",!1)}startPageTemplateRule(){}startPageMasterRule(t,n,i){let r=new ax(this.masterHandler.pageScope,t,n,i,this.masterHandler.rootBox,this.condition,this.owner.getBaseSpecificity());this.masterHandler.pushHandler(new sT(r.scope,this.masterHandler,r,this.validatorSet))}startWhenRule(t){let n=t.expr;this.condition!=null&&(n=an(this.scope,this.condition,n)),this.masterHandler.pushHandler(new Oc(this.masterHandler,n,this,this.regionId))}startDefineRule(){this.masterHandler.pushHandler(new TP(this.scope,this.owner))}startFontFaceRule(){let t={};this.masterHandler.fontFaces.push({properties:t,condition:this.condition}),this.masterHandler.pushHandler(new xl(this.scope,this.owner,null,t,this.masterHandler.validatorSet,"font-face"))}startFlowRule(t){let n=this.masterHandler.flowProps[t];n||(n={},this.masterHandler.flowProps[t]=n),this.masterHandler.pushHandler(new xl(this.scope,this.owner,null,n,this.masterHandler.validatorSet))}startViewportRule(){let t={};this.masterHandler.viewportProps.push(t),this.masterHandler.pushHandler(new xl(this.scope,this.owner,this.condition,t,this.masterHandler.validatorSet))}startFootnoteRule(t){let n=this.masterHandler.footnoteProps;if(t){let i=Ja(n,"_pseudos");n=i[t],n||(n={},i[t]=n)}this.masterHandler.pushHandler(new xl(this.scope,this.owner,null,n,this.masterHandler.validatorSet))}startRegionRule(){this.insideRegion=!0,this.startSelectorRule()}startPageRule(){let t=new LT(this.masterHandler.pageScope,this.masterHandler,this,this.validatorSet,this.masterHandler.pageProps);this.masterHandler.pushHandler(t),t.startPageRule()}startRuleBody(){if(Es.prototype.startRuleBody.call(this),this.insideRegion){this.insideRegion=!1;let t=`R${this.masterHandler.regionCount++}`;this.special("region-id",K(t)),this.endRule();let n=new Oc(this.masterHandler,this.condition,this,t);this.masterHandler.pushHandler(n),n.startRuleBody()}}},Px=class extends Mk{constructor(e){super(),this.validatorSet=e,d(this,"rootScope"),d(this,"pageScope"),d(this,"rootBox"),d(this,"cascadeParserHandler"),d(this,"regionCount",0),d(this,"fontFaces",[]),d(this,"footnoteProps",{}),d(this,"flowProps",{}),d(this,"viewportProps",[]),d(this,"pageProps",{}),this.rootScope=new Gh(null),this.pageScope=new Gh(this.rootScope),this.rootBox=new eT(this.rootScope),this.cascadeParserHandler=new QT(this,null,null,null),this.slave=this.cascadeParserHandler}};function ZT(e,t){return t.parseOPSResource(e)}var JT=class extends Hd{constructor(e){super(ZT,"document"),this.fontDeobfuscator=e,d(this,"styleByKey",{}),d(this,"styleFetcherByKey",{}),d(this,"styleByDocURL",{}),d(this,"triggersByDocURL",{}),d(this,"validatorSet",null),d(this,"styleSheets",[]),d(this,"triggerSingleDocumentPreprocessing",!1)}init(e,t){this.setStyleSheets(e,t);let n=X("OPSDocStore.init");return this.validatorSet=sx(),qT().then(()=>{this.triggerSingleDocumentPreprocessing=!0,n.finish(!0)}),n.result()}getStyleForDoc(e){return this.styleByDocURL[e.url]}getTriggersForDoc(e){return this.triggersByDocURL[e.url]}setStyleSheets(e,t){this.clearStyleSheets(),e&&e.forEach(this.addAuthorStyleSheet,this),t&&t.forEach(this.addUserStyleSheet,this)}clearStyleSheets(){this.styleSheets.splice(0)}addAuthorStyleSheet(e){let t=e.url;t&&(t=Ue(Cs(t),qr)),this.styleSheets.push({url:t,text:e.text,flavor:"Author",classes:null,media:null})}addUserStyleSheet(e){let t=e.url;t&&(t=Ue(Cs(t),qr)),this.styleSheets.push({url:t,text:e.text,flavor:"User",classes:null,media:null})}parseOPSResource(e){let t=X("OPSDocStore.load"),n=e.url,i=n.endsWith("?viv-toc-box");return kx(e,this).then(r=>{var o;if(!r){t.finish(null);return}if(this.triggerSingleDocumentPreprocessing){let c=Sn("PREPROCESS_SINGLE_DOCUMENT");for(let f=0;f<c.length;f++)try{c[f](r.document)}catch(v){se.warn("Error during single document preprocessing:",v)}}let s=[],l=r.document.getElementsByTagNameNS("http://www.idpf.org/2007/ops","trigger");for(let c=0;c<l.length;c++){let f=l[c],v=f.getAttributeNS("http://www.w3.org/2001/xml-events","observer"),w=f.getAttributeNS("http://www.w3.org/2001/xml-events","event"),y=f.getAttribute("action"),g=f.getAttribute("ref");v&&w&&y&&g&&s.push({observer:v,event:w,action:y,ref:g})}this.triggersByDocURL[n]=s;let a=[];if(a.push({url:Ue("user-agent-page.css",tr),text:Ey,flavor:"UA",classes:null,media:null}),i)a.push({url:Ue("user-agent-toc.css",tr),text:Ny,flavor:"UA",classes:null,media:null});else{let c=r.document.querySelectorAll("style, link, meta");for(let f of c){let v=f.namespaceURI,w=f.localName;if(v=="http://www.w3.org/1999/xhtml")if(w=="style"){let y=f.getAttribute("class"),g=f.getAttribute("media"),m=f.getAttribute("title");a.push({url:n,text:f.textContent,flavor:"Author",classes:m?y:null,media:g})}else if(w=="link"){let y=f.getAttribute("href"),g=(o=f.getAttribute("rel"))==null?void 0:o.split(/\s+/),m=f.getAttribute("class"),x=f.getAttribute("media");if(y&&g!=null&&g.includes("stylesheet")&&(!g.includes("alternate")||m)){let C=Ue(y,n),N=f.getAttribute("title");a.push({url:C,text:null,classes:N?m:null,media:x,flavor:"Author"})}}else w=="meta"&&f.getAttribute("name")=="viewport"&&a.push({url:n,text:this.processViewportMeta(f),flavor:"Author",classes:null,media:null})}for(let f=0;f<this.styleSheets.length;f++)a.push(this.styleSheets[f])}let u="";for(let c=0;c<a.length;c++)u+=a[c].url,u+="^",a[c].text&&(u+=a[c].text),u+="^";let h=this.styleByKey[u];if(h){this.styleByDocURL[n]=h,t.finish(r);return}let p=this.styleFetcherByKey[u];p||(p=new Us(()=>{let c=X("fetchStylesheet"),f=0,v=new Px(this.validatorSet);return c.loop(()=>{if(f<a.length){let w=a[f++];return v.startStylesheet(w.flavor),w.text!==null?Gd(w.text,v,w.url,w.classes,w.media).thenReturn(!0):Oy(w.url,v,w.classes,w.media)}return F(!1)}).then(()=>{let w=v.cascadeParserHandler.finish();h=new KT(this,v.rootScope,v.pageScope,w,v.rootBox,v.fontFaces,v.footnoteProps,v.flowProps,v.viewportProps,v.pageProps),this.styleByKey[u]=h,delete this.styleFetcherByKey[u],c.finish(h)}),c.result()},`FetchStylesheet ${n}`),this.styleFetcherByKey[u]=p,p.start()),p.get().then(c=>{this.styleByDocURL[n]=c,t.finish(r)})}),t.result()}processViewportMeta(e){return""}},ns="",em="",eI="";function yp(e){let t=Array.from(e.querySelectorAll("nav[*|type],nav[epub\\:type]"));if(t.length>0||(t=Array.from(e.querySelectorAll("[role=doc-toc]")),t.length>0))return t;let n="nav,.toc,#toc,#table-of-contents,#contents,[role=directory]";for(let i of e.querySelectorAll(n)){if(t.find(o=>o.contains(i)))continue;let r=i;/^h[1-6]$/.test(r.localName)&&(r.previousElementSibling?r=r.nextElementSibling:r=r.parentElement),r&&r.querySelector("li a[href]")&&t.push(r)}return t}function tI(e){let t=yp(e),n=[];for(let i of t)for(let r of i.querySelectorAll("li a[href]"))n.push(r);return n}var nI=class{constructor(e,t,n,i,r,o,s,l,a,u){this.store=e,this.url=t,this.lang=n,this.clientLayout=i,this.fontMapper=r,this.rendererFactory=s,this.fallbackMap=l,this.documentURLTransformer=a,this.counterStore=u,d(this,"pref"),d(this,"page",null),d(this,"instance",null),this.pref=Hw(o),this.pref.spreadView=!1}setAutoHeight(e,t){if(t--!=0){for(let n=e.firstChild;n;n=n.nextSibling)if(n.nodeType==1){let i=n;ai(i,"height","auto")!="auto"&&(O(i,"height","auto"),this.setAutoHeight(i,t)),ai(i,"position","static")=="absolute"&&(O(i,"position","relative"),this.setAutoHeight(i,t))}}}makeCustomRenderer(e){let t=this.rendererFactory.makeCustomRenderer(e);return(n,i,r)=>{let o=r.behavior;if(o)switch(o.toString()){case"toc-node-anchor":r.color=S.inherit,r["text-decoration"]=S.none;break;case"toc-node":r.display=S.block,r.margin=Ie,r.padding=Ie,r["padding-inline-start"]=new $(1.25,"em");break;case"toc-node-first-child":r.display=S.inline_block,r.margin=new $(.2,"em"),r["vertical-align"]=S.top,r.color=S.inherit,r["text-decoration"]=S.none;break;case"toc-container":r.padding=Ie;break}if(!o||o.toString()!="toc-node"&&o.toString()!="toc-container")return t(n,i,r);let s=n.firstChild;s&&s.nodeType!==1&&lt(s)&&n.replaceChild(n.ownerDocument.createComment(s.textContent),s);let l=i.getAttribute("data-adapt-class");if(l=="toc-node"){let u=i.firstChild;u.textContent!=ns&&(u.textContent=ns,O(u,"cursor","pointer"),u.addEventListener("click",iI,!1),u.setAttribute("role","button"),u.setAttribute("aria-expanded","false"),i.setAttribute("aria-expanded","false"),i.style.height!=="0px"&&(u.tabIndex=0))}let a=i.ownerDocument.createElement("div");if(a.setAttribute("data-adapt-process-children","true"),o.toString()=="toc-node"){let u=i.ownerDocument.createElement("div");if(u.textContent=eI,O(u,"margin","0.2em 0 0 -1em"),O(u,"margin-inline-start","-1em"),O(u,"margin-inline-end","0"),O(u,"display","inline-block"),O(u,"width","1em"),O(u,"text-align","center"),O(u,"vertical-align","top"),O(u,"cursor","default"),O(u,"font-family","Menlo,sans-serif"),a.appendChild(u),O(a,"overflow","hidden"),a.setAttribute("data-adapt-class","toc-node"),a.setAttribute("role","treeitem"),l=="toc-node"||l=="toc-container"){O(a,"height","0px");let h=n.firstElementChild;h&&h.localName==="a"&&(h.tabIndex=-1)}else i.setAttribute("role","tree")}else l=="toc-node"&&(a.setAttribute("data-adapt-class","toc-container"),a.setAttribute("role","group"),a.setAttribute("aria-hidden","true"));return F(a)}}showTOC(e,t,n,i,r){if(this.page)return F(this.page);let o=X("showTOC"),s=new Hy(e,e);this.page=s;let l=Dn(this.url)+"?viv-toc-box";return this.store.load(l).then(a=>{for(let f of yp(a.document))f.setAttribute("data-vivliostyle-role","doc-toc");let u=this.store.getStyleForDoc(a),h=u.sizeViewport(n,1e5,r);t=new Ta(t.window,h.fontSize,0,t.root,h.width,h.height);let p=this.makeCustomRenderer(a),c=new wp(u,a,this.lang,t,this.clientLayout,this.fontMapper,p,this.fallbackMap,0,this.documentURLTransformer,this.counterStore);this.instance=c,c.pref=this.pref,c.init().then(()=>{c.layoutNextPage(s,null).then(()=>{this.setAutoHeight(e,2),o.finish(s)})})}),o.result()}hideTOC(){this.page&&(this.page.container.style.visibility="hidden",this.page.container.setAttribute("aria-hidden","true"))}isTOCVisible(){return!!this.page&&this.page.container.style.visibility==="visible"}getTOC(){if(!this.page)return[];function e(i){if(!i)return[];let r=i.querySelectorAll(":scope > [role=treeitem] > a[href]");return Array.from(r).map(t)}function t(i){let r=new URL(i.href),[,o]=r.hash.match(/^#?(.*)$/),s=i.innerText,l=i.parentElement.querySelector("[role=group]"),a=e(l);return{id:o,title:s,children:a}}let n=this.page.container.querySelector("[role=tree]");return e(n)}};function iI(e){let t=e.target,n=t.textContent==ns;t.textContent=n?em:ns;let i=t.parentNode;t.setAttribute("aria-expanded",n?"true":"false"),i.setAttribute("aria-expanded",n?"true":"false");let r=i.firstChild;for(;r;){if(r.nodeType===1){let o=r,s=o.getAttribute("data-adapt-class");if(s==="toc-container"){if(o.setAttribute("aria-hidden",n?"false":"true"),o.firstChild){r=o.firstChild;continue}}else if(s==="toc-node"&&(o.style.height=n?"auto":"0px",o.children.length>=2&&(o.children[1].tabIndex=n?0:-1),o.children.length>=3&&(o.children[0].tabIndex=n?0:-1,!n))){let l=o.children[0];if(l.textContent==em){l.textContent=ns,l.setAttribute("aria-expanded","false"),o.setAttribute("aria-expanded","false"),r=o.children[2];continue}}}for(;!r.nextSibling&&r.parentNode!==i;)r=r.parentNode;r=r.nextSibling}e.stopPropagation()}var tm=class extends JT{constructor(){super(null),d(this,"plainXMLStore"),d(this,"jsonStore"),d(this,"opfByURL",{}),d(this,"primaryOPFByEPubURL",{}),d(this,"deobfuscators",{}),d(this,"documents",{}),this.fontDeobfuscator=this.makeDeobfuscatorFactory(),this.plainXMLStore=jT(),this.jsonStore=Fk()}makeDeobfuscatorFactory(){return e=>this.deobfuscators[e]}loadAsPlainXML(e,t,n){return this.plainXMLStore.load(e,t,n)}startLoadingAsPlainXML(e){this.plainXMLStore.fetch(e)}loadAsJSON(e,t,n){return this.jsonStore.load(e,t,n)}loadPubDoc(e){let t=X("loadPubDoc");return Qa(e,null,"HEAD").then(n=>{if(n.status>=400)this.loadEPUBDoc(e).then(i=>{if(i){t.finish(i);return}se.error(`Failed to fetch a source document from ${e} (${n.status}${n.statusText?" "+n.statusText:""})`),t.finish(null)});else if(!n.status&&!n.responseXML&&!n.responseText&&!n.responseBlob&&!n.contentType&&/\/[^/.]+(?:[#?]|$)/.test(e)&&(e=e.replace(/([#?]|$)/,"/$1")),n.contentType=="application/oebps-package+xml"||/\.opf(?:[#?]|$)/.test(e)){let[,i,r]=e.match(/^((?:.*\/)?)([^/]*)$/);this.loadOPF(i,r).thenFinish(t)}else n.contentType=="application/ld+json"||n.contentType=="application/webpub+json"||n.contentType=="application/audiobook+json"||n.contentType=="application/json"||/\.json(?:ld)?(?:[#?]|$)/.test(e)?this.loadAsJSON(e,!0).then(i=>{if(!i){this.reportLoadError(e),t.finish(null);return}let r=new Hl(this,e);r.initWithWebPubManifest(i,void 0,e).then(()=>{t.finish(r)})}):this.loadWebPub(e).then(i=>{if(i){t.finish(i);return}this.loadEPUBDoc(e).then(r=>{if(r){t.finish(r);return}se.error(`Failed to load ${e}.`),t.finish(null)})})}),t.result()}loadEPUBDoc(e){let t=X("loadEPUBDoc");e.endsWith("/")||(e=e+"/"),this.startLoadingAsPlainXML(e+"META-INF/encryption.xml");let n=e+"META-INF/container.xml";return this.loadAsPlainXML(n).then(i=>{if(i){let r=i.doc().child("container").child("rootfiles").child("rootfile").attribute("full-path");for(let o of r)if(o){this.loadOPF(e,o).thenFinish(t);return}}t.finish(null)}),t.result()}loadOPF(e,t){let n=e+t,i=this.opfByURL[n];if(i)return F(i);let r=X("loadOPF");return this.loadAsPlainXML(n,!0,`Failed to fetch EPUB OPF ${n}`).then(o=>{o?(i=new Hl(this,e),this.opfByURL[n]=i,this.primaryOPFByEPubURL[e]=i,this.plainXMLStore.resources[e+"META-INF/container.xml"]?this.loadAsPlainXML(e+"META-INF/encryption.xml").then(s=>{i.initWithXMLDoc(o,s).then(()=>{r.finish(i)})}):i.initWithXMLDoc(o,null).then(()=>{r.finish(i)})):this.reportLoadError(n)}),r.result()}loadWebPub(e){let t=X("loadWebPub");return this.load(e).then(n=>{if(!n)this.reportLoadError(e);else if(n.document.querySelector("a[href='META-INF/'],a[href$='/META-INF/']"))t.finish(null);else{let i=n.document,r=new Hl(this,e),o=i.querySelector("link[rel='publication'],link[rel='manifest'][type='application/webpub+json']");if(o){let s=o.getAttribute("href");if(/^#/.test(s)){let l=Od(i.getElementById(s.substr(1)).textContent);r.initWithWebPubManifest(l,i).then(()=>{t.finish(r)})}else{let l=Ue(o.getAttribute("href"),e);this.loadAsJSON(l,!0,`Failed to fetch Publication Manifest ${l}`).then(a=>{r.initWithWebPubManifest(a,i,l).then(()=>{t.finish(r)})})}}else r.initWithWebPubManifest({},i).then(()=>{r.toc&&r.toc.src===n.url&&yp(i).length===0&&(r.toc=null),t.finish(r)})}}),t.result()}addDocument(e,t){let n=X("EPUBDocStore.load"),i=Dn(e);return(this.documents[i]=this.parseOPSResource({status:200,statusText:"",url:i,contentType:t.contentType,responseText:null,responseXML:t,responseBlob:null})).thenFinish(n),n.result()}reportLoadError(e){let t=i=>i.replace(/([^:/?#]|^)[/?#].*/,"$1"),n=()=>{let i=t(e);return!(i===t(qr)||Object.keys(this.resources).find(r=>this.resources[r]&&t(r)===i)||!/^https?:?\/\/[^/]/.test(e)||/\.(xhtml|xht|xml|opf)$/i.test(e))};e.startsWith("data:")?se.error(`Failed to load ${e}. Invalid data.`):e.startsWith("http:")&&qr.startsWith("https:")?se.error(`Failed to load ${e}. Mixed Content ("http:" content on "https:" context) is not allowed.`):n()?se.error(`Failed to load ${e}. This may be caused by the server not allowing cross-origin resource sharing (CORS).`):se.error(`Failed to load ${e}. The target resource is invalid.`)}load(e){let t=Dn(e),n=this.documents[t];if(n)return n.isPending()?n:F(n.get());{let i=X("EPUBDocStore.load");return n=super.load(t,!0,`Failed to fetch a source document from ${t}`),n.then(r=>{r?i.finish(r):this.reportLoadError(t)}),i.result()}}processViewportMeta(e){let t=e.getAttribute("content");if(!t)return"";let n={},i;for(;(i=t.match(/^,?\s*([-A-Za-z_.][-A-Za-z_0-9.]*)\s*=\s*([-+A-Za-z_0-9.]*)\s*/))!=null;)t=t.substr(i[0].length),n[i[1]]=i[2];let r=n.width-0,o=n.height-0;if(r&&o){let s=!!Object.values(this.primaryOPFByEPubURL).find(l=>l.prePaginated);return`@-epubx-viewport{width:${r}px;height:${o}px;}`+(s?`@page{size:${r}px ${o}px;margin:0;}`:"@page{margin:0;}")}return""}},nm=class{constructor(){d(this,"id",null),d(this,"src",""),d(this,"mediaType",null),d(this,"title",null),d(this,"itemRefElement",null),d(this,"spineIndex",-1),d(this,"compressedSize",0),d(this,"compressed",null),d(this,"epage",0),d(this,"epageCount",0),d(this,"startPage",null),d(this,"skipPagesBefore",null),d(this,"itemProperties"),this.itemProperties=iC}initWithElement(e,t){this.id=e.getAttribute("id"),this.src=Ue(e.getAttribute("href"),t),this.mediaType=e.getAttribute("media-type");let n=e.getAttribute("properties");n&&(this.itemProperties=hC(n.split(/\s+/)))}initWithParam(e){this.spineIndex=e.index,this.id=`item${e.index+1}`,this.src=e.url,this.startPage=e.startPage,this.skipPagesBefore=e.skipPagesBefore}};function rI(e){return e.id}function oI(e){return t=>{let n=X("deobfuscator");return sI("SHA-1",e).then(i=>{let r=t.slice(0,1040),o=t.slice(1040,t.size);Rk(r).then(s=>{let l=new DataView(s);for(let a=0;a<l.byteLength;a++){let u=l.getUint8(a);u^=i[a%20],l.setUint8(a,u)}n.finish(Iy([l,o]))})}),n.result()}}function sI(e,t){let n=X("makeDigest"),i=n.suspend();return window.crypto.subtle.digest(e,new TextEncoder().encode(t)).then(r=>{i.schedule(new Uint8Array(r))}),n.result()}var hi={dcterms:"http://purl.org/dc/terms/",marc:"http://id.loc.gov/vocabulary/",media:"http://www.idpf.org/epub/vocab/overlays/#",rendition:"http://www.idpf.org/vocab/rendition/#",onix:"http://www.editeur.org/ONIX/book/codelists/current.html#",xsd:"http://www.w3.org/2001/XMLSchema#",opf:"http://www.idpf.org/2007/opf"},Bo="http://idpf.org/epub/vocab/package/meta/#",je={language:`${hi.dcterms}language`,title:`${hi.dcterms}title`,creator:`${hi.dcterms}creator`,layout:`${hi.rendition}layout`,titleType:`${Bo}title-type`,displaySeq:`${Bo}display-seq`,alternateScript:`${Bo}alternate-script`,role:`${Bo}role`};function lI(e,t){let n={};return(i,r)=>{var o,s,l,a,u,h;let p,c,f=i.r||n,v=r.r||n;if(e==je.title&&(p=((o=f[je.titleType])==null?void 0:o[0].v)=="main",c=((s=v[je.titleType])==null?void 0:s[0].v)=="main",p!=c))return p?-1:1;let w=parseInt((l=f[je.displaySeq])==null?void 0:l[0].v,10);isNaN(w)&&(w=Number.MAX_VALUE);let y=parseInt((a=v[je.displaySeq])==null?void 0:a[0].v,10);return isNaN(y)&&(y=Number.MAX_VALUE),w!=y?w-y:e!=je.language&&t&&(p=((u=f[je.language]||f[je.alternateScript])==null?void 0:u[0].v)==t,c=((h=v[je.language]||v[je.alternateScript])==null?void 0:h[0].v)==t,p!=c)?p?-1:1:i.o-r.o}}function aI(e,t){let n;if(!t)n=hi;else{n={};for(let c in hi)n[c]=hi[c];let p;for(;(p=t.match(/^\s*([A-Z_a-z\u007F-\uFFFF][-.A-Z_a-z0-9\u007F-\uFFFF]*):\s*(\S+)/))!=null;)t=t.substr(p[0].length),n[p[1]]=p[2]}let i=p=>{if(p){let c=p.match(/^\s*(([^:]*):)?(\S+)\s*$/);if(c){let f=c[2]?n[c[2]]:Bo;if(f)return f+c[3]}}return null},r=1,o=e.childElements().forEachNonNull(p=>{if(p.localName=="meta"){let c=i(p.getAttribute("property"));if(c)return{name:c,value:p.textContent,id:p.getAttribute("id"),order:r++,refines:p.getAttribute("refines"),lang:null,scheme:i(p.getAttribute("scheme")),role:null}}else if(p.namespaceURI=="http://purl.org/dc/elements/1.1/")return{name:hi.dcterms+p.localName,order:r++,lang:p.getAttribute("xml:lang"),value:p.textContent,id:p.getAttribute("id"),refines:null,scheme:null,role:p.getAttribute("role")||p.getAttribute("opf:role")};return null}),s=Fu(o,p=>p.refines),l=p=>cC(p,(c,f)=>c.map(v=>{let w={v:v.value,o:v.order};v.scheme&&(w.s=v.scheme);let y=s[`#${v.id}`]||[];if(y.length||v.lang||v.role){v.lang&&y.push({name:je.language,value:v.lang,lang:null,id:null,refines:v.id,scheme:null,order:v.order,role:null}),v.role&&y.push({name:je.role,value:v.role,lang:null,id:null,refines:v.id,scheme:null,order:v.order,role:null});let g=Fu(y,m=>m.name);w.r=l(g)}return w})),a=l(Fu(o,p=>p.refines?null:p.name)),u=null;a[je.language]&&(u=a[je.language][0].v);let h=p=>{for(let c in p){let f=p[c];f.sort(lI(c,u));for(let v=0;v<f.length;v++){let w=f[v].r;w&&h(w)}}};return h(a),a}function uI(){let e=window.MathJax;return e?e.Hub:null}var im={"application/xhtml+xml":!0,"image/jpeg":!0,"image/png":!0,"image/svg+xml":!0,"image/gif":!0,"audio/mp3":!0},ju="viv-id-",Hl=class{constructor(e,t){this.store=e,this.pubURL=t,d(this,"opfXML",null),d(this,"encXML",null),d(this,"items",null),d(this,"spine",null),d(this,"itemMap",null),d(this,"itemMapByPath",null),d(this,"uid",null),d(this,"bindings",{}),d(this,"lang",null),d(this,"epageCount",0),d(this,"prePaginated",!1),d(this,"epageIsRenderedPage",!0),d(this,"epageCountCallback",null),d(this,"metadata",{}),d(this,"toc",null),d(this,"cover",null),d(this,"fallbackMap",{}),d(this,"pageProgression",null),d(this,"documentURLTransformer"),this.documentURLTransformer=this.createDocumentURLTransformer()}createDocumentURLTransformer(){let e=this;class t{transformFragment(i,r){let o=r+(i?`#${i}`:"");return ju+zw(o,":")}transformURL(i,r){let o=i.match(/^([^#]*)#?(.*)$/);if(o){let s=o[1]||r.replace(/\?viv-toc-box$/,""),l=decodeURIComponent(o[2]);if(s&&e.spine.some(a=>a.src===s))return`#${this.transformFragment(l,s)}`}return i}restoreURL(i){i.charAt(0)==="#"&&(i=i.substring(1)),i.indexOf(ju)===0&&(i=i.substring(ju.length));let r=uC(i,":").match(/^([^#]*)#?(.*)$/);return r?[r[1],r[2]]:[]}}return new t}getMetadata(){return this.metadata}getPathFromURL(e){if(e.startsWith("data:"))return e===this.pubURL?"":e;if(this.pubURL){let t=Ue("",this.pubURL);return e===t||e+"/"===t?"":(t.charAt(t.length-1)!="/"&&(t+="/"),e.substr(0,t.length)==t?decodeURIComponent(e.substr(t.length)):null)}else return e}initWithXMLDoc(e,t){this.opfXML=e,this.encXML=t;let n=e.doc().child("package"),i=n.attribute("unique-identifier")[0];if(i){let a=e.getElement(`${e.url}#${i}`);a&&(this.uid=a.textContent.replace(/[ \n\r\t]/g,""))}let r={};this.items=n.child("manifest").child("item").asArray().map(a=>{let u=new nm,h=a;u.initWithElement(h,e.url);let p=h.getAttribute("fallback");return p&&!im[u.mediaType]&&(r[u.src]=p),!this.toc&&u.itemProperties.nav&&(this.toc=u),!this.cover&&u.itemProperties["cover-image"]&&(this.cover=u),u}),this.itemMap=Uf(this.items,rI),this.itemMapByPath=Uf(this.items,a=>this.getPathFromURL(a.src));for(let a in r){let u=a;for(;;){let h=this.itemMap[r[u]];if(!h)break;if(im[h.mediaType]){this.fallbackMap[a]=h.src;break}u=h.src}}this.spine=n.child("spine").child("itemref").asArray().map((a,u)=>{let h=a,p=h.getAttribute("idref"),c=this.itemMap[p];return c&&(c.itemRefElement=h,c.spineIndex=u),c});let o=n.child("spine").attribute("page-progression-direction")[0];o&&(this.pageProgression=Rw(o));let s=t?t.doc().child("encryption").child("EncryptedData").predicate(Jg.withChild("EncryptionMethod",Jg.withAttribute("Algorithm","http://www.idpf.org/2008/embedding"))).child("CipherData").child("CipherReference").attribute("URI"):[],l=n.child("bindings").child("mediaType").asArray();for(let a=0;a<l.length;a++){let u=l[a].getAttribute("handler"),h=l[a].getAttribute("media-type");h&&u&&this.itemMap[u]&&(this.bindings[h]=this.itemMap[u].src)}if(this.metadata=aI(n.child("metadata"),n.attribute("prefix")[0]),this.metadata[je.language]&&(this.lang=this.metadata[je.language][0].v),this.metadata[je.layout]&&(this.prePaginated=this.metadata[je.layout][0].v==="pre-paginated"),s.length>0&&this.uid){let a=oI(this.uid);for(let u=0;u<s.length;u++)this.store.deobfuscators[this.pubURL+s[u]]=a}return this.prePaginated&&this.assignAutoPages(),F(!0)}assignAutoPages(){let e=0;for(let t of this.spine){let n=this.prePaginated?1:Math.ceil(t.compressedSize/1024);t.epage=e,t.epageCount=n,e+=n}this.epageCount=e,this.epageCountCallback&&this.epageCountCallback(this.epageCount)}setEPageCountMode(e){this.epageIsRenderedPage=e||this.prePaginated}countEPages(e){if(this.epageCountCallback=e,this.epageIsRenderedPage)return this.prePaginated&&this.epageCount==0&&this.assignAutoPages(),F(!0);let t=0,n=0,i=X("countEPages");return i.loopWithFrame(r=>{if(n===this.spine.length){r.breakLoop();return}let o=this.spine[n++];o.epage=t,this.store.load(o.src).then(s=>{let l=1800,a=s.lang||this.lang;a&&a.match(/^(ja|ko|zh)/)&&(l/=3),o.epageCount=Math.ceil(s.getTotalOffset()/l),t+=o.epageCount,this.epageCount=t,this.epageCountCallback&&this.epageCountCallback(this.epageCount),r.continueLoop()})}).thenFinish(i),i.result()}initWithChapters(e,t){this.itemMap={},this.itemMapByPath={},this.items=[],this.spine=this.items;let n=this.opfXML=new Cx(null,"",new DOMParser().parseFromString("<spine></spine>","text/xml"));return e.forEach(i=>{let r=new nm;r.initWithParam(i),r.id;let o=n.document.createElement("itemref");o.setAttribute("idref",r.id),n.root.appendChild(o),r.itemRefElement=o,this.itemMap[r.id]=r;let s=this.getPathFromURL(i.url);s==null&&(s=i.url),this.itemMapByPath[s]=r,this.items.push(r)}),t?this.store.addDocument(e[0].url,t):F(null)}initWithWebPubManifest(e,t,n){var i,r,o,s;e.readingProgression&&(this.pageProgression=e.readingProgression),this.metadata===void 0&&(this.metadata={});let l=e.name||((i=e.metadata)==null?void 0:i.title)||(t==null?void 0:t.title);l&&(this.metadata[je.title]=(Array.isArray(l)?l:[l]).map(w=>{var y;return{v:(y=w.value)!=null?y:w}}));let a=e.author||e.creator||((r=e.metadata)==null?void 0:r.author)||Array.from((o=t==null?void 0:t.querySelectorAll("meta[name='author'], meta[name='DC.Creator']"))!=null?o:[]).map(w=>w.content);a&&a.length!==0&&(this.metadata[je.creator]=(Array.isArray(a)?a:[a]).map(w=>{var y;return{v:(y=w.name)!=null?y:w}}));let u=e.inLanguage||((s=e.metadata)==null?void 0:s.language)||(t==null?void 0:t.documentElement.lang)||(t==null?void 0:t.documentElement.getAttribute("xml:lang"));u&&(this.metadata[je.language]=(Array.isArray(u)?u:[u]).map(w=>({v:w})));let h=this.getPathFromURL(this.pubURL);if(!e.readingOrder&&t&&h!==null){e.readingOrder=[encodeURI(h)];for(let w of tI(t)){let y=w.getAttribute("href");if(/^(https?:)?\/\//.test(y)||/\.(jpe?g|png|gif|pdf|svg|mml)([#?]|$)/.test(y))continue;let g=Dn(Ue(y,this.pubURL)),m=this.getPathFromURL(g),x=m!==null?encodeURI(m):g;e.readingOrder.indexOf(x)==-1&&e.readingOrder.push(x)}}let p=[],c=0,f=-1;[e.readingOrder,e.resources].forEach(w=>{w instanceof Array&&w.forEach(y=>{let g=w===e.readingOrder,m=typeof y=="string"?y:y.url||y.href,x=typeof y=="string"?"":y.encodingFormat||y.href&&y.type||"";if(g||x==="text/html"||x==="application/xhtml+xml"||!x&&y.rel!=="stylesheet"&&/(^|\/)([^/]+\.(x?html|htm|xht)|[^/.]*)([#?]|$)/.test(m)){let C=n?n.replace(/\/[^/]+$/,"/"):this.pubURL,N={url:Ue(Cs(m),C),index:c++,startPage:null,skipPagesBefore:null};y.rel==="contents"&&f===-1&&(f=N.index),p.push(N)}})});let v=X("initWithWebPubManifest");return this.initWithChapters(p).then(()=>{var w,y;f!==-1&&(this.toc=this.items[f]),this.toc||(this.toc=n?(w=this.items)==null?void 0:w[0]:this.itemMapByPath[h]);let g=(y=e.readingOrder)==null?void 0:y.length;g&&g<this.items.length&&this.items.splice(g),v.finish(!0)}),v.result()}getCFI(e,t){let n=this.spine[e],i=X("getCFI");return this.store.load(n.src).then(r=>{let o=r.getNodeByOffset(t),s=null;if(o){let l=r.getNodeOffset(o,0,!1),a=t-l,u=new Yf;u.prependPathFromNode(o,a,!1,null),n.itemRefElement&&u.prependPathFromNode(n.itemRefElement,0,!1,null),s=u.toString()}i.finish(s)}),i.result()}resolveFragment(e){return Kr("resolveFragment",t=>{if(!e){t.finish(null);return}let n=new Yf;n.fromString(e);let i;if(this.opfXML){let r=n.navigate(this.opfXML.document);if(r.node.nodeType!=1||r.after||!r.ref){t.finish(null);return}let o=r.node,s=o.getAttribute("idref");if(o.localName!="itemref"||!s||!this.itemMap[s]){t.finish(null);return}i=this.itemMap[s],n=r.ref}else i=this.spine[0];this.store.load(i.src).then(r=>{let o=n.navigate(r.document),s=r.getNodeOffset(o.node,o.offset,o.after);t.finish({spineIndex:i.spineIndex,offsetInItem:s,pageIndex:-1})})},(t,n)=>{se.warn(n,"Cannot resolve fragment:",e),t.finish(null)})}resolveEPage(e){return Kr("resolveEPage",t=>{if(e<=0){t.finish({spineIndex:0,offsetInItem:0,pageIndex:-1});return}if(this.epageIsRenderedPage){let r=this.spine.findIndex(l=>l.epage==0&&l.epageCount==0||l.epage<=e&&l.epage+l.epageCount>e);r==-1&&(r=this.spine.length-1);let o=this.spine[r];(!o||o.epageCount==0)&&(o=this.spine[--r]);let s=Math.floor(e-o.epage);t.finish({spineIndex:r,offsetInItem:-1,pageIndex:s});return}let n=Ci(this.spine.length,r=>{let o=this.spine[r];return o.epage+o.epageCount>e});n==this.spine.length&&n--;let i=this.spine[n];this.store.load(i.src).then(r=>{e-=i.epage,e>i.epageCount&&(e=i.epageCount);let o=0;if(e>0){let s=r.getTotalOffset();o=Math.round(s*e/i.epageCount),o==s&&o--}t.finish({spineIndex:n,offsetInItem:o,pageIndex:-1})})},(t,n)=>{se.warn(n,"Cannot resolve epage:",e),t.finish(null)})}getEPageFromPosition(e){let t=this.spine[e.spineIndex];if(this.epageIsRenderedPage){let i=t.epage+e.pageIndex;return F(i)}if(e.offsetInItem<=0)return F(t.epage);let n=X("getEPage");return this.store.load(t.src).then(i=>{let r=i.getTotalOffset(),o=Math.min(r,e.offsetInItem);n.finish(t.epage+o*t.epageCount/r)}),n.result()}},Sl=(e,t)=>({page:e,position:{spineIndex:e.spineIndex,pageIndex:t,offsetInItem:e.offset}}),hI=class{constructor(e,t,n,i,r){this.opf=e,this.viewport=t,this.fontMapper=n,this.pageSheetSizeReporter=r,d(this,"spineItems",[]),d(this,"spineItemLoadingContinuations",[]),d(this,"pref"),d(this,"clientLayout"),d(this,"counterStore"),d(this,"tocAutohide",!1),d(this,"tocVisible",!1),d(this,"tocView"),this.pref=Hw(i),this.clientLayout=new WT(t),this.counterStore=new JC(e.documentURLTransformer)}getPage(e){let t=this.spineItems[e.spineIndex];return t?t.pages[e.pageIndex]:null}getCurrentPageProgression(e){if(this.opf.pageProgression)return this.opf.pageProgression;{let t=this.spineItems[e?e.spineIndex:0];return t?t.instance.pageProgression:null}}finishPageContainer(e,t,n){t.container.style.display="none",t.container.style.visibility="visible",t.container.style.position="",t.container.style.top="",t.container.style.left="",t.container.setAttribute("data-vivliostyle-page-side",t.side);let i=e.pages[n];if(t.isFirstPage=e.item.spineIndex==0&&n==0,e.pages[n]=t,this.opf.epageIsRenderedPage){if(n==0&&e.item.spineIndex>0){let r=this.opf.spine[e.item.spineIndex-1];e.item.epage=r.epage+r.epageCount}e.item.epageCount=e.pages.length,this.opf.epageCount=this.opf.spine.reduce((r,o)=>r+o.epageCount,0),this.opf.epageCountCallback&&this.opf.epageCountCallback(this.opf.epageCount)}if(i)e.instance.viewport.contentContainer.replaceChild(t.container,i.container),i.dispatchEvent({type:"replaced",target:null,currentTarget:null,preventDefault:null,newPage:t});else{let r=null;if(n>0)r=e.pages[n-1].container.nextElementSibling;else for(let o=e.item.spineIndex+1;o<this.spineItems.length;o++){let s=this.spineItems[o];if(s&&s.pages[0]){r=s.pages[0].container;break}}e.instance.viewport.contentContainer.insertBefore(t.container,r)}this.pageSheetSizeReporter({width:e.instance.pageSheetWidth,height:e.instance.pageSheetHeight},e.instance.pageSheetSize,e.item.spineIndex,e.instance.pageNumberOffset+n)}renderSinglePage(e,t){let n=X("renderSinglePage"),i=e.pages[t?t.page:0],r=this.makePage(e,t);return i&&(r.pageType=i.pageType),e.instance.layoutNextPage(r,t).then(o=>{t=o;let s=t?t.page-1:e.layoutPositions.length-1;this.finishPageContainer(e,r,s),this.counterStore.finishPage(r.spineIndex,s);let l=null;if(t){let a=e.layoutPositions[t.page];e.layoutPositions[t.page]=t,a&&e.pages[t.page]&&(t.isSamePosition(a)||(l=this.renderSinglePage(e,t)))}l||(l=F(!0)),l.then(()=>{let a=this.counterStore.getUnresolvedRefsToPage(r),u=0;n.loopWithFrame(h=>{if(u++,u>a.length){h.breakLoop();return}let p=a[u-1];if(p.refs=p.refs.filter(c=>!c.isResolved()),p.refs.length===0){h.continueLoop();return}this.getPageViewItem(p.spineIndex).then(c=>{if(!c){h.continueLoop();return}let{currentPageType:f,previousPageType:v}=c.instance.styler.cascade,w=c.instance.scopes;c.instance.scopes={},this.counterStore.pushPageCounters(p.pageCounters),this.counterStore.pushReferencesToSolve(p.refs);let y=c.layoutPositions[p.pageIndex];this.renderSinglePage(c,y).then(g=>{c.instance.styler.cascade.currentPageType=f,c.instance.styler.cascade.previousPageType=v,c.instance.scopes=w,this.counterStore.popPageCounters(),this.counterStore.popReferencesToSolve();let m=g.pageAndPosition.position;m.spineIndex===r.spineIndex&&m.pageIndex===s&&(r=g.pageAndPosition.page),h.continueLoop()})})}).then(()=>{r.container.parentElement||(r=e.pages[s]),r.isLastPage=!t&&e.item.spineIndex===this.opf.spine.length-1,r.isLastPage&&(this.viewport,this.counterStore.finishLastPage(this.viewport)),r.container.setAttribute("data-vivliostyle-page-index",s),r.container.setAttribute("data-vivliostyle-spine-index",r.spineIndex),n.finish({pageAndPosition:Sl(r,s),nextLayoutPosition:t})})})}),n.result()}normalizeSeekPosition(e,t){let n=e.pageIndex,i=-1;if(n<0){i=e.offsetInItem;let r=Ci(t.layoutPositions.length,o=>t.instance.getPosition(t.layoutPositions[o],!0)>i);r===t.layoutPositions.length?t.complete?n=t.layoutPositions.length-1:n=Number.POSITIVE_INFINITY:n=r-1}else n===Number.POSITIVE_INFINITY&&e.offsetInItem!==-1&&(i=e.offsetInItem);return{spineIndex:e.spineIndex,pageIndex:n,offsetInItem:i}}findPage(e,t){let n=X("findPage");return this.getPageViewItem(e.spineIndex).then(i=>{if(!i){n.finish(null);return}let r=null,o;n.loopWithFrame(s=>{let l=this.normalizeSeekPosition(e,i);o=l.pageIndex,r=i.pages[o],r?s.breakLoop():i.complete?(o=i.layoutPositions.length-1,r=i.pages[o],s.breakLoop()):t?this.renderPage(l).then(a=>{a&&(r=a.page,o=a.position.pageIndex),s.breakLoop()}):n.sleep(100).then(()=>{s.continueLoop()})}).then(()=>{n.finish(Sl(r,o))})}),n.result()}renderPage(e){let t=X("renderPage");return this.getPageViewItem(e.spineIndex).then(n=>{if(!n){t.finish(null);return}let i=this.normalizeSeekPosition(e,n),r=i.pageIndex,o=i.offsetInItem,s=n.pages[r];if(s){t.finish(Sl(s,r));return}t.loopWithFrame(l=>{if(r<n.layoutPositions.length){l.breakLoop();return}if(n.complete){r=n.layoutPositions.length-1,l.breakLoop();return}let a=n.layoutPositions[n.layoutPositions.length-1];this.renderSinglePage(n,a).then(u=>{let h=u.pageAndPosition.page;if(a=u.nextLayoutPosition,a){if(o>=0&&n.instance.getPosition(a)>o){s=h,r=n.layoutPositions.length-2,l.breakLoop();return}l.continueLoop()}else s=h,r=u.pageAndPosition.position.pageIndex,n.complete=!0,l.breakLoop()})}).then(()=>{s=s||n.pages[r];let l=n.layoutPositions[r];if(s){t.finish(Sl(s,r));return}this.renderSinglePage(n,l).then(a=>{a.nextLayoutPosition||(n.complete=!0),t.finish(a.pageAndPosition)})})}),t.result()}renderAllPages(){let e=X("renderAllPages");return this.renderPagesUpto({spineIndex:this.opf.spine.length-1,pageIndex:Number.POSITIVE_INFINITY,offsetInItem:-1},!1).then(t=>{e.loopWithFrame(n=>{this.spineItems.some(i=>i==null?void 0:i.pages.some(r=>r==null?void 0:r.fetchers.some(o=>!o.arrived)))?e.sleep(100).then(()=>{n.continueLoop()}):n.breakLoop()}).then(()=>{e.finish(t)})}),e.result()}renderPagesUpto(e,t){let n=X("renderPagesUpto");e||(e={spineIndex:0,pageIndex:0,offsetInItem:0});let i=e.spineIndex,r=e.pageIndex,o=0;t&&(o=i);let s;return n.loopWithFrame(l=>{let a={spineIndex:o,pageIndex:o===i?r:Number.POSITIVE_INFINITY,offsetInItem:o===i?e.offsetInItem:-1};this.renderPage(a).then(u=>{s=u,++o>i?l.breakLoop():l.continueLoop()})}).then(()=>{n.finish(s)}),n.result()}firstPage(e,t){return this.findPage({spineIndex:0,pageIndex:0,offsetInItem:-1},t)}lastPage(e,t){return this.findPage({spineIndex:this.opf.spine.length-1,pageIndex:Number.POSITIVE_INFINITY,offsetInItem:-1},t)}nextPage(e,t){let n=e.spineIndex,i=e.pageIndex,r=X("nextPage");return this.getPageViewItem(n).then(o=>{if(!o){r.finish(null);return}if(o.complete&&i==o.layoutPositions.length-1){if(n>=this.opf.spine.length-1){r.finish(null);return}n++,i=0;let s=this.spineItems[n],l=s&&s.pages[0],a=o.pages[o.pages.length-1];l&&a&&l.side==a.side&&(s.pages.forEach(u=>{u.container&&u.container.remove()}),this.spineItems[n]=null,this.spineItemLoadingContinuations[n]=null)}else i++;this.findPage({spineIndex:n,pageIndex:i,offsetInItem:-1},t).thenFinish(r)}),r.result()}previousPage(e,t){let n=e.spineIndex,i=e.pageIndex;if(i==0){if(n==0)return F(null);n--,i=Number.POSITIVE_INFINITY}else i--;return this.findPage({spineIndex:n,pageIndex:i,offsetInItem:-1},t)}isRectoPage(e,t){let n=e.side==="left",i=this.getCurrentPageProgression(t)==="ltr";return!n&&i||n&&!i}getSpread(e,t){let n=this.getPage(e);if(!n)return F({left:null,right:null});let i=X("getSpread"),r=n.side==="left",o;return this.isRectoPage(n,e)?o=this.previousPage(e,t):o=this.nextPage(e,t),o.then(s=>{let l=this.getPage(e),a=s&&s.page;a&&a.side===l.side&&(a=null),r?i.finish({left:l,right:a}):i.finish({left:a,right:l})}),i.result()}nextSpread(e,t){let n=this.getPage(e);if(!n)return F(null);let i=this.isRectoPage(n,e),r=this.nextPage(e,t);return i?r:r.thenAsync(o=>{if(o){if(o.page.side===n.side)return r;let s=this.nextPage(o.position,t);return s.thenAsync(l=>l?s:r)}else return F(null)})}previousSpread(e,t){let n=this.getPage(e);if(!n)return F(null);let i=this.isRectoPage(n,e),r=this.previousPage(e,t),o=n.container.previousElementSibling;return i?r.thenAsync(s=>s?s.page.side===n.side||s.page.container!==o?r:this.previousPage(s.position,t):F(null)):r}navigateToEPage(e,t,n){let i=X("navigateToEPage");return this.opf.resolveEPage(e).then(r=>{r?this.findPage(r,n).thenFinish(i):i.finish(null)}),i.result()}navigateToFragment(e,t,n){let i=X("navigateToCFI");return this.opf.resolveFragment(e).then(r=>{r?this.findPage(r,n).thenFinish(i):i.finish(null)}),i.result()}navigateTo(e,t,n){se.debug("Navigate to",e);let i=this.opf.getPathFromURL(Dn(e));if(!i){if(this.opf.opfXML&&e.match(/^#epubcfi\(/))i=this.opf.getPathFromURL(this.opf.opfXML.url);else if(e.charAt(0)==="#"){let s=this.opf.documentURLTransformer.restoreURL(e);this.opf.opfXML?(i=this.opf.getPathFromURL(s[0]),i==null&&(i=s[0])):i=s[0],e=s[0]+(s[1]?`#${s[1]}`:"")}if(i==null)return F(null)}let r=this.opf.itemMapByPath[i];if(!r){if(this.opf.opfXML&&i==this.opf.getPathFromURL(this.opf.opfXML.url)){let s=e.indexOf("#");if(s>=0)return this.navigateToFragment(e.substr(s+1),t,n)}return F(null)}let o=X("navigateTo");return this.getPageViewItem(r.spineIndex).then(s=>{if(!s){o.finish(null);return}let l=s.xmldoc.getElement(e);this.findPage({spineIndex:r.spineIndex,pageIndex:-1,offsetInItem:l?s.xmldoc.getElementOffset(l):0},n).thenFinish(o)}),o.result()}makePage(e,t){let n=e.instance.viewport,i=n.document.createElement("div");i.setAttribute("data-vivliostyle-page-container","true"),i.setAttribute("role","region"),Ss||(i.style.visibility="hidden"),n.layoutBox.appendChild(i);let r=n.document.createElement("div");r.setAttribute("data-vivliostyle-bleed-box","true"),i.appendChild(r);let o=new Hy(i,r);if(o.spineIndex=e.item.spineIndex,o.position=t,o.offset=e.instance.getPosition(t),o.offset===0&&!(e.instance.blankPageAtStart&&e.pages.length===0)){let s=this.opf.documentURLTransformer.transformFragment("",e.item.src);r.setAttribute("id",s),o.registerElementWithId(r,s)}if(n!==this.viewport){let s=Ww(this.viewport.width,this.viewport.height,n.width,n.height),l=so(null,new kn(s,null),"");o.delayedItems.push(new Xd(i,"transform",l))}return o}makeObjectView(e,t,n,i){let r=t.getAttribute("data"),o=null;if(r){r=Ue(r,e.url);let s=t.getAttribute("media-type");if(!s){let l=this.opf.getPathFromURL(r);if(l){let a=this.opf.itemMapByPath[l];a&&(s=a.mediaType)}}if(s){let l=this.opf.bindings[s];if(l){o=this.viewport.document.createElement("iframe"),o.style.border="none";let a=Df(r),u=Df(s),h=new Xn;h.append(l),h.append("?src="),h.append(a),h.append("&type="),h.append(u);for(let f=t.firstChild;f;f=f.nextSibling)if(f.nodeType==1){let v=f;if(v.localName=="param"&&v.namespaceURI=="http://www.w3.org/1999/xhtml"){let w=v.getAttribute("name"),y=v.getAttribute("value");w&&y&&(h.append("&"),h.append(encodeURIComponent(w)),h.append("="),h.append(encodeURIComponent(y)))}}o.setAttribute("src",h.toString());let p=t.getAttribute("width");p&&o.setAttribute("width",p);let c=t.getAttribute("height");c&&o.setAttribute("height",c)}}}return o||(o=this.viewport.document.createElement("object"),r&&o.setAttribute("data",r),o.setAttribute("data-adapt-process-children","true")),F(o)}makeMathJaxView(e,t,n,i){let r=uI();if(r){let o=n.ownerDocument,s=o.createElement("span");n.appendChild(s);let l=o.importNode(t,!0);this.resolveURLsInMathML(l,e),s.appendChild(l);let a=r.queue;a.Push(["Typeset",r,s]);let u=X("makeMathJaxView"),h=u.suspend();return a.Push(()=>{h.schedule(s)}),u.result()}return F(null)}resolveURLsInMathML(e,t){if(e!=null){if(e.nodeType===1&&e.tagName==="mglyph"){let n=Array.from(e.attributes);for(let i of n){if(i.name!=="src")continue;let r=Ue(i.nodeValue,t.url);i.namespaceURI?e.setAttributeNS(i.namespaceURI,i.name,r):e.setAttribute(i.name,r)}}e.firstChild&&this.resolveURLsInMathML(e.firstChild,t),e.nextSibling&&this.resolveURLsInMathML(e.nextSibling,t)}}makeCustomRenderer(e){return(t,n,i)=>t.localName=="object"&&t.namespaceURI=="http://www.w3.org/1999/xhtml"?this.makeObjectView(e,t,n,i):t.namespaceURI=="http://www.w3.org/1998/Math/MathML"?this.makeMathJaxView(e,t,n,i):t.dataset&&t.dataset.mathTypeset=="true"?this.makeMathJaxView(e,t,n,i):F(null)}getPageViewItem(e){if(e===-1||e>=this.opf.spine.length)return F(null);let t=this.spineItems[e];if(t)return F(t);let n=X("getPageViewItem"),i=this.spineItemLoadingContinuations[e];if(i){let s=n.suspend();return i.push(s),n.result()}else i=this.spineItemLoadingContinuations[e]=[];let r=this.opf.spine[e],o=this.opf.store;return o.load(r.src).then(s=>{var l;let a=r.itemRefElement.getAttribute("properties");a&&s.root.setAttribute("data-vivliostyle-epub-spine-properties",a),r.title=s.document.title;let u=o.getStyleForDoc(s),h=this.makeCustomRenderer(s),p=this.viewport,c=u.sizeViewport(p.width,p.height,p.fontSize,this.pref);(c.width!=p.width||c.height!=p.height||c.fontSize!=p.fontSize)&&(p=new Ta(p.window,c.fontSize,p.pixelRatio,p.root,c.width,c.height));let f=(l=this.spineItems[0])==null?void 0:l.instance.isVersoFirstPage,v=this.spineItems[e-1],w,y;if(r.startPage!==null)w=r.startPage-1,y=w;else{if(e>0&&(!v||!v.complete))w=r.epage||e,!this.opf.prePaginated&&w%2==(f?1:0)&&w++,y=w;else{w=v?v.instance.pageNumberOffset+v.pages.length:0;let x=this.counterStore.currentPageCounters.page;y=!x||!x.length?w:x[x.length-1]}r.skipPagesBefore!==null&&(w+=r.skipPagesBefore,y+=r.skipPagesBefore)}this.counterStore.forceSetPageCounter(y);let g=new wp(u,s,this.opf.lang,p,this.clientLayout,this.fontMapper,h,this.opf.fallbackMap,w,this.opf.documentURLTransformer,this.counterStore,this.opf.pageProgression,f);g.pref=this.pref;let m=this.opf.metadata&&this.opf.metadata[je.title];g.pubTitle=m&&m[0]&&m[0].v||"",g.docTitle=r.title||"",g.init().then(()=>{!this.opf.pageProgression&&g.pageProgression&&(this.opf.pageProgression=g.pageProgression),t={item:r,xmldoc:s,instance:g,layoutPositions:[null],pages:[],complete:!1},this.spineItems[e]=t,n.finish(t),i.forEach(x=>{x.schedule(t)})})}),n.result()}removeRenderedPages(){let e=this.spineItems;for(let t of e)t&&t.pages.splice(0);this.viewport.clear()}hasAutoSizedPages(){let e=this.spineItems;for(let t of e)if(t){let n=t.pages;for(let i of n)if(i.isAutoPageWidth&&i.isAutoPageHeight)return!0}return!1}hasPages(){return this.spineItems.some(e=>e&&e.pages.length>0)}showTOC(e){let t=this.opf,n=t.toc;if(this.tocAutohide=e,!n)return F(null);if(this.tocVisible=!0,this.tocView&&this.tocView.page)return this.tocView.page.container.style.visibility="visible",this.tocView.page.container.setAttribute("aria-hidden","false"),F(this.tocView.page);let i=X("showTOC");this.tocView||(this.tocView=new nI(t.store,n.src,t.lang,this.clientLayout,this.fontMapper,this.pref,this,t.fallbackMap,t.documentURLTransformer,this.counterStore));let r=this.viewport,o=Math.min(344,Math.round(.67*r.width)-16),s=r.height-6,l=r.document.createElement("div");return r.root.appendChild(l),Ss||(l.style.visibility="hidden"),l.style.width=`${o+16}px`,l.style.maxHeight=`${s}px`,l.setAttribute("data-vivliostyle-toc-box","true"),l.setAttribute("role","navigation"),this.tocView.showTOC(l,r,o,s,this.viewport.fontSize).then(a=>{l.style.visibility="visible",l.setAttribute("aria-hidden","false"),i.finish(a)}),i.result()}hideTOC(){this.tocVisible=!1,this.tocView&&this.tocView.hideTOC()}isTOCVisible(){return this.tocVisible&&!!this.tocView&&this.tocView.isTOCVisible()}},rm="data-vivliostyle-viewer-status",cI="data-vivliostyle-spread-view",Nx=(e=>(e.SINGLE_PAGE="singlePage",e.SPREAD="spread",e.AUTO_SPREAD="autoSpread",e))(Nx||{}),dI=class{constructor(e,t,n,i){this.window=e,this.viewportElement=t,this.instanceId=n,this.callbackFn=i,d(this,"fontMapper"),d(this,"kick"),d(this,"sendCommand"),d(this,"resizeListener"),d(this,"hyperlinkListener"),d(this,"pageRuleStyleElement"),d(this,"pageSheetSizeAlreadySet",!1),d(this,"renderTask",null),d(this,"actions"),d(this,"readyState"),d(this,"packageURL"),d(this,"opf"),d(this,"touchActive"),d(this,"touchX"),d(this,"touchY"),d(this,"needResize"),d(this,"resized"),d(this,"needRefresh"),d(this,"viewportSize"),d(this,"currentPage"),d(this,"currentSpread"),d(this,"pagePosition"),d(this,"fontSize"),d(this,"zoom"),d(this,"fitToScreen"),d(this,"pageViewMode"),d(this,"waitForLoading"),d(this,"renderAllPages"),d(this,"pref"),d(this,"pageSizes"),d(this,"pixelRatio"),d(this,"pixelRatioLimit"),d(this,"viewport"),d(this,"opfView");let r=t.ownerDocument,o=(s,l)=>{let a=r.getElementById(s);return a||(a=r.createElement("style"),a.id=s,l&&(a.textContent=l),r.head.appendChild(a)),a};o("vivliostyle-viewport-screen-css",by),o("vivliostyle-viewport-css",Sy),o("vivliostyle-polyfill-css",Ty),t.setAttribute("data-vivliostyle-viewer-viewport",!0),Ss&&t.setAttribute("data-vivliostyle-debug",!0),t.setAttribute(rm,"loading"),this.fontMapper=new ZN(r.head,t),this.init(),this.kick=()=>{},this.sendCommand=()=>{},this.resizeListener=()=>{this.needResize=!0,this.resized=!0,this.kick()},this.pageReplacedListener=this.pageReplacedListener.bind(this),this.hyperlinkListener=s=>{},this.pageRuleStyleElement=o("vivliostyle-page-rules"),this.actions={loadPublication:this.loadPublication,loadXML:this.loadXML,configure:this.configure,moveTo:this.moveTo,toc:this.showTOC},this.addLogListeners()}init(){this.readyState="loading",this.packageURL=[],this.opf=null,this.touchActive=!1,this.touchX=0,this.touchY=0,this.needResize=!1,this.resized=!1,this.needRefresh=!1,this.viewportSize=null,this.currentPage=null,this.currentSpread=null,this.pagePosition=null,this.fontSize=16,this.zoom=1,this.fitToScreen=!1,this.pageViewMode="singlePage",this.waitForLoading=!1,this.renderAllPages=!0,this.pref=Uw(),this.pageSizes=[],this.pixelRatioLimit=/Chrome/.test(navigator.userAgent)?16:0,this.pixelRatio=Math.min(8,this.pixelRatioLimit)}addLogListeners(){let e=Fw;se.addListener(e.DEBUG,t=>{this.callback({t:"debug",content:t})}),se.addListener(e.INFO,t=>{this.callback({t:"info",content:t})}),se.addListener(e.WARN,t=>{this.callback({t:"warn",content:t})}),se.addListener(e.ERROR,t=>{this.callback({t:"error",content:t})})}callback(e){e.i=this.instanceId,this.callbackFn(e)}setReadyState(e){this.readyState!==e&&(this.readyState=e,this.viewportElement.setAttribute(rm,e),this.callback({t:"readystatechange"}))}loadPublication(e){Vt.registerStartTiming("beforeRender"),this.setReadyState("loading");let t=e.url,n=e.fragment,i=e.authorStyleSheet,r=e.userStyleSheet;this.viewport=null;let o=X("loadPublication");return this.configure(e).then(()=>{let s=new tm;s.init(i,r).then(()=>{let l=Ue(Cs(t),this.window.location.href);this.packageURL=[l],s.loadPubDoc(l).then(a=>{a?(this.opf=a,this.render(n).then(()=>{o.finish(!0)})):o.finish(!1)})})}),o.result()}loadXML(e){Vt.registerStartTiming("beforeRender"),this.setReadyState("loading");let t=e.url,n=e.document,i=e.fragment,r=e.authorStyleSheet,o=e.userStyleSheet;this.viewport=null;let s=X("loadXML");return this.configure(e).then(()=>{let l=new tm;l.init(r,o).then(()=>{let a=t.map((u,h)=>({url:Ue(Cs(u.url),this.window.location.href),index:h,startPage:u.startPage,skipPagesBefore:u.skipPagesBefore}));this.packageURL=a.map(u=>u.url),this.opf=new Hl(l,""),this.opf.initWithChapters(a,n).then(()=>{this.render(i).then(()=>{s.finish(!0)})})})}),s.result()}render(e){this.cancelRenderingTask();let t;return e?t=this.opf.resolveFragment(e).thenAsync(n=>(this.pagePosition=n,F(!0))):t=F(!0),t.thenAsync(()=>(Vt.registerEndTiming("beforeRender"),this.resize()))}resolveLength(e){let t=parseFloat(e),n=/[a-z]+$/,i;if(typeof e=="string"&&(i=e.match(n))){let r=i[0];if(r==="em"||r==="rem")return t*this.fontSize;if(r==="ex")return t*Te.ex*this.fontSize/Te.em;let o=Te[r];if(o)return t*o}return t}configure(e){if(typeof e.autoresize=="boolean"&&(e.autoresize?(this.viewportSize=null,this.window.addEventListener("resize",this.resizeListener,!1),this.needResize=!0):this.window.removeEventListener("resize",this.resizeListener,!1)),typeof e.fontSize=="number"){let t=e.fontSize;t>=5&&t<=72&&this.fontSize!=t&&(this.fontSize=t,this.needResize=!0)}if(typeof e.viewport=="object"&&e.viewport){let t=e.viewport,n={marginLeft:this.resolveLength(t["margin-left"])||0,marginRight:this.resolveLength(t["margin-right"])||0,marginTop:this.resolveLength(t["margin-top"])||0,marginBottom:this.resolveLength(t["margin-bottom"])||0,width:this.resolveLength(t.width)||0,height:this.resolveLength(t.height)||0};(n.width>=200||n.height>=200)&&(this.window.removeEventListener("resize",this.resizeListener,!1),this.viewportSize=n,this.needResize=!0)}if(typeof e.hyphenate=="boolean"&&(this.pref.hyphenate=e.hyphenate,this.needResize=!0),typeof e.horizontal=="boolean"&&(this.pref.horizontal=e.horizontal,this.needResize=!0),typeof e.nightMode=="boolean"&&(this.pref.nightMode=e.nightMode,this.needResize=!0),typeof e.lineHeight=="number"&&(this.pref.lineHeight=e.lineHeight,this.needResize=!0),typeof e.columnWidth=="number"&&(this.pref.columnWidth=e.columnWidth,this.needResize=!0),typeof e.fontFamily=="string"&&(this.pref.fontFamily=e.fontFamily,this.needResize=!0),typeof e.load=="boolean"&&(this.waitForLoading=e.load),typeof e.renderAllPages=="boolean"&&(this.renderAllPages=e.renderAllPages),typeof e.userAgentRootURL=="string"&&(Mf(e.userAgentRootURL.replace(/resources\/?$/,"")),zf(e.userAgentRootURL)),typeof e.rootURL=="string"&&(Mf(e.rootURL),zf(`${qr}resources/`)),typeof e.pageViewMode=="string"&&e.pageViewMode!==this.pageViewMode&&(this.pageViewMode=e.pageViewMode,this.needResize=!0),typeof e.pageBorder=="number"&&e.pageBorder!==this.pref.pageBorder&&(this.viewport=null,this.pref.pageBorder=e.pageBorder,this.needResize=!0),typeof e.zoom=="number"&&e.zoom!==this.zoom&&(this.zoom=e.zoom,this.needRefresh=!0),typeof e.fitToScreen=="boolean"&&e.fitToScreen!==this.fitToScreen&&(this.fitToScreen=e.fitToScreen,this.needRefresh=!0),typeof e.defaultPaperSize=="object"&&typeof e.defaultPaperSize.width=="number"&&typeof e.defaultPaperSize.height=="number"&&(this.viewport=null,this.pref.defaultPaperSize=e.defaultPaperSize,this.needResize=!0),typeof e.allowScripts=="boolean"&&e.allowScripts!==Qn&&(OT(e.allowScripts),this.needResize=!0),typeof e.pixelRatio=="number"){let t=Math.min(e.pixelRatio,this.pixelRatioLimit);t!==this.pixelRatio&&(this.pixelRatio=t,this.needResize=!0)}return this.configurePlugins(e),F(!0)}configurePlugins(e){Sn("CONFIGURATION").forEach(t=>{let n=t(e);this.needResize=n.needResize||this.needResize,this.needRefresh=n.needRefresh||this.needRefresh})}pageReplacedListener(e){let t=this.currentPage,n=this.currentSpread,i=e.target;n?(n.left===i||n.right===i)&&this.showCurrent(e.newPage):t===e.target&&this.showCurrent(e.newPage)}forCurrentPages(e){let t=[];this.currentPage&&t.push(this.currentPage),this.currentSpread&&(t.push(this.currentSpread.left),t.push(this.currentSpread.right)),t.forEach(n=>{n&&e(n)})}removePageListeners(){this.forCurrentPages(e=>{e.removeEventListener("hyperlink",this.hyperlinkListener,!1),e.removeEventListener("replaced",this.pageReplacedListener,!1)})}hidePages(){this.removePageListeners(),this.forCurrentPages(e=>{O(e.container,"display","none")}),this.currentPage=null,this.currentSpread=null}showSinglePage(e){e.addEventListener("hyperlink",this.hyperlinkListener,!1),e.addEventListener("replaced",this.pageReplacedListener,!1),O(e.container,"visibility","visible"),O(e.container,"display","block")}showPage(e){this.hidePages(),this.currentPage=e,e.container.style.marginLeft="",e.container.style.marginRight="",this.showSinglePage(e)}showSpread(e){if(this.hidePages(),this.currentSpread=e,e.left&&e.right){let t=parseFloat(e.left.container.style.width),n=parseFloat(e.right.container.style.width);t&&n&&t!==n&&(t<n?e.left.container.style.marginLeft=`${n-t}px`:e.right.container.style.marginRight=`${t-n}px`)}e.left&&(this.showSinglePage(e.left),e.right?e.left.container.removeAttribute("data-vivliostyle-unpaired-page"):e.left.container.setAttribute("data-vivliostyle-unpaired-page",!0)),e.right&&(this.showSinglePage(e.right),e.left?e.right.container.removeAttribute("data-vivliostyle-unpaired-page"):e.right.container.setAttribute("data-vivliostyle-unpaired-page",!0))}reportPosition(){let e=X("reportPosition");return this.pagePosition,this.opf.getCFI(this.pagePosition.spineIndex,this.pagePosition.offsetInItem).then(t=>{let n=this.currentPage;(this.waitForLoading&&n.fetchers.length>0?Ka(n.fetchers):F(!0)).then(()=>{this.sendLocationNotification(n,t).thenFinish(e)})}),e.result()}createViewport(){let e=this.viewportElement;if(this.viewportSize){let t=this.viewportSize;return e.style.marginLeft=`${t.marginLeft}px`,e.style.marginRight=`${t.marginRight}px`,e.style.marginTop=`${t.marginTop}px`,e.style.marginBottom=`${t.marginBottom}px`,new Ta(this.window,this.fontSize,this.pixelRatio,e,t.width,t.height)}else return new Ta(this.window,this.fontSize,this.pixelRatio,e)}resolveSpreadView(e,t){switch(this.pageViewMode){case"singlePage":return!1;case"spread":return!0;case"autoSpread":default:return(e.width-this.pref.pageBorder)/e.height>=(t?t.width*2/t.height:1.45)&&(!!t||e.width>800)}}updateSpreadView(e){this.pref.spreadView=e,this.viewportElement.setAttribute(cI,e.toString())}sizeIsGood(){var e;let t=this.createViewport(),n=((e=this.opfView)==null?void 0:e.hasPages())&&!this.opfView.hasAutoSizedPages(),i=this.resolveSpreadView(t,this.resized&&n?this.pageSizes[0]:null);this.resized=!1;let r=this.pref.spreadView!==i;return this.updateSpreadView(i),this.pixelRatio&&this.opfView&&this.pixelRatio/this.window.devicePixelRatio!==this.opfView.clientLayout.scaleRatio||this.viewportSize||!this.viewport||this.viewport.fontSize!=this.fontSize?!1:!r&&t.width==this.viewport.width&&t.height==this.viewport.height||!r&&t.width==this.viewport.width&&t.height!=this.viewport.height&&/Android|iPhone|iPad|iPod/.test(navigator.userAgent)?!0:n?(this.viewport.width=t.width,this.viewport.height=t.height,this.needRefresh=!0,!0):!1}setPageSize(e,t,n,i){this.pageSizes[i]=e,this.setPageSizePageRules(t,n,i),i===0&&this.pageViewMode==="autoSpread"&&!this.opfView.hasAutoSizedPages()&&this.updateSpreadView(this.resolveSpreadView(this.viewport,e))}setPageSizePageRules(e,t,n){var i,r;if(this.pageRuleStyleElement&&(!this.pageSheetSizeAlreadySet||this.pageSizes[n].width!==((i=this.pageSizes[n-1])==null?void 0:i.width)||this.pageSizes[n].height!==((r=this.pageSizes[n-1])==null?void 0:r.height))){let o=function(f){let v=f*.75;return Math.ceil(v)},s=Math.max(...this.pageSizes.map(f=>f.width)),l=Math.max(...this.pageSizes.map(f=>f.height)),a=o(s),u=o(l),h=a*((this.pixelRatio||1)-1)+2,p=u*((this.pixelRatio||1)-1)+2,c=`@page {size: ${a}pt ${u}pt; margin: 0 ${-h}pt ${-p}pt 0;}`;this.pageRuleStyleElement.textContent=c,this.pageSheetSizeAlreadySet=!0}}removePageSizePageRules(){this.pageRuleStyleElement&&(this.pageRuleStyleElement.textContent="",this.pageSheetSizeAlreadySet=!1)}reset(){let e=!1,t=!1;this.opfView&&(e=this.opfView.tocVisible,t=this.opfView.tocAutohide,this.opfView.removeRenderedPages()),this.pageSizes=[],this.removePageSizePageRules(),this.viewport=this.createViewport(),this.viewport.resetZoom(),this.opfView=new hI(this.opf,this.viewport,this.fontMapper,this.pref,this.setPageSize.bind(this)),e&&this.sendCommand({a:"toc",v:"show",autohide:t})}showCurrent(e,t){this.needRefresh=!1,this.removePageListeners();let n=this.resolveSpreadView(this.viewport,e.dimensions);return n!==this.pref.spreadView&&this.updateSpreadView(n),n?this.opfView.getSpread(this.pagePosition,t).thenAsync(i=>!i.left&&!i.right?F(null):i.left&&i.right&&(!this.resolveSpreadView(this.viewport,i.left.dimensions)||!this.resolveSpreadView(this.viewport,i.right.dimensions))?(this.updateSpreadView(!1),this.showPage(e),this.setPageZoom(e),this.currentPage=e,F(null)):(this.showSpread(i),this.setSpreadZoom(i),this.currentPage=e.side==="left"?i.left:i.right,F(null))):(this.showPage(e),this.setPageZoom(e),this.currentPage=e,F(null))}setPageZoom(e){let t=this.getAdjustedZoomFactor(e.dimensions);this.viewport.zoom(e.dimensions.width,e.dimensions.height,t)}setSpreadZoom(e){let t=this.getSpreadDimensions(e);this.viewport.zoom(t.width,t.height,this.getAdjustedZoomFactor(t))}getAdjustedZoomFactor(e){return this.fitToScreen?this.calculateZoomFactorToFitInsideViewPort(e):this.zoom}getSpreadDimensions(e){let t=0,n=0;return e.left&&(t+=e.left.dimensions.width,n=e.left.dimensions.height),e.right&&(t+=e.right.dimensions.width,n=Math.max(n,e.right.dimensions.height)),e.left&&e.right&&(t+=this.pref.pageBorder*2,t+=Math.abs(e.left.dimensions.width-e.right.dimensions.width)),{width:t,height:n}}queryZoomFactor(e){if(!this.currentPage)throw new Error("no page exists.");switch(e){case"fit inside viewport":{let t;return this.pref.spreadView?(this.currentSpread,t=this.getSpreadDimensions(this.currentSpread)):t=this.currentPage.dimensions,this.calculateZoomFactorToFitInsideViewPort(t)}default:throw new Error(`unknown zoom type: ${e}`)}}calculateZoomFactorToFitInsideViewPort(e){if(!this.viewport)return this.zoom;let t=this.viewport.width/e.width,n=this.viewport.height/e.height;return Math.min(t,n)}cancelRenderingTask(){this.renderTask&&this.renderTask.interrupt(new om),this.renderTask=null}resize(){if(this.needResize=!1,this.needRefresh=!1,this.sizeIsGood())return F(!0);this.setReadyState("loading"),this.cancelRenderingTask();let e=Jh().getScheduler().run(()=>Kr("resize",t=>{if(!this.opf){t.finish(!1);return}this.renderTask=e,Vt.registerStartTiming("render (resize)"),this.reset(),this.pagePosition&&(this.pagePosition.pageIndex==0&&this.pagePosition.offsetInItem==0||(this.pagePosition.pageIndex=-1)),this.opf.setEPageCountMode(this.renderAllPages),this.opfView.renderPagesUpto(this.pagePosition,!this.renderAllPages).then(n=>{if(!n){t.finish(!1);return}this.pagePosition=n.position,this.showCurrent(n.page,!0).then(()=>{this.setReadyState("interactive"),this.opf.countEPages(i=>{let r={t:"nav",epageCount:i,first:this.currentPage.isFirstPage,last:this.currentPage.isLastPage,metadata:this.opf.metadata,docTitle:this.opf.spine[this.pagePosition.spineIndex].title};(this.currentPage.isFirstPage||this.pagePosition.pageIndex==0&&this.opf.spine[this.pagePosition.spineIndex].epage)&&(r.epage=this.opf.spine[this.pagePosition.spineIndex].epage),this.callback(r)}).then(()=>{this.reportPosition().then(i=>{(this.renderAllPages?this.opfView.renderAllPages():F(null)).then(()=>{this.renderTask===e&&(this.renderTask=null),Vt.registerEndTiming("render (resize)"),Qn&&bx(this.window)?zT(this.window).then(()=>{this.renderAllPages&&this.setReadyState("complete"),this.callback({t:"loaded"}),t.finish(i)}):(this.renderAllPages&&this.setReadyState("complete"),this.callback({t:"loaded"}),t.finish(i))})})})})})},(t,n)=>{if(n instanceof om)Vt.registerEndTiming("render (resize)"),se.debug(n.message);else throw n}));return F(!0)}sendLocationNotification(e,t){let n=X("sendLocationNotification"),i={t:"nav",first:e.isFirstPage,last:e.isLastPage,metadata:this.opf.metadata,docTitle:this.opf.spine[e.spineIndex].title};return this.opf.getEPageFromPosition(this.pagePosition).then(r=>{i.epage=r,i.epageCount=this.opf.epageCount,t&&(i.cfi=t),this.callback(i),n.finish(!0)}),n.result()}getCurrentPageProgression(){return this.opfView?this.opfView.getCurrentPageProgression(this.pagePosition):null}moveTo(e){var t;let n;if(this.readyState!=="complete"&&e.where!=="next"&&this.setReadyState("loading"),typeof e.where=="string"){let r;switch(e.where){case"next":r=this.pref.spreadView?this.opfView.nextSpread:this.opfView.nextPage;break;case"previous":r=this.pref.spreadView?this.opfView.previousSpread:this.opfView.previousPage;break;case"last":r=this.opfView.lastPage;break;case"first":r=this.opfView.firstPage;break;default:return F(!0)}r&&(n=()=>r.call(this.opfView,this.pagePosition,!this.renderAllPages))}else if(typeof e.epage=="number"){let r=e.epage;n=()=>this.opfView.navigateToEPage(r,this.pagePosition,!this.renderAllPages)}else if(typeof e.url=="string"){let r=e.url;n=()=>this.opfView.navigateTo(r,this.pagePosition,!this.renderAllPages)}else if(typeof((t=e.position)==null?void 0:t.spineIndex)=="number"){let r=e.position;n=()=>this.opfView.findPage(r,!this.renderAllPages)}else return F(!0);if(!this.opfView)return F(!0);let i=X("moveTo");return n.call(this.opfView).then(r=>{let o;if(r){this.pagePosition=r.position;let s=X("moveTo.showCurrent");o=s.result(),this.showCurrent(r.page,!this.renderAllPages).then(()=>{this.reportPosition().thenFinish(s)})}else o=F(!0);o.then(s=>{this.readyState==="loading"&&this.setReadyState("interactive"),i.finish(s)})}),i.result()}showTOC(e){let t=!!e.autohide,n=e.v,i=this.opfView.isTOCVisible(),r=t!=this.opfView.tocAutohide&&n!="hide";if(i){if(n=="show"&&!r)return F(!0)}else if(n=="hide")return F(!0);if(i&&n!="show")return this.opfView.hideTOC(),F(!0);{let o=X("showTOC");return this.opfView.showTOC(t).then(s=>{if(s){if(r&&(s.listeners={}),t){let l=()=>{this.opfView.hideTOC()};s.addEventListener("hyperlink",l,!1)}s.addEventListener("hyperlink",this.hyperlinkListener,!1)}o.finish(!0)}),o.result()}}runCommand(e){let t=e.a||"";return Kr("runCommand",n=>{let i=this.actions[t];i?i.call(this,e).then(()=>{this.callback({t:"done",a:t}),n.finish(!0)}):(se.error("No such action:",t),n.finish(!0))},(n,i)=>{se.error(i,"Error during action:",t),n.finish(!0)})}initEmbed(e){let t=sm(e),n=null,i=this;kk(()=>{let r=X("commandLoop"),o=Jh().getScheduler();return i.hyperlinkListener=s=>{let l=s,a=l.href.charAt(0)==="#"||i.packageURL.some(u=>l.href.substr(0,u.length)==u);if(a){s.preventDefault();let u={t:"hyperlink",href:l.href,internal:a};o.run(()=>(i.callback(u),F(!0)))}},r.loopWithFrame(s=>{if(i.needResize)i.resize().then(()=>{s.continueLoop()});else if(i.needRefresh)i.currentPage&&i.showCurrent(i.currentPage,!this.renderAllPages).then(()=>{s.continueLoop()});else if(t){let l=t;t=null,i.runCommand(l).then(()=>{s.continueLoop()})}else{let l=X("waitForCommand");n=l.suspend(this),l.result().then(()=>{s.continueLoop()})}}).thenFinish(r),r.result()}),i.kick=()=>{let r=n;r&&(n=null,r.schedule(!0))},i.sendCommand=r=>t?!1:(t=sm(r),i.kick(),!0),this.window.adapt_command=i.sendCommand}},Tx=(e=>(e.FIT_INSIDE_VIEWPORT="fit inside viewport",e))(Tx||{}),om=class Ix extends Error{constructor(){super(),d(this,"name","RenderingCanceledError"),d(this,"message","Page rendering has been canceled"),d(this,"stack"),Object.setPrototypeOf(this,Ix.prototype),this.stack=new Error().stack}};function sm(e){return typeof e=="string"?Od(e):e}var lm=Fd;function pI(){return{autoResize:!0,fontSize:16,pageBorderWidth:1,renderAllPages:!0,pageViewMode:"autoSpread",zoom:1,fitToScreen:!1,defaultPaperSize:void 0,allowScripts:!0,pixelRatio:8}}function am(e){let t={};return Object.keys(e).forEach(n=>{let i=e[n];switch(n){case"autoResize":t.autoresize=i;break;case"pageBorderWidth":t.pageBorder=i;break;default:t[n]=i}}),t}var Rx=class{constructor(e,t){this.settings=e,d(this,"initialized",!1),d(this,"adaptViewer_"),d(this,"options"),d(this,"eventTarget"),d(this,"readyState"),Iw(e.debug),this.adaptViewer_=new dI(e.window||window,e.viewportElement,"main",this.dispatcher.bind(this)),this.options=pI(),t&&this.setOptions(t),this.eventTarget=new Bd,Object.defineProperty(this,"readyState",{get(){return this.adaptViewer_.readyState}})}setOptions(e){let t=Object.assign({a:"configure"},am(e));this.adaptViewer_.sendCommand(t),Object.assign(this.options,e)}dispatcher(e){let t={type:e.t},n=e;Object.keys(n).forEach(i=>{i!=="t"&&(t[i]=n[i])}),this.eventTarget.dispatchEvent(t)}addListener(e,t){this.eventTarget.addEventListener(e,t,!1)}removeListener(e,t){this.eventTarget.removeEventListener(e,t,!1)}loadDocument(e,t,n){if(!e||(Array.isArray(e)?!e[0]||typeof e[0]!="string"&&!e[0].url:typeof e!="string"&&!e.url)){this.eventTarget.dispatchEvent({type:"error",content:{error:new Error("No URL specified")}});return}this.loadDocumentOrPublication(e,null,t,n)}loadPublication(e,t,n){if(!e){this.eventTarget.dispatchEvent({type:"error",content:{error:new Error("No URL specified")}});return}this.loadDocumentOrPublication(null,e,t,n)}loadDocumentOrPublication(e,t,n,i){let r=n||{};function o(u){if(u)return u.map(h=>({url:h.url||null,text:h.text||null}))}let s=o(r.authorStyleSheet),l=o(r.userStyleSheet);i&&Object.assign(this.options,i);let a=Object.assign({a:e?"loadXML":"loadPublication",userAgentRootURL:this.settings.userAgentRootURL,url:fI(e)||t,document:r.documentObject,fragment:r.fragment,authorStyleSheet:s,userStyleSheet:l},am(this.options));this.initialized?this.adaptViewer_.sendCommand(a):(this.initialized=!0,this.adaptViewer_.initEmbed(a))}getCurrentPageProgression(){return this.adaptViewer_.getCurrentPageProgression()}resolveNavigation(e){switch(e){case"left":return this.getCurrentPageProgression()===lm.LTR?"previous":"next";case"right":return this.getCurrentPageProgression()===lm.LTR?"next":"previous";default:return e}}navigateToPage(e,t){e==="epage"?this.adaptViewer_.sendCommand({a:"moveTo",epage:t}):this.adaptViewer_.sendCommand({a:"moveTo",where:this.resolveNavigation(e)})}navigateToInternalUrl(e){this.adaptViewer_.sendCommand({a:"moveTo",url:e})}navigateToPosition(e){var t,n;this.adaptViewer_.sendCommand({a:"moveTo",position:{spineIndex:e.spineIndex,pageIndex:(t=e.pageIndex)!=null?t:-1,offsetInItem:(n=e.offsetInItem)!=null?n:-1}})}isTOCVisible(){return this.adaptViewer_.opfView&&this.adaptViewer_.opfView.opf&&this.adaptViewer_.opfView.opf.toc?!!this.adaptViewer_.opfView.isTOCVisible():null}showTOC(e,t){let n=e==null?"toggle":e?"show":"hide";this.adaptViewer_.sendCommand({a:"toc",v:n,autohide:t})}queryZoomFactor(e){return this.adaptViewer_.queryZoomFactor(e)}getPageSizes(){return this.adaptViewer_.pageSizes}getTOC(){var e,t;return(t=(e=this.adaptViewer_.opfView)==null?void 0:e.tocView)==null?void 0:t.getTOC()}getMetadata(){return this.adaptViewer_.opf.getMetadata()}getCover(){return this.adaptViewer_.opf.cover}};function fI(e){function t(i){return typeof i=="number"?i:null}function n(i){return typeof i=="string"?{url:i,startPage:null,skipPagesBefore:null}:{url:i.url,startPage:t(i.startPage),skipPagesBefore:t(i.skipPagesBefore)}}return Array.isArray(e)?e.map(n):e?[n(e)]:null}var Ax=(e=>(e.PREVIOUS="previous",e.NEXT="next",e.LEFT="left",e.RIGHT="right",e.FIRST="first",e.LAST="last",e.EPAGE="epage",e))(Ax||{}),gI=Tx,mI=Nx;Vt.forceRegisterEndTiming("load_vivliostyle");var vI=class{constructor(e,{title:t="",printCallback:n=s=>s.print(),errorCallback:i=null,hideIframe:r=!0,removeIframe:o=!0}){d(this,"htmlDoc"),d(this,"title"),d(this,"printCallback"),d(this,"errorCallback"),d(this,"hideIframe"),d(this,"removeIframe"),d(this,"iframe"),d(this,"iframeWin"),d(this,"window"),this.htmlDoc=e,this.title=t,this.printCallback=n,this.errorCallback=i,this.hideIframe=r,this.removeIframe=o}init(){this.iframe=document.createElement("iframe"),this.hideIframe&&(this.iframe.style.width="0",this.iframe.style.height="0",this.iframe.style.borderWidth="0"),this.window=window,this.window.printInstance=this,this.iframe.srcdoc=`
      <!DOCTYPE html>
      <html data-vivliostyle-paginated="true">
        <head>
          <meta charset='utf-8'/>
          <meta name='viewport' content='width=device-width, initial-scale=1.0'/>
          <title>${this.title}</title>
          <style>
            html[data-vivliostyle-paginated] {
              width: 100%;
              height: 100%;
            }
            html[data-vivliostyle-paginated] body,
            html[data-vivliostyle-paginated] [data-vivliostyle-viewer-viewport] {
              width: 100% !important;
              height: 100% !important;
            }
            html[data-vivliostyle-paginated],
            html[data-vivliostyle-paginated] body {
              margin: 0;
              padding: 0;
            }
          </style>
          <style id='vivliostyle-page-rules'></style>
        </head>
        <body onload='parent.printInstance.runInIframe(window)'>
          <div id="vivliostyle-viewer-viewport"></div>
        </body>
      </html>`,document.body.appendChild(this.iframe)}runInIframe(e){return this.iframeWin=e,this.preparePrint().then(()=>this.browserPrint()).then(()=>this.cleanUp())}preparePrint(){this.iframeWin.document.title=this.title;let e=new Blob([this.htmlDoc],{type:"text/html"}),t=URL.createObjectURL(e),n=new Rx({viewportElement:this.iframeWin.document.body.firstElementChild,window:this.iframeWin,debug:!0});return new Promise(i=>{n.addListener("readystatechange",()=>{n.readyState==="complete"&&i()}),this.errorCallback&&n.addListener("error",r=>{var o,s;let l=(s=(o=r.content.error)==null?void 0:o.toString())!=null?s:r.content.messages.join(`
`);this.errorCallback(l)}),n.loadDocument({url:t})})}browserPrint(){this.printCallback(this.iframeWin)}cleanUp(){delete this.window.printInstance,this.removeIframe&&this.iframe.parentElement.removeChild(this.iframe)}};function wI(e,t){new vI(e,t).init()}function Bc(){return Bc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Bc.apply(null,arguments)}let um;const yI=({source:e,page:t=1,zoom:n=1,bookMode:i=!0,fontSize:r=16,background:o="#ececec",renderAllPages:s=!0,autoResize:l=!0,pageViewMode:a=dl.PageViewMode.SINGLE_PAGE,defaultPaperSize:u,pageBorderWidth:h=1,fitToScreen:p=!1,userStyleSheet:c,authorStyleSheet:f,style:v,onMessage:w,onError:y,onReadyStateChange:g,onLoad:m,onNavigation:x,onHyperlink:C,children:N})=>{const A=le.useRef(null),L=le.useRef(),z=Et.useRef();function q(){L.current.setOptions({fontSize:r,pageViewMode:a,renderAllPages:s,autoResize:l,defaultPaperSize:u,pageBorderWidth:h})}function Q(){const Z=L.current,b=Bc({},c?{userStyleSheet:[{[c.endsWith(".css")?"url":"text"]:c}]}:null,f?{authorStyleSheet:[{[f.endsWith(".css")?"url":"text"]:f}]}:null);i?Z.loadPublication(e,b):Z.loadDocument({url:e},b,{fontSize:r,pageViewMode:a,zoom:n,renderAllPages:s,autoResize:l,defaultPaperSize:u,pageBorderWidth:h,fitToScreen:p})}le.useEffect(()=>(L.current=new dl.CoreViewer({viewportElement:A.current}),q(),function(){const Z=T=>{var B,Y;return(B=(Y=T.content.error)==null?void 0:Y.toString())!=null?B:T.content.messages.join(`
`)};function b(T,B){w&&w(Z(T),B)}const R=T=>b(T,"debug"),k=T=>b(T,"info"),M=T=>b(T,"warn");function H(T){y&&y(Z(T))}function P(){const{readyState:T}=L.current;g&&g(T)}function _(){m&&m(z.current)}function G(T){const{docTitle:B,epageCount:Y,epage:E,metadata:W}=T,V={docTitle:B,epageCount:Y,epage:E,metadata:W};z.current=V,x&&x(V)}function ee(T){C&&C(T)}const I=L.current;return I.addListener("debug",R),I.addListener("info",k),I.addListener("warn",M),I.addListener("error",H),I.addListener("readystatechange",P),I.addListener("loaded",_),I.addListener("nav",G),I.addListener("hyperlink",ee),()=>{g&&g(dl.ReadyState.LOADING),I.removeListener("debug",R),I.removeListener("info",k),I.removeListener("warn",M),I.removeListener("error",H),I.removeListener("readystatechange",P),I.removeListener("loaded",_),I.removeListener("nav",G),I.removeListener("hyperlink",ee)}}()),[]),le.useEffect(()=>{Q()},[e,f,c,n,p]),le.useEffect(()=>{q()},[r,a,s,l,u,h]),le.useEffect(()=>{var Z;(Z=L.current)==null||Z.navigateToPage(dl.Navigation.EPAGE,t-1)},[t]);const D=Et.createElement(xI,{ref:A,style:v,background:o});return typeof N=="function"&&N instanceof Function?N({container:D,reload:Q}):D},xI=Dh.div(um||(um=(e=>e)`
  overflow: scroll;
  background: ${0} !important;
`),({background:e})=>e);function bI(){let e=null,t=0;const n=new Map,i=()=>new Worker("/vfm-worker.js"),r=()=>new Worker(new URL(""+new URL("vfmWorker.worker-BUG3XLMj.js",import.meta.url).href,import.meta.url),{type:"module"}),o=async()=>{try{const l=await fetch("/vfm-worker.js");if(!l.ok)throw new Error("fetch failed: "+l.status);const a=l.headers.get("content-type")||"";if(!/javascript|application\/ecmascript|text\/javascript|application\/javascript/i.test(a))throw new Error("unexpected content-type: "+a);const u=await l.text(),h=new Blob([u],{type:"application/javascript"}),p=URL.createObjectURL(h),c=new Worker(p);return URL.revokeObjectURL(p),c}catch{try{const a="https://unpkg.com/@vivliostyle/vfm@2.2.1/dist/vfm.min.js";console.debug("[vfmWorkerClient] attempting to fetch vfm lib to inline into worker",a);const u=await fetch(a);if(!u.ok)throw new Error("vfm lib fetch failed: "+u.status);const p=await u.text()+`
self.onmessage = function(ev){ var seq=ev.data&&ev.data.seq?ev.data.seq:null; var md=ev.data&&ev.data.markdown?ev.data.markdown:''; try{ var html=(typeof self.vfm!=='undefined'&&self.vfm.stringify)?self.vfm.stringify(md): (typeof vfm!=='undefined'&&vfm.stringify)?vfm.stringify(md): ''; self.postMessage({seq,ok:true,html}); }catch(e){ self.postMessage({seq,ok:false,error:String(e)}); } };`,c=new Blob([p],{type:"application/javascript"}),f=URL.createObjectURL(c),v=new Worker(f);return URL.revokeObjectURL(f),v}catch(a){throw console.error("[vfmWorkerClient] inline fetch-of-lib failed; importScripts fallback disabled",a),a}}},s=async()=>{if(e)return e;try{try{console.debug("[vfmWorkerClient] attempting bundled worker createWorkerFromBundle()"),e=r(),console.debug("[vfmWorkerClient] worker created from bundled worker")}catch(l){try{console.debug('[vfmWorkerClient] bundled worker failed, attempting fetch-first -> createWorkerFromBlob("/vfm-worker.js")',l),e=await o(),console.debug("[vfmWorkerClient] worker created from fetch+blob or inline fallback")}catch(a){if(console.warn('[vfmWorkerClient] fetch+blob fallback failed, attempting direct Worker("/vfm-worker.js") with ping',a),e=i(),!await new Promise(h=>{let p=!1;const c=window.setTimeout(()=>{p||(p=!0,h(!1))},1500),f=w=>{const y=w.data;y&&y.seq===0&&(p||(p=!0,clearTimeout(c),h(!0)))},v=w=>{p||(p=!0,clearTimeout(c),h(!1))};e.addEventListener("message",f),e.addEventListener("error",v);try{e.postMessage({seq:0,markdown:""})}catch{p||(p=!0,clearTimeout(c),h(!1))}})){try{e.terminate()}catch{}throw e=null,new Error("worker ping failed (possible wrong MIME or script error)")}console.debug("[vfmWorkerClient] worker created and pinged /vfm-worker.js")}}return e.onmessage=l=>{let a=l.data;if(typeof a=="string")try{a=JSON.parse(a)}catch(p){console.error("[vfmWorkerClient] failed to parse worker JSON",p),a={seq:null,ok:!1,error:"invalid json from worker"}}const u=a;console.debug("[vfmWorkerClient] worker.onmessage",{seq:u.seq,ok:u.ok,htmlLen:u.html?u.html.length:0});const h=n.get(u.seq??-1);h&&(n.delete(u.seq??-1),h(u))},e}catch(l){throw console.error("[vfmWorkerClient] ensureWorker failed",l),l}};return{async stringify(l){t+=1;const a=t,u=await s();return new Promise((h,p)=>{n.set(a,c=>c.ok?h(c.html):p(new Error(c.error||"unknown")));try{const c=JSON.stringify({seq:a,markdown:l});console.debug("[vfmWorkerClient] postMessage to worker (json)",{seq:a,len:l.length}),u.postMessage(c)}catch(c){n.delete(a),p(c)}})},terminate(){e&&(e.terminate(),e=null)}}}const SI=({markdown:e,isVisible:t})=>{const[n,i]=le.useState(""),[r,o]=le.useState(null),[s,l]=le.useState(0),[a,u]=le.useState(0),[h,p]=le.useState(""),c=Et.useRef(null),[f,v]=le.useState(null),[w,y]=le.useState(!1),[g,m]=le.useState({pageRuleFound:!1}),x=Et.useRef(null),C=Et.useRef(!1),N=Et.useRef(null),A=Et.useRef(null),L=Et.useMemo(()=>bI(),[]);if(le.useEffect(()=>{if(!t)return;if(console.debug("[VivlioDBG][Preview] effect start",{mdLen:e.length,time:Date.now()}),!e){i(""),o(null),console.debug("[VivlioDBG][Preview] empty markdown");return}A.current&&A.current.abort();const I=new AbortController;A.current=I;const T=I.signal,B=async()=>{if(!T.aborted)try{const E=await L.stringify(e);if(T.aborted)return;p(E),l(E.length),console.debug("[VivlioDBG][Preview] html generated",{htmlLen:E.length,sample:E.slice(0,120)});try{const W=E.match(/@page[^}]*{[^}]*}/g);if(W&&W.length){const V=W[0],te=V.match(/size:\s*([^;]+);?/),j=Array.from(V.matchAll(/margin[a-z-]*:\s*[^;]+;?/g)).map(re=>re[0]);m({pageRuleFound:!0,size:te?te[1].trim():null,margins:j})}else m({pageRuleFound:!1})}catch{m({pageRuleFound:!1})}try{const W=new Blob([E],{type:"text/html"}),V=URL.createObjectURL(W);if(T.aborted)return;if(c.current)try{URL.revokeObjectURL(c.current)}catch{}c.current=V,u(E.length),i(V)}catch{const te=`data:text/html;base64,${btoa(unescape(encodeURIComponent(E)))}`;if(T.aborted)return;u(te.length),i(te)}o(null),console.debug("[VivlioDBG][Preview] dataUrl ready",{encodedLen:E.length})}catch(E){if(T.aborted)return;console.error("[VivlioDBG][Preview] stringify failed",E),o(E.message),i("")}};setTimeout(async()=>{var E;await B(),typeof((E=window.scheduler)==null?void 0:E.yield)=="function"&&await window.scheduler.yield()},0)},[e,t]),le.useEffect(()=>{if(t)return console.debug("[VivlioDBG][Preview] mount",{time:Date.now()}),()=>{console.debug("[VivlioDBG][Preview] unmount",{time:Date.now()})}},[t]),!t)return null;Et.useEffect(()=>{var T,B,Y,E;let I=null;try{const W=window.EditorView||((T=window.CodeMirror)==null?void 0:T.EditorView);if(!W||typeof W.findFromDOM!="function")return;const V=document.querySelector(".cm-editor");if(!V)return;const te=W.findFromDOM(V);if(!te)return;const j=()=>{try{let re="";te.state&&te.state.doc&&typeof te.state.doc.toString=="function"?re=te.state.doc.toString():te.state&&typeof te.state.sliceDoc=="function"&&(re=te.state.sliceDoc()),re&&re!==f&&v(re)}catch{}};j();try{if(W.updateListener&&typeof W.updateListener.of=="function"){const re=W.updateListener.of(U=>{U.docChanged&&j()});try{(E=te.dispatch)==null||E.call(te,{effects:(Y=(B=window.StateEffect)==null?void 0:B.appendConfig)==null?void 0:Y.of(re)})}catch{}}else I=window.setInterval(j,500)}catch{I=window.setInterval(j,500)}}catch{}return()=>{I&&clearInterval(I)}},[]),Et.useEffect(()=>{if(!f)return;A.current&&A.current.abort();const I=new AbortController;A.current=I;const T=I.signal;let B=null;const Y=async()=>{if(!T.aborted)try{const E=await L.stringify(f);if(T.aborted)return;if(!(/<\s*!doctype|<html[\s>]/i.test(E)&&/<body[\s>]/i.test(E))){console.error("[VivlioDBG][Preview] stringify produced invalid HTML sample",{sample:E.slice(0,200)}),o("Vivliostyle produced invalid HTML. Check input.");return}p(E),l(E.length);try{const V=new Blob([E],{type:"text/html"}),te=URL.createObjectURL(V);if(T.aborted)return;if(c.current)try{URL.revokeObjectURL(c.current)}catch{}c.current=te,u(E.length),i(te)}catch{const j=`data:text/html;base64,${btoa(unescape(encodeURIComponent(E)))}`;if(T.aborted)return;u(j.length),i(j)}o(null),console.debug("[VivlioDBG][Preview] stringify(editorMd) ok",{htmlLen:E.length,sample:E.slice(0,120)})}catch(E){if(T.aborted)return;console.error("[VivlioDBG][Preview] stringify failed (editorMd)",E),o(E.message),i("")}};return B=window.setTimeout(Y,120),()=>{B&&clearTimeout(B)}},[f]);const z=n||null,Q=(I=>{const T=I.match(/```vivliocss\s*([\s\S]*?)```/i);if(T)return T[1].trim();if(h){const B=h.match(/<pre[^>]*class=(?:"|')([^"']*language-vivliocss[^"']*)(?:"|')[^>]*>([\s\S]*?)<\/pre>/i);if(B){let Y=B[2]||"";return Y=Y.replace(/^\s*<code[^>]*>/i,"").replace(/<\/code>\s*$/i,""),Y=Y.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"'),Y=Y.replace(/[\u2026]+$|\.\.\.+$/m,"").trim(),Y}}return""})(e||""),Z=(I=>{const T=I.match(/@page[^{]*{([\s\S]*?)}/i);if(T){const B=T[1],Y=B.match(/size:\s*([^;]+);?/i);if(Y){const W=Y[1].trim().split(/\s+/);return W.length>=2?{width:W[0],height:W[1],margin:null}:{width:W[0],height:null,margin:null}}const E=B.match(/margin:\s*([^;]+);?/i);return{width:null,height:null,margin:E?E[1].trim():null}}return{width:null,height:null,margin:null}})(Q),b=Z.width||"210mm",R=Z.height||"297mm",k=Z.margin||"0mm",M=Q||`@page{size:${b} ${R}; margin:${k};} html,body{background:#fff !important;color:#222 !important;-webkit-font-smoothing:antialiased;font-family:system-ui,-apple-system,'Segoe UI',Roboto,'Noto Sans JP','Hiragino Sans','Hiragino Kaku Gothic ProN','Meiryo',sans-serif; height:100%; overflow:hidden !important;} body{writing-mode:vertical-rl !important; text-orientation:upright !important;} h1,h2,h3,h4,h5{color:#111 !important;} p{color:#222 !important;} a{color:#0645ad !important;}`,H=Et.useRef(null),P=Et.useRef(null),_=Et.useRef(null),[G,ee]=Et.useState(1);return Et.useLayoutEffect(()=>{function I(){const B=H.current,Y=P.current;if(!B||!Y)return;const E=B.getBoundingClientRect(),W=Y.getBoundingClientRect(),V=E.width-0,te=E.height-0;if(W.width<=0||W.height<=0)return;const j=Math.min(V/W.width,te/W.height,1);ee(Number(j.toFixed(4))),_.current&&(_.current.style.transform=`scale(${j})`,_.current.style.transformOrigin="top left")}I(),window.addEventListener("resize",I);const T=new ResizeObserver(I);return H.current&&T.observe(H.current),P.current&&T.observe(P.current),()=>{window.removeEventListener("resize",I),T.disconnect()}},[h,n,Q,b,R]),Et.useEffect(()=>()=>{if(c.current){try{URL.revokeObjectURL(c.current)}catch{}c.current=null}A.current&&(A.current.abort(),A.current=null),L.terminate()},[L]),we.jsxs("div",{style:{width:"100%",height:"100%",position:"relative",zIndex:10,background:"#e9ecef",overflow:"auto",display:"flex",alignItems:"center",justifyContent:"center"},children:[we.jsx("div",{ref:H,style:{padding:24,overflow:"auto",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},children:we.jsxs("div",{ref:P,style:{width:b,height:R,background:"#fff",boxShadow:"0 8px 24px rgba(0,0,0,0.25)",border:"1px solid #ddd",overflow:"hidden",position:"relative"},children:[r&&we.jsxs("div",{style:{position:"absolute",top:8,right:8,left:8,padding:"8px 10px",background:"#ffeeee",border:"1px solid #e99",color:"#a00",fontSize:12,borderRadius:4},children:["VFM Error: ",r]}),z?we.jsx("div",{style:{width:"100%",height:"100%",overflow:"hidden",position:"relative"},children:we.jsx("div",{ref:_,style:{width:"100%",height:"100%",overflow:"hidden",willChange:"transform"},children:we.jsx(yI,{source:z,bookMode:!1,userStyleSheet:M,renderAllPages:!1})})}):r?null:we.jsx("div",{style:{padding:"2em",textAlign:"center",color:"#666"},children:"Markdown..."})]})}),!w&&we.jsx("button",{type:"button","aria-label":"show vivliostyle preview info",onClick:()=>y(!0),style:{position:"absolute",top:6,right:6,width:26,height:26,borderRadius:"50%",border:"1px solid #999",background:"#fff",color:"#333",fontSize:14,cursor:"pointer",lineHeight:"24px",textAlign:"center",boxShadow:"0 1px 2px rgba(0,0,0,.15)"},title:"Preview info",children:"i"}),w&&we.jsxs("div",{ref:x,onPointerDown:I=>{const T=I.target;if(T&&T.closest&&T.closest("button,a,input,textarea,select"))return;const B=x.current;if(!B)return;I.preventDefault();const Y=B.offsetParent,E=Y?Y.getBoundingClientRect():{left:0,top:0},W=B.getBoundingClientRect(),V=W.left-E.left,te=W.top-E.top;B.style.left=`${V}px`,B.style.right="auto",B.style.top=`${te}px`,C.current=!0,N.current={x:I.clientX,y:I.clientY,left:V,top:te};const j=U=>{if(!C.current||!N.current||!B)return;const ue=U.clientX-N.current.x,ce=U.clientY-N.current.y,ne=Math.max(0,N.current.left+ue),me=Math.max(0,N.current.top+ce);B.style.left=`${ne}px`,B.style.top=`${me}px`},re=()=>{C.current=!1,N.current=null,window.removeEventListener("pointermove",j),window.removeEventListener("pointerup",re)};window.addEventListener("pointermove",j),window.addEventListener("pointerup",re)},style:{position:"absolute",top:8,right:8,width:320,maxHeight:"80%",overflow:"auto",resize:"both",minWidth:220,minHeight:120,background:"rgba(18,20,22,0.56)",backdropFilter:"blur(8px) saturate(120%)",border:"1px solid rgba(255,255,255,0.06)",borderRadius:8,padding:"10px 12px",fontSize:12,lineHeight:1.4,color:"#e6e6e6",boxShadow:"0 8px 24px rgba(0,0,0,0.45)",zIndex:20},children:[we.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[we.jsx("strong",{style:{fontSize:13,color:"#f3f4f6"},children:"Vivliostyle Preview Info"}),we.jsx("span",{style:{marginLeft:"auto"},children:we.jsx("button",{type:"button",onClick:()=>y(!1),style:{border:"none",background:"transparent",cursor:"pointer",fontSize:16,lineHeight:1,padding:0,color:"#d0d4d8"},"aria-label":"close info",children:""})})]}),we.jsxs("ul",{style:{listStyle:"disc",paddingLeft:16,margin:0,display:"flex",flexDirection:"column",gap:2},children:[we.jsxs("li",{children:["Markdown chars: ",e.length]}),we.jsxs("li",{children:["Lines: ",e.split(/\r?\n/).length]}),we.jsxs("li",{children:["Approx words: ",e.trim()?e.trim().split(/\s+/).length:0]}),we.jsxs("li",{children:["HTML length: ",s]}),we.jsxs("li",{children:["DataURL length: ",a]}),we.jsxs("li",{children:["@page rule: ",g.pageRuleFound?"found":"none"]}),g.size&&we.jsxs("li",{children:["page size: ",g.size]}),g.margins&&g.margins.map((I,T)=>we.jsx("li",{children:I},T))]}),h&&we.jsxs("details",{style:{marginTop:8},children:[we.jsx("summary",{style:{cursor:"pointer"},children:"Show HTML sample"}),we.jsx("pre",{style:{maxHeight:200,overflow:"auto",background:"rgba(0,0,0,0.28)",padding:8,border:"1px solid rgba(255,255,255,0.04)",color:"#e6e6e6"},children:h.slice(0,1200)})]})]})]})},CI=["textarea.editor","#page-editor textarea",".CodeMirror textarea",'[data-testid="editor-textarea"]',".page-editor textarea"],kI=[".cm-editor",".cm-editor .cm-content",".cm-editor .cm-scroller",'.cm-content[contenteditable="true"]',".cm-scroller",".grw-editor",".editor","#page-editor",".page-editor"];function EI(e={}){const{debounceMs:t=300}=e,[n,i]=le.useState(""),r=le.useRef(""),o=le.useRef("init"),s=le.useRef(null),l=le.useRef(null),a=le.useRef(null),u=le.useRef([]),h=le.useRef(null),p=le.useRef(0),c=le.useRef(null),f=le.useRef(0),v=le.useRef(null),w=le.useCallback(y=>{const g=r.current,m=g!==y,x=m?y.length-g.length:0;s.current&&window.clearTimeout(s.current),s.current=window.setTimeout(()=>{r.current=y,i(y),console.debug("[VivlioDBG] useEditorMarkdown:update",{phase:o.current,length:y.length,changed:m,delta:x,head20:y.slice(0,20)})},t)},[t]);return le.useEffect(()=>{let y=!1,g=null;function m(){var x,C,N,A,L,z;if(!y){for(const q of CI){const Q=document.querySelector(q);if(Q){o.current="textarea",console.debug("[VivlioDBG] useEditorMarkdown: textarea found",{sel:q,valueLen:Q.value.length});const D=()=>w(Q.value);D(),Q.addEventListener("input",D),a.current=()=>Q.removeEventListener("input",D);return}}try{const q=window.EditorView||((x=window.CodeMirror)==null?void 0:x.EditorView);let Q=null;for(const Z of kI){const b=Array.from(document.querySelectorAll(Z)),R=k=>{if(!k)return null;try{if(k.state&&(k.state.doc||typeof k.state.sliceDoc=="function"))return k}catch{}try{const M=Object.getOwnPropertyNames(k||{}).slice(0,200);for(const P of M)try{const _=k[P];if(_&&typeof _=="object"&&_.state&&(_.state.doc||typeof _.state.sliceDoc=="function"))return _}catch{}const H=Object.getOwnPropertySymbols(k||{});for(const P of H)try{const _=k[P];if(_&&typeof _=="object"&&_.state&&(_.state.doc||typeof _.state.sliceDoc=="function"))return _}catch{}}catch{}return null};for(const k of b)try{if(q&&typeof q.findFromDOM=="function")try{const M=q.findFromDOM(k);if(M){Q=M;break}}catch{}if(!Q){const M=k.cmView||k.view||k.__cmView||k.CodeMirrorView;if(M){if(M.state&&(M.state.doc||typeof M.state.sliceDoc=="function")){Q=M;break}const H=R(M);if(H){Q=H;break}}}}catch{}if(Q)break}const D=Q;if(D){o.current="cm6",console.debug("[VivlioDBG] useEditorMarkdown: CM6 view found",{sel:"multiple-candidates",len:(C=D.state)!=null&&C.doc?typeof D.state.doc.toString=="function"?D.state.doc.toString().length:typeof D.state.sliceDoc=="function"?D.state.sliceDoc().length:0:0});const Z=window.EditorView||D&&D.constructor;console.debug("[VivlioDBG] useEditorMarkdown: EditorViewCtor resolution",{hasGlobal:!!window.EditorView,ctorType:typeof Z,ctorName:Z==null?void 0:Z.name});const b=()=>{try{const R=D.state&&D.state.doc&&typeof D.state.doc.toString=="function"?D.state.doc.toString():D.state&&typeof D.state.sliceDoc=="function"?D.state.sliceDoc():"";w(R)}catch{}};b();try{if(console.debug("[VivlioDBG] useEditorMarkdown: EditorView presence",{hasEditorView:!!q,editorViewType:typeof q}),Z&&Z.updateListener&&typeof Z.updateListener.of=="function"){const R=Z.updateListener.of(M=>{try{console.debug("[VivlioDBG] useEditorMarkdown: CM6 updateListener fired",{docChanged:!!M.docChanged})}catch{}M.docChanged&&b()});let k=!1;try{let M=window.StateEffect,H=M?"window":null;if(!M)try{Z!=null&&Z.StateEffect&&(M=Z.StateEffect,H="EditorViewCtor")}catch{}if(!M)try{D.constructor&&D.constructor.StateEffect&&(M=D.constructor.StateEffect,H="view.constructor")}catch{}if(console.debug("[VivlioDBG] useEditorMarkdown: StateEffect resolution",{source:H}),M&&M.appendConfig&&typeof M.appendConfig.of=="function"&&typeof D.dispatch=="function")D.dispatch({effects:M.appendConfig.of(R)}),k=!0,console.debug("[VivlioDBG] useEditorMarkdown: CM6 updateListener appended via StateEffect.appendConfig",{source:H});else throw new Error("appendConfig or dispatch unavailable")}catch(M){console.debug("[VivlioDBG] useEditorMarkdown: CM6 updateListener append failed, falling back to polling",{error:String(M)})}if(k)a.current=()=>{};else{console.debug("[VivlioDBG] useEditorMarkdown: CM6 polling started (fallback, hybrid)");const M=()=>{var I,T;c.current&&(clearInterval(c.current),c.current=null),g&&(clearInterval(g),g=null);try{const B=v.current&&(((I=D.dom)==null?void 0:I.querySelector("textarea"))||D.dom);B&&v.current&&((T=B.removeEventListener)==null||T.call(B,"input",v.current))}catch{}},H=I=>{try{b()}catch{}M()};v.current=H;let P=!1;try{let I=null;D&&D.dom instanceof HTMLElement?I=D.dom:D.root&&D.root.dom&&(I=D.root.dom);const T=I==null?void 0:I.querySelector("textarea");T&&(T.addEventListener("input",H),u.current.push({target:T,event:"input",fn:H}),P=!0,console.debug("[VivlioDBG] useEditorMarkdown: attached input listener to hidden textarea",{textareaFound:!0}))}catch{}if(!P)try{const I=[],T=D&&D.dom instanceof HTMLElement?D.dom:(N=D.root)==null?void 0:N.dom,B=((A=T==null?void 0:T.querySelector)==null?void 0:A.call(T,".cm-content"))??T??null;if(B){const Y=["beforeinput","input","keydown","paste","cut","compositionend"];for(const W of Y){const V=te=>{try{b()}catch{}try{c.current&&(clearInterval(c.current),c.current=null),g&&(clearInterval(g),g=null)}catch{}};I.push([W,V]),B.addEventListener(W,V),u.current.push({target:B,event:W,fn:V})}console.debug("[VivlioDBG] useEditorMarkdown: attached DOM event handlers to view.dom/cm-content",{eventsAttached:Y.length});const E=a.current;a.current=()=>{try{for(const{target:W,event:V,fn:te}of u.current)W==null||W.removeEventListener(V,te)}catch{}u.current=[];try{E==null||E()}catch{}}}}catch{}((I=180)=>{f.current=0;const T=()=>{try{b()}catch{}f.current+=1,f.current>=8&&(c.current&&(clearInterval(c.current),c.current=null),c.current=window.setInterval(b,500))};c.current&&(clearInterval(c.current),c.current=null),c.current=window.setInterval(T,I),g=c.current})(180);let G=null;try{const I=[".vivlio-viewer","#vivlio-viewer",".vivlio-iframe",".vivlio-preview",".viewer",".preview",".vivlio","iframe"],T=Y=>{let E=!1;for(const W of Y){if(W.addedNodes&&W.addedNodes.length>0){E=!0;break}if(W.type==="characterData"||W.type==="attributes"){E=!0;break}const V=W.target;if(V&&I.some(te=>{var j,re;return((j=V.matches)==null?void 0:j.call(V,te))||((re=V.closest)==null?void 0:re.call(V,te))})){E=!0;break}}if(E)try{b()}catch{}},B=((L=D.dom)==null?void 0:L.closest(".cm-editor"))||((z=D.dom)==null?void 0:z.parentElement)||document.body;l.current=new MutationObserver(T),l.current.observe(B,{childList:!0,subtree:!0,characterData:!0,attributes:!0}),G=Y=>{try{b()}catch{}},window.addEventListener("message",G),h.current=G,console.debug("[VivlioDBG] useEditorMarkdown: viewer mutation observer and message listener attached")}catch{}const ee=a.current;a.current=()=>{var I;try{for(const{target:T,event:B,fn:Y}of u.current)T==null||T.removeEventListener(B,Y)}catch{}if(u.current=[],c.current&&(clearInterval(c.current),c.current=null),g&&(clearInterval(g),g=null),v.current){try{const T=D.dom,B=T==null?void 0:T.querySelector("textarea");B&&B.removeEventListener("input",v.current)}catch{}v.current=null}try{(I=l.current)==null||I.disconnect(),l.current=null}catch{}if(h.current)try{window.removeEventListener("message",h.current),h.current=null}catch{}try{ee==null||ee()}catch{}}}}else console.debug("[VivlioDBG] useEditorMarkdown: CM6 updateListener not available, using polling"),g=window.setInterval(b,500),a.current=()=>{g&&(clearInterval(g),g=null)}}catch(R){console.debug("[VivlioDBG] useEditorMarkdown: CM6 updateListener unexpected error, using polling",{error:String(R)}),g=window.setInterval(b,500),a.current=()=>{g&&(clearInterval(g),g=null)}}return}}catch{}try{const q=document.querySelector(".CodeMirror");if(q&&q.CodeMirror){o.current="cm5",console.debug("[VivlioDBG] useEditorMarkdown: CM5 instance found");const Q=q.CodeMirror,D=()=>{try{w(Q.getValue())}catch{}};D();try{Q.on("change",D),a.current=()=>{try{Q.off("change",D)}catch{}}}catch{const b=window.setInterval(D,500);a.current=()=>clearInterval(b)}return}}catch{}if(p.current+=1,console.debug("[VivlioDBG] useEditorMarkdown: retry",{retry:p.current,phase:o.current}),p.current<45){const q=p.current<8?200:600;setTimeout(m,q)}else console.warn("[VivlioDBG] useEditorMarkdown: editor detection failed after extended retries")}}return m(),()=>{var x,C;y=!0;try{for(const{target:N,event:A,fn:L}of u.current)N==null||N.removeEventListener(A,L)}catch{}u.current=[],(x=a.current)==null||x.call(a);try{(C=l.current)==null||C.disconnect(),l.current=null}catch{}if(h.current)try{window.removeEventListener("message",h.current),h.current=null}catch{}s.current&&window.clearTimeout(s.current),g&&(clearInterval(g),g=null),console.debug("[VivlioDBG] useEditorMarkdown: cleanup",{phase:o.current})}},[w]),{markdown:n}}const Lx=le.createContext(null),PI=({children:e})=>{const[t,n]=le.useState(!1),{markdown:i}=EI({debounceMs:250}),[r,o]=le.useState(null),s=le.useRef(Math.random().toString(36).slice(2,8));console.debug("[VivlioDBG][AppProvider] created",{contextId:s.current});const l=le.useCallback(()=>{console.debug("[VivlioDBG][AppContext] toggle() invoked",{time:Date.now(),contextId:s.current}),n(u=>{var p;const h=!u;return console.debug("[VivlioDBG][AppContext] state transition",{from:u,to:h,contextId:s.current,stack:(p=new Error().stack)==null?void 0:p.split(`
`).slice(0,4)}),window.__vivlio_debug=window.__vivlio_debug||{toggles:[]},window.__vivlio_debug.toggles.push({at:Date.now(),from:u,to:h,contextId:s.current}),h})},[]),a={isVivliostyleActive:t,setIsVivliostyleActive:n,isOpen:t,toggle:l,markdown:r??i,forceUpdateMarkdown:u=>{console.debug("[VivlioDBG] forceUpdateMarkdown",{length:u.length,contextId:s.current}),o(u)},__contextId:s.current};return we.jsx(Lx.Provider,{value:a,children:e})},Fx=()=>{const e=le.useContext(Lx);if(!e)throw new Error("useAppContext must be used within an AppProvider");return le.useEffect(()=>{console.debug("[VivlioDBG][useAppContext] hook used",{contextId:e.__contextId,isOpen:e.isOpen})},[e]),e},NI=()=>{const{isOpen:e,markdown:t}=Fx();return le.useEffect(()=>(console.debug("[VivlioDBG][PreviewShell] mount",{time:Date.now()}),()=>{console.debug("[VivlioDBG][PreviewShell] unmount",{time:Date.now()})}),[]),le.useEffect(()=>{const n=document.getElementById("vivlio-preview-container"),i=document.querySelector(".page-editor-preview-container");if(!n){console.warn("[VivlioDBG][PreviewShell] host container missing when toggling",{isOpen:e});return}n.dataset.vivlioMount="true",n.style.display=e?"block":"none",e&&(n.style.position="relative",n.style.width="100%",n.style.height="100%",n.style.overflow="auto",n.style.zIndex="10",n.style.minHeight||(n.style.minHeight="400px"));let r=0,o=0;const s=[];i&&Array.from(i.children).forEach((a,u)=>{a!==n&&(s.push(`${u}:${a.className||a.id||a.tagName}`),e?(a.dataset.vivlioPrevDisplay||(a.dataset.vivlioPrevDisplay=a.style.display||""),a.style.setProperty("display","none","important"),a.setAttribute("aria-hidden","true"),r+=1):(a.dataset.vivlioPrevDisplay!==void 0?(a.style.display=a.dataset.vivlioPrevDisplay,delete a.dataset.vivlioPrevDisplay):a.style.display="",a.removeAttribute("aria-hidden"),o+=1))}),console.debug("[VivlioDBG][PreviewShell] toggle siblings",{isOpen:e,hasHost:!!n,hasPreviewContainer:!!i,hostDisplay:n.style.display,markdownLen:t.length,hiddenCount:r,restoredCount:o,processed:s,previewChildren:i?i.children.length:-1})},[e]),e?we.jsx("div",{"data-vivlio-shell-root":!0,children:we.jsx(SI,{markdown:t,isVisible:e})}):null},TI=['[data-testid="view-button"]',".page-editor-meta .btn-edit-page",'[data-testid="editor-button"]',".page-editor-header .btn-edit",".btn-edit-page"];function II(e){return!e||!e.length?null:e[0]}function _c(e){return(e.textContent||"").replace(/\s+/g," ").trim().toLowerCase()}function RI(){for(const e of TI){const t=document.querySelector(e);if(t instanceof HTMLElement)return t}return null}function AI(){const e=Array.from(document.querySelectorAll("button, a.btn, a")),t=[];return e.forEach(n=>{const i=_c(n);if(!i)return;let r=0;/view/.test(i)&&(r+=4),/edit/.test(i)&&(r+=2),/page/.test(i)&&(r+=1),/\bedit\b/.test(i)&&(r+=1),r>0&&t.push({el:n,score:r})}),t.sort((n,i)=>i.score-n.score),II(t.map(n=>n.el))}function LI(){return RI()||AI()}const FI=()=>{const{isOpen:e,toggle:t}=Fx(),[n,i]=le.useState(null),[r,o]=le.useState(""),[s,l]=le.useState(null),a=le.useRef(!1),u=le.useRef(null),h=le.useRef(null);if(le.useEffect(()=>{function v(y){if(a.current||!y.parentElement)return;let g=y.parentElement.querySelector(".vivlio-inline-toggle");g||(g=document.createElement("span"),g.className="vivlio-inline-toggle",g.style.marginRight="6px",g.style.display="inline-flex",g.style.alignItems="center",y.parentElement.insertBefore(g,y),console.debug("[VivlioDBG][ExternalToggle] wrapper created & inserted",{time:Date.now(),parent:y.parentElement.className,anchorText:_c(y)})),h.current=y;try{const C=window.getComputedStyle(y);l({height:C.height||"",paddingTop:C.paddingTop||"",paddingBottom:C.paddingBottom||"",paddingLeft:C.paddingLeft||"",paddingRight:C.paddingRight||"",fontSize:C.fontSize||"",lineHeight:C.lineHeight||"",borderRadius:C.borderRadius||"",minWidth:C.minWidth||""})}catch{}function m(C){if(!C)return null;const N=L=>!L||L==="transparent"||/rgba\(\s*0+\s*,\s*0+\s*,\s*0?\.?0*\s*\)/i.test(L);try{const L=window.getComputedStyle(C),z=["--vivlio-comp-color","--accent-color","--primary-color","--color"];for(const q of z){const Q=L.getPropertyValue(q).trim();if(Q)return Q}}catch{}let A=C;for(let L=0;A&&L<8;L++,A=A.parentElement)try{const z=window.getComputedStyle(A),q=[z.backgroundColor,z.borderColor,z.color];for(const Q of q)if(!N(Q))return Q}catch{}try{const L=C.querySelectorAll("*");for(const z of Array.from(L))try{const q=window.getComputedStyle(z),Q=[q.backgroundColor,q.borderColor,q.color];for(const D of Q)if(!N(D))return D}catch{}}catch{}return null}function x(){try{const C=m(y);if(C&&C!==u.current){try{g.style.setProperty("--vivlio-comp-color",C);const N=g.querySelector("button");N&&N.style.setProperty("--vivlio-comp-color",C)}catch{}u.current=C,console.debug("[VivlioDBG][ExternalToggle] applied effective color",{effective:C})}else console.debug("[VivlioDBG][ExternalToggle] no effective color found",{effective:C})}catch(C){console.warn("[VivlioDBG][ExternalToggle] error applying effective color",C)}}x(),i(g),a.current=!0,console.debug("[VivlioDBG][ExternalToggle] attached to anchor",{anchorSel:y.className,text:_c(y)})}const w=LI();w&&v(w)},[]),le.useEffect(()=>{if(n)try{const v=n.querySelector("button.vivlio-toggle-btn");if(!v)return;const w="linear-gradient(135deg, #1a63b8 0%, #3b82f6 18%, #1a63b8 28%, #d05232 48%, #f28b6b 68%, #1a63b8 100%)",g=`radial-gradient(circle at center, rgba(0,0,0,0.82) 0%, rgba(0,0,0,0.78) 40%, rgba(0,0,0,0.68) 65%, rgba(0,0,0,0.0) 100%), ${w}`;v.style.setProperty("background",e?w:g,"important");const m=e?"100% 50%":"0% 50%";if(v.style.setProperty("background-position",m,"important"),v.style.setProperty("color",e?"#ffffff":"#9aa0a6","important"),v.style.setProperty("filter","none","important"),v.style.setProperty("box-shadow",e?"0 4px 0 rgba(0,0,0,0.18), inset 0 1px 0 rgba(255,255,255,0.12)":"0 4px 0 rgba(0,0,0,0.22), inset 0 1px 0 rgba(255,255,255,0.16), inset 0 -12px 28px rgba(0,0,0,0.9)","important"),v.style.setProperty("border","1px solid rgba(255,255,255,0.12)","important"),v.style.setProperty("box-sizing","border-box","important"),v.style.setProperty("border-radius","6px","important"),v.style.setProperty("border-radius","6px","important"),v.style.setProperty("padding","6px 10px","important"),v.style.setProperty("font-weight","600","important"),s)try{s.height&&v.style.setProperty("height",s.height,"important"),s.fontSize&&v.style.setProperty("font-size",s.fontSize,"important"),v.style.setProperty("line-height","normal","important");const N=s.paddingTop||"6px",A=s.paddingBottom||"6px",L=s.paddingLeft||"10px",z=s.paddingRight||"10px";v.style.setProperty("padding",`${N} ${z}`,"important");const q=s.borderRadius&&s.borderRadius!=="0px"?s.borderRadius:"6px";v.style.setProperty("border-radius",q,"important"),s.minWidth&&v.style.setProperty("min-width",s.minWidth,"important")}catch{}console.debug("[VivlioDBG][ExternalToggle] applied important inline styles to button (isOpen="+e+")")}catch{}},[n,e,s]),le.useEffect(()=>{if(!n)return;const v=()=>document.querySelector(".layout-root")||document.documentElement,w=()=>{const g=v(),m=g&&g.classList&&g.classList.contains("editing");try{n.style.display=m?"inline-flex":"none"}catch{}};w();const y=new MutationObserver(g=>{for(const m of g){if(m.type==="attributes"&&m.attributeName==="class"){w();return}if(m.type==="childList"){w();return}}});return y.observe(document.documentElement,{attributes:!0,attributeFilter:["class"],subtree:!0,childList:!0}),()=>y.disconnect()},[n]),!n)return null;const c=`${r.split(/\s+/).filter(v=>v&&v!=="active").join(" ")} vivlio-toggle-btn vivlio-comp${e?" active":""}`.trim(),f={background:"linear-gradient(135deg, #1a63b8 0%, #1a63b8 25%, #d05232 25%, #d05232 75%, #1a63b8 75%, #1a63b8 100%)",color:"#ffffff",border:"1px solid rgba(255,255,255,0.08)",padding:"6px 10px",borderRadius:"6px",boxShadow:"0 4px 0 rgba(0,0,0,0.18), inset 0 1px 0 rgba(255,255,255,0.12)",boxSizing:"border-box",cursor:"pointer",fontWeight:600,display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:"normal",verticalAlign:"middle",WebkitAppearance:"none",backgroundSize:"200% 100%",backgroundPosition:"0% 50%",transition:"background-position 0.225s ease, color 0.225s ease, box-shadow 0.225s ease, border-color 0.225s ease"};return Sw.createPortal(we.jsx("button",{type:"button",className:c,style:f,onClick:v=>{console.debug("[VivlioDBG][ExternalToggle] click",{isOpenBefore:e,time:Date.now(),anchorClasses:r}),t()},"aria-pressed":e,title:"Toggle Vivliostyle Preview","data-vivlio-toggle":"true",children:"Vivliostyle"}),n)},OI="growi-plugin-vivliostyle-preview",BI="1.0.0",_I="GROWI plugin template for script",MI="MIT",zI=["growi","growi-plugin"],$I="module",DI={dev:"vite",build:"tsc && vite build","build-and-push":'powershell -NoProfile -ExecutionPolicy Bypass -File ./build-and-push.ps1 "$npm_config_message"',test:"jest",preview:"vite preview"},VI={"@types/markdown-it":"^14.1.2","@types/unist":"^3.0.3","@vivliostyle/react":"^2.34.1","@vivliostyle/vfm":"^2.2.1",hastscript:"^9.0.1","markdown-it":"^14.1.0","react-innertext":"^1.1.5",unified:"^11.0.5","unist-util-visit":"^5.0.0"},UI={react:">=18","react-dom":">=18"},HI={"@testing-library/dom":"^10.4.1","@testing-library/jest-dom":"^6.8.0","@testing-library/react":"^16.3.0","@types/jest":"^30.0.0","@types/react":"^18.3.3","@types/react-dom":"^18.3.0","@typescript-eslint/eslint-plugin":"^5.0.0","@typescript-eslint/parser":"^5.0.0","@vitejs/plugin-react":"^4.3.1",eslint:"^8.18.0","eslint-config-next":"^14.2.4","eslint-config-weseek":"^2.1.0","eslint-import-resolver-typescript":"^3.2.5","eslint-plugin-import":"^2.29.1","eslint-plugin-jest":"^27.1.0","eslint-plugin-react":"^7.30.1","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-regex":"^1.10.0","html-whitespace-sensitive-tag-names":"^3.0.1","identity-obj-proxy":"^3.0.0",jest:"^29.7.0","jest-environment-jsdom":"^30.1.2",react:"^18.3.1","react-dom":"^18.3.1",typescript:"^5.5.2",vite:"^5.3.2","vite-plugin-static-copy":"^3.1.2"},WI={schemaVersion:"4",types:["script"]},Ox={name:OI,version:BI,description:_I,license:MI,keywords:zI,type:$I,scripts:DI,dependencies:VI,peerDependencies:UI,devDependencies:HI,growiPlugin:WI};console.debug("[VivlioDBG][entry] script file evaluated",{time:Date.now(),plugin:Ox.name});const Bx=Ox.name,Mc="vivlio-preview-container",_x=[".page-editor-preview-container","#page-editor-preview-container",".page-editor-preview",".page-editor-preview-body"];function GI(){for(const e of _x){const t=document.querySelector(e);if(t)return t}return null}function zc(){if(console.debug("[VivlioDBG] activate -> mount called, readyState=",document.readyState),document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>zc(),{once:!0});return}const e=GI();if(console.debug("[VivlioDBG][mount] query preview container",{found:!!e,candidates:_x}),!e){console.debug("[VivlioDBG][mount] previewContainer not found, retry scheduling (200ms)"),setTimeout(()=>{window.__vivlio_root||zc()},200);return}let t=document.getElementById(Mc);t||(t=document.createElement("div"),t.id=Mc,t.style.width="100%",t.style.height="100%",t.style.position="relative",t.style.display="none",e.appendChild(t),console.debug("[VivlioDBG][mount] host container created and appended"));let n=window.__vivlio_root;n?console.debug("[VivlioDBG][mount] root already exists - skipping re-create"):(n=Cw(t),window.__vivlio_root=n),console.debug("[VivlioDBG][mount] rendering React tree",{hasHost:!!t,childrenBefore:t.childElementCount}),n.render(we.jsx(le.StrictMode,{children:we.jsx(PI,{children:we.jsxs("div",{style:{display:"contents"},children:[we.jsx(NI,{}),we.jsx(FI,{})]})})})),console.debug("[VivlioDBG][mount] mount finished",{hostChildrenAfter:t.childElementCount})}function Mx(){console.debug("[VivlioDBG][unmount] called");const e=window.__vivlio_root;e&&(e.unmount(),delete window.__vivlio_root,console.debug("[VivlioDBG][unmount] root unmounted"));const t=document.getElementById(Mc);t!=null&&t.parentNode&&t.parentNode.removeChild(t)}const xp=()=>{console.debug("[VivlioDBG] activate() invoked",{time:Date.now()}),zc()},jI=()=>{console.debug("[VivlioDBG] deactivate() invoked",{time:Date.now()}),Mx()};window.pluginActivators==null&&(window.pluginActivators={});window.pluginActivators[Bx]={activate:xp,deactivate:jI};console.debug("[VivlioDBG][entry] pluginActivators registered",{id:Bx});window.__vivlio_autoActivateTimer||(window.__vivlio_autoActivateTimer=setTimeout(()=>{window.__vivlio_root?console.debug("[VivlioDBG][entry] skip auto activate root already present"):(console.debug("[VivlioDBG][entry] auto activating (fallback)"),xp())},3e3));window.__vivlio_forceActivate=xp;window.__vivlio_forceUnmount=Mx;

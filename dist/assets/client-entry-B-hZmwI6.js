const i="growi-plugin-vivliostyle-preview",c="vivlio-preview-floating-button-root";const s=(()=>{let t=!1,n=null;function r(){let e=document.getElementById(c);return e||(e=document.createElement("div"),e.id=c,e.style.position="fixed",e.style.right="20px",e.style.bottom="20px",e.style.zIndex="2147483647",document.body.appendChild(e)),e}function u(e){const d=r();d.innerHTML="";const o=document.createElement("button");o.textContent=e==="preview"?"Vivliostyleプレビュー":"Vivliostyle（閲覧）",o.style.padding="10px 14px",o.style.borderRadius="6px",o.style.border="1px solid #999",o.style.background=e==="preview"?"#165dff":"#666",o.style.color="#fff",o.style.cursor="pointer",o.setAttribute("type","button"),o.addEventListener("click",()=>{const p=new URL(location.href);p.searchParams.set("vivlio","1"),window.open(p.toString(),"_blank","noopener,noreferrer")}),d.appendChild(o)}return{mount(e){if(e==="view"){this.unmount(),n="view";return}u(e),t=!0,n=e},unmount(){const e=document.getElementById(c);e&&e.parentElement&&e.parentElement.removeChild(e),t=!1,n=null},isMounted(){return t},getMode(){return n}}})();let l,a;function w(){var n;const t=(n=growiFacade==null?void 0:growiFacade.markdownRenderer)==null?void 0:n.optionsGenerators;t&&(l=t.customGenerateViewOptions??t.generateViewOptions,a=t.customGeneratePreviewOptions??t.generatePreviewOptions,t.customGenerateViewOptions=(...r)=>{try{s.unmount(),s.mount("view")}catch(e){console.warn(`[${i}] view mount error`,e)}return(l??(()=>({})))(...r)},t.customGeneratePreviewOptions=(...r)=>{try{s.mount("preview")}catch(e){console.warn(`[${i}] preview mount error`,e)}return(a??(()=>({})))(...r)},console.log(`[${i}] activated`))}function v(){var n;try{s.unmount()}catch{}const t=(n=growiFacade==null?void 0:growiFacade.markdownRenderer)==null?void 0:n.optionsGenerators;t&&(l&&(t.customGenerateViewOptions=l),a&&(t.customGeneratePreviewOptions=a)),console.log(`[${i}] deactivated`)}window.pluginActivators||(window.pluginActivators={});window.pluginActivators[i]={activate:w,deactivate:v};
